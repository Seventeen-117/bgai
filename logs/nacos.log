2025-05-09 14:58:48.748 [main] WARN  com.alibaba.nacos.client.logging.NacosLogging - Load Logback Configuration of Nacos fail, message: Could not initialize Logback Nacos logging from classpath:nacos-logback.xml
2025-05-09 14:58:48.752 [main] INFO  com.bgpay.bgai.BgaiApplication - The following 1 profile is active: "dev"
2025-05-09 14:58:50.379 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-05-09 14:58:50.382 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-05-09 14:58:50.419 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 26 ms. Found 0 JPA repository interfaces.
2025-05-09 14:58:50.439 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-05-09 14:58:50.441 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-05-09 14:58:50.460 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 7 ms. Found 0 Redis repository interfaces.
2025-05-09 14:58:50.783 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'allowedFileTypeMapper' and 'com.bgpay.bgai.mapper.AllowedFileTypeMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 14:58:50.783 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'apiConfigMapper' and 'com.bgpay.bgai.mapper.ApiConfigMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 14:58:50.783 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'chatCompletionsMapper' and 'com.bgpay.bgai.mapper.ChatCompletionsMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 14:58:50.783 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'choicesMapper' and 'com.bgpay.bgai.mapper.ChoicesMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 14:58:50.783 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'fileTypeMapper' and 'com.bgpay.bgai.mapper.FileTypeMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 14:58:50.784 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'priceConfigMapper' and 'com.bgpay.bgai.mapper.PriceConfigMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 14:58:50.784 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'priceVersionMapper' and 'com.bgpay.bgai.mapper.PriceVersionMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 14:58:50.784 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'usageInfoMapper' and 'com.bgpay.bgai.mapper.UsageInfoMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 14:58:50.784 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'usageRecordMapper' and 'com.bgpay.bgai.mapper.UsageRecordMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 14:58:50.784 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'userMapper' and 'com.bgpay.bgai.mapper.UserMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 14:58:50.784 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - No MyBatis mapper was found in '[com.bgpay.bgai.mapper]' package. Please check your configuration.
2025-05-09 14:58:50.787 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'allowedFileTypeMapper' and 'com.bgpay.bgai.mapper.AllowedFileTypeMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 14:58:50.787 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'apiConfigMapper' and 'com.bgpay.bgai.mapper.ApiConfigMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 14:58:50.787 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'chatCompletionsMapper' and 'com.bgpay.bgai.mapper.ChatCompletionsMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 14:58:50.787 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'choicesMapper' and 'com.bgpay.bgai.mapper.ChoicesMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 14:58:50.787 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'fileTypeMapper' and 'com.bgpay.bgai.mapper.FileTypeMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 14:58:50.787 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'priceConfigMapper' and 'com.bgpay.bgai.mapper.PriceConfigMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 14:58:50.787 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'priceVersionMapper' and 'com.bgpay.bgai.mapper.PriceVersionMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 14:58:50.787 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'usageInfoMapper' and 'com.bgpay.bgai.mapper.UsageInfoMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 14:58:50.787 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'usageRecordMapper' and 'com.bgpay.bgai.mapper.UsageRecordMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 14:58:50.787 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'userMapper' and 'com.bgpay.bgai.mapper.UserMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 14:58:50.787 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - No MyBatis mapper was found in '[com.bgpay.bgai.mapper]' package. Please check your configuration.
2025-05-09 14:58:51.149 [main] INFO  o.springframework.cloud.context.scope.GenericScope - BeanFactory id=38ed5f2c-a148-3506-bdcb-f18d795b9667
2025-05-09 14:58:51.512 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'org.springframework.cloud.commons.config.CommonsConfigAutoConfiguration' of type [org.springframework.cloud.commons.config.CommonsConfigAutoConfiguration] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 14:58:51.519 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'org.springframework.cloud.client.loadbalancer.LoadBalancerDefaultMappingsProviderAutoConfiguration' of type [org.springframework.cloud.client.loadbalancer.LoadBalancerDefaultMappingsProviderAutoConfiguration] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 14:58:51.524 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'loadBalancerClientsDefaultsMappingsProvider' of type [org.springframework.cloud.client.loadbalancer.LoadBalancerDefaultMappingsProviderAutoConfiguration$$Lambda/0x000001ddc4744400] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 14:58:51.535 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'defaultsBindHandlerAdvisor' of type [org.springframework.cloud.commons.config.DefaultsBindHandlerAdvisor] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 14:58:51.570 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'spring.datasource.dynamic-com.baomidou.dynamic.datasource.spring.boot.autoconfigure.DynamicDataSourceProperties' of type [com.baomidou.dynamic.datasource.spring.boot.autoconfigure.DynamicDataSourceProperties] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 14:58:51.584 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'com.baomidou.dynamic.datasource.spring.boot.autoconfigure.DynamicDataSourceAutoConfiguration' of type [com.baomidou.dynamic.datasource.spring.boot.autoconfigure.DynamicDataSourceAutoConfiguration$$SpringCGLIB$$0] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 14:58:51.602 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'dsProcessor' of type [com.baomidou.dynamic.datasource.processor.jakarta.DsJakartaHeaderProcessor] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 14:58:52.015 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'messageConverterConfiguration' of type [org.apache.rocketmq.spring.autoconfigure.MessageConverterConfiguration$$SpringCGLIB$$0] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 14:58:52.090 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'createRocketMQMessageConverter' of type [org.apache.rocketmq.spring.support.RocketMQMessageConverter] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 14:58:52.099 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'rocketmq-org.apache.rocketmq.spring.autoconfigure.RocketMQProperties' of type [org.apache.rocketmq.spring.autoconfigure.RocketMQProperties] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 14:58:52.102 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'listenerContainerConfiguration' of type [org.apache.rocketmq.spring.autoconfigure.ListenerContainerConfiguration$$SpringCGLIB$$0] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 14:58:52.134 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'org.springframework.cloud.client.loadbalancer.reactive.LoadBalancerBeanPostProcessorAutoConfiguration' of type [org.springframework.cloud.client.loadbalancer.reactive.LoadBalancerBeanPostProcessorAutoConfiguration] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 14:58:52.137 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'org.springframework.cloud.client.loadbalancer.reactive.LoadBalancerBeanPostProcessorAutoConfiguration$ReactorDeferringLoadBalancerFilterConfig' of type [org.springframework.cloud.client.loadbalancer.reactive.LoadBalancerBeanPostProcessorAutoConfiguration$ReactorDeferringLoadBalancerFilterConfig] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 14:58:52.140 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'reactorDeferringLoadBalancerExchangeFilterFunction' of type [org.springframework.cloud.client.loadbalancer.reactive.DeferringLoadBalancerExchangeFilterFunction] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 14:58:52.577 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat initialized with port(s): 8080 (http)
2025-05-09 14:58:52.601 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - Initializing ProtocolHandler ["http-nio-8080"]
2025-05-09 14:58:52.603 [main] INFO  org.apache.catalina.core.StandardService - Starting service [Tomcat]
2025-05-09 14:58:52.604 [main] INFO  org.apache.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.15]
2025-05-09 14:58:53.159 [main] INFO  org.hibernate.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-05-09 14:58:53.225 [main] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.1.7.Final
2025-05-09 14:58:53.609 [main] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} inited
2025-05-09 14:58:53.806 [main] INFO  SQL dialect - HHH000400: Using dialect: org.hibernate.dialect.MySQL8Dialect
2025-05-09 14:58:53.808 [main] WARN  org.hibernate.orm.deprecation - HHH90000026: MySQL8Dialect has been deprecated; use org.hibernate.dialect.MySQLDialect instead
2025-05-09 14:58:54.125 [main] INFO  o.h.e.t.jta.platform.internal.JtaPlatformInitiator - HHH000490: Using JtaPlatform implementation: [org.hibernate.engine.transaction.jta.platform.internal.NoJtaPlatform]
2025-05-09 14:58:54.139 [main] INFO  o.s.orm.jpa.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-05-09 14:58:54.567 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-09 14:58:54.589 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-09 14:58:54.649 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-09 14:58:54.652 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-09 14:58:54.653 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-09 14:58:54.674 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-09 14:58:55.605 [main] INFO  com.bgpay.bgai.service.impl.UserServiceImpl - 初始化SSO配置: clientId=bgai-client-id, redirectUri=http://localhost:8080/api/auth/callback
2025-05-09 14:58:55.724 [main] INFO  com.bgpay.bgai.controller.AuthController - 初始化认证控制器: clientId=bgai-client-id, redirectUri=http://localhost:8080/api/auth/callback
2025-05-09 14:58:56.850 [main] INFO  o.a.r.s.autoconfigure.RocketMQAutoConfiguration - a producer (billing-producer-group) init on namesrv 8.133.246.113:9876
2025-05-09 14:58:57.793 [main] INFO  org.redisson.Version - Redisson 3.24.3
2025-05-09 14:58:57.948 [redisson-netty-4-6] INFO  o.r.connection.pool.MasterPubSubConnectionPool - 1 connections initialized for 8.133.246.113/8.133.246.113:6379
2025-05-09 14:58:58.251 [redisson-netty-4-19] INFO  org.redisson.connection.pool.MasterConnectionPool - 24 connections initialized for 8.133.246.113/8.133.246.113:6379
2025-05-09 14:58:58.560 [main] INFO  com.bgpay.bgai.service.mq.MQConsumerService - MQ consumer startup successful [group=billing-consumer-group, topic=BILLING_TOPIC, tag=USER_BILLING]
2025-05-09 14:58:59.876 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [After]
2025-05-09 14:58:59.876 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Before]
2025-05-09 14:58:59.876 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Between]
2025-05-09 14:58:59.876 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Cookie]
2025-05-09 14:58:59.876 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Header]
2025-05-09 14:58:59.876 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Host]
2025-05-09 14:58:59.876 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Method]
2025-05-09 14:58:59.876 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Path]
2025-05-09 14:58:59.876 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Query]
2025-05-09 14:58:59.876 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [ReadBody]
2025-05-09 14:58:59.876 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [RemoteAddr]
2025-05-09 14:58:59.876 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [XForwardedRemoteAddr]
2025-05-09 14:58:59.876 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Weight]
2025-05-09 14:58:59.876 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [CloudFoundryRouteService]
2025-05-09 14:59:01.190 [main] INFO  o.s.b.actuate.endpoint.web.EndpointLinksResolver - Exposing 1 endpoint(s) beneath base path '/actuator'
2025-05-09 14:59:02.882 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - Starting ProtocolHandler ["http-nio-8080"]
2025-05-09 14:59:02.898 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat started on port(s): 8080 (http) with context path ''
2025-05-09 14:59:02.908 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from ans.namespace attribute : null
2025-05-09 14:59:02.909 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from ALIBABA_ALIWARE_NAMESPACE attribute :null
2025-05-09 14:59:02.909 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from namespace attribute :null
2025-05-09 14:59:02.926 [main] INFO  c.a.n.p.auth.spi.client.ClientAuthPluginManager - [ClientAuthPluginManager] Load ClientAuthService com.alibaba.nacos.client.auth.impl.NacosClientAuthServiceImpl success.
2025-05-09 14:59:02.926 [main] INFO  c.a.n.p.auth.spi.client.ClientAuthPluginManager - [ClientAuthPluginManager] Load ClientAuthService com.alibaba.nacos.client.auth.ram.RamClientAuthServiceImpl success.
2025-05-09 14:59:02.931 [main] INFO  com.alibaba.nacos.common.remote.client - [RpcClientFactory] create a new rpc client of b7905774-152d-4a53-a599-75266eef7d41
2025-05-09 14:59:02.933 [main] INFO  com.alibaba.nacos.common.remote.client - [b7905774-152d-4a53-a599-75266eef7d41] RpcClient init, ServerListFactory = com.alibaba.nacos.client.naming.core.ServerListManager
2025-05-09 14:59:02.934 [main] INFO  com.alibaba.nacos.common.remote.client - [b7905774-152d-4a53-a599-75266eef7d41] Registry connection listener to current client:com.alibaba.nacos.client.naming.remote.gprc.redo.NamingGrpcRedoService
2025-05-09 14:59:02.934 [main] INFO  com.alibaba.nacos.common.remote.client - [b7905774-152d-4a53-a599-75266eef7d41] Register server push request handler:com.alibaba.nacos.client.naming.remote.gprc.NamingPushRequestHandler
2025-05-09 14:59:02.935 [main] INFO  com.alibaba.nacos.common.remote.client - [b7905774-152d-4a53-a599-75266eef7d41] Try to connect to server on start up, server: {serverIp = '8.133.246.113', server main port = 8848}
2025-05-09 14:59:02.935 [main] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - grpc client connection server:8.133.246.113 ip,serverPort:9848,grpcTslConfig:{"sslProvider":"OPENSSL","enableTls":false,"mutualAuthEnable":false,"trustAll":false}
2025-05-09 14:59:03.075 [main] INFO  com.alibaba.nacos.common.remote.client - [b7905774-152d-4a53-a599-75266eef7d41] Success to connect to server [8.133.246.113:8848] on start up, connectionId = 1746773942865_139.227.195.203_42001
2025-05-09 14:59:03.075 [com.alibaba.nacos.client.remote.worker] INFO  com.alibaba.nacos.common.remote.client - [b7905774-152d-4a53-a599-75266eef7d41] Notify connected event to listeners.
2025-05-09 14:59:03.076 [com.alibaba.nacos.client.remote.worker] INFO  com.alibaba.nacos.client.naming - Grpc connection connect
2025-05-09 14:59:03.075 [main] INFO  com.alibaba.nacos.common.remote.client - [b7905774-152d-4a53-a599-75266eef7d41] Register server push request handler:com.alibaba.nacos.common.remote.client.RpcClient$ConnectResetRequestHandler
2025-05-09 14:59:03.076 [main] INFO  com.alibaba.nacos.common.remote.client - [b7905774-152d-4a53-a599-75266eef7d41] Register server push request handler:com.alibaba.nacos.common.remote.client.RpcClient$$Lambda/0x000001ddc4530220
2025-05-09 14:59:03.078 [main] INFO  com.alibaba.nacos.client.naming - [REGISTER-SERVICE] d750d92e-152f-4055-a641-3bc9dda85a29 registering service bgai with instance Instance{instanceId='null', ip='192.168.86.8', port=8080, weight=1.0, healthy=true, enabled=true, ephemeral=true, clusterName='DEFAULT', serviceName='null', metadata={IPv6=[2408:820c:7528:8342:f58d:7611:59f6:9fab], preserved.register.source=SPRING_CLOUD}}
2025-05-09 14:59:03.120 [main] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - nacos registry, DEFAULT_GROUP bgai 192.168.86.8:8080 register finished
2025-05-09 14:59:03.224 [main] INFO  com.bgpay.bgai.BgaiApplication - Started BgaiApplication in 20.862 seconds (process running for 23.607)
2025-05-09 14:59:03.235 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-09 14:59:03.235 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-09 14:59:03.249 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-09 14:59:03.250 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-09 14:59:03.250 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-09 14:59:03.266 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-09 14:59:03.266 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-09 14:59:03.267 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-09 14:59:03.274 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-09 14:59:03.276 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-09 14:59:03.277 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-09 14:59:03.285 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-09 14:59:03.290 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - nacos.cache.data.init.snapshot = true 
2025-05-09 14:59:03.291 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] common-dev.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-09 14:59:03.305 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=common-dev.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-09 14:59:03.306 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=common-dev.yaml, group=DEFAULT_GROUP
2025-05-09 14:59:03.308 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-09 14:59:03.309 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-09 14:59:03.309 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai.yaml, group=DEFAULT_GROUP
2025-05-09 14:59:03.310 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai-dev.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-09 14:59:03.310 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai-dev.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-09 14:59:03.310 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai-dev.yaml, group=DEFAULT_GROUP
2025-05-09 14:59:03.310 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-09 14:59:03.310 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai, group=DEFAULT_GROUP, cnt=1
2025-05-09 14:59:03.310 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai, group=DEFAULT_GROUP
2025-05-09 14:59:03.644 [RMI TCP Connection(4)-192.168.86.8] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-2} inited
2025-05-09 14:59:56.268 [http-nio-8080-exec-3] DEBUG c.bgpay.bgai.mapper.UserMapper.findByAccessToken - ==>  Preparing: SELECT * FROM t_user WHERE access_token = ? AND token_expire_time > NOW()
2025-05-09 14:59:56.270 [http-nio-8080-exec-3] DEBUG c.bgpay.bgai.mapper.UserMapper.findByAccessToken - ==> Parameters: 8c3246e3-2326-4286-a289-f770344eda02(String)
2025-05-09 14:59:56.300 [http-nio-8080-exec-3] DEBUG c.bgpay.bgai.mapper.UserMapper.findByAccessToken - <==      Total: 0
2025-05-09 14:59:56.303 [http-nio-8080-exec-3] INFO  com.bgpay.bgai.service.impl.UserServiceImpl - 为测试令牌创建临时用户: 8c3246e3-2326-4286-a289-f770344eda02
2025-05-09 14:59:56.321 [http-nio-8080-exec-3] INFO  com.bgpay.bgai.controller.SimpleAuthController - 生成测试令牌: 8c3246e3-2326-4286-a289-f770344eda02
2025-05-09 15:00:28.347 [http-nio-8080-exec-4] INFO  com.bgpay.bgai.controller.ReactiveChatController - Received chat request: question = null, file = none, modelName = null, multiTurn = false
2025-05-09 15:00:28.349 [http-nio-8080-exec-4] INFO  com.bgpay.bgai.controller.ReactiveChatController - Processing request for user ID: test-user-8c3246e3
2025-05-09 15:00:28.349 [http-nio-8080-exec-4] ERROR com.bgpay.bgai.controller.ReactiveChatController - Both file and question are empty
2025-05-09 15:00:39.018 [http-nio-8080-exec-6] INFO  com.bgpay.bgai.controller.ReactiveChatController - Received chat request: question = null, file = 新文件 17.txt, modelName = null, multiTurn = false
2025-05-09 15:00:39.018 [http-nio-8080-exec-6] INFO  com.bgpay.bgai.controller.ReactiveChatController - Processing request for user ID: test-user-8c3246e3
2025-05-09 15:00:39.018 [http-nio-8080-exec-6] INFO  com.bgpay.bgai.controller.ReactiveChatController - Processing file with circuit breaker: fileName=新文件 17.txt, question=
2025-05-09 15:00:39.020 [http-nio-8080-exec-6] INFO  com.bgpay.bgai.config.ReactiveFileProcessor - Processing file: 新文件 17.txt, content-type: text/plain
2025-05-09 15:00:39.030 [http-nio-8080-exec-6] INFO  com.bgpay.bgai.controller.ReactiveChatController - PARAM TRACE [test-user-8c3246e3]: 尝试查找匹配配置 - 参数: apiUrl=null, modelName=null
2025-05-09 15:00:39.053 [http-nio-8080-exec-6] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 查询配置 - userId=test-user-8c3246e3
2025-05-09 15:00:39.053 [http-nio-8080-exec-6] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 排序方式 - 按ID降序
2025-05-09 15:00:39.057 [http-nio-8080-exec-6] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 限制结果数 - LIMIT 1
2025-05-09 15:00:39.262 [http-nio-8080-exec-6] DEBUG com.bgpay.bgai.mapper.ApiConfigMapper.selectList - ==>  Preparing: SELECT id,api_url,api_key,model_name,user_id FROM api_config WHERE (user_id = ?) ORDER BY id DESC LIMIT 1
2025-05-09 15:00:39.263 [http-nio-8080-exec-6] DEBUG com.bgpay.bgai.mapper.ApiConfigMapper.selectList - ==> Parameters: test-user-8c3246e3(String)
2025-05-09 15:00:39.283 [http-nio-8080-exec-6] DEBUG com.bgpay.bgai.mapper.ApiConfigMapper.selectList - <==      Total: 0
2025-05-09 15:00:39.284 [http-nio-8080-exec-6] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 查询结果 - 未找到匹配配置
2025-05-09 15:00:39.284 [http-nio-8080-exec-6] INFO  com.bgpay.bgai.controller.ReactiveChatController - PARAM TRACE [test-user-8c3246e3]: 未提供任何参数，尝试获取最新配置
2025-05-09 15:00:39.285 [http-nio-8080-exec-6] DEBUG com.bgpay.bgai.mapper.ApiConfigMapper.selectList - ==>  Preparing: SELECT id,api_url,api_key,model_name,user_id FROM api_config WHERE (user_id = ?) ORDER BY id DESC
2025-05-09 15:00:39.286 [http-nio-8080-exec-6] DEBUG com.bgpay.bgai.mapper.ApiConfigMapper.selectList - ==> Parameters: test-user-8c3246e3(String)
2025-05-09 15:00:39.295 [http-nio-8080-exec-6] DEBUG com.bgpay.bgai.mapper.ApiConfigMapper.selectList - <==      Total: 0
2025-05-09 15:00:39.296 [http-nio-8080-exec-6] WARN  com.bgpay.bgai.controller.ReactiveChatController - PARAM TRACE [test-user-8c3246e3]: 未找到匹配的API配置 - 原始请求参数: apiUrl=null, modelName=null
2025-05-09 15:00:39.304 [http-nio-8080-exec-6] ERROR com.bgpay.bgai.controller.ReactiveChatController - PARAM TRACE [test-user-8c3246e3]: 配置解析失败 - 未找到匹配的API配置
java.lang.IllegalArgumentException: 未找到匹配的API配置
	at com.bgpay.bgai.controller.ReactiveChatController.lambda$20(ReactiveChatController.java:381)
	Suppressed: reactor.core.publisher.FluxOnAssembly$OnAssemblyException: 
Assembly trace from producer [reactor.core.publisher.MonoCallable] :
	reactor.core.publisher.Mono.fromCallable(Mono.java:515)
	com.bgpay.bgai.controller.ReactiveChatController.resolveApiConfigReactive(ReactiveChatController.java:332)
Error has been observed at the following site(s):
	*___Mono.fromCallable ⇢ at com.bgpay.bgai.controller.ReactiveChatController.resolveApiConfigReactive(ReactiveChatController.java:332)
	|_ Mono.switchIfEmpty ⇢ at com.bgpay.bgai.controller.ReactiveChatController.resolveApiConfigReactive(ReactiveChatController.java:383)
Original Stack Trace:
		at com.bgpay.bgai.controller.ReactiveChatController.lambda$20(ReactiveChatController.java:381)
		at reactor.core.publisher.MonoCallable$MonoCallableSubscription.request(MonoCallable.java:137)
		at reactor.core.publisher.Operators$MultiSubscriptionSubscriber.set(Operators.java:2341)
		at reactor.core.publisher.Operators$MultiSubscriptionSubscriber.onSubscribe(Operators.java:2215)
		at reactor.core.publisher.MonoCallable.subscribe(MonoCallable.java:48)
		at reactor.core.publisher.InternalMonoOperator.subscribe(InternalMonoOperator.java:64)
		at reactor.core.publisher.MonoFlatMap$FlatMapMain.onNext(MonoFlatMap.java:165)
		at reactor.core.publisher.FluxSwitchIfEmpty$SwitchIfEmptySubscriber.onNext(FluxSwitchIfEmpty.java:74)
		at reactor.core.publisher.Operators$ScalarSubscription.request(Operators.java:2545)
		at reactor.core.publisher.Operators$MultiSubscriptionSubscriber.set(Operators.java:2341)
		at reactor.core.publisher.Operators$MultiSubscriptionSubscriber.onSubscribe(Operators.java:2215)
		at reactor.core.publisher.MonoJust.subscribe(MonoJust.java:55)
		at reactor.core.publisher.InternalMonoOperator.subscribe(InternalMonoOperator.java:64)
		at reactor.core.publisher.MonoFlatMap$FlatMapMain.onNext(MonoFlatMap.java:165)
		at reactor.core.publisher.FluxOnErrorResume$ResumeSubscriber.onNext(FluxOnErrorResume.java:79)
		at reactor.core.publisher.FluxPeekFuseable$PeekFuseableSubscriber.onNext(FluxPeekFuseable.java:210)
		at reactor.core.publisher.FluxPeekFuseable$PeekFuseableSubscriber.onNext(FluxPeekFuseable.java:210)
		at reactor.core.publisher.MonoIgnoreThen$ThenIgnoreMain.complete(MonoIgnoreThen.java:292)
		at reactor.core.publisher.MonoIgnoreThen$ThenIgnoreMain.onNext(MonoIgnoreThen.java:187)
		at reactor.core.publisher.MonoFlatMap$FlatMapMain.onNext(MonoFlatMap.java:158)
		at reactor.core.publisher.MonoZip$ZipCoordinator.signal(MonoZip.java:293)
		at reactor.core.publisher.MonoZip$ZipInner.onNext(MonoZip.java:474)
		at reactor.core.publisher.MonoPeekTerminal$MonoTerminalPeekSubscriber.onNext(MonoPeekTerminal.java:180)
		at reactor.core.publisher.FluxDefaultIfEmpty$DefaultIfEmptySubscriber.onNext(FluxDefaultIfEmpty.java:122)
		at reactor.core.publisher.FluxMapFuseable$MapFuseableSubscriber.onNext(FluxMapFuseable.java:129)
		at reactor.core.publisher.MonoNext$NextSubscriber.onNext(MonoNext.java:82)
		at reactor.core.publisher.FluxFlattenIterable$FlattenIterableSubscriber.drainAsync(FluxFlattenIterable.java:453)
		at reactor.core.publisher.FluxFlattenIterable$FlattenIterableSubscriber.drain(FluxFlattenIterable.java:724)
		at reactor.core.publisher.FluxFlattenIterable$FlattenIterableSubscriber.onNext(FluxFlattenIterable.java:256)
		at reactor.core.publisher.Operators$MonoSubscriber.complete(Operators.java:1839)
		at reactor.core.publisher.MonoCacheTime$CoordinatorSubscriber.signalCached(MonoCacheTime.java:337)
		at reactor.core.publisher.MonoCacheTime$CoordinatorSubscriber.onNext(MonoCacheTime.java:354)
		at reactor.core.publisher.FluxSwitchIfEmpty$SwitchIfEmptySubscriber.onNext(FluxSwitchIfEmpty.java:74)
		at reactor.core.publisher.FluxPeekFuseable$PeekFuseableSubscriber.onNext(FluxPeekFuseable.java:210)
		at reactor.core.publisher.FluxMapFuseable$MapFuseableSubscriber.onNext(FluxMapFuseable.java:129)
		at reactor.core.publisher.FluxPeekFuseable$PeekFuseableSubscriber.onNext(FluxPeekFuseable.java:210)
		at reactor.core.publisher.Operators$BaseFluxToMonoOperator.completePossiblyEmpty(Operators.java:2071)
		at reactor.core.publisher.MonoCollect$CollectSubscriber.onComplete(MonoCollect.java:145)
		at reactor.core.publisher.FluxConcatMapNoPrefetch$FluxConcatMapNoPrefetchSubscriber.onComplete(FluxConcatMapNoPrefetch.java:240)
		at reactor.core.publisher.FluxWindowPredicate$WindowPredicateMain.checkTerminated(FluxWindowPredicate.java:540)
		at reactor.core.publisher.FluxWindowPredicate$WindowPredicateMain.drainLoop(FluxWindowPredicate.java:488)
		at reactor.core.publisher.FluxWindowPredicate$WindowPredicateMain.drain(FluxWindowPredicate.java:432)
		at reactor.core.publisher.FluxWindowPredicate$WindowPredicateMain.onComplete(FluxWindowPredicate.java:312)
		at reactor.core.publisher.FluxCreate$BaseSink.complete(FluxCreate.java:463)
		at reactor.core.publisher.FluxCreate$BufferAsyncSink.drain(FluxCreate.java:869)
		at reactor.core.publisher.FluxCreate$BufferAsyncSink.complete(FluxCreate.java:817)
		at reactor.core.publisher.FluxCreate$SerializedFluxSink.drainLoop(FluxCreate.java:247)
		at reactor.core.publisher.FluxCreate$SerializedFluxSink.drain(FluxCreate.java:213)
		at reactor.core.publisher.FluxCreate$SerializedFluxSink.complete(FluxCreate.java:204)
		at org.springframework.http.codec.multipart.MultipartParser.emitComplete(MultipartParser.java:185)
		at org.springframework.http.codec.multipart.MultipartParser$HeadersState.onNext(MultipartParser.java:383)
		at org.springframework.http.codec.multipart.MultipartParser.changeState(MultipartParser.java:149)
		at org.springframework.http.codec.multipart.MultipartParser$BodyState.onNext(MultipartParser.java:563)
		at org.springframework.http.codec.multipart.MultipartParser.changeState(MultipartParser.java:149)
		at org.springframework.http.codec.multipart.MultipartParser$HeadersState.onNext(MultipartParser.java:398)
		at org.springframework.http.codec.multipart.MultipartParser.changeState(MultipartParser.java:149)
		at org.springframework.http.codec.multipart.MultipartParser$BodyState.onNext(MultipartParser.java:563)
		at org.springframework.http.codec.multipart.MultipartParser.changeState(MultipartParser.java:149)
		at org.springframework.http.codec.multipart.MultipartParser$HeadersState.onNext(MultipartParser.java:398)
		at org.springframework.http.codec.multipart.MultipartParser.changeState(MultipartParser.java:149)
		at org.springframework.http.codec.multipart.MultipartParser$BodyState.onNext(MultipartParser.java:563)
		at org.springframework.http.codec.multipart.MultipartParser.hookOnNext(MultipartParser.java:120)
		at org.springframework.http.codec.multipart.MultipartParser.hookOnNext(MultipartParser.java:52)
		at reactor.core.publisher.BaseSubscriber.onNext(BaseSubscriber.java:160)
		at org.springframework.http.server.reactive.AbstractListenerReadPublisher.readAndPublish(AbstractListenerReadPublisher.java:209)
		at org.springframework.http.server.reactive.AbstractListenerReadPublisher$State$4.onDataAvailable(AbstractListenerReadPublisher.java:391)
		at org.springframework.http.server.reactive.AbstractListenerReadPublisher.onDataAvailable(AbstractListenerReadPublisher.java:122)
		at org.springframework.http.server.reactive.ServletServerHttpRequest$RequestBodyPublisher$RequestBodyPublisherReadListener.onDataAvailable(ServletServerHttpRequest.java:347)
		at org.apache.coyote.Request.onDataAvailable(Request.java:272)
		at org.apache.catalina.connector.CoyoteAdapter.asyncDispatch(CoyoteAdapter.java:202)
		at org.apache.coyote.AbstractProcessor.dispatch(AbstractProcessor.java:243)
		at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:50)
		at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
		at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744)
		at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
		at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
		at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
		at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
		at java.base/java.lang.Thread.run(Thread.java:1583)
2025-05-09 15:00:39.307 [http-nio-8080-exec-6] ERROR com.bgpay.bgai.controller.ReactiveChatController - API configuration error: 未找到匹配的API配置
2025-05-09 15:01:12.721 [http-nio-8080-exec-8] INFO  com.bgpay.bgai.controller.MockAuthController - Authorization request: client_id=bgai-client-id, redirect_uri=http://localhost:8080/api/auth/callback, response_type=code
2025-05-09 15:01:27.497 [http-nio-8080-exec-1] INFO  com.bgpay.bgai.controller.MockAuthController - Token request: grant_type=null, code=null, client_id=null
2025-05-09 15:01:27.515 [http-nio-8080-exec-10] DEBUG com.bgpay.bgai.mapper.UserMapper.findByUserId - ==>  Preparing: SELECT * FROM t_user WHERE user_id = ?
2025-05-09 15:01:27.515 [http-nio-8080-exec-10] DEBUG com.bgpay.bgai.mapper.UserMapper.findByUserId - ==> Parameters: 689258T(String)
2025-05-09 15:01:27.532 [http-nio-8080-exec-10] DEBUG com.bgpay.bgai.mapper.UserMapper.findByUserId - <==      Total: 1
2025-05-09 15:01:27.548 [http-nio-8080-exec-10] DEBUG com.bgpay.bgai.mapper.UserMapper.updateById - ==>  Preparing: UPDATE user SET user_id=?, username=?, email=?, avatar_url=?, last_login_time=?, access_token=?, refresh_token=?, token_expire_time=?, status=?, create_time=?, update_time=? WHERE id=?
2025-05-09 15:01:27.551 [http-nio-8080-exec-10] DEBUG com.bgpay.bgai.mapper.UserMapper.updateById - ==> Parameters: 689258T(String), 测试用户(String), test@example.com(String), https://ui-avatars.com/api/?name=测试用户(String), 2025-05-09T15:01:27.534613400(LocalDateTime), 24e3ffd5-964b-4a21-9107-2231dd6d41ef(String), f329c3ba-52f0-405d-8895-e2da79add6cb(String), 2025-05-09T16:01:27.534092600(LocalDateTime), 1(Integer), 2025-04-26T23:59:16(LocalDateTime), 2025-05-09T15:01:27.534613400(LocalDateTime), 1(Long)
2025-05-09 15:01:27.656 [http-nio-8080-exec-10] ERROR com.bgpay.bgai.service.impl.UserServiceImpl - SSO login failed
org.springframework.jdbc.BadSqlGrammarException: 
### Error updating database.  Cause: java.sql.SQLSyntaxErrorException: Table 'deepseek.user' doesn't exist
### The error may exist in com/bgpay/bgai/mapper/UserMapper.java (best guess)
### The error may involve com.bgpay.bgai.mapper.UserMapper.updateById-Inline
### The error occurred while setting parameters
### SQL: UPDATE user  SET user_id=?, username=?, email=?, avatar_url=?, last_login_time=?, access_token=?, refresh_token=?, token_expire_time=?, status=?, create_time=?, update_time=?  WHERE id=?
### Cause: java.sql.SQLSyntaxErrorException: Table 'deepseek.user' doesn't exist
; bad SQL grammar []
	at org.springframework.jdbc.support.SQLErrorCodeSQLExceptionTranslator.doTranslate(SQLErrorCodeSQLExceptionTranslator.java:246)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:73)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:92)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:439)
	at jdk.proxy2/jdk.proxy2.$Proxy147.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:288)
	at com.baomidou.mybatisplus.core.override.MybatisMapperMethod.execute(MybatisMapperMethod.java:64)
	at com.baomidou.mybatisplus.core.override.MybatisMapperProxy$PlainMethodInvoker.invoke(MybatisMapperProxy.java:152)
	at com.baomidou.mybatisplus.core.override.MybatisMapperProxy.invoke(MybatisMapperProxy.java:89)
	at jdk.proxy2/jdk.proxy2.$Proxy157.updateById(Unknown Source)
	at com.bgpay.bgai.service.impl.UserServiceImpl.loginWithSSO(UserServiceImpl.java:167)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:343)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:751)
	at org.springframework.aop.aspectj.AspectJAfterAdvice.invoke(AspectJAfterAdvice.java:49)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:173)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:751)
	at org.springframework.aop.framework.adapter.MethodBeforeAdviceInterceptor.invoke(MethodBeforeAdviceInterceptor.java:58)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:173)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:751)
	at org.springframework.transaction.interceptor.TransactionInterceptor$1.proceedWithInvocation(TransactionInterceptor.java:123)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:391)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:751)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:751)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:703)
	at com.bgpay.bgai.service.impl.UserServiceImpl$$SpringCGLIB$$0.loginWithSSO(<generated>)
	at com.bgpay.bgai.controller.AuthController.handleCallback(AuthController.java:72)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.web.reactive.result.method.InvocableHandlerMethod.lambda$invoke$0(InvocableHandlerMethod.java:145)
	at reactor.core.publisher.MonoFlatMap$FlatMapMain.onNext(MonoFlatMap.java:132)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onNext(FluxOnAssembly.java:539)
	at reactor.core.publisher.MonoZip$ZipCoordinator.signal(MonoZip.java:293)
	at reactor.core.publisher.MonoZip$ZipInner.onNext(MonoZip.java:474)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onNext(FluxOnAssembly.java:539)
	at reactor.core.publisher.MonoPeekTerminal$MonoTerminalPeekSubscriber.onNext(MonoPeekTerminal.java:180)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onNext(FluxOnAssembly.java:539)
	at reactor.core.publisher.FluxDefaultIfEmpty$DefaultIfEmptySubscriber.onNext(FluxDefaultIfEmpty.java:122)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onNext(FluxOnAssembly.java:539)
	at reactor.core.publisher.FluxSwitchIfEmpty$SwitchIfEmptySubscriber.onNext(FluxSwitchIfEmpty.java:74)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onNext(FluxOnAssembly.java:539)
	at reactor.core.publisher.Operators$ScalarSubscription.request(Operators.java:2545)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.request(FluxOnAssembly.java:649)
	at reactor.core.publisher.Operators$MultiSubscriptionSubscriber.set(Operators.java:2341)
	at reactor.core.publisher.Operators$MultiSubscriptionSubscriber.onSubscribe(Operators.java:2215)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onSubscribe(FluxOnAssembly.java:633)
	at reactor.core.publisher.FluxFlatMap.trySubscribeScalarMap(FluxFlatMap.java:192)
	at reactor.core.publisher.MonoFlatMap.subscribeOrReturn(MonoFlatMap.java:53)
	at reactor.core.publisher.InternalMonoOperator.subscribe(InternalMonoOperator.java:57)
	at reactor.core.publisher.MonoZip$ZipCoordinator.request(MonoZip.java:216)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.request(FluxOnAssembly.java:649)
	at reactor.core.publisher.MonoFlatMap$FlatMapMain.request(MonoFlatMap.java:194)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.request(FluxOnAssembly.java:649)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.request(FluxOnAssembly.java:649)
	at reactor.core.publisher.MonoIgnoreThen$ThenIgnoreMain.onSubscribe(MonoIgnoreThen.java:134)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onSubscribe(FluxOnAssembly.java:633)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onSubscribe(FluxOnAssembly.java:633)
	at reactor.core.publisher.MonoFlatMap$FlatMapMain.onSubscribe(MonoFlatMap.java:117)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onSubscribe(FluxOnAssembly.java:633)
	at reactor.core.publisher.MonoZip.subscribe(MonoZip.java:125)
	at reactor.core.publisher.InternalMonoOperator.subscribe(InternalMonoOperator.java:64)
	at reactor.core.publisher.MonoDefer.subscribe(MonoDefer.java:53)
	at reactor.core.publisher.InternalMonoOperator.subscribe(InternalMonoOperator.java:64)
	at reactor.core.publisher.MonoIgnoreThen$ThenIgnoreMain.subscribeNext(MonoIgnoreThen.java:240)
	at reactor.core.publisher.MonoIgnoreThen$ThenIgnoreMain.onComplete(MonoIgnoreThen.java:203)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onComplete(FluxOnAssembly.java:549)
	at reactor.core.publisher.MonoFlatMap$FlatMapMain.onComplete(MonoFlatMap.java:189)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onComplete(FluxOnAssembly.java:549)
	at reactor.core.publisher.Operators.complete(Operators.java:137)
	at reactor.core.publisher.MonoZip.subscribe(MonoZip.java:121)
	at reactor.core.publisher.Mono.subscribe(Mono.java:4495)
	at reactor.core.publisher.MonoIgnoreThen$ThenIgnoreMain.subscribeNext(MonoIgnoreThen.java:263)
	at reactor.core.publisher.MonoIgnoreThen.subscribe(MonoIgnoreThen.java:51)
	at reactor.core.publisher.InternalMonoOperator.subscribe(InternalMonoOperator.java:64)
	at reactor.core.publisher.MonoFlatMap$FlatMapMain.onNext(MonoFlatMap.java:165)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onNext(FluxOnAssembly.java:539)
	at reactor.core.publisher.FluxOnErrorResume$ResumeSubscriber.onNext(FluxOnErrorResume.java:79)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onNext(FluxOnAssembly.java:539)
	at reactor.core.publisher.FluxSwitchIfEmpty$SwitchIfEmptySubscriber.onNext(FluxSwitchIfEmpty.java:74)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onNext(FluxOnAssembly.java:539)
	at reactor.core.publisher.MonoNext$NextSubscriber.onNext(MonoNext.java:82)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onNext(FluxOnAssembly.java:539)
	at reactor.core.publisher.FluxConcatMapNoPrefetch$FluxConcatMapNoPrefetchSubscriber.innerNext(FluxConcatMapNoPrefetch.java:258)
	at reactor.core.publisher.FluxConcatMap$ConcatMapInner.onNext(FluxConcatMap.java:863)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onNext(FluxOnAssembly.java:539)
	at reactor.core.publisher.FluxMapFuseable$MapFuseableSubscriber.onNext(FluxMapFuseable.java:129)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onNext(FluxOnAssembly.java:539)
	at reactor.core.publisher.MonoPeekTerminal$MonoTerminalPeekSubscriber.onNext(MonoPeekTerminal.java:180)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onNext(FluxOnAssembly.java:539)
	at reactor.core.publisher.Operators$ScalarSubscription.request(Operators.java:2545)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.request(FluxOnAssembly.java:649)
	at reactor.core.publisher.MonoPeekTerminal$MonoTerminalPeekSubscriber.request(MonoPeekTerminal.java:139)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.request(FluxOnAssembly.java:649)
	at reactor.core.publisher.FluxMapFuseable$MapFuseableSubscriber.request(FluxMapFuseable.java:171)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.request(FluxOnAssembly.java:649)
	at reactor.core.publisher.Operators$MultiSubscriptionSubscriber.request(Operators.java:2305)
	at reactor.core.publisher.FluxConcatMapNoPrefetch$FluxConcatMapNoPrefetchSubscriber.request(FluxConcatMapNoPrefetch.java:338)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.request(FluxOnAssembly.java:649)
	at reactor.core.publisher.MonoNext$NextSubscriber.request(MonoNext.java:108)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.request(FluxOnAssembly.java:649)
	at reactor.core.publisher.Operators$MultiSubscriptionSubscriber.set(Operators.java:2341)
	at reactor.core.publisher.Operators$MultiSubscriptionSubscriber.onSubscribe(Operators.java:2215)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onSubscribe(FluxOnAssembly.java:633)
	at reactor.core.publisher.MonoNext$NextSubscriber.onSubscribe(MonoNext.java:70)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onSubscribe(FluxOnAssembly.java:633)
	at reactor.core.publisher.FluxConcatMapNoPrefetch$FluxConcatMapNoPrefetchSubscriber.onSubscribe(FluxConcatMapNoPrefetch.java:164)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onSubscribe(FluxOnAssembly.java:633)
	at reactor.core.publisher.FluxIterable.subscribe(FluxIterable.java:201)
	at reactor.core.publisher.FluxIterable.subscribe(FluxIterable.java:83)
	at reactor.core.publisher.InternalMonoOperator.subscribe(InternalMonoOperator.java:64)
	at reactor.core.publisher.MonoDefer.subscribe(MonoDefer.java:53)
	at reactor.core.publisher.InternalMonoOperator.subscribe(InternalMonoOperator.java:64)
	at reactor.core.publisher.MonoDefer.subscribe(MonoDefer.java:53)
	at reactor.core.publisher.InternalMonoOperator.subscribe(InternalMonoOperator.java:64)
	at reactor.core.publisher.MonoDefer.subscribe(MonoDefer.java:53)
	at reactor.core.publisher.InternalMonoOperator.subscribe(InternalMonoOperator.java:64)
	at reactor.core.publisher.MonoDefer.subscribe(MonoDefer.java:53)
	at reactor.core.publisher.InternalMonoOperator.subscribe(InternalMonoOperator.java:64)
	at reactor.core.publisher.MonoDefer.subscribe(MonoDefer.java:53)
	at reactor.core.publisher.InternalMonoOperator.subscribe(InternalMonoOperator.java:64)
	at reactor.core.publisher.MonoDefer.subscribe(MonoDefer.java:53)
	at reactor.core.publisher.InternalMonoOperator.subscribe(InternalMonoOperator.java:64)
	at reactor.core.publisher.MonoDefer.subscribe(MonoDefer.java:53)
	at reactor.core.publisher.Mono.subscribe(Mono.java:4495)
	at reactor.core.publisher.MonoIgnoreThen$ThenIgnoreMain.subscribeNext(MonoIgnoreThen.java:263)
	at reactor.core.publisher.MonoIgnoreThen.subscribe(MonoIgnoreThen.java:51)
	at reactor.core.publisher.Mono.subscribe(Mono.java:4495)
	at reactor.core.publisher.MonoIgnoreThen$ThenIgnoreMain.subscribeNext(MonoIgnoreThen.java:263)
	at reactor.core.publisher.MonoIgnoreThen.subscribe(MonoIgnoreThen.java:51)
	at reactor.core.publisher.Mono.subscribe(Mono.java:4495)
	at org.springframework.http.server.reactive.ServletHttpHandlerAdapter.service(ServletHttpHandlerAdapter.java:199)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:340)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.base/java.lang.Thread.run(Thread.java:1583)
Caused by: java.sql.SQLSyntaxErrorException: Table 'deepseek.user' doesn't exist
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:121)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:916)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:354)
	at com.alibaba.druid.pool.DruidPooledPreparedStatement.execute(DruidPooledPreparedStatement.java:497)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:58)
	at jdk.proxy3/jdk.proxy3.$Proxy153.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:48)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:75)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:425)
	... 155 common frames omitted
2025-05-09 15:01:27.671 [http-nio-8080-exec-10] ERROR com.bgpay.bgai.controller.AuthController - SSO callback error
com.bgpay.bgai.exception.BillingException: SSO登录失败: 
### Error updating database.  Cause: java.sql.SQLSyntaxErrorException: Table 'deepseek.user' doesn't exist
### The error may exist in com/bgpay/bgai/mapper/UserMapper.java (best guess)
### The error may involve com.bgpay.bgai.mapper.UserMapper.updateById-Inline
### The error occurred while setting parameters
### SQL: UPDATE user  SET user_id=?, username=?, email=?, avatar_url=?, last_login_time=?, access_token=?, refresh_token=?, token_expire_time=?, status=?, create_time=?, update_time=?  WHERE id=?
### Cause: java.sql.SQLSyntaxErrorException: Table 'deepseek.user' doesn't exist
; bad SQL grammar []
	at com.bgpay.bgai.service.impl.UserServiceImpl.loginWithSSO(UserServiceImpl.java:192)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:343)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:751)
	at org.springframework.aop.aspectj.AspectJAfterAdvice.invoke(AspectJAfterAdvice.java:49)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:173)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:751)
	at org.springframework.aop.framework.adapter.MethodBeforeAdviceInterceptor.invoke(MethodBeforeAdviceInterceptor.java:58)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:173)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:751)
	at org.springframework.transaction.interceptor.TransactionInterceptor$1.proceedWithInvocation(TransactionInterceptor.java:123)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:391)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:751)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:751)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:703)
	at com.bgpay.bgai.service.impl.UserServiceImpl$$SpringCGLIB$$0.loginWithSSO(<generated>)
	at com.bgpay.bgai.controller.AuthController.handleCallback(AuthController.java:72)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.web.reactive.result.method.InvocableHandlerMethod.lambda$invoke$0(InvocableHandlerMethod.java:145)
	at reactor.core.publisher.MonoFlatMap$FlatMapMain.onNext(MonoFlatMap.java:132)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onNext(FluxOnAssembly.java:539)
	at reactor.core.publisher.MonoZip$ZipCoordinator.signal(MonoZip.java:293)
	at reactor.core.publisher.MonoZip$ZipInner.onNext(MonoZip.java:474)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onNext(FluxOnAssembly.java:539)
	at reactor.core.publisher.MonoPeekTerminal$MonoTerminalPeekSubscriber.onNext(MonoPeekTerminal.java:180)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onNext(FluxOnAssembly.java:539)
	at reactor.core.publisher.FluxDefaultIfEmpty$DefaultIfEmptySubscriber.onNext(FluxDefaultIfEmpty.java:122)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onNext(FluxOnAssembly.java:539)
	at reactor.core.publisher.FluxSwitchIfEmpty$SwitchIfEmptySubscriber.onNext(FluxSwitchIfEmpty.java:74)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onNext(FluxOnAssembly.java:539)
	at reactor.core.publisher.Operators$ScalarSubscription.request(Operators.java:2545)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.request(FluxOnAssembly.java:649)
	at reactor.core.publisher.Operators$MultiSubscriptionSubscriber.set(Operators.java:2341)
	at reactor.core.publisher.Operators$MultiSubscriptionSubscriber.onSubscribe(Operators.java:2215)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onSubscribe(FluxOnAssembly.java:633)
	at reactor.core.publisher.FluxFlatMap.trySubscribeScalarMap(FluxFlatMap.java:192)
	at reactor.core.publisher.MonoFlatMap.subscribeOrReturn(MonoFlatMap.java:53)
	at reactor.core.publisher.InternalMonoOperator.subscribe(InternalMonoOperator.java:57)
	at reactor.core.publisher.MonoZip$ZipCoordinator.request(MonoZip.java:216)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.request(FluxOnAssembly.java:649)
	at reactor.core.publisher.MonoFlatMap$FlatMapMain.request(MonoFlatMap.java:194)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.request(FluxOnAssembly.java:649)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.request(FluxOnAssembly.java:649)
	at reactor.core.publisher.MonoIgnoreThen$ThenIgnoreMain.onSubscribe(MonoIgnoreThen.java:134)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onSubscribe(FluxOnAssembly.java:633)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onSubscribe(FluxOnAssembly.java:633)
	at reactor.core.publisher.MonoFlatMap$FlatMapMain.onSubscribe(MonoFlatMap.java:117)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onSubscribe(FluxOnAssembly.java:633)
	at reactor.core.publisher.MonoZip.subscribe(MonoZip.java:125)
	at reactor.core.publisher.InternalMonoOperator.subscribe(InternalMonoOperator.java:64)
	at reactor.core.publisher.MonoDefer.subscribe(MonoDefer.java:53)
	at reactor.core.publisher.InternalMonoOperator.subscribe(InternalMonoOperator.java:64)
	at reactor.core.publisher.MonoIgnoreThen$ThenIgnoreMain.subscribeNext(MonoIgnoreThen.java:240)
	at reactor.core.publisher.MonoIgnoreThen$ThenIgnoreMain.onComplete(MonoIgnoreThen.java:203)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onComplete(FluxOnAssembly.java:549)
	at reactor.core.publisher.MonoFlatMap$FlatMapMain.onComplete(MonoFlatMap.java:189)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onComplete(FluxOnAssembly.java:549)
	at reactor.core.publisher.Operators.complete(Operators.java:137)
	at reactor.core.publisher.MonoZip.subscribe(MonoZip.java:121)
	at reactor.core.publisher.Mono.subscribe(Mono.java:4495)
	at reactor.core.publisher.MonoIgnoreThen$ThenIgnoreMain.subscribeNext(MonoIgnoreThen.java:263)
	at reactor.core.publisher.MonoIgnoreThen.subscribe(MonoIgnoreThen.java:51)
	at reactor.core.publisher.InternalMonoOperator.subscribe(InternalMonoOperator.java:64)
	at reactor.core.publisher.MonoFlatMap$FlatMapMain.onNext(MonoFlatMap.java:165)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onNext(FluxOnAssembly.java:539)
	at reactor.core.publisher.FluxOnErrorResume$ResumeSubscriber.onNext(FluxOnErrorResume.java:79)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onNext(FluxOnAssembly.java:539)
	at reactor.core.publisher.FluxSwitchIfEmpty$SwitchIfEmptySubscriber.onNext(FluxSwitchIfEmpty.java:74)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onNext(FluxOnAssembly.java:539)
	at reactor.core.publisher.MonoNext$NextSubscriber.onNext(MonoNext.java:82)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onNext(FluxOnAssembly.java:539)
	at reactor.core.publisher.FluxConcatMapNoPrefetch$FluxConcatMapNoPrefetchSubscriber.innerNext(FluxConcatMapNoPrefetch.java:258)
	at reactor.core.publisher.FluxConcatMap$ConcatMapInner.onNext(FluxConcatMap.java:863)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onNext(FluxOnAssembly.java:539)
	at reactor.core.publisher.FluxMapFuseable$MapFuseableSubscriber.onNext(FluxMapFuseable.java:129)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onNext(FluxOnAssembly.java:539)
	at reactor.core.publisher.MonoPeekTerminal$MonoTerminalPeekSubscriber.onNext(MonoPeekTerminal.java:180)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onNext(FluxOnAssembly.java:539)
	at reactor.core.publisher.Operators$ScalarSubscription.request(Operators.java:2545)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.request(FluxOnAssembly.java:649)
	at reactor.core.publisher.MonoPeekTerminal$MonoTerminalPeekSubscriber.request(MonoPeekTerminal.java:139)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.request(FluxOnAssembly.java:649)
	at reactor.core.publisher.FluxMapFuseable$MapFuseableSubscriber.request(FluxMapFuseable.java:171)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.request(FluxOnAssembly.java:649)
	at reactor.core.publisher.Operators$MultiSubscriptionSubscriber.request(Operators.java:2305)
	at reactor.core.publisher.FluxConcatMapNoPrefetch$FluxConcatMapNoPrefetchSubscriber.request(FluxConcatMapNoPrefetch.java:338)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.request(FluxOnAssembly.java:649)
	at reactor.core.publisher.MonoNext$NextSubscriber.request(MonoNext.java:108)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.request(FluxOnAssembly.java:649)
	at reactor.core.publisher.Operators$MultiSubscriptionSubscriber.set(Operators.java:2341)
	at reactor.core.publisher.Operators$MultiSubscriptionSubscriber.onSubscribe(Operators.java:2215)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onSubscribe(FluxOnAssembly.java:633)
	at reactor.core.publisher.MonoNext$NextSubscriber.onSubscribe(MonoNext.java:70)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onSubscribe(FluxOnAssembly.java:633)
	at reactor.core.publisher.FluxConcatMapNoPrefetch$FluxConcatMapNoPrefetchSubscriber.onSubscribe(FluxConcatMapNoPrefetch.java:164)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onSubscribe(FluxOnAssembly.java:633)
	at reactor.core.publisher.FluxIterable.subscribe(FluxIterable.java:201)
	at reactor.core.publisher.FluxIterable.subscribe(FluxIterable.java:83)
	at reactor.core.publisher.InternalMonoOperator.subscribe(InternalMonoOperator.java:64)
	at reactor.core.publisher.MonoDefer.subscribe(MonoDefer.java:53)
	at reactor.core.publisher.InternalMonoOperator.subscribe(InternalMonoOperator.java:64)
	at reactor.core.publisher.MonoDefer.subscribe(MonoDefer.java:53)
	at reactor.core.publisher.InternalMonoOperator.subscribe(InternalMonoOperator.java:64)
	at reactor.core.publisher.MonoDefer.subscribe(MonoDefer.java:53)
	at reactor.core.publisher.InternalMonoOperator.subscribe(InternalMonoOperator.java:64)
	at reactor.core.publisher.MonoDefer.subscribe(MonoDefer.java:53)
	at reactor.core.publisher.InternalMonoOperator.subscribe(InternalMonoOperator.java:64)
	at reactor.core.publisher.MonoDefer.subscribe(MonoDefer.java:53)
	at reactor.core.publisher.InternalMonoOperator.subscribe(InternalMonoOperator.java:64)
	at reactor.core.publisher.MonoDefer.subscribe(MonoDefer.java:53)
	at reactor.core.publisher.InternalMonoOperator.subscribe(InternalMonoOperator.java:64)
	at reactor.core.publisher.MonoDefer.subscribe(MonoDefer.java:53)
	at reactor.core.publisher.Mono.subscribe(Mono.java:4495)
	at reactor.core.publisher.MonoIgnoreThen$ThenIgnoreMain.subscribeNext(MonoIgnoreThen.java:263)
	at reactor.core.publisher.MonoIgnoreThen.subscribe(MonoIgnoreThen.java:51)
	at reactor.core.publisher.Mono.subscribe(Mono.java:4495)
	at reactor.core.publisher.MonoIgnoreThen$ThenIgnoreMain.subscribeNext(MonoIgnoreThen.java:263)
	at reactor.core.publisher.MonoIgnoreThen.subscribe(MonoIgnoreThen.java:51)
	at reactor.core.publisher.Mono.subscribe(Mono.java:4495)
	at org.springframework.http.server.reactive.ServletHttpHandlerAdapter.service(ServletHttpHandlerAdapter.java:199)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:340)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-05-09 15:03:07.074 [Thread-1] WARN  c.alibaba.nacos.common.http.HttpClientBeanHolder - [HttpClientBeanHolder] Start destroying common HttpClient
2025-05-09 15:03:07.074 [Thread-7] WARN  com.alibaba.nacos.common.notify.NotifyCenter - [NotifyCenter] Start destroying Publisher
2025-05-09 15:03:07.075 [Thread-7] WARN  com.alibaba.nacos.common.notify.NotifyCenter - [NotifyCenter] Destruction of the end
2025-05-09 15:03:07.076 [Thread-1] WARN  c.alibaba.nacos.common.http.HttpClientBeanHolder - [HttpClientBeanHolder] Destruction of the end
2025-05-09 15:03:07.094 [SpringApplicationShutdownHook] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - De-registering from Nacos Server now...
2025-05-09 15:03:07.094 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - [DEREGISTER-SERVICE] d750d92e-152f-4055-a641-3bc9dda85a29 deregistering service bgai with instance: Instance{instanceId='null', ip='192.168.86.8', port=8080, weight=1.0, healthy=true, enabled=true, ephemeral=true, clusterName='DEFAULT', serviceName='null', metadata={}}
2025-05-09 15:03:07.104 [SpringApplicationShutdownHook] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - De-registration finished.
2025-05-09 15:03:07.105 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.cache.ServiceInfoHolder do shutdown begin
2025-05-09 15:03:07.105 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.backups.FailoverReactor do shutdown begin
2025-05-09 15:03:07.105 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.backups.FailoverReactor do shutdown stop
2025-05-09 15:03:07.105 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.cache.ServiceInfoHolder do shutdown stop
2025-05-09 15:03:07.105 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.NamingClientProxyDelegate do shutdown begin
2025-05-09 15:03:07.105 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServiceInfoUpdateService do shutdown begin
2025-05-09 15:03:07.105 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServiceInfoUpdateService do shutdown stop
2025-05-09 15:03:07.105 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServerListManager do shutdown begin
2025-05-09 15:03:07.105 [SpringApplicationShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Start destroying NacosRestTemplate
2025-05-09 15:03:07.105 [SpringApplicationShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Destruction of the end
2025-05-09 15:03:07.105 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServerListManager do shutdown stop
2025-05-09 15:03:07.105 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.http.NamingHttpClientProxy do shutdown begin
2025-05-09 15:03:07.105 [SpringApplicationShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Start destroying NacosRestTemplate
2025-05-09 15:03:07.106 [SpringApplicationShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Destruction of the end
2025-05-09 15:03:07.106 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.http.NamingHttpClientProxy do shutdown stop
2025-05-09 15:03:07.106 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Shutdown rpc client, set status to shutdown
2025-05-09 15:03:07.106 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Shutdown client event executor java.util.concurrent.ScheduledThreadPoolExecutor@342dc6d4[Running, pool size = 2, active threads = 2, queued tasks = 0, completed tasks = 0]
2025-05-09 15:03:07.106 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Close current connection 1746773942865_139.227.195.203_42001
2025-05-09 15:03:07.111 [nacos-grpc-client-executor-8.133.246.113-67] WARN  c.a.nacos.common.remote.client.grpc.GrpcClient - [1746773942865_139.227.195.203_42001]Ignore error event,isRunning:false,isAbandon=false
2025-05-09 15:03:07.113 [SpringApplicationShutdownHook] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - Shutdown grpc executor java.util.concurrent.ThreadPoolExecutor@3912e10b[Running, pool size = 4, active threads = 0, queued tasks = 0, completed tasks = 68]
2025-05-09 15:03:07.113 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - Shutdown grpc redo service executor java.util.concurrent.ScheduledThreadPoolExecutor@433b7810[Running, pool size = 1, active threads = 0, queued tasks = 1, completed tasks = 81]
2025-05-09 15:03:07.114 [SpringApplicationShutdownHook] INFO  c.a.n.client.auth.ram.identify.CredentialWatcher - [null] CredentialWatcher is stopped
2025-05-09 15:03:07.114 [SpringApplicationShutdownHook] INFO  c.a.n.client.auth.ram.identify.CredentialService - [null] CredentialService is freed
2025-05-09 15:03:07.114 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.NamingClientProxyDelegate do shutdown stop
2025-05-09 15:03:07.170 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:10911] result: true
2025-05-09 15:03:07.170 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:9876] result: true
2025-05-09 15:03:07.191 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:9876] result: true
2025-05-09 15:03:07.191 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:10911] result: true
2025-05-09 15:03:09.401 [SpringApplicationShutdownHook] INFO  o.s.orm.jpa.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-05-09 15:03:09.407 [SpringApplicationShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-2} closing ...
2025-05-09 15:03:09.413 [SpringApplicationShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-2} closed
2025-05-09 15:03:09.413 [SpringApplicationShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} closing ...
2025-05-09 15:03:09.414 [SpringApplicationShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} closed
2025-05-09 15:03:18.101 [main] WARN  com.alibaba.nacos.client.logging.NacosLogging - Load Logback Configuration of Nacos fail, message: Could not initialize Logback Nacos logging from classpath:nacos-logback.xml
2025-05-09 15:03:18.102 [main] INFO  com.bgpay.bgai.BgaiApplication - The following 1 profile is active: "dev"
2025-05-09 15:03:19.581 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-05-09 15:03:19.583 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-05-09 15:03:19.611 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 20 ms. Found 0 JPA repository interfaces.
2025-05-09 15:03:19.625 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-05-09 15:03:19.626 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-05-09 15:03:19.639 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 5 ms. Found 0 Redis repository interfaces.
2025-05-09 15:03:19.836 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'allowedFileTypeMapper' and 'com.bgpay.bgai.mapper.AllowedFileTypeMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 15:03:19.837 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'apiConfigMapper' and 'com.bgpay.bgai.mapper.ApiConfigMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 15:03:19.837 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'chatCompletionsMapper' and 'com.bgpay.bgai.mapper.ChatCompletionsMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 15:03:19.837 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'choicesMapper' and 'com.bgpay.bgai.mapper.ChoicesMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 15:03:19.837 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'fileTypeMapper' and 'com.bgpay.bgai.mapper.FileTypeMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 15:03:19.837 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'priceConfigMapper' and 'com.bgpay.bgai.mapper.PriceConfigMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 15:03:19.837 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'priceVersionMapper' and 'com.bgpay.bgai.mapper.PriceVersionMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 15:03:19.837 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'usageInfoMapper' and 'com.bgpay.bgai.mapper.UsageInfoMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 15:03:19.837 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'usageRecordMapper' and 'com.bgpay.bgai.mapper.UsageRecordMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 15:03:19.837 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'userMapper' and 'com.bgpay.bgai.mapper.UserMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 15:03:19.838 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - No MyBatis mapper was found in '[com.bgpay.bgai.mapper]' package. Please check your configuration.
2025-05-09 15:03:19.842 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'allowedFileTypeMapper' and 'com.bgpay.bgai.mapper.AllowedFileTypeMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 15:03:19.842 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'apiConfigMapper' and 'com.bgpay.bgai.mapper.ApiConfigMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 15:03:19.842 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'chatCompletionsMapper' and 'com.bgpay.bgai.mapper.ChatCompletionsMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 15:03:19.842 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'choicesMapper' and 'com.bgpay.bgai.mapper.ChoicesMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 15:03:19.842 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'fileTypeMapper' and 'com.bgpay.bgai.mapper.FileTypeMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 15:03:19.842 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'priceConfigMapper' and 'com.bgpay.bgai.mapper.PriceConfigMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 15:03:19.843 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'priceVersionMapper' and 'com.bgpay.bgai.mapper.PriceVersionMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 15:03:19.843 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'usageInfoMapper' and 'com.bgpay.bgai.mapper.UsageInfoMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 15:03:19.843 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'usageRecordMapper' and 'com.bgpay.bgai.mapper.UsageRecordMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 15:03:19.843 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'userMapper' and 'com.bgpay.bgai.mapper.UserMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 15:03:19.843 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - No MyBatis mapper was found in '[com.bgpay.bgai.mapper]' package. Please check your configuration.
2025-05-09 15:03:20.169 [main] INFO  o.springframework.cloud.context.scope.GenericScope - BeanFactory id=38ed5f2c-a148-3506-bdcb-f18d795b9667
2025-05-09 15:03:20.431 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'org.springframework.cloud.commons.config.CommonsConfigAutoConfiguration' of type [org.springframework.cloud.commons.config.CommonsConfigAutoConfiguration] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 15:03:20.437 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'org.springframework.cloud.client.loadbalancer.LoadBalancerDefaultMappingsProviderAutoConfiguration' of type [org.springframework.cloud.client.loadbalancer.LoadBalancerDefaultMappingsProviderAutoConfiguration] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 15:03:20.441 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'loadBalancerClientsDefaultsMappingsProvider' of type [org.springframework.cloud.client.loadbalancer.LoadBalancerDefaultMappingsProviderAutoConfiguration$$Lambda/0x000001aac97255c0] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 15:03:20.450 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'defaultsBindHandlerAdvisor' of type [org.springframework.cloud.commons.config.DefaultsBindHandlerAdvisor] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 15:03:20.494 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'spring.datasource.dynamic-com.baomidou.dynamic.datasource.spring.boot.autoconfigure.DynamicDataSourceProperties' of type [com.baomidou.dynamic.datasource.spring.boot.autoconfigure.DynamicDataSourceProperties] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 15:03:20.515 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'com.baomidou.dynamic.datasource.spring.boot.autoconfigure.DynamicDataSourceAutoConfiguration' of type [com.baomidou.dynamic.datasource.spring.boot.autoconfigure.DynamicDataSourceAutoConfiguration$$SpringCGLIB$$0] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 15:03:20.542 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'dsProcessor' of type [com.baomidou.dynamic.datasource.processor.jakarta.DsJakartaHeaderProcessor] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 15:03:20.920 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'messageConverterConfiguration' of type [org.apache.rocketmq.spring.autoconfigure.MessageConverterConfiguration$$SpringCGLIB$$0] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 15:03:20.980 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'createRocketMQMessageConverter' of type [org.apache.rocketmq.spring.support.RocketMQMessageConverter] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 15:03:20.989 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'rocketmq-org.apache.rocketmq.spring.autoconfigure.RocketMQProperties' of type [org.apache.rocketmq.spring.autoconfigure.RocketMQProperties] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 15:03:20.993 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'listenerContainerConfiguration' of type [org.apache.rocketmq.spring.autoconfigure.ListenerContainerConfiguration$$SpringCGLIB$$0] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 15:03:21.026 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'org.springframework.cloud.client.loadbalancer.reactive.LoadBalancerBeanPostProcessorAutoConfiguration' of type [org.springframework.cloud.client.loadbalancer.reactive.LoadBalancerBeanPostProcessorAutoConfiguration] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 15:03:21.029 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'org.springframework.cloud.client.loadbalancer.reactive.LoadBalancerBeanPostProcessorAutoConfiguration$ReactorDeferringLoadBalancerFilterConfig' of type [org.springframework.cloud.client.loadbalancer.reactive.LoadBalancerBeanPostProcessorAutoConfiguration$ReactorDeferringLoadBalancerFilterConfig] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 15:03:21.032 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'reactorDeferringLoadBalancerExchangeFilterFunction' of type [org.springframework.cloud.client.loadbalancer.reactive.DeferringLoadBalancerExchangeFilterFunction] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 15:03:21.394 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat initialized with port(s): 8080 (http)
2025-05-09 15:03:21.405 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - Initializing ProtocolHandler ["http-nio-8080"]
2025-05-09 15:03:21.407 [main] INFO  org.apache.catalina.core.StandardService - Starting service [Tomcat]
2025-05-09 15:03:21.408 [main] INFO  org.apache.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.15]
2025-05-09 15:03:21.939 [main] INFO  org.hibernate.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-05-09 15:03:22.005 [main] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.1.7.Final
2025-05-09 15:03:22.355 [main] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} inited
2025-05-09 15:03:22.542 [main] INFO  SQL dialect - HHH000400: Using dialect: org.hibernate.dialect.MySQL8Dialect
2025-05-09 15:03:22.545 [main] WARN  org.hibernate.orm.deprecation - HHH90000026: MySQL8Dialect has been deprecated; use org.hibernate.dialect.MySQLDialect instead
2025-05-09 15:03:22.849 [main] INFO  o.h.e.t.jta.platform.internal.JtaPlatformInitiator - HHH000490: Using JtaPlatform implementation: [org.hibernate.engine.transaction.jta.platform.internal.NoJtaPlatform]
2025-05-09 15:03:22.862 [main] INFO  o.s.orm.jpa.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-05-09 15:03:23.261 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-09 15:03:23.283 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-09 15:03:23.317 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-09 15:03:23.319 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-09 15:03:23.319 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-09 15:03:23.330 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-09 15:03:23.996 [main] INFO  com.bgpay.bgai.service.impl.UserServiceImpl - 初始化SSO配置: clientId=bgai-client-id, redirectUri=http://localhost:8080/api/auth/callback
2025-05-09 15:03:24.072 [main] INFO  com.bgpay.bgai.controller.AuthController - 初始化认证控制器: clientId=bgai-client-id, redirectUri=http://localhost:8080/api/auth/callback
2025-05-09 15:03:24.898 [main] INFO  o.a.r.s.autoconfigure.RocketMQAutoConfiguration - a producer (billing-producer-group) init on namesrv 8.133.246.113:9876
2025-05-09 15:03:25.789 [main] INFO  org.redisson.Version - Redisson 3.24.3
2025-05-09 15:03:25.932 [redisson-netty-4-6] INFO  o.r.connection.pool.MasterPubSubConnectionPool - 1 connections initialized for 8.133.246.113/8.133.246.113:6379
2025-05-09 15:03:26.263 [redisson-netty-4-19] INFO  org.redisson.connection.pool.MasterConnectionPool - 24 connections initialized for 8.133.246.113/8.133.246.113:6379
2025-05-09 15:03:26.625 [main] INFO  com.bgpay.bgai.service.mq.MQConsumerService - MQ consumer startup successful [group=billing-consumer-group, topic=BILLING_TOPIC, tag=USER_BILLING]
2025-05-09 15:03:28.476 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [After]
2025-05-09 15:03:28.476 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Before]
2025-05-09 15:03:28.476 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Between]
2025-05-09 15:03:28.476 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Cookie]
2025-05-09 15:03:28.476 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Header]
2025-05-09 15:03:28.476 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Host]
2025-05-09 15:03:28.476 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Method]
2025-05-09 15:03:28.476 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Path]
2025-05-09 15:03:28.476 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Query]
2025-05-09 15:03:28.476 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [ReadBody]
2025-05-09 15:03:28.477 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [RemoteAddr]
2025-05-09 15:03:28.477 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [XForwardedRemoteAddr]
2025-05-09 15:03:28.477 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Weight]
2025-05-09 15:03:28.477 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [CloudFoundryRouteService]
2025-05-09 15:03:29.810 [main] INFO  o.s.b.actuate.endpoint.web.EndpointLinksResolver - Exposing 1 endpoint(s) beneath base path '/actuator'
2025-05-09 15:03:31.158 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - Starting ProtocolHandler ["http-nio-8080"]
2025-05-09 15:03:31.171 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat started on port(s): 8080 (http) with context path ''
2025-05-09 15:03:31.181 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from ans.namespace attribute : null
2025-05-09 15:03:31.182 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from ALIBABA_ALIWARE_NAMESPACE attribute :null
2025-05-09 15:03:31.182 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from namespace attribute :null
2025-05-09 15:03:31.190 [main] INFO  c.a.n.p.auth.spi.client.ClientAuthPluginManager - [ClientAuthPluginManager] Load ClientAuthService com.alibaba.nacos.client.auth.impl.NacosClientAuthServiceImpl success.
2025-05-09 15:03:31.190 [main] INFO  c.a.n.p.auth.spi.client.ClientAuthPluginManager - [ClientAuthPluginManager] Load ClientAuthService com.alibaba.nacos.client.auth.ram.RamClientAuthServiceImpl success.
2025-05-09 15:03:31.193 [main] INFO  com.alibaba.nacos.common.remote.client - [RpcClientFactory] create a new rpc client of 71c19b13-b50c-4613-a483-8eaaa1452543
2025-05-09 15:03:31.195 [main] INFO  com.alibaba.nacos.common.remote.client - [71c19b13-b50c-4613-a483-8eaaa1452543] RpcClient init, ServerListFactory = com.alibaba.nacos.client.naming.core.ServerListManager
2025-05-09 15:03:31.195 [main] INFO  com.alibaba.nacos.common.remote.client - [71c19b13-b50c-4613-a483-8eaaa1452543] Registry connection listener to current client:com.alibaba.nacos.client.naming.remote.gprc.redo.NamingGrpcRedoService
2025-05-09 15:03:31.195 [main] INFO  com.alibaba.nacos.common.remote.client - [71c19b13-b50c-4613-a483-8eaaa1452543] Register server push request handler:com.alibaba.nacos.client.naming.remote.gprc.NamingPushRequestHandler
2025-05-09 15:03:31.196 [main] INFO  com.alibaba.nacos.common.remote.client - [71c19b13-b50c-4613-a483-8eaaa1452543] Try to connect to server on start up, server: {serverIp = '8.133.246.113', server main port = 8848}
2025-05-09 15:03:31.203 [main] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - grpc client connection server:8.133.246.113 ip,serverPort:9848,grpcTslConfig:{"sslProvider":"OPENSSL","enableTls":false,"mutualAuthEnable":false,"trustAll":false}
2025-05-09 15:03:31.341 [main] INFO  com.alibaba.nacos.common.remote.client - [71c19b13-b50c-4613-a483-8eaaa1452543] Success to connect to server [8.133.246.113:8848] on start up, connectionId = 1746774211130_139.227.195.203_42550
2025-05-09 15:03:31.341 [main] INFO  com.alibaba.nacos.common.remote.client - [71c19b13-b50c-4613-a483-8eaaa1452543] Register server push request handler:com.alibaba.nacos.common.remote.client.RpcClient$ConnectResetRequestHandler
2025-05-09 15:03:31.341 [com.alibaba.nacos.client.remote.worker] INFO  com.alibaba.nacos.common.remote.client - [71c19b13-b50c-4613-a483-8eaaa1452543] Notify connected event to listeners.
2025-05-09 15:03:31.341 [main] INFO  com.alibaba.nacos.common.remote.client - [71c19b13-b50c-4613-a483-8eaaa1452543] Register server push request handler:com.alibaba.nacos.common.remote.client.RpcClient$$Lambda/0x000001aac9525000
2025-05-09 15:03:31.341 [com.alibaba.nacos.client.remote.worker] INFO  com.alibaba.nacos.client.naming - Grpc connection connect
2025-05-09 15:03:31.342 [main] INFO  com.alibaba.nacos.client.naming - [REGISTER-SERVICE] d750d92e-152f-4055-a641-3bc9dda85a29 registering service bgai with instance Instance{instanceId='null', ip='192.168.86.8', port=8080, weight=1.0, healthy=true, enabled=true, ephemeral=true, clusterName='DEFAULT', serviceName='null', metadata={IPv6=[2408:820c:7528:8342:f58d:7611:59f6:9fab], preserved.register.source=SPRING_CLOUD}}
2025-05-09 15:03:31.441 [main] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - nacos registry, DEFAULT_GROUP bgai 192.168.86.8:8080 register finished
2025-05-09 15:03:31.514 [main] INFO  com.bgpay.bgai.BgaiApplication - Started BgaiApplication in 15.638 seconds (process running for 17.044)
2025-05-09 15:03:31.518 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-09 15:03:31.519 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-09 15:03:31.532 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-09 15:03:31.533 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-09 15:03:31.533 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-09 15:03:31.545 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-09 15:03:31.546 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-09 15:03:31.546 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-09 15:03:31.553 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-09 15:03:31.554 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-09 15:03:31.554 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-09 15:03:31.562 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-09 15:03:31.565 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - nacos.cache.data.init.snapshot = true 
2025-05-09 15:03:31.566 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] common-dev.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-09 15:03:31.573 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=common-dev.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-09 15:03:31.573 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=common-dev.yaml, group=DEFAULT_GROUP
2025-05-09 15:03:31.574 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-09 15:03:31.575 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-09 15:03:31.575 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai.yaml, group=DEFAULT_GROUP
2025-05-09 15:03:31.575 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai-dev.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-09 15:03:31.575 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai-dev.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-09 15:03:31.575 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai-dev.yaml, group=DEFAULT_GROUP
2025-05-09 15:03:31.575 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-09 15:03:31.575 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai, group=DEFAULT_GROUP, cnt=1
2025-05-09 15:03:31.576 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai, group=DEFAULT_GROUP
2025-05-09 15:03:47.090 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.MockAuthController - Authorization request: client_id=bgai-client-id, redirect_uri=http://localhost:8080/api/auth/callback, response_type=code
2025-05-09 15:03:55.937 [http-nio-8080-exec-4] INFO  com.bgpay.bgai.controller.MockAuthController - Token request: grant_type=null, code=null, client_id=null
2025-05-09 15:03:55.967 [http-nio-8080-exec-3] DEBUG com.bgpay.bgai.mapper.UserMapper.findByUserId - ==>  Preparing: SELECT * FROM t_user WHERE user_id = ?
2025-05-09 15:03:55.968 [http-nio-8080-exec-3] DEBUG com.bgpay.bgai.mapper.UserMapper.findByUserId - ==> Parameters: 689258T(String)
2025-05-09 15:03:55.988 [http-nio-8080-exec-3] DEBUG com.bgpay.bgai.mapper.UserMapper.findByUserId - <==      Total: 1
2025-05-09 15:03:56.047 [http-nio-8080-exec-3] DEBUG com.bgpay.bgai.mapper.UserMapper.updateById - ==>  Preparing: UPDATE t_user SET user_id=?, username=?, email=?, avatar_url=?, last_login_time=?, access_token=?, refresh_token=?, token_expire_time=?, status=?, create_time=?, update_time=? WHERE id=?
2025-05-09 15:03:56.050 [http-nio-8080-exec-3] DEBUG com.bgpay.bgai.mapper.UserMapper.updateById - ==> Parameters: 689258T(String), 测试用户(String), test@example.com(String), https://ui-avatars.com/api/?name=测试用户(String), 2025-05-09T15:03:55.989142(LocalDateTime), f959a87c-f64e-43a5-b29b-801ac8017b94(String), 1eecee1b-9ee9-42a7-a89c-9720537c9d97(String), 2025-05-09T16:03:55.989142(LocalDateTime), 1(Integer), 2025-04-26T23:59:16(LocalDateTime), 2025-05-09T15:03:55.989142(LocalDateTime), 1(Long)
2025-05-09 15:03:56.070 [http-nio-8080-exec-3] DEBUG com.bgpay.bgai.mapper.UserMapper.updateById - <==    Updates: 1
2025-05-09 15:04:24.401 [http-nio-8080-exec-7] INFO  com.bgpay.bgai.controller.ReactiveChatController - Received chat request: question = null, file = 新文件 17.txt, modelName = null, multiTurn = false
2025-05-09 15:04:24.402 [http-nio-8080-exec-7] INFO  com.bgpay.bgai.controller.ReactiveChatController - Processing request for user ID: 689258T
2025-05-09 15:04:24.402 [http-nio-8080-exec-7] INFO  com.bgpay.bgai.controller.ReactiveChatController - Processing file with circuit breaker: fileName=新文件 17.txt, question=
2025-05-09 15:04:24.404 [http-nio-8080-exec-7] INFO  com.bgpay.bgai.config.ReactiveFileProcessor - Processing file: 新文件 17.txt, content-type: text/plain
2025-05-09 15:04:24.410 [http-nio-8080-exec-7] INFO  com.bgpay.bgai.controller.ReactiveChatController - PARAM TRACE [689258T]: 尝试查找匹配配置 - 参数: apiUrl=null, modelName=null
2025-05-09 15:04:24.417 [http-nio-8080-exec-7] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 查询配置 - userId=689258T
2025-05-09 15:04:24.418 [http-nio-8080-exec-7] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 排序方式 - 按ID降序
2025-05-09 15:04:24.418 [http-nio-8080-exec-7] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 限制结果数 - LIMIT 1
2025-05-09 15:04:24.428 [http-nio-8080-exec-7] DEBUG com.bgpay.bgai.mapper.ApiConfigMapper.selectList - ==>  Preparing: SELECT id,api_url,api_key,model_name,user_id FROM api_config WHERE (user_id = ?) ORDER BY id DESC LIMIT 1
2025-05-09 15:04:24.428 [http-nio-8080-exec-7] DEBUG com.bgpay.bgai.mapper.ApiConfigMapper.selectList - ==> Parameters: 689258T(String)
2025-05-09 15:04:24.436 [http-nio-8080-exec-7] DEBUG com.bgpay.bgai.mapper.ApiConfigMapper.selectList - <==      Total: 1
2025-05-09 15:04:24.437 [http-nio-8080-exec-7] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 查询结果 - 找到配置: id=2, modelName=deepseek-chat
2025-05-09 15:04:24.437 [http-nio-8080-exec-7] INFO  com.bgpay.bgai.controller.ReactiveChatController - PARAM TRACE [689258T]: 找到匹配配置 - apiUrl=https://api.deepseek.com/chat/completions, modelName=deepseek-chat (原始请求: null)
2025-05-09 15:04:24.437 [http-nio-8080-exec-7] INFO  com.bgpay.bgai.controller.ReactiveChatController - API config resolved: url=https://api.deepseek.com/chat/completions, model=deepseek-chat
2025-05-09 15:04:24.446 [http-nio-8080-exec-7] INFO  com.bgpay.bgai.config.ReactiveFileProcessor - File processed successfully: size=6680 bytes
2025-05-09 15:04:24.449 [http-nio-8080-exec-7] INFO  com.bgpay.bgai.controller.ReactiveChatController - Content processed, length: 6596
2025-05-09 15:04:24.462 [http-nio-8080-exec-7] INFO  org.reflections.Reflections - Processing reactive request: content length=6596, apiUrl=https://api.deepseek.com/chat/completions, modelName=deepseek-chat, userId=689258T, multiTurn=false
2025-05-09 15:04:24.483 [http-nio-8080-exec-7] INFO  com.bgpay.bgai.transaction.TransactionCoordinator - Transaction prepared for user 689258T: chatCompletionId=chat-631e5184-cb35-4d3f-9d64-de4ed1acfd4c
2025-05-09 15:04:24.485 [http-nio-8080-exec-7] INFO  org.reflections.Reflections - Generated request JSON with 2PC transaction: {"stream":false,"max_tokens":2000,"temperature":1.0,"messages":[{"role":"system","content":"You are ...
2025-05-09 15:04:34.448 [reactor-http-nio-3] INFO  org.reflections.Reflections - Raw response received, length: 998
2025-05-09 15:04:34.453 [reactor-http-nio-3] WARN  org.reflections.Reflections - Received different chatCompletionId from response: 28da8717-0f15-4b21-aab2-9fade51eb67a vs prepared: chat-631e5184-cb35-4d3f-9d64-de4ed1acfd4c
2025-05-09 15:04:34.472 [reactor-http-nio-3] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - ==>  Preparing: INSERT INTO chat_completions ( object, created, model, system_fingerprint, api_key ) VALUES ( ?, ?, ?, ?, ? )
2025-05-09 15:04:34.472 [reactor-http-nio-3] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - ==> Parameters: chat.completion(String), 1746774274468(Long), deepseek-chat(String), 689258T(String), chat-631e5184-cb35-4d3f-9d64-de4ed1acfd4c(String)
2025-05-09 15:04:34.490 [reactor-http-nio-3] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - <==    Updates: 1
2025-05-09 15:04:34.493 [reactor-http-nio-3] INFO  com.bgpay.bgai.transaction.TransactionCoordinator - Transaction committed for user 689258T: chatCompletionId=chat-631e5184-cb35-4d3f-9d64-de4ed1acfd4c
2025-05-09 15:04:34.519 [FileWrite-1] INFO  com.bgpay.bgai.service.deepseek.FileWriterService - Successfully wrote content to: \var\data\ai_responses\300f6f5e-17fe-496f-b5f6-8f5e03d20a79.txt
2025-05-09 15:04:34.528 [boundedElastic-1] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - ==>  Preparing: INSERT INTO chat_completions ( object, created, model, system_fingerprint, api_key ) VALUES ( ?, ?, ?, ?, ? )
2025-05-09 15:04:34.528 [boundedElastic-1] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - ==> Parameters: chat.completion(String), 1746774264(Long), deepseek-chat(String), fp_8802369eaa_prod0425fp8(String), chat-631e5184-cb35-4d3f-9d64-de4ed1acfd4c(String)
2025-05-09 15:04:34.542 [boundedElastic-1] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - <==    Updates: 1
2025-05-09 15:04:34.565 [boundedElastic-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.insert - ==>  Preparing: INSERT INTO usage_info ( chat_completion_id, prompt_tokens, completion_tokens, total_tokens, prompt_tokens_cached, completion_reasoning_tokens, prompt_cache_hit_tokens, prompt_cache_miss_tokens, created_at, model_type ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-05-09 15:04:34.565 [boundedElastic-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.insert - ==> Parameters: chat-631e5184-cb35-4d3f-9d64-de4ed1acfd4c(String), 2205(Integer), 103(Integer), 2308(Integer), 2176(Integer), 0(Integer), 0(Integer), 29(Integer), 2025-05-09T15:04:34.556731900(LocalDateTime), deepseek-chat(String)
2025-05-09 15:04:34.582 [boundedElastic-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.insert - <==    Updates: 1
2025-05-09 15:04:34.597 [boundedElastic-1] INFO  org.reflections.Reflections - Completion data saved synchronously for chatCompletionId: chat-631e5184-cb35-4d3f-9d64-de4ed1acfd4c
2025-05-09 15:04:34.606 [boundedElastic-2] INFO  org.reflections.Reflections - 开始发送账单消息，chatCompletionId: chat-631e5184-cb35-4d3f-9d64-de4ed1acfd4c, userId: 689258T
2025-05-09 15:04:34.667 [boundedElastic-2] INFO  org.reflections.Reflections - 账单消息发送成功，chatCompletionId: chat-631e5184-cb35-4d3f-9d64-de4ed1acfd4c, userId: 689258T
2025-05-09 15:04:34.671 [boundedElastic-1] INFO  org.reflections.Reflections - Complete processing chain completed: I see you've shared a Spring Boot application configuration file (likely `application.yml`). This file contains various settings for your application. What would you like to know about this configuration? I can help with:

1. Explaining specific sections
2. Identifying potential security concerns (I notice some credentials are exposed)
3. Suggesting optimizations
4. Explaining how different components are configured
5. Any other questions about the setup

Would you like me to focus on any particular aspect of this configuration?
2025-05-09 15:04:34.671 [boundedElastic-1] INFO  com.bgpay.bgai.controller.ReactiveChatController - Processed response for user 689258T, content length: 534
2025-05-09 15:05:19.880 [pool-7-thread-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.selectCount - ==>  Preparing: SELECT COUNT( * ) AS total FROM usage_info WHERE (chat_completion_id = ?)
2025-05-09 15:05:19.881 [pool-7-thread-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.selectCount - ==> Parameters: chat-631e5184-cb35-4d3f-9d64-de4ed1acfd4c(String)
2025-05-09 15:05:19.888 [pool-7-thread-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.selectCount - <==      Total: 1
2025-05-09 15:05:19.975 [ConsumeMessageThread_billing-consumer-group_1] DEBUG c.bgpay.bgai.mapper.PriceConfigMapper.selectList - ==>  Preparing: SELECT id,model_type,time_period,cache_status,io_type,price,version,effective_time FROM price_config WHERE (model_type = ? AND time_period = ? AND io_type = ? AND effective_time <= ? AND cache_status = ?) ORDER BY effective_time DESC LIMIT 1
2025-05-09 15:05:19.975 [ConsumeMessageThread_billing-consumer-group_1] DEBUG c.bgpay.bgai.mapper.PriceConfigMapper.selectList - ==> Parameters: deepseek-chat(String), standard(String), input(String), 2025-05-09T15:05:19.973506300(LocalDateTime), miss(String)
2025-05-09 15:05:19.992 [ConsumeMessageThread_billing-consumer-group_1] DEBUG c.bgpay.bgai.mapper.PriceConfigMapper.selectList - <==      Total: 1
2025-05-09 15:05:20.042 [ConsumeMessageThread_billing-consumer-group_1] DEBUG c.bgpay.bgai.mapper.PriceConfigMapper.selectList - ==>  Preparing: SELECT id,model_type,time_period,cache_status,io_type,price,version,effective_time FROM price_config WHERE (model_type = ? AND time_period = ? AND io_type = ? AND effective_time <= ? AND cache_status IS NULL) ORDER BY effective_time DESC LIMIT 1
2025-05-09 15:05:20.043 [ConsumeMessageThread_billing-consumer-group_1] DEBUG c.bgpay.bgai.mapper.PriceConfigMapper.selectList - ==> Parameters: deepseek-chat(String), standard(String), output(String), 2025-05-09T15:05:20.041685300(LocalDateTime)
2025-05-09 15:05:20.048 [ConsumeMessageThread_billing-consumer-group_1] DEBUG c.bgpay.bgai.mapper.PriceConfigMapper.selectList - <==      Total: 1
2025-05-09 15:05:20.111 [ConsumeMessageThread_billing-consumer-group_1] INFO  c.bgpay.bgai.service.mq.RocketMQBillingServiceImpl - Output price config priceVersion: 1
2025-05-09 15:05:20.114 [ConsumeMessageThread_billing-consumer-group_1] DEBUG com.bgpay.bgai.mapper.UsageRecordMapper.insert - ==>  Preparing: INSERT INTO usage_record ( model_type, chat_completion_id, user_id, input_cost, output_cost, price_version, calculated_at ) VALUES ( ?, ?, ?, ?, ?, ?, ? )
2025-05-09 15:05:20.114 [ConsumeMessageThread_billing-consumer-group_1] DEBUG com.bgpay.bgai.mapper.UsageRecordMapper.insert - ==> Parameters: deepseek-chat(String), chat-631e5184-cb35-4d3f-9d64-de4ed1acfd4c(String), 689258T(String), 0.0001(BigDecimal), 0.0008(BigDecimal), 1(Integer), 2025-05-09T15:05:20.112456700(LocalDateTime)
2025-05-09 15:05:20.150 [ConsumeMessageThread_billing-consumer-group_1] DEBUG com.bgpay.bgai.mapper.UsageRecordMapper.insert - <==    Updates: 1
2025-05-09 15:05:20.160 [ConsumeMessageThread_billing-consumer-group_1] INFO  c.bgpay.bgai.service.mq.RocketMQBillingServiceImpl - Message consumed: 2408820C75288342F58D761159F69FAB327836BAF30C2C6F0A450000
2025-05-09 15:05:42.182 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - Received chat request: question = null, file = 新文件 17.txt, modelName = null, multiTurn = false
2025-05-09 15:05:42.183 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - Processing request for user ID: 689258T
2025-05-09 15:05:42.183 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - Processing file with circuit breaker: fileName=新文件 17.txt, question=
2025-05-09 15:05:42.183 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.config.ReactiveFileProcessor - Processing file: 新文件 17.txt, content-type: text/plain
2025-05-09 15:05:42.183 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - PARAM TRACE [689258T]: 尝试查找匹配配置 - 参数: apiUrl=null, modelName=null
2025-05-09 15:05:42.183 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 查询配置 - userId=689258T
2025-05-09 15:05:42.183 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 排序方式 - 按ID降序
2025-05-09 15:05:42.183 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 限制结果数 - LIMIT 1
2025-05-09 15:05:42.184 [http-nio-8080-exec-2] DEBUG com.bgpay.bgai.mapper.ApiConfigMapper.selectList - ==>  Preparing: SELECT id,api_url,api_key,model_name,user_id FROM api_config WHERE (user_id = ?) ORDER BY id DESC LIMIT 1
2025-05-09 15:05:42.184 [http-nio-8080-exec-2] DEBUG com.bgpay.bgai.mapper.ApiConfigMapper.selectList - ==> Parameters: 689258T(String)
2025-05-09 15:05:42.191 [http-nio-8080-exec-2] DEBUG com.bgpay.bgai.mapper.ApiConfigMapper.selectList - <==      Total: 1
2025-05-09 15:05:42.191 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 查询结果 - 找到配置: id=2, modelName=deepseek-chat
2025-05-09 15:05:42.191 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - PARAM TRACE [689258T]: 找到匹配配置 - apiUrl=https://api.deepseek.com/chat/completions, modelName=deepseek-chat (原始请求: null)
2025-05-09 15:05:42.191 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - API config resolved: url=https://api.deepseek.com/chat/completions, model=deepseek-chat
2025-05-09 15:05:42.192 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.config.ReactiveFileProcessor - File processed successfully: size=6680 bytes
2025-05-09 15:05:42.192 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - Content processed, length: 6596
2025-05-09 15:05:42.192 [http-nio-8080-exec-2] INFO  org.reflections.Reflections - Processing reactive request: content length=6596, apiUrl=https://api.deepseek.com/chat/completions, modelName=deepseek-chat, userId=689258T, multiTurn=false
2025-05-09 15:05:42.199 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.transaction.TransactionCoordinator - Transaction prepared for user 689258T: chatCompletionId=chat-cefbabaa-8169-4e63-93e1-81eb81825f17
2025-05-09 15:05:42.199 [http-nio-8080-exec-2] INFO  org.reflections.Reflections - Generated request JSON with 2PC transaction: {"stream":false,"max_tokens":2000,"temperature":1.0,"messages":[{"role":"system","content":"You are ...
2025-05-09 15:05:54.678 [reactor-http-nio-4] INFO  org.reflections.Reflections - Raw response received, length: 1322
2025-05-09 15:05:54.678 [reactor-http-nio-4] WARN  org.reflections.Reflections - Received different chatCompletionId from response: 070f09d7-e4d5-4abe-8057-f77783373a50 vs prepared: chat-cefbabaa-8169-4e63-93e1-81eb81825f17
2025-05-09 15:05:54.689 [reactor-http-nio-4] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - ==>  Preparing: INSERT INTO chat_completions ( object, created, model, system_fingerprint, api_key ) VALUES ( ?, ?, ?, ?, ? )
2025-05-09 15:05:54.690 [reactor-http-nio-4] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - ==> Parameters: chat.completion(String), 1746774354689(Long), deepseek-chat(String), 689258T(String), chat-cefbabaa-8169-4e63-93e1-81eb81825f17(String)
2025-05-09 15:05:54.700 [reactor-http-nio-4] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - <==    Updates: 1
2025-05-09 15:05:54.701 [reactor-http-nio-4] INFO  com.bgpay.bgai.transaction.TransactionCoordinator - Transaction committed for user 689258T: chatCompletionId=chat-cefbabaa-8169-4e63-93e1-81eb81825f17
2025-05-09 15:05:54.717 [FileWrite-2] INFO  com.bgpay.bgai.service.deepseek.FileWriterService - Successfully wrote content to: \var\data\ai_responses\eefdc8cf-4166-4a39-8ff5-7426a2a0d1f8.txt
2025-05-09 15:05:54.721 [boundedElastic-1] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - ==>  Preparing: INSERT INTO chat_completions ( object, created, model, system_fingerprint, api_key ) VALUES ( ?, ?, ?, ?, ? )
2025-05-09 15:05:54.721 [boundedElastic-1] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - ==> Parameters: chat.completion(String), 1746774342(Long), deepseek-chat(String), fp_8802369eaa_prod0425fp8(String), chat-cefbabaa-8169-4e63-93e1-81eb81825f17(String)
2025-05-09 15:05:54.732 [boundedElastic-1] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - <==    Updates: 1
2025-05-09 15:05:54.751 [boundedElastic-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.insert - ==>  Preparing: INSERT INTO usage_info ( chat_completion_id, prompt_tokens, completion_tokens, total_tokens, prompt_tokens_cached, completion_reasoning_tokens, prompt_cache_hit_tokens, prompt_cache_miss_tokens, created_at, model_type ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-05-09 15:05:54.751 [boundedElastic-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.insert - ==> Parameters: chat-cefbabaa-8169-4e63-93e1-81eb81825f17(String), 2205(Integer), 167(Integer), 2372(Integer), 2176(Integer), 0(Integer), 0(Integer), 29(Integer), 2025-05-09T15:05:54.745319500(LocalDateTime), deepseek-chat(String)
2025-05-09 15:05:54.762 [boundedElastic-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.insert - <==    Updates: 1
2025-05-09 15:05:54.775 [boundedElastic-1] INFO  org.reflections.Reflections - Completion data saved synchronously for chatCompletionId: chat-cefbabaa-8169-4e63-93e1-81eb81825f17
2025-05-09 15:05:54.775 [boundedElastic-2] INFO  org.reflections.Reflections - 开始发送账单消息，chatCompletionId: chat-cefbabaa-8169-4e63-93e1-81eb81825f17, userId: 689258T
2025-05-09 15:05:54.787 [boundedElastic-2] INFO  org.reflections.Reflections - 账单消息发送成功，chatCompletionId: chat-cefbabaa-8169-4e63-93e1-81eb81825f17, userId: 689258T
2025-05-09 15:05:54.788 [boundedElastic-1] INFO  org.reflections.Reflections - Complete processing chain completed: It looks like you've shared a Spring Boot application configuration file (likely `application.yml`) but haven't actually asked a question. This configuration file contains settings for:

1. Database connections (MySQL master/slave with Druid pool)
2. Redis configuration
3. JPA/Hibernate settings
4. RocketMQ messaging
5. Resilience4j circuit breakers and retry mechanisms
6. API security configurations
7. Various other application settings

How can I help you with this configuration file? Some common questions might be:

- Do you need help understanding a specific section?
- Are you looking for security recommendations (I notice passwords are exposed)?
- Do you need help optimizing any of the configurations?
- Are you encountering any issues with these settings?

Please let me know what specific assistance you need with this configuration.
2025-05-09 15:05:54.788 [boundedElastic-1] INFO  com.bgpay.bgai.controller.ReactiveChatController - Processed response for user 689258T, content length: 849
2025-05-09 15:06:49.678 [pool-7-thread-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.selectCount - ==>  Preparing: SELECT COUNT( * ) AS total FROM usage_info WHERE (chat_completion_id = ?)
2025-05-09 15:06:49.678 [pool-7-thread-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.selectCount - ==> Parameters: chat-cefbabaa-8169-4e63-93e1-81eb81825f17(String)
2025-05-09 15:06:49.687 [pool-7-thread-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.selectCount - <==      Total: 1
2025-05-09 15:06:49.796 [ConsumeMessageThread_billing-consumer-group_2] INFO  c.bgpay.bgai.service.mq.RocketMQBillingServiceImpl - Output price config priceVersion: 1
2025-05-09 15:06:49.796 [ConsumeMessageThread_billing-consumer-group_2] DEBUG com.bgpay.bgai.mapper.UsageRecordMapper.insert - ==>  Preparing: INSERT INTO usage_record ( model_type, chat_completion_id, user_id, input_cost, output_cost, price_version, calculated_at ) VALUES ( ?, ?, ?, ?, ?, ?, ? )
2025-05-09 15:06:49.797 [ConsumeMessageThread_billing-consumer-group_2] DEBUG com.bgpay.bgai.mapper.UsageRecordMapper.insert - ==> Parameters: deepseek-chat(String), chat-cefbabaa-8169-4e63-93e1-81eb81825f17(String), 689258T(String), 0.0001(BigDecimal), 0.0013(BigDecimal), 1(Integer), 2025-05-09T15:06:49.796895600(LocalDateTime)
2025-05-09 15:06:49.812 [ConsumeMessageThread_billing-consumer-group_2] DEBUG com.bgpay.bgai.mapper.UsageRecordMapper.insert - <==    Updates: 1
2025-05-09 15:06:49.819 [ConsumeMessageThread_billing-consumer-group_2] INFO  c.bgpay.bgai.service.mq.RocketMQBillingServiceImpl - Message consumed: 2408820C75288342F58D761159F69FAB327836BAF30C2C7043580002
2025-05-09 15:07:54.808 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:10909] result: true
2025-05-09 15:08:31.534 [scheduling-1] WARN  com.alibaba.druid.pool.DruidAbstractDataSource - discard long time none received connection. , jdbcUrl : jdbc:mysql://8.133.246.113:3306/deepseek?autoReconnect=false&useUnicode=true&characterEncoding=UTF-8&characterSetResults=UTF-8&zeroDateTimeBehavior=convertToNull&useSSL=false&allowPublicKeyRetrieval=true&useSSL=false, version : 1.2.8, lastPacketReceivedIdleMillis : 101707
2025-05-09 15:08:32.539 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-09 15:08:32.539 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-09 15:08:32.548 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-09 15:08:32.548 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-09 15:08:32.548 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-09 15:08:32.556 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-09 15:09:04.851 [Thread-7] WARN  com.alibaba.nacos.common.notify.NotifyCenter - [NotifyCenter] Start destroying Publisher
2025-05-09 15:09:04.851 [Thread-1] WARN  c.alibaba.nacos.common.http.HttpClientBeanHolder - [HttpClientBeanHolder] Start destroying common HttpClient
2025-05-09 15:09:04.851 [Thread-7] WARN  com.alibaba.nacos.common.notify.NotifyCenter - [NotifyCenter] Destruction of the end
2025-05-09 15:09:04.852 [Thread-1] WARN  c.alibaba.nacos.common.http.HttpClientBeanHolder - [HttpClientBeanHolder] Destruction of the end
2025-05-09 15:09:04.872 [SpringApplicationShutdownHook] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - De-registering from Nacos Server now...
2025-05-09 15:09:04.872 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - [DEREGISTER-SERVICE] d750d92e-152f-4055-a641-3bc9dda85a29 deregistering service bgai with instance: Instance{instanceId='null', ip='192.168.86.8', port=8080, weight=1.0, healthy=true, enabled=true, ephemeral=true, clusterName='DEFAULT', serviceName='null', metadata={}}
2025-05-09 15:09:04.882 [SpringApplicationShutdownHook] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - De-registration finished.
2025-05-09 15:09:04.883 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.cache.ServiceInfoHolder do shutdown begin
2025-05-09 15:09:04.883 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.backups.FailoverReactor do shutdown begin
2025-05-09 15:09:04.883 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.backups.FailoverReactor do shutdown stop
2025-05-09 15:09:04.883 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.cache.ServiceInfoHolder do shutdown stop
2025-05-09 15:09:04.883 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.NamingClientProxyDelegate do shutdown begin
2025-05-09 15:09:04.883 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServiceInfoUpdateService do shutdown begin
2025-05-09 15:09:04.883 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServiceInfoUpdateService do shutdown stop
2025-05-09 15:09:04.883 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServerListManager do shutdown begin
2025-05-09 15:09:04.883 [SpringApplicationShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Start destroying NacosRestTemplate
2025-05-09 15:09:04.883 [SpringApplicationShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Destruction of the end
2025-05-09 15:09:04.883 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServerListManager do shutdown stop
2025-05-09 15:09:04.883 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.http.NamingHttpClientProxy do shutdown begin
2025-05-09 15:09:04.883 [SpringApplicationShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Start destroying NacosRestTemplate
2025-05-09 15:09:04.883 [SpringApplicationShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Destruction of the end
2025-05-09 15:09:04.883 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.http.NamingHttpClientProxy do shutdown stop
2025-05-09 15:09:04.883 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Shutdown rpc client, set status to shutdown
2025-05-09 15:09:04.884 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Shutdown client event executor java.util.concurrent.ScheduledThreadPoolExecutor@309c39dc[Running, pool size = 2, active threads = 2, queued tasks = 0, completed tasks = 0]
2025-05-09 15:09:04.884 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Close current connection 1746774211130_139.227.195.203_42550
2025-05-09 15:09:04.886 [nacos-grpc-client-executor-8.133.246.113-92] WARN  c.a.nacos.common.remote.client.grpc.GrpcClient - [1746774211130_139.227.195.203_42550]Ignore error event,isRunning:false,isAbandon=false
2025-05-09 15:09:04.887 [SpringApplicationShutdownHook] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - Shutdown grpc executor java.util.concurrent.ThreadPoolExecutor@68db2d5c[Running, pool size = 4, active threads = 0, queued tasks = 0, completed tasks = 93]
2025-05-09 15:09:04.887 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - Shutdown grpc redo service executor java.util.concurrent.ScheduledThreadPoolExecutor@57598bc7[Running, pool size = 1, active threads = 0, queued tasks = 1, completed tasks = 111]
2025-05-09 15:09:04.888 [SpringApplicationShutdownHook] INFO  c.a.n.client.auth.ram.identify.CredentialWatcher - [null] CredentialWatcher is stopped
2025-05-09 15:09:04.888 [SpringApplicationShutdownHook] INFO  c.a.n.client.auth.ram.identify.CredentialService - [null] CredentialService is freed
2025-05-09 15:09:04.888 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.NamingClientProxyDelegate do shutdown stop
2025-05-09 15:09:04.938 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:10911] result: true
2025-05-09 15:09:04.939 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:9876] result: true
2025-05-09 15:09:04.951 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:9876] result: true
2025-05-09 15:09:04.951 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:10911] result: true
2025-05-09 15:09:06.965 [com.alibaba.nacos.client.Worker] INFO  c.a.n.client.auth.ram.identify.CredentialWatcher - null No credential found
2025-05-09 15:09:07.154 [SpringApplicationShutdownHook] INFO  o.s.orm.jpa.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-05-09 15:09:07.155 [SpringApplicationShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-0} closing ...
2025-05-09 15:09:07.156 [SpringApplicationShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} closing ...
2025-05-09 15:09:07.158 [SpringApplicationShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} closed
2025-05-09 15:23:14.488 [main] WARN  com.alibaba.nacos.client.logging.NacosLogging - Load Logback Configuration of Nacos fail, message: Could not initialize Logback Nacos logging from classpath:nacos-logback.xml
2025-05-09 15:23:14.489 [main] INFO  com.bgpay.bgai.BgaiApplication - The following 1 profile is active: "dev"
2025-05-09 15:23:15.684 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-05-09 15:23:15.686 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-05-09 15:23:15.708 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 16 ms. Found 0 JPA repository interfaces.
2025-05-09 15:23:15.718 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-05-09 15:23:15.719 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-05-09 15:23:15.731 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 4 ms. Found 0 Redis repository interfaces.
2025-05-09 15:23:15.873 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'allowedFileTypeMapper' and 'com.bgpay.bgai.mapper.AllowedFileTypeMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 15:23:15.873 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'apiConfigMapper' and 'com.bgpay.bgai.mapper.ApiConfigMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 15:23:15.873 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'chatCompletionsMapper' and 'com.bgpay.bgai.mapper.ChatCompletionsMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 15:23:15.873 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'choicesMapper' and 'com.bgpay.bgai.mapper.ChoicesMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 15:23:15.873 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'fileTypeMapper' and 'com.bgpay.bgai.mapper.FileTypeMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 15:23:15.873 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'priceConfigMapper' and 'com.bgpay.bgai.mapper.PriceConfigMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 15:23:15.873 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'priceVersionMapper' and 'com.bgpay.bgai.mapper.PriceVersionMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 15:23:15.873 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'usageInfoMapper' and 'com.bgpay.bgai.mapper.UsageInfoMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 15:23:15.873 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'usageRecordMapper' and 'com.bgpay.bgai.mapper.UsageRecordMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 15:23:15.873 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'userMapper' and 'com.bgpay.bgai.mapper.UserMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 15:23:15.874 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - No MyBatis mapper was found in '[com.bgpay.bgai.mapper]' package. Please check your configuration.
2025-05-09 15:23:15.875 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'allowedFileTypeMapper' and 'com.bgpay.bgai.mapper.AllowedFileTypeMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 15:23:15.876 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'apiConfigMapper' and 'com.bgpay.bgai.mapper.ApiConfigMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 15:23:15.876 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'chatCompletionsMapper' and 'com.bgpay.bgai.mapper.ChatCompletionsMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 15:23:15.876 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'choicesMapper' and 'com.bgpay.bgai.mapper.ChoicesMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 15:23:15.876 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'fileTypeMapper' and 'com.bgpay.bgai.mapper.FileTypeMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 15:23:15.876 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'priceConfigMapper' and 'com.bgpay.bgai.mapper.PriceConfigMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 15:23:15.876 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'priceVersionMapper' and 'com.bgpay.bgai.mapper.PriceVersionMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 15:23:15.876 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'usageInfoMapper' and 'com.bgpay.bgai.mapper.UsageInfoMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 15:23:15.876 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'usageRecordMapper' and 'com.bgpay.bgai.mapper.UsageRecordMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 15:23:15.876 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'userMapper' and 'com.bgpay.bgai.mapper.UserMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 15:23:15.876 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - No MyBatis mapper was found in '[com.bgpay.bgai.mapper]' package. Please check your configuration.
2025-05-09 15:23:16.150 [main] INFO  o.springframework.cloud.context.scope.GenericScope - BeanFactory id=38ed5f2c-a148-3506-bdcb-f18d795b9667
2025-05-09 15:23:16.453 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'org.springframework.cloud.commons.config.CommonsConfigAutoConfiguration' of type [org.springframework.cloud.commons.config.CommonsConfigAutoConfiguration] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 15:23:16.461 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'org.springframework.cloud.client.loadbalancer.LoadBalancerDefaultMappingsProviderAutoConfiguration' of type [org.springframework.cloud.client.loadbalancer.LoadBalancerDefaultMappingsProviderAutoConfiguration] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 15:23:16.465 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'loadBalancerClientsDefaultsMappingsProvider' of type [org.springframework.cloud.client.loadbalancer.LoadBalancerDefaultMappingsProviderAutoConfiguration$$Lambda/0x0000028fd7723918] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 15:23:16.474 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'defaultsBindHandlerAdvisor' of type [org.springframework.cloud.commons.config.DefaultsBindHandlerAdvisor] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 15:23:16.506 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'spring.datasource.dynamic-com.baomidou.dynamic.datasource.spring.boot.autoconfigure.DynamicDataSourceProperties' of type [com.baomidou.dynamic.datasource.spring.boot.autoconfigure.DynamicDataSourceProperties] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 15:23:16.517 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'com.baomidou.dynamic.datasource.spring.boot.autoconfigure.DynamicDataSourceAutoConfiguration' of type [com.baomidou.dynamic.datasource.spring.boot.autoconfigure.DynamicDataSourceAutoConfiguration$$SpringCGLIB$$0] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 15:23:16.534 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'dsProcessor' of type [com.baomidou.dynamic.datasource.processor.jakarta.DsJakartaHeaderProcessor] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 15:23:16.980 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'messageConverterConfiguration' of type [org.apache.rocketmq.spring.autoconfigure.MessageConverterConfiguration$$SpringCGLIB$$0] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 15:23:17.056 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'createRocketMQMessageConverter' of type [org.apache.rocketmq.spring.support.RocketMQMessageConverter] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 15:23:17.065 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'rocketmq-org.apache.rocketmq.spring.autoconfigure.RocketMQProperties' of type [org.apache.rocketmq.spring.autoconfigure.RocketMQProperties] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 15:23:17.069 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'listenerContainerConfiguration' of type [org.apache.rocketmq.spring.autoconfigure.ListenerContainerConfiguration$$SpringCGLIB$$0] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 15:23:17.102 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'org.springframework.cloud.client.loadbalancer.reactive.LoadBalancerBeanPostProcessorAutoConfiguration' of type [org.springframework.cloud.client.loadbalancer.reactive.LoadBalancerBeanPostProcessorAutoConfiguration] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 15:23:17.106 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'org.springframework.cloud.client.loadbalancer.reactive.LoadBalancerBeanPostProcessorAutoConfiguration$ReactorDeferringLoadBalancerFilterConfig' of type [org.springframework.cloud.client.loadbalancer.reactive.LoadBalancerBeanPostProcessorAutoConfiguration$ReactorDeferringLoadBalancerFilterConfig] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 15:23:17.109 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'reactorDeferringLoadBalancerExchangeFilterFunction' of type [org.springframework.cloud.client.loadbalancer.reactive.DeferringLoadBalancerExchangeFilterFunction] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 15:23:17.478 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat initialized with port(s): 8080 (http)
2025-05-09 15:23:17.492 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - Initializing ProtocolHandler ["http-nio-8080"]
2025-05-09 15:23:17.494 [main] INFO  org.apache.catalina.core.StandardService - Starting service [Tomcat]
2025-05-09 15:23:17.494 [main] INFO  org.apache.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.15]
2025-05-09 15:23:17.935 [main] INFO  org.hibernate.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-05-09 15:23:17.984 [main] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.1.7.Final
2025-05-09 15:23:18.265 [main] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} inited
2025-05-09 15:23:18.432 [main] INFO  SQL dialect - HHH000400: Using dialect: org.hibernate.dialect.MySQL8Dialect
2025-05-09 15:23:18.434 [main] WARN  org.hibernate.orm.deprecation - HHH90000026: MySQL8Dialect has been deprecated; use org.hibernate.dialect.MySQLDialect instead
2025-05-09 15:23:18.720 [main] INFO  o.h.e.t.jta.platform.internal.JtaPlatformInitiator - HHH000490: Using JtaPlatform implementation: [org.hibernate.engine.transaction.jta.platform.internal.NoJtaPlatform]
2025-05-09 15:23:18.730 [main] INFO  o.s.orm.jpa.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-05-09 15:23:19.091 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-09 15:23:19.114 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-09 15:23:19.150 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-09 15:23:19.152 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-09 15:23:19.152 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-09 15:23:19.163 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-09 15:23:19.784 [main] INFO  com.bgpay.bgai.service.impl.UserServiceImpl - 初始化SSO配置: clientId=bgai-client-id, redirectUri=http://localhost:8080/api/auth/callback
2025-05-09 15:23:19.860 [main] INFO  com.bgpay.bgai.controller.AuthController - 初始化认证控制器: clientId=bgai-client-id, redirectUri=http://localhost:8080/api/auth/callback
2025-05-09 15:23:20.620 [main] INFO  o.a.r.s.autoconfigure.RocketMQAutoConfiguration - a producer (billing-producer-group) init on namesrv 8.133.246.113:9876
2025-05-09 15:23:21.402 [main] INFO  org.redisson.Version - Redisson 3.24.3
2025-05-09 15:23:21.530 [redisson-netty-4-6] INFO  o.r.connection.pool.MasterPubSubConnectionPool - 1 connections initialized for 8.133.246.113/8.133.246.113:6379
2025-05-09 15:23:21.869 [redisson-netty-4-19] INFO  org.redisson.connection.pool.MasterConnectionPool - 24 connections initialized for 8.133.246.113/8.133.246.113:6379
2025-05-09 15:23:22.094 [main] INFO  com.bgpay.bgai.service.mq.MQConsumerService - MQ consumer startup successful [group=billing-consumer-group, topic=BILLING_TOPIC, tag=USER_BILLING]
2025-05-09 15:23:23.151 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [After]
2025-05-09 15:23:23.151 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Before]
2025-05-09 15:23:23.151 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Between]
2025-05-09 15:23:23.151 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Cookie]
2025-05-09 15:23:23.151 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Header]
2025-05-09 15:23:23.151 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Host]
2025-05-09 15:23:23.151 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Method]
2025-05-09 15:23:23.151 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Path]
2025-05-09 15:23:23.151 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Query]
2025-05-09 15:23:23.151 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [ReadBody]
2025-05-09 15:23:23.151 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [RemoteAddr]
2025-05-09 15:23:23.151 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [XForwardedRemoteAddr]
2025-05-09 15:23:23.151 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Weight]
2025-05-09 15:23:23.152 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [CloudFoundryRouteService]
2025-05-09 15:23:24.300 [main] INFO  o.s.b.actuate.endpoint.web.EndpointLinksResolver - Exposing 1 endpoint(s) beneath base path '/actuator'
2025-05-09 15:23:25.677 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - Starting ProtocolHandler ["http-nio-8080"]
2025-05-09 15:23:25.691 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat started on port(s): 8080 (http) with context path ''
2025-05-09 15:23:25.701 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from ans.namespace attribute : null
2025-05-09 15:23:25.701 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from ALIBABA_ALIWARE_NAMESPACE attribute :null
2025-05-09 15:23:25.701 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from namespace attribute :null
2025-05-09 15:23:25.709 [main] INFO  c.a.n.p.auth.spi.client.ClientAuthPluginManager - [ClientAuthPluginManager] Load ClientAuthService com.alibaba.nacos.client.auth.impl.NacosClientAuthServiceImpl success.
2025-05-09 15:23:25.709 [main] INFO  c.a.n.p.auth.spi.client.ClientAuthPluginManager - [ClientAuthPluginManager] Load ClientAuthService com.alibaba.nacos.client.auth.ram.RamClientAuthServiceImpl success.
2025-05-09 15:23:25.712 [main] INFO  com.alibaba.nacos.common.remote.client - [RpcClientFactory] create a new rpc client of b7add10b-15b7-46c6-bc16-66f7c068ccc1
2025-05-09 15:23:25.714 [main] INFO  com.alibaba.nacos.common.remote.client - [b7add10b-15b7-46c6-bc16-66f7c068ccc1] RpcClient init, ServerListFactory = com.alibaba.nacos.client.naming.core.ServerListManager
2025-05-09 15:23:25.714 [main] INFO  com.alibaba.nacos.common.remote.client - [b7add10b-15b7-46c6-bc16-66f7c068ccc1] Registry connection listener to current client:com.alibaba.nacos.client.naming.remote.gprc.redo.NamingGrpcRedoService
2025-05-09 15:23:25.715 [main] INFO  com.alibaba.nacos.common.remote.client - [b7add10b-15b7-46c6-bc16-66f7c068ccc1] Register server push request handler:com.alibaba.nacos.client.naming.remote.gprc.NamingPushRequestHandler
2025-05-09 15:23:25.715 [main] INFO  com.alibaba.nacos.common.remote.client - [b7add10b-15b7-46c6-bc16-66f7c068ccc1] Try to connect to server on start up, server: {serverIp = '8.133.246.113', server main port = 8848}
2025-05-09 15:23:25.715 [main] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - grpc client connection server:8.133.246.113 ip,serverPort:9848,grpcTslConfig:{"sslProvider":"OPENSSL","enableTls":false,"mutualAuthEnable":false,"trustAll":false}
2025-05-09 15:23:25.844 [main] INFO  com.alibaba.nacos.common.remote.client - [b7add10b-15b7-46c6-bc16-66f7c068ccc1] Success to connect to server [8.133.246.113:8848] on start up, connectionId = 1746775405648_139.227.195.203_43876
2025-05-09 15:23:25.844 [main] INFO  com.alibaba.nacos.common.remote.client - [b7add10b-15b7-46c6-bc16-66f7c068ccc1] Register server push request handler:com.alibaba.nacos.common.remote.client.RpcClient$ConnectResetRequestHandler
2025-05-09 15:23:25.844 [com.alibaba.nacos.client.remote.worker] INFO  com.alibaba.nacos.common.remote.client - [b7add10b-15b7-46c6-bc16-66f7c068ccc1] Notify connected event to listeners.
2025-05-09 15:23:25.844 [main] INFO  com.alibaba.nacos.common.remote.client - [b7add10b-15b7-46c6-bc16-66f7c068ccc1] Register server push request handler:com.alibaba.nacos.common.remote.client.RpcClient$$Lambda/0x0000028fd75255c8
2025-05-09 15:23:25.844 [com.alibaba.nacos.client.remote.worker] INFO  com.alibaba.nacos.client.naming - Grpc connection connect
2025-05-09 15:23:25.846 [main] INFO  com.alibaba.nacos.client.naming - [REGISTER-SERVICE] d750d92e-152f-4055-a641-3bc9dda85a29 registering service bgai with instance Instance{instanceId='null', ip='192.168.86.8', port=8080, weight=1.0, healthy=true, enabled=true, ephemeral=true, clusterName='DEFAULT', serviceName='null', metadata={IPv6=[2408:820c:7528:8342:f58d:7611:59f6:9fab], preserved.register.source=SPRING_CLOUD}}
2025-05-09 15:23:25.867 [main] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - nacos registry, DEFAULT_GROUP bgai 192.168.86.8:8080 register finished
2025-05-09 15:23:25.918 [main] INFO  com.bgpay.bgai.BgaiApplication - Started BgaiApplication in 13.974 seconds (process running for 15.235)
2025-05-09 15:23:25.921 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-09 15:23:25.922 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-09 15:23:25.935 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-09 15:23:25.936 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-09 15:23:25.936 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-09 15:23:25.947 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-09 15:23:25.947 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-09 15:23:25.947 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-09 15:23:25.955 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-09 15:23:25.956 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-09 15:23:25.956 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-09 15:23:25.962 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-09 15:23:25.966 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - nacos.cache.data.init.snapshot = true 
2025-05-09 15:23:25.967 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] common-dev.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-09 15:23:25.976 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=common-dev.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-09 15:23:25.977 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=common-dev.yaml, group=DEFAULT_GROUP
2025-05-09 15:23:25.978 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-09 15:23:25.978 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-09 15:23:25.979 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai.yaml, group=DEFAULT_GROUP
2025-05-09 15:23:25.979 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai-dev.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-09 15:23:25.979 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai-dev.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-09 15:23:25.979 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai-dev.yaml, group=DEFAULT_GROUP
2025-05-09 15:23:25.979 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-09 15:23:25.980 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai, group=DEFAULT_GROUP, cnt=1
2025-05-09 15:23:25.980 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai, group=DEFAULT_GROUP
2025-05-09 15:23:47.145 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - Received chat request: question = null, file = 张陇阳的简历.pdf, modelName = null, multiTurn = false
2025-05-09 15:23:47.147 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - Processing request for user ID: 689258T
2025-05-09 15:23:47.148 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - Processing file with circuit breaker: fileName=张陇阳的简历.pdf, question=
2025-05-09 15:23:47.149 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.config.ReactiveFileProcessor - Processing file: 张陇阳的简历.pdf, content-type: application/pdf
2025-05-09 15:23:47.155 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - PARAM TRACE [689258T]: 尝试查找匹配配置 - 参数: apiUrl=null, modelName=null
2025-05-09 15:23:47.164 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 查询配置 - userId=689258T
2025-05-09 15:23:47.165 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 排序方式 - 按ID降序
2025-05-09 15:23:47.165 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 限制结果数 - LIMIT 1
2025-05-09 15:23:47.220 [http-nio-8080-exec-2] DEBUG com.bgpay.bgai.mapper.ApiConfigMapper.selectList - ==>  Preparing: SELECT id,api_url,api_key,model_name,user_id FROM api_config WHERE (user_id = ?) ORDER BY id DESC LIMIT 1
2025-05-09 15:23:47.221 [http-nio-8080-exec-2] DEBUG com.bgpay.bgai.mapper.ApiConfigMapper.selectList - ==> Parameters: 689258T(String)
2025-05-09 15:23:47.229 [http-nio-8080-exec-2] DEBUG com.bgpay.bgai.mapper.ApiConfigMapper.selectList - <==      Total: 1
2025-05-09 15:23:47.229 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 查询结果 - 找到配置: id=2, modelName=deepseek-chat
2025-05-09 15:23:47.229 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - PARAM TRACE [689258T]: 找到匹配配置 - apiUrl=https://api.deepseek.com/chat/completions, modelName=deepseek-chat (原始请求: null)
2025-05-09 15:23:47.229 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - API config resolved: url=https://api.deepseek.com/chat/completions, model=deepseek-chat
2025-05-09 15:23:47.236 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.config.ReactiveFileProcessor - File processed successfully: size=146595 bytes
2025-05-09 15:23:47.241 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.config.ReactiveFileProcessor - PDF file detected, extracting text content
2025-05-09 15:23:47.244 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - Content processed, length: 91
2025-05-09 15:23:47.254 [http-nio-8080-exec-2] INFO  org.reflections.Reflections - Processing reactive request: content length=91, apiUrl=https://api.deepseek.com/chat/completions, modelName=deepseek-chat, userId=689258T, multiTurn=false
2025-05-09 15:23:47.273 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.transaction.TransactionCoordinator - Transaction prepared for user 689258T: chatCompletionId=chat-802d7ac1-b88c-41e2-9216-6f19a8f5ced8
2025-05-09 15:23:47.276 [http-nio-8080-exec-2] INFO  org.reflections.Reflections - Generated request JSON with 2PC transaction: {"stream":false,"max_tokens":2000,"temperature":1.0,"messages":[{"role":"system","content":"You are ...
2025-05-09 15:23:58.807 [reactor-http-nio-3] INFO  org.reflections.Reflections - Raw response received, length: 706
2025-05-09 15:23:58.812 [reactor-http-nio-3] WARN  org.reflections.Reflections - Received different chatCompletionId from response: 9cafc993-ea7d-4a85-8233-b53f8f07f513 vs prepared: chat-802d7ac1-b88c-41e2-9216-6f19a8f5ced8
2025-05-09 15:23:58.836 [reactor-http-nio-3] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - ==>  Preparing: INSERT INTO chat_completions ( object, created, model, system_fingerprint, api_key ) VALUES ( ?, ?, ?, ?, ? )
2025-05-09 15:23:58.837 [reactor-http-nio-3] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - ==> Parameters: chat.completion(String), 1746775438831(Long), deepseek-chat(String), 689258T(String), chat-802d7ac1-b88c-41e2-9216-6f19a8f5ced8(String)
2025-05-09 15:23:58.850 [reactor-http-nio-3] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - <==    Updates: 1
2025-05-09 15:23:58.852 [reactor-http-nio-3] INFO  com.bgpay.bgai.transaction.TransactionCoordinator - Transaction committed for user 689258T: chatCompletionId=chat-802d7ac1-b88c-41e2-9216-6f19a8f5ced8
2025-05-09 15:23:58.875 [FileWrite-1] INFO  com.bgpay.bgai.service.deepseek.FileWriterService - Successfully wrote content to: \var\data\ai_responses\3ec49f60-b664-4d54-97d8-f80db45fcd48.txt
2025-05-09 15:23:58.882 [boundedElastic-1] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - ==>  Preparing: INSERT INTO chat_completions ( object, created, model, system_fingerprint, api_key ) VALUES ( ?, ?, ?, ?, ? )
2025-05-09 15:23:58.883 [boundedElastic-1] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - ==> Parameters: chat.completion(String), 1746775427(Long), deepseek-chat(String), fp_8802369eaa_prod0425fp8(String), chat-802d7ac1-b88c-41e2-9216-6f19a8f5ced8(String)
2025-05-09 15:23:58.896 [boundedElastic-1] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - <==    Updates: 1
2025-05-09 15:23:58.920 [boundedElastic-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.insert - ==>  Preparing: INSERT INTO usage_info ( chat_completion_id, prompt_tokens, completion_tokens, total_tokens, prompt_tokens_cached, completion_reasoning_tokens, prompt_cache_hit_tokens, prompt_cache_miss_tokens, created_at, model_type ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-05-09 15:23:58.921 [boundedElastic-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.insert - ==> Parameters: chat-802d7ac1-b88c-41e2-9216-6f19a8f5ced8(String), 51(Integer), 146(Integer), 197(Integer), 0(Integer), 0(Integer), 0(Integer), 51(Integer), 2025-05-09T15:23:58.911790100(LocalDateTime), deepseek-chat(String)
2025-05-09 15:23:58.936 [boundedElastic-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.insert - <==    Updates: 1
2025-05-09 15:23:58.969 [boundedElastic-1] INFO  org.reflections.Reflections - Completion data saved synchronously for chatCompletionId: chat-802d7ac1-b88c-41e2-9216-6f19a8f5ced8
2025-05-09 15:23:58.973 [boundedElastic-2] INFO  org.reflections.Reflections - 开始发送账单消息，chatCompletionId: chat-802d7ac1-b88c-41e2-9216-6f19a8f5ced8, userId: 689258T
2025-05-09 15:23:59.011 [boundedElastic-2] INFO  org.reflections.Reflections - 账单消息发送成功，chatCompletionId: chat-802d7ac1-b88c-41e2-9216-6f19a8f5ced8, userId: 689258T
2025-05-09 15:23:59.014 [boundedElastic-1] INFO  org.reflections.Reflections - Complete processing chain completed: 您好！您上传了张陇阳的简历（PDF文件），但尚未提出具体问题。为了更好地协助您，请明确说明您需要哪些帮助，例如：

1. **内容提取**：需要我解析简历中的文字信息吗？（如教育背景、工作经历等）
2. **格式优化**：需要调整简历排版或建议修改建议吗？
3. **信息查询**：需要核对简历中的某些具体内容（如公司名称、日期等）？
4. **其他需求**：如翻译、生成摘要等。

请补充说明需求，我会全力配合！ 📄✨  

（若您需要直接解析PDF内容，请确认是否涉及隐私，并回复“同意解析”）
2025-05-09 15:23:59.014 [boundedElastic-1] INFO  com.bgpay.bgai.controller.ReactiveChatController - Processed response for user 689258T, content length: 250
2025-05-09 15:24:19.865 [pool-7-thread-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.selectCount - ==>  Preparing: SELECT COUNT( * ) AS total FROM usage_info WHERE (chat_completion_id = ?)
2025-05-09 15:24:19.865 [pool-7-thread-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.selectCount - ==> Parameters: chat-802d7ac1-b88c-41e2-9216-6f19a8f5ced8(String)
2025-05-09 15:24:19.872 [pool-7-thread-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.selectCount - <==      Total: 1
2025-05-09 15:24:20.029 [ConsumeMessageThread_billing-consumer-group_1] INFO  c.bgpay.bgai.service.mq.RocketMQBillingServiceImpl - Output price config priceVersion: 1
2025-05-09 15:24:20.031 [ConsumeMessageThread_billing-consumer-group_1] DEBUG com.bgpay.bgai.mapper.UsageRecordMapper.insert - ==>  Preparing: INSERT INTO usage_record ( model_type, chat_completion_id, user_id, input_cost, output_cost, price_version, calculated_at ) VALUES ( ?, ?, ?, ?, ?, ?, ? )
2025-05-09 15:24:20.032 [ConsumeMessageThread_billing-consumer-group_1] DEBUG com.bgpay.bgai.mapper.UsageRecordMapper.insert - ==> Parameters: deepseek-chat(String), chat-802d7ac1-b88c-41e2-9216-6f19a8f5ced8(String), 689258T(String), 0.0001(BigDecimal), 0.0012(BigDecimal), 1(Integer), 2025-05-09T15:24:20.030340400(LocalDateTime)
2025-05-09 15:24:20.047 [ConsumeMessageThread_billing-consumer-group_1] DEBUG com.bgpay.bgai.mapper.UsageRecordMapper.insert - <==    Updates: 1
2025-05-09 15:24:20.058 [ConsumeMessageThread_billing-consumer-group_1] INFO  c.bgpay.bgai.service.mq.RocketMQBillingServiceImpl - Message consumed: 2408820C75288342F58D761159F69FAB05A436BAF30C2C80CE960000
2025-05-09 15:27:13.711 [http-nio-8080-exec-6] INFO  com.bgpay.bgai.controller.ReactiveChatController - Received chat request: question = null, file = 张陇阳的简历.pdf, modelName = null, multiTurn = false
2025-05-09 15:27:13.711 [http-nio-8080-exec-6] INFO  com.bgpay.bgai.controller.ReactiveChatController - Processing request for user ID: 689258T
2025-05-09 15:27:13.711 [http-nio-8080-exec-6] INFO  com.bgpay.bgai.controller.ReactiveChatController - Processing file with circuit breaker: fileName=张陇阳的简历.pdf, question=
2025-05-09 15:27:13.711 [http-nio-8080-exec-6] INFO  com.bgpay.bgai.config.ReactiveFileProcessor - Processing file: 张陇阳的简历.pdf, content-type: application/pdf
2025-05-09 15:27:13.713 [http-nio-8080-exec-6] INFO  com.bgpay.bgai.controller.ReactiveChatController - PARAM TRACE [689258T]: 尝试查找匹配配置 - 参数: apiUrl=null, modelName=null
2025-05-09 15:27:13.713 [http-nio-8080-exec-6] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 查询配置 - userId=689258T
2025-05-09 15:27:13.713 [http-nio-8080-exec-6] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 排序方式 - 按ID降序
2025-05-09 15:27:13.713 [http-nio-8080-exec-6] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 限制结果数 - LIMIT 1
2025-05-09 15:27:13.739 [http-nio-8080-exec-6] WARN  com.alibaba.druid.pool.DruidAbstractDataSource - discard long time none received connection. , jdbcUrl : jdbc:mysql://8.133.246.113:3306/deepseek?autoReconnect=false&useUnicode=true&characterEncoding=UTF-8&characterSetResults=UTF-8&zeroDateTimeBehavior=convertToNull&useSSL=false&allowPublicKeyRetrieval=true&useSSL=false, version : 1.2.8, lastPacketReceivedIdleMillis : 173682
2025-05-09 15:27:13.745 [http-nio-8080-exec-6] WARN  com.alibaba.druid.pool.DruidAbstractDataSource - discard long time none received connection. , jdbcUrl : jdbc:mysql://8.133.246.113:3306/deepseek?autoReconnect=false&useUnicode=true&characterEncoding=UTF-8&characterSetResults=UTF-8&zeroDateTimeBehavior=convertToNull&useSSL=false&allowPublicKeyRetrieval=true&useSSL=false, version : 1.2.8, lastPacketReceivedIdleMillis : 227782
2025-05-09 15:27:13.793 [http-nio-8080-exec-6] DEBUG com.bgpay.bgai.mapper.ApiConfigMapper.selectList - ==>  Preparing: SELECT id,api_url,api_key,model_name,user_id FROM api_config WHERE (user_id = ?) ORDER BY id DESC LIMIT 1
2025-05-09 15:27:13.793 [http-nio-8080-exec-6] DEBUG com.bgpay.bgai.mapper.ApiConfigMapper.selectList - ==> Parameters: 689258T(String)
2025-05-09 15:27:13.800 [http-nio-8080-exec-6] DEBUG com.bgpay.bgai.mapper.ApiConfigMapper.selectList - <==      Total: 1
2025-05-09 15:27:13.800 [http-nio-8080-exec-6] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 查询结果 - 找到配置: id=2, modelName=deepseek-chat
2025-05-09 15:27:13.800 [http-nio-8080-exec-6] INFO  com.bgpay.bgai.controller.ReactiveChatController - PARAM TRACE [689258T]: 找到匹配配置 - apiUrl=https://api.deepseek.com/chat/completions, modelName=deepseek-chat (原始请求: null)
2025-05-09 15:27:13.800 [http-nio-8080-exec-6] INFO  com.bgpay.bgai.controller.ReactiveChatController - API config resolved: url=https://api.deepseek.com/chat/completions, model=deepseek-chat
2025-05-09 15:27:13.801 [http-nio-8080-exec-6] INFO  com.bgpay.bgai.config.ReactiveFileProcessor - File processed successfully: size=146595 bytes
2025-05-09 15:27:13.803 [http-nio-8080-exec-6] INFO  com.bgpay.bgai.config.ReactiveFileProcessor - PDF file detected, extracting text content
2025-05-09 15:27:13.804 [http-nio-8080-exec-6] INFO  com.bgpay.bgai.controller.ReactiveChatController - Content processed, length: 91
2025-05-09 15:27:13.804 [http-nio-8080-exec-6] INFO  org.reflections.Reflections - Processing reactive request: content length=91, apiUrl=https://api.deepseek.com/chat/completions, modelName=deepseek-chat, userId=689258T, multiTurn=false
2025-05-09 15:27:13.812 [http-nio-8080-exec-6] INFO  com.bgpay.bgai.transaction.TransactionCoordinator - Transaction prepared for user 689258T: chatCompletionId=chat-fbd65c38-1672-4592-aa8a-3f2154adab31
2025-05-09 15:27:13.812 [http-nio-8080-exec-6] INFO  org.reflections.Reflections - Generated request JSON with 2PC transaction: {"stream":false,"max_tokens":2000,"temperature":1.0,"messages":[{"role":"system","content":"You are ...
2025-05-09 15:27:26.825 [reactor-http-nio-4] INFO  org.reflections.Reflections - Raw response received, length: 769
2025-05-09 15:27:26.825 [reactor-http-nio-4] WARN  org.reflections.Reflections - Received different chatCompletionId from response: 658e9dc0-467f-4ce2-87a6-4f7cf3bec7fc vs prepared: chat-fbd65c38-1672-4592-aa8a-3f2154adab31
2025-05-09 15:27:26.837 [reactor-http-nio-4] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - ==>  Preparing: INSERT INTO chat_completions ( object, created, model, system_fingerprint, api_key ) VALUES ( ?, ?, ?, ?, ? )
2025-05-09 15:27:26.837 [reactor-http-nio-4] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - ==> Parameters: chat.completion(String), 1746775646836(Long), deepseek-chat(String), 689258T(String), chat-fbd65c38-1672-4592-aa8a-3f2154adab31(String)
2025-05-09 15:27:26.849 [reactor-http-nio-4] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - <==    Updates: 1
2025-05-09 15:27:26.850 [reactor-http-nio-4] INFO  com.bgpay.bgai.transaction.TransactionCoordinator - Transaction committed for user 689258T: chatCompletionId=chat-fbd65c38-1672-4592-aa8a-3f2154adab31
2025-05-09 15:27:26.868 [FileWrite-2] INFO  com.bgpay.bgai.service.deepseek.FileWriterService - Successfully wrote content to: \var\data\ai_responses\581bc5a8-b81c-4148-9918-7c64a571ba29.txt
2025-05-09 15:27:26.873 [boundedElastic-3] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - ==>  Preparing: INSERT INTO chat_completions ( object, created, model, system_fingerprint, api_key ) VALUES ( ?, ?, ?, ?, ? )
2025-05-09 15:27:26.874 [boundedElastic-3] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - ==> Parameters: chat.completion(String), 1746775633(Long), deepseek-chat(String), fp_8802369eaa_prod0425fp8(String), chat-fbd65c38-1672-4592-aa8a-3f2154adab31(String)
2025-05-09 15:27:26.886 [boundedElastic-3] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - <==    Updates: 1
2025-05-09 15:27:26.906 [boundedElastic-3] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.insert - ==>  Preparing: INSERT INTO usage_info ( chat_completion_id, prompt_tokens, completion_tokens, total_tokens, prompt_tokens_cached, completion_reasoning_tokens, prompt_cache_hit_tokens, prompt_cache_miss_tokens, created_at, model_type ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-05-09 15:27:26.907 [boundedElastic-3] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.insert - ==> Parameters: chat-fbd65c38-1672-4592-aa8a-3f2154adab31(String), 51(Integer), 178(Integer), 229(Integer), 0(Integer), 0(Integer), 0(Integer), 51(Integer), 2025-05-09T15:27:26.901759500(LocalDateTime), deepseek-chat(String)
2025-05-09 15:27:26.918 [boundedElastic-3] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.insert - <==    Updates: 1
2025-05-09 15:27:26.949 [boundedElastic-3] INFO  org.reflections.Reflections - Completion data saved synchronously for chatCompletionId: chat-fbd65c38-1672-4592-aa8a-3f2154adab31
2025-05-09 15:27:26.949 [boundedElastic-4] INFO  org.reflections.Reflections - 开始发送账单消息，chatCompletionId: chat-fbd65c38-1672-4592-aa8a-3f2154adab31, userId: 689258T
2025-05-09 15:27:26.963 [boundedElastic-4] INFO  org.reflections.Reflections - 账单消息发送成功，chatCompletionId: chat-fbd65c38-1672-4592-aa8a-3f2154adab31, userId: 689258T
2025-05-09 15:27:26.964 [boundedElastic-3] INFO  org.reflections.Reflections - Complete processing chain completed: 由于您上传的是PDF格式的简历文件，而AI系统无法直接查看或解析文件内容，我需要根据您后续提出的具体问题来提供帮助。例如：

1. 如果您需要优化简历内容，可以告知具体需求（如突出某方面能力/调整格式等）
2. 如果您想了解简历中的特定信息，请描述需要查询的内容
3. 如果是简历转换/编辑等技术问题，请说明具体操作需求

请补充您的具体需求，我将为您提供针对性建议。以下是一些常见简历相关问题的解决方案供参考：

▸ 内容优化：工作经历描述、技能展示技巧
▸ 格式调整：排版规范、字体建议
▸ ATS系统适配：关键词优化方法
▸ 不同用途版本：求职/考研/留学差异

（为保护隐私，建议不要直接分享文件中的个人信息）
2025-05-09 15:27:26.964 [boundedElastic-3] INFO  com.bgpay.bgai.controller.ReactiveChatController - Processed response for user 689258T, content length: 309
2025-05-09 15:28:19.724 [pool-7-thread-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.selectCount - ==>  Preparing: SELECT COUNT( * ) AS total FROM usage_info WHERE (chat_completion_id = ?)
2025-05-09 15:28:19.724 [pool-7-thread-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.selectCount - ==> Parameters: chat-fbd65c38-1672-4592-aa8a-3f2154adab31(String)
2025-05-09 15:28:19.730 [pool-7-thread-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.selectCount - <==      Total: 1
2025-05-09 15:28:19.841 [ConsumeMessageThread_billing-consumer-group_2] INFO  c.bgpay.bgai.service.mq.RocketMQBillingServiceImpl - Output price config priceVersion: 1
2025-05-09 15:28:19.842 [ConsumeMessageThread_billing-consumer-group_2] DEBUG com.bgpay.bgai.mapper.UsageRecordMapper.insert - ==>  Preparing: INSERT INTO usage_record ( model_type, chat_completion_id, user_id, input_cost, output_cost, price_version, calculated_at ) VALUES ( ?, ?, ?, ?, ?, ?, ? )
2025-05-09 15:28:19.842 [ConsumeMessageThread_billing-consumer-group_2] DEBUG com.bgpay.bgai.mapper.UsageRecordMapper.insert - ==> Parameters: deepseek-chat(String), chat-fbd65c38-1672-4592-aa8a-3f2154adab31(String), 689258T(String), 0.0001(BigDecimal), 0.0014(BigDecimal), 1(Integer), 2025-05-09T15:28:19.841836800(LocalDateTime)
2025-05-09 15:28:19.861 [ConsumeMessageThread_billing-consumer-group_2] DEBUG com.bgpay.bgai.mapper.UsageRecordMapper.insert - <==    Updates: 1
2025-05-09 15:28:19.868 [ConsumeMessageThread_billing-consumer-group_2] INFO  c.bgpay.bgai.service.mq.RocketMQBillingServiceImpl - Message consumed: 2408820C75288342F58D761159F69FAB05A436BAF30C2C83FAE60002
2025-05-09 15:28:25.915 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-09 15:28:25.916 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-09 15:28:25.929 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-09 15:28:25.931 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-09 15:28:25.931 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-09 15:28:25.939 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-09 15:33:25.919 [scheduling-1] WARN  com.alibaba.druid.pool.DruidAbstractDataSource - discard long time none received connection. , jdbcUrl : jdbc:mysql://8.133.246.113:3306/deepseek?autoReconnect=false&useUnicode=true&characterEncoding=UTF-8&characterSetResults=UTF-8&zeroDateTimeBehavior=convertToNull&useSSL=false&allowPublicKeyRetrieval=true&useSSL=false, version : 1.2.8, lastPacketReceivedIdleMillis : 299981
2025-05-09 15:33:25.981 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-09 15:33:25.982 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-09 15:33:25.997 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-09 15:33:25.997 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-09 15:33:25.997 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-09 15:33:26.003 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-09 15:36:02.452 [http-nio-8080-exec-5] ERROR o.s.b.a.w.r.error.AbstractErrorWebExceptionHandler - [6b5a8ab6]  500 Server Error for HTTP POST "/Api/chat"
org.springframework.data.redis.RedisSystemException: Redis exception
	at org.springframework.data.redis.connection.lettuce.LettuceExceptionConverter.convert(LettuceExceptionConverter.java:72)
	Suppressed: reactor.core.publisher.FluxOnAssembly$OnAssemblyException: 
Assembly trace from producer [reactor.core.publisher.MonoDefer] :
	reactor.core.publisher.Mono.defer(Mono.java:218)
	org.springframework.web.server.handler.DefaultWebFilterChain.filter(DefaultWebFilterChain.java:106)
Error has been observed at the following site(s):
	*______________Mono.defer ⇢ at org.springframework.web.server.handler.DefaultWebFilterChain.filter(DefaultWebFilterChain.java:106)
	|_             checkpoint ⇢ org.springframework.cloud.gateway.filter.WeightCalculatorWebFilter [DefaultWebFilterChain]
	*______________Mono.defer ⇢ at org.springframework.web.server.handler.DefaultWebFilterChain.filter(DefaultWebFilterChain.java:106)
	|_          Mono.doOnEach ⇢ at org.springframework.web.filter.reactive.ServerHttpObservationFilter.filter(ServerHttpObservationFilter.java:109)
	|_        Mono.doOnCancel ⇢ at org.springframework.web.filter.reactive.ServerHttpObservationFilter.filter(ServerHttpObservationFilter.java:119)
	|_      Mono.contextWrite ⇢ at org.springframework.web.filter.reactive.ServerHttpObservationFilter.filter(ServerHttpObservationFilter.java:123)
	*__Mono.transformDeferred ⇢ at org.springframework.web.filter.reactive.ServerHttpObservationFilter.filter(ServerHttpObservationFilter.java:102)
	|_             checkpoint ⇢ org.springframework.web.filter.reactive.ServerHttpObservationFilter [DefaultWebFilterChain]
	*______________Mono.defer ⇢ at org.springframework.web.server.handler.DefaultWebFilterChain.filter(DefaultWebFilterChain.java:106)
	|_     Mono.onErrorResume ⇢ at org.springframework.web.server.handler.ExceptionHandlingWebHandler.handle(ExceptionHandlingWebHandler.java:77)
	|_     Mono.onErrorResume ⇢ at org.springframework.web.server.handler.ExceptionHandlingWebHandler.handle(ExceptionHandlingWebHandler.java:77)
	*______________Mono.error ⇢ at org.springframework.web.server.handler.ExceptionHandlingWebHandler$CheckpointInsertingHandler.handle(ExceptionHandlingWebHandler.java:98)
	|_             checkpoint ⇢ HTTP POST "/Api/chat" [ExceptionHandlingWebHandler]
	*______________Mono.error ⇢ at org.springframework.cloud.gateway.filter.headers.observation.ObservationClosingWebExceptionHandler.handle(ObservationClosingWebExceptionHandler.java:53)
Original Stack Trace:
		at org.springframework.data.redis.connection.lettuce.LettuceExceptionConverter.convert(LettuceExceptionConverter.java:72)
		at org.springframework.data.redis.connection.lettuce.LettuceExceptionConverter.convert(LettuceExceptionConverter.java:41)
		at org.springframework.data.redis.PassThroughExceptionTranslationStrategy.translate(PassThroughExceptionTranslationStrategy.java:40)
		at org.springframework.data.redis.FallbackExceptionTranslationStrategy.translate(FallbackExceptionTranslationStrategy.java:38)
		at org.springframework.data.redis.connection.lettuce.LettuceConnection.convertLettuceAccessException(LettuceConnection.java:256)
		at org.springframework.data.redis.connection.lettuce.LettuceConnection.await(LettuceConnection.java:969)
		at org.springframework.data.redis.connection.lettuce.LettuceConnection.lambda$doInvoke$4(LettuceConnection.java:826)
		at org.springframework.data.redis.connection.lettuce.LettuceInvoker$Synchronizer.invoke(LettuceInvoker.java:665)
		at org.springframework.data.redis.connection.lettuce.LettuceInvoker.just(LettuceInvoker.java:94)
		at org.springframework.data.redis.connection.lettuce.LettuceStringCommands.get(LettuceStringCommands.java:54)
		at org.springframework.data.redis.connection.DefaultedRedisConnection.get(DefaultedRedisConnection.java:284)
		at org.springframework.data.redis.core.DefaultValueOperations$1.inRedis(DefaultValueOperations.java:54)
		at org.springframework.data.redis.core.AbstractOperations$ValueDeserializingRedisCallback.doInRedis(AbstractOperations.java:61)
		at org.springframework.data.redis.core.RedisTemplate.execute(RedisTemplate.java:406)
		at org.springframework.data.redis.core.RedisTemplate.execute(RedisTemplate.java:373)
		at org.springframework.data.redis.core.AbstractOperations.execute(AbstractOperations.java:97)
		at org.springframework.data.redis.core.DefaultValueOperations.get(DefaultValueOperations.java:50)
		at com.bgpay.bgai.service.impl.UserServiceImpl.validateToken(UserServiceImpl.java:210)
		at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
		at java.base/java.lang.reflect.Method.invoke(Method.java:580)
		at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:343)
		at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
		at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
		at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:751)
		at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)
		at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
		at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:751)
		at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:703)
		at com.bgpay.bgai.service.impl.UserServiceImpl$$SpringCGLIB$$0.validateToken(<generated>)
		at com.bgpay.bgai.config.AuthenticationFilter.filter(AuthenticationFilter.java:70)
		at org.springframework.web.server.handler.DefaultWebFilterChain.invokeFilter(DefaultWebFilterChain.java:114)
		at org.springframework.web.server.handler.DefaultWebFilterChain.lambda$filter$0(DefaultWebFilterChain.java:108)
		at reactor.core.publisher.MonoDefer.subscribe(MonoDefer.java:45)
		at reactor.core.publisher.InternalMonoOperator.subscribe(InternalMonoOperator.java:64)
		at reactor.core.publisher.MonoDefer.subscribe(MonoDefer.java:53)
		at reactor.core.publisher.InternalMonoOperator.subscribe(InternalMonoOperator.java:64)
		at reactor.core.publisher.MonoDefer.subscribe(MonoDefer.java:53)
		at reactor.core.publisher.InternalMonoOperator.subscribe(InternalMonoOperator.java:64)
		at reactor.core.publisher.MonoDefer.subscribe(MonoDefer.java:53)
		at reactor.core.publisher.Mono.subscribe(Mono.java:4495)
		at reactor.core.publisher.MonoIgnoreThen$ThenIgnoreMain.subscribeNext(MonoIgnoreThen.java:263)
		at reactor.core.publisher.MonoIgnoreThen.subscribe(MonoIgnoreThen.java:51)
		at reactor.core.publisher.Mono.subscribe(Mono.java:4495)
		at reactor.core.publisher.MonoIgnoreThen$ThenIgnoreMain.subscribeNext(MonoIgnoreThen.java:263)
		at reactor.core.publisher.MonoIgnoreThen.subscribe(MonoIgnoreThen.java:51)
		at reactor.core.publisher.Mono.subscribe(Mono.java:4495)
		at org.springframework.http.server.reactive.ServletHttpHandlerAdapter.service(ServletHttpHandlerAdapter.java:199)
		at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205)
		at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
		at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
		at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
		at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
		at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
		at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
		at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
		at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
		at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
		at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
		at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:340)
		at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
		at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
		at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
		at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744)
		at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
		at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
		at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
		at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
		at java.base/java.lang.Thread.run(Thread.java:1583)
Caused by: io.lettuce.core.RedisException: java.net.SocketException: Connection reset
	at io.lettuce.core.internal.Exceptions.bubble(Exceptions.java:83)
	at io.lettuce.core.internal.Futures.awaitOrCancel(Futures.java:250)
	at io.lettuce.core.LettuceFutures.awaitOrCancel(LettuceFutures.java:74)
	at org.springframework.data.redis.connection.lettuce.LettuceConnection.await(LettuceConnection.java:967)
	at org.springframework.data.redis.connection.lettuce.LettuceConnection.lambda$doInvoke$4(LettuceConnection.java:826)
	at org.springframework.data.redis.connection.lettuce.LettuceInvoker$Synchronizer.invoke(LettuceInvoker.java:665)
	at org.springframework.data.redis.connection.lettuce.LettuceInvoker.just(LettuceInvoker.java:94)
	at org.springframework.data.redis.connection.lettuce.LettuceStringCommands.get(LettuceStringCommands.java:54)
	at org.springframework.data.redis.connection.DefaultedRedisConnection.get(DefaultedRedisConnection.java:284)
	at org.springframework.data.redis.core.DefaultValueOperations$1.inRedis(DefaultValueOperations.java:54)
	at org.springframework.data.redis.core.AbstractOperations$ValueDeserializingRedisCallback.doInRedis(AbstractOperations.java:61)
	at org.springframework.data.redis.core.RedisTemplate.execute(RedisTemplate.java:406)
	at org.springframework.data.redis.core.RedisTemplate.execute(RedisTemplate.java:373)
	at org.springframework.data.redis.core.AbstractOperations.execute(AbstractOperations.java:97)
	at org.springframework.data.redis.core.DefaultValueOperations.get(DefaultValueOperations.java:50)
	at com.bgpay.bgai.service.impl.UserServiceImpl.validateToken(UserServiceImpl.java:210)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:343)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:751)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:751)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:703)
	at com.bgpay.bgai.service.impl.UserServiceImpl$$SpringCGLIB$$0.validateToken(<generated>)
	at com.bgpay.bgai.config.AuthenticationFilter.filter(AuthenticationFilter.java:70)
	at org.springframework.web.server.handler.DefaultWebFilterChain.invokeFilter(DefaultWebFilterChain.java:114)
	at org.springframework.web.server.handler.DefaultWebFilterChain.lambda$filter$0(DefaultWebFilterChain.java:108)
	at reactor.core.publisher.MonoDefer.subscribe(MonoDefer.java:45)
	at reactor.core.publisher.InternalMonoOperator.subscribe(InternalMonoOperator.java:64)
	at reactor.core.publisher.MonoDefer.subscribe(MonoDefer.java:53)
	at reactor.core.publisher.InternalMonoOperator.subscribe(InternalMonoOperator.java:64)
	at reactor.core.publisher.MonoDefer.subscribe(MonoDefer.java:53)
	at reactor.core.publisher.InternalMonoOperator.subscribe(InternalMonoOperator.java:64)
	at reactor.core.publisher.MonoDefer.subscribe(MonoDefer.java:53)
	at reactor.core.publisher.Mono.subscribe(Mono.java:4495)
	at reactor.core.publisher.MonoIgnoreThen$ThenIgnoreMain.subscribeNext(MonoIgnoreThen.java:263)
	at reactor.core.publisher.MonoIgnoreThen.subscribe(MonoIgnoreThen.java:51)
	at reactor.core.publisher.Mono.subscribe(Mono.java:4495)
	at reactor.core.publisher.MonoIgnoreThen$ThenIgnoreMain.subscribeNext(MonoIgnoreThen.java:263)
	at reactor.core.publisher.MonoIgnoreThen.subscribe(MonoIgnoreThen.java:51)
	at reactor.core.publisher.Mono.subscribe(Mono.java:4495)
	at org.springframework.http.server.reactive.ServletHttpHandlerAdapter.service(ServletHttpHandlerAdapter.java:199)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:340)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.base/java.lang.Thread.run(Thread.java:1583)
Caused by: java.net.SocketException: Connection reset
	at java.base/sun.nio.ch.SocketChannelImpl.throwConnectionReset(SocketChannelImpl.java:401)
	at java.base/sun.nio.ch.SocketChannelImpl.read(SocketChannelImpl.java:434)
	at io.netty.buffer.PooledByteBuf.setBytes(PooledByteBuf.java:254)
	at io.netty.buffer.AbstractByteBuf.writeBytes(AbstractByteBuf.java:1132)
	at io.netty.channel.socket.nio.NioSocketChannel.doReadBytes(NioSocketChannel.java:357)
	at io.netty.channel.nio.AbstractNioByteChannel$NioByteUnsafe.read(AbstractNioByteChannel.java:151)
	at io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:788)
	at io.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:724)
	at io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:650)
	at io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:562)
	at io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:997)
	at io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	... 1 common frames omitted
2025-05-09 15:36:19.133 [Thread-1] WARN  c.alibaba.nacos.common.http.HttpClientBeanHolder - [HttpClientBeanHolder] Start destroying common HttpClient
2025-05-09 15:36:19.133 [Thread-7] WARN  com.alibaba.nacos.common.notify.NotifyCenter - [NotifyCenter] Start destroying Publisher
2025-05-09 15:36:19.133 [Thread-7] WARN  com.alibaba.nacos.common.notify.NotifyCenter - [NotifyCenter] Destruction of the end
2025-05-09 15:36:19.135 [Thread-1] WARN  c.alibaba.nacos.common.http.HttpClientBeanHolder - [HttpClientBeanHolder] Destruction of the end
2025-05-09 15:36:19.213 [SpringApplicationShutdownHook] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - De-registering from Nacos Server now...
2025-05-09 15:36:19.213 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - [DEREGISTER-SERVICE] d750d92e-152f-4055-a641-3bc9dda85a29 deregistering service bgai with instance: Instance{instanceId='null', ip='192.168.86.8', port=8080, weight=1.0, healthy=true, enabled=true, ephemeral=true, clusterName='DEFAULT', serviceName='null', metadata={}}
2025-05-09 15:36:19.250 [SpringApplicationShutdownHook] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - De-registration finished.
2025-05-09 15:36:19.251 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.cache.ServiceInfoHolder do shutdown begin
2025-05-09 15:36:19.251 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.backups.FailoverReactor do shutdown begin
2025-05-09 15:36:19.251 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.backups.FailoverReactor do shutdown stop
2025-05-09 15:36:19.251 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.cache.ServiceInfoHolder do shutdown stop
2025-05-09 15:36:19.251 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.NamingClientProxyDelegate do shutdown begin
2025-05-09 15:36:19.251 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServiceInfoUpdateService do shutdown begin
2025-05-09 15:36:19.251 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServiceInfoUpdateService do shutdown stop
2025-05-09 15:36:19.251 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServerListManager do shutdown begin
2025-05-09 15:36:19.252 [SpringApplicationShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Start destroying NacosRestTemplate
2025-05-09 15:36:19.252 [SpringApplicationShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Destruction of the end
2025-05-09 15:36:19.252 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServerListManager do shutdown stop
2025-05-09 15:36:19.252 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.http.NamingHttpClientProxy do shutdown begin
2025-05-09 15:36:19.252 [SpringApplicationShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Start destroying NacosRestTemplate
2025-05-09 15:36:19.252 [SpringApplicationShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Destruction of the end
2025-05-09 15:36:19.252 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.http.NamingHttpClientProxy do shutdown stop
2025-05-09 15:36:19.252 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Shutdown rpc client, set status to shutdown
2025-05-09 15:36:19.252 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Shutdown client event executor java.util.concurrent.ScheduledThreadPoolExecutor@4cc93e77[Running, pool size = 2, active threads = 2, queued tasks = 0, completed tasks = 0]
2025-05-09 15:36:19.252 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Close current connection 1746775405648_139.227.195.203_43876
2025-05-09 15:36:19.255 [nacos-grpc-client-executor-8.133.246.113-171] WARN  c.a.nacos.common.remote.client.grpc.GrpcClient - [1746775405648_139.227.195.203_43876]Ignore error event,isRunning:false,isAbandon=false
2025-05-09 15:36:19.257 [SpringApplicationShutdownHook] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - Shutdown grpc executor java.util.concurrent.ThreadPoolExecutor@26bc84dc[Running, pool size = 4, active threads = 0, queued tasks = 0, completed tasks = 172]
2025-05-09 15:36:19.257 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - Shutdown grpc redo service executor java.util.concurrent.ScheduledThreadPoolExecutor@5f4fdc1f[Running, pool size = 1, active threads = 0, queued tasks = 1, completed tasks = 257]
2025-05-09 15:36:19.258 [SpringApplicationShutdownHook] INFO  c.a.n.client.auth.ram.identify.CredentialWatcher - [null] CredentialWatcher is stopped
2025-05-09 15:36:19.258 [SpringApplicationShutdownHook] INFO  c.a.n.client.auth.ram.identify.CredentialService - [null] CredentialService is freed
2025-05-09 15:36:19.258 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.NamingClientProxyDelegate do shutdown stop
2025-05-09 15:36:19.295 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:10909] result: true
2025-05-09 15:36:19.295 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:9876] result: true
2025-05-09 15:36:19.295 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:10911] result: true
2025-05-09 15:36:19.309 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:10911] result: true
2025-05-09 15:36:19.309 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:9876] result: true
2025-05-09 15:36:21.509 [SpringApplicationShutdownHook] INFO  o.s.orm.jpa.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-05-09 15:36:21.511 [SpringApplicationShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-0} closing ...
2025-05-09 15:36:21.511 [SpringApplicationShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} closing ...
2025-05-09 15:36:21.512 [SpringApplicationShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} closed
2025-05-09 15:38:01.048 [main] WARN  com.alibaba.nacos.client.logging.NacosLogging - Load Logback Configuration of Nacos fail, message: Could not initialize Logback Nacos logging from classpath:nacos-logback.xml
2025-05-09 15:38:01.049 [main] INFO  com.bgpay.bgai.BgaiApplication - The following 1 profile is active: "dev"
2025-05-09 15:38:02.278 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-05-09 15:38:02.280 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-05-09 15:38:02.302 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 17 ms. Found 0 JPA repository interfaces.
2025-05-09 15:38:02.315 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-05-09 15:38:02.317 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-05-09 15:38:02.330 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 4 ms. Found 0 Redis repository interfaces.
2025-05-09 15:38:02.487 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'allowedFileTypeMapper' and 'com.bgpay.bgai.mapper.AllowedFileTypeMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 15:38:02.487 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'apiConfigMapper' and 'com.bgpay.bgai.mapper.ApiConfigMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 15:38:02.487 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'chatCompletionsMapper' and 'com.bgpay.bgai.mapper.ChatCompletionsMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 15:38:02.487 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'choicesMapper' and 'com.bgpay.bgai.mapper.ChoicesMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 15:38:02.487 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'fileTypeMapper' and 'com.bgpay.bgai.mapper.FileTypeMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 15:38:02.487 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'priceConfigMapper' and 'com.bgpay.bgai.mapper.PriceConfigMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 15:38:02.487 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'priceVersionMapper' and 'com.bgpay.bgai.mapper.PriceVersionMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 15:38:02.487 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'usageInfoMapper' and 'com.bgpay.bgai.mapper.UsageInfoMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 15:38:02.488 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'usageRecordMapper' and 'com.bgpay.bgai.mapper.UsageRecordMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 15:38:02.488 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'userMapper' and 'com.bgpay.bgai.mapper.UserMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 15:38:02.488 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - No MyBatis mapper was found in '[com.bgpay.bgai.mapper]' package. Please check your configuration.
2025-05-09 15:38:02.493 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'allowedFileTypeMapper' and 'com.bgpay.bgai.mapper.AllowedFileTypeMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 15:38:02.493 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'apiConfigMapper' and 'com.bgpay.bgai.mapper.ApiConfigMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 15:38:02.493 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'chatCompletionsMapper' and 'com.bgpay.bgai.mapper.ChatCompletionsMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 15:38:02.493 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'choicesMapper' and 'com.bgpay.bgai.mapper.ChoicesMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 15:38:02.493 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'fileTypeMapper' and 'com.bgpay.bgai.mapper.FileTypeMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 15:38:02.493 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'priceConfigMapper' and 'com.bgpay.bgai.mapper.PriceConfigMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 15:38:02.493 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'priceVersionMapper' and 'com.bgpay.bgai.mapper.PriceVersionMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 15:38:02.493 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'usageInfoMapper' and 'com.bgpay.bgai.mapper.UsageInfoMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 15:38:02.493 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'usageRecordMapper' and 'com.bgpay.bgai.mapper.UsageRecordMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 15:38:02.493 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'userMapper' and 'com.bgpay.bgai.mapper.UserMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 15:38:02.493 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - No MyBatis mapper was found in '[com.bgpay.bgai.mapper]' package. Please check your configuration.
2025-05-09 15:38:02.771 [main] INFO  o.springframework.cloud.context.scope.GenericScope - BeanFactory id=211f639f-b569-3ff2-bdfe-bb9155c8549b
2025-05-09 15:38:03.049 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'org.springframework.cloud.commons.config.CommonsConfigAutoConfiguration' of type [org.springframework.cloud.commons.config.CommonsConfigAutoConfiguration] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 15:38:03.057 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'org.springframework.cloud.client.loadbalancer.LoadBalancerDefaultMappingsProviderAutoConfiguration' of type [org.springframework.cloud.client.loadbalancer.LoadBalancerDefaultMappingsProviderAutoConfiguration] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 15:38:03.061 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'loadBalancerClientsDefaultsMappingsProvider' of type [org.springframework.cloud.client.loadbalancer.LoadBalancerDefaultMappingsProviderAutoConfiguration$$Lambda/0x000001ae01725f98] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 15:38:03.071 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'defaultsBindHandlerAdvisor' of type [org.springframework.cloud.commons.config.DefaultsBindHandlerAdvisor] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 15:38:03.103 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'spring.datasource.dynamic-com.baomidou.dynamic.datasource.spring.boot.autoconfigure.DynamicDataSourceProperties' of type [com.baomidou.dynamic.datasource.spring.boot.autoconfigure.DynamicDataSourceProperties] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 15:38:03.115 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'com.baomidou.dynamic.datasource.spring.boot.autoconfigure.DynamicDataSourceAutoConfiguration' of type [com.baomidou.dynamic.datasource.spring.boot.autoconfigure.DynamicDataSourceAutoConfiguration$$SpringCGLIB$$0] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 15:38:03.133 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'dsProcessor' of type [com.baomidou.dynamic.datasource.processor.jakarta.DsJakartaHeaderProcessor] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 15:38:03.448 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'messageConverterConfiguration' of type [org.apache.rocketmq.spring.autoconfigure.MessageConverterConfiguration$$SpringCGLIB$$0] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 15:38:03.518 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'createRocketMQMessageConverter' of type [org.apache.rocketmq.spring.support.RocketMQMessageConverter] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 15:38:03.526 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'rocketmq-org.apache.rocketmq.spring.autoconfigure.RocketMQProperties' of type [org.apache.rocketmq.spring.autoconfigure.RocketMQProperties] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 15:38:03.530 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'listenerContainerConfiguration' of type [org.apache.rocketmq.spring.autoconfigure.ListenerContainerConfiguration$$SpringCGLIB$$0] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 15:38:03.562 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'org.springframework.cloud.client.loadbalancer.reactive.LoadBalancerBeanPostProcessorAutoConfiguration' of type [org.springframework.cloud.client.loadbalancer.reactive.LoadBalancerBeanPostProcessorAutoConfiguration] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 15:38:03.565 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'org.springframework.cloud.client.loadbalancer.reactive.LoadBalancerBeanPostProcessorAutoConfiguration$ReactorDeferringLoadBalancerFilterConfig' of type [org.springframework.cloud.client.loadbalancer.reactive.LoadBalancerBeanPostProcessorAutoConfiguration$ReactorDeferringLoadBalancerFilterConfig] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 15:38:03.569 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'reactorDeferringLoadBalancerExchangeFilterFunction' of type [org.springframework.cloud.client.loadbalancer.reactive.DeferringLoadBalancerExchangeFilterFunction] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 15:38:03.835 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat initialized with port(s): 8080 (http)
2025-05-09 15:38:03.845 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - Initializing ProtocolHandler ["http-nio-8080"]
2025-05-09 15:38:03.846 [main] INFO  org.apache.catalina.core.StandardService - Starting service [Tomcat]
2025-05-09 15:38:03.847 [main] INFO  org.apache.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.15]
2025-05-09 15:38:04.282 [main] INFO  org.hibernate.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-05-09 15:38:04.329 [main] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.1.7.Final
2025-05-09 15:38:04.660 [main] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} inited
2025-05-09 15:38:04.831 [main] INFO  SQL dialect - HHH000400: Using dialect: org.hibernate.dialect.MySQL8Dialect
2025-05-09 15:38:04.832 [main] WARN  org.hibernate.orm.deprecation - HHH90000026: MySQL8Dialect has been deprecated; use org.hibernate.dialect.MySQLDialect instead
2025-05-09 15:38:05.095 [main] INFO  o.h.e.t.jta.platform.internal.JtaPlatformInitiator - HHH000490: Using JtaPlatform implementation: [org.hibernate.engine.transaction.jta.platform.internal.NoJtaPlatform]
2025-05-09 15:38:05.106 [main] INFO  o.s.orm.jpa.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-05-09 15:38:05.496 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-09 15:38:05.519 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-09 15:38:05.552 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-09 15:38:05.554 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-09 15:38:05.554 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-09 15:38:05.567 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-09 15:38:06.222 [main] INFO  com.bgpay.bgai.service.impl.UserServiceImpl - 初始化SSO配置: clientId=bgai-client-id, redirectUri=http://localhost:8080/api/auth/callback
2025-05-09 15:38:06.295 [main] INFO  com.bgpay.bgai.controller.AuthController - 初始化认证控制器: clientId=bgai-client-id, redirectUri=http://localhost:8080/api/auth/callback
2025-05-09 15:38:07.107 [main] INFO  o.a.r.s.autoconfigure.RocketMQAutoConfiguration - a producer (billing-producer-group) init on namesrv 8.133.246.113:9876
2025-05-09 15:38:07.955 [main] INFO  org.redisson.Version - Redisson 3.24.3
2025-05-09 15:38:08.089 [redisson-netty-4-8] INFO  o.r.connection.pool.MasterPubSubConnectionPool - 1 connections initialized for 8.133.246.113/8.133.246.113:6379
2025-05-09 15:38:08.433 [redisson-netty-4-19] INFO  org.redisson.connection.pool.MasterConnectionPool - 24 connections initialized for 8.133.246.113/8.133.246.113:6379
2025-05-09 15:38:08.647 [main] INFO  com.bgpay.bgai.service.mq.MQConsumerService - MQ consumer startup successful [group=billing-consumer-group, topic=BILLING_TOPIC, tag=USER_BILLING]
2025-05-09 15:38:09.824 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [After]
2025-05-09 15:38:09.824 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Before]
2025-05-09 15:38:09.824 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Between]
2025-05-09 15:38:09.824 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Cookie]
2025-05-09 15:38:09.824 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Header]
2025-05-09 15:38:09.824 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Host]
2025-05-09 15:38:09.824 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Method]
2025-05-09 15:38:09.824 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Path]
2025-05-09 15:38:09.824 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Query]
2025-05-09 15:38:09.824 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [ReadBody]
2025-05-09 15:38:09.824 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [RemoteAddr]
2025-05-09 15:38:09.824 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [XForwardedRemoteAddr]
2025-05-09 15:38:09.825 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Weight]
2025-05-09 15:38:09.825 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [CloudFoundryRouteService]
2025-05-09 15:38:11.142 [main] INFO  o.s.b.actuate.endpoint.web.EndpointLinksResolver - Exposing 1 endpoint(s) beneath base path '/actuator'
2025-05-09 15:38:12.413 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - Starting ProtocolHandler ["http-nio-8080"]
2025-05-09 15:38:12.426 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat started on port(s): 8080 (http) with context path ''
2025-05-09 15:38:12.436 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from ans.namespace attribute : null
2025-05-09 15:38:12.436 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from ALIBABA_ALIWARE_NAMESPACE attribute :null
2025-05-09 15:38:12.437 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from namespace attribute :null
2025-05-09 15:38:12.444 [main] INFO  c.a.n.p.auth.spi.client.ClientAuthPluginManager - [ClientAuthPluginManager] Load ClientAuthService com.alibaba.nacos.client.auth.impl.NacosClientAuthServiceImpl success.
2025-05-09 15:38:12.444 [main] INFO  c.a.n.p.auth.spi.client.ClientAuthPluginManager - [ClientAuthPluginManager] Load ClientAuthService com.alibaba.nacos.client.auth.ram.RamClientAuthServiceImpl success.
2025-05-09 15:38:12.447 [main] INFO  com.alibaba.nacos.common.remote.client - [RpcClientFactory] create a new rpc client of 32b9221d-fec0-49c4-9a16-73c7c93aa5bd
2025-05-09 15:38:12.448 [main] INFO  com.alibaba.nacos.common.remote.client - [32b9221d-fec0-49c4-9a16-73c7c93aa5bd] RpcClient init, ServerListFactory = com.alibaba.nacos.client.naming.core.ServerListManager
2025-05-09 15:38:12.448 [main] INFO  com.alibaba.nacos.common.remote.client - [32b9221d-fec0-49c4-9a16-73c7c93aa5bd] Registry connection listener to current client:com.alibaba.nacos.client.naming.remote.gprc.redo.NamingGrpcRedoService
2025-05-09 15:38:12.449 [main] INFO  com.alibaba.nacos.common.remote.client - [32b9221d-fec0-49c4-9a16-73c7c93aa5bd] Register server push request handler:com.alibaba.nacos.client.naming.remote.gprc.NamingPushRequestHandler
2025-05-09 15:38:12.449 [main] INFO  com.alibaba.nacos.common.remote.client - [32b9221d-fec0-49c4-9a16-73c7c93aa5bd] Try to connect to server on start up, server: {serverIp = '8.133.246.113', server main port = 8848}
2025-05-09 15:38:12.449 [main] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - grpc client connection server:8.133.246.113 ip,serverPort:9848,grpcTslConfig:{"sslProvider":"OPENSSL","enableTls":false,"mutualAuthEnable":false,"trustAll":false}
2025-05-09 15:38:12.578 [main] INFO  com.alibaba.nacos.common.remote.client - [32b9221d-fec0-49c4-9a16-73c7c93aa5bd] Success to connect to server [8.133.246.113:8848] on start up, connectionId = 1746776292387_139.227.195.203_42747
2025-05-09 15:38:12.578 [main] INFO  com.alibaba.nacos.common.remote.client - [32b9221d-fec0-49c4-9a16-73c7c93aa5bd] Register server push request handler:com.alibaba.nacos.common.remote.client.RpcClient$ConnectResetRequestHandler
2025-05-09 15:38:12.578 [main] INFO  com.alibaba.nacos.common.remote.client - [32b9221d-fec0-49c4-9a16-73c7c93aa5bd] Register server push request handler:com.alibaba.nacos.common.remote.client.RpcClient$$Lambda/0x000001ae01528000
2025-05-09 15:38:12.578 [com.alibaba.nacos.client.remote.worker] INFO  com.alibaba.nacos.common.remote.client - [32b9221d-fec0-49c4-9a16-73c7c93aa5bd] Notify connected event to listeners.
2025-05-09 15:38:12.578 [com.alibaba.nacos.client.remote.worker] INFO  com.alibaba.nacos.client.naming - Grpc connection connect
2025-05-09 15:38:12.579 [main] INFO  com.alibaba.nacos.client.naming - [REGISTER-SERVICE] d750d92e-152f-4055-a641-3bc9dda85a29 registering service bgai with instance Instance{instanceId='null', ip='192.168.86.8', port=8080, weight=1.0, healthy=true, enabled=true, ephemeral=true, clusterName='DEFAULT', serviceName='null', metadata={IPv6=[2408:820c:7528:8342:f58d:7611:59f6:9fab], preserved.register.source=SPRING_CLOUD}}
2025-05-09 15:38:12.596 [main] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - nacos registry, DEFAULT_GROUP bgai 192.168.86.8:8080 register finished
2025-05-09 15:38:12.642 [main] INFO  com.bgpay.bgai.BgaiApplication - Started BgaiApplication in 13.93 seconds (process running for 15.363)
2025-05-09 15:38:12.645 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-09 15:38:12.645 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-09 15:38:12.657 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-09 15:38:12.657 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-09 15:38:12.657 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-09 15:38:12.667 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-09 15:38:12.667 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-09 15:38:12.667 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-09 15:38:12.677 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-09 15:38:12.677 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-09 15:38:12.678 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-09 15:38:12.688 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-09 15:38:12.692 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - nacos.cache.data.init.snapshot = true 
2025-05-09 15:38:12.693 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] common-dev.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-09 15:38:12.700 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=common-dev.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-09 15:38:12.700 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=common-dev.yaml, group=DEFAULT_GROUP
2025-05-09 15:38:12.701 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-09 15:38:12.702 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-09 15:38:12.702 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai.yaml, group=DEFAULT_GROUP
2025-05-09 15:38:12.702 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai-dev.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-09 15:38:12.702 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai-dev.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-09 15:38:12.702 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai-dev.yaml, group=DEFAULT_GROUP
2025-05-09 15:38:12.702 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-09 15:38:12.702 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai, group=DEFAULT_GROUP, cnt=1
2025-05-09 15:38:12.702 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai, group=DEFAULT_GROUP
2025-05-09 15:43:14.650 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-09 15:43:14.651 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-09 15:43:14.659 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-09 15:43:14.659 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-09 15:43:14.659 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-09 15:43:14.667 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-09 15:43:16.494 [Thread-7] WARN  com.alibaba.nacos.common.notify.NotifyCenter - [NotifyCenter] Start destroying Publisher
2025-05-09 15:43:16.494 [Thread-1] WARN  c.alibaba.nacos.common.http.HttpClientBeanHolder - [HttpClientBeanHolder] Start destroying common HttpClient
2025-05-09 15:43:16.494 [Thread-7] WARN  com.alibaba.nacos.common.notify.NotifyCenter - [NotifyCenter] Destruction of the end
2025-05-09 15:43:16.495 [Thread-1] WARN  c.alibaba.nacos.common.http.HttpClientBeanHolder - [HttpClientBeanHolder] Destruction of the end
2025-05-09 15:43:16.519 [SpringApplicationShutdownHook] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - De-registering from Nacos Server now...
2025-05-09 15:43:16.520 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - [DEREGISTER-SERVICE] d750d92e-152f-4055-a641-3bc9dda85a29 deregistering service bgai with instance: Instance{instanceId='null', ip='192.168.86.8', port=8080, weight=1.0, healthy=true, enabled=true, ephemeral=true, clusterName='DEFAULT', serviceName='null', metadata={}}
2025-05-09 15:43:16.529 [SpringApplicationShutdownHook] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - De-registration finished.
2025-05-09 15:43:16.530 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.cache.ServiceInfoHolder do shutdown begin
2025-05-09 15:43:16.531 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.backups.FailoverReactor do shutdown begin
2025-05-09 15:43:16.531 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.backups.FailoverReactor do shutdown stop
2025-05-09 15:43:16.531 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.cache.ServiceInfoHolder do shutdown stop
2025-05-09 15:43:16.531 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.NamingClientProxyDelegate do shutdown begin
2025-05-09 15:43:16.531 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServiceInfoUpdateService do shutdown begin
2025-05-09 15:43:16.531 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServiceInfoUpdateService do shutdown stop
2025-05-09 15:43:16.531 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServerListManager do shutdown begin
2025-05-09 15:43:16.531 [SpringApplicationShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Start destroying NacosRestTemplate
2025-05-09 15:43:16.531 [SpringApplicationShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Destruction of the end
2025-05-09 15:43:16.531 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServerListManager do shutdown stop
2025-05-09 15:43:16.531 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.http.NamingHttpClientProxy do shutdown begin
2025-05-09 15:43:16.531 [SpringApplicationShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Start destroying NacosRestTemplate
2025-05-09 15:43:16.531 [SpringApplicationShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Destruction of the end
2025-05-09 15:43:16.531 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.http.NamingHttpClientProxy do shutdown stop
2025-05-09 15:43:16.531 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Shutdown rpc client, set status to shutdown
2025-05-09 15:43:16.531 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Shutdown client event executor java.util.concurrent.ScheduledThreadPoolExecutor@7fdfa8c2[Running, pool size = 2, active threads = 2, queued tasks = 0, completed tasks = 0]
2025-05-09 15:43:16.531 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Close current connection 1746776292387_139.227.195.203_42747
2025-05-09 15:43:16.534 [nacos-grpc-client-executor-8.133.246.113-70] WARN  c.a.nacos.common.remote.client.grpc.GrpcClient - [1746776292387_139.227.195.203_42747]Ignore error event,isRunning:false,isAbandon=false
2025-05-09 15:43:16.536 [SpringApplicationShutdownHook] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - Shutdown grpc executor java.util.concurrent.ThreadPoolExecutor@58337c20[Running, pool size = 6, active threads = 0, queued tasks = 0, completed tasks = 71]
2025-05-09 15:43:16.536 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - Shutdown grpc redo service executor java.util.concurrent.ScheduledThreadPoolExecutor@4fb5590e[Running, pool size = 1, active threads = 0, queued tasks = 1, completed tasks = 101]
2025-05-09 15:43:16.536 [SpringApplicationShutdownHook] INFO  c.a.n.client.auth.ram.identify.CredentialWatcher - [null] CredentialWatcher is stopped
2025-05-09 15:43:16.537 [SpringApplicationShutdownHook] INFO  c.a.n.client.auth.ram.identify.CredentialService - [null] CredentialService is freed
2025-05-09 15:43:16.537 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.NamingClientProxyDelegate do shutdown stop
2025-05-09 15:43:16.675 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:10911] result: true
2025-05-09 15:43:16.675 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:9876] result: true
2025-05-09 15:43:16.706 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:10911] result: true
2025-05-09 15:43:16.707 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:9876] result: true
2025-05-09 15:43:18.849 [SpringApplicationShutdownHook] INFO  o.s.orm.jpa.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-05-09 15:43:18.850 [SpringApplicationShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-0} closing ...
2025-05-09 15:43:18.851 [SpringApplicationShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} closing ...
2025-05-09 15:43:18.854 [SpringApplicationShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} closed
2025-05-09 15:45:33.188 [main] WARN  com.alibaba.nacos.client.logging.NacosLogging - Load Logback Configuration of Nacos fail, message: Could not initialize Logback Nacos logging from classpath:nacos-logback.xml
2025-05-09 15:45:33.188 [main] INFO  com.bgpay.bgai.BgaiApplication - The following 1 profile is active: "dev"
2025-05-09 15:45:34.296 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-05-09 15:45:34.298 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-05-09 15:45:34.319 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 15 ms. Found 0 JPA repository interfaces.
2025-05-09 15:45:34.329 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-05-09 15:45:34.331 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-05-09 15:45:34.341 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 4 ms. Found 0 Redis repository interfaces.
2025-05-09 15:45:34.480 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'allowedFileTypeMapper' and 'com.bgpay.bgai.mapper.AllowedFileTypeMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 15:45:34.480 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'apiConfigMapper' and 'com.bgpay.bgai.mapper.ApiConfigMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 15:45:34.480 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'chatCompletionsMapper' and 'com.bgpay.bgai.mapper.ChatCompletionsMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 15:45:34.480 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'choicesMapper' and 'com.bgpay.bgai.mapper.ChoicesMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 15:45:34.480 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'fileTypeMapper' and 'com.bgpay.bgai.mapper.FileTypeMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 15:45:34.481 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'priceConfigMapper' and 'com.bgpay.bgai.mapper.PriceConfigMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 15:45:34.481 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'priceVersionMapper' and 'com.bgpay.bgai.mapper.PriceVersionMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 15:45:34.481 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'usageInfoMapper' and 'com.bgpay.bgai.mapper.UsageInfoMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 15:45:34.481 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'usageRecordMapper' and 'com.bgpay.bgai.mapper.UsageRecordMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 15:45:34.481 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'userMapper' and 'com.bgpay.bgai.mapper.UserMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 15:45:34.481 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - No MyBatis mapper was found in '[com.bgpay.bgai.mapper]' package. Please check your configuration.
2025-05-09 15:45:34.483 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'allowedFileTypeMapper' and 'com.bgpay.bgai.mapper.AllowedFileTypeMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 15:45:34.483 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'apiConfigMapper' and 'com.bgpay.bgai.mapper.ApiConfigMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 15:45:34.484 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'chatCompletionsMapper' and 'com.bgpay.bgai.mapper.ChatCompletionsMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 15:45:34.484 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'choicesMapper' and 'com.bgpay.bgai.mapper.ChoicesMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 15:45:34.484 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'fileTypeMapper' and 'com.bgpay.bgai.mapper.FileTypeMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 15:45:34.484 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'priceConfigMapper' and 'com.bgpay.bgai.mapper.PriceConfigMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 15:45:34.484 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'priceVersionMapper' and 'com.bgpay.bgai.mapper.PriceVersionMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 15:45:34.484 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'usageInfoMapper' and 'com.bgpay.bgai.mapper.UsageInfoMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 15:45:34.484 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'usageRecordMapper' and 'com.bgpay.bgai.mapper.UsageRecordMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 15:45:34.484 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'userMapper' and 'com.bgpay.bgai.mapper.UserMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 15:45:34.484 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - No MyBatis mapper was found in '[com.bgpay.bgai.mapper]' package. Please check your configuration.
2025-05-09 15:45:34.741 [main] INFO  o.springframework.cloud.context.scope.GenericScope - BeanFactory id=38ed5f2c-a148-3506-bdcb-f18d795b9667
2025-05-09 15:45:34.994 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'org.springframework.cloud.commons.config.CommonsConfigAutoConfiguration' of type [org.springframework.cloud.commons.config.CommonsConfigAutoConfiguration] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 15:45:35.001 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'org.springframework.cloud.client.loadbalancer.LoadBalancerDefaultMappingsProviderAutoConfiguration' of type [org.springframework.cloud.client.loadbalancer.LoadBalancerDefaultMappingsProviderAutoConfiguration] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 15:45:35.005 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'loadBalancerClientsDefaultsMappingsProvider' of type [org.springframework.cloud.client.loadbalancer.LoadBalancerDefaultMappingsProviderAutoConfiguration$$Lambda/0x0000020ab3726400] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 15:45:35.015 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'defaultsBindHandlerAdvisor' of type [org.springframework.cloud.commons.config.DefaultsBindHandlerAdvisor] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 15:45:35.043 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'spring.datasource.dynamic-com.baomidou.dynamic.datasource.spring.boot.autoconfigure.DynamicDataSourceProperties' of type [com.baomidou.dynamic.datasource.spring.boot.autoconfigure.DynamicDataSourceProperties] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 15:45:35.058 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'com.baomidou.dynamic.datasource.spring.boot.autoconfigure.DynamicDataSourceAutoConfiguration' of type [com.baomidou.dynamic.datasource.spring.boot.autoconfigure.DynamicDataSourceAutoConfiguration$$SpringCGLIB$$0] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 15:45:35.081 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'dsProcessor' of type [com.baomidou.dynamic.datasource.processor.jakarta.DsJakartaHeaderProcessor] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 15:45:35.386 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'messageConverterConfiguration' of type [org.apache.rocketmq.spring.autoconfigure.MessageConverterConfiguration$$SpringCGLIB$$0] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 15:45:35.444 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'createRocketMQMessageConverter' of type [org.apache.rocketmq.spring.support.RocketMQMessageConverter] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 15:45:35.453 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'rocketmq-org.apache.rocketmq.spring.autoconfigure.RocketMQProperties' of type [org.apache.rocketmq.spring.autoconfigure.RocketMQProperties] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 15:45:35.456 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'listenerContainerConfiguration' of type [org.apache.rocketmq.spring.autoconfigure.ListenerContainerConfiguration$$SpringCGLIB$$0] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 15:45:35.486 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'org.springframework.cloud.client.loadbalancer.reactive.LoadBalancerBeanPostProcessorAutoConfiguration' of type [org.springframework.cloud.client.loadbalancer.reactive.LoadBalancerBeanPostProcessorAutoConfiguration] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 15:45:35.489 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'org.springframework.cloud.client.loadbalancer.reactive.LoadBalancerBeanPostProcessorAutoConfiguration$ReactorDeferringLoadBalancerFilterConfig' of type [org.springframework.cloud.client.loadbalancer.reactive.LoadBalancerBeanPostProcessorAutoConfiguration$ReactorDeferringLoadBalancerFilterConfig] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 15:45:35.493 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'reactorDeferringLoadBalancerExchangeFilterFunction' of type [org.springframework.cloud.client.loadbalancer.reactive.DeferringLoadBalancerExchangeFilterFunction] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 15:45:35.748 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat initialized with port(s): 8080 (http)
2025-05-09 15:45:35.757 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - Initializing ProtocolHandler ["http-nio-8080"]
2025-05-09 15:45:35.758 [main] INFO  org.apache.catalina.core.StandardService - Starting service [Tomcat]
2025-05-09 15:45:35.759 [main] INFO  org.apache.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.15]
2025-05-09 15:45:36.177 [main] INFO  org.hibernate.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-05-09 15:45:36.222 [main] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.1.7.Final
2025-05-09 15:45:36.508 [main] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} inited
2025-05-09 15:45:36.677 [main] INFO  SQL dialect - HHH000400: Using dialect: org.hibernate.dialect.MySQL8Dialect
2025-05-09 15:45:36.679 [main] WARN  org.hibernate.orm.deprecation - HHH90000026: MySQL8Dialect has been deprecated; use org.hibernate.dialect.MySQLDialect instead
2025-05-09 15:45:36.928 [main] INFO  o.h.e.t.jta.platform.internal.JtaPlatformInitiator - HHH000490: Using JtaPlatform implementation: [org.hibernate.engine.transaction.jta.platform.internal.NoJtaPlatform]
2025-05-09 15:45:36.937 [main] INFO  o.s.orm.jpa.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-05-09 15:45:37.297 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-09 15:45:37.318 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-09 15:45:37.350 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-09 15:45:37.353 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-09 15:45:37.353 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-09 15:45:37.365 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-09 15:45:38.009 [main] INFO  com.bgpay.bgai.service.impl.UserServiceImpl - 初始化SSO配置: clientId=bgai-client-id, redirectUri=http://localhost:8080/api/auth/callback
2025-05-09 15:45:38.095 [main] INFO  com.bgpay.bgai.controller.AuthController - 初始化认证控制器: clientId=bgai-client-id, redirectUri=http://localhost:8080/api/auth/callback
2025-05-09 15:45:38.842 [main] INFO  o.a.r.s.autoconfigure.RocketMQAutoConfiguration - a producer (billing-producer-group) init on namesrv 8.133.246.113:9876
2025-05-09 15:45:39.642 [main] INFO  org.redisson.Version - Redisson 3.24.3
2025-05-09 15:45:39.790 [redisson-netty-4-6] INFO  o.r.connection.pool.MasterPubSubConnectionPool - 1 connections initialized for 8.133.246.113/8.133.246.113:6379
2025-05-09 15:45:40.120 [redisson-netty-4-19] INFO  org.redisson.connection.pool.MasterConnectionPool - 24 connections initialized for 8.133.246.113/8.133.246.113:6379
2025-05-09 15:45:40.354 [main] INFO  com.bgpay.bgai.service.mq.MQConsumerService - MQ consumer startup successful [group=billing-consumer-group, topic=BILLING_TOPIC, tag=USER_BILLING]
2025-05-09 15:45:41.396 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [After]
2025-05-09 15:45:41.396 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Before]
2025-05-09 15:45:41.397 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Between]
2025-05-09 15:45:41.397 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Cookie]
2025-05-09 15:45:41.397 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Header]
2025-05-09 15:45:41.397 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Host]
2025-05-09 15:45:41.397 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Method]
2025-05-09 15:45:41.397 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Path]
2025-05-09 15:45:41.397 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Query]
2025-05-09 15:45:41.397 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [ReadBody]
2025-05-09 15:45:41.397 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [RemoteAddr]
2025-05-09 15:45:41.397 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [XForwardedRemoteAddr]
2025-05-09 15:45:41.397 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Weight]
2025-05-09 15:45:41.397 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [CloudFoundryRouteService]
2025-05-09 15:45:42.551 [main] INFO  o.s.b.actuate.endpoint.web.EndpointLinksResolver - Exposing 1 endpoint(s) beneath base path '/actuator'
2025-05-09 15:45:43.803 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - Starting ProtocolHandler ["http-nio-8080"]
2025-05-09 15:45:43.820 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat started on port(s): 8080 (http) with context path ''
2025-05-09 15:45:43.830 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from ans.namespace attribute : null
2025-05-09 15:45:43.830 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from ALIBABA_ALIWARE_NAMESPACE attribute :null
2025-05-09 15:45:43.831 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from namespace attribute :null
2025-05-09 15:45:43.838 [main] INFO  c.a.n.p.auth.spi.client.ClientAuthPluginManager - [ClientAuthPluginManager] Load ClientAuthService com.alibaba.nacos.client.auth.impl.NacosClientAuthServiceImpl success.
2025-05-09 15:45:43.838 [main] INFO  c.a.n.p.auth.spi.client.ClientAuthPluginManager - [ClientAuthPluginManager] Load ClientAuthService com.alibaba.nacos.client.auth.ram.RamClientAuthServiceImpl success.
2025-05-09 15:45:43.841 [main] INFO  com.alibaba.nacos.common.remote.client - [RpcClientFactory] create a new rpc client of d9ae37df-061e-4970-9902-8146182fad5d
2025-05-09 15:45:43.842 [main] INFO  com.alibaba.nacos.common.remote.client - [d9ae37df-061e-4970-9902-8146182fad5d] RpcClient init, ServerListFactory = com.alibaba.nacos.client.naming.core.ServerListManager
2025-05-09 15:45:43.842 [main] INFO  com.alibaba.nacos.common.remote.client - [d9ae37df-061e-4970-9902-8146182fad5d] Registry connection listener to current client:com.alibaba.nacos.client.naming.remote.gprc.redo.NamingGrpcRedoService
2025-05-09 15:45:43.842 [main] INFO  com.alibaba.nacos.common.remote.client - [d9ae37df-061e-4970-9902-8146182fad5d] Register server push request handler:com.alibaba.nacos.client.naming.remote.gprc.NamingPushRequestHandler
2025-05-09 15:45:43.843 [main] INFO  com.alibaba.nacos.common.remote.client - [d9ae37df-061e-4970-9902-8146182fad5d] Try to connect to server on start up, server: {serverIp = '8.133.246.113', server main port = 8848}
2025-05-09 15:45:43.843 [main] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - grpc client connection server:8.133.246.113 ip,serverPort:9848,grpcTslConfig:{"sslProvider":"OPENSSL","enableTls":false,"mutualAuthEnable":false,"trustAll":false}
2025-05-09 15:45:43.973 [main] INFO  com.alibaba.nacos.common.remote.client - [d9ae37df-061e-4970-9902-8146182fad5d] Success to connect to server [8.133.246.113:8848] on start up, connectionId = 1746776743784_139.227.195.203_43191
2025-05-09 15:45:43.973 [main] INFO  com.alibaba.nacos.common.remote.client - [d9ae37df-061e-4970-9902-8146182fad5d] Register server push request handler:com.alibaba.nacos.common.remote.client.RpcClient$ConnectResetRequestHandler
2025-05-09 15:45:43.973 [com.alibaba.nacos.client.remote.worker] INFO  com.alibaba.nacos.common.remote.client - [d9ae37df-061e-4970-9902-8146182fad5d] Notify connected event to listeners.
2025-05-09 15:45:43.973 [main] INFO  com.alibaba.nacos.common.remote.client - [d9ae37df-061e-4970-9902-8146182fad5d] Register server push request handler:com.alibaba.nacos.common.remote.client.RpcClient$$Lambda/0x0000020ab35249d0
2025-05-09 15:45:43.973 [com.alibaba.nacos.client.remote.worker] INFO  com.alibaba.nacos.client.naming - Grpc connection connect
2025-05-09 15:45:43.975 [main] INFO  com.alibaba.nacos.client.naming - [REGISTER-SERVICE] d750d92e-152f-4055-a641-3bc9dda85a29 registering service bgai with instance Instance{instanceId='null', ip='192.168.86.8', port=8080, weight=1.0, healthy=true, enabled=true, ephemeral=true, clusterName='DEFAULT', serviceName='null', metadata={IPv6=[2408:820c:7528:8342:f58d:7611:59f6:9fab], preserved.register.source=SPRING_CLOUD}}
2025-05-09 15:45:43.992 [main] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - nacos registry, DEFAULT_GROUP bgai 192.168.86.8:8080 register finished
2025-05-09 15:45:44.038 [main] INFO  com.bgpay.bgai.BgaiApplication - Started BgaiApplication in 12.875 seconds (process running for 14.12)
2025-05-09 15:45:44.042 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-09 15:45:44.042 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-09 15:45:44.054 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-09 15:45:44.054 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-09 15:45:44.054 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-09 15:45:44.063 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-09 15:45:44.064 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-09 15:45:44.064 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-09 15:45:44.072 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-09 15:45:44.072 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-09 15:45:44.073 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-09 15:45:44.080 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-09 15:45:44.084 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - nacos.cache.data.init.snapshot = true 
2025-05-09 15:45:44.084 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] common-dev.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-09 15:45:44.092 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=common-dev.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-09 15:45:44.092 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=common-dev.yaml, group=DEFAULT_GROUP
2025-05-09 15:45:44.094 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-09 15:45:44.094 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-09 15:45:44.094 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai.yaml, group=DEFAULT_GROUP
2025-05-09 15:45:44.094 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai-dev.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-09 15:45:44.094 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai-dev.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-09 15:45:44.094 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai-dev.yaml, group=DEFAULT_GROUP
2025-05-09 15:45:44.094 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-09 15:45:44.094 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai, group=DEFAULT_GROUP, cnt=1
2025-05-09 15:45:44.094 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai, group=DEFAULT_GROUP
2025-05-09 15:45:50.476 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.EnhancedChatController - Received request to /Api/chat - question length: 6, multiTurn: false
2025-05-09 15:45:51.006 [Thread-48] DEBUG com.bgpay.bgai.mapper.ApiConfigMapper.selectList - ==>  Preparing: SELECT id,api_url,api_key,model_name,user_id FROM api_config WHERE (user_id = ?) ORDER BY id DESC
2025-05-09 15:45:51.008 [Thread-48] DEBUG com.bgpay.bgai.mapper.ApiConfigMapper.selectList - ==> Parameters: 689258T(String)
2025-05-09 15:45:51.015 [Thread-48] DEBUG com.bgpay.bgai.mapper.ApiConfigMapper.selectList - <==      Total: 2
2025-05-09 15:45:51.016 [Thread-48] ERROR com.bgpay.bgai.controller.EnhancedChatController - 处理请求失败
org.apache.ibatis.exceptions.TooManyResultsException: Expected one result (or null) to be returned by selectOne(), but found: 2
	at com.baomidou.mybatisplus.core.mapper.BaseMapper.selectOne(BaseMapper.java:228)
	at java.base/java.lang.invoke.MethodHandle.invokeWithArguments(MethodHandle.java:733)
	at com.baomidou.mybatisplus.core.override.MybatisMapperProxy$DefaultMethodInvoker.invoke(MybatisMapperProxy.java:166)
	at com.baomidou.mybatisplus.core.override.MybatisMapperProxy.invoke(MybatisMapperProxy.java:89)
	at jdk.proxy2/jdk.proxy2.$Proxy167.selectOne(Unknown Source)
	at com.baomidou.mybatisplus.extension.service.impl.ServiceImpl.getOne(ServiceImpl.java:242)
	at com.baomidou.mybatisplus.extension.service.IService.getOne(IService.java:327)
	at com.bgpay.bgai.service.impl.ApiConfigServiceImpl.getLatestConfig(ApiConfigServiceImpl.java:31)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:343)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:699)
	at com.bgpay.bgai.service.impl.ApiConfigServiceImpl$$SpringCGLIB$$0.getLatestConfig(<generated>)
	at com.bgpay.bgai.controller.EnhancedChatController.resolveApiConfig(EnhancedChatController.java:157)
	at com.bgpay.bgai.controller.EnhancedChatController.lambda$handleChatRequest$2(EnhancedChatController.java:72)
	at reactor.core.publisher.MonoFlatMap$FlatMapMain.onNext(MonoFlatMap.java:132)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onNext(FluxOnAssembly.java:539)
	at reactor.core.publisher.FluxDefaultIfEmpty$DefaultIfEmptySubscriber.onNext(FluxDefaultIfEmpty.java:122)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onNext(FluxOnAssembly.java:539)
	at reactor.core.publisher.MonoFlatMap$FlatMapMain.secondComplete(MonoFlatMap.java:245)
	at reactor.core.publisher.MonoFlatMap$FlatMapInner.onNext(MonoFlatMap.java:305)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onNext(FluxOnAssembly.java:539)
	at reactor.core.publisher.MonoIgnoreThen$ThenIgnoreMain.complete(MonoIgnoreThen.java:292)
	at reactor.core.publisher.MonoIgnoreThen$ThenIgnoreMain.onNext(MonoIgnoreThen.java:187)
	at reactor.core.publisher.MonoIgnoreThen$ThenIgnoreMain.subscribeNext(MonoIgnoreThen.java:236)
	at reactor.core.publisher.MonoIgnoreThen$ThenIgnoreMain.onComplete(MonoIgnoreThen.java:203)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onComplete(FluxOnAssembly.java:549)
	at reactor.core.publisher.MonoCreate$DefaultMonoSink.success(MonoCreate.java:140)
	at reactor.core.publisher.LambdaSubscriber.onComplete(LambdaSubscriber.java:132)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onComplete(FluxOnAssembly.java:549)
	at reactor.core.publisher.FluxCreate$BaseSink.complete(FluxCreate.java:463)
	at reactor.core.publisher.FluxCreate$BufferAsyncSink.drain(FluxCreate.java:869)
	at reactor.core.publisher.FluxCreate$BufferAsyncSink.complete(FluxCreate.java:817)
	at reactor.core.publisher.FluxCreate$SerializedFluxSink.drainLoop(FluxCreate.java:247)
	at reactor.core.publisher.FluxCreate$SerializedFluxSink.drain(FluxCreate.java:213)
	at reactor.core.publisher.FluxCreate$SerializedFluxSink.complete(FluxCreate.java:204)
	at org.springframework.core.io.buffer.DataBufferUtils$WriteCompletionHandler.completed(DataBufferUtils.java:1184)
	at org.springframework.core.io.buffer.DataBufferUtils$WriteCompletionHandler.completed(DataBufferUtils.java:1102)
	at java.base/sun.nio.ch.Invoker.invokeUnchecked(Invoker.java:129)
	at java.base/sun.nio.ch.Invoker.invokeUnchecked(Invoker.java:284)
	at java.base/sun.nio.ch.WindowsAsynchronousFileChannelImpl$WriteTask.completed(WindowsAsynchronousFileChannelImpl.java:658)
	at java.base/sun.nio.ch.Iocp$EventHandlerTask.run(Iocp.java:387)
	at java.base/sun.nio.ch.AsynchronousChannelGroupImpl$1.run(AsynchronousChannelGroupImpl.java:113)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-05-09 15:46:41.289 [Thread-1] WARN  c.alibaba.nacos.common.http.HttpClientBeanHolder - [HttpClientBeanHolder] Start destroying common HttpClient
2025-05-09 15:46:41.290 [Thread-7] WARN  com.alibaba.nacos.common.notify.NotifyCenter - [NotifyCenter] Start destroying Publisher
2025-05-09 15:46:41.290 [Thread-7] WARN  com.alibaba.nacos.common.notify.NotifyCenter - [NotifyCenter] Destruction of the end
2025-05-09 15:46:41.290 [Thread-1] WARN  c.alibaba.nacos.common.http.HttpClientBeanHolder - [HttpClientBeanHolder] Destruction of the end
2025-05-09 15:46:41.305 [SpringApplicationShutdownHook] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - De-registering from Nacos Server now...
2025-05-09 15:46:41.305 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - [DEREGISTER-SERVICE] d750d92e-152f-4055-a641-3bc9dda85a29 deregistering service bgai with instance: Instance{instanceId='null', ip='192.168.86.8', port=8080, weight=1.0, healthy=true, enabled=true, ephemeral=true, clusterName='DEFAULT', serviceName='null', metadata={}}
2025-05-09 15:46:41.388 [SpringApplicationShutdownHook] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - De-registration finished.
2025-05-09 15:46:41.389 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.cache.ServiceInfoHolder do shutdown begin
2025-05-09 15:46:41.389 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.backups.FailoverReactor do shutdown begin
2025-05-09 15:46:41.389 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.backups.FailoverReactor do shutdown stop
2025-05-09 15:46:41.389 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.cache.ServiceInfoHolder do shutdown stop
2025-05-09 15:46:41.389 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.NamingClientProxyDelegate do shutdown begin
2025-05-09 15:46:41.389 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServiceInfoUpdateService do shutdown begin
2025-05-09 15:46:41.389 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServiceInfoUpdateService do shutdown stop
2025-05-09 15:46:41.389 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServerListManager do shutdown begin
2025-05-09 15:46:41.390 [SpringApplicationShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Start destroying NacosRestTemplate
2025-05-09 15:46:41.390 [SpringApplicationShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Destruction of the end
2025-05-09 15:46:41.390 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServerListManager do shutdown stop
2025-05-09 15:46:41.390 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.http.NamingHttpClientProxy do shutdown begin
2025-05-09 15:46:41.390 [SpringApplicationShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Start destroying NacosRestTemplate
2025-05-09 15:46:41.390 [SpringApplicationShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Destruction of the end
2025-05-09 15:46:41.390 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.http.NamingHttpClientProxy do shutdown stop
2025-05-09 15:46:41.390 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Shutdown rpc client, set status to shutdown
2025-05-09 15:46:41.390 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Shutdown client event executor java.util.concurrent.ScheduledThreadPoolExecutor@2454ee88[Running, pool size = 2, active threads = 2, queued tasks = 0, completed tasks = 0]
2025-05-09 15:46:41.390 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Close current connection 1746776743784_139.227.195.203_43191
2025-05-09 15:46:41.393 [nacos-grpc-client-executor-8.133.246.113-20] WARN  c.a.nacos.common.remote.client.grpc.GrpcClient - [1746776743784_139.227.195.203_43191]Ignore error event,isRunning:false,isAbandon=false
2025-05-09 15:46:41.394 [SpringApplicationShutdownHook] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - Shutdown grpc executor java.util.concurrent.ThreadPoolExecutor@3282806f[Running, pool size = 5, active threads = 0, queued tasks = 0, completed tasks = 21]
2025-05-09 15:46:41.394 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - Shutdown grpc redo service executor java.util.concurrent.ScheduledThreadPoolExecutor@32101098[Running, pool size = 1, active threads = 0, queued tasks = 1, completed tasks = 19]
2025-05-09 15:46:41.394 [SpringApplicationShutdownHook] INFO  c.a.n.client.auth.ram.identify.CredentialWatcher - [null] CredentialWatcher is stopped
2025-05-09 15:46:41.394 [SpringApplicationShutdownHook] INFO  c.a.n.client.auth.ram.identify.CredentialService - [null] CredentialService is freed
2025-05-09 15:46:41.394 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.NamingClientProxyDelegate do shutdown stop
2025-05-09 15:46:41.548 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:10911] result: true
2025-05-09 15:46:41.548 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:9876] result: true
2025-05-09 15:46:41.563 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:10911] result: true
2025-05-09 15:46:41.563 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:9876] result: true
2025-05-09 15:46:41.953 [com.alibaba.nacos.client.Worker] INFO  c.a.n.client.auth.ram.identify.CredentialWatcher - null No credential found
2025-05-09 15:46:43.751 [SpringApplicationShutdownHook] INFO  o.s.orm.jpa.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-05-09 15:46:43.753 [SpringApplicationShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-0} closing ...
2025-05-09 15:46:43.753 [SpringApplicationShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} closing ...
2025-05-09 15:46:43.759 [SpringApplicationShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} closed
2025-05-09 15:56:58.318 [main] WARN  com.alibaba.nacos.client.logging.NacosLogging - Load Logback Configuration of Nacos fail, message: Could not initialize Logback Nacos logging from classpath:nacos-logback.xml
2025-05-09 15:56:58.319 [main] INFO  com.bgpay.bgai.BgaiApplication - The following 1 profile is active: "dev"
2025-05-09 15:56:59.448 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-05-09 15:56:59.449 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-05-09 15:56:59.471 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 16 ms. Found 0 JPA repository interfaces.
2025-05-09 15:56:59.481 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-05-09 15:56:59.482 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-05-09 15:56:59.493 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 4 ms. Found 0 Redis repository interfaces.
2025-05-09 15:56:59.634 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'allowedFileTypeMapper' and 'com.bgpay.bgai.mapper.AllowedFileTypeMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 15:56:59.634 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'apiConfigMapper' and 'com.bgpay.bgai.mapper.ApiConfigMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 15:56:59.634 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'chatCompletionsMapper' and 'com.bgpay.bgai.mapper.ChatCompletionsMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 15:56:59.634 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'choicesMapper' and 'com.bgpay.bgai.mapper.ChoicesMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 15:56:59.634 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'fileTypeMapper' and 'com.bgpay.bgai.mapper.FileTypeMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 15:56:59.634 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'priceConfigMapper' and 'com.bgpay.bgai.mapper.PriceConfigMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 15:56:59.634 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'priceVersionMapper' and 'com.bgpay.bgai.mapper.PriceVersionMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 15:56:59.634 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'usageInfoMapper' and 'com.bgpay.bgai.mapper.UsageInfoMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 15:56:59.635 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'usageRecordMapper' and 'com.bgpay.bgai.mapper.UsageRecordMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 15:56:59.635 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'userMapper' and 'com.bgpay.bgai.mapper.UserMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 15:56:59.635 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - No MyBatis mapper was found in '[com.bgpay.bgai.mapper]' package. Please check your configuration.
2025-05-09 15:56:59.638 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'allowedFileTypeMapper' and 'com.bgpay.bgai.mapper.AllowedFileTypeMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 15:56:59.638 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'apiConfigMapper' and 'com.bgpay.bgai.mapper.ApiConfigMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 15:56:59.638 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'chatCompletionsMapper' and 'com.bgpay.bgai.mapper.ChatCompletionsMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 15:56:59.638 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'choicesMapper' and 'com.bgpay.bgai.mapper.ChoicesMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 15:56:59.638 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'fileTypeMapper' and 'com.bgpay.bgai.mapper.FileTypeMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 15:56:59.638 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'priceConfigMapper' and 'com.bgpay.bgai.mapper.PriceConfigMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 15:56:59.638 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'priceVersionMapper' and 'com.bgpay.bgai.mapper.PriceVersionMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 15:56:59.638 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'usageInfoMapper' and 'com.bgpay.bgai.mapper.UsageInfoMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 15:56:59.638 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'usageRecordMapper' and 'com.bgpay.bgai.mapper.UsageRecordMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 15:56:59.638 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'userMapper' and 'com.bgpay.bgai.mapper.UserMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 15:56:59.638 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - No MyBatis mapper was found in '[com.bgpay.bgai.mapper]' package. Please check your configuration.
2025-05-09 15:56:59.890 [main] INFO  o.springframework.cloud.context.scope.GenericScope - BeanFactory id=38ed5f2c-a148-3506-bdcb-f18d795b9667
2025-05-09 15:57:00.141 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'org.springframework.cloud.commons.config.CommonsConfigAutoConfiguration' of type [org.springframework.cloud.commons.config.CommonsConfigAutoConfiguration] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 15:57:00.150 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'org.springframework.cloud.client.loadbalancer.LoadBalancerDefaultMappingsProviderAutoConfiguration' of type [org.springframework.cloud.client.loadbalancer.LoadBalancerDefaultMappingsProviderAutoConfiguration] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 15:57:00.155 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'loadBalancerClientsDefaultsMappingsProvider' of type [org.springframework.cloud.client.loadbalancer.LoadBalancerDefaultMappingsProviderAutoConfiguration$$Lambda/0x000001e3ba725148] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 15:57:00.168 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'defaultsBindHandlerAdvisor' of type [org.springframework.cloud.commons.config.DefaultsBindHandlerAdvisor] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 15:57:00.203 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'spring.datasource.dynamic-com.baomidou.dynamic.datasource.spring.boot.autoconfigure.DynamicDataSourceProperties' of type [com.baomidou.dynamic.datasource.spring.boot.autoconfigure.DynamicDataSourceProperties] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 15:57:00.215 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'com.baomidou.dynamic.datasource.spring.boot.autoconfigure.DynamicDataSourceAutoConfiguration' of type [com.baomidou.dynamic.datasource.spring.boot.autoconfigure.DynamicDataSourceAutoConfiguration$$SpringCGLIB$$0] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 15:57:00.231 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'dsProcessor' of type [com.baomidou.dynamic.datasource.processor.jakarta.DsJakartaHeaderProcessor] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 15:57:00.534 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'messageConverterConfiguration' of type [org.apache.rocketmq.spring.autoconfigure.MessageConverterConfiguration$$SpringCGLIB$$0] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 15:57:00.591 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'createRocketMQMessageConverter' of type [org.apache.rocketmq.spring.support.RocketMQMessageConverter] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 15:57:00.598 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'rocketmq-org.apache.rocketmq.spring.autoconfigure.RocketMQProperties' of type [org.apache.rocketmq.spring.autoconfigure.RocketMQProperties] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 15:57:00.602 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'listenerContainerConfiguration' of type [org.apache.rocketmq.spring.autoconfigure.ListenerContainerConfiguration$$SpringCGLIB$$0] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 15:57:00.631 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'org.springframework.cloud.client.loadbalancer.reactive.LoadBalancerBeanPostProcessorAutoConfiguration' of type [org.springframework.cloud.client.loadbalancer.reactive.LoadBalancerBeanPostProcessorAutoConfiguration] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 15:57:00.635 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'org.springframework.cloud.client.loadbalancer.reactive.LoadBalancerBeanPostProcessorAutoConfiguration$ReactorDeferringLoadBalancerFilterConfig' of type [org.springframework.cloud.client.loadbalancer.reactive.LoadBalancerBeanPostProcessorAutoConfiguration$ReactorDeferringLoadBalancerFilterConfig] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 15:57:00.637 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'reactorDeferringLoadBalancerExchangeFilterFunction' of type [org.springframework.cloud.client.loadbalancer.reactive.DeferringLoadBalancerExchangeFilterFunction] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 15:57:00.884 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat initialized with port(s): 8080 (http)
2025-05-09 15:57:00.892 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - Initializing ProtocolHandler ["http-nio-8080"]
2025-05-09 15:57:00.894 [main] INFO  org.apache.catalina.core.StandardService - Starting service [Tomcat]
2025-05-09 15:57:00.895 [main] INFO  org.apache.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.15]
2025-05-09 15:57:01.308 [main] INFO  org.hibernate.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-05-09 15:57:01.357 [main] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.1.7.Final
2025-05-09 15:57:01.672 [main] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} inited
2025-05-09 15:57:01.860 [main] INFO  SQL dialect - HHH000400: Using dialect: org.hibernate.dialect.MySQL8Dialect
2025-05-09 15:57:01.862 [main] WARN  org.hibernate.orm.deprecation - HHH90000026: MySQL8Dialect has been deprecated; use org.hibernate.dialect.MySQLDialect instead
2025-05-09 15:57:02.104 [main] INFO  o.h.e.t.jta.platform.internal.JtaPlatformInitiator - HHH000490: Using JtaPlatform implementation: [org.hibernate.engine.transaction.jta.platform.internal.NoJtaPlatform]
2025-05-09 15:57:02.114 [main] INFO  o.s.orm.jpa.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-05-09 15:57:02.472 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-09 15:57:02.494 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-09 15:57:02.529 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-09 15:57:02.531 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-09 15:57:02.531 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-09 15:57:02.542 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-09 15:57:03.164 [main] INFO  com.bgpay.bgai.service.impl.UserServiceImpl - 初始化SSO配置: clientId=bgai-client-id, redirectUri=http://localhost:8080/api/auth/callback
2025-05-09 15:57:03.253 [main] INFO  com.bgpay.bgai.controller.AuthController - 初始化认证控制器: clientId=bgai-client-id, redirectUri=http://localhost:8080/api/auth/callback
2025-05-09 15:57:04.030 [main] INFO  o.a.r.s.autoconfigure.RocketMQAutoConfiguration - a producer (billing-producer-group) init on namesrv 8.133.246.113:9876
2025-05-09 15:57:04.807 [main] INFO  org.redisson.Version - Redisson 3.24.3
2025-05-09 15:57:04.934 [redisson-netty-4-6] INFO  o.r.connection.pool.MasterPubSubConnectionPool - 1 connections initialized for 8.133.246.113/8.133.246.113:6379
2025-05-09 15:57:05.254 [redisson-netty-4-19] INFO  org.redisson.connection.pool.MasterConnectionPool - 24 connections initialized for 8.133.246.113/8.133.246.113:6379
2025-05-09 15:57:05.479 [main] INFO  com.bgpay.bgai.service.mq.MQConsumerService - MQ consumer startup successful [group=billing-consumer-group, topic=BILLING_TOPIC, tag=USER_BILLING]
2025-05-09 15:57:06.561 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [After]
2025-05-09 15:57:06.561 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Before]
2025-05-09 15:57:06.561 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Between]
2025-05-09 15:57:06.561 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Cookie]
2025-05-09 15:57:06.561 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Header]
2025-05-09 15:57:06.561 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Host]
2025-05-09 15:57:06.561 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Method]
2025-05-09 15:57:06.561 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Path]
2025-05-09 15:57:06.561 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Query]
2025-05-09 15:57:06.561 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [ReadBody]
2025-05-09 15:57:06.561 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [RemoteAddr]
2025-05-09 15:57:06.561 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [XForwardedRemoteAddr]
2025-05-09 15:57:06.562 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Weight]
2025-05-09 15:57:06.562 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [CloudFoundryRouteService]
2025-05-09 15:57:07.728 [main] INFO  o.s.b.actuate.endpoint.web.EndpointLinksResolver - Exposing 1 endpoint(s) beneath base path '/actuator'
2025-05-09 15:57:08.932 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - Starting ProtocolHandler ["http-nio-8080"]
2025-05-09 15:57:08.945 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat started on port(s): 8080 (http) with context path ''
2025-05-09 15:57:08.954 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from ans.namespace attribute : null
2025-05-09 15:57:08.955 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from ALIBABA_ALIWARE_NAMESPACE attribute :null
2025-05-09 15:57:08.955 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from namespace attribute :null
2025-05-09 15:57:08.962 [main] INFO  c.a.n.p.auth.spi.client.ClientAuthPluginManager - [ClientAuthPluginManager] Load ClientAuthService com.alibaba.nacos.client.auth.impl.NacosClientAuthServiceImpl success.
2025-05-09 15:57:08.963 [main] INFO  c.a.n.p.auth.spi.client.ClientAuthPluginManager - [ClientAuthPluginManager] Load ClientAuthService com.alibaba.nacos.client.auth.ram.RamClientAuthServiceImpl success.
2025-05-09 15:57:08.966 [main] INFO  com.alibaba.nacos.common.remote.client - [RpcClientFactory] create a new rpc client of d1f1a11d-5c70-4908-9924-c0a530e5c3e7
2025-05-09 15:57:08.967 [main] INFO  com.alibaba.nacos.common.remote.client - [d1f1a11d-5c70-4908-9924-c0a530e5c3e7] RpcClient init, ServerListFactory = com.alibaba.nacos.client.naming.core.ServerListManager
2025-05-09 15:57:08.967 [main] INFO  com.alibaba.nacos.common.remote.client - [d1f1a11d-5c70-4908-9924-c0a530e5c3e7] Registry connection listener to current client:com.alibaba.nacos.client.naming.remote.gprc.redo.NamingGrpcRedoService
2025-05-09 15:57:08.968 [main] INFO  com.alibaba.nacos.common.remote.client - [d1f1a11d-5c70-4908-9924-c0a530e5c3e7] Register server push request handler:com.alibaba.nacos.client.naming.remote.gprc.NamingPushRequestHandler
2025-05-09 15:57:08.968 [main] INFO  com.alibaba.nacos.common.remote.client - [d1f1a11d-5c70-4908-9924-c0a530e5c3e7] Try to connect to server on start up, server: {serverIp = '8.133.246.113', server main port = 8848}
2025-05-09 15:57:08.968 [main] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - grpc client connection server:8.133.246.113 ip,serverPort:9848,grpcTslConfig:{"sslProvider":"OPENSSL","enableTls":false,"mutualAuthEnable":false,"trustAll":false}
2025-05-09 15:57:09.097 [main] INFO  com.alibaba.nacos.common.remote.client - [d1f1a11d-5c70-4908-9924-c0a530e5c3e7] Success to connect to server [8.133.246.113:8848] on start up, connectionId = 1746777428911_139.227.195.203_43246
2025-05-09 15:57:09.097 [main] INFO  com.alibaba.nacos.common.remote.client - [d1f1a11d-5c70-4908-9924-c0a530e5c3e7] Register server push request handler:com.alibaba.nacos.common.remote.client.RpcClient$ConnectResetRequestHandler
2025-05-09 15:57:09.097 [com.alibaba.nacos.client.remote.worker] INFO  com.alibaba.nacos.common.remote.client - [d1f1a11d-5c70-4908-9924-c0a530e5c3e7] Notify connected event to listeners.
2025-05-09 15:57:09.097 [main] INFO  com.alibaba.nacos.common.remote.client - [d1f1a11d-5c70-4908-9924-c0a530e5c3e7] Register server push request handler:com.alibaba.nacos.common.remote.client.RpcClient$$Lambda/0x000001e3ba5255c8
2025-05-09 15:57:09.097 [com.alibaba.nacos.client.remote.worker] INFO  com.alibaba.nacos.client.naming - Grpc connection connect
2025-05-09 15:57:09.099 [main] INFO  com.alibaba.nacos.client.naming - [REGISTER-SERVICE] d750d92e-152f-4055-a641-3bc9dda85a29 registering service bgai with instance Instance{instanceId='null', ip='192.168.86.8', port=8080, weight=1.0, healthy=true, enabled=true, ephemeral=true, clusterName='DEFAULT', serviceName='null', metadata={IPv6=[2408:820c:7528:8342:f58d:7611:59f6:9fab], preserved.register.source=SPRING_CLOUD}}
2025-05-09 15:57:09.116 [main] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - nacos registry, DEFAULT_GROUP bgai 192.168.86.8:8080 register finished
2025-05-09 15:57:09.161 [main] INFO  com.bgpay.bgai.BgaiApplication - Started BgaiApplication in 12.93 seconds (process running for 14.147)
2025-05-09 15:57:09.164 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-09 15:57:09.164 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-09 15:57:09.176 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-09 15:57:09.177 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-09 15:57:09.177 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-09 15:57:09.188 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-09 15:57:09.188 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-09 15:57:09.188 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-09 15:57:09.197 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-09 15:57:09.197 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-09 15:57:09.198 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-09 15:57:09.205 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-09 15:57:09.209 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - nacos.cache.data.init.snapshot = true 
2025-05-09 15:57:09.209 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] common-dev.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-09 15:57:09.217 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=common-dev.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-09 15:57:09.217 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=common-dev.yaml, group=DEFAULT_GROUP
2025-05-09 15:57:09.219 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-09 15:57:09.219 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-09 15:57:09.219 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai.yaml, group=DEFAULT_GROUP
2025-05-09 15:57:09.219 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai-dev.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-09 15:57:09.220 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai-dev.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-09 15:57:09.220 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai-dev.yaml, group=DEFAULT_GROUP
2025-05-09 15:57:09.220 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-09 15:57:09.220 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai, group=DEFAULT_GROUP, cnt=1
2025-05-09 15:57:09.220 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai, group=DEFAULT_GROUP
2025-05-09 15:57:13.831 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.EnhancedChatController - Received request to /Api/chat - question length: 6, multiTurn: false
2025-05-09 15:57:14.265 [Thread-48] ERROR com.bgpay.bgai.controller.EnhancedChatController - 处理请求失败
java.lang.NullPointerException: Cannot invoke "String.isEmpty()" because "modelName" is null
	at com.bgpay.bgai.controller.EnhancedChatController.resolveApiConfig(EnhancedChatController.java:157)
	at com.bgpay.bgai.controller.EnhancedChatController.lambda$handleChatRequest$2(EnhancedChatController.java:72)
	at reactor.core.publisher.MonoFlatMap$FlatMapMain.onNext(MonoFlatMap.java:132)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onNext(FluxOnAssembly.java:539)
	at reactor.core.publisher.FluxDefaultIfEmpty$DefaultIfEmptySubscriber.onNext(FluxDefaultIfEmpty.java:122)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onNext(FluxOnAssembly.java:539)
	at reactor.core.publisher.MonoFlatMap$FlatMapMain.secondComplete(MonoFlatMap.java:245)
	at reactor.core.publisher.MonoFlatMap$FlatMapInner.onNext(MonoFlatMap.java:305)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onNext(FluxOnAssembly.java:539)
	at reactor.core.publisher.MonoIgnoreThen$ThenIgnoreMain.complete(MonoIgnoreThen.java:292)
	at reactor.core.publisher.MonoIgnoreThen$ThenIgnoreMain.onNext(MonoIgnoreThen.java:187)
	at reactor.core.publisher.MonoIgnoreThen$ThenIgnoreMain.subscribeNext(MonoIgnoreThen.java:236)
	at reactor.core.publisher.MonoIgnoreThen$ThenIgnoreMain.onComplete(MonoIgnoreThen.java:203)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onComplete(FluxOnAssembly.java:549)
	at reactor.core.publisher.MonoCreate$DefaultMonoSink.success(MonoCreate.java:140)
	at reactor.core.publisher.LambdaSubscriber.onComplete(LambdaSubscriber.java:132)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onComplete(FluxOnAssembly.java:549)
	at reactor.core.publisher.FluxCreate$BaseSink.complete(FluxCreate.java:463)
	at reactor.core.publisher.FluxCreate$BufferAsyncSink.drain(FluxCreate.java:869)
	at reactor.core.publisher.FluxCreate$BufferAsyncSink.complete(FluxCreate.java:817)
	at reactor.core.publisher.FluxCreate$SerializedFluxSink.drainLoop(FluxCreate.java:247)
	at reactor.core.publisher.FluxCreate$SerializedFluxSink.drain(FluxCreate.java:213)
	at reactor.core.publisher.FluxCreate$SerializedFluxSink.complete(FluxCreate.java:204)
	at org.springframework.core.io.buffer.DataBufferUtils$WriteCompletionHandler.completed(DataBufferUtils.java:1184)
	at org.springframework.core.io.buffer.DataBufferUtils$WriteCompletionHandler.completed(DataBufferUtils.java:1102)
	at java.base/sun.nio.ch.Invoker.invokeUnchecked(Invoker.java:129)
	at java.base/sun.nio.ch.Invoker.invokeUnchecked(Invoker.java:284)
	at java.base/sun.nio.ch.WindowsAsynchronousFileChannelImpl$WriteTask.completed(WindowsAsynchronousFileChannelImpl.java:658)
	at java.base/sun.nio.ch.Iocp$EventHandlerTask.run(Iocp.java:387)
	at java.base/sun.nio.ch.AsynchronousChannelGroupImpl$1.run(AsynchronousChannelGroupImpl.java:113)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-05-09 15:57:43.495 [http-nio-8080-exec-5] INFO  com.bgpay.bgai.controller.EnhancedChatController - Received request to /Api/chat - question length: 6, multiTurn: false
2025-05-09 15:57:43.503 [Thread-48] ERROR com.bgpay.bgai.controller.EnhancedChatController - 处理请求失败
java.lang.NullPointerException: Cannot invoke "String.isEmpty()" because "modelName" is null
	at com.bgpay.bgai.controller.EnhancedChatController.resolveApiConfig(EnhancedChatController.java:157)
	at com.bgpay.bgai.controller.EnhancedChatController.lambda$handleChatRequest$2(EnhancedChatController.java:72)
	at reactor.core.publisher.MonoFlatMap$FlatMapMain.onNext(MonoFlatMap.java:132)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onNext(FluxOnAssembly.java:539)
	at reactor.core.publisher.FluxDefaultIfEmpty$DefaultIfEmptySubscriber.onNext(FluxDefaultIfEmpty.java:122)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onNext(FluxOnAssembly.java:539)
	at reactor.core.publisher.MonoFlatMap$FlatMapMain.secondComplete(MonoFlatMap.java:245)
	at reactor.core.publisher.MonoFlatMap$FlatMapInner.onNext(MonoFlatMap.java:305)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onNext(FluxOnAssembly.java:539)
	at reactor.core.publisher.MonoIgnoreThen$ThenIgnoreMain.complete(MonoIgnoreThen.java:292)
	at reactor.core.publisher.MonoIgnoreThen$ThenIgnoreMain.onNext(MonoIgnoreThen.java:187)
	at reactor.core.publisher.MonoIgnoreThen$ThenIgnoreMain.subscribeNext(MonoIgnoreThen.java:236)
	at reactor.core.publisher.MonoIgnoreThen$ThenIgnoreMain.onComplete(MonoIgnoreThen.java:203)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onComplete(FluxOnAssembly.java:549)
	at reactor.core.publisher.MonoCreate$DefaultMonoSink.success(MonoCreate.java:140)
	at reactor.core.publisher.LambdaSubscriber.onComplete(LambdaSubscriber.java:132)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onComplete(FluxOnAssembly.java:549)
	at reactor.core.publisher.FluxCreate$BaseSink.complete(FluxCreate.java:463)
	at reactor.core.publisher.FluxCreate$BufferAsyncSink.drain(FluxCreate.java:869)
	at reactor.core.publisher.FluxCreate$BufferAsyncSink.complete(FluxCreate.java:817)
	at reactor.core.publisher.FluxCreate$SerializedFluxSink.drainLoop(FluxCreate.java:247)
	at reactor.core.publisher.FluxCreate$SerializedFluxSink.drain(FluxCreate.java:213)
	at reactor.core.publisher.FluxCreate$SerializedFluxSink.complete(FluxCreate.java:204)
	at org.springframework.core.io.buffer.DataBufferUtils$WriteCompletionHandler.completed(DataBufferUtils.java:1184)
	at org.springframework.core.io.buffer.DataBufferUtils$WriteCompletionHandler.completed(DataBufferUtils.java:1102)
	at java.base/sun.nio.ch.Invoker.invokeUnchecked(Invoker.java:129)
	at java.base/sun.nio.ch.Invoker.invokeUnchecked(Invoker.java:284)
	at java.base/sun.nio.ch.WindowsAsynchronousFileChannelImpl$WriteTask.completed(WindowsAsynchronousFileChannelImpl.java:658)
	at java.base/sun.nio.ch.Iocp$EventHandlerTask.run(Iocp.java:387)
	at java.base/sun.nio.ch.AsynchronousChannelGroupImpl$1.run(AsynchronousChannelGroupImpl.java:113)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-05-09 15:59:01.673 [Thread-7] WARN  com.alibaba.nacos.common.notify.NotifyCenter - [NotifyCenter] Start destroying Publisher
2025-05-09 15:59:01.673 [Thread-1] WARN  c.alibaba.nacos.common.http.HttpClientBeanHolder - [HttpClientBeanHolder] Start destroying common HttpClient
2025-05-09 15:59:01.673 [Thread-7] WARN  com.alibaba.nacos.common.notify.NotifyCenter - [NotifyCenter] Destruction of the end
2025-05-09 15:59:01.674 [Thread-1] WARN  c.alibaba.nacos.common.http.HttpClientBeanHolder - [HttpClientBeanHolder] Destruction of the end
2025-05-09 15:59:01.690 [SpringApplicationShutdownHook] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - De-registering from Nacos Server now...
2025-05-09 15:59:01.690 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - [DEREGISTER-SERVICE] d750d92e-152f-4055-a641-3bc9dda85a29 deregistering service bgai with instance: Instance{instanceId='null', ip='192.168.86.8', port=8080, weight=1.0, healthy=true, enabled=true, ephemeral=true, clusterName='DEFAULT', serviceName='null', metadata={}}
2025-05-09 15:59:01.753 [SpringApplicationShutdownHook] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - De-registration finished.
2025-05-09 15:59:01.756 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.cache.ServiceInfoHolder do shutdown begin
2025-05-09 15:59:01.756 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.backups.FailoverReactor do shutdown begin
2025-05-09 15:59:01.756 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.backups.FailoverReactor do shutdown stop
2025-05-09 15:59:01.757 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.cache.ServiceInfoHolder do shutdown stop
2025-05-09 15:59:01.757 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.NamingClientProxyDelegate do shutdown begin
2025-05-09 15:59:01.760 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServiceInfoUpdateService do shutdown begin
2025-05-09 15:59:01.769 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServiceInfoUpdateService do shutdown stop
2025-05-09 15:59:01.769 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServerListManager do shutdown begin
2025-05-09 15:59:01.769 [SpringApplicationShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Start destroying NacosRestTemplate
2025-05-09 15:59:01.769 [SpringApplicationShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Destruction of the end
2025-05-09 15:59:01.769 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServerListManager do shutdown stop
2025-05-09 15:59:01.769 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.http.NamingHttpClientProxy do shutdown begin
2025-05-09 15:59:01.770 [SpringApplicationShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Start destroying NacosRestTemplate
2025-05-09 15:59:01.771 [SpringApplicationShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Destruction of the end
2025-05-09 15:59:01.771 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.http.NamingHttpClientProxy do shutdown stop
2025-05-09 15:59:01.771 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Shutdown rpc client, set status to shutdown
2025-05-09 15:59:01.771 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Shutdown client event executor java.util.concurrent.ScheduledThreadPoolExecutor@3b729e06[Running, pool size = 2, active threads = 2, queued tasks = 0, completed tasks = 0]
2025-05-09 15:59:01.771 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Close current connection 1746777428911_139.227.195.203_43246
2025-05-09 15:59:01.800 [SpringApplicationShutdownHook] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - Shutdown grpc executor java.util.concurrent.ThreadPoolExecutor@4182abba[Running, pool size = 6, active threads = 1, queued tasks = 0, completed tasks = 33]
2025-05-09 15:59:01.800 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - Shutdown grpc redo service executor java.util.concurrent.ScheduledThreadPoolExecutor@21c1fb2e[Running, pool size = 1, active threads = 0, queued tasks = 1, completed tasks = 37]
2025-05-09 15:59:01.800 [SpringApplicationShutdownHook] INFO  c.a.n.client.auth.ram.identify.CredentialWatcher - [null] CredentialWatcher is stopped
2025-05-09 15:59:01.800 [SpringApplicationShutdownHook] INFO  c.a.n.client.auth.ram.identify.CredentialService - [null] CredentialService is freed
2025-05-09 15:59:01.804 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.NamingClientProxyDelegate do shutdown stop
2025-05-09 15:59:01.805 [nacos-grpc-client-executor-8.133.246.113-33] WARN  c.a.nacos.common.remote.client.grpc.GrpcClient - [1746777428911_139.227.195.203_43246]Ignore error event,isRunning:false,isAbandon=false
2025-05-09 15:59:01.895 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:10911] result: true
2025-05-09 15:59:01.925 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:10911] result: true
2025-05-09 15:59:01.925 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:9876] result: true
2025-05-09 15:59:01.998 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:9876] result: true
2025-05-09 15:59:02.176 [com.alibaba.nacos.client.Worker] INFO  c.a.n.client.auth.ram.identify.CredentialWatcher - null No credential found
2025-05-09 15:59:04.092 [SpringApplicationShutdownHook] INFO  o.s.orm.jpa.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-05-09 15:59:04.094 [SpringApplicationShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-0} closing ...
2025-05-09 15:59:04.094 [SpringApplicationShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} closing ...
2025-05-09 15:59:04.099 [SpringApplicationShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} closed
2025-05-09 16:01:21.387 [main] WARN  com.alibaba.nacos.client.logging.NacosLogging - Load Logback Configuration of Nacos fail, message: Could not initialize Logback Nacos logging from classpath:nacos-logback.xml
2025-05-09 16:01:21.387 [main] INFO  com.bgpay.bgai.BgaiApplication - The following 1 profile is active: "dev"
2025-05-09 16:01:22.541 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-05-09 16:01:22.542 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-05-09 16:01:22.567 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 18 ms. Found 0 JPA repository interfaces.
2025-05-09 16:01:22.579 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-05-09 16:01:22.580 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-05-09 16:01:22.590 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 4 ms. Found 0 Redis repository interfaces.
2025-05-09 16:01:22.732 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'allowedFileTypeMapper' and 'com.bgpay.bgai.mapper.AllowedFileTypeMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 16:01:22.732 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'apiConfigMapper' and 'com.bgpay.bgai.mapper.ApiConfigMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 16:01:22.732 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'chatCompletionsMapper' and 'com.bgpay.bgai.mapper.ChatCompletionsMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 16:01:22.733 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'choicesMapper' and 'com.bgpay.bgai.mapper.ChoicesMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 16:01:22.733 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'fileTypeMapper' and 'com.bgpay.bgai.mapper.FileTypeMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 16:01:22.733 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'priceConfigMapper' and 'com.bgpay.bgai.mapper.PriceConfigMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 16:01:22.733 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'priceVersionMapper' and 'com.bgpay.bgai.mapper.PriceVersionMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 16:01:22.733 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'usageInfoMapper' and 'com.bgpay.bgai.mapper.UsageInfoMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 16:01:22.733 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'usageRecordMapper' and 'com.bgpay.bgai.mapper.UsageRecordMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 16:01:22.733 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'userMapper' and 'com.bgpay.bgai.mapper.UserMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 16:01:22.733 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - No MyBatis mapper was found in '[com.bgpay.bgai.mapper]' package. Please check your configuration.
2025-05-09 16:01:22.735 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'allowedFileTypeMapper' and 'com.bgpay.bgai.mapper.AllowedFileTypeMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 16:01:22.735 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'apiConfigMapper' and 'com.bgpay.bgai.mapper.ApiConfigMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 16:01:22.735 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'chatCompletionsMapper' and 'com.bgpay.bgai.mapper.ChatCompletionsMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 16:01:22.735 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'choicesMapper' and 'com.bgpay.bgai.mapper.ChoicesMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 16:01:22.735 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'fileTypeMapper' and 'com.bgpay.bgai.mapper.FileTypeMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 16:01:22.735 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'priceConfigMapper' and 'com.bgpay.bgai.mapper.PriceConfigMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 16:01:22.735 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'priceVersionMapper' and 'com.bgpay.bgai.mapper.PriceVersionMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 16:01:22.735 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'usageInfoMapper' and 'com.bgpay.bgai.mapper.UsageInfoMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 16:01:22.736 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'usageRecordMapper' and 'com.bgpay.bgai.mapper.UsageRecordMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 16:01:22.736 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'userMapper' and 'com.bgpay.bgai.mapper.UserMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 16:01:22.736 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - No MyBatis mapper was found in '[com.bgpay.bgai.mapper]' package. Please check your configuration.
2025-05-09 16:01:23.003 [main] INFO  o.springframework.cloud.context.scope.GenericScope - BeanFactory id=38ed5f2c-a148-3506-bdcb-f18d795b9667
2025-05-09 16:01:23.254 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'org.springframework.cloud.commons.config.CommonsConfigAutoConfiguration' of type [org.springframework.cloud.commons.config.CommonsConfigAutoConfiguration] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 16:01:23.261 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'org.springframework.cloud.client.loadbalancer.LoadBalancerDefaultMappingsProviderAutoConfiguration' of type [org.springframework.cloud.client.loadbalancer.LoadBalancerDefaultMappingsProviderAutoConfiguration] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 16:01:23.265 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'loadBalancerClientsDefaultsMappingsProvider' of type [org.springframework.cloud.client.loadbalancer.LoadBalancerDefaultMappingsProviderAutoConfiguration$$Lambda/0x000002390c727380] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 16:01:23.274 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'defaultsBindHandlerAdvisor' of type [org.springframework.cloud.commons.config.DefaultsBindHandlerAdvisor] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 16:01:23.301 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'spring.datasource.dynamic-com.baomidou.dynamic.datasource.spring.boot.autoconfigure.DynamicDataSourceProperties' of type [com.baomidou.dynamic.datasource.spring.boot.autoconfigure.DynamicDataSourceProperties] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 16:01:23.312 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'com.baomidou.dynamic.datasource.spring.boot.autoconfigure.DynamicDataSourceAutoConfiguration' of type [com.baomidou.dynamic.datasource.spring.boot.autoconfigure.DynamicDataSourceAutoConfiguration$$SpringCGLIB$$0] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 16:01:23.327 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'dsProcessor' of type [com.baomidou.dynamic.datasource.processor.jakarta.DsJakartaHeaderProcessor] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 16:01:23.611 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'messageConverterConfiguration' of type [org.apache.rocketmq.spring.autoconfigure.MessageConverterConfiguration$$SpringCGLIB$$0] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 16:01:23.679 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'createRocketMQMessageConverter' of type [org.apache.rocketmq.spring.support.RocketMQMessageConverter] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 16:01:23.687 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'rocketmq-org.apache.rocketmq.spring.autoconfigure.RocketMQProperties' of type [org.apache.rocketmq.spring.autoconfigure.RocketMQProperties] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 16:01:23.690 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'listenerContainerConfiguration' of type [org.apache.rocketmq.spring.autoconfigure.ListenerContainerConfiguration$$SpringCGLIB$$0] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 16:01:23.720 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'org.springframework.cloud.client.loadbalancer.reactive.LoadBalancerBeanPostProcessorAutoConfiguration' of type [org.springframework.cloud.client.loadbalancer.reactive.LoadBalancerBeanPostProcessorAutoConfiguration] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 16:01:23.723 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'org.springframework.cloud.client.loadbalancer.reactive.LoadBalancerBeanPostProcessorAutoConfiguration$ReactorDeferringLoadBalancerFilterConfig' of type [org.springframework.cloud.client.loadbalancer.reactive.LoadBalancerBeanPostProcessorAutoConfiguration$ReactorDeferringLoadBalancerFilterConfig] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 16:01:23.726 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'reactorDeferringLoadBalancerExchangeFilterFunction' of type [org.springframework.cloud.client.loadbalancer.reactive.DeferringLoadBalancerExchangeFilterFunction] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 16:01:23.974 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat initialized with port(s): 8080 (http)
2025-05-09 16:01:23.982 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - Initializing ProtocolHandler ["http-nio-8080"]
2025-05-09 16:01:23.984 [main] INFO  org.apache.catalina.core.StandardService - Starting service [Tomcat]
2025-05-09 16:01:23.984 [main] INFO  org.apache.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.15]
2025-05-09 16:01:24.401 [main] INFO  org.hibernate.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-05-09 16:01:24.447 [main] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.1.7.Final
2025-05-09 16:01:24.753 [main] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} inited
2025-05-09 16:01:24.930 [main] INFO  SQL dialect - HHH000400: Using dialect: org.hibernate.dialect.MySQL8Dialect
2025-05-09 16:01:24.932 [main] WARN  org.hibernate.orm.deprecation - HHH90000026: MySQL8Dialect has been deprecated; use org.hibernate.dialect.MySQLDialect instead
2025-05-09 16:01:25.181 [main] INFO  o.h.e.t.jta.platform.internal.JtaPlatformInitiator - HHH000490: Using JtaPlatform implementation: [org.hibernate.engine.transaction.jta.platform.internal.NoJtaPlatform]
2025-05-09 16:01:25.191 [main] INFO  o.s.orm.jpa.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-05-09 16:01:25.577 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-09 16:01:25.600 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-09 16:01:25.636 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-09 16:01:25.638 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-09 16:01:25.638 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-09 16:01:25.650 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-09 16:01:26.335 [main] INFO  com.bgpay.bgai.service.impl.UserServiceImpl - 初始化SSO配置: clientId=bgai-client-id, redirectUri=http://localhost:8080/api/auth/callback
2025-05-09 16:01:26.421 [main] INFO  com.bgpay.bgai.controller.AuthController - 初始化认证控制器: clientId=bgai-client-id, redirectUri=http://localhost:8080/api/auth/callback
2025-05-09 16:01:27.213 [main] INFO  o.a.r.s.autoconfigure.RocketMQAutoConfiguration - a producer (billing-producer-group) init on namesrv 8.133.246.113:9876
2025-05-09 16:01:27.977 [main] INFO  org.redisson.Version - Redisson 3.24.3
2025-05-09 16:01:28.114 [redisson-netty-4-6] INFO  o.r.connection.pool.MasterPubSubConnectionPool - 1 connections initialized for 8.133.246.113/8.133.246.113:6379
2025-05-09 16:01:28.444 [redisson-netty-4-19] INFO  org.redisson.connection.pool.MasterConnectionPool - 24 connections initialized for 8.133.246.113/8.133.246.113:6379
2025-05-09 16:01:28.669 [main] INFO  com.bgpay.bgai.service.mq.MQConsumerService - MQ consumer startup successful [group=billing-consumer-group, topic=BILLING_TOPIC, tag=USER_BILLING]
2025-05-09 16:01:29.731 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [After]
2025-05-09 16:01:29.731 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Before]
2025-05-09 16:01:29.731 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Between]
2025-05-09 16:01:29.731 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Cookie]
2025-05-09 16:01:29.731 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Header]
2025-05-09 16:01:29.731 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Host]
2025-05-09 16:01:29.731 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Method]
2025-05-09 16:01:29.731 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Path]
2025-05-09 16:01:29.731 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Query]
2025-05-09 16:01:29.731 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [ReadBody]
2025-05-09 16:01:29.731 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [RemoteAddr]
2025-05-09 16:01:29.732 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [XForwardedRemoteAddr]
2025-05-09 16:01:29.732 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Weight]
2025-05-09 16:01:29.732 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [CloudFoundryRouteService]
2025-05-09 16:01:30.852 [main] INFO  o.s.b.actuate.endpoint.web.EndpointLinksResolver - Exposing 1 endpoint(s) beneath base path '/actuator'
2025-05-09 16:01:32.110 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - Starting ProtocolHandler ["http-nio-8080"]
2025-05-09 16:01:32.123 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat started on port(s): 8080 (http) with context path ''
2025-05-09 16:01:32.132 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from ans.namespace attribute : null
2025-05-09 16:01:32.133 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from ALIBABA_ALIWARE_NAMESPACE attribute :null
2025-05-09 16:01:32.133 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from namespace attribute :null
2025-05-09 16:01:32.141 [main] INFO  c.a.n.p.auth.spi.client.ClientAuthPluginManager - [ClientAuthPluginManager] Load ClientAuthService com.alibaba.nacos.client.auth.impl.NacosClientAuthServiceImpl success.
2025-05-09 16:01:32.141 [main] INFO  c.a.n.p.auth.spi.client.ClientAuthPluginManager - [ClientAuthPluginManager] Load ClientAuthService com.alibaba.nacos.client.auth.ram.RamClientAuthServiceImpl success.
2025-05-09 16:01:32.143 [main] INFO  com.alibaba.nacos.common.remote.client - [RpcClientFactory] create a new rpc client of e955bb0e-b926-45a8-9a46-84e86563d415
2025-05-09 16:01:32.145 [main] INFO  com.alibaba.nacos.common.remote.client - [e955bb0e-b926-45a8-9a46-84e86563d415] RpcClient init, ServerListFactory = com.alibaba.nacos.client.naming.core.ServerListManager
2025-05-09 16:01:32.145 [main] INFO  com.alibaba.nacos.common.remote.client - [e955bb0e-b926-45a8-9a46-84e86563d415] Registry connection listener to current client:com.alibaba.nacos.client.naming.remote.gprc.redo.NamingGrpcRedoService
2025-05-09 16:01:32.145 [main] INFO  com.alibaba.nacos.common.remote.client - [e955bb0e-b926-45a8-9a46-84e86563d415] Register server push request handler:com.alibaba.nacos.client.naming.remote.gprc.NamingPushRequestHandler
2025-05-09 16:01:32.146 [main] INFO  com.alibaba.nacos.common.remote.client - [e955bb0e-b926-45a8-9a46-84e86563d415] Try to connect to server on start up, server: {serverIp = '8.133.246.113', server main port = 8848}
2025-05-09 16:01:32.146 [main] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - grpc client connection server:8.133.246.113 ip,serverPort:9848,grpcTslConfig:{"sslProvider":"OPENSSL","enableTls":false,"mutualAuthEnable":false,"trustAll":false}
2025-05-09 16:01:32.274 [main] INFO  com.alibaba.nacos.common.remote.client - [e955bb0e-b926-45a8-9a46-84e86563d415] Success to connect to server [8.133.246.113:8848] on start up, connectionId = 1746777692090_139.227.195.203_42117
2025-05-09 16:01:32.274 [main] INFO  com.alibaba.nacos.common.remote.client - [e955bb0e-b926-45a8-9a46-84e86563d415] Register server push request handler:com.alibaba.nacos.common.remote.client.RpcClient$ConnectResetRequestHandler
2025-05-09 16:01:32.274 [com.alibaba.nacos.client.remote.worker] INFO  com.alibaba.nacos.common.remote.client - [e955bb0e-b926-45a8-9a46-84e86563d415] Notify connected event to listeners.
2025-05-09 16:01:32.274 [main] INFO  com.alibaba.nacos.common.remote.client - [e955bb0e-b926-45a8-9a46-84e86563d415] Register server push request handler:com.alibaba.nacos.common.remote.client.RpcClient$$Lambda/0x000002390c528870
2025-05-09 16:01:32.274 [com.alibaba.nacos.client.remote.worker] INFO  com.alibaba.nacos.client.naming - Grpc connection connect
2025-05-09 16:01:32.276 [main] INFO  com.alibaba.nacos.client.naming - [REGISTER-SERVICE] d750d92e-152f-4055-a641-3bc9dda85a29 registering service bgai with instance Instance{instanceId='null', ip='192.168.86.8', port=8080, weight=1.0, healthy=true, enabled=true, ephemeral=true, clusterName='DEFAULT', serviceName='null', metadata={IPv6=[2408:820c:7528:8342:f58d:7611:59f6:9fab], preserved.register.source=SPRING_CLOUD}}
2025-05-09 16:01:32.296 [main] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - nacos registry, DEFAULT_GROUP bgai 192.168.86.8:8080 register finished
2025-05-09 16:01:32.339 [main] INFO  com.bgpay.bgai.BgaiApplication - Started BgaiApplication in 13.199 seconds (process running for 14.402)
2025-05-09 16:01:32.343 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-09 16:01:32.343 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-09 16:01:32.354 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-09 16:01:32.355 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-09 16:01:32.355 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-09 16:01:32.365 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-09 16:01:32.365 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-09 16:01:32.365 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-09 16:01:32.374 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-09 16:01:32.374 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-09 16:01:32.374 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-09 16:01:32.382 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-09 16:01:32.385 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - nacos.cache.data.init.snapshot = true 
2025-05-09 16:01:32.386 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] common-dev.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-09 16:01:32.393 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=common-dev.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-09 16:01:32.393 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=common-dev.yaml, group=DEFAULT_GROUP
2025-05-09 16:01:32.394 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-09 16:01:32.394 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-09 16:01:32.394 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai.yaml, group=DEFAULT_GROUP
2025-05-09 16:01:32.395 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai-dev.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-09 16:01:32.395 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai-dev.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-09 16:01:32.395 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai-dev.yaml, group=DEFAULT_GROUP
2025-05-09 16:01:32.395 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-09 16:01:32.395 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai, group=DEFAULT_GROUP, cnt=1
2025-05-09 16:01:32.395 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai, group=DEFAULT_GROUP
2025-05-09 16:01:48.153 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.EnhancedChatController - Received request to /Api/chat - question length: 6, multiTurn: false
2025-05-09 16:01:48.606 [Thread-50] DEBUG com.bgpay.bgai.mapper.ApiConfigMapper.selectList - ==>  Preparing: SELECT id,api_url,api_key,model_name,user_id FROM api_config WHERE (user_id = ? AND model_name <> ?) ORDER BY id DESC LIMIT 1
2025-05-09 16:01:48.607 [Thread-50] DEBUG com.bgpay.bgai.mapper.ApiConfigMapper.selectList - ==> Parameters: 689258T(String), deepseek-chat(String)
2025-05-09 16:01:48.616 [Thread-50] DEBUG com.bgpay.bgai.mapper.ApiConfigMapper.selectList - <==      Total: 1
2025-05-09 16:03:06.422 [Thread-50] WARN  com.alibaba.druid.pool.DruidAbstractDataSource - discard long time none received connection. , jdbcUrl : jdbc:mysql://8.133.246.113:3306/deepseek?autoReconnect=false&useUnicode=true&characterEncoding=UTF-8&characterSetResults=UTF-8&zeroDateTimeBehavior=convertToNull&useSSL=false&allowPublicKeyRetrieval=true&useSSL=false, version : 1.2.8, lastPacketReceivedIdleMillis : 77799
2025-05-09 16:03:06.429 [Thread-50] WARN  com.alibaba.druid.pool.DruidAbstractDataSource - discard long time none received connection. , jdbcUrl : jdbc:mysql://8.133.246.113:3306/deepseek?autoReconnect=false&useUnicode=true&characterEncoding=UTF-8&characterSetResults=UTF-8&zeroDateTimeBehavior=convertToNull&useSSL=false&allowPublicKeyRetrieval=true&useSSL=false, version : 1.2.8, lastPacketReceivedIdleMillis : 94048
2025-05-09 16:03:06.500 [Thread-50] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - ==>  Preparing: INSERT INTO chat_completions ( object, created, model, system_fingerprint, api_key ) VALUES ( ?, ?, ?, ?, ? )
2025-05-09 16:03:06.501 [Thread-50] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - ==> Parameters: chat.completion(String), 1746777708(Long), deepseek-reasoner(String), fp_5417b77867_prod0425fp8(String), da7dbcf1-7706-43d4-a7d6-3f3e414527a8(String)
2025-05-09 16:03:06.518 [Thread-50] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - <==    Updates: 1
2025-05-09 16:03:06.549 [FileWrite-1] INFO  com.bgpay.bgai.service.deepseek.FileWriterService - Successfully wrote content to: \var\data\ai_responses\2f098c66-672d-4d9a-9e49-f1b99d8bd62c.txt
2025-05-09 16:03:06.558 [ForkJoinPool.commonPool-worker-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.insert - ==>  Preparing: INSERT INTO usage_info ( chat_completion_id, prompt_tokens, completion_tokens, total_tokens, prompt_tokens_cached, completion_reasoning_tokens, prompt_cache_hit_tokens, prompt_cache_miss_tokens, created_at, model_type ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-05-09 16:03:06.559 [ForkJoinPool.commonPool-worker-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.insert - ==> Parameters: da7dbcf1-7706-43d4-a7d6-3f3e414527a8(String), 270(Integer), 1520(Integer), 1790(Integer), 0(Integer), 649(Integer), 0(Integer), 270(Integer), 2025-05-09T16:03:06.546524500(LocalDateTime), deepseek-reasoner(String)
2025-05-09 16:03:06.577 [ForkJoinPool.commonPool-worker-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.insert - <==    Updates: 1
2025-05-09 16:03:06.639 [NettyClientPublicExecutor_1] INFO  org.reflections.Reflections - Message 6cf37e8b-7d15-48e2-b8af-b6c7aa415f53 发送成功，执行清理操作
2025-05-09 16:03:19.890 [pool-7-thread-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.selectCount - ==>  Preparing: SELECT COUNT( * ) AS total FROM usage_info WHERE (chat_completion_id = ?)
2025-05-09 16:03:19.890 [pool-7-thread-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.selectCount - ==> Parameters: da7dbcf1-7706-43d4-a7d6-3f3e414527a8(String)
2025-05-09 16:03:19.897 [pool-7-thread-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.selectCount - <==      Total: 1
2025-05-09 16:03:19.970 [ConsumeMessageThread_billing-consumer-group_1] DEBUG c.bgpay.bgai.mapper.PriceConfigMapper.selectList - ==>  Preparing: SELECT id,model_type,time_period,cache_status,io_type,price,version,effective_time FROM price_config WHERE (model_type = ? AND time_period = ? AND io_type = ? AND effective_time <= ? AND cache_status = ?) ORDER BY effective_time DESC LIMIT 1
2025-05-09 16:03:19.971 [ConsumeMessageThread_billing-consumer-group_1] DEBUG c.bgpay.bgai.mapper.PriceConfigMapper.selectList - ==> Parameters: deepseek-reasoner(String), standard(String), input(String), 2025-05-09T16:03:19.968815300(LocalDateTime), miss(String)
2025-05-09 16:03:19.977 [ConsumeMessageThread_billing-consumer-group_1] DEBUG c.bgpay.bgai.mapper.PriceConfigMapper.selectList - <==      Total: 1
2025-05-09 16:03:20.032 [ConsumeMessageThread_billing-consumer-group_1] DEBUG c.bgpay.bgai.mapper.PriceConfigMapper.selectList - ==>  Preparing: SELECT id,model_type,time_period,cache_status,io_type,price,version,effective_time FROM price_config WHERE (model_type = ? AND time_period = ? AND io_type = ? AND effective_time <= ? AND cache_status IS NULL) ORDER BY effective_time DESC LIMIT 1
2025-05-09 16:03:20.032 [ConsumeMessageThread_billing-consumer-group_1] DEBUG c.bgpay.bgai.mapper.PriceConfigMapper.selectList - ==> Parameters: deepseek-reasoner(String), standard(String), output(String), 2025-05-09T16:03:20.031145500(LocalDateTime)
2025-05-09 16:03:20.037 [ConsumeMessageThread_billing-consumer-group_1] DEBUG c.bgpay.bgai.mapper.PriceConfigMapper.selectList - <==      Total: 1
2025-05-09 16:03:20.086 [ConsumeMessageThread_billing-consumer-group_1] INFO  c.bgpay.bgai.service.mq.RocketMQBillingServiceImpl - Output price config priceVersion: 1
2025-05-09 16:03:20.088 [ConsumeMessageThread_billing-consumer-group_1] DEBUG com.bgpay.bgai.mapper.UsageRecordMapper.insert - ==>  Preparing: INSERT INTO usage_record ( model_type, chat_completion_id, user_id, input_cost, output_cost, price_version, calculated_at ) VALUES ( ?, ?, ?, ?, ?, ?, ? )
2025-05-09 16:03:20.089 [ConsumeMessageThread_billing-consumer-group_1] DEBUG com.bgpay.bgai.mapper.UsageRecordMapper.insert - ==> Parameters: deepseek-reasoner(String), da7dbcf1-7706-43d4-a7d6-3f3e414527a8(String), 689258T(String), 0.0011(BigDecimal), 0.0243(BigDecimal), 1(Integer), 2025-05-09T16:03:20.086552(LocalDateTime)
2025-05-09 16:03:20.104 [ConsumeMessageThread_billing-consumer-group_1] DEBUG com.bgpay.bgai.mapper.UsageRecordMapper.insert - <==    Updates: 1
2025-05-09 16:03:20.113 [ConsumeMessageThread_billing-consumer-group_1] INFO  c.bgpay.bgai.service.mq.RocketMQBillingServiceImpl - Message consumed: 2408820C75288342F58D761159F69FAB14B036BAF30C2CA4A0CB0000
2025-05-09 16:06:25.140 [Thread-7] WARN  com.alibaba.nacos.common.notify.NotifyCenter - [NotifyCenter] Start destroying Publisher
2025-05-09 16:06:25.140 [Thread-1] WARN  c.alibaba.nacos.common.http.HttpClientBeanHolder - [HttpClientBeanHolder] Start destroying common HttpClient
2025-05-09 16:06:25.140 [Thread-7] WARN  com.alibaba.nacos.common.notify.NotifyCenter - [NotifyCenter] Destruction of the end
2025-05-09 16:06:25.141 [Thread-1] WARN  c.alibaba.nacos.common.http.HttpClientBeanHolder - [HttpClientBeanHolder] Destruction of the end
2025-05-09 16:06:25.158 [SpringApplicationShutdownHook] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - De-registering from Nacos Server now...
2025-05-09 16:06:25.158 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - [DEREGISTER-SERVICE] d750d92e-152f-4055-a641-3bc9dda85a29 deregistering service bgai with instance: Instance{instanceId='null', ip='192.168.86.8', port=8080, weight=1.0, healthy=true, enabled=true, ephemeral=true, clusterName='DEFAULT', serviceName='null', metadata={}}
2025-05-09 16:06:25.167 [SpringApplicationShutdownHook] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - De-registration finished.
2025-05-09 16:06:25.168 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.cache.ServiceInfoHolder do shutdown begin
2025-05-09 16:06:25.168 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.backups.FailoverReactor do shutdown begin
2025-05-09 16:06:25.168 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.backups.FailoverReactor do shutdown stop
2025-05-09 16:06:25.168 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.cache.ServiceInfoHolder do shutdown stop
2025-05-09 16:06:25.168 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.NamingClientProxyDelegate do shutdown begin
2025-05-09 16:06:25.168 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServiceInfoUpdateService do shutdown begin
2025-05-09 16:06:25.168 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServiceInfoUpdateService do shutdown stop
2025-05-09 16:06:25.168 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServerListManager do shutdown begin
2025-05-09 16:06:25.168 [SpringApplicationShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Start destroying NacosRestTemplate
2025-05-09 16:06:25.168 [SpringApplicationShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Destruction of the end
2025-05-09 16:06:25.168 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServerListManager do shutdown stop
2025-05-09 16:06:25.168 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.http.NamingHttpClientProxy do shutdown begin
2025-05-09 16:06:25.168 [SpringApplicationShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Start destroying NacosRestTemplate
2025-05-09 16:06:25.168 [SpringApplicationShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Destruction of the end
2025-05-09 16:06:25.168 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.http.NamingHttpClientProxy do shutdown stop
2025-05-09 16:06:25.168 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Shutdown rpc client, set status to shutdown
2025-05-09 16:06:25.168 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Shutdown client event executor java.util.concurrent.ScheduledThreadPoolExecutor@3e843b50[Running, pool size = 2, active threads = 2, queued tasks = 0, completed tasks = 0]
2025-05-09 16:06:25.169 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Close current connection 1746777692090_139.227.195.203_42117
2025-05-09 16:06:25.171 [nacos-grpc-client-executor-8.133.246.113-75] WARN  c.a.nacos.common.remote.client.grpc.GrpcClient - [1746777692090_139.227.195.203_42117]Ignore error event,isRunning:false,isAbandon=false
2025-05-09 16:06:25.172 [SpringApplicationShutdownHook] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - Shutdown grpc executor java.util.concurrent.ThreadPoolExecutor@7a287117[Running, pool size = 4, active threads = 0, queued tasks = 0, completed tasks = 76]
2025-05-09 16:06:25.172 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - Shutdown grpc redo service executor java.util.concurrent.ScheduledThreadPoolExecutor@4568499e[Running, pool size = 1, active threads = 0, queued tasks = 1, completed tasks = 97]
2025-05-09 16:06:25.173 [SpringApplicationShutdownHook] INFO  c.a.n.client.auth.ram.identify.CredentialWatcher - [null] CredentialWatcher is stopped
2025-05-09 16:06:25.173 [SpringApplicationShutdownHook] INFO  c.a.n.client.auth.ram.identify.CredentialService - [null] CredentialService is freed
2025-05-09 16:06:25.173 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.NamingClientProxyDelegate do shutdown stop
2025-05-09 16:06:25.215 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:10909] result: true
2025-05-09 16:06:25.215 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:10911] result: true
2025-05-09 16:06:25.216 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:9876] result: true
2025-05-09 16:06:25.352 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:10911] result: true
2025-05-09 16:06:25.352 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:9876] result: true
2025-05-09 16:06:27.456 [SpringApplicationShutdownHook] INFO  o.s.orm.jpa.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-05-09 16:06:27.458 [SpringApplicationShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-0} closing ...
2025-05-09 16:06:27.458 [SpringApplicationShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} closing ...
2025-05-09 16:06:27.459 [SpringApplicationShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} closed
2025-05-09 16:08:20.766 [main] WARN  com.alibaba.nacos.client.logging.NacosLogging - Load Logback Configuration of Nacos fail, message: Could not initialize Logback Nacos logging from classpath:nacos-logback.xml
2025-05-09 16:08:20.767 [main] INFO  com.bgpay.bgai.BgaiApplication - The following 1 profile is active: "dev"
2025-05-09 16:08:21.969 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-05-09 16:08:21.971 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-05-09 16:08:21.994 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 17 ms. Found 0 JPA repository interfaces.
2025-05-09 16:08:22.006 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-05-09 16:08:22.006 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-05-09 16:08:22.018 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 4 ms. Found 0 Redis repository interfaces.
2025-05-09 16:08:22.180 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'allowedFileTypeMapper' and 'com.bgpay.bgai.mapper.AllowedFileTypeMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 16:08:22.180 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'apiConfigMapper' and 'com.bgpay.bgai.mapper.ApiConfigMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 16:08:22.180 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'chatCompletionsMapper' and 'com.bgpay.bgai.mapper.ChatCompletionsMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 16:08:22.180 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'choicesMapper' and 'com.bgpay.bgai.mapper.ChoicesMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 16:08:22.180 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'fileTypeMapper' and 'com.bgpay.bgai.mapper.FileTypeMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 16:08:22.180 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'priceConfigMapper' and 'com.bgpay.bgai.mapper.PriceConfigMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 16:08:22.180 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'priceVersionMapper' and 'com.bgpay.bgai.mapper.PriceVersionMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 16:08:22.180 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'usageInfoMapper' and 'com.bgpay.bgai.mapper.UsageInfoMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 16:08:22.180 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'usageRecordMapper' and 'com.bgpay.bgai.mapper.UsageRecordMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 16:08:22.181 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'userMapper' and 'com.bgpay.bgai.mapper.UserMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 16:08:22.181 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - No MyBatis mapper was found in '[com.bgpay.bgai.mapper]' package. Please check your configuration.
2025-05-09 16:08:22.185 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'allowedFileTypeMapper' and 'com.bgpay.bgai.mapper.AllowedFileTypeMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 16:08:22.185 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'apiConfigMapper' and 'com.bgpay.bgai.mapper.ApiConfigMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 16:08:22.185 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'chatCompletionsMapper' and 'com.bgpay.bgai.mapper.ChatCompletionsMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 16:08:22.185 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'choicesMapper' and 'com.bgpay.bgai.mapper.ChoicesMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 16:08:22.185 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'fileTypeMapper' and 'com.bgpay.bgai.mapper.FileTypeMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 16:08:22.185 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'priceConfigMapper' and 'com.bgpay.bgai.mapper.PriceConfigMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 16:08:22.185 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'priceVersionMapper' and 'com.bgpay.bgai.mapper.PriceVersionMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 16:08:22.186 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'usageInfoMapper' and 'com.bgpay.bgai.mapper.UsageInfoMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 16:08:22.186 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'usageRecordMapper' and 'com.bgpay.bgai.mapper.UsageRecordMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 16:08:22.186 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'userMapper' and 'com.bgpay.bgai.mapper.UserMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 16:08:22.186 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - No MyBatis mapper was found in '[com.bgpay.bgai.mapper]' package. Please check your configuration.
2025-05-09 16:08:22.531 [main] INFO  o.springframework.cloud.context.scope.GenericScope - BeanFactory id=38ed5f2c-a148-3506-bdcb-f18d795b9667
2025-05-09 16:08:22.801 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'org.springframework.cloud.commons.config.CommonsConfigAutoConfiguration' of type [org.springframework.cloud.commons.config.CommonsConfigAutoConfiguration] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 16:08:22.809 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'org.springframework.cloud.client.loadbalancer.LoadBalancerDefaultMappingsProviderAutoConfiguration' of type [org.springframework.cloud.client.loadbalancer.LoadBalancerDefaultMappingsProviderAutoConfiguration] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 16:08:22.813 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'loadBalancerClientsDefaultsMappingsProvider' of type [org.springframework.cloud.client.loadbalancer.LoadBalancerDefaultMappingsProviderAutoConfiguration$$Lambda/0x0000015c017255c0] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 16:08:22.823 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'defaultsBindHandlerAdvisor' of type [org.springframework.cloud.commons.config.DefaultsBindHandlerAdvisor] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 16:08:22.854 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'spring.datasource.dynamic-com.baomidou.dynamic.datasource.spring.boot.autoconfigure.DynamicDataSourceProperties' of type [com.baomidou.dynamic.datasource.spring.boot.autoconfigure.DynamicDataSourceProperties] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 16:08:22.866 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'com.baomidou.dynamic.datasource.spring.boot.autoconfigure.DynamicDataSourceAutoConfiguration' of type [com.baomidou.dynamic.datasource.spring.boot.autoconfigure.DynamicDataSourceAutoConfiguration$$SpringCGLIB$$0] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 16:08:22.883 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'dsProcessor' of type [com.baomidou.dynamic.datasource.processor.jakarta.DsJakartaHeaderProcessor] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 16:08:23.211 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'messageConverterConfiguration' of type [org.apache.rocketmq.spring.autoconfigure.MessageConverterConfiguration$$SpringCGLIB$$0] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 16:08:23.271 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'createRocketMQMessageConverter' of type [org.apache.rocketmq.spring.support.RocketMQMessageConverter] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 16:08:23.312 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'rocketmq-org.apache.rocketmq.spring.autoconfigure.RocketMQProperties' of type [org.apache.rocketmq.spring.autoconfigure.RocketMQProperties] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 16:08:23.316 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'listenerContainerConfiguration' of type [org.apache.rocketmq.spring.autoconfigure.ListenerContainerConfiguration$$SpringCGLIB$$0] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 16:08:23.351 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'org.springframework.cloud.client.loadbalancer.reactive.LoadBalancerBeanPostProcessorAutoConfiguration' of type [org.springframework.cloud.client.loadbalancer.reactive.LoadBalancerBeanPostProcessorAutoConfiguration] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 16:08:23.355 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'org.springframework.cloud.client.loadbalancer.reactive.LoadBalancerBeanPostProcessorAutoConfiguration$ReactorDeferringLoadBalancerFilterConfig' of type [org.springframework.cloud.client.loadbalancer.reactive.LoadBalancerBeanPostProcessorAutoConfiguration$ReactorDeferringLoadBalancerFilterConfig] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 16:08:23.358 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'reactorDeferringLoadBalancerExchangeFilterFunction' of type [org.springframework.cloud.client.loadbalancer.reactive.DeferringLoadBalancerExchangeFilterFunction] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 16:08:23.642 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat initialized with port(s): 8080 (http)
2025-05-09 16:08:23.652 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - Initializing ProtocolHandler ["http-nio-8080"]
2025-05-09 16:08:23.654 [main] INFO  org.apache.catalina.core.StandardService - Starting service [Tomcat]
2025-05-09 16:08:23.655 [main] INFO  org.apache.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.15]
2025-05-09 16:08:24.103 [main] INFO  org.hibernate.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-05-09 16:08:24.278 [main] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.1.7.Final
2025-05-09 16:08:24.666 [main] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} inited
2025-05-09 16:08:24.868 [main] INFO  SQL dialect - HHH000400: Using dialect: org.hibernate.dialect.MySQL8Dialect
2025-05-09 16:08:24.871 [main] WARN  org.hibernate.orm.deprecation - HHH90000026: MySQL8Dialect has been deprecated; use org.hibernate.dialect.MySQLDialect instead
2025-05-09 16:08:25.145 [main] INFO  o.h.e.t.jta.platform.internal.JtaPlatformInitiator - HHH000490: Using JtaPlatform implementation: [org.hibernate.engine.transaction.jta.platform.internal.NoJtaPlatform]
2025-05-09 16:08:25.156 [main] INFO  o.s.orm.jpa.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-05-09 16:08:25.545 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-09 16:08:25.569 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-09 16:08:25.602 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-09 16:08:25.605 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-09 16:08:25.606 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-09 16:08:25.616 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-09 16:08:26.283 [main] INFO  com.bgpay.bgai.service.impl.UserServiceImpl - 初始化SSO配置: clientId=bgai-client-id, redirectUri=http://localhost:8080/api/auth/callback
2025-05-09 16:08:26.375 [main] INFO  com.bgpay.bgai.controller.AuthController - 初始化认证控制器: clientId=bgai-client-id, redirectUri=http://localhost:8080/api/auth/callback
2025-05-09 16:08:27.117 [Thread-7] WARN  com.alibaba.nacos.common.notify.NotifyCenter - [NotifyCenter] Start destroying Publisher
2025-05-09 16:08:27.117 [Thread-1] WARN  c.alibaba.nacos.common.http.HttpClientBeanHolder - [HttpClientBeanHolder] Start destroying common HttpClient
2025-05-09 16:08:27.117 [Thread-7] WARN  com.alibaba.nacos.common.notify.NotifyCenter - [NotifyCenter] Destruction of the end
2025-05-09 16:08:27.118 [Thread-1] WARN  c.alibaba.nacos.common.http.HttpClientBeanHolder - [HttpClientBeanHolder] Destruction of the end
2025-05-09 16:08:27.371 [main] INFO  o.a.r.s.autoconfigure.RocketMQAutoConfiguration - a producer (billing-producer-group) init on namesrv 8.133.246.113:9876
2025-05-09 16:08:28.218 [main] INFO  org.redisson.Version - Redisson 3.24.3
2025-05-09 16:08:28.350 [redisson-netty-4-6] INFO  o.r.connection.pool.MasterPubSubConnectionPool - 1 connections initialized for 8.133.246.113/8.133.246.113:6379
2025-05-09 16:08:28.685 [redisson-netty-4-19] INFO  org.redisson.connection.pool.MasterConnectionPool - 24 connections initialized for 8.133.246.113/8.133.246.113:6379
2025-05-09 16:08:28.940 [main] INFO  com.bgpay.bgai.service.mq.MQConsumerService - MQ consumer startup successful [group=billing-consumer-group, topic=BILLING_TOPIC, tag=USER_BILLING]
2025-05-09 16:08:30.052 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [After]
2025-05-09 16:08:30.052 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Before]
2025-05-09 16:08:30.052 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Between]
2025-05-09 16:08:30.052 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Cookie]
2025-05-09 16:08:30.052 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Header]
2025-05-09 16:08:30.052 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Host]
2025-05-09 16:08:30.052 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Method]
2025-05-09 16:08:30.052 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Path]
2025-05-09 16:08:30.052 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Query]
2025-05-09 16:08:30.052 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [ReadBody]
2025-05-09 16:08:30.052 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [RemoteAddr]
2025-05-09 16:08:30.052 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [XForwardedRemoteAddr]
2025-05-09 16:08:30.052 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Weight]
2025-05-09 16:08:30.052 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [CloudFoundryRouteService]
2025-05-09 16:08:31.273 [main] INFO  o.s.b.actuate.endpoint.web.EndpointLinksResolver - Exposing 1 endpoint(s) beneath base path '/actuator'
2025-05-09 16:08:32.632 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat started on port(s): 8080 (http) with context path ''
2025-05-09 16:08:32.644 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from ans.namespace attribute : null
2025-05-09 16:08:32.645 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from ALIBABA_ALIWARE_NAMESPACE attribute :null
2025-05-09 16:08:32.645 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from namespace attribute :null
2025-05-09 16:08:32.653 [main] INFO  c.a.n.p.auth.spi.client.ClientAuthPluginManager - [ClientAuthPluginManager] Load ClientAuthService com.alibaba.nacos.client.auth.impl.NacosClientAuthServiceImpl success.
2025-05-09 16:08:32.654 [main] INFO  c.a.n.p.auth.spi.client.ClientAuthPluginManager - [ClientAuthPluginManager] Load ClientAuthService com.alibaba.nacos.client.auth.ram.RamClientAuthServiceImpl success.
2025-05-09 16:08:32.658 [main] INFO  com.alibaba.nacos.common.remote.client - [RpcClientFactory] create a new rpc client of 115f7811-43d0-443b-972c-1fd364c82249
2025-05-09 16:08:32.659 [main] INFO  com.alibaba.nacos.common.remote.client - [115f7811-43d0-443b-972c-1fd364c82249] RpcClient init, ServerListFactory = com.alibaba.nacos.client.naming.core.ServerListManager
2025-05-09 16:08:32.660 [main] INFO  com.alibaba.nacos.common.remote.client - [115f7811-43d0-443b-972c-1fd364c82249] Registry connection listener to current client:com.alibaba.nacos.client.naming.remote.gprc.redo.NamingGrpcRedoService
2025-05-09 16:08:32.660 [main] INFO  com.alibaba.nacos.common.remote.client - [115f7811-43d0-443b-972c-1fd364c82249] Register server push request handler:com.alibaba.nacos.client.naming.remote.gprc.NamingPushRequestHandler
2025-05-09 16:08:32.661 [main] INFO  com.alibaba.nacos.common.remote.client - [115f7811-43d0-443b-972c-1fd364c82249] Try to connect to server on start up, server: {serverIp = '8.133.246.113', server main port = 8848}
2025-05-09 16:08:32.661 [main] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - grpc client connection server:8.133.246.113 ip,serverPort:9848,grpcTslConfig:{"sslProvider":"OPENSSL","enableTls":false,"mutualAuthEnable":false,"trustAll":false}
2025-05-09 16:08:32.843 [main] INFO  com.alibaba.nacos.common.remote.client - [115f7811-43d0-443b-972c-1fd364c82249] Success to connect to server [8.133.246.113:8848] on start up, connectionId = 1746778112647_139.227.195.203_42214
2025-05-09 16:08:32.843 [main] INFO  com.alibaba.nacos.common.remote.client - [115f7811-43d0-443b-972c-1fd364c82249] Register server push request handler:com.alibaba.nacos.common.remote.client.RpcClient$ConnectResetRequestHandler
2025-05-09 16:08:32.843 [com.alibaba.nacos.client.remote.worker] INFO  com.alibaba.nacos.common.remote.client - [115f7811-43d0-443b-972c-1fd364c82249] Notify connected event to listeners.
2025-05-09 16:08:32.843 [main] INFO  com.alibaba.nacos.common.remote.client - [115f7811-43d0-443b-972c-1fd364c82249] Register server push request handler:com.alibaba.nacos.common.remote.client.RpcClient$$Lambda/0x0000015c01526d38
2025-05-09 16:08:32.843 [com.alibaba.nacos.client.remote.worker] INFO  com.alibaba.nacos.client.naming - Grpc connection connect
2025-05-09 16:08:32.844 [main] INFO  com.alibaba.nacos.client.naming - [REGISTER-SERVICE] d750d92e-152f-4055-a641-3bc9dda85a29 registering service bgai with instance Instance{instanceId='null', ip='192.168.86.8', port=8080, weight=1.0, healthy=true, enabled=true, ephemeral=true, clusterName='DEFAULT', serviceName='null', metadata={IPv6=[2408:820c:7528:8342:f58d:7611:59f6:9fab], preserved.register.source=SPRING_CLOUD}}
2025-05-09 16:08:32.866 [main] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - nacos registry, DEFAULT_GROUP bgai 192.168.86.8:8080 register finished
2025-05-09 16:08:32.918 [main] INFO  com.bgpay.bgai.BgaiApplication - Started BgaiApplication in 14.336 seconds (process running for 15.849)
2025-05-09 16:08:32.922 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-09 16:08:32.923 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-09 16:08:32.934 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-09 16:08:32.934 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-09 16:08:32.934 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-09 16:08:32.937 [SpringApplicationShutdownHook] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - De-registering from Nacos Server now...
2025-05-09 16:08:32.938 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - [DEREGISTER-SERVICE] d750d92e-152f-4055-a641-3bc9dda85a29 deregistering service bgai with instance: Instance{instanceId='null', ip='192.168.86.8', port=8080, weight=1.0, healthy=true, enabled=true, ephemeral=true, clusterName='DEFAULT', serviceName='null', metadata={}}
2025-05-09 16:08:32.937 [scheduling-1] ERROR o.s.s.support.TaskUtils$LoggingErrorHandler - Unexpected error occurred in scheduled task
org.mybatis.spring.MyBatisSystemException: null
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:97)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:439)
	at jdk.proxy2/jdk.proxy2.$Proxy147.selectList(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.selectList(SqlSessionTemplate.java:224)
	at com.baomidou.mybatisplus.core.override.MybatisMapperMethod.executeForMany(MybatisMapperMethod.java:164)
	at com.baomidou.mybatisplus.core.override.MybatisMapperMethod.execute(MybatisMapperMethod.java:77)
	at com.baomidou.mybatisplus.core.override.MybatisMapperProxy$PlainMethodInvoker.invoke(MybatisMapperProxy.java:152)
	at com.baomidou.mybatisplus.core.override.MybatisMapperProxy.invoke(MybatisMapperProxy.java:89)
	at jdk.proxy2/jdk.proxy2.$Proxy151.selectAllowedTypes(Unknown Source)
	at com.bgpay.bgai.service.deepseek.FileTypeService.refreshCache(FileTypeService.java:49)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:343)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:751)
	at org.springframework.aop.aspectj.AspectJAfterAdvice.invoke(AspectJAfterAdvice.java:49)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:173)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:751)
	at org.springframework.aop.framework.adapter.MethodBeforeAdviceInterceptor.invoke(MethodBeforeAdviceInterceptor.java:58)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:173)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:751)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:751)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:703)
	at com.bgpay.bgai.service.deepseek.FileTypeService$$SpringCGLIB$$0.refreshCache(<generated>)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at java.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:572)
	at java.base/java.util.concurrent.FutureTask.runAndReset$$$capture(FutureTask.java:358)
	at java.base/java.util.concurrent.FutureTask.runAndReset(FutureTask.java)
	at java.base/java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:305)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642)
	at java.base/java.lang.Thread.run(Thread.java:1583)
Caused by: org.apache.ibatis.exceptions.PersistenceException: 
### Error querying database.  Cause: org.springframework.jdbc.CannotGetJdbcConnectionException: Failed to obtain JDBC Connection
### The error may exist in com/bgpay/bgai/mapper/FileTypeMapper.java (best guess)
### The error may involve com.bgpay.bgai.mapper.FileTypeMapper.selectAllowedTypes
### The error occurred while executing a query
### Cause: org.springframework.jdbc.CannotGetJdbcConnectionException: Failed to obtain JDBC Connection
	at org.apache.ibatis.exceptions.ExceptionFactory.wrapException(ExceptionFactory.java:30)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.selectList(DefaultSqlSession.java:156)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.selectList(DefaultSqlSession.java:147)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.selectList(DefaultSqlSession.java:142)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:425)
	... 36 common frames omitted
Caused by: org.springframework.jdbc.CannotGetJdbcConnectionException: Failed to obtain JDBC Connection
	at org.springframework.jdbc.datasource.DataSourceUtils.getConnection(DataSourceUtils.java:84)
	at org.mybatis.spring.transaction.SpringManagedTransaction.openConnection(SpringManagedTransaction.java:80)
	at org.mybatis.spring.transaction.SpringManagedTransaction.getConnection(SpringManagedTransaction.java:67)
	at org.apache.ibatis.executor.BaseExecutor.getConnection(BaseExecutor.java:348)
	at org.apache.ibatis.executor.SimpleExecutor.prepareStatement(SimpleExecutor.java:89)
	at org.apache.ibatis.executor.SimpleExecutor.doQuery(SimpleExecutor.java:64)
	at org.apache.ibatis.executor.BaseExecutor.queryFromDatabase(BaseExecutor.java:336)
	at org.apache.ibatis.executor.BaseExecutor.query(BaseExecutor.java:158)
	at org.apache.ibatis.executor.CachingExecutor.query(CachingExecutor.java:110)
	at org.apache.ibatis.executor.CachingExecutor.query(CachingExecutor.java:90)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.selectList(DefaultSqlSession.java:154)
	... 41 common frames omitted
Caused by: java.sql.SQLException: null
	at com.alibaba.druid.pool.DruidDataSource.getConnectionInternal(DruidDataSource.java:1707)
	at com.alibaba.druid.pool.DruidDataSource.getConnectionDirect(DruidDataSource.java:1427)
	at com.alibaba.druid.pool.DruidDataSource.getConnection(DruidDataSource.java:1407)
	at com.alibaba.druid.pool.DruidDataSource.getConnection(DruidDataSource.java:1397)
	at com.alibaba.druid.pool.DruidDataSource.getConnection(DruidDataSource.java:100)
	at org.springframework.jdbc.datasource.lookup.AbstractRoutingDataSource.getConnection(AbstractRoutingDataSource.java:194)
	at org.springframework.jdbc.datasource.DataSourceUtils.fetchConnection(DataSourceUtils.java:160)
	at org.springframework.jdbc.datasource.DataSourceUtils.doGetConnection(DataSourceUtils.java:118)
	at org.springframework.jdbc.datasource.DataSourceUtils.getConnection(DataSourceUtils.java:81)
	... 51 common frames omitted
Caused by: java.lang.InterruptedException: null
	at java.base/java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.await(AbstractQueuedSynchronizer.java:1727)
	at com.alibaba.druid.pool.DruidDataSource.takeLast(DruidDataSource.java:2218)
	at com.alibaba.druid.pool.DruidDataSource.getConnectionInternal(DruidDataSource.java:1690)
	... 59 common frames omitted
2025-05-09 16:08:32.944 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-09 16:08:32.945 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-09 16:08:32.945 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-09 16:08:32.949 [SpringApplicationShutdownHook] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - De-registration finished.
2025-05-09 16:08:32.950 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.cache.ServiceInfoHolder do shutdown begin
2025-05-09 16:08:32.950 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.backups.FailoverReactor do shutdown begin
2025-05-09 16:08:32.952 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-09 16:08:33.253 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.backups.FailoverReactor do shutdown stop
2025-05-09 16:08:33.253 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.cache.ServiceInfoHolder do shutdown stop
2025-05-09 16:08:33.253 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.NamingClientProxyDelegate do shutdown begin
2025-05-09 16:08:33.253 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServiceInfoUpdateService do shutdown begin
2025-05-09 16:08:33.253 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServiceInfoUpdateService do shutdown stop
2025-05-09 16:08:33.253 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServerListManager do shutdown begin
2025-05-09 16:08:33.253 [SpringApplicationShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Start destroying NacosRestTemplate
2025-05-09 16:08:33.253 [SpringApplicationShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Destruction of the end
2025-05-09 16:08:33.253 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServerListManager do shutdown stop
2025-05-09 16:08:33.253 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.http.NamingHttpClientProxy do shutdown begin
2025-05-09 16:08:33.253 [SpringApplicationShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Start destroying NacosRestTemplate
2025-05-09 16:08:33.253 [SpringApplicationShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Destruction of the end
2025-05-09 16:08:33.253 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.http.NamingHttpClientProxy do shutdown stop
2025-05-09 16:08:33.253 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Shutdown rpc client, set status to shutdown
2025-05-09 16:08:33.253 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Shutdown client event executor java.util.concurrent.ScheduledThreadPoolExecutor@1edefb80[Running, pool size = 2, active threads = 2, queued tasks = 0, completed tasks = 0]
2025-05-09 16:08:33.253 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Close current connection 1746778112647_139.227.195.203_42214
2025-05-09 16:08:33.256 [nacos-grpc-client-executor-8.133.246.113-8] WARN  c.a.nacos.common.remote.client.grpc.GrpcClient - [1746778112647_139.227.195.203_42214]Ignore error event,isRunning:false,isAbandon=false
2025-05-09 16:08:33.257 [SpringApplicationShutdownHook] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - Shutdown grpc executor java.util.concurrent.ThreadPoolExecutor@3cdd54be[Running, pool size = 9, active threads = 0, queued tasks = 0, completed tasks = 9]
2025-05-09 16:08:33.258 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - Shutdown grpc redo service executor java.util.concurrent.ScheduledThreadPoolExecutor@39b8363b[Running, pool size = 1, active threads = 0, queued tasks = 1, completed tasks = 0]
2025-05-09 16:08:33.258 [SpringApplicationShutdownHook] INFO  c.a.n.client.auth.ram.identify.CredentialWatcher - [null] CredentialWatcher is stopped
2025-05-09 16:08:33.258 [SpringApplicationShutdownHook] INFO  c.a.n.client.auth.ram.identify.CredentialService - [null] CredentialService is freed
2025-05-09 16:08:33.258 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.NamingClientProxyDelegate do shutdown stop
2025-05-09 16:08:33.314 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:10911] result: true
2025-05-09 16:08:33.315 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:9876] result: true
2025-05-09 16:08:33.329 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:10911] result: true
2025-05-09 16:08:33.329 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:9876] result: true
2025-05-09 16:08:34.535 [com.alibaba.nacos.client.Worker] INFO  c.a.n.client.auth.ram.identify.CredentialWatcher - null No credential found
2025-05-09 16:08:35.391 [SpringApplicationShutdownHook] INFO  o.s.orm.jpa.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-05-09 16:08:35.392 [SpringApplicationShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-0} closing ...
2025-05-09 16:08:35.393 [SpringApplicationShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} closing ...
2025-05-09 16:08:35.397 [SpringApplicationShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} closed
2025-05-09 16:12:17.133 [main] WARN  com.alibaba.nacos.client.logging.NacosLogging - Load Logback Configuration of Nacos fail, message: Could not initialize Logback Nacos logging from classpath:nacos-logback.xml
2025-05-09 16:12:17.134 [main] INFO  com.bgpay.bgai.BgaiApplication - The following 1 profile is active: "dev"
2025-05-09 16:12:18.354 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-05-09 16:12:18.356 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-05-09 16:12:18.378 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 16 ms. Found 0 JPA repository interfaces.
2025-05-09 16:12:18.388 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-05-09 16:12:18.390 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-05-09 16:12:18.401 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 4 ms. Found 0 Redis repository interfaces.
2025-05-09 16:12:18.539 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'allowedFileTypeMapper' and 'com.bgpay.bgai.mapper.AllowedFileTypeMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 16:12:18.539 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'apiConfigMapper' and 'com.bgpay.bgai.mapper.ApiConfigMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 16:12:18.540 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'chatCompletionsMapper' and 'com.bgpay.bgai.mapper.ChatCompletionsMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 16:12:18.540 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'choicesMapper' and 'com.bgpay.bgai.mapper.ChoicesMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 16:12:18.540 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'fileTypeMapper' and 'com.bgpay.bgai.mapper.FileTypeMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 16:12:18.540 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'priceConfigMapper' and 'com.bgpay.bgai.mapper.PriceConfigMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 16:12:18.540 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'priceVersionMapper' and 'com.bgpay.bgai.mapper.PriceVersionMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 16:12:18.540 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'usageInfoMapper' and 'com.bgpay.bgai.mapper.UsageInfoMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 16:12:18.540 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'usageRecordMapper' and 'com.bgpay.bgai.mapper.UsageRecordMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 16:12:18.540 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'userMapper' and 'com.bgpay.bgai.mapper.UserMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 16:12:18.540 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - No MyBatis mapper was found in '[com.bgpay.bgai.mapper]' package. Please check your configuration.
2025-05-09 16:12:18.542 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'allowedFileTypeMapper' and 'com.bgpay.bgai.mapper.AllowedFileTypeMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 16:12:18.543 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'apiConfigMapper' and 'com.bgpay.bgai.mapper.ApiConfigMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 16:12:18.543 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'chatCompletionsMapper' and 'com.bgpay.bgai.mapper.ChatCompletionsMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 16:12:18.543 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'choicesMapper' and 'com.bgpay.bgai.mapper.ChoicesMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 16:12:18.543 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'fileTypeMapper' and 'com.bgpay.bgai.mapper.FileTypeMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 16:12:18.543 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'priceConfigMapper' and 'com.bgpay.bgai.mapper.PriceConfigMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 16:12:18.543 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'priceVersionMapper' and 'com.bgpay.bgai.mapper.PriceVersionMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 16:12:18.543 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'usageInfoMapper' and 'com.bgpay.bgai.mapper.UsageInfoMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 16:12:18.543 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'usageRecordMapper' and 'com.bgpay.bgai.mapper.UsageRecordMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 16:12:18.543 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'userMapper' and 'com.bgpay.bgai.mapper.UserMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 16:12:18.543 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - No MyBatis mapper was found in '[com.bgpay.bgai.mapper]' package. Please check your configuration.
2025-05-09 16:12:18.792 [main] INFO  o.springframework.cloud.context.scope.GenericScope - BeanFactory id=38ed5f2c-a148-3506-bdcb-f18d795b9667
2025-05-09 16:12:19.067 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'org.springframework.cloud.commons.config.CommonsConfigAutoConfiguration' of type [org.springframework.cloud.commons.config.CommonsConfigAutoConfiguration] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 16:12:19.074 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'org.springframework.cloud.client.loadbalancer.LoadBalancerDefaultMappingsProviderAutoConfiguration' of type [org.springframework.cloud.client.loadbalancer.LoadBalancerDefaultMappingsProviderAutoConfiguration] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 16:12:19.078 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'loadBalancerClientsDefaultsMappingsProvider' of type [org.springframework.cloud.client.loadbalancer.LoadBalancerDefaultMappingsProviderAutoConfiguration$$Lambda/0x0000020481726a68] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 16:12:19.089 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'defaultsBindHandlerAdvisor' of type [org.springframework.cloud.commons.config.DefaultsBindHandlerAdvisor] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 16:12:19.120 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'spring.datasource.dynamic-com.baomidou.dynamic.datasource.spring.boot.autoconfigure.DynamicDataSourceProperties' of type [com.baomidou.dynamic.datasource.spring.boot.autoconfigure.DynamicDataSourceProperties] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 16:12:19.131 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'com.baomidou.dynamic.datasource.spring.boot.autoconfigure.DynamicDataSourceAutoConfiguration' of type [com.baomidou.dynamic.datasource.spring.boot.autoconfigure.DynamicDataSourceAutoConfiguration$$SpringCGLIB$$0] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 16:12:19.146 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'dsProcessor' of type [com.baomidou.dynamic.datasource.processor.jakarta.DsJakartaHeaderProcessor] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 16:12:19.424 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'messageConverterConfiguration' of type [org.apache.rocketmq.spring.autoconfigure.MessageConverterConfiguration$$SpringCGLIB$$0] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 16:12:19.493 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'createRocketMQMessageConverter' of type [org.apache.rocketmq.spring.support.RocketMQMessageConverter] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 16:12:19.504 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'rocketmq-org.apache.rocketmq.spring.autoconfigure.RocketMQProperties' of type [org.apache.rocketmq.spring.autoconfigure.RocketMQProperties] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 16:12:19.508 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'listenerContainerConfiguration' of type [org.apache.rocketmq.spring.autoconfigure.ListenerContainerConfiguration$$SpringCGLIB$$0] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 16:12:19.540 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'org.springframework.cloud.client.loadbalancer.reactive.LoadBalancerBeanPostProcessorAutoConfiguration' of type [org.springframework.cloud.client.loadbalancer.reactive.LoadBalancerBeanPostProcessorAutoConfiguration] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 16:12:19.543 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'org.springframework.cloud.client.loadbalancer.reactive.LoadBalancerBeanPostProcessorAutoConfiguration$ReactorDeferringLoadBalancerFilterConfig' of type [org.springframework.cloud.client.loadbalancer.reactive.LoadBalancerBeanPostProcessorAutoConfiguration$ReactorDeferringLoadBalancerFilterConfig] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 16:12:19.547 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'reactorDeferringLoadBalancerExchangeFilterFunction' of type [org.springframework.cloud.client.loadbalancer.reactive.DeferringLoadBalancerExchangeFilterFunction] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 16:12:19.793 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat initialized with port(s): 8080 (http)
2025-05-09 16:12:19.801 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - Initializing ProtocolHandler ["http-nio-8080"]
2025-05-09 16:12:19.803 [main] INFO  org.apache.catalina.core.StandardService - Starting service [Tomcat]
2025-05-09 16:12:19.803 [main] INFO  org.apache.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.15]
2025-05-09 16:12:20.225 [main] INFO  org.hibernate.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-05-09 16:12:20.269 [main] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.1.7.Final
2025-05-09 16:12:20.552 [main] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} inited
2025-05-09 16:12:20.728 [main] INFO  SQL dialect - HHH000400: Using dialect: org.hibernate.dialect.MySQL8Dialect
2025-05-09 16:12:20.730 [main] WARN  org.hibernate.orm.deprecation - HHH90000026: MySQL8Dialect has been deprecated; use org.hibernate.dialect.MySQLDialect instead
2025-05-09 16:12:20.977 [main] INFO  o.h.e.t.jta.platform.internal.JtaPlatformInitiator - HHH000490: Using JtaPlatform implementation: [org.hibernate.engine.transaction.jta.platform.internal.NoJtaPlatform]
2025-05-09 16:12:20.987 [main] INFO  o.s.orm.jpa.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-05-09 16:12:21.359 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-09 16:12:21.383 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-09 16:12:21.419 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-09 16:12:21.421 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-09 16:12:21.422 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-09 16:12:21.432 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-09 16:12:22.061 [main] INFO  com.bgpay.bgai.service.impl.UserServiceImpl - 初始化SSO配置: clientId=bgai-client-id, redirectUri=http://localhost:8080/api/auth/callback
2025-05-09 16:12:22.149 [main] INFO  com.bgpay.bgai.controller.AuthController - 初始化认证控制器: clientId=bgai-client-id, redirectUri=http://localhost:8080/api/auth/callback
2025-05-09 16:12:22.965 [main] INFO  o.a.r.s.autoconfigure.RocketMQAutoConfiguration - a producer (billing-producer-group) init on namesrv 8.133.246.113:9876
2025-05-09 16:12:23.755 [main] INFO  org.redisson.Version - Redisson 3.24.3
2025-05-09 16:12:23.887 [redisson-netty-4-6] INFO  o.r.connection.pool.MasterPubSubConnectionPool - 1 connections initialized for 8.133.246.113/8.133.246.113:6379
2025-05-09 16:12:24.221 [redisson-netty-4-19] INFO  org.redisson.connection.pool.MasterConnectionPool - 24 connections initialized for 8.133.246.113/8.133.246.113:6379
2025-05-09 16:12:24.441 [main] INFO  com.bgpay.bgai.service.mq.MQConsumerService - MQ consumer startup successful [group=billing-consumer-group, topic=BILLING_TOPIC, tag=USER_BILLING]
2025-05-09 16:12:25.513 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [After]
2025-05-09 16:12:25.513 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Before]
2025-05-09 16:12:25.513 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Between]
2025-05-09 16:12:25.513 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Cookie]
2025-05-09 16:12:25.513 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Header]
2025-05-09 16:12:25.513 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Host]
2025-05-09 16:12:25.513 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Method]
2025-05-09 16:12:25.513 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Path]
2025-05-09 16:12:25.513 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Query]
2025-05-09 16:12:25.513 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [ReadBody]
2025-05-09 16:12:25.513 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [RemoteAddr]
2025-05-09 16:12:25.513 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [XForwardedRemoteAddr]
2025-05-09 16:12:25.513 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Weight]
2025-05-09 16:12:25.513 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [CloudFoundryRouteService]
2025-05-09 16:12:26.699 [main] INFO  o.s.b.actuate.endpoint.web.EndpointLinksResolver - Exposing 1 endpoint(s) beneath base path '/actuator'
2025-05-09 16:12:27.936 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - Starting ProtocolHandler ["http-nio-8080"]
2025-05-09 16:12:27.951 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat started on port(s): 8080 (http) with context path ''
2025-05-09 16:12:27.962 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from ans.namespace attribute : null
2025-05-09 16:12:27.962 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from ALIBABA_ALIWARE_NAMESPACE attribute :null
2025-05-09 16:12:27.963 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from namespace attribute :null
2025-05-09 16:12:27.971 [main] INFO  c.a.n.p.auth.spi.client.ClientAuthPluginManager - [ClientAuthPluginManager] Load ClientAuthService com.alibaba.nacos.client.auth.impl.NacosClientAuthServiceImpl success.
2025-05-09 16:12:27.971 [main] INFO  c.a.n.p.auth.spi.client.ClientAuthPluginManager - [ClientAuthPluginManager] Load ClientAuthService com.alibaba.nacos.client.auth.ram.RamClientAuthServiceImpl success.
2025-05-09 16:12:27.975 [main] INFO  com.alibaba.nacos.common.remote.client - [RpcClientFactory] create a new rpc client of 8b8f737b-d202-4a01-8131-c62a8115ed5a
2025-05-09 16:12:27.976 [main] INFO  com.alibaba.nacos.common.remote.client - [8b8f737b-d202-4a01-8131-c62a8115ed5a] RpcClient init, ServerListFactory = com.alibaba.nacos.client.naming.core.ServerListManager
2025-05-09 16:12:27.976 [main] INFO  com.alibaba.nacos.common.remote.client - [8b8f737b-d202-4a01-8131-c62a8115ed5a] Registry connection listener to current client:com.alibaba.nacos.client.naming.remote.gprc.redo.NamingGrpcRedoService
2025-05-09 16:12:27.977 [main] INFO  com.alibaba.nacos.common.remote.client - [8b8f737b-d202-4a01-8131-c62a8115ed5a] Register server push request handler:com.alibaba.nacos.client.naming.remote.gprc.NamingPushRequestHandler
2025-05-09 16:12:27.977 [main] INFO  com.alibaba.nacos.common.remote.client - [8b8f737b-d202-4a01-8131-c62a8115ed5a] Try to connect to server on start up, server: {serverIp = '8.133.246.113', server main port = 8848}
2025-05-09 16:12:27.978 [main] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - grpc client connection server:8.133.246.113 ip,serverPort:9848,grpcTslConfig:{"sslProvider":"OPENSSL","enableTls":false,"mutualAuthEnable":false,"trustAll":false}
2025-05-09 16:12:28.112 [main] INFO  com.alibaba.nacos.common.remote.client - [8b8f737b-d202-4a01-8131-c62a8115ed5a] Success to connect to server [8.133.246.113:8848] on start up, connectionId = 1746778347926_139.227.195.203_42378
2025-05-09 16:12:28.112 [main] INFO  com.alibaba.nacos.common.remote.client - [8b8f737b-d202-4a01-8131-c62a8115ed5a] Register server push request handler:com.alibaba.nacos.common.remote.client.RpcClient$ConnectResetRequestHandler
2025-05-09 16:12:28.112 [main] INFO  com.alibaba.nacos.common.remote.client - [8b8f737b-d202-4a01-8131-c62a8115ed5a] Register server push request handler:com.alibaba.nacos.common.remote.client.RpcClient$$Lambda/0x0000020481525d08
2025-05-09 16:12:28.112 [com.alibaba.nacos.client.remote.worker] INFO  com.alibaba.nacos.common.remote.client - [8b8f737b-d202-4a01-8131-c62a8115ed5a] Notify connected event to listeners.
2025-05-09 16:12:28.112 [com.alibaba.nacos.client.remote.worker] INFO  com.alibaba.nacos.client.naming - Grpc connection connect
2025-05-09 16:12:28.113 [main] INFO  com.alibaba.nacos.client.naming - [REGISTER-SERVICE] d750d92e-152f-4055-a641-3bc9dda85a29 registering service bgai with instance Instance{instanceId='null', ip='192.168.86.8', port=8080, weight=1.0, healthy=true, enabled=true, ephemeral=true, clusterName='DEFAULT', serviceName='null', metadata={IPv6=[2408:820c:7528:8342:f58d:7611:59f6:9fab], preserved.register.source=SPRING_CLOUD}}
2025-05-09 16:12:28.136 [main] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - nacos registry, DEFAULT_GROUP bgai 192.168.86.8:8080 register finished
2025-05-09 16:12:28.186 [main] INFO  com.bgpay.bgai.BgaiApplication - Started BgaiApplication in 12.923 seconds (process running for 14.125)
2025-05-09 16:12:28.190 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-09 16:12:28.190 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-09 16:12:28.202 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-09 16:12:28.202 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-09 16:12:28.202 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-09 16:12:28.215 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-09 16:12:28.215 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-09 16:12:28.215 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-09 16:12:28.225 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-09 16:12:28.226 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-09 16:12:28.226 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-09 16:12:28.234 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-09 16:12:28.239 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - nacos.cache.data.init.snapshot = true 
2025-05-09 16:12:28.240 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] common-dev.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-09 16:12:28.248 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=common-dev.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-09 16:12:28.249 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=common-dev.yaml, group=DEFAULT_GROUP
2025-05-09 16:12:28.260 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-09 16:12:28.260 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-09 16:12:28.260 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai.yaml, group=DEFAULT_GROUP
2025-05-09 16:12:28.260 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai-dev.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-09 16:12:28.261 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai-dev.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-09 16:12:28.261 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai-dev.yaml, group=DEFAULT_GROUP
2025-05-09 16:12:28.261 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-09 16:12:28.261 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai, group=DEFAULT_GROUP, cnt=1
2025-05-09 16:12:28.261 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai, group=DEFAULT_GROUP
2025-05-09 16:12:54.166 [http-nio-8080-exec-3] INFO  com.bgpay.bgai.controller.MockAuthController - Authorization request: client_id=bgai-client-id, redirect_uri=http://localhost:8080/api/auth/callback, response_type=code
2025-05-09 16:13:01.200 [http-nio-8080-exec-5] INFO  com.bgpay.bgai.controller.MockAuthController - Token request: grant_type=null, code=null, client_id=null
2025-05-09 16:13:01.222 [http-nio-8080-exec-4] DEBUG com.bgpay.bgai.mapper.UserMapper.findByUserId - ==>  Preparing: SELECT * FROM t_user WHERE user_id = ?
2025-05-09 16:13:01.223 [http-nio-8080-exec-4] DEBUG com.bgpay.bgai.mapper.UserMapper.findByUserId - ==> Parameters: 689258T(String)
2025-05-09 16:13:01.233 [http-nio-8080-exec-4] DEBUG com.bgpay.bgai.mapper.UserMapper.findByUserId - <==      Total: 1
2025-05-09 16:13:01.287 [http-nio-8080-exec-4] DEBUG com.bgpay.bgai.mapper.UserMapper.updateById - ==>  Preparing: UPDATE t_user SET user_id=?, username=?, email=?, avatar_url=?, last_login_time=?, access_token=?, refresh_token=?, token_expire_time=?, status=?, create_time=?, update_time=? WHERE id=?
2025-05-09 16:13:01.291 [http-nio-8080-exec-4] DEBUG com.bgpay.bgai.mapper.UserMapper.updateById - ==> Parameters: 689258T(String), 测试用户(String), test@example.com(String), https://ui-avatars.com/api/?name=测试用户(String), 2025-05-09T16:13:01.234126200(LocalDateTime), b10080f9-2ad3-42a3-8049-a56cc0006b31(String), 4f4d693c-98d0-4052-ba48-9cf4525e8fc1(String), 2025-05-09T17:13:01.234126200(LocalDateTime), 1(Integer), 2025-04-26T23:59:16(LocalDateTime), 2025-05-09T16:13:01.234126200(LocalDateTime), 1(Long)
2025-05-09 16:13:01.306 [http-nio-8080-exec-4] DEBUG com.bgpay.bgai.mapper.UserMapper.updateById - <==    Updates: 1
2025-05-09 16:13:15.368 [http-nio-8080-exec-8] INFO  com.bgpay.bgai.controller.EnhancedChatController - Received request to /Api/chat - question length: 6, multiTurn: false, modelName: 'null', apiUrl: 'null', apiKey: 'null'
2025-05-09 16:13:15.369 [http-nio-8080-exec-8] INFO  com.bgpay.bgai.controller.EnhancedChatController - Request headers: [x-api-key:"804822262af64439aeab611143864948", x-user-id:"689258T", content-type:"multipart/form-data; boundary=--------------------------944175599898921008618751", authorization:"Bearer b10080f9-2ad3-42a3-8049-a56cc0006b31", user-agent:"PostmanRuntime/7.43.4", accept:"*/*", cache-control:"no-cache", postman-token:"77195d47-4588-4793-bc15-10ba0d445962", host:"localhost:8080", accept-encoding:"gzip, deflate, br", connection:"keep-alive", content-length:"147366"]
2025-05-09 16:13:15.370 [http-nio-8080-exec-8] INFO  com.bgpay.bgai.controller.EnhancedChatController - Request query params: {}
2025-05-09 16:13:15.372 [http-nio-8080-exec-8] INFO  com.bgpay.bgai.controller.EnhancedChatController - Processing request with params: question length=6, modelName='null', userId='689258T'
2025-05-09 16:13:15.685 [Thread-56] DEBUG com.bgpay.bgai.mapper.ApiConfigMapper.selectList - ==>  Preparing: SELECT id,api_url,api_key,model_name,user_id FROM api_config WHERE (user_id = ? AND model_name <> ?) ORDER BY id DESC LIMIT 1
2025-05-09 16:13:15.686 [Thread-56] DEBUG com.bgpay.bgai.mapper.ApiConfigMapper.selectList - ==> Parameters: 689258T(String), deepseek-chat(String)
2025-05-09 16:13:15.694 [Thread-56] DEBUG com.bgpay.bgai.mapper.ApiConfigMapper.selectList - <==      Total: 1
2025-05-09 16:13:15.695 [Thread-56] INFO  com.bgpay.bgai.controller.EnhancedChatController - Resolved API config: url=https://api.deepseek.com/chat/completions, model=deepseek-reasoner
2025-05-09 16:14:41.436 [Thread-56] WARN  com.alibaba.druid.pool.DruidAbstractDataSource - discard long time none received connection. , jdbcUrl : jdbc:mysql://8.133.246.113:3306/deepseek?autoReconnect=false&useUnicode=true&characterEncoding=UTF-8&characterSetResults=UTF-8&zeroDateTimeBehavior=convertToNull&useSSL=false&allowPublicKeyRetrieval=true&useSSL=false, version : 1.2.8, lastPacketReceivedIdleMillis : 85732
2025-05-09 16:14:41.442 [Thread-56] WARN  com.alibaba.druid.pool.DruidAbstractDataSource - discard long time none received connection. , jdbcUrl : jdbc:mysql://8.133.246.113:3306/deepseek?autoReconnect=false&useUnicode=true&characterEncoding=UTF-8&characterSetResults=UTF-8&zeroDateTimeBehavior=convertToNull&useSSL=false&allowPublicKeyRetrieval=true&useSSL=false, version : 1.2.8, lastPacketReceivedIdleMillis : 133209
2025-05-09 16:14:41.501 [Thread-56] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - ==>  Preparing: INSERT INTO chat_completions ( object, created, model, system_fingerprint, api_key ) VALUES ( ?, ?, ?, ?, ? )
2025-05-09 16:14:41.502 [Thread-56] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - ==> Parameters: chat.completion(String), 1746778395(Long), deepseek-reasoner(String), fp_5417b77867_prod0425fp8(String), 48945a62-28a6-4372-a590-f35414d9fd9d(String)
2025-05-09 16:14:41.516 [Thread-56] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - <==    Updates: 1
2025-05-09 16:14:41.546 [FileWrite-1] INFO  com.bgpay.bgai.service.deepseek.FileWriterService - Successfully wrote content to: \var\data\ai_responses\059d670d-6b0a-4ba3-869b-b70a801de0a0.txt
2025-05-09 16:14:41.552 [ForkJoinPool.commonPool-worker-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.insert - ==>  Preparing: INSERT INTO usage_info ( chat_completion_id, prompt_tokens, completion_tokens, total_tokens, prompt_tokens_cached, completion_reasoning_tokens, prompt_cache_hit_tokens, prompt_cache_miss_tokens, created_at, model_type ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-05-09 16:14:41.553 [ForkJoinPool.commonPool-worker-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.insert - ==> Parameters: 48945a62-28a6-4372-a590-f35414d9fd9d(String), 1821(Integer), 1692(Integer), 3513(Integer), 0(Integer), 716(Integer), 0(Integer), 1821(Integer), 2025-05-09T16:14:41.543418900(LocalDateTime), deepseek-reasoner(String)
2025-05-09 16:14:41.566 [ForkJoinPool.commonPool-worker-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.insert - <==    Updates: 1
2025-05-09 16:14:41.625 [NettyClientPublicExecutor_1] INFO  org.reflections.Reflections - Message e0d05d5c-d7ee-4727-8847-0cd9f9e6357d 发送成功，执行清理操作
2025-05-09 16:15:19.905 [pool-7-thread-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.selectCount - ==>  Preparing: SELECT COUNT( * ) AS total FROM usage_info WHERE (chat_completion_id = ?)
2025-05-09 16:15:19.905 [pool-7-thread-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.selectCount - ==> Parameters: 48945a62-28a6-4372-a590-f35414d9fd9d(String)
2025-05-09 16:15:19.913 [pool-7-thread-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.selectCount - <==      Total: 1
2025-05-09 16:15:20.110 [ConsumeMessageThread_billing-consumer-group_1] INFO  c.bgpay.bgai.service.mq.RocketMQBillingServiceImpl - Output price config priceVersion: 1
2025-05-09 16:15:20.112 [ConsumeMessageThread_billing-consumer-group_1] DEBUG com.bgpay.bgai.mapper.UsageRecordMapper.insert - ==>  Preparing: INSERT INTO usage_record ( model_type, chat_completion_id, user_id, input_cost, output_cost, price_version, calculated_at ) VALUES ( ?, ?, ?, ?, ?, ?, ? )
2025-05-09 16:15:20.113 [ConsumeMessageThread_billing-consumer-group_1] DEBUG com.bgpay.bgai.mapper.UsageRecordMapper.insert - ==> Parameters: deepseek-reasoner(String), 48945a62-28a6-4372-a590-f35414d9fd9d(String), 689258T(String), 0.0073(BigDecimal), 0.0271(BigDecimal), 1(Integer), 2025-05-09T16:15:20.110590500(LocalDateTime)
2025-05-09 16:15:20.141 [ConsumeMessageThread_billing-consumer-group_1] DEBUG com.bgpay.bgai.mapper.UsageRecordMapper.insert - <==    Updates: 1
2025-05-09 16:15:20.155 [ConsumeMessageThread_billing-consumer-group_1] INFO  c.bgpay.bgai.service.mq.RocketMQBillingServiceImpl - Message consumed: 2408820C75288342F58D761159F69FAB68E436BAF30C2CAF3B9B0000
2025-05-09 16:15:26.910 [Thread-1] WARN  c.alibaba.nacos.common.http.HttpClientBeanHolder - [HttpClientBeanHolder] Start destroying common HttpClient
2025-05-09 16:15:26.910 [Thread-7] WARN  com.alibaba.nacos.common.notify.NotifyCenter - [NotifyCenter] Start destroying Publisher
2025-05-09 16:15:26.910 [Thread-7] WARN  com.alibaba.nacos.common.notify.NotifyCenter - [NotifyCenter] Destruction of the end
2025-05-09 16:15:26.911 [Thread-1] WARN  c.alibaba.nacos.common.http.HttpClientBeanHolder - [HttpClientBeanHolder] Destruction of the end
2025-05-09 16:15:26.927 [SpringApplicationShutdownHook] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - De-registering from Nacos Server now...
2025-05-09 16:15:26.927 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - [DEREGISTER-SERVICE] d750d92e-152f-4055-a641-3bc9dda85a29 deregistering service bgai with instance: Instance{instanceId='null', ip='192.168.86.8', port=8080, weight=1.0, healthy=true, enabled=true, ephemeral=true, clusterName='DEFAULT', serviceName='null', metadata={}}
2025-05-09 16:15:26.934 [SpringApplicationShutdownHook] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - De-registration finished.
2025-05-09 16:15:26.935 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.cache.ServiceInfoHolder do shutdown begin
2025-05-09 16:15:26.935 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.backups.FailoverReactor do shutdown begin
2025-05-09 16:15:26.936 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.backups.FailoverReactor do shutdown stop
2025-05-09 16:15:26.936 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.cache.ServiceInfoHolder do shutdown stop
2025-05-09 16:15:26.936 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.NamingClientProxyDelegate do shutdown begin
2025-05-09 16:15:26.936 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServiceInfoUpdateService do shutdown begin
2025-05-09 16:15:26.936 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServiceInfoUpdateService do shutdown stop
2025-05-09 16:15:26.936 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServerListManager do shutdown begin
2025-05-09 16:15:26.936 [SpringApplicationShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Start destroying NacosRestTemplate
2025-05-09 16:15:26.936 [SpringApplicationShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Destruction of the end
2025-05-09 16:15:26.936 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServerListManager do shutdown stop
2025-05-09 16:15:26.936 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.http.NamingHttpClientProxy do shutdown begin
2025-05-09 16:15:26.936 [SpringApplicationShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Start destroying NacosRestTemplate
2025-05-09 16:15:26.936 [SpringApplicationShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Destruction of the end
2025-05-09 16:15:26.936 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.http.NamingHttpClientProxy do shutdown stop
2025-05-09 16:15:26.936 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Shutdown rpc client, set status to shutdown
2025-05-09 16:15:26.936 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Shutdown client event executor java.util.concurrent.ScheduledThreadPoolExecutor@79ef07b3[Running, pool size = 2, active threads = 2, queued tasks = 0, completed tasks = 0]
2025-05-09 16:15:26.936 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Close current connection 1746778347926_139.227.195.203_42378
2025-05-09 16:15:26.945 [nacos-grpc-client-executor-8.133.246.113-48] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - [1746778347926_139.227.195.203_42378]Ignore complete event,isRunning:false,isAbandon=false
2025-05-09 16:15:26.948 [SpringApplicationShutdownHook] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - Shutdown grpc executor java.util.concurrent.ThreadPoolExecutor@15ffcd0c[Running, pool size = 4, active threads = 0, queued tasks = 0, completed tasks = 49]
2025-05-09 16:15:26.948 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - Shutdown grpc redo service executor java.util.concurrent.ScheduledThreadPoolExecutor@37e4c18[Running, pool size = 1, active threads = 0, queued tasks = 1, completed tasks = 59]
2025-05-09 16:15:26.948 [SpringApplicationShutdownHook] INFO  c.a.n.client.auth.ram.identify.CredentialWatcher - [null] CredentialWatcher is stopped
2025-05-09 16:15:26.948 [SpringApplicationShutdownHook] INFO  c.a.n.client.auth.ram.identify.CredentialService - [null] CredentialService is freed
2025-05-09 16:15:26.948 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.NamingClientProxyDelegate do shutdown stop
2025-05-09 16:15:27.126 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:10911] result: true
2025-05-09 16:15:27.127 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:10909] result: true
2025-05-09 16:15:27.127 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:9876] result: true
2025-05-09 16:15:27.153 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:10911] result: true
2025-05-09 16:15:27.153 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:9876] result: true
2025-05-09 16:15:29.353 [SpringApplicationShutdownHook] INFO  o.s.orm.jpa.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-05-09 16:15:29.355 [SpringApplicationShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-0} closing ...
2025-05-09 16:15:29.355 [SpringApplicationShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} closing ...
2025-05-09 16:15:29.358 [SpringApplicationShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} closed
2025-05-09 18:03:33.746 [main] WARN  com.alibaba.nacos.client.logging.NacosLogging - Load Logback Configuration of Nacos fail, message: Could not initialize Logback Nacos logging from classpath:nacos-logback.xml
2025-05-09 18:03:33.746 [main] INFO  com.bgpay.bgai.BgaiApplication - The following 1 profile is active: "dev"
2025-05-09 18:03:34.905 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-05-09 18:03:34.907 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-05-09 18:03:34.929 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 16 ms. Found 0 JPA repository interfaces.
2025-05-09 18:03:34.940 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-05-09 18:03:34.941 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-05-09 18:03:34.952 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 4 ms. Found 0 Redis repository interfaces.
2025-05-09 18:03:35.106 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'allowedFileTypeMapper' and 'com.bgpay.bgai.mapper.AllowedFileTypeMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 18:03:35.106 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'apiConfigMapper' and 'com.bgpay.bgai.mapper.ApiConfigMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 18:03:35.106 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'chatCompletionsMapper' and 'com.bgpay.bgai.mapper.ChatCompletionsMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 18:03:35.106 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'choicesMapper' and 'com.bgpay.bgai.mapper.ChoicesMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 18:03:35.107 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'fileTypeMapper' and 'com.bgpay.bgai.mapper.FileTypeMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 18:03:35.107 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'priceConfigMapper' and 'com.bgpay.bgai.mapper.PriceConfigMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 18:03:35.107 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'priceVersionMapper' and 'com.bgpay.bgai.mapper.PriceVersionMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 18:03:35.107 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'usageInfoMapper' and 'com.bgpay.bgai.mapper.UsageInfoMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 18:03:35.107 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'usageRecordMapper' and 'com.bgpay.bgai.mapper.UsageRecordMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 18:03:35.107 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'userMapper' and 'com.bgpay.bgai.mapper.UserMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 18:03:35.107 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - No MyBatis mapper was found in '[com.bgpay.bgai.mapper]' package. Please check your configuration.
2025-05-09 18:03:35.110 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'allowedFileTypeMapper' and 'com.bgpay.bgai.mapper.AllowedFileTypeMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 18:03:35.110 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'apiConfigMapper' and 'com.bgpay.bgai.mapper.ApiConfigMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 18:03:35.110 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'chatCompletionsMapper' and 'com.bgpay.bgai.mapper.ChatCompletionsMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 18:03:35.110 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'choicesMapper' and 'com.bgpay.bgai.mapper.ChoicesMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 18:03:35.110 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'fileTypeMapper' and 'com.bgpay.bgai.mapper.FileTypeMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 18:03:35.110 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'priceConfigMapper' and 'com.bgpay.bgai.mapper.PriceConfigMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 18:03:35.110 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'priceVersionMapper' and 'com.bgpay.bgai.mapper.PriceVersionMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 18:03:35.111 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'usageInfoMapper' and 'com.bgpay.bgai.mapper.UsageInfoMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 18:03:35.111 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'usageRecordMapper' and 'com.bgpay.bgai.mapper.UsageRecordMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 18:03:35.111 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'userMapper' and 'com.bgpay.bgai.mapper.UserMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 18:03:35.111 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - No MyBatis mapper was found in '[com.bgpay.bgai.mapper]' package. Please check your configuration.
2025-05-09 18:03:35.369 [main] INFO  o.springframework.cloud.context.scope.GenericScope - BeanFactory id=38ed5f2c-a148-3506-bdcb-f18d795b9667
2025-05-09 18:03:35.630 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'org.springframework.cloud.commons.config.CommonsConfigAutoConfiguration' of type [org.springframework.cloud.commons.config.CommonsConfigAutoConfiguration] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 18:03:35.637 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'org.springframework.cloud.client.loadbalancer.LoadBalancerDefaultMappingsProviderAutoConfiguration' of type [org.springframework.cloud.client.loadbalancer.LoadBalancerDefaultMappingsProviderAutoConfiguration] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 18:03:35.641 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'loadBalancerClientsDefaultsMappingsProvider' of type [org.springframework.cloud.client.loadbalancer.LoadBalancerDefaultMappingsProviderAutoConfiguration$$Lambda/0x0000025e3673df98] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 18:03:35.655 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'defaultsBindHandlerAdvisor' of type [org.springframework.cloud.commons.config.DefaultsBindHandlerAdvisor] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 18:03:35.699 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'spring.datasource.dynamic-com.baomidou.dynamic.datasource.spring.boot.autoconfigure.DynamicDataSourceProperties' of type [com.baomidou.dynamic.datasource.spring.boot.autoconfigure.DynamicDataSourceProperties] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 18:03:35.713 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'com.baomidou.dynamic.datasource.spring.boot.autoconfigure.DynamicDataSourceAutoConfiguration' of type [com.baomidou.dynamic.datasource.spring.boot.autoconfigure.DynamicDataSourceAutoConfiguration$$SpringCGLIB$$0] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 18:03:35.732 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'dsProcessor' of type [com.baomidou.dynamic.datasource.processor.jakarta.DsJakartaHeaderProcessor] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 18:03:36.013 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'messageConverterConfiguration' of type [org.apache.rocketmq.spring.autoconfigure.MessageConverterConfiguration$$SpringCGLIB$$0] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 18:03:36.088 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'createRocketMQMessageConverter' of type [org.apache.rocketmq.spring.support.RocketMQMessageConverter] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 18:03:36.098 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'rocketmq-org.apache.rocketmq.spring.autoconfigure.RocketMQProperties' of type [org.apache.rocketmq.spring.autoconfigure.RocketMQProperties] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 18:03:36.102 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'listenerContainerConfiguration' of type [org.apache.rocketmq.spring.autoconfigure.ListenerContainerConfiguration$$SpringCGLIB$$0] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 18:03:36.136 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'org.springframework.cloud.client.loadbalancer.reactive.LoadBalancerBeanPostProcessorAutoConfiguration' of type [org.springframework.cloud.client.loadbalancer.reactive.LoadBalancerBeanPostProcessorAutoConfiguration] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 18:03:36.141 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'org.springframework.cloud.client.loadbalancer.reactive.LoadBalancerBeanPostProcessorAutoConfiguration$ReactorDeferringLoadBalancerFilterConfig' of type [org.springframework.cloud.client.loadbalancer.reactive.LoadBalancerBeanPostProcessorAutoConfiguration$ReactorDeferringLoadBalancerFilterConfig] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 18:03:36.146 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'reactorDeferringLoadBalancerExchangeFilterFunction' of type [org.springframework.cloud.client.loadbalancer.reactive.DeferringLoadBalancerExchangeFilterFunction] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 18:03:36.398 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat initialized with port(s): 8080 (http)
2025-05-09 18:03:36.407 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - Initializing ProtocolHandler ["http-nio-8080"]
2025-05-09 18:03:36.409 [main] INFO  org.apache.catalina.core.StandardService - Starting service [Tomcat]
2025-05-09 18:03:36.409 [main] INFO  org.apache.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.15]
2025-05-09 18:03:36.824 [main] INFO  org.hibernate.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-05-09 18:03:36.871 [main] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.1.7.Final
2025-05-09 18:03:37.179 [main] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} inited
2025-05-09 18:03:37.367 [main] INFO  SQL dialect - HHH000400: Using dialect: org.hibernate.dialect.MySQL8Dialect
2025-05-09 18:03:37.369 [main] WARN  org.hibernate.orm.deprecation - HHH90000026: MySQL8Dialect has been deprecated; use org.hibernate.dialect.MySQLDialect instead
2025-05-09 18:03:37.614 [main] INFO  o.h.e.t.jta.platform.internal.JtaPlatformInitiator - HHH000490: Using JtaPlatform implementation: [org.hibernate.engine.transaction.jta.platform.internal.NoJtaPlatform]
2025-05-09 18:03:37.624 [main] INFO  o.s.orm.jpa.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-05-09 18:03:37.994 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-09 18:03:38.014 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-09 18:03:38.048 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-09 18:03:38.050 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-09 18:03:38.050 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-09 18:03:38.060 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-09 18:03:38.715 [main] INFO  com.bgpay.bgai.service.impl.UserServiceImpl - 初始化SSO配置: clientId=bgai-client-id, redirectUri=http://localhost:8080/api/auth/callback
2025-05-09 18:03:38.800 [main] INFO  com.bgpay.bgai.controller.AuthController - 初始化认证控制器: clientId=bgai-client-id, redirectUri=http://localhost:8080/api/auth/callback
2025-05-09 18:03:39.574 [main] INFO  o.a.r.s.autoconfigure.RocketMQAutoConfiguration - a producer (billing-producer-group) init on namesrv 8.133.246.113:9876
2025-05-09 18:03:40.403 [main] INFO  org.redisson.Version - Redisson 3.24.3
2025-05-09 18:03:40.563 [redisson-netty-4-7] INFO  o.r.connection.pool.MasterPubSubConnectionPool - 1 connections initialized for 8.133.246.113/8.133.246.113:6379
2025-05-09 18:03:40.888 [redisson-netty-4-19] INFO  org.redisson.connection.pool.MasterConnectionPool - 24 connections initialized for 8.133.246.113/8.133.246.113:6379
2025-05-09 18:03:41.129 [main] INFO  com.bgpay.bgai.service.mq.MQConsumerService - MQ consumer startup successful [group=billing-consumer-group, topic=BILLING_TOPIC, tag=USER_BILLING]
2025-05-09 18:03:42.341 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [After]
2025-05-09 18:03:42.341 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Before]
2025-05-09 18:03:42.341 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Between]
2025-05-09 18:03:42.341 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Cookie]
2025-05-09 18:03:42.341 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Header]
2025-05-09 18:03:42.341 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Host]
2025-05-09 18:03:42.342 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Method]
2025-05-09 18:03:42.342 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Path]
2025-05-09 18:03:42.342 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Query]
2025-05-09 18:03:42.342 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [ReadBody]
2025-05-09 18:03:42.342 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [RemoteAddr]
2025-05-09 18:03:42.342 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [XForwardedRemoteAddr]
2025-05-09 18:03:42.342 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Weight]
2025-05-09 18:03:42.342 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [CloudFoundryRouteService]
2025-05-09 18:03:43.581 [main] INFO  o.s.b.actuate.endpoint.web.EndpointLinksResolver - Exposing 1 endpoint(s) beneath base path '/actuator'
2025-05-09 18:03:44.885 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - Starting ProtocolHandler ["http-nio-8080"]
2025-05-09 18:03:44.898 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat started on port(s): 8080 (http) with context path ''
2025-05-09 18:03:44.908 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from ans.namespace attribute : null
2025-05-09 18:03:44.908 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from ALIBABA_ALIWARE_NAMESPACE attribute :null
2025-05-09 18:03:44.908 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from namespace attribute :null
2025-05-09 18:03:44.916 [main] INFO  c.a.n.p.auth.spi.client.ClientAuthPluginManager - [ClientAuthPluginManager] Load ClientAuthService com.alibaba.nacos.client.auth.impl.NacosClientAuthServiceImpl success.
2025-05-09 18:03:44.916 [main] INFO  c.a.n.p.auth.spi.client.ClientAuthPluginManager - [ClientAuthPluginManager] Load ClientAuthService com.alibaba.nacos.client.auth.ram.RamClientAuthServiceImpl success.
2025-05-09 18:03:44.919 [main] INFO  com.alibaba.nacos.common.remote.client - [RpcClientFactory] create a new rpc client of 3d16d513-539b-4c53-8c65-398d9d28a872
2025-05-09 18:03:44.920 [main] INFO  com.alibaba.nacos.common.remote.client - [3d16d513-539b-4c53-8c65-398d9d28a872] RpcClient init, ServerListFactory = com.alibaba.nacos.client.naming.core.ServerListManager
2025-05-09 18:03:44.920 [main] INFO  com.alibaba.nacos.common.remote.client - [3d16d513-539b-4c53-8c65-398d9d28a872] Registry connection listener to current client:com.alibaba.nacos.client.naming.remote.gprc.redo.NamingGrpcRedoService
2025-05-09 18:03:44.921 [main] INFO  com.alibaba.nacos.common.remote.client - [3d16d513-539b-4c53-8c65-398d9d28a872] Register server push request handler:com.alibaba.nacos.client.naming.remote.gprc.NamingPushRequestHandler
2025-05-09 18:03:44.921 [main] INFO  com.alibaba.nacos.common.remote.client - [3d16d513-539b-4c53-8c65-398d9d28a872] Try to connect to server on start up, server: {serverIp = '8.133.246.113', server main port = 8848}
2025-05-09 18:03:44.922 [main] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - grpc client connection server:8.133.246.113 ip,serverPort:9848,grpcTslConfig:{"sslProvider":"OPENSSL","enableTls":false,"mutualAuthEnable":false,"trustAll":false}
2025-05-09 18:03:45.050 [main] INFO  com.alibaba.nacos.common.remote.client - [3d16d513-539b-4c53-8c65-398d9d28a872] Success to connect to server [8.133.246.113:8848] on start up, connectionId = 1746785024901_139.227.195.203_42353
2025-05-09 18:03:45.050 [main] INFO  com.alibaba.nacos.common.remote.client - [3d16d513-539b-4c53-8c65-398d9d28a872] Register server push request handler:com.alibaba.nacos.common.remote.client.RpcClient$ConnectResetRequestHandler
2025-05-09 18:03:45.050 [com.alibaba.nacos.client.remote.worker] INFO  com.alibaba.nacos.common.remote.client - [3d16d513-539b-4c53-8c65-398d9d28a872] Notify connected event to listeners.
2025-05-09 18:03:45.050 [main] INFO  com.alibaba.nacos.common.remote.client - [3d16d513-539b-4c53-8c65-398d9d28a872] Register server push request handler:com.alibaba.nacos.common.remote.client.RpcClient$$Lambda/0x0000025e3652e2d8
2025-05-09 18:03:45.050 [com.alibaba.nacos.client.remote.worker] INFO  com.alibaba.nacos.client.naming - Grpc connection connect
2025-05-09 18:03:45.051 [main] INFO  com.alibaba.nacos.client.naming - [REGISTER-SERVICE] d750d92e-152f-4055-a641-3bc9dda85a29 registering service bgai with instance Instance{instanceId='null', ip='192.168.86.8', port=8080, weight=1.0, healthy=true, enabled=true, ephemeral=true, clusterName='DEFAULT', serviceName='null', metadata={IPv6=[2408:820c:7528:8342:f58d:7611:59f6:9fab], preserved.register.source=SPRING_CLOUD}}
2025-05-09 18:03:45.067 [main] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - nacos registry, DEFAULT_GROUP bgai 192.168.86.8:8080 register finished
2025-05-09 18:03:45.111 [main] INFO  com.bgpay.bgai.BgaiApplication - Started BgaiApplication in 13.387 seconds (process running for 14.777)
2025-05-09 18:03:45.114 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-09 18:03:45.114 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-09 18:03:45.125 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-09 18:03:45.125 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-09 18:03:45.125 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-09 18:03:45.137 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-09 18:03:45.137 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-09 18:03:45.137 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-09 18:03:45.146 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-09 18:03:45.146 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-09 18:03:45.146 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-09 18:03:45.155 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-09 18:03:45.158 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - nacos.cache.data.init.snapshot = true 
2025-05-09 18:03:45.159 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] common-dev.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-09 18:03:45.165 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=common-dev.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-09 18:03:45.165 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=common-dev.yaml, group=DEFAULT_GROUP
2025-05-09 18:03:45.167 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-09 18:03:45.167 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-09 18:03:45.167 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai.yaml, group=DEFAULT_GROUP
2025-05-09 18:03:45.168 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai-dev.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-09 18:03:45.168 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai-dev.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-09 18:03:45.168 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai-dev.yaml, group=DEFAULT_GROUP
2025-05-09 18:03:45.168 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-09 18:03:45.168 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai, group=DEFAULT_GROUP, cnt=1
2025-05-09 18:03:45.168 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai, group=DEFAULT_GROUP
2025-05-09 18:03:45.374 [RMI TCP Connection(3)-192.168.86.8] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-2} inited
2025-05-09 18:04:02.508 [http-nio-8080-exec-3] INFO  com.bgpay.bgai.controller.MockAuthController - Authorization request: client_id=bgai-client-id, redirect_uri=http://localhost:8080/api/auth/callback, response_type=code
2025-05-09 18:04:12.893 [http-nio-8080-exec-4] INFO  com.bgpay.bgai.controller.MockAuthController - Token request: grant_type=null, code=null, client_id=null
2025-05-09 18:04:12.910 [http-nio-8080-exec-5] DEBUG com.bgpay.bgai.mapper.UserMapper.findByUserId - ==>  Preparing: SELECT * FROM t_user WHERE user_id = ?
2025-05-09 18:04:12.911 [http-nio-8080-exec-5] DEBUG com.bgpay.bgai.mapper.UserMapper.findByUserId - ==> Parameters: 689258T(String)
2025-05-09 18:04:12.920 [http-nio-8080-exec-5] DEBUG com.bgpay.bgai.mapper.UserMapper.findByUserId - <==      Total: 1
2025-05-09 18:04:12.971 [http-nio-8080-exec-5] DEBUG com.bgpay.bgai.mapper.UserMapper.updateById - ==>  Preparing: UPDATE t_user SET user_id=?, username=?, email=?, avatar_url=?, last_login_time=?, access_token=?, refresh_token=?, token_expire_time=?, status=?, create_time=?, update_time=? WHERE id=?
2025-05-09 18:04:12.975 [http-nio-8080-exec-5] DEBUG com.bgpay.bgai.mapper.UserMapper.updateById - ==> Parameters: 689258T(String), 测试用户(String), test@example.com(String), https://ui-avatars.com/api/?name=测试用户(String), 2025-05-09T18:04:12.921682900(LocalDateTime), c20974ca-4ee1-48a1-af2e-6ef719287732(String), 56983d79-1eb7-45cb-b47e-e87f838f55f3(String), 2025-05-09T19:04:12.921682900(LocalDateTime), 1(Integer), 2025-04-26T23:59:16(LocalDateTime), 2025-05-09T18:04:12.921682900(LocalDateTime), 1(Long)
2025-05-09 18:04:12.995 [http-nio-8080-exec-5] DEBUG com.bgpay.bgai.mapper.UserMapper.updateById - <==    Updates: 1
2025-05-09 18:04:26.602 [http-nio-8080-exec-7] INFO  com.bgpay.bgai.controller.EnhancedChatController - Received request to /Api/chat - question length: 6, multiTurn: false, modelName: 'null', apiUrl: 'null', apiKey: 'null'
2025-05-09 18:04:26.602 [http-nio-8080-exec-7] INFO  com.bgpay.bgai.controller.EnhancedChatController - Request headers: [x-api-key:"804822262af64439aeab611143864948", x-user-id:"689258T", content-type:"multipart/form-data; boundary=--------------------------725179803038760106703477", authorization:"Bearer c20974ca-4ee1-48a1-af2e-6ef719287732", user-agent:"PostmanRuntime/7.43.4", accept:"*/*", cache-control:"no-cache", postman-token:"4e3e4009-73b8-47c0-9a33-10afe62e06bd", host:"localhost:8080", accept-encoding:"gzip, deflate, br", connection:"keep-alive", content-length:"147366"]
2025-05-09 18:04:26.603 [http-nio-8080-exec-7] INFO  com.bgpay.bgai.controller.EnhancedChatController - Request query params: {}
2025-05-09 18:04:26.605 [http-nio-8080-exec-7] INFO  com.bgpay.bgai.controller.EnhancedChatController - Processing request with params: question length=6, modelName='null', userId='689258T'
2025-05-09 18:04:26.889 [Thread-55] DEBUG com.bgpay.bgai.mapper.ApiConfigMapper.selectList - ==>  Preparing: SELECT id,api_url,api_key,model_name,user_id FROM api_config WHERE (user_id = ? AND model_name <> ?) ORDER BY id DESC LIMIT 1
2025-05-09 18:04:26.889 [Thread-55] DEBUG com.bgpay.bgai.mapper.ApiConfigMapper.selectList - ==> Parameters: 689258T(String), deepseek-chat(String)
2025-05-09 18:04:26.899 [Thread-55] DEBUG com.bgpay.bgai.mapper.ApiConfigMapper.selectList - <==      Total: 1
2025-05-09 18:04:26.899 [Thread-55] INFO  com.bgpay.bgai.controller.EnhancedChatController - Resolved API config: url=https://api.deepseek.com/chat/completions, model=deepseek-reasoner
2025-05-09 18:05:41.286 [Thread-55] WARN  com.alibaba.druid.pool.DruidAbstractDataSource - discard long time none received connection. , jdbcUrl : jdbc:mysql://8.133.246.113:3306/deepseek?autoReconnect=false&useUnicode=true&characterEncoding=UTF-8&characterSetResults=UTF-8&zeroDateTimeBehavior=convertToNull&useSSL=false&allowPublicKeyRetrieval=true&useSSL=false, version : 1.2.8, lastPacketReceivedIdleMillis : 74379
2025-05-09 18:05:41.294 [Thread-55] WARN  com.alibaba.druid.pool.DruidAbstractDataSource - discard long time none received connection. , jdbcUrl : jdbc:mysql://8.133.246.113:3306/deepseek?autoReconnect=false&useUnicode=true&characterEncoding=UTF-8&characterSetResults=UTF-8&zeroDateTimeBehavior=convertToNull&useSSL=false&allowPublicKeyRetrieval=true&useSSL=false, version : 1.2.8, lastPacketReceivedIdleMillis : 116140
2025-05-09 18:05:41.340 [Thread-55] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - ==>  Preparing: INSERT INTO chat_completions ( object, created, model, system_fingerprint, api_key ) VALUES ( ?, ?, ?, ?, ? )
2025-05-09 18:05:41.340 [Thread-55] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - ==> Parameters: chat.completion(String), 1746785067(Long), deepseek-reasoner(String), fp_5417b77867_prod0425fp8(String), 9c0ab30c-083d-4b4f-bb8d-86de04a2ad1a(String)
2025-05-09 18:05:41.352 [Thread-55] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - <==    Updates: 1
2025-05-09 18:05:41.376 [FileWrite-1] INFO  com.bgpay.bgai.service.deepseek.FileWriterService - Successfully wrote content to: \var\data\ai_responses\7b7236af-826f-4b33-afae-3c7f4a67129d.txt
2025-05-09 18:05:41.380 [ForkJoinPool.commonPool-worker-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.insert - ==>  Preparing: INSERT INTO usage_info ( chat_completion_id, prompt_tokens, completion_tokens, total_tokens, prompt_tokens_cached, completion_reasoning_tokens, prompt_cache_hit_tokens, prompt_cache_miss_tokens, created_at, model_type ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-05-09 18:05:41.381 [ForkJoinPool.commonPool-worker-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.insert - ==> Parameters: 9c0ab30c-083d-4b4f-bb8d-86de04a2ad1a(String), 1821(Integer), 1502(Integer), 3323(Integer), 1792(Integer), 598(Integer), 0(Integer), 29(Integer), 2025-05-09T18:05:41.373748100(LocalDateTime), deepseek-reasoner(String)
2025-05-09 18:05:41.391 [ForkJoinPool.commonPool-worker-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.insert - <==    Updates: 1
2025-05-09 18:05:41.442 [NettyClientPublicExecutor_1] INFO  org.reflections.Reflections - Message 435ae202-8bb1-49a5-94f0-b7af8f460e81 发送成功，执行清理操作
2025-05-09 18:06:20.029 [pool-7-thread-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.selectCount - ==>  Preparing: SELECT COUNT( * ) AS total FROM usage_info WHERE (chat_completion_id = ?)
2025-05-09 18:06:20.029 [pool-7-thread-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.selectCount - ==> Parameters: 9c0ab30c-083d-4b4f-bb8d-86de04a2ad1a(String)
2025-05-09 18:06:20.035 [pool-7-thread-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.selectCount - <==      Total: 1
2025-05-09 18:06:20.125 [ConsumeMessageThread_billing-consumer-group_1] DEBUG c.bgpay.bgai.mapper.PriceConfigMapper.selectList - ==>  Preparing: SELECT id,model_type,time_period,cache_status,io_type,price,version,effective_time FROM price_config WHERE (model_type = ? AND time_period = ? AND io_type = ? AND effective_time <= ? AND cache_status = ?) ORDER BY effective_time DESC LIMIT 1
2025-05-09 18:06:20.125 [ConsumeMessageThread_billing-consumer-group_1] DEBUG c.bgpay.bgai.mapper.PriceConfigMapper.selectList - ==> Parameters: deepseek-reasoner(String), discount(String), input(String), 2025-05-09T18:06:20.122389600(LocalDateTime), miss(String)
2025-05-09 18:06:20.133 [ConsumeMessageThread_billing-consumer-group_1] DEBUG c.bgpay.bgai.mapper.PriceConfigMapper.selectList - <==      Total: 1
2025-05-09 18:06:20.203 [ConsumeMessageThread_billing-consumer-group_1] DEBUG c.bgpay.bgai.mapper.PriceConfigMapper.selectList - ==>  Preparing: SELECT id,model_type,time_period,cache_status,io_type,price,version,effective_time FROM price_config WHERE (model_type = ? AND time_period = ? AND io_type = ? AND effective_time <= ? AND cache_status IS NULL) ORDER BY effective_time DESC LIMIT 1
2025-05-09 18:06:20.204 [ConsumeMessageThread_billing-consumer-group_1] DEBUG c.bgpay.bgai.mapper.PriceConfigMapper.selectList - ==> Parameters: deepseek-reasoner(String), discount(String), output(String), 2025-05-09T18:06:20.202388500(LocalDateTime)
2025-05-09 18:06:20.210 [ConsumeMessageThread_billing-consumer-group_1] DEBUG c.bgpay.bgai.mapper.PriceConfigMapper.selectList - <==      Total: 1
2025-05-09 18:06:20.265 [ConsumeMessageThread_billing-consumer-group_1] INFO  c.bgpay.bgai.service.mq.RocketMQBillingServiceImpl - Output price config priceVersion: 1
2025-05-09 18:06:20.269 [ConsumeMessageThread_billing-consumer-group_1] DEBUG com.bgpay.bgai.mapper.UsageRecordMapper.insert - ==>  Preparing: INSERT INTO usage_record ( model_type, chat_completion_id, user_id, input_cost, output_cost, price_version, calculated_at ) VALUES ( ?, ?, ?, ?, ?, ?, ? )
2025-05-09 18:06:20.270 [ConsumeMessageThread_billing-consumer-group_1] DEBUG com.bgpay.bgai.mapper.UsageRecordMapper.insert - ==> Parameters: deepseek-reasoner(String), 9c0ab30c-083d-4b4f-bb8d-86de04a2ad1a(String), 689258T(String), 0.0000(BigDecimal), 0.0060(BigDecimal), 1(Integer), 2025-05-09T18:06:20.266392800(LocalDateTime)
2025-05-09 18:06:20.289 [ConsumeMessageThread_billing-consumer-group_1] DEBUG com.bgpay.bgai.mapper.UsageRecordMapper.insert - <==    Updates: 1
2025-05-09 18:06:20.297 [ConsumeMessageThread_billing-consumer-group_1] INFO  c.bgpay.bgai.service.mq.RocketMQBillingServiceImpl - Message consumed: 2408820C75288342F58D761159F69FAB7A5836BAF30C2D14DA920000
2025-05-09 18:06:44.139 [Thread-7] WARN  com.alibaba.nacos.common.notify.NotifyCenter - [NotifyCenter] Start destroying Publisher
2025-05-09 18:06:44.139 [Thread-1] WARN  c.alibaba.nacos.common.http.HttpClientBeanHolder - [HttpClientBeanHolder] Start destroying common HttpClient
2025-05-09 18:06:44.139 [Thread-7] WARN  com.alibaba.nacos.common.notify.NotifyCenter - [NotifyCenter] Destruction of the end
2025-05-09 18:06:44.140 [Thread-1] WARN  c.alibaba.nacos.common.http.HttpClientBeanHolder - [HttpClientBeanHolder] Destruction of the end
2025-05-09 18:06:44.158 [SpringApplicationShutdownHook] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - De-registering from Nacos Server now...
2025-05-09 18:06:44.158 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - [DEREGISTER-SERVICE] d750d92e-152f-4055-a641-3bc9dda85a29 deregistering service bgai with instance: Instance{instanceId='null', ip='192.168.86.8', port=8080, weight=1.0, healthy=true, enabled=true, ephemeral=true, clusterName='DEFAULT', serviceName='null', metadata={}}
2025-05-09 18:06:44.166 [SpringApplicationShutdownHook] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - De-registration finished.
2025-05-09 18:06:44.167 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.cache.ServiceInfoHolder do shutdown begin
2025-05-09 18:06:44.167 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.backups.FailoverReactor do shutdown begin
2025-05-09 18:06:44.167 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.backups.FailoverReactor do shutdown stop
2025-05-09 18:06:44.168 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.cache.ServiceInfoHolder do shutdown stop
2025-05-09 18:06:44.168 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.NamingClientProxyDelegate do shutdown begin
2025-05-09 18:06:44.168 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServiceInfoUpdateService do shutdown begin
2025-05-09 18:06:44.168 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServiceInfoUpdateService do shutdown stop
2025-05-09 18:06:44.168 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServerListManager do shutdown begin
2025-05-09 18:06:44.168 [SpringApplicationShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Start destroying NacosRestTemplate
2025-05-09 18:06:44.168 [SpringApplicationShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Destruction of the end
2025-05-09 18:06:44.168 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServerListManager do shutdown stop
2025-05-09 18:06:44.168 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.http.NamingHttpClientProxy do shutdown begin
2025-05-09 18:06:44.168 [SpringApplicationShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Start destroying NacosRestTemplate
2025-05-09 18:06:44.168 [SpringApplicationShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Destruction of the end
2025-05-09 18:06:44.168 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.http.NamingHttpClientProxy do shutdown stop
2025-05-09 18:06:44.168 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Shutdown rpc client, set status to shutdown
2025-05-09 18:06:44.168 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Shutdown client event executor java.util.concurrent.ScheduledThreadPoolExecutor@1c5bb8e7[Running, pool size = 2, active threads = 2, queued tasks = 0, completed tasks = 0]
2025-05-09 18:06:44.168 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Close current connection 1746785024901_139.227.195.203_42353
2025-05-09 18:06:44.172 [nacos-grpc-client-executor-8.133.246.113-49] WARN  c.a.nacos.common.remote.client.grpc.GrpcClient - [1746785024901_139.227.195.203_42353]Ignore error event,isRunning:false,isAbandon=false
2025-05-09 18:06:44.173 [SpringApplicationShutdownHook] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - Shutdown grpc executor java.util.concurrent.ThreadPoolExecutor@7dc95d5f[Running, pool size = 5, active threads = 0, queued tasks = 0, completed tasks = 50]
2025-05-09 18:06:44.174 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - Shutdown grpc redo service executor java.util.concurrent.ScheduledThreadPoolExecutor@1a80c87b[Running, pool size = 1, active threads = 0, queued tasks = 1, completed tasks = 59]
2025-05-09 18:06:44.174 [SpringApplicationShutdownHook] INFO  c.a.n.client.auth.ram.identify.CredentialWatcher - [null] CredentialWatcher is stopped
2025-05-09 18:06:44.174 [SpringApplicationShutdownHook] INFO  c.a.n.client.auth.ram.identify.CredentialService - [null] CredentialService is freed
2025-05-09 18:06:44.174 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.NamingClientProxyDelegate do shutdown stop
2025-05-09 18:06:44.219 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:10911] result: true
2025-05-09 18:06:44.220 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:9876] result: true
2025-05-09 18:06:44.220 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:10909] result: true
2025-05-09 18:06:44.235 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:10911] result: true
2025-05-09 18:06:44.235 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:9876] result: true
2025-05-09 18:06:46.427 [SpringApplicationShutdownHook] INFO  o.s.orm.jpa.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-05-09 18:06:46.429 [SpringApplicationShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-2} closing ...
2025-05-09 18:06:46.432 [SpringApplicationShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-2} closed
2025-05-09 18:06:46.432 [SpringApplicationShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} closing ...
2025-05-09 18:06:46.432 [SpringApplicationShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} closed
2025-05-09 20:02:42.366 [main] WARN  com.alibaba.nacos.client.logging.NacosLogging - Load Logback Configuration of Nacos fail, message: Could not initialize Logback Nacos logging from classpath:nacos-logback.xml
2025-05-09 20:02:42.367 [main] INFO  com.bgpay.bgai.BgaiApplication - The following 1 profile is active: "dev"
2025-05-09 20:02:43.609 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-05-09 20:02:43.611 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-05-09 20:02:43.637 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 19 ms. Found 0 JPA repository interfaces.
2025-05-09 20:02:43.650 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-05-09 20:02:43.651 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-05-09 20:02:43.665 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 5 ms. Found 0 Redis repository interfaces.
2025-05-09 20:02:43.878 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'allowedFileTypeMapper' and 'com.bgpay.bgai.mapper.AllowedFileTypeMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 20:02:43.879 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'apiConfigMapper' and 'com.bgpay.bgai.mapper.ApiConfigMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 20:02:43.879 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'chatCompletionsMapper' and 'com.bgpay.bgai.mapper.ChatCompletionsMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 20:02:43.879 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'choicesMapper' and 'com.bgpay.bgai.mapper.ChoicesMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 20:02:43.879 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'fileTypeMapper' and 'com.bgpay.bgai.mapper.FileTypeMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 20:02:43.879 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'priceConfigMapper' and 'com.bgpay.bgai.mapper.PriceConfigMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 20:02:43.879 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'priceVersionMapper' and 'com.bgpay.bgai.mapper.PriceVersionMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 20:02:43.879 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'usageInfoMapper' and 'com.bgpay.bgai.mapper.UsageInfoMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 20:02:43.879 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'usageRecordMapper' and 'com.bgpay.bgai.mapper.UsageRecordMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 20:02:43.879 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'userMapper' and 'com.bgpay.bgai.mapper.UserMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 20:02:43.879 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - No MyBatis mapper was found in '[com.bgpay.bgai.mapper]' package. Please check your configuration.
2025-05-09 20:02:43.882 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'allowedFileTypeMapper' and 'com.bgpay.bgai.mapper.AllowedFileTypeMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 20:02:43.882 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'apiConfigMapper' and 'com.bgpay.bgai.mapper.ApiConfigMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 20:02:43.882 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'chatCompletionsMapper' and 'com.bgpay.bgai.mapper.ChatCompletionsMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 20:02:43.882 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'choicesMapper' and 'com.bgpay.bgai.mapper.ChoicesMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 20:02:43.882 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'fileTypeMapper' and 'com.bgpay.bgai.mapper.FileTypeMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 20:02:43.882 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'priceConfigMapper' and 'com.bgpay.bgai.mapper.PriceConfigMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 20:02:43.882 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'priceVersionMapper' and 'com.bgpay.bgai.mapper.PriceVersionMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 20:02:43.882 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'usageInfoMapper' and 'com.bgpay.bgai.mapper.UsageInfoMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 20:02:43.882 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'usageRecordMapper' and 'com.bgpay.bgai.mapper.UsageRecordMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 20:02:43.883 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'userMapper' and 'com.bgpay.bgai.mapper.UserMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 20:02:43.883 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - No MyBatis mapper was found in '[com.bgpay.bgai.mapper]' package. Please check your configuration.
2025-05-09 20:02:44.155 [main] INFO  o.springframework.cloud.context.scope.GenericScope - BeanFactory id=38ed5f2c-a148-3506-bdcb-f18d795b9667
2025-05-09 20:02:44.407 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'org.springframework.cloud.commons.config.CommonsConfigAutoConfiguration' of type [org.springframework.cloud.commons.config.CommonsConfigAutoConfiguration] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 20:02:44.413 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'org.springframework.cloud.client.loadbalancer.LoadBalancerDefaultMappingsProviderAutoConfiguration' of type [org.springframework.cloud.client.loadbalancer.LoadBalancerDefaultMappingsProviderAutoConfiguration] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 20:02:44.417 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'loadBalancerClientsDefaultsMappingsProvider' of type [org.springframework.cloud.client.loadbalancer.LoadBalancerDefaultMappingsProviderAutoConfiguration$$Lambda/0x000002238273f9e8] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 20:02:44.425 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'defaultsBindHandlerAdvisor' of type [org.springframework.cloud.commons.config.DefaultsBindHandlerAdvisor] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 20:02:44.454 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'spring.datasource.dynamic-com.baomidou.dynamic.datasource.spring.boot.autoconfigure.DynamicDataSourceProperties' of type [com.baomidou.dynamic.datasource.spring.boot.autoconfigure.DynamicDataSourceProperties] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 20:02:44.464 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'com.baomidou.dynamic.datasource.spring.boot.autoconfigure.DynamicDataSourceAutoConfiguration' of type [com.baomidou.dynamic.datasource.spring.boot.autoconfigure.DynamicDataSourceAutoConfiguration$$SpringCGLIB$$0] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 20:02:44.479 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'dsProcessor' of type [com.baomidou.dynamic.datasource.processor.jakarta.DsJakartaHeaderProcessor] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 20:02:44.778 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'messageConverterConfiguration' of type [org.apache.rocketmq.spring.autoconfigure.MessageConverterConfiguration$$SpringCGLIB$$0] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 20:02:44.839 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'createRocketMQMessageConverter' of type [org.apache.rocketmq.spring.support.RocketMQMessageConverter] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 20:02:44.848 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'rocketmq-org.apache.rocketmq.spring.autoconfigure.RocketMQProperties' of type [org.apache.rocketmq.spring.autoconfigure.RocketMQProperties] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 20:02:44.852 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'listenerContainerConfiguration' of type [org.apache.rocketmq.spring.autoconfigure.ListenerContainerConfiguration$$SpringCGLIB$$0] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 20:02:44.887 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'org.springframework.cloud.client.loadbalancer.reactive.LoadBalancerBeanPostProcessorAutoConfiguration' of type [org.springframework.cloud.client.loadbalancer.reactive.LoadBalancerBeanPostProcessorAutoConfiguration] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 20:02:44.891 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'org.springframework.cloud.client.loadbalancer.reactive.LoadBalancerBeanPostProcessorAutoConfiguration$ReactorDeferringLoadBalancerFilterConfig' of type [org.springframework.cloud.client.loadbalancer.reactive.LoadBalancerBeanPostProcessorAutoConfiguration$ReactorDeferringLoadBalancerFilterConfig] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 20:02:44.895 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'reactorDeferringLoadBalancerExchangeFilterFunction' of type [org.springframework.cloud.client.loadbalancer.reactive.DeferringLoadBalancerExchangeFilterFunction] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 20:02:45.165 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat initialized with port(s): 8080 (http)
2025-05-09 20:02:45.176 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - Initializing ProtocolHandler ["http-nio-8080"]
2025-05-09 20:02:45.178 [main] INFO  org.apache.catalina.core.StandardService - Starting service [Tomcat]
2025-05-09 20:02:45.178 [main] INFO  org.apache.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.15]
2025-05-09 20:02:45.597 [main] INFO  org.hibernate.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-05-09 20:02:45.645 [main] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.1.7.Final
2025-05-09 20:02:45.937 [main] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} inited
2025-05-09 20:02:46.100 [main] INFO  SQL dialect - HHH000400: Using dialect: org.hibernate.dialect.MySQL8Dialect
2025-05-09 20:02:46.102 [main] WARN  org.hibernate.orm.deprecation - HHH90000026: MySQL8Dialect has been deprecated; use org.hibernate.dialect.MySQLDialect instead
2025-05-09 20:02:46.366 [main] INFO  o.h.e.t.jta.platform.internal.JtaPlatformInitiator - HHH000490: Using JtaPlatform implementation: [org.hibernate.engine.transaction.jta.platform.internal.NoJtaPlatform]
2025-05-09 20:02:46.377 [main] INFO  o.s.orm.jpa.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-05-09 20:02:46.743 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-09 20:02:46.763 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-09 20:02:46.805 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-09 20:02:46.807 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-09 20:02:46.808 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-09 20:02:46.821 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-09 20:02:47.436 [main] INFO  com.bgpay.bgai.service.impl.UserServiceImpl - 初始化SSO配置: clientId=bgai-client-id, redirectUri=http://localhost:8080/api/auth/callback
2025-05-09 20:02:47.529 [main] INFO  com.bgpay.bgai.controller.AuthController - 初始化认证控制器: clientId=bgai-client-id, redirectUri=http://localhost:8080/api/auth/callback
2025-05-09 20:02:48.332 [main] INFO  o.a.r.s.autoconfigure.RocketMQAutoConfiguration - a producer (billing-producer-group) init on namesrv 8.133.246.113:9876
2025-05-09 20:02:49.091 [main] INFO  org.redisson.Version - Redisson 3.24.3
2025-05-09 20:02:49.220 [redisson-netty-4-6] INFO  o.r.connection.pool.MasterPubSubConnectionPool - 1 connections initialized for 8.133.246.113/8.133.246.113:6379
2025-05-09 20:02:49.558 [redisson-netty-4-19] INFO  org.redisson.connection.pool.MasterConnectionPool - 24 connections initialized for 8.133.246.113/8.133.246.113:6379
2025-05-09 20:02:49.788 [main] INFO  com.bgpay.bgai.service.mq.MQConsumerService - MQ consumer startup successful [group=billing-consumer-group, topic=BILLING_TOPIC, tag=USER_BILLING]
2025-05-09 20:02:50.897 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [After]
2025-05-09 20:02:50.898 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Before]
2025-05-09 20:02:50.898 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Between]
2025-05-09 20:02:50.898 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Cookie]
2025-05-09 20:02:50.898 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Header]
2025-05-09 20:02:50.898 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Host]
2025-05-09 20:02:50.898 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Method]
2025-05-09 20:02:50.898 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Path]
2025-05-09 20:02:50.898 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Query]
2025-05-09 20:02:50.898 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [ReadBody]
2025-05-09 20:02:50.898 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [RemoteAddr]
2025-05-09 20:02:50.898 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [XForwardedRemoteAddr]
2025-05-09 20:02:50.898 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Weight]
2025-05-09 20:02:50.898 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [CloudFoundryRouteService]
2025-05-09 20:02:52.032 [main] INFO  o.s.b.actuate.endpoint.web.EndpointLinksResolver - Exposing 1 endpoint(s) beneath base path '/actuator'
2025-05-09 20:02:53.293 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - Starting ProtocolHandler ["http-nio-8080"]
2025-05-09 20:02:53.307 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat started on port(s): 8080 (http) with context path ''
2025-05-09 20:02:53.317 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from ans.namespace attribute : null
2025-05-09 20:02:53.318 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from ALIBABA_ALIWARE_NAMESPACE attribute :null
2025-05-09 20:02:53.318 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from namespace attribute :null
2025-05-09 20:02:53.326 [main] INFO  c.a.n.p.auth.spi.client.ClientAuthPluginManager - [ClientAuthPluginManager] Load ClientAuthService com.alibaba.nacos.client.auth.impl.NacosClientAuthServiceImpl success.
2025-05-09 20:02:53.326 [main] INFO  c.a.n.p.auth.spi.client.ClientAuthPluginManager - [ClientAuthPluginManager] Load ClientAuthService com.alibaba.nacos.client.auth.ram.RamClientAuthServiceImpl success.
2025-05-09 20:02:53.330 [main] INFO  com.alibaba.nacos.common.remote.client - [RpcClientFactory] create a new rpc client of 9ff0247f-3fad-4eff-b2ba-fb769d6613eb
2025-05-09 20:02:53.331 [main] INFO  com.alibaba.nacos.common.remote.client - [9ff0247f-3fad-4eff-b2ba-fb769d6613eb] RpcClient init, ServerListFactory = com.alibaba.nacos.client.naming.core.ServerListManager
2025-05-09 20:02:53.331 [main] INFO  com.alibaba.nacos.common.remote.client - [9ff0247f-3fad-4eff-b2ba-fb769d6613eb] Registry connection listener to current client:com.alibaba.nacos.client.naming.remote.gprc.redo.NamingGrpcRedoService
2025-05-09 20:02:53.332 [main] INFO  com.alibaba.nacos.common.remote.client - [9ff0247f-3fad-4eff-b2ba-fb769d6613eb] Register server push request handler:com.alibaba.nacos.client.naming.remote.gprc.NamingPushRequestHandler
2025-05-09 20:02:53.332 [main] INFO  com.alibaba.nacos.common.remote.client - [9ff0247f-3fad-4eff-b2ba-fb769d6613eb] Try to connect to server on start up, server: {serverIp = '8.133.246.113', server main port = 8848}
2025-05-09 20:02:53.332 [main] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - grpc client connection server:8.133.246.113 ip,serverPort:9848,grpcTslConfig:{"sslProvider":"OPENSSL","enableTls":false,"mutualAuthEnable":false,"trustAll":false}
2025-05-09 20:02:53.863 [main] INFO  com.alibaba.nacos.common.remote.client - [9ff0247f-3fad-4eff-b2ba-fb769d6613eb] Success to connect to server [8.133.246.113:8848] on start up, connectionId = 1746792173733_139.227.195.203_43342
2025-05-09 20:02:53.863 [com.alibaba.nacos.client.remote.worker] INFO  com.alibaba.nacos.common.remote.client - [9ff0247f-3fad-4eff-b2ba-fb769d6613eb] Notify connected event to listeners.
2025-05-09 20:02:53.863 [main] INFO  com.alibaba.nacos.common.remote.client - [9ff0247f-3fad-4eff-b2ba-fb769d6613eb] Register server push request handler:com.alibaba.nacos.common.remote.client.RpcClient$ConnectResetRequestHandler
2025-05-09 20:02:53.863 [com.alibaba.nacos.client.remote.worker] INFO  com.alibaba.nacos.client.naming - Grpc connection connect
2025-05-09 20:02:53.863 [main] INFO  com.alibaba.nacos.common.remote.client - [9ff0247f-3fad-4eff-b2ba-fb769d6613eb] Register server push request handler:com.alibaba.nacos.common.remote.client.RpcClient$$Lambda/0x000002238252f6a0
2025-05-09 20:02:53.864 [main] INFO  com.alibaba.nacos.client.naming - [REGISTER-SERVICE] d750d92e-152f-4055-a641-3bc9dda85a29 registering service bgai with instance Instance{instanceId='null', ip='192.168.86.8', port=8080, weight=1.0, healthy=true, enabled=true, ephemeral=true, clusterName='DEFAULT', serviceName='null', metadata={IPv6=[2408:820c:7528:8342:f58d:7611:59f6:9fab], preserved.register.source=SPRING_CLOUD}}
2025-05-09 20:02:53.900 [main] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - nacos registry, DEFAULT_GROUP bgai 192.168.86.8:8080 register finished
2025-05-09 20:02:53.946 [main] INFO  com.bgpay.bgai.BgaiApplication - Started BgaiApplication in 13.499 seconds (process running for 14.777)
2025-05-09 20:02:53.948 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-09 20:02:53.949 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-09 20:02:53.959 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-09 20:02:53.960 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-09 20:02:53.960 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-09 20:02:53.977 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-09 20:02:53.977 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-09 20:02:53.977 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-09 20:02:53.985 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-09 20:02:53.985 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-09 20:02:53.985 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-09 20:02:53.992 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-09 20:02:53.996 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - nacos.cache.data.init.snapshot = true 
2025-05-09 20:02:53.996 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] common-dev.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-09 20:02:54.002 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=common-dev.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-09 20:02:54.003 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=common-dev.yaml, group=DEFAULT_GROUP
2025-05-09 20:02:54.004 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-09 20:02:54.004 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-09 20:02:54.004 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai.yaml, group=DEFAULT_GROUP
2025-05-09 20:02:54.004 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai-dev.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-09 20:02:54.004 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai-dev.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-09 20:02:54.004 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai-dev.yaml, group=DEFAULT_GROUP
2025-05-09 20:02:54.005 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-09 20:02:54.005 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai, group=DEFAULT_GROUP, cnt=1
2025-05-09 20:02:54.005 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai, group=DEFAULT_GROUP
2025-05-09 20:02:54.566 [RMI TCP Connection(2)-192.168.86.8] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-2} inited
2025-05-09 20:03:05.714 [http-nio-8080-exec-3] INFO  com.bgpay.bgai.controller.MockAuthController - Authorization request: client_id=bgai-client-id, redirect_uri=http://localhost:8080/api/auth/callback, response_type=code
2025-05-09 20:03:14.155 [http-nio-8080-exec-5] INFO  com.bgpay.bgai.controller.MockAuthController - Token request: grant_type=null, code=null, client_id=null
2025-05-09 20:03:14.173 [http-nio-8080-exec-4] DEBUG com.bgpay.bgai.mapper.UserMapper.findByUserId - ==>  Preparing: SELECT * FROM t_user WHERE user_id = ?
2025-05-09 20:03:14.175 [http-nio-8080-exec-4] DEBUG com.bgpay.bgai.mapper.UserMapper.findByUserId - ==> Parameters: 689258T(String)
2025-05-09 20:03:14.204 [http-nio-8080-exec-4] DEBUG com.bgpay.bgai.mapper.UserMapper.findByUserId - <==      Total: 1
2025-05-09 20:03:14.256 [http-nio-8080-exec-4] DEBUG com.bgpay.bgai.mapper.UserMapper.updateById - ==>  Preparing: UPDATE t_user SET user_id=?, username=?, email=?, avatar_url=?, last_login_time=?, access_token=?, refresh_token=?, token_expire_time=?, status=?, create_time=?, update_time=? WHERE id=?
2025-05-09 20:03:14.259 [http-nio-8080-exec-4] DEBUG com.bgpay.bgai.mapper.UserMapper.updateById - ==> Parameters: 689258T(String), 测试用户(String), test@example.com(String), https://ui-avatars.com/api/?name=测试用户(String), 2025-05-09T20:03:14.204440200(LocalDateTime), 5e578761-a771-440c-b856-ff1825faccb3(String), 972016b2-45d4-44e8-9ea8-42612afbf7b2(String), 2025-05-09T21:03:14.204440200(LocalDateTime), 1(Integer), 2025-04-26T23:59:16(LocalDateTime), 2025-05-09T20:03:14.204440200(LocalDateTime), 1(Long)
2025-05-09 20:03:14.278 [http-nio-8080-exec-4] DEBUG com.bgpay.bgai.mapper.UserMapper.updateById - <==    Updates: 1
2025-05-09 20:03:32.244 [http-nio-8080-exec-8] INFO  com.bgpay.bgai.controller.EnhancedChatController - Received request to /Api/chat - question length: 6, multiTurn: false, modelName: 'null', apiUrl: 'null', apiKey: 'null'
2025-05-09 20:03:32.244 [http-nio-8080-exec-8] INFO  com.bgpay.bgai.controller.EnhancedChatController - Request headers: [x-api-key:"804822262af64439aeab611143864948", x-user-id:"689258T", content-type:"multipart/form-data; boundary=--------------------------856678792680853938220017", authorization:"Bearer 5e578761-a771-440c-b856-ff1825faccb3", user-agent:"PostmanRuntime/7.43.4", accept:"*/*", cache-control:"no-cache", postman-token:"a506baf9-fb25-43c1-b3f5-8bebc886312c", host:"localhost:8080", accept-encoding:"gzip, deflate, br", connection:"keep-alive", content-length:"147366"]
2025-05-09 20:03:32.247 [http-nio-8080-exec-8] INFO  com.bgpay.bgai.controller.EnhancedChatController - Request query params: {}
2025-05-09 20:03:32.250 [http-nio-8080-exec-8] INFO  com.bgpay.bgai.controller.EnhancedChatController - Processing request with params: question length=6, modelName='null', userId='689258T'
2025-05-09 20:03:32.619 [Thread-55] DEBUG com.bgpay.bgai.mapper.ApiConfigMapper.selectList - ==>  Preparing: SELECT id,api_url,api_key,model_name,user_id FROM api_config WHERE (user_id = ? AND model_name <> ?) ORDER BY id DESC LIMIT 1
2025-05-09 20:03:32.619 [Thread-55] DEBUG com.bgpay.bgai.mapper.ApiConfigMapper.selectList - ==> Parameters: 689258T(String), deepseek-chat(String)
2025-05-09 20:03:32.636 [Thread-55] DEBUG com.bgpay.bgai.mapper.ApiConfigMapper.selectList - <==      Total: 1
2025-05-09 20:03:32.636 [Thread-55] INFO  com.bgpay.bgai.controller.EnhancedChatController - Resolved API config: url=https://api.deepseek.com/chat/completions, model=deepseek-reasoner
2025-05-09 20:04:47.978 [Thread-55] WARN  com.alibaba.druid.pool.DruidAbstractDataSource - discard long time none received connection. , jdbcUrl : jdbc:mysql://8.133.246.113:3306/deepseek?autoReconnect=false&useUnicode=true&characterEncoding=UTF-8&characterSetResults=UTF-8&zeroDateTimeBehavior=convertToNull&useSSL=false&allowPublicKeyRetrieval=true&useSSL=false, version : 1.2.8, lastPacketReceivedIdleMillis : 75335
2025-05-09 20:04:47.983 [Thread-55] WARN  com.alibaba.druid.pool.DruidAbstractDataSource - discard long time none received connection. , jdbcUrl : jdbc:mysql://8.133.246.113:3306/deepseek?autoReconnect=false&useUnicode=true&characterEncoding=UTF-8&characterSetResults=UTF-8&zeroDateTimeBehavior=convertToNull&useSSL=false&allowPublicKeyRetrieval=true&useSSL=false, version : 1.2.8, lastPacketReceivedIdleMillis : 113991
2025-05-09 20:04:48.051 [Thread-55] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - ==>  Preparing: INSERT INTO chat_completions ( object, created, model, system_fingerprint, api_key ) VALUES ( ?, ?, ?, ?, ? )
2025-05-09 20:04:48.051 [Thread-55] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - ==> Parameters: chat.completion(String), 1746792212(Long), deepseek-reasoner(String), fp_5417b77867_prod0425fp8(String), 5aa3e867-0bd8-43e1-add9-baa2e4a2a3aa(String)
2025-05-09 20:04:48.077 [Thread-55] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - <==    Updates: 1
2025-05-09 20:04:48.104 [FileWrite-1] INFO  com.bgpay.bgai.service.deepseek.FileWriterService - Successfully wrote content to: \var\data\ai_responses\a613b52d-5e72-4b75-ba49-086f24b20fc0.txt
2025-05-09 20:04:48.110 [ForkJoinPool.commonPool-worker-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.insert - ==>  Preparing: INSERT INTO usage_info ( chat_completion_id, prompt_tokens, completion_tokens, total_tokens, prompt_tokens_cached, completion_reasoning_tokens, prompt_cache_hit_tokens, prompt_cache_miss_tokens, created_at, model_type ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-05-09 20:04:48.111 [ForkJoinPool.commonPool-worker-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.insert - ==> Parameters: 5aa3e867-0bd8-43e1-add9-baa2e4a2a3aa(String), 1821(Integer), 1499(Integer), 3320(Integer), 1792(Integer), 481(Integer), 0(Integer), 29(Integer), 2025-05-09T20:04:48.100659700(LocalDateTime), deepseek-reasoner(String)
2025-05-09 20:04:48.140 [ForkJoinPool.commonPool-worker-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.insert - <==    Updates: 1
2025-05-09 20:04:48.256 [NettyClientPublicExecutor_1] INFO  org.reflections.Reflections - Message 1b7498f9-c24f-4be2-b3cd-8125fbac871b 发送成功，执行清理操作
2025-05-09 20:05:20.661 [pool-7-thread-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.selectCount - ==>  Preparing: SELECT COUNT( * ) AS total FROM usage_info WHERE (chat_completion_id = ?)
2025-05-09 20:05:20.662 [pool-7-thread-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.selectCount - ==> Parameters: 5aa3e867-0bd8-43e1-add9-baa2e4a2a3aa(String)
2025-05-09 20:05:20.669 [pool-7-thread-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.selectCount - <==      Total: 1
2025-05-09 20:05:20.747 [ConsumeMessageThread_billing-consumer-group_1] DEBUG c.bgpay.bgai.mapper.PriceConfigMapper.selectList - ==>  Preparing: SELECT id,model_type,time_period,cache_status,io_type,price,version,effective_time FROM price_config WHERE (model_type = ? AND time_period = ? AND io_type = ? AND effective_time <= ? AND cache_status = ?) ORDER BY effective_time DESC LIMIT 1
2025-05-09 20:05:20.747 [ConsumeMessageThread_billing-consumer-group_1] DEBUG c.bgpay.bgai.mapper.PriceConfigMapper.selectList - ==> Parameters: deepseek-reasoner(String), discount(String), input(String), 2025-05-09T20:05:20.745430600(LocalDateTime), miss(String)
2025-05-09 20:05:20.760 [ConsumeMessageThread_billing-consumer-group_1] DEBUG c.bgpay.bgai.mapper.PriceConfigMapper.selectList - <==      Total: 1
2025-05-09 20:05:20.833 [ConsumeMessageThread_billing-consumer-group_1] DEBUG c.bgpay.bgai.mapper.PriceConfigMapper.selectList - ==>  Preparing: SELECT id,model_type,time_period,cache_status,io_type,price,version,effective_time FROM price_config WHERE (model_type = ? AND time_period = ? AND io_type = ? AND effective_time <= ? AND cache_status IS NULL) ORDER BY effective_time DESC LIMIT 1
2025-05-09 20:05:20.833 [ConsumeMessageThread_billing-consumer-group_1] DEBUG c.bgpay.bgai.mapper.PriceConfigMapper.selectList - ==> Parameters: deepseek-reasoner(String), discount(String), output(String), 2025-05-09T20:05:20.832445500(LocalDateTime)
2025-05-09 20:05:20.840 [ConsumeMessageThread_billing-consumer-group_1] DEBUG c.bgpay.bgai.mapper.PriceConfigMapper.selectList - <==      Total: 1
2025-05-09 20:05:20.892 [ConsumeMessageThread_billing-consumer-group_1] INFO  c.bgpay.bgai.service.mq.RocketMQBillingServiceImpl - Output price config priceVersion: 1
2025-05-09 20:05:20.894 [ConsumeMessageThread_billing-consumer-group_1] DEBUG com.bgpay.bgai.mapper.UsageRecordMapper.insert - ==>  Preparing: INSERT INTO usage_record ( model_type, chat_completion_id, user_id, input_cost, output_cost, price_version, calculated_at ) VALUES ( ?, ?, ?, ?, ?, ?, ? )
2025-05-09 20:05:20.895 [ConsumeMessageThread_billing-consumer-group_1] DEBUG com.bgpay.bgai.mapper.UsageRecordMapper.insert - ==> Parameters: deepseek-reasoner(String), 5aa3e867-0bd8-43e1-add9-baa2e4a2a3aa(String), 689258T(String), 0.0000(BigDecimal), 0.0060(BigDecimal), 1(Integer), 2025-05-09T20:05:20.892963400(LocalDateTime)
2025-05-09 20:05:20.947 [ConsumeMessageThread_billing-consumer-group_1] DEBUG com.bgpay.bgai.mapper.UsageRecordMapper.insert - <==    Updates: 1
2025-05-09 20:05:20.954 [ConsumeMessageThread_billing-consumer-group_1] INFO  c.bgpay.bgai.service.mq.RocketMQBillingServiceImpl - Message consumed: 2408820C75288342F58D761159F69FAB82B436BAF30C2D81E7810000
2025-05-09 20:06:48.253 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:10909] result: true
2025-05-09 20:07:53.962 [scheduling-1] WARN  com.alibaba.druid.pool.DruidAbstractDataSource - discard long time none received connection. , jdbcUrl : jdbc:mysql://8.133.246.113:3306/deepseek?autoReconnect=false&useUnicode=true&characterEncoding=UTF-8&characterSetResults=UTF-8&zeroDateTimeBehavior=convertToNull&useSSL=false&allowPublicKeyRetrieval=true&useSSL=false, version : 1.2.8, lastPacketReceivedIdleMillis : 153014
2025-05-09 20:07:54.026 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-09 20:07:54.026 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-09 20:07:54.035 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-09 20:07:54.035 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-09 20:07:54.035 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-09 20:07:54.041 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-09 20:12:55.018 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-09 20:12:55.018 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-09 20:12:55.027 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-09 20:12:55.028 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-09 20:12:55.028 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-09 20:12:55.035 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-09 20:17:55.001 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-09 20:17:55.002 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-09 20:17:55.009 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-09 20:17:55.009 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-09 20:17:55.009 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-09 20:17:55.015 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-09 20:22:55.057 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-09 20:22:55.057 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-09 20:22:55.068 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-09 20:22:55.069 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-09 20:22:55.069 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-09 20:22:55.078 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-09 20:27:55.012 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-09 20:27:55.013 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-09 20:27:55.065 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-09 20:27:55.065 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-09 20:27:55.065 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-09 20:27:55.074 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-09 20:32:55.009 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-09 20:32:55.009 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-09 20:32:55.017 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-09 20:32:55.018 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-09 20:32:55.018 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-09 20:32:55.026 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-09 20:37:55.027 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-09 20:37:55.027 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-09 20:37:55.036 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-09 20:37:55.036 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-09 20:37:55.036 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-09 20:37:55.043 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-09 20:42:55.006 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-09 20:42:55.006 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-09 20:42:55.014 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-09 20:42:55.015 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-09 20:42:55.015 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-09 20:42:55.021 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-09 20:46:20.250 [Thread-7] WARN  com.alibaba.nacos.common.notify.NotifyCenter - [NotifyCenter] Start destroying Publisher
2025-05-09 20:46:20.250 [Thread-1] WARN  c.alibaba.nacos.common.http.HttpClientBeanHolder - [HttpClientBeanHolder] Start destroying common HttpClient
2025-05-09 20:46:20.250 [Thread-7] WARN  com.alibaba.nacos.common.notify.NotifyCenter - [NotifyCenter] Destruction of the end
2025-05-09 20:46:20.252 [Thread-1] WARN  c.alibaba.nacos.common.http.HttpClientBeanHolder - [HttpClientBeanHolder] Destruction of the end
2025-05-09 20:46:20.290 [SpringApplicationShutdownHook] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - De-registering from Nacos Server now...
2025-05-09 20:46:20.290 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - [DEREGISTER-SERVICE] d750d92e-152f-4055-a641-3bc9dda85a29 deregistering service bgai with instance: Instance{instanceId='null', ip='192.168.86.8', port=8080, weight=1.0, healthy=true, enabled=true, ephemeral=true, clusterName='DEFAULT', serviceName='null', metadata={}}
2025-05-09 20:46:20.298 [SpringApplicationShutdownHook] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - De-registration finished.
2025-05-09 20:46:20.300 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.cache.ServiceInfoHolder do shutdown begin
2025-05-09 20:46:20.300 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.backups.FailoverReactor do shutdown begin
2025-05-09 20:46:20.301 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.backups.FailoverReactor do shutdown stop
2025-05-09 20:46:20.301 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.cache.ServiceInfoHolder do shutdown stop
2025-05-09 20:46:20.301 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.NamingClientProxyDelegate do shutdown begin
2025-05-09 20:46:20.301 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServiceInfoUpdateService do shutdown begin
2025-05-09 20:46:20.301 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServiceInfoUpdateService do shutdown stop
2025-05-09 20:46:20.301 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServerListManager do shutdown begin
2025-05-09 20:46:20.301 [SpringApplicationShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Start destroying NacosRestTemplate
2025-05-09 20:46:20.301 [SpringApplicationShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Destruction of the end
2025-05-09 20:46:20.301 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServerListManager do shutdown stop
2025-05-09 20:46:20.301 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.http.NamingHttpClientProxy do shutdown begin
2025-05-09 20:46:20.301 [SpringApplicationShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Start destroying NacosRestTemplate
2025-05-09 20:46:20.301 [SpringApplicationShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Destruction of the end
2025-05-09 20:46:20.301 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.http.NamingHttpClientProxy do shutdown stop
2025-05-09 20:46:20.302 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Shutdown rpc client, set status to shutdown
2025-05-09 20:46:20.302 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Shutdown client event executor java.util.concurrent.ScheduledThreadPoolExecutor@2f4ea879[Running, pool size = 2, active threads = 2, queued tasks = 0, completed tasks = 0]
2025-05-09 20:46:20.302 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Close current connection 1746792173733_139.227.195.203_43342
2025-05-09 20:46:20.307 [nacos-grpc-client-executor-8.133.246.113-551] WARN  c.a.nacos.common.remote.client.grpc.GrpcClient - [1746792173733_139.227.195.203_43342]Ignore error event,isRunning:false,isAbandon=false
2025-05-09 20:46:20.310 [SpringApplicationShutdownHook] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - Shutdown grpc executor java.util.concurrent.ThreadPoolExecutor@2f1ff021[Running, pool size = 4, active threads = 0, queued tasks = 0, completed tasks = 552]
2025-05-09 20:46:20.310 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - Shutdown grpc redo service executor java.util.concurrent.ScheduledThreadPoolExecutor@2343f7a5[Running, pool size = 1, active threads = 0, queued tasks = 1, completed tasks = 868]
2025-05-09 20:46:20.310 [SpringApplicationShutdownHook] INFO  c.a.n.client.auth.ram.identify.CredentialWatcher - [null] CredentialWatcher is stopped
2025-05-09 20:46:20.311 [SpringApplicationShutdownHook] INFO  c.a.n.client.auth.ram.identify.CredentialService - [null] CredentialService is freed
2025-05-09 20:46:20.311 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.NamingClientProxyDelegate do shutdown stop
2025-05-09 20:46:20.483 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:10911] result: true
2025-05-09 20:46:20.484 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:9876] result: true
2025-05-09 20:46:20.499 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:10911] result: true
2025-05-09 20:46:20.500 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:9876] result: true
2025-05-09 20:46:22.698 [SpringApplicationShutdownHook] INFO  o.s.orm.jpa.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-05-09 20:46:22.706 [SpringApplicationShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-2} closing ...
2025-05-09 20:46:22.708 [SpringApplicationShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-2} closed
2025-05-09 20:46:22.708 [SpringApplicationShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} closing ...
2025-05-09 20:46:22.709 [SpringApplicationShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} closed
2025-05-09 20:46:30.080 [main] WARN  com.alibaba.nacos.client.logging.NacosLogging - Load Logback Configuration of Nacos fail, message: Could not initialize Logback Nacos logging from classpath:nacos-logback.xml
2025-05-09 20:46:30.081 [main] INFO  com.bgpay.bgai.BgaiApplication - The following 1 profile is active: "dev"
2025-05-09 20:46:31.367 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-05-09 20:46:31.368 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-05-09 20:46:31.396 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 21 ms. Found 0 JPA repository interfaces.
2025-05-09 20:46:31.407 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-05-09 20:46:31.408 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-05-09 20:46:31.419 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 4 ms. Found 0 Redis repository interfaces.
2025-05-09 20:46:31.652 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'allowedFileTypeMapper' and 'com.bgpay.bgai.mapper.AllowedFileTypeMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 20:46:31.652 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'apiConfigMapper' and 'com.bgpay.bgai.mapper.ApiConfigMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 20:46:31.652 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'chatCompletionsMapper' and 'com.bgpay.bgai.mapper.ChatCompletionsMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 20:46:31.652 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'choicesMapper' and 'com.bgpay.bgai.mapper.ChoicesMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 20:46:31.652 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'fileTypeMapper' and 'com.bgpay.bgai.mapper.FileTypeMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 20:46:31.653 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'priceConfigMapper' and 'com.bgpay.bgai.mapper.PriceConfigMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 20:46:31.653 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'priceVersionMapper' and 'com.bgpay.bgai.mapper.PriceVersionMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 20:46:31.653 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'usageInfoMapper' and 'com.bgpay.bgai.mapper.UsageInfoMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 20:46:31.653 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'usageRecordMapper' and 'com.bgpay.bgai.mapper.UsageRecordMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 20:46:31.653 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'userMapper' and 'com.bgpay.bgai.mapper.UserMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 20:46:31.653 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - No MyBatis mapper was found in '[com.bgpay.bgai.mapper]' package. Please check your configuration.
2025-05-09 20:46:31.656 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'allowedFileTypeMapper' and 'com.bgpay.bgai.mapper.AllowedFileTypeMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 20:46:31.657 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'apiConfigMapper' and 'com.bgpay.bgai.mapper.ApiConfigMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 20:46:31.657 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'chatCompletionsMapper' and 'com.bgpay.bgai.mapper.ChatCompletionsMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 20:46:31.657 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'choicesMapper' and 'com.bgpay.bgai.mapper.ChoicesMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 20:46:31.657 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'fileTypeMapper' and 'com.bgpay.bgai.mapper.FileTypeMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 20:46:31.657 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'priceConfigMapper' and 'com.bgpay.bgai.mapper.PriceConfigMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 20:46:31.657 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'priceVersionMapper' and 'com.bgpay.bgai.mapper.PriceVersionMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 20:46:31.657 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'usageInfoMapper' and 'com.bgpay.bgai.mapper.UsageInfoMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 20:46:31.657 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'usageRecordMapper' and 'com.bgpay.bgai.mapper.UsageRecordMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 20:46:31.657 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - Skipping MapperFactoryBean with name 'userMapper' and 'com.bgpay.bgai.mapper.UserMapper' mapperInterface. Bean already defined with the same name!
2025-05-09 20:46:31.657 [main] WARN  org.mybatis.spring.mapper.ClassPathMapperScanner - No MyBatis mapper was found in '[com.bgpay.bgai.mapper]' package. Please check your configuration.
2025-05-09 20:46:31.939 [main] INFO  o.springframework.cloud.context.scope.GenericScope - BeanFactory id=38ed5f2c-a148-3506-bdcb-f18d795b9667
2025-05-09 20:46:32.210 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'org.springframework.cloud.commons.config.CommonsConfigAutoConfiguration' of type [org.springframework.cloud.commons.config.CommonsConfigAutoConfiguration] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 20:46:32.216 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'org.springframework.cloud.client.loadbalancer.LoadBalancerDefaultMappingsProviderAutoConfiguration' of type [org.springframework.cloud.client.loadbalancer.LoadBalancerDefaultMappingsProviderAutoConfiguration] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 20:46:32.231 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'loadBalancerClientsDefaultsMappingsProvider' of type [org.springframework.cloud.client.loadbalancer.LoadBalancerDefaultMappingsProviderAutoConfiguration$$Lambda/0x000001eea97726e0] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 20:46:32.241 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'defaultsBindHandlerAdvisor' of type [org.springframework.cloud.commons.config.DefaultsBindHandlerAdvisor] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 20:46:32.270 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'spring.datasource.dynamic-com.baomidou.dynamic.datasource.spring.boot.autoconfigure.DynamicDataSourceProperties' of type [com.baomidou.dynamic.datasource.spring.boot.autoconfigure.DynamicDataSourceProperties] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 20:46:32.279 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'com.baomidou.dynamic.datasource.spring.boot.autoconfigure.DynamicDataSourceAutoConfiguration' of type [com.baomidou.dynamic.datasource.spring.boot.autoconfigure.DynamicDataSourceAutoConfiguration$$SpringCGLIB$$0] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 20:46:32.294 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'dsProcessor' of type [com.baomidou.dynamic.datasource.processor.jakarta.DsJakartaHeaderProcessor] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 20:46:32.638 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'messageConverterConfiguration' of type [org.apache.rocketmq.spring.autoconfigure.MessageConverterConfiguration$$SpringCGLIB$$0] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 20:46:32.695 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'createRocketMQMessageConverter' of type [org.apache.rocketmq.spring.support.RocketMQMessageConverter] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 20:46:32.703 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'rocketmq-org.apache.rocketmq.spring.autoconfigure.RocketMQProperties' of type [org.apache.rocketmq.spring.autoconfigure.RocketMQProperties] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 20:46:32.706 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'listenerContainerConfiguration' of type [org.apache.rocketmq.spring.autoconfigure.ListenerContainerConfiguration$$SpringCGLIB$$0] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 20:46:32.737 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'org.springframework.cloud.client.loadbalancer.reactive.LoadBalancerBeanPostProcessorAutoConfiguration' of type [org.springframework.cloud.client.loadbalancer.reactive.LoadBalancerBeanPostProcessorAutoConfiguration] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 20:46:32.740 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'org.springframework.cloud.client.loadbalancer.reactive.LoadBalancerBeanPostProcessorAutoConfiguration$ReactorDeferringLoadBalancerFilterConfig' of type [org.springframework.cloud.client.loadbalancer.reactive.LoadBalancerBeanPostProcessorAutoConfiguration$ReactorDeferringLoadBalancerFilterConfig] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 20:46:32.744 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'reactorDeferringLoadBalancerExchangeFilterFunction' of type [org.springframework.cloud.client.loadbalancer.reactive.DeferringLoadBalancerExchangeFilterFunction] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-05-09 20:46:33.061 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat initialized with port(s): 8080 (http)
2025-05-09 20:46:33.071 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - Initializing ProtocolHandler ["http-nio-8080"]
2025-05-09 20:46:33.072 [main] INFO  org.apache.catalina.core.StandardService - Starting service [Tomcat]
2025-05-09 20:46:33.072 [main] INFO  org.apache.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.15]
2025-05-09 20:46:33.505 [main] INFO  org.hibernate.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-05-09 20:46:33.570 [main] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.1.7.Final
2025-05-09 20:46:33.919 [main] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} inited
2025-05-09 20:46:34.144 [main] INFO  SQL dialect - HHH000400: Using dialect: org.hibernate.dialect.MySQL8Dialect
2025-05-09 20:46:34.147 [main] WARN  org.hibernate.orm.deprecation - HHH90000026: MySQL8Dialect has been deprecated; use org.hibernate.dialect.MySQLDialect instead
2025-05-09 20:46:34.493 [main] INFO  o.h.e.t.jta.platform.internal.JtaPlatformInitiator - HHH000490: Using JtaPlatform implementation: [org.hibernate.engine.transaction.jta.platform.internal.NoJtaPlatform]
2025-05-09 20:46:34.505 [main] INFO  o.s.orm.jpa.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-05-09 20:46:34.905 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-09 20:46:34.932 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-09 20:46:34.967 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-09 20:46:34.969 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-09 20:46:34.969 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-09 20:46:34.981 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-09 20:46:35.711 [main] INFO  com.bgpay.bgai.service.impl.UserServiceImpl - 初始化SSO配置: clientId=bgai-client-id, redirectUri=http://localhost:8080/api/auth/callback
2025-05-09 20:46:35.817 [main] INFO  com.bgpay.bgai.controller.AuthController - 初始化认证控制器: clientId=bgai-client-id, redirectUri=http://localhost:8080/api/auth/callback
2025-05-09 20:46:36.622 [main] INFO  o.a.r.s.autoconfigure.RocketMQAutoConfiguration - a producer (billing-producer-group) init on namesrv 8.133.246.113:9876
2025-05-09 20:46:37.584 [main] INFO  org.redisson.Version - Redisson 3.24.3
2025-05-09 20:46:37.717 [redisson-netty-4-6] INFO  o.r.connection.pool.MasterPubSubConnectionPool - 1 connections initialized for 8.133.246.113/8.133.246.113:6379
2025-05-09 20:46:38.063 [redisson-netty-4-19] INFO  org.redisson.connection.pool.MasterConnectionPool - 24 connections initialized for 8.133.246.113/8.133.246.113:6379
2025-05-09 20:46:38.339 [main] INFO  com.bgpay.bgai.service.mq.MQConsumerService - MQ consumer startup successful [group=billing-consumer-group, topic=BILLING_TOPIC, tag=USER_BILLING]
2025-05-09 20:46:39.548 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [After]
2025-05-09 20:46:39.549 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Before]
2025-05-09 20:46:39.549 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Between]
2025-05-09 20:46:39.549 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Cookie]
2025-05-09 20:46:39.549 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Header]
2025-05-09 20:46:39.549 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Host]
2025-05-09 20:46:39.549 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Method]
2025-05-09 20:46:39.549 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Path]
2025-05-09 20:46:39.549 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Query]
2025-05-09 20:46:39.549 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [ReadBody]
2025-05-09 20:46:39.550 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [RemoteAddr]
2025-05-09 20:46:39.550 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [XForwardedRemoteAddr]
2025-05-09 20:46:39.550 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Weight]
2025-05-09 20:46:39.550 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [CloudFoundryRouteService]
2025-05-09 20:46:40.759 [main] INFO  o.s.b.actuate.endpoint.web.EndpointLinksResolver - Exposing 1 endpoint(s) beneath base path '/actuator'
2025-05-09 20:46:42.137 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - Starting ProtocolHandler ["http-nio-8080"]
2025-05-09 20:46:42.151 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat started on port(s): 8080 (http) with context path ''
2025-05-09 20:46:42.162 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from ans.namespace attribute : null
2025-05-09 20:46:42.162 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from ALIBABA_ALIWARE_NAMESPACE attribute :null
2025-05-09 20:46:42.163 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from namespace attribute :null
2025-05-09 20:46:42.174 [main] INFO  c.a.n.p.auth.spi.client.ClientAuthPluginManager - [ClientAuthPluginManager] Load ClientAuthService com.alibaba.nacos.client.auth.impl.NacosClientAuthServiceImpl success.
2025-05-09 20:46:42.174 [main] INFO  c.a.n.p.auth.spi.client.ClientAuthPluginManager - [ClientAuthPluginManager] Load ClientAuthService com.alibaba.nacos.client.auth.ram.RamClientAuthServiceImpl success.
2025-05-09 20:46:42.178 [main] INFO  com.alibaba.nacos.common.remote.client - [RpcClientFactory] create a new rpc client of e3ddba66-0406-4b6e-8c09-22afc54fcb88
2025-05-09 20:46:42.180 [main] INFO  com.alibaba.nacos.common.remote.client - [e3ddba66-0406-4b6e-8c09-22afc54fcb88] RpcClient init, ServerListFactory = com.alibaba.nacos.client.naming.core.ServerListManager
2025-05-09 20:46:42.180 [main] INFO  com.alibaba.nacos.common.remote.client - [e3ddba66-0406-4b6e-8c09-22afc54fcb88] Registry connection listener to current client:com.alibaba.nacos.client.naming.remote.gprc.redo.NamingGrpcRedoService
2025-05-09 20:46:42.181 [main] INFO  com.alibaba.nacos.common.remote.client - [e3ddba66-0406-4b6e-8c09-22afc54fcb88] Register server push request handler:com.alibaba.nacos.client.naming.remote.gprc.NamingPushRequestHandler
2025-05-09 20:46:42.181 [main] INFO  com.alibaba.nacos.common.remote.client - [e3ddba66-0406-4b6e-8c09-22afc54fcb88] Try to connect to server on start up, server: {serverIp = '8.133.246.113', server main port = 8848}
2025-05-09 20:46:42.182 [main] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - grpc client connection server:8.133.246.113 ip,serverPort:9848,grpcTslConfig:{"sslProvider":"OPENSSL","enableTls":false,"mutualAuthEnable":false,"trustAll":false}
2025-05-09 20:46:42.312 [main] INFO  com.alibaba.nacos.common.remote.client - [e3ddba66-0406-4b6e-8c09-22afc54fcb88] Success to connect to server [8.133.246.113:8848] on start up, connectionId = 1746794802207_139.227.195.203_43640
2025-05-09 20:46:42.312 [main] INFO  com.alibaba.nacos.common.remote.client - [e3ddba66-0406-4b6e-8c09-22afc54fcb88] Register server push request handler:com.alibaba.nacos.common.remote.client.RpcClient$ConnectResetRequestHandler
2025-05-09 20:46:42.312 [com.alibaba.nacos.client.remote.worker] INFO  com.alibaba.nacos.common.remote.client - [e3ddba66-0406-4b6e-8c09-22afc54fcb88] Notify connected event to listeners.
2025-05-09 20:46:42.312 [main] INFO  com.alibaba.nacos.common.remote.client - [e3ddba66-0406-4b6e-8c09-22afc54fcb88] Register server push request handler:com.alibaba.nacos.common.remote.client.RpcClient$$Lambda/0x000001eea9531c60
2025-05-09 20:46:42.312 [com.alibaba.nacos.client.remote.worker] INFO  com.alibaba.nacos.client.naming - Grpc connection connect
2025-05-09 20:46:42.313 [main] INFO  com.alibaba.nacos.client.naming - [REGISTER-SERVICE] d750d92e-152f-4055-a641-3bc9dda85a29 registering service bgai with instance Instance{instanceId='null', ip='192.168.86.8', port=8080, weight=1.0, healthy=true, enabled=true, ephemeral=true, clusterName='DEFAULT', serviceName='null', metadata={IPv6=[2408:820c:7528:8342:f58d:7611:59f6:9fab], preserved.register.source=SPRING_CLOUD}}
2025-05-09 20:46:42.331 [main] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - nacos registry, DEFAULT_GROUP bgai 192.168.86.8:8080 register finished
2025-05-09 20:46:42.379 [main] INFO  com.bgpay.bgai.BgaiApplication - Started BgaiApplication in 14.39 seconds (process running for 15.945)
2025-05-09 20:46:42.382 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-09 20:46:42.383 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-09 20:46:42.393 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-09 20:46:42.394 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-09 20:46:42.394 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-09 20:46:42.405 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-09 20:46:42.405 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-09 20:46:42.406 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-09 20:46:42.415 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-09 20:46:42.415 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-09 20:46:42.415 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-09 20:46:42.423 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-09 20:46:42.427 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - nacos.cache.data.init.snapshot = true 
2025-05-09 20:46:42.428 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] common-dev.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-09 20:46:42.435 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=common-dev.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-09 20:46:42.435 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=common-dev.yaml, group=DEFAULT_GROUP
2025-05-09 20:46:42.436 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-09 20:46:42.436 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-09 20:46:42.437 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai.yaml, group=DEFAULT_GROUP
2025-05-09 20:46:42.437 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai-dev.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-09 20:46:42.437 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai-dev.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-09 20:46:42.437 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai-dev.yaml, group=DEFAULT_GROUP
2025-05-09 20:46:42.437 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-09 20:46:42.437 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai, group=DEFAULT_GROUP, cnt=1
2025-05-09 20:46:42.437 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai, group=DEFAULT_GROUP
2025-05-09 20:46:42.596 [RMI TCP Connection(3)-192.168.86.8] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-2} inited
2025-05-09 20:48:39.783 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:9876] result: true
2025-05-09 20:48:39.815 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:9876] result: true
2025-05-09 20:48:39.915 [com.alibaba.nacos.client.remote.worker] INFO  com.alibaba.nacos.common.remote.client - [e3ddba66-0406-4b6e-8c09-22afc54fcb88] Server healthy check fail, currentConnection = 1746794802207_139.227.195.203_43640
2025-05-09 20:48:39.915 [com.alibaba.nacos.client.remote.worker] INFO  com.alibaba.nacos.common.remote.client - [e3ddba66-0406-4b6e-8c09-22afc54fcb88] Try to reconnect to a new server, server is  not appointed, will choose a random server.
2025-05-09 20:48:39.915 [com.alibaba.nacos.client.remote.worker] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - grpc client connection server:8.133.246.113 ip,serverPort:9848,grpcTslConfig:{"sslProvider":"OPENSSL","enableTls":false,"mutualAuthEnable":false,"trustAll":false}
2025-05-09 20:48:41.305 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:9876] result: true
2025-05-09 20:48:41.597 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:10911] result: true
2025-05-09 20:48:41.598 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:10911] result: true
2025-05-09 20:48:41.875 [com.alibaba.nacos.client.remote.worker] INFO  com.alibaba.nacos.common.remote.client - [d38a97aa-eae7-4ce7-a9e2-316814056d5e_config-0] Server healthy check fail, currentConnection = 1746794789748_139.227.195.203_43564
2025-05-09 20:48:41.875 [com.alibaba.nacos.client.remote.worker] INFO  com.alibaba.nacos.common.remote.client - [d38a97aa-eae7-4ce7-a9e2-316814056d5e_config-0] Try to reconnect to a new server, server is  not appointed, will choose a random server.
2025-05-09 20:48:41.875 [com.alibaba.nacos.client.remote.worker] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - grpc client connection server:8.133.246.113 ip,serverPort:9848,grpcTslConfig:{"sslProvider":"OPENSSL","enableTls":false,"mutualAuthEnable":false,"trustAll":false}
2025-05-09 20:48:42.784 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:10911] result: true
2025-05-09 20:48:42.815 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:10911] result: true
2025-05-09 20:48:42.918 [com.alibaba.nacos.client.remote.worker] ERROR c.a.nacos.common.remote.client.grpc.GrpcClient - Server check fail, please check server 8.133.246.113 ,port 9848 is available , error ={}
java.util.concurrent.TimeoutException: Waited 3000 milliseconds (plus 672300 nanoseconds delay) for com.alibaba.nacos.shaded.io.grpc.stub.ClientCalls$GrpcFuture@5cbc9606[status=PENDING, info=[GrpcFuture{clientCall=PendingCall{realCall=ClientCallImpl{method=MethodDescriptor{fullMethodName=Request/request, type=UNARY, idempotent=false, safe=false, sampledToLocalTracing=true, requestMarshaller=com.alibaba.nacos.shaded.io.grpc.protobuf.lite.ProtoLiteUtils$MessageMarshaller@4f1e2b3, responseMarshaller=com.alibaba.nacos.shaded.io.grpc.protobuf.lite.ProtoLiteUtils$MessageMarshaller@3de9dcd1, schemaDescriptor=com.alibaba.nacos.api.grpc.auto.RequestGrpc$RequestMethodDescriptorSupplier@5bbbbb27}}}}]]
	at com.alibaba.nacos.shaded.com.google.common.util.concurrent.AbstractFuture.get(AbstractFuture.java:508)
	at com.alibaba.nacos.common.remote.client.grpc.GrpcClient.serverCheck(GrpcClient.java:218)
	at com.alibaba.nacos.common.remote.client.grpc.GrpcClient.connectToServer(GrpcClient.java:329)
	at com.alibaba.nacos.common.remote.client.RpcClient.reconnect(RpcClient.java:502)
	at com.alibaba.nacos.common.remote.client.RpcClient.lambda$start$2(RpcClient.java:343)
	at java.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:572)
	at java.base/java.util.concurrent.FutureTask.run$$$capture(FutureTask.java:317)
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java)
	at java.base/java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:304)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-05-09 20:48:43.030 [com.alibaba.nacos.client.remote.worker] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - grpc client connection server:8.133.246.113 ip,serverPort:9848,grpcTslConfig:{"sslProvider":"OPENSSL","enableTls":false,"mutualAuthEnable":false,"trustAll":false}
2025-05-09 20:48:44.599 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:10911] result: true
2025-05-09 20:48:44.887 [com.alibaba.nacos.client.remote.worker] ERROR c.a.nacos.common.remote.client.grpc.GrpcClient - Server check fail, please check server 8.133.246.113 ,port 9848 is available , error ={}
java.util.concurrent.TimeoutException: Waited 3000 milliseconds (plus 9 milliseconds, 564100 nanoseconds delay) for com.alibaba.nacos.shaded.io.grpc.stub.ClientCalls$GrpcFuture@46988d33[status=PENDING, info=[GrpcFuture{clientCall=PendingCall{realCall=ClientCallImpl{method=MethodDescriptor{fullMethodName=Request/request, type=UNARY, idempotent=false, safe=false, sampledToLocalTracing=true, requestMarshaller=com.alibaba.nacos.shaded.io.grpc.protobuf.lite.ProtoLiteUtils$MessageMarshaller@4f1e2b3, responseMarshaller=com.alibaba.nacos.shaded.io.grpc.protobuf.lite.ProtoLiteUtils$MessageMarshaller@3de9dcd1, schemaDescriptor=com.alibaba.nacos.api.grpc.auto.RequestGrpc$RequestMethodDescriptorSupplier@5bbbbb27}}}}]]
	at com.alibaba.nacos.shaded.com.google.common.util.concurrent.AbstractFuture.get(AbstractFuture.java:508)
	at com.alibaba.nacos.common.remote.client.grpc.GrpcClient.serverCheck(GrpcClient.java:218)
	at com.alibaba.nacos.common.remote.client.grpc.GrpcClient.connectToServer(GrpcClient.java:329)
	at com.alibaba.nacos.common.remote.client.RpcClient.reconnect(RpcClient.java:502)
	at com.alibaba.nacos.common.remote.client.RpcClient.lambda$start$2(RpcClient.java:343)
	at java.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:572)
	at java.base/java.util.concurrent.FutureTask.run$$$capture(FutureTask.java:317)
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java)
	at java.base/java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:304)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-05-09 20:48:44.988 [com.alibaba.nacos.client.remote.worker] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - grpc client connection server:8.133.246.113 ip,serverPort:9848,grpcTslConfig:{"sslProvider":"OPENSSL","enableTls":false,"mutualAuthEnable":false,"trustAll":false}
2025-05-09 20:48:45.781 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:9876] result: true
2025-05-09 20:48:45.815 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:9876] result: true
2025-05-09 20:48:46.033 [com.alibaba.nacos.client.remote.worker] ERROR c.a.nacos.common.remote.client.grpc.GrpcClient - Server check fail, please check server 8.133.246.113 ,port 9848 is available , error ={}
java.util.concurrent.TimeoutException: Waited 3000 milliseconds (plus 299900 nanoseconds delay) for com.alibaba.nacos.shaded.io.grpc.stub.ClientCalls$GrpcFuture@62c7eaa0[status=PENDING, info=[GrpcFuture{clientCall=PendingCall{realCall=ClientCallImpl{method=MethodDescriptor{fullMethodName=Request/request, type=UNARY, idempotent=false, safe=false, sampledToLocalTracing=true, requestMarshaller=com.alibaba.nacos.shaded.io.grpc.protobuf.lite.ProtoLiteUtils$MessageMarshaller@4f1e2b3, responseMarshaller=com.alibaba.nacos.shaded.io.grpc.protobuf.lite.ProtoLiteUtils$MessageMarshaller@3de9dcd1, schemaDescriptor=com.alibaba.nacos.api.grpc.auto.RequestGrpc$RequestMethodDescriptorSupplier@5bbbbb27}}}}]]
	at com.alibaba.nacos.shaded.com.google.common.util.concurrent.AbstractFuture.get(AbstractFuture.java:508)
	at com.alibaba.nacos.common.remote.client.grpc.GrpcClient.serverCheck(GrpcClient.java:218)
	at com.alibaba.nacos.common.remote.client.grpc.GrpcClient.connectToServer(GrpcClient.java:329)
	at com.alibaba.nacos.common.remote.client.RpcClient.reconnect(RpcClient.java:502)
	at com.alibaba.nacos.common.remote.client.RpcClient.lambda$start$2(RpcClient.java:343)
	at java.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:572)
	at java.base/java.util.concurrent.FutureTask.run$$$capture(FutureTask.java:317)
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java)
	at java.base/java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:304)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-05-09 20:48:46.033 [com.alibaba.nacos.client.remote.worker] INFO  com.alibaba.nacos.common.remote.client - [e3ddba66-0406-4b6e-8c09-22afc54fcb88] Fail to connect server, after trying 1 times, last try server is {serverIp = '8.133.246.113', server main port = 8848}, error = unknown
2025-05-09 20:48:46.235 [com.alibaba.nacos.client.remote.worker] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - grpc client connection server:8.133.246.113 ip,serverPort:9848,grpcTslConfig:{"sslProvider":"OPENSSL","enableTls":false,"mutualAuthEnable":false,"trustAll":false}
2025-05-09 20:48:47.634 [Thread-1] WARN  c.alibaba.nacos.common.http.HttpClientBeanHolder - [HttpClientBeanHolder] Start destroying common HttpClient
2025-05-09 20:48:47.634 [Thread-7] WARN  com.alibaba.nacos.common.notify.NotifyCenter - [NotifyCenter] Start destroying Publisher
2025-05-09 20:48:47.635 [Thread-7] WARN  com.alibaba.nacos.common.notify.NotifyCenter - [NotifyCenter] Destruction of the end
2025-05-09 20:48:47.635 [Thread-1] WARN  c.alibaba.nacos.common.http.HttpClientBeanHolder - [HttpClientBeanHolder] Destruction of the end
2025-05-09 20:48:47.660 [SpringApplicationShutdownHook] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - De-registering from Nacos Server now...
2025-05-09 20:48:47.660 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - [DEREGISTER-SERVICE] d750d92e-152f-4055-a641-3bc9dda85a29 deregistering service bgai with instance: Instance{instanceId='null', ip='192.168.86.8', port=8080, weight=1.0, healthy=true, enabled=true, ephemeral=true, clusterName='DEFAULT', serviceName='null', metadata={}}
2025-05-09 20:48:47.761 [SpringApplicationShutdownHook] ERROR com.alibaba.nacos.common.remote.client - Send request fail, request = InstanceRequest{headers={app=unknown}, requestId='null'}, retryTimes = 0, errorMessage = Client not connected, current status:UNHEALTHY
2025-05-09 20:48:47.861 [SpringApplicationShutdownHook] ERROR com.alibaba.nacos.common.remote.client - Send request fail, request = InstanceRequest{headers={app=unknown}, requestId='null'}, retryTimes = 1, errorMessage = Client not connected, current status:UNHEALTHY
2025-05-09 20:48:47.964 [SpringApplicationShutdownHook] ERROR com.alibaba.nacos.common.remote.client - Send request fail, request = InstanceRequest{headers={app=unknown}, requestId='null'}, retryTimes = 2, errorMessage = Client not connected, current status:UNHEALTHY
2025-05-09 20:48:47.985 [SpringApplicationShutdownHook] ERROR c.a.cloud.nacos.registry.NacosServiceRegistry - ERR_NACOS_DEREGISTER, de-register failed...NacosRegistration{nacosDiscoveryProperties=NacosDiscoveryProperties{serverAddr='8.133.246.113:8848', username='', password='', endpoint='', namespace='d750d92e-152f-4055-a641-3bc9dda85a29', watchDelay=30000, logName='', service='bgai', weight=1.0, clusterName='DEFAULT', group='DEFAULT_GROUP', namingLoadCacheAtStart='false', metadata={IPv6=[2408:820c:7528:8342:f58d:7611:59f6:9fab], preserved.register.source=SPRING_CLOUD}, registerEnabled=true, ip='192.168.86.8', networkInterface='', port=8080, secure=false, accessKey='', secretKey='', heartBeatInterval=null, heartBeatTimeout=null, ipDeleteTimeout=null, instanceEnabled=true, ephemeral=true, failureToleranceEnabled=false}, ipDeleteTimeout=null, failFast=true}},
com.alibaba.nacos.api.exception.NacosException: Client not connected, current status:UNHEALTHY
	at com.alibaba.nacos.common.remote.client.RpcClient.request(RpcClient.java:643)
	at com.alibaba.nacos.common.remote.client.RpcClient.request(RpcClient.java:623)
	at com.alibaba.nacos.client.naming.remote.gprc.NamingGrpcClientProxy.requestToServer(NamingGrpcClientProxy.java:357)
	at com.alibaba.nacos.client.naming.remote.gprc.NamingGrpcClientProxy.doDeregisterService(NamingGrpcClientProxy.java:234)
	at com.alibaba.nacos.client.naming.remote.gprc.NamingGrpcClientProxy.deregisterService(NamingGrpcClientProxy.java:220)
	at com.alibaba.nacos.client.naming.remote.NamingClientProxyDelegate.deregisterService(NamingClientProxyDelegate.java:125)
	at com.alibaba.nacos.client.naming.NacosNamingService.deregisterInstance(NacosNamingService.java:192)
	at com.alibaba.nacos.client.naming.NacosNamingService.deregisterInstance(NacosNamingService.java:182)
	at com.alibaba.cloud.nacos.registry.NacosServiceRegistry.deregister(NacosServiceRegistry.java:107)
	at org.springframework.cloud.client.serviceregistry.AbstractAutoServiceRegistration.deregister(AbstractAutoServiceRegistration.java:281)
	at org.springframework.cloud.client.serviceregistry.AbstractAutoServiceRegistration.stop(AbstractAutoServiceRegistration.java:299)
	at org.springframework.cloud.client.serviceregistry.AbstractAutoServiceRegistration.destroy(AbstractAutoServiceRegistration.java:233)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.beans.factory.annotation.InitDestroyAnnotationBeanPostProcessor$LifecycleMethod.invoke(InitDestroyAnnotationBeanPostProcessor.java:457)
	at org.springframework.beans.factory.annotation.InitDestroyAnnotationBeanPostProcessor$LifecycleMetadata.invokeDestroyMethods(InitDestroyAnnotationBeanPostProcessor.java:415)
	at org.springframework.beans.factory.annotation.InitDestroyAnnotationBeanPostProcessor.postProcessBeforeDestruction(InitDestroyAnnotationBeanPostProcessor.java:239)
	at org.springframework.beans.factory.support.DisposableBeanAdapter.destroy(DisposableBeanAdapter.java:191)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.destroyBean(DefaultSingletonBeanRegistry.java:587)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.destroySingleton(DefaultSingletonBeanRegistry.java:559)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.destroySingleton(DefaultListableBeanFactory.java:1189)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.destroySingletons(DefaultSingletonBeanRegistry.java:520)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.destroySingletons(DefaultListableBeanFactory.java:1182)
	at org.springframework.context.support.AbstractApplicationContext.destroyBeans(AbstractApplicationContext.java:1118)
	at org.springframework.context.support.AbstractApplicationContext.doClose(AbstractApplicationContext.java:1084)
	at org.springframework.boot.web.reactive.context.ReactiveWebServerApplicationContext.doClose(ReactiveWebServerApplicationContext.java:149)
	at org.springframework.context.support.AbstractApplicationContext.close(AbstractApplicationContext.java:1035)
	at org.springframework.boot.SpringApplicationShutdownHook.closeAndWait(SpringApplicationShutdownHook.java:139)
	at java.base/java.lang.Iterable.forEach(Iterable.java:75)
	at org.springframework.boot.SpringApplicationShutdownHook.run(SpringApplicationShutdownHook.java:108)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-05-09 20:48:47.985 [SpringApplicationShutdownHook] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - De-registration finished.
2025-05-09 20:48:47.987 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.cache.ServiceInfoHolder do shutdown begin
2025-05-09 20:48:47.987 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.backups.FailoverReactor do shutdown begin
2025-05-09 20:48:47.987 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.backups.FailoverReactor do shutdown stop
2025-05-09 20:48:47.987 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.cache.ServiceInfoHolder do shutdown stop
2025-05-09 20:48:47.987 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.NamingClientProxyDelegate do shutdown begin
2025-05-09 20:48:47.987 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServiceInfoUpdateService do shutdown begin
2025-05-09 20:48:47.987 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServiceInfoUpdateService do shutdown stop
2025-05-09 20:48:47.988 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServerListManager do shutdown begin
2025-05-09 20:48:47.988 [SpringApplicationShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Start destroying NacosRestTemplate
2025-05-09 20:48:47.988 [SpringApplicationShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Destruction of the end
2025-05-09 20:48:47.988 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServerListManager do shutdown stop
2025-05-09 20:48:47.988 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.http.NamingHttpClientProxy do shutdown begin
2025-05-09 20:48:47.988 [SpringApplicationShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Start destroying NacosRestTemplate
2025-05-09 20:48:47.988 [SpringApplicationShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Destruction of the end
2025-05-09 20:48:47.988 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.http.NamingHttpClientProxy do shutdown stop
2025-05-09 20:48:47.988 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Shutdown rpc client, set status to shutdown
2025-05-09 20:48:47.988 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Shutdown client event executor java.util.concurrent.ScheduledThreadPoolExecutor@5c56cb6d[Running, pool size = 2, active threads = 2, queued tasks = 0, completed tasks = 0]
2025-05-09 20:48:47.988 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Close current connection 1746794802207_139.227.195.203_43640
2025-05-09 20:48:47.989 [SpringApplicationShutdownHook] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - Shutdown grpc executor java.util.concurrent.ThreadPoolExecutor@575ca45f[Running, pool size = 13, active threads = 5, queued tasks = 0, completed tasks = 39]
2025-05-09 20:48:47.989 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - Shutdown grpc redo service executor java.util.concurrent.ScheduledThreadPoolExecutor@3675ad98[Running, pool size = 1, active threads = 0, queued tasks = 1, completed tasks = 41]
2025-05-09 20:48:47.989 [com.alibaba.nacos.client.remote.worker] ERROR c.a.nacos.common.remote.client.grpc.GrpcClient - Server check fail, please check server 8.133.246.113 ,port 9848 is available , error ={}
java.lang.InterruptedException: null
	at com.alibaba.nacos.shaded.com.google.common.util.concurrent.AbstractFuture.get(AbstractFuture.java:438)
	at com.alibaba.nacos.common.remote.client.grpc.GrpcClient.serverCheck(GrpcClient.java:218)
	at com.alibaba.nacos.common.remote.client.grpc.GrpcClient.connectToServer(GrpcClient.java:329)
	at com.alibaba.nacos.common.remote.client.RpcClient.reconnect(RpcClient.java:502)
	at com.alibaba.nacos.common.remote.client.RpcClient.lambda$start$2(RpcClient.java:343)
	at java.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:572)
	at java.base/java.util.concurrent.FutureTask.run$$$capture(FutureTask.java:317)
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java)
	at java.base/java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:304)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-05-09 20:48:47.990 [SpringApplicationShutdownHook] INFO  c.a.n.client.auth.ram.identify.CredentialWatcher - [null] CredentialWatcher is stopped
2025-05-09 20:48:47.990 [SpringApplicationShutdownHook] INFO  c.a.n.client.auth.ram.identify.CredentialService - [null] CredentialService is freed
2025-05-09 20:48:47.993 [com.alibaba.nacos.client.remote.worker] INFO  com.alibaba.nacos.common.remote.client - Close current connection 1746794802207_139.227.195.203_43640
2025-05-09 20:48:47.994 [com.alibaba.nacos.client.remote.worker] INFO  com.alibaba.nacos.common.remote.client - [e3ddba66-0406-4b6e-8c09-22afc54fcb88] Fail to connect server, after trying 2 times, last try server is {serverIp = '8.133.246.113', server main port = 8848}, error = unknown
2025-05-09 20:48:47.993 [com.alibaba.nacos.client.remote.worker] ERROR c.a.nacos.common.remote.client.grpc.GrpcClient - Server check fail, please check server 8.133.246.113 ,port 9848 is available , error ={}
java.util.concurrent.TimeoutException: Waited 3000 milliseconds (plus 2 milliseconds, 692100 nanoseconds delay) for com.alibaba.nacos.shaded.io.grpc.stub.ClientCalls$GrpcFuture@1eb2993d[status=PENDING, info=[GrpcFuture{clientCall=PendingCall{realCall=ClientCallImpl{method=MethodDescriptor{fullMethodName=Request/request, type=UNARY, idempotent=false, safe=false, sampledToLocalTracing=true, requestMarshaller=com.alibaba.nacos.shaded.io.grpc.protobuf.lite.ProtoLiteUtils$MessageMarshaller@4f1e2b3, responseMarshaller=com.alibaba.nacos.shaded.io.grpc.protobuf.lite.ProtoLiteUtils$MessageMarshaller@3de9dcd1, schemaDescriptor=com.alibaba.nacos.api.grpc.auto.RequestGrpc$RequestMethodDescriptorSupplier@5bbbbb27}}}}]]
	at com.alibaba.nacos.shaded.com.google.common.util.concurrent.AbstractFuture.get(AbstractFuture.java:508)
	at com.alibaba.nacos.common.remote.client.grpc.GrpcClient.serverCheck(GrpcClient.java:218)
	at com.alibaba.nacos.common.remote.client.grpc.GrpcClient.connectToServer(GrpcClient.java:329)
	at com.alibaba.nacos.common.remote.client.RpcClient.reconnect(RpcClient.java:502)
	at com.alibaba.nacos.common.remote.client.RpcClient.lambda$start$2(RpcClient.java:343)
	at java.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:572)
	at java.base/java.util.concurrent.FutureTask.run$$$capture(FutureTask.java:317)
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java)
	at java.base/java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:304)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-05-09 20:48:47.994 [com.alibaba.nacos.client.remote.worker] INFO  com.alibaba.nacos.common.remote.client - [d38a97aa-eae7-4ce7-a9e2-316814056d5e_config-0] Fail to connect server, after trying 1 times, last try server is {serverIp = '8.133.246.113', server main port = 8848}, error = unknown
2025-05-09 20:48:47.994 [nacos-grpc-client-executor-8.133.246.113-41] WARN  c.a.nacos.common.remote.client.grpc.GrpcClient - [1746794802207_139.227.195.203_43640]Ignore error event,isRunning:false,isAbandon=false
2025-05-09 20:48:47.995 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.NamingClientProxyDelegate do shutdown stop
2025-05-09 20:48:48.196 [com.alibaba.nacos.client.remote.worker] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - grpc client connection server:8.133.246.113 ip,serverPort:9848,grpcTslConfig:{"sslProvider":"OPENSSL","enableTls":false,"mutualAuthEnable":false,"trustAll":false}
2025-05-09 20:48:48.294 [com.alibaba.nacos.client.remote.worker] INFO  com.alibaba.nacos.common.remote.client - [e3ddba66-0406-4b6e-8c09-22afc54fcb88] Client is shutdown, stop reconnect to server
2025-05-09 20:48:49.119 [com.alibaba.nacos.client.Worker] INFO  c.a.n.client.auth.ram.identify.CredentialWatcher - null No credential found
2025-05-09 20:48:50.015 [redisson-netty-4-28] ERROR i.n.u.concurrent.DefaultPromise.rejectedExecution - Failed to submit a listener notification task. Event loop shut down?
java.util.concurrent.RejectedExecutionException: event executor terminated
	at io.netty.util.concurrent.SingleThreadEventExecutor.reject(SingleThreadEventExecutor.java:934)
	at io.netty.util.concurrent.SingleThreadEventExecutor.offerTask(SingleThreadEventExecutor.java:351)
	at io.netty.util.concurrent.SingleThreadEventExecutor.addTask(SingleThreadEventExecutor.java:344)
	at io.netty.util.concurrent.SingleThreadEventExecutor.execute(SingleThreadEventExecutor.java:836)
	at io.netty.util.concurrent.SingleThreadEventExecutor.execute0(SingleThreadEventExecutor.java:827)
	at io.netty.util.concurrent.SingleThreadEventExecutor.execute(SingleThreadEventExecutor.java:817)
	at io.netty.util.concurrent.DefaultPromise.safeExecute(DefaultPromise.java:862)
	at io.netty.util.concurrent.DefaultPromise.notifyListeners(DefaultPromise.java:500)
	at io.netty.util.concurrent.DefaultPromise.setValue0(DefaultPromise.java:636)
	at io.netty.util.concurrent.DefaultPromise.setSuccess0(DefaultPromise.java:625)
	at io.netty.util.concurrent.DefaultPromise.setSuccess(DefaultPromise.java:97)
	at io.netty.channel.group.DefaultChannelGroupFuture.setSuccess0(DefaultChannelGroupFuture.java:200)
	at io.netty.channel.group.DefaultChannelGroupFuture.access$400(DefaultChannelGroupFuture.java:41)
	at io.netty.channel.group.DefaultChannelGroupFuture$1.operationComplete(DefaultChannelGroupFuture.java:75)
	at io.netty.channel.group.DefaultChannelGroupFuture$1.operationComplete(DefaultChannelGroupFuture.java:48)
	at io.netty.util.concurrent.DefaultPromise.notifyListener0(DefaultPromise.java:590)
	at io.netty.util.concurrent.DefaultPromise.notifyListeners0(DefaultPromise.java:583)
	at io.netty.util.concurrent.DefaultPromise.notifyListenersNow(DefaultPromise.java:559)
	at io.netty.util.concurrent.DefaultPromise.notifyListeners(DefaultPromise.java:492)
	at io.netty.util.concurrent.DefaultPromise.setValue0(DefaultPromise.java:636)
	at io.netty.util.concurrent.DefaultPromise.setSuccess0(DefaultPromise.java:625)
	at io.netty.util.concurrent.DefaultPromise.trySuccess(DefaultPromise.java:105)
	at io.netty.channel.DefaultChannelPromise.trySuccess(DefaultChannelPromise.java:84)
	at io.netty.channel.AbstractChannel$CloseFuture.setClosed(AbstractChannel.java:1164)
	at io.netty.channel.AbstractChannel$AbstractUnsafe.doClose0(AbstractChannel.java:755)
	at io.netty.channel.AbstractChannel$AbstractUnsafe.close(AbstractChannel.java:731)
	at io.netty.channel.AbstractChannel$AbstractUnsafe.close(AbstractChannel.java:620)
	at io.netty.channel.nio.NioEventLoop.closeAll(NioEventLoop.java:838)
	at io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:595)
	at io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:997)
	at io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-05-09 20:48:51.201 [com.alibaba.nacos.client.remote.worker] ERROR c.a.nacos.common.remote.client.grpc.GrpcClient - Server check fail, please check server 8.133.246.113 ,port 9848 is available , error ={}
java.util.concurrent.TimeoutException: Waited 3000 milliseconds (plus 92600 nanoseconds delay) for com.alibaba.nacos.shaded.io.grpc.stub.ClientCalls$GrpcFuture@5a500ae[status=PENDING, info=[GrpcFuture{clientCall=PendingCall{realCall=ClientCallImpl{method=MethodDescriptor{fullMethodName=Request/request, type=UNARY, idempotent=false, safe=false, sampledToLocalTracing=true, requestMarshaller=com.alibaba.nacos.shaded.io.grpc.protobuf.lite.ProtoLiteUtils$MessageMarshaller@4f1e2b3, responseMarshaller=com.alibaba.nacos.shaded.io.grpc.protobuf.lite.ProtoLiteUtils$MessageMarshaller@3de9dcd1, schemaDescriptor=com.alibaba.nacos.api.grpc.auto.RequestGrpc$RequestMethodDescriptorSupplier@5bbbbb27}}}}]]
	at com.alibaba.nacos.shaded.com.google.common.util.concurrent.AbstractFuture.get(AbstractFuture.java:508)
	at com.alibaba.nacos.common.remote.client.grpc.GrpcClient.serverCheck(GrpcClient.java:218)
	at com.alibaba.nacos.common.remote.client.grpc.GrpcClient.connectToServer(GrpcClient.java:329)
	at com.alibaba.nacos.common.remote.client.RpcClient.reconnect(RpcClient.java:502)
	at com.alibaba.nacos.common.remote.client.RpcClient.lambda$start$2(RpcClient.java:343)
	at java.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:572)
	at java.base/java.util.concurrent.FutureTask.run$$$capture(FutureTask.java:317)
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java)
	at java.base/java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:304)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-05-09 20:48:51.201 [com.alibaba.nacos.client.remote.worker] INFO  com.alibaba.nacos.common.remote.client - [d38a97aa-eae7-4ce7-a9e2-316814056d5e_config-0] Fail to connect server, after trying 2 times, last try server is {serverIp = '8.133.246.113', server main port = 8848}, error = unknown
2025-05-09 20:48:51.503 [com.alibaba.nacos.client.remote.worker] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - grpc client connection server:8.133.246.113 ip,serverPort:9848,grpcTslConfig:{"sslProvider":"OPENSSL","enableTls":false,"mutualAuthEnable":false,"trustAll":false}
2025-05-09 20:48:51.771 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:9876] result: true
2025-05-09 20:48:51.803 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:9876] result: true
2025-05-09 20:48:53.030 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:10911] result: true
2025-05-09 20:48:54.505 [com.alibaba.nacos.client.remote.worker] ERROR c.a.nacos.common.remote.client.grpc.GrpcClient - Server check fail, please check server 8.133.246.113 ,port 9848 is available , error ={}
java.util.concurrent.TimeoutException: Waited 3000 milliseconds (plus 233900 nanoseconds delay) for com.alibaba.nacos.shaded.io.grpc.stub.ClientCalls$GrpcFuture@3e4f7279[status=PENDING, info=[GrpcFuture{clientCall=PendingCall{realCall=ClientCallImpl{method=MethodDescriptor{fullMethodName=Request/request, type=UNARY, idempotent=false, safe=false, sampledToLocalTracing=true, requestMarshaller=com.alibaba.nacos.shaded.io.grpc.protobuf.lite.ProtoLiteUtils$MessageMarshaller@4f1e2b3, responseMarshaller=com.alibaba.nacos.shaded.io.grpc.protobuf.lite.ProtoLiteUtils$MessageMarshaller@3de9dcd1, schemaDescriptor=com.alibaba.nacos.api.grpc.auto.RequestGrpc$RequestMethodDescriptorSupplier@5bbbbb27}}}}]]
	at com.alibaba.nacos.shaded.com.google.common.util.concurrent.AbstractFuture.get(AbstractFuture.java:508)
	at com.alibaba.nacos.common.remote.client.grpc.GrpcClient.serverCheck(GrpcClient.java:218)
	at com.alibaba.nacos.common.remote.client.grpc.GrpcClient.connectToServer(GrpcClient.java:329)
	at com.alibaba.nacos.common.remote.client.RpcClient.reconnect(RpcClient.java:502)
	at com.alibaba.nacos.common.remote.client.RpcClient.lambda$start$2(RpcClient.java:343)
	at java.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:572)
	at java.base/java.util.concurrent.FutureTask.run$$$capture(FutureTask.java:317)
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java)
	at java.base/java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:304)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-05-09 20:48:54.505 [com.alibaba.nacos.client.remote.worker] INFO  com.alibaba.nacos.common.remote.client - [d38a97aa-eae7-4ce7-a9e2-316814056d5e_config-0] Fail to connect server, after trying 3 times, last try server is {serverIp = '8.133.246.113', server main port = 8848}, error = unknown
2025-05-09 20:48:54.915 [com.alibaba.nacos.client.remote.worker] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - grpc client connection server:8.133.246.113 ip,serverPort:9848,grpcTslConfig:{"sslProvider":"OPENSSL","enableTls":false,"mutualAuthEnable":false,"trustAll":false}
2025-05-09 20:48:56.031 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:10911] result: true
2025-05-09 20:48:56.032 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:9876] result: true
2025-05-09 20:48:57.843 [nacos-grpc-client-executor-8.133.246.113-60] WARN  c.a.nacos.common.remote.client.grpc.GrpcClient - [1746794789748_139.227.195.203_43564]Ignore error event,isRunning:false,isAbandon=false
2025-05-09 20:48:57.918 [com.alibaba.nacos.client.remote.worker] ERROR c.a.nacos.common.remote.client.grpc.GrpcClient - Server check fail, please check server 8.133.246.113 ,port 9848 is available , error ={}
java.util.concurrent.TimeoutException: Waited 3000 milliseconds (plus 504700 nanoseconds delay) for com.alibaba.nacos.shaded.io.grpc.stub.ClientCalls$GrpcFuture@5dc0a4ca[status=PENDING, info=[GrpcFuture{clientCall=PendingCall{realCall=ClientCallImpl{method=MethodDescriptor{fullMethodName=Request/request, type=UNARY, idempotent=false, safe=false, sampledToLocalTracing=true, requestMarshaller=com.alibaba.nacos.shaded.io.grpc.protobuf.lite.ProtoLiteUtils$MessageMarshaller@4f1e2b3, responseMarshaller=com.alibaba.nacos.shaded.io.grpc.protobuf.lite.ProtoLiteUtils$MessageMarshaller@3de9dcd1, schemaDescriptor=com.alibaba.nacos.api.grpc.auto.RequestGrpc$RequestMethodDescriptorSupplier@5bbbbb27}}}}]]
	at com.alibaba.nacos.shaded.com.google.common.util.concurrent.AbstractFuture.get(AbstractFuture.java:508)
	at com.alibaba.nacos.common.remote.client.grpc.GrpcClient.serverCheck(GrpcClient.java:218)
	at com.alibaba.nacos.common.remote.client.grpc.GrpcClient.connectToServer(GrpcClient.java:329)
	at com.alibaba.nacos.common.remote.client.RpcClient.reconnect(RpcClient.java:502)
	at com.alibaba.nacos.common.remote.client.RpcClient.lambda$start$2(RpcClient.java:343)
	at java.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:572)
	at java.base/java.util.concurrent.FutureTask.run$$$capture(FutureTask.java:317)
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java)
	at java.base/java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:304)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-05-09 20:48:57.918 [com.alibaba.nacos.client.remote.worker] INFO  com.alibaba.nacos.common.remote.client - [d38a97aa-eae7-4ce7-a9e2-316814056d5e_config-0] Fail to connect server, after trying 4 times, last try server is {serverIp = '8.133.246.113', server main port = 8848}, error = unknown
2025-05-09 20:48:58.419 [com.alibaba.nacos.client.remote.worker] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - grpc client connection server:8.133.246.113 ip,serverPort:9848,grpcTslConfig:{"sslProvider":"OPENSSL","enableTls":false,"mutualAuthEnable":false,"trustAll":false}
2025-05-09 20:48:59.033 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:10911] result: true
2025-05-09 20:49:01.422 [com.alibaba.nacos.client.remote.worker] ERROR c.a.nacos.common.remote.client.grpc.GrpcClient - Server check fail, please check server 8.133.246.113 ,port 9848 is available , error ={}
java.util.concurrent.TimeoutException: Waited 3000 milliseconds (plus 1 milliseconds, 95700 nanoseconds delay) for com.alibaba.nacos.shaded.io.grpc.stub.ClientCalls$GrpcFuture@4f2727c4[status=PENDING, info=[GrpcFuture{clientCall=PendingCall{realCall=ClientCallImpl{method=MethodDescriptor{fullMethodName=Request/request, type=UNARY, idempotent=false, safe=false, sampledToLocalTracing=true, requestMarshaller=com.alibaba.nacos.shaded.io.grpc.protobuf.lite.ProtoLiteUtils$MessageMarshaller@4f1e2b3, responseMarshaller=com.alibaba.nacos.shaded.io.grpc.protobuf.lite.ProtoLiteUtils$MessageMarshaller@3de9dcd1, schemaDescriptor=com.alibaba.nacos.api.grpc.auto.RequestGrpc$RequestMethodDescriptorSupplier@5bbbbb27}}}}]]
	at com.alibaba.nacos.shaded.com.google.common.util.concurrent.AbstractFuture.get(AbstractFuture.java:508)
	at com.alibaba.nacos.common.remote.client.grpc.GrpcClient.serverCheck(GrpcClient.java:218)
	at com.alibaba.nacos.common.remote.client.grpc.GrpcClient.connectToServer(GrpcClient.java:329)
	at com.alibaba.nacos.common.remote.client.RpcClient.reconnect(RpcClient.java:502)
	at com.alibaba.nacos.common.remote.client.RpcClient.lambda$start$2(RpcClient.java:343)
	at java.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:572)
	at java.base/java.util.concurrent.FutureTask.run$$$capture(FutureTask.java:317)
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java)
	at java.base/java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:304)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-05-09 20:49:01.422 [com.alibaba.nacos.client.remote.worker] INFO  com.alibaba.nacos.common.remote.client - [d38a97aa-eae7-4ce7-a9e2-316814056d5e_config-0] Fail to connect server, after trying 5 times, last try server is {serverIp = '8.133.246.113', server main port = 8848}, error = unknown
2025-05-09 20:49:02.024 [com.alibaba.nacos.client.remote.worker] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - grpc client connection server:8.133.246.113 ip,serverPort:9848,grpcTslConfig:{"sslProvider":"OPENSSL","enableTls":false,"mutualAuthEnable":false,"trustAll":false}
2025-05-09 20:49:02.049 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:10911] result: true
2025-05-09 20:49:02.049 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:9876] result: true
2025-05-09 20:49:04.198 [SpringApplicationShutdownHook] INFO  o.s.orm.jpa.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-05-09 20:49:04.199 [SpringApplicationShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-2} closing ...
2025-05-09 20:49:04.205 [SpringApplicationShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-2} closed
2025-05-09 20:49:04.205 [SpringApplicationShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} closing ...
2025-05-09 20:49:04.206 [SpringApplicationShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} closed
