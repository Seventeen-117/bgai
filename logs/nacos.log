2025-05-19 13:20:13.027 [main] WARN  com.alibaba.nacos.client.logging.NacosLogging - Load Logback Configuration of Nacos fail, message: Could not initialize Logback Nacos logging from classpath:nacos-logback.xml
2025-05-19 13:20:13.029 [main] INFO  com.bgpay.bgai.BgaiApplication - The following 1 profile is active: "dev"
2025-05-19 13:20:14.958 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-05-19 13:20:14.959 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-05-19 13:20:14.995 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 25 ms. Found 0 JPA repository interfaces.
2025-05-19 13:20:15.012 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-05-19 13:20:15.014 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-05-19 13:20:15.032 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 7 ms. Found 0 Redis repository interfaces.
2025-05-19 13:20:15.742 [main] INFO  io.seata.config.ConfigurationFactory - load Configuration from :Spring Configuration
2025-05-19 13:20:15.752 [main] INFO  io.seata.config.ConfigurationFactory - load Configuration from :Spring Configuration
2025-05-19 13:20:15.760 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Initializing Global Transaction Clients ... 
2025-05-19 13:20:15.894 [main] INFO  io.seata.core.rpc.netty.NettyClientBootstrap - NettyClientBootstrap has started
2025-05-19 13:20:15.895 [main] INFO  io.seata.discovery.registry.RegistryFactory - use registry center type: file
2025-05-19 13:20:15.906 [main] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - will connect to 8.133.246.113:8091
2025-05-19 13:20:15.911 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - NettyPool create channel to transactionRole:TMROLE,address:8.133.246.113:8091,msg:< RegisterTMRequest{version='1.7.0', applicationId='bgtech-ai', transactionServiceGroup='bgai-tx-group', extraData='ak=null
digest=bgai-tx-group,192.168.86.8,1747632015909
timestamp=1747632015909
authVersion=V4
vgroup=bgai-tx-group
ip=192.168.86.8
'} >
2025-05-19 13:20:16.278 [main] INFO  io.seata.core.rpc.netty.TmNettyRemotingClient - register TM success. client version:1.7.0, server version:1.8.1-SNAPSHOT,channel:[id: 0x7b076161, L:/192.168.86.8:59200 - R:/8.133.246.113:8091]
2025-05-19 13:20:16.288 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - register success, cost 213 ms, version:1.8.1-SNAPSHOT,role:TMROLE,channel:[id: 0x7b076161, L:/192.168.86.8:59200 - R:/8.133.246.113:8091]
2025-05-19 13:20:16.289 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Transaction Manager Client is initialized. applicationId[bgtech-ai] txServiceGroup[bgai-tx-group]
2025-05-19 13:20:16.307 [main] INFO  io.seata.rm.datasource.AsyncWorker - Async Commit Buffer Limit: 10000
2025-05-19 13:20:16.308 [main] INFO  io.seata.rm.datasource.xa.ResourceManagerXA - ResourceManagerXA init ...
2025-05-19 13:20:16.322 [main] INFO  io.seata.core.rpc.netty.NettyClientBootstrap - NettyClientBootstrap has started
2025-05-19 13:20:16.322 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Resource Manager is initialized. applicationId[bgtech-ai] txServiceGroup[bgai-tx-group]
2025-05-19 13:20:16.322 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Global Transaction Clients are initialized. 
2025-05-19 13:20:17.879 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat initialized with port(s): 8080 (http)
2025-05-19 13:20:17.893 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - The ["http-nio-8080"] connector has been configured to support HTTP upgrade to [h2c]
2025-05-19 13:20:17.893 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - Initializing ProtocolHandler ["http-nio-8080"]
2025-05-19 13:20:17.896 [main] INFO  org.apache.catalina.core.StandardService - Starting service [Tomcat]
2025-05-19 13:20:17.896 [main] INFO  org.apache.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.15]
2025-05-19 13:20:18.465 [main] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} inited
2025-05-19 13:20:18.742 [main] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - will connect to 8.133.246.113:8091
2025-05-19 13:20:18.742 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - RM will register :jdbc:mysql://8.133.246.113:3306/deepseek
2025-05-19 13:20:18.742 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - NettyPool create channel to transactionRole:RMROLE,address:8.133.246.113:8091,msg:< RegisterRMRequest{resourceIds='jdbc:mysql://8.133.246.113:3306/deepseek', version='1.7.0', applicationId='bgtech-ai', transactionServiceGroup='bgai-tx-group', extraData='null'} >
2025-05-19 13:20:18.767 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - register RM success. client version:1.7.0, server version:1.8.1-SNAPSHOT,channel:[id: 0x9d3b05c8, L:/192.168.86.8:59214 - R:/8.133.246.113:8091]
2025-05-19 13:20:18.767 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - register success, cost 16 ms, version:1.8.1-SNAPSHOT,role:RMROLE,channel:[id: 0x9d3b05c8, L:/192.168.86.8:59214 - R:/8.133.246.113:8091]
2025-05-19 13:20:18.770 [main] INFO  i.s.s.a.datasource.SeataAutoDataSourceProxyCreator - Auto proxy data source 'masterDataSource' by 'AT' mode.
2025-05-19 13:20:18.846 [main] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-2} inited
2025-05-19 13:20:18.923 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - will register resourceId:jdbc:mysql://8.133.246.113:3306/deepseek
2025-05-19 13:20:18.924 [main] INFO  i.s.s.a.datasource.SeataAutoDataSourceProxyCreator - Auto proxy data source 'slaveDataSource' by 'AT' mode.
2025-05-19 13:20:18.932 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.rm.AbstractRMHandler - the rm client received response msg [RegisterRMResponse{version='1.8.1-SNAPSHOT', extraData='null', identified=true, resultCode=null, msg='null'}] from tc server.
2025-05-19 13:20:18.947 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - will register resourceId:jdbc:mysql://8.133.246.113:3306/deepseek
2025-05-19 13:20:18.947 [main] INFO  i.s.s.a.datasource.SeataAutoDataSourceProxyCreator - Auto proxy data source 'dynamicDataSource' by 'AT' mode.
2025-05-19 13:20:18.963 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.rm.AbstractRMHandler - the rm client received response msg [RegisterRMResponse{version='1.8.1-SNAPSHOT', extraData='null', identified=true, resultCode=null, msg='null'}] from tc server.
2025-05-19 13:20:19.099 [main] INFO  org.hibernate.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-05-19 13:20:19.180 [main] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.1.7.Final
2025-05-19 13:20:19.581 [main] INFO  SQL dialect - HHH000400: Using dialect: org.hibernate.dialect.MySQL8Dialect
2025-05-19 13:20:19.583 [main] WARN  org.hibernate.orm.deprecation - HHH90000026: MySQL8Dialect has been deprecated; use org.hibernate.dialect.MySQLDialect instead
2025-05-19 13:20:19.958 [main] INFO  o.h.e.t.jta.platform.internal.JtaPlatformInitiator - HHH000490: Using JtaPlatform implementation: [org.hibernate.engine.transaction.jta.platform.internal.NoJtaPlatform]
2025-05-19 13:20:19.973 [main] INFO  o.s.orm.jpa.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-05-19 13:20:20.592 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-19 13:20:20.612 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-19 13:20:20.657 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-19 13:20:20.660 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-19 13:20:20.661 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-19 13:20:20.679 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-19 13:20:21.495 [main] INFO  com.bgpay.bgai.service.impl.UserServiceImpl - 初始化SSO配置: clientId=bgai-client-id, redirectUri=http://localhost:8080/api/auth/callback
2025-05-19 13:20:21.636 [main] INFO  com.bgpay.bgai.controller.AuthController - 初始化认证控制器: clientId=bgai-client-id, redirectUri=http://localhost:8080/api/auth/callback
2025-05-19 13:20:22.446 [main] INFO  o.a.r.s.autoconfigure.RocketMQAutoConfiguration - a producer (billing-producer-group) init on namesrv 8.133.246.113:9876
2025-05-19 13:20:23.034 [main] WARN  i.s.s.b.a.provider.SpringBootConfigurationProvider - The get method not found for the field 'SeataProperties#accesskey'.
2025-05-19 13:20:23.035 [main] WARN  i.s.s.b.a.provider.SpringBootConfigurationProvider - The get method not found for the field 'SeataProperties#secretkey'.
2025-05-19 13:20:23.047 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 加载到1个Saga状态机定义文件
2025-05-19 13:20:23.298 [main] INFO  com.bgpay.bgai.saga.CustomSagaJsonParser - 开始解析状态机定义: bgai-saga-transaction
2025-05-19 13:20:23.299 [main] INFO  com.bgpay.bgai.saga.CustomSagaJsonParser - 状态机定义解析成功: bgai-saga-transaction
2025-05-19 13:20:23.299 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 成功加载状态机定义: /E:/project/bgai/target/classes/statelang/bgai-saga-transaction.json
2025-05-19 13:20:23.942 [main] INFO  org.redisson.Version - Redisson 3.24.3
2025-05-19 13:20:24.113 [redisson-netty-4-6] INFO  o.r.connection.pool.MasterPubSubConnectionPool - 1 connections initialized for 8.133.246.113/8.133.246.113:6379
2025-05-19 13:20:24.574 [redisson-netty-4-19] INFO  org.redisson.connection.pool.MasterConnectionPool - 24 connections initialized for 8.133.246.113/8.133.246.113:6379
2025-05-19 13:20:24.873 [main] INFO  com.bgpay.bgai.service.mq.MQConsumerService - MQ consumer startup successful [group=billing-consumer-group, topic=BILLING_TOPIC, tag=USER_BILLING]
2025-05-19 13:20:25.231 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Bean [com.bgpay.bgai.service.impl.SeataTransactionService$$SpringCGLIB$$0] with name [seataTransactionService] would use interceptor [io.seata.spring.annotation.GlobalTransactionalInterceptor]
2025-05-19 13:20:25.364 [main] DEBUG com.bgpay.bgai.config.AsyncConfig$1 - Initializing ExecutorService 'blockingExecutor'
2025-05-19 13:20:26.798 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [After]
2025-05-19 13:20:26.798 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Before]
2025-05-19 13:20:26.798 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Between]
2025-05-19 13:20:26.798 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Cookie]
2025-05-19 13:20:26.798 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Header]
2025-05-19 13:20:26.798 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Host]
2025-05-19 13:20:26.798 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Method]
2025-05-19 13:20:26.798 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Path]
2025-05-19 13:20:26.798 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Query]
2025-05-19 13:20:26.798 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [ReadBody]
2025-05-19 13:20:26.798 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [RemoteAddr]
2025-05-19 13:20:26.798 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [XForwardedRemoteAddr]
2025-05-19 13:20:26.798 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Weight]
2025-05-19 13:20:26.798 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [CloudFoundryRouteService]
2025-05-19 13:20:28.168 [main] INFO  o.s.b.actuate.endpoint.web.EndpointLinksResolver - Exposing 1 endpoint(s) beneath base path '/actuator'
2025-05-19 13:20:28.631 [main] WARN  i.s.s.b.a.provider.SpringBootConfigurationProvider - The get method not found for the field 'SeataProperties#accesskey'.
2025-05-19 13:20:28.631 [main] WARN  i.s.s.b.a.provider.SpringBootConfigurationProvider - The get method not found for the field 'SeataProperties#secretkey'.
2025-05-19 13:20:28.658 [main] INFO  io.seata.saga.tm.DefaultSagaTransactionalTemplate - Initializing Global Transaction Clients ... 
2025-05-19 13:20:28.658 [main] INFO  io.seata.saga.tm.DefaultSagaTransactionalTemplate - Transaction Manager Client is initialized. applicationId[bgtech-ai] txServiceGroup[bgai-tx-group]
2025-05-19 13:20:28.658 [main] INFO  io.seata.saga.tm.DefaultSagaTransactionalTemplate - Resource Manager is initialized. applicationId[bgtech-ai] txServiceGroup[bgai-tx-group]
2025-05-19 13:20:28.659 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - will register resourceId:bgtech-ai#bgai-tx-group
2025-05-19 13:20:28.659 [main] INFO  io.seata.saga.tm.DefaultSagaTransactionalTemplate - Global Transaction Clients are initialized. 
2025-05-19 13:20:28.676 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.rm.AbstractRMHandler - the rm client received response msg [RegisterRMResponse{version='1.8.1-SNAPSHOT', extraData='null', identified=true, resultCode=null, msg='null'}] from tc server.
2025-05-19 13:20:30.202 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - Starting ProtocolHandler ["http-nio-8080"]
2025-05-19 13:20:30.223 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat started on port(s): 8080 (http) with context path ''
2025-05-19 13:20:30.234 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from ans.namespace attribute : null
2025-05-19 13:20:30.234 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from ALIBABA_ALIWARE_NAMESPACE attribute :null
2025-05-19 13:20:30.235 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from namespace attribute :null
2025-05-19 13:20:30.246 [main] INFO  c.a.n.p.auth.spi.client.ClientAuthPluginManager - [ClientAuthPluginManager] Load ClientAuthService com.alibaba.nacos.client.auth.impl.NacosClientAuthServiceImpl success.
2025-05-19 13:20:30.246 [main] INFO  c.a.n.p.auth.spi.client.ClientAuthPluginManager - [ClientAuthPluginManager] Load ClientAuthService com.alibaba.nacos.client.auth.ram.RamClientAuthServiceImpl success.
2025-05-19 13:20:30.250 [main] INFO  com.alibaba.nacos.common.remote.client - [RpcClientFactory] create a new rpc client of ec952600-515e-4d5f-afa6-54002273d17e
2025-05-19 13:20:30.252 [main] INFO  com.alibaba.nacos.common.remote.client - [ec952600-515e-4d5f-afa6-54002273d17e] RpcClient init, ServerListFactory = com.alibaba.nacos.client.naming.core.ServerListManager
2025-05-19 13:20:30.252 [main] INFO  com.alibaba.nacos.common.remote.client - [ec952600-515e-4d5f-afa6-54002273d17e] Registry connection listener to current client:com.alibaba.nacos.client.naming.remote.gprc.redo.NamingGrpcRedoService
2025-05-19 13:20:30.252 [main] INFO  com.alibaba.nacos.common.remote.client - [ec952600-515e-4d5f-afa6-54002273d17e] Register server push request handler:com.alibaba.nacos.client.naming.remote.gprc.NamingPushRequestHandler
2025-05-19 13:20:30.253 [main] INFO  com.alibaba.nacos.common.remote.client - [ec952600-515e-4d5f-afa6-54002273d17e] Try to connect to server on start up, server: {serverIp = '8.133.246.113', server main port = 8848}
2025-05-19 13:20:30.253 [main] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - grpc client connection server:8.133.246.113 ip,serverPort:9848,grpcTslConfig:{"sslProvider":"OPENSSL","enableTls":false,"mutualAuthEnable":false,"trustAll":false}
2025-05-19 13:20:30.383 [main] INFO  com.alibaba.nacos.common.remote.client - [ec952600-515e-4d5f-afa6-54002273d17e] Success to connect to server [8.133.246.113:8848] on start up, connectionId = 1747632030269_139.227.195.203_43957
2025-05-19 13:20:30.383 [com.alibaba.nacos.client.remote.worker] INFO  com.alibaba.nacos.common.remote.client - [ec952600-515e-4d5f-afa6-54002273d17e] Notify connected event to listeners.
2025-05-19 13:20:30.383 [main] INFO  com.alibaba.nacos.common.remote.client - [ec952600-515e-4d5f-afa6-54002273d17e] Register server push request handler:com.alibaba.nacos.common.remote.client.RpcClient$ConnectResetRequestHandler
2025-05-19 13:20:30.383 [com.alibaba.nacos.client.remote.worker] INFO  com.alibaba.nacos.client.naming - Grpc connection connect
2025-05-19 13:20:30.383 [main] INFO  com.alibaba.nacos.common.remote.client - [ec952600-515e-4d5f-afa6-54002273d17e] Register server push request handler:com.alibaba.nacos.common.remote.client.RpcClient$$Lambda/0x0000020135532900
2025-05-19 13:20:30.385 [main] INFO  com.alibaba.nacos.client.naming - [REGISTER-SERVICE] d750d92e-152f-4055-a641-3bc9dda85a29 registering service bgtech-ai with instance Instance{instanceId='null', ip='192.168.86.8', port=8080, weight=1.0, healthy=true, enabled=true, ephemeral=true, clusterName='DEFAULT', serviceName='null', metadata={IPv6=[2408:820c:7528:8342:b486:9b72:4b72:4bf0], preserved.register.source=SPRING_CLOUD}}
2025-05-19 13:20:30.416 [main] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - nacos registry, DEFAULT_GROUP bgtech-ai 192.168.86.8:8080 register finished
2025-05-19 13:20:30.483 [main] INFO  com.bgpay.bgai.BgaiApplication - Started BgaiApplication in 20.327 seconds (process running for 22.837)
2025-05-19 13:20:30.487 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-19 13:20:30.488 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-19 13:20:30.500 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-19 13:20:30.501 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-19 13:20:30.501 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-19 13:20:30.511 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-19 13:20:30.511 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-19 13:20:30.511 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-19 13:20:30.519 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-19 13:20:30.519 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-19 13:20:30.520 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-19 13:20:30.526 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-19 13:20:30.526 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - ==================== Saga状态机加载报告 ====================
2025-05-19 13:20:30.526 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - Saga状态机配置加载状态: 成功
2025-05-19 13:20:30.527 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 已加载的状态机定义文件数量: 1
2025-05-19 13:20:30.527 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 已加载的状态机定义文件:
2025-05-19 13:20:30.527 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig -  - /E:/project/bgai/target/classes/statelang/bgai-saga-transaction.json
2025-05-19 13:20:30.527 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - Saga解析器状态: CUSTOM_FASTJSON2
2025-05-19 13:20:30.527 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 状态机解析结果: 成功 1 个, 失败 0 个
2025-05-19 13:20:30.527 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - =============================================================
2025-05-19 13:20:30.531 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - nacos.cache.data.init.snapshot = true 
2025-05-19 13:20:30.531 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] common-dev.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-19 13:20:30.539 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=common-dev.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-19 13:20:30.539 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=common-dev.yaml, group=DEFAULT_GROUP
2025-05-19 13:20:30.539 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-19 13:20:30.540 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-19 13:20:30.540 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai.yaml, group=DEFAULT_GROUP
2025-05-19 13:20:30.541 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai-dev.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-19 13:20:30.541 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai-dev.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-19 13:20:30.541 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai-dev.yaml, group=DEFAULT_GROUP
2025-05-19 13:20:30.541 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-19 13:20:30.542 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai, group=DEFAULT_GROUP, cnt=1
2025-05-19 13:20:30.542 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai, group=DEFAULT_GROUP
2025-05-19 13:20:36.685 [http-nio-8080-exec-2] DEBUG com.bgpay.bgai.filter.ApiKeyAuthenticationFilter - Skipping API Key validation for excluded path: /auth/authorize
2025-05-19 13:20:36.705 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.MockAuthController - Authorization request: client_id=bgai-client-id, redirect_uri=http://localhost:8080/api/auth/callback, response_type=code
2025-05-19 13:20:48.217 [http-nio-8080-exec-3] DEBUG com.bgpay.bgai.filter.ApiKeyAuthenticationFilter - Skipping API Key validation for excluded path: /api/auth/callback
2025-05-19 13:20:48.308 [http-nio-8080-exec-4] DEBUG com.bgpay.bgai.filter.ApiKeyAuthenticationFilter - Skipping API Key validation for excluded path: /auth/token
2025-05-19 13:20:48.318 [http-nio-8080-exec-4] INFO  com.bgpay.bgai.controller.MockAuthController - Token request: grant_type=null, code=null, client_id=null
2025-05-19 13:20:48.383 [http-nio-8080-exec-6] DEBUG com.bgpay.bgai.filter.ApiKeyAuthenticationFilter - Skipping API Key validation for excluded path: /auth/userinfo
2025-05-19 13:20:48.395 [http-nio-8080-exec-3] DEBUG com.bgpay.bgai.mapper.UserMapper.findByUserId - ==>  Preparing: SELECT * FROM t_user WHERE user_id = ?
2025-05-19 13:20:48.397 [http-nio-8080-exec-3] DEBUG com.bgpay.bgai.mapper.UserMapper.findByUserId - ==> Parameters: 689258T(String)
2025-05-19 13:20:48.436 [http-nio-8080-exec-3] DEBUG com.bgpay.bgai.mapper.UserMapper.findByUserId - <==      Total: 1
2025-05-19 13:20:48.690 [http-nio-8080-exec-3] DEBUG com.bgpay.bgai.mapper.UserMapper.updateById - ==>  Preparing: UPDATE t_user SET user_id=?, username=?, email=?, avatar_url=?, last_login_time=?, access_token=?, refresh_token=?, token_expire_time=?, status=?, create_time=?, update_time=? WHERE id=?
2025-05-19 13:20:48.701 [http-nio-8080-exec-3] DEBUG com.bgpay.bgai.mapper.UserMapper.updateById - ==> Parameters: 689258T(String), 测试用户(String), test@example.com(String), https://ui-avatars.com/api/?name=测试用户(String), 2025-05-19T13:20:48.437144800(LocalDateTime), 1361d019-fde9-46db-b05d-2254356f1a42(String), 149913d0-cefe-4b0d-8f14-c33fda0b6e07(String), 2025-05-19T14:20:48.437144800(LocalDateTime), 1(Integer), 2025-04-26T23:59:16(LocalDateTime), 2025-05-19T13:20:48.437144800(LocalDateTime), 1(Long)
2025-05-19 13:20:48.742 [http-nio-8080-exec-3] DEBUG com.bgpay.bgai.mapper.UserMapper.updateById - <==    Updates: 1
2025-05-19 13:23:38.935 [Thread-7] WARN  com.alibaba.nacos.common.notify.NotifyCenter - [NotifyCenter] Start destroying Publisher
2025-05-19 13:23:38.935 [Thread-7] WARN  com.alibaba.nacos.common.notify.NotifyCenter - [NotifyCenter] Destruction of the end
2025-05-19 13:23:38.936 [Thread-1] WARN  c.alibaba.nacos.common.http.HttpClientBeanHolder - [HttpClientBeanHolder] Start destroying common HttpClient
2025-05-19 13:23:38.937 [Thread-1] WARN  c.alibaba.nacos.common.http.HttpClientBeanHolder - [HttpClientBeanHolder] Destruction of the end
2025-05-19 13:23:38.968 [NettyClientSelector_TMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - channel inactive: [id: 0x7b076161, L:/192.168.86.8:59200 ! R:/8.133.246.113:8091]
2025-05-19 13:23:38.968 [NettyClientSelector_TMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - return to pool, rm channel:[id: 0x7b076161, L:/192.168.86.8:59200 ! R:/8.133.246.113:8091]
2025-05-19 13:23:38.968 [NettyClientSelector_TMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - channel valid false,channel:[id: 0x7b076161, L:/192.168.86.8:59200 ! R:/8.133.246.113:8091]
2025-05-19 13:23:38.968 [NettyClientSelector_TMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - will destroy channel:[id: 0x7b076161, L:/192.168.86.8:59200 ! R:/8.133.246.113:8091]
2025-05-19 13:23:38.968 [NettyClientSelector_TMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0x7b076161, L:/192.168.86.8:59200 ! R:/8.133.246.113:8091]) will closed
2025-05-19 13:23:38.969 [NettyClientSelector_TMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0x7b076161, L:/192.168.86.8:59200 ! R:/8.133.246.113:8091]) will closed
2025-05-19 13:23:38.969 [NettyClientSelector_RMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - channel inactive: [id: 0x9d3b05c8, L:/192.168.86.8:59214 ! R:/8.133.246.113:8091]
2025-05-19 13:23:38.969 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - return to pool, rm channel:[id: 0x9d3b05c8, L:/192.168.86.8:59214 ! R:/8.133.246.113:8091]
2025-05-19 13:23:38.969 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - channel valid false,channel:[id: 0x9d3b05c8, L:/192.168.86.8:59214 ! R:/8.133.246.113:8091]
2025-05-19 13:23:38.969 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - will destroy channel:[id: 0x9d3b05c8, L:/192.168.86.8:59214 ! R:/8.133.246.113:8091]
2025-05-19 13:23:38.969 [NettyClientSelector_RMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0x9d3b05c8, L:/192.168.86.8:59214 ! R:/8.133.246.113:8091]) will closed
2025-05-19 13:23:38.969 [NettyClientSelector_RMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0x9d3b05c8, L:/192.168.86.8:59214 ! R:/8.133.246.113:8091]) will closed
2025-05-19 13:23:38.983 [SpringContextShutdownHook] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - De-registering from Nacos Server now...
2025-05-19 13:23:38.987 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - [DEREGISTER-SERVICE] d750d92e-152f-4055-a641-3bc9dda85a29 deregistering service bgtech-ai with instance: Instance{instanceId='null', ip='192.168.86.8', port=8080, weight=1.0, healthy=true, enabled=true, ephemeral=true, clusterName='DEFAULT', serviceName='null', metadata={}}
2025-05-19 13:23:39.017 [SpringContextShutdownHook] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - De-registration finished.
2025-05-19 13:23:39.020 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.cache.ServiceInfoHolder do shutdown begin
2025-05-19 13:23:39.020 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.backups.FailoverReactor do shutdown begin
2025-05-19 13:23:39.021 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.backups.FailoverReactor do shutdown stop
2025-05-19 13:23:39.021 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.cache.ServiceInfoHolder do shutdown stop
2025-05-19 13:23:39.021 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.NamingClientProxyDelegate do shutdown begin
2025-05-19 13:23:39.021 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServiceInfoUpdateService do shutdown begin
2025-05-19 13:23:39.021 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServiceInfoUpdateService do shutdown stop
2025-05-19 13:23:39.021 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServerListManager do shutdown begin
2025-05-19 13:23:39.021 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Start destroying NacosRestTemplate
2025-05-19 13:23:39.021 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Destruction of the end
2025-05-19 13:23:39.021 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServerListManager do shutdown stop
2025-05-19 13:23:39.021 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.http.NamingHttpClientProxy do shutdown begin
2025-05-19 13:23:39.021 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Start destroying NacosRestTemplate
2025-05-19 13:23:39.021 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Destruction of the end
2025-05-19 13:23:39.021 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.http.NamingHttpClientProxy do shutdown stop
2025-05-19 13:23:39.021 [SpringContextShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Shutdown rpc client, set status to shutdown
2025-05-19 13:23:39.021 [SpringContextShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Shutdown client event executor java.util.concurrent.ScheduledThreadPoolExecutor@4c77eb54[Running, pool size = 2, active threads = 2, queued tasks = 0, completed tasks = 0]
2025-05-19 13:23:39.022 [SpringContextShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Close current connection 1747632030269_139.227.195.203_43957
2025-05-19 13:23:39.031 [nacos-grpc-client-executor-8.133.246.113-52] WARN  c.a.nacos.common.remote.client.grpc.GrpcClient - [1747632030269_139.227.195.203_43957]Ignore error event,isRunning:false,isAbandon=false
2025-05-19 13:23:39.032 [SpringContextShutdownHook] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - Shutdown grpc executor java.util.concurrent.ThreadPoolExecutor@6716eb44[Running, pool size = 5, active threads = 0, queued tasks = 0, completed tasks = 53]
2025-05-19 13:23:39.032 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - Shutdown grpc redo service executor java.util.concurrent.ScheduledThreadPoolExecutor@7d1a7bd8[Running, pool size = 1, active threads = 0, queued tasks = 1, completed tasks = 62]
2025-05-19 13:23:39.032 [SpringContextShutdownHook] INFO  c.a.n.client.auth.ram.identify.CredentialWatcher - [null] CredentialWatcher is stopped
2025-05-19 13:23:39.032 [SpringContextShutdownHook] INFO  c.a.n.client.auth.ram.identify.CredentialService - [null] CredentialService is freed
2025-05-19 13:23:39.033 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.NamingClientProxyDelegate do shutdown stop
2025-05-19 13:23:41.081 [SpringContextShutdownHook] DEBUG com.bgpay.bgai.config.AsyncConfig$1 - Shutting down ExecutorService 'blockingExecutor'
2025-05-19 13:23:41.131 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:10911] result: true
2025-05-19 13:23:41.131 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:9876] result: true
2025-05-19 13:23:41.152 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:10911] result: true
2025-05-19 13:23:41.152 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:9876] result: true
2025-05-19 13:23:41.268 [SpringContextShutdownHook] INFO  o.s.orm.jpa.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-05-19 13:23:41.269 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-2} closing ...
2025-05-19 13:23:41.276 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-2} closed
2025-05-19 13:23:41.276 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} closing ...
2025-05-19 13:23:41.277 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} closed
2025-05-19 13:33:55.631 [main] WARN  com.alibaba.nacos.client.logging.NacosLogging - Load Logback Configuration of Nacos fail, message: Could not initialize Logback Nacos logging from classpath:nacos-logback.xml
2025-05-19 13:33:55.633 [main] INFO  com.bgpay.bgai.BgaiApplication - The following 1 profile is active: "dev"
2025-05-19 13:33:57.461 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-05-19 13:33:57.463 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-05-19 13:33:57.486 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 16 ms. Found 0 JPA repository interfaces.
2025-05-19 13:33:57.498 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-05-19 13:33:57.499 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-05-19 13:33:57.515 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 6 ms. Found 0 Redis repository interfaces.
2025-05-19 13:33:58.069 [main] INFO  io.seata.config.ConfigurationFactory - load Configuration from :Spring Configuration
2025-05-19 13:33:58.077 [main] INFO  io.seata.config.ConfigurationFactory - load Configuration from :Spring Configuration
2025-05-19 13:33:58.083 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Initializing Global Transaction Clients ... 
2025-05-19 13:33:58.184 [main] INFO  io.seata.core.rpc.netty.NettyClientBootstrap - NettyClientBootstrap has started
2025-05-19 13:33:58.185 [main] INFO  io.seata.discovery.registry.RegistryFactory - use registry center type: file
2025-05-19 13:33:58.195 [main] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - will connect to 8.133.246.113:8091
2025-05-19 13:33:58.199 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - NettyPool create channel to transactionRole:TMROLE,address:8.133.246.113:8091,msg:< RegisterTMRequest{version='1.7.0', applicationId='bgtech-ai', transactionServiceGroup='bgai-tx-group', extraData='ak=null
digest=bgai-tx-group,192.168.86.8,1747632838198
timestamp=1747632838198
authVersion=V4
vgroup=bgai-tx-group
ip=192.168.86.8
'} >
2025-05-19 13:33:58.330 [main] INFO  io.seata.core.rpc.netty.TmNettyRemotingClient - register TM success. client version:1.7.0, server version:1.8.1-SNAPSHOT,channel:[id: 0xfc74db87, L:/192.168.86.8:59406 - R:/8.133.246.113:8091]
2025-05-19 13:33:58.336 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - register success, cost 68 ms, version:1.8.1-SNAPSHOT,role:TMROLE,channel:[id: 0xfc74db87, L:/192.168.86.8:59406 - R:/8.133.246.113:8091]
2025-05-19 13:33:58.337 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Transaction Manager Client is initialized. applicationId[bgtech-ai] txServiceGroup[bgai-tx-group]
2025-05-19 13:33:58.350 [main] INFO  io.seata.rm.datasource.AsyncWorker - Async Commit Buffer Limit: 10000
2025-05-19 13:33:58.351 [main] INFO  io.seata.rm.datasource.xa.ResourceManagerXA - ResourceManagerXA init ...
2025-05-19 13:33:58.358 [main] INFO  io.seata.core.rpc.netty.NettyClientBootstrap - NettyClientBootstrap has started
2025-05-19 13:33:58.358 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Resource Manager is initialized. applicationId[bgtech-ai] txServiceGroup[bgai-tx-group]
2025-05-19 13:33:58.358 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Global Transaction Clients are initialized. 
2025-05-19 13:33:59.471 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat initialized with port(s): 8080 (http)
2025-05-19 13:33:59.480 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - The ["http-nio-8080"] connector has been configured to support HTTP upgrade to [h2c]
2025-05-19 13:33:59.481 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - Initializing ProtocolHandler ["http-nio-8080"]
2025-05-19 13:33:59.482 [main] INFO  org.apache.catalina.core.StandardService - Starting service [Tomcat]
2025-05-19 13:33:59.482 [main] INFO  org.apache.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.15]
2025-05-19 13:33:59.901 [main] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} inited
2025-05-19 13:34:00.153 [main] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - will connect to 8.133.246.113:8091
2025-05-19 13:34:00.153 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - RM will register :jdbc:mysql://8.133.246.113:3306/deepseek
2025-05-19 13:34:00.153 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - NettyPool create channel to transactionRole:RMROLE,address:8.133.246.113:8091,msg:< RegisterRMRequest{resourceIds='jdbc:mysql://8.133.246.113:3306/deepseek', version='1.7.0', applicationId='bgtech-ai', transactionServiceGroup='bgai-tx-group', extraData='null'} >
2025-05-19 13:34:00.170 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - register RM success. client version:1.7.0, server version:1.8.1-SNAPSHOT,channel:[id: 0x4050435c, L:/192.168.86.8:59410 - R:/8.133.246.113:8091]
2025-05-19 13:34:00.171 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - register success, cost 11 ms, version:1.8.1-SNAPSHOT,role:RMROLE,channel:[id: 0x4050435c, L:/192.168.86.8:59410 - R:/8.133.246.113:8091]
2025-05-19 13:34:00.172 [main] INFO  i.s.s.a.datasource.SeataAutoDataSourceProxyCreator - Auto proxy data source 'masterDataSource' by 'AT' mode.
2025-05-19 13:34:00.244 [main] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-2} inited
2025-05-19 13:34:00.313 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - will register resourceId:jdbc:mysql://8.133.246.113:3306/deepseek
2025-05-19 13:34:00.314 [main] INFO  i.s.s.a.datasource.SeataAutoDataSourceProxyCreator - Auto proxy data source 'slaveDataSource' by 'AT' mode.
2025-05-19 13:34:00.322 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.rm.AbstractRMHandler - the rm client received response msg [RegisterRMResponse{version='1.8.1-SNAPSHOT', extraData='null', identified=true, resultCode=null, msg='null'}] from tc server.
2025-05-19 13:34:00.338 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - will register resourceId:jdbc:mysql://8.133.246.113:3306/deepseek
2025-05-19 13:34:00.338 [main] INFO  i.s.s.a.datasource.SeataAutoDataSourceProxyCreator - Auto proxy data source 'dynamicDataSource' by 'AT' mode.
2025-05-19 13:34:00.350 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.rm.AbstractRMHandler - the rm client received response msg [RegisterRMResponse{version='1.8.1-SNAPSHOT', extraData='null', identified=true, resultCode=null, msg='null'}] from tc server.
2025-05-19 13:34:00.462 [main] INFO  org.hibernate.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-05-19 13:34:00.517 [main] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.1.7.Final
2025-05-19 13:34:00.850 [main] INFO  SQL dialect - HHH000400: Using dialect: org.hibernate.dialect.MySQL8Dialect
2025-05-19 13:34:00.852 [main] WARN  org.hibernate.orm.deprecation - HHH90000026: MySQL8Dialect has been deprecated; use org.hibernate.dialect.MySQLDialect instead
2025-05-19 13:34:01.199 [main] INFO  o.h.e.t.jta.platform.internal.JtaPlatformInitiator - HHH000490: Using JtaPlatform implementation: [org.hibernate.engine.transaction.jta.platform.internal.NoJtaPlatform]
2025-05-19 13:34:01.214 [main] INFO  o.s.orm.jpa.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-05-19 13:34:01.606 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-19 13:34:01.617 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-19 13:34:01.646 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-19 13:34:01.648 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-19 13:34:01.648 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-19 13:34:01.659 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-19 13:34:02.297 [main] INFO  com.bgpay.bgai.service.impl.UserServiceImpl - 初始化SSO配置: clientId=bgai-client-id, redirectUri=http://localhost:8080/api/auth/callback
2025-05-19 13:34:02.439 [main] INFO  com.bgpay.bgai.controller.AuthController - 初始化认证控制器: clientId=bgai-client-id, redirectUri=http://localhost:8080/api/auth/callback
2025-05-19 13:34:03.003 [main] INFO  o.a.r.s.autoconfigure.RocketMQAutoConfiguration - a producer (billing-producer-group) init on namesrv 8.133.246.113:9876
2025-05-19 13:34:03.261 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Bean [com.bgpay.bgai.service.deepseek.DeepSeekServiceImp$$SpringCGLIB$$0] with name [deepSeekServiceImp] would use interceptor [io.seata.spring.annotation.GlobalTransactionalInterceptor]
2025-05-19 13:34:03.539 [main] WARN  i.s.s.b.a.provider.SpringBootConfigurationProvider - The get method not found for the field 'SeataProperties#accesskey'.
2025-05-19 13:34:03.540 [main] WARN  i.s.s.b.a.provider.SpringBootConfigurationProvider - The get method not found for the field 'SeataProperties#secretkey'.
2025-05-19 13:34:03.552 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 加载到1个Saga状态机定义文件
2025-05-19 13:34:03.726 [main] INFO  com.bgpay.bgai.saga.CustomSagaJsonParser - 开始解析状态机定义: bgai-saga-transaction
2025-05-19 13:34:03.726 [main] INFO  com.bgpay.bgai.saga.CustomSagaJsonParser - 状态机定义解析成功: bgai-saga-transaction
2025-05-19 13:34:03.726 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 成功加载状态机定义: /E:/project/bgai/target/classes/statelang/bgai-saga-transaction.json
2025-05-19 13:34:04.224 [main] INFO  org.redisson.Version - Redisson 3.24.3
2025-05-19 13:34:04.355 [redisson-netty-4-6] INFO  o.r.connection.pool.MasterPubSubConnectionPool - 1 connections initialized for 8.133.246.113/8.133.246.113:6379
2025-05-19 13:34:04.673 [redisson-netty-4-19] INFO  org.redisson.connection.pool.MasterConnectionPool - 24 connections initialized for 8.133.246.113/8.133.246.113:6379
2025-05-19 13:34:04.930 [main] INFO  com.bgpay.bgai.service.mq.MQConsumerService - MQ consumer startup successful [group=billing-consumer-group, topic=BILLING_TOPIC, tag=USER_BILLING]
2025-05-19 13:34:05.225 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Bean [com.bgpay.bgai.service.impl.SeataTransactionService$$SpringCGLIB$$0] with name [seataTransactionService] would use interceptor [io.seata.spring.annotation.GlobalTransactionalInterceptor]
2025-05-19 13:34:05.350 [main] DEBUG com.bgpay.bgai.config.AsyncConfig$1 - Initializing ExecutorService 'blockingExecutor'
2025-05-19 13:34:06.635 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [After]
2025-05-19 13:34:06.635 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Before]
2025-05-19 13:34:06.635 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Between]
2025-05-19 13:34:06.635 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Cookie]
2025-05-19 13:34:06.635 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Header]
2025-05-19 13:34:06.635 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Host]
2025-05-19 13:34:06.635 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Method]
2025-05-19 13:34:06.635 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Path]
2025-05-19 13:34:06.635 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Query]
2025-05-19 13:34:06.635 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [ReadBody]
2025-05-19 13:34:06.635 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [RemoteAddr]
2025-05-19 13:34:06.636 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [XForwardedRemoteAddr]
2025-05-19 13:34:06.636 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Weight]
2025-05-19 13:34:06.636 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [CloudFoundryRouteService]
2025-05-19 13:34:08.037 [main] INFO  o.s.b.actuate.endpoint.web.EndpointLinksResolver - Exposing 1 endpoint(s) beneath base path '/actuator'
2025-05-19 13:34:08.356 [main] WARN  i.s.s.b.a.provider.SpringBootConfigurationProvider - The get method not found for the field 'SeataProperties#accesskey'.
2025-05-19 13:34:08.357 [main] WARN  i.s.s.b.a.provider.SpringBootConfigurationProvider - The get method not found for the field 'SeataProperties#secretkey'.
2025-05-19 13:34:08.370 [main] INFO  io.seata.saga.tm.DefaultSagaTransactionalTemplate - Initializing Global Transaction Clients ... 
2025-05-19 13:34:08.371 [main] INFO  io.seata.saga.tm.DefaultSagaTransactionalTemplate - Transaction Manager Client is initialized. applicationId[bgtech-ai] txServiceGroup[bgai-tx-group]
2025-05-19 13:34:08.371 [main] INFO  io.seata.saga.tm.DefaultSagaTransactionalTemplate - Resource Manager is initialized. applicationId[bgtech-ai] txServiceGroup[bgai-tx-group]
2025-05-19 13:34:08.371 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - will register resourceId:bgtech-ai#bgai-tx-group
2025-05-19 13:34:08.371 [main] INFO  io.seata.saga.tm.DefaultSagaTransactionalTemplate - Global Transaction Clients are initialized. 
2025-05-19 13:34:08.379 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.rm.AbstractRMHandler - the rm client received response msg [RegisterRMResponse{version='1.8.1-SNAPSHOT', extraData='null', identified=true, resultCode=null, msg='null'}] from tc server.
2025-05-19 13:34:09.680 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - Starting ProtocolHandler ["http-nio-8080"]
2025-05-19 13:34:09.694 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat started on port(s): 8080 (http) with context path ''
2025-05-19 13:34:09.704 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from ans.namespace attribute : null
2025-05-19 13:34:09.704 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from ALIBABA_ALIWARE_NAMESPACE attribute :null
2025-05-19 13:34:09.705 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from namespace attribute :null
2025-05-19 13:34:09.714 [main] INFO  c.a.n.p.auth.spi.client.ClientAuthPluginManager - [ClientAuthPluginManager] Load ClientAuthService com.alibaba.nacos.client.auth.impl.NacosClientAuthServiceImpl success.
2025-05-19 13:34:09.714 [main] INFO  c.a.n.p.auth.spi.client.ClientAuthPluginManager - [ClientAuthPluginManager] Load ClientAuthService com.alibaba.nacos.client.auth.ram.RamClientAuthServiceImpl success.
2025-05-19 13:34:09.718 [main] INFO  com.alibaba.nacos.common.remote.client - [RpcClientFactory] create a new rpc client of f0b62547-e3b4-458c-8686-c237d94c64ce
2025-05-19 13:34:09.720 [main] INFO  com.alibaba.nacos.common.remote.client - [f0b62547-e3b4-458c-8686-c237d94c64ce] RpcClient init, ServerListFactory = com.alibaba.nacos.client.naming.core.ServerListManager
2025-05-19 13:34:09.720 [main] INFO  com.alibaba.nacos.common.remote.client - [f0b62547-e3b4-458c-8686-c237d94c64ce] Registry connection listener to current client:com.alibaba.nacos.client.naming.remote.gprc.redo.NamingGrpcRedoService
2025-05-19 13:34:09.720 [main] INFO  com.alibaba.nacos.common.remote.client - [f0b62547-e3b4-458c-8686-c237d94c64ce] Register server push request handler:com.alibaba.nacos.client.naming.remote.gprc.NamingPushRequestHandler
2025-05-19 13:34:09.720 [main] INFO  com.alibaba.nacos.common.remote.client - [f0b62547-e3b4-458c-8686-c237d94c64ce] Try to connect to server on start up, server: {serverIp = '8.133.246.113', server main port = 8848}
2025-05-19 13:34:09.720 [main] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - grpc client connection server:8.133.246.113 ip,serverPort:9848,grpcTslConfig:{"sslProvider":"OPENSSL","enableTls":false,"mutualAuthEnable":false,"trustAll":false}
2025-05-19 13:34:09.848 [main] INFO  com.alibaba.nacos.common.remote.client - [f0b62547-e3b4-458c-8686-c237d94c64ce] Success to connect to server [8.133.246.113:8848] on start up, connectionId = 1747632849737_139.227.195.203_43256
2025-05-19 13:34:09.848 [main] INFO  com.alibaba.nacos.common.remote.client - [f0b62547-e3b4-458c-8686-c237d94c64ce] Register server push request handler:com.alibaba.nacos.common.remote.client.RpcClient$ConnectResetRequestHandler
2025-05-19 13:34:09.848 [com.alibaba.nacos.client.remote.worker] INFO  com.alibaba.nacos.common.remote.client - [f0b62547-e3b4-458c-8686-c237d94c64ce] Notify connected event to listeners.
2025-05-19 13:34:09.848 [main] INFO  com.alibaba.nacos.common.remote.client - [f0b62547-e3b4-458c-8686-c237d94c64ce] Register server push request handler:com.alibaba.nacos.common.remote.client.RpcClient$$Lambda/0x00000165875262d8
2025-05-19 13:34:09.848 [com.alibaba.nacos.client.remote.worker] INFO  com.alibaba.nacos.client.naming - Grpc connection connect
2025-05-19 13:34:09.849 [main] INFO  com.alibaba.nacos.client.naming - [REGISTER-SERVICE] d750d92e-152f-4055-a641-3bc9dda85a29 registering service bgtech-ai with instance Instance{instanceId='null', ip='192.168.86.8', port=8080, weight=1.0, healthy=true, enabled=true, ephemeral=true, clusterName='DEFAULT', serviceName='null', metadata={IPv6=[2408:820c:7528:8342:b486:9b72:4b72:4bf0], preserved.register.source=SPRING_CLOUD}}
2025-05-19 13:34:09.867 [main] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - nacos registry, DEFAULT_GROUP bgtech-ai 192.168.86.8:8080 register finished
2025-05-19 13:34:09.921 [main] INFO  com.bgpay.bgai.BgaiApplication - Started BgaiApplication in 16.677 seconds (process running for 18.18)
2025-05-19 13:34:09.925 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-19 13:34:09.926 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-19 13:34:09.938 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-19 13:34:09.938 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-19 13:34:09.939 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-19 13:34:09.949 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-19 13:34:09.949 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-19 13:34:09.950 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-19 13:34:09.958 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-19 13:34:09.959 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-19 13:34:09.959 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-19 13:34:09.975 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-19 13:34:09.976 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - ==================== Saga状态机加载报告 ====================
2025-05-19 13:34:09.976 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - Saga状态机配置加载状态: 成功
2025-05-19 13:34:09.976 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 已加载的状态机定义文件数量: 1
2025-05-19 13:34:09.976 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 已加载的状态机定义文件:
2025-05-19 13:34:09.976 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig -  - /E:/project/bgai/target/classes/statelang/bgai-saga-transaction.json
2025-05-19 13:34:09.976 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - Saga解析器状态: CUSTOM_FASTJSON2
2025-05-19 13:34:09.976 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 状态机解析结果: 成功 1 个, 失败 0 个
2025-05-19 13:34:09.976 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - =============================================================
2025-05-19 13:34:09.981 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - nacos.cache.data.init.snapshot = true 
2025-05-19 13:34:09.981 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] common-dev.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-19 13:34:09.990 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=common-dev.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-19 13:34:09.990 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=common-dev.yaml, group=DEFAULT_GROUP
2025-05-19 13:34:09.990 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-19 13:34:09.990 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-19 13:34:09.990 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai.yaml, group=DEFAULT_GROUP
2025-05-19 13:34:09.992 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai-dev.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-19 13:34:09.992 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai-dev.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-19 13:34:09.992 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai-dev.yaml, group=DEFAULT_GROUP
2025-05-19 13:34:09.992 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-19 13:34:09.992 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai, group=DEFAULT_GROUP, cnt=1
2025-05-19 13:34:09.992 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai, group=DEFAULT_GROUP
2025-05-19 13:34:18.333 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - 接收到请求: /api/chatGatWay-internal, 文件=张陇阳的简历.pdf, 问题参数=null, 模型参数=null
2025-05-19 13:34:18.335 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - 请求Content-Type: multipart/form-data;boundary=--------------------------355990493990566844824296
2025-05-19 13:34:18.335 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - 收集到的完整参数: question="null", apiUrl="null", modelName="null", multiTurn=false
2025-05-19 13:34:18.337 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - Processing request for user ID: 689258T
2025-05-19 13:34:18.337 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - Processing file with circuit breaker: fileName=张陇阳的简历.pdf, question=
2025-05-19 13:34:18.339 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.config.ReactiveFileProcessor - Processing file: 张陇阳的简历.pdf, content-type: application/pdf
2025-05-19 13:34:18.346 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - PARAM TRACE [689258T]: 尝试查找匹配配置 - 参数: apiUrl=null, modelName=null
2025-05-19 13:34:18.356 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 查询配置 - userId=689258T
2025-05-19 13:34:18.358 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 排序方式 - 按ID降序
2025-05-19 13:34:18.358 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 限制结果数 - LIMIT 1
2025-05-19 13:34:18.424 [http-nio-8080-exec-2] DEBUG com.bgpay.bgai.mapper.ApiConfigMapper.selectList - ==>  Preparing: SELECT id,api_url,api_key,model_name,user_id FROM api_config WHERE (user_id = ?) ORDER BY id DESC LIMIT 1
2025-05-19 13:34:18.426 [http-nio-8080-exec-2] DEBUG com.bgpay.bgai.mapper.ApiConfigMapper.selectList - ==> Parameters: 689258T(String)
2025-05-19 13:34:18.440 [http-nio-8080-exec-2] DEBUG com.bgpay.bgai.mapper.ApiConfigMapper.selectList - <==      Total: 1
2025-05-19 13:34:18.440 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 查询结果 - 找到配置: id=2, modelName=deepseek-chat
2025-05-19 13:34:18.440 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - PARAM TRACE [689258T]: 找到匹配配置 - apiUrl=https://api.deepseek.com/chat/completions, modelName=deepseek-chat (原始请求: null)
2025-05-19 13:34:18.440 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - API config resolved: url=https://api.deepseek.com/chat/completions, model=deepseek-chat
2025-05-19 13:34:18.465 [Thread-47] INFO  com.bgpay.bgai.config.ReactiveFileProcessor - File processed successfully: size=146595 bytes
2025-05-19 13:34:18.807 [Thread-47] INFO  com.bgpay.bgai.controller.ReactiveChatController - Content processed, length: 6507
2025-05-19 13:34:18.814 [Thread-47] INFO  io.seata.tm.TransactionManagerHolder - TransactionManager Singleton io.seata.tm.DefaultTransactionManager@60611af1
2025-05-19 13:34:18.853 [Thread-47] INFO  io.seata.tm.api.DefaultGlobalTransaction - Begin new global transaction [seata-server:8091:27673667088527361]
2025-05-19 13:34:18.871 [Thread-47] INFO  c.b.bgai.service.impl.TransactionLogServiceImpl - 记录分布式事务开始: XID=seata-server:8091:27673667088527361, 业务=com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive
2025-05-19 13:34:18.878 [Thread-47] DEBUG com.bgpay.bgai.mapper.TransactionLogMapper.insert - ==>  Preparing: INSERT INTO transaction_log ( xid, transaction_name, transaction_mode, status, request_path, source_ip, start_time, user_id, create_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-05-19 13:34:18.882 [Thread-47] DEBUG com.bgpay.bgai.mapper.TransactionLogMapper.insert - ==> Parameters: seata-server:8091:27673667088527361(String), com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive(String), AT(String), ACTIVE(String), (String), (String), 2025-05-19T13:34:18.871718300(LocalDateTime), (String), 2025-05-19T13:34:18.871718300(LocalDateTime)
2025-05-19 13:34:19.327 [Thread-47] DEBUG com.bgpay.bgai.mapper.TransactionLogMapper.insert - <==    Updates: 1
2025-05-19 13:34:19.368 [Thread-47] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:27673667088527361, branchId:27673667088527362, lockKeys:transaction_log:1
2025-05-19 13:34:19.387 [Thread-47] WARN  i.s.c.l.EnhancedServiceLoader$InnerEnhancedServiceLoader - Load [io.seata.rm.datasource.undo.parser.ProtostuffUndoLogParser] class fail: io/protostuff/runtime/IdStrategy
2025-05-19 13:34:19.465 [Thread-47] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:27673667088527361, branchId:27673667088527363, lockKeys:undo_log:1;transaction_log:1
2025-05-19 13:34:19.495 [Thread-47] INFO  c.b.bgai.interceptor.SeataTransactionInterceptor - 开始分布式事务: XID=seata-server:8091:27673667088527361, 方法=com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive
2025-05-19 13:34:19.506 [Thread-47] INFO  org.reflections.Reflections - Processing reactive request: content length=6507, apiUrl=https://api.deepseek.com/chat/completions, modelName=deepseek-chat, userId=689258T, multiTurn=false
2025-05-19 13:34:19.536 [Thread-47] INFO  com.bgpay.bgai.transaction.TransactionCoordinator - Transaction prepared for user 689258T: chatCompletionId=chat-dfb9ca2d-5910-4282-9554-29474caec418
2025-05-19 13:34:19.539 [Thread-47] INFO  org.reflections.Reflections - Generated request JSON with 2PC transaction: {"stream":false,"max_tokens":2000,"temperature":1.0,"messages":[{"role":"system","content":"You are ...
2025-05-19 13:34:19.575 [Thread-47] INFO  c.b.bgai.service.impl.TransactionLogServiceImpl - 记录分布式事务结束: XID=seata-server:8091:27673667088527361, 状态=COMMITTED
2025-05-19 13:34:19.577 [Thread-47] DEBUG c.b.bgai.mapper.TransactionLogMapper.selectList - ==>  Preparing: SELECT id,xid,branch_id,transaction_name,transaction_mode,status,request_path,source_ip,start_time,end_time,user_id,extra_data,create_time,update_time FROM transaction_log WHERE (xid = ?) LIMIT 1
2025-05-19 13:34:19.580 [Thread-47] DEBUG c.b.bgai.mapper.TransactionLogMapper.selectList - ==> Parameters: seata-server:8091:27673667088527361(String)
2025-05-19 13:34:19.589 [Thread-47] DEBUG c.b.bgai.mapper.TransactionLogMapper.selectList - <==      Total: 1
2025-05-19 13:34:19.597 [Thread-47] DEBUG c.b.bgai.mapper.TransactionLogMapper.updateById - ==>  Preparing: UPDATE transaction_log SET xid=?, transaction_name=?, transaction_mode=?, status=?, request_path=?, source_ip=?, start_time=?, end_time=?, user_id=?, extra_data=?, create_time=?, update_time=? WHERE id=?
2025-05-19 13:34:19.606 [Thread-47] DEBUG c.b.bgai.mapper.TransactionLogMapper.updateById - ==> Parameters: seata-server:8091:27673667088527361(String), com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive(String), AT(String), COMMITTED(String), (String), (String), 2025-05-19T13:34:19(LocalDateTime), 2025-05-19T13:34:19.589553200(LocalDateTime), (String), {"duration":73,"result":"success"}(String), 2025-05-19T13:34:19(LocalDateTime), 2025-05-19T13:34:19.589553200(LocalDateTime), 1(Long)
2025-05-19 13:34:19.660 [Thread-47] DEBUG c.b.bgai.mapper.TransactionLogMapper.updateById - <==    Updates: 1
2025-05-19 13:34:19.670 [Thread-47] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:27673667088527361, branchId:27673667088527364, lockKeys:transaction_log:1
2025-05-19 13:34:19.691 [Thread-47] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:27673667088527361, branchId:27673667088527365, lockKeys:undo_log:3;transaction_log:1
2025-05-19 13:34:19.726 [Thread-47] INFO  c.b.bgai.interceptor.SeataTransactionInterceptor - 分布式事务成功完成: XID=seata-server:8091:27673667088527361, 耗时=73ms
2025-05-19 13:34:19.726 [Thread-47] INFO  io.seata.tm.api.DefaultGlobalTransaction - transaction seata-server:8091:27673667088527361 will be commit
2025-05-19 13:34:19.740 [Thread-47] INFO  io.seata.tm.api.DefaultGlobalTransaction - transaction end, xid = seata-server:8091:27673667088527361
2025-05-19 13:34:19.740 [Thread-47] INFO  io.seata.tm.api.DefaultGlobalTransaction - [seata-server:8091:27673667088527361] commit status: Committed
2025-05-19 13:34:20.663 [rpcDispatch_RMROLE_1_1_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:27673667088527361', branchId=27673667088527362, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false,"skipCheckLock":true}'}
2025-05-19 13:34:20.666 [rpcDispatch_RMROLE_1_1_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:27673667088527361 27673667088527362 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false,"skipCheckLock":true}
2025-05-19 13:34:20.672 [rpcDispatch_RMROLE_1_1_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-19 13:34:20.761 [rpcDispatch_RMROLE_1_2_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:27673667088527361', branchId=27673667088527363, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false,"skipCheckLock":true}'}
2025-05-19 13:34:20.762 [rpcDispatch_RMROLE_1_2_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:27673667088527361 27673667088527363 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false,"skipCheckLock":true}
2025-05-19 13:34:20.762 [rpcDispatch_RMROLE_1_2_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-19 13:34:20.773 [rpcDispatch_RMROLE_1_3_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:27673667088527361', branchId=27673667088527364, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false}'}
2025-05-19 13:34:20.773 [rpcDispatch_RMROLE_1_3_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:27673667088527361 27673667088527364 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false}
2025-05-19 13:34:20.773 [rpcDispatch_RMROLE_1_3_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-19 13:34:20.854 [rpcDispatch_RMROLE_1_4_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:27673667088527361', branchId=27673667088527365, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false}'}
2025-05-19 13:34:20.854 [rpcDispatch_RMROLE_1_4_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:27673667088527361 27673667088527365 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false}
2025-05-19 13:34:20.854 [rpcDispatch_RMROLE_1_4_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-19 13:35:05.457 [reactor-http-nio-3] INFO  org.reflections.Reflections - Raw response received, length: 2226
2025-05-19 13:35:05.465 [reactor-http-nio-3] WARN  org.reflections.Reflections - Received different chatCompletionId from response: 2bce6bb9-560a-4230-acc5-e8817b897461 vs prepared: chat-dfb9ca2d-5910-4282-9554-29474caec418
2025-05-19 13:35:05.479 [reactor-http-nio-3] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - ==>  Preparing: INSERT INTO chat_completions ( object, created, model, system_fingerprint, api_key ) VALUES ( ?, ?, ?, ?, ? )
2025-05-19 13:35:05.480 [reactor-http-nio-3] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - ==> Parameters: chat.completion(String), 1747632905478(Long), deepseek-chat(String), 689258T(String), chat-dfb9ca2d-5910-4282-9554-29474caec418(String)
2025-05-19 13:35:05.494 [reactor-http-nio-3] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - <==    Updates: 1
2025-05-19 13:35:05.495 [reactor-http-nio-3] INFO  com.bgpay.bgai.transaction.TransactionCoordinator - Transaction committed for user 689258T: chatCompletionId=chat-dfb9ca2d-5910-4282-9554-29474caec418
2025-05-19 13:35:05.513 [FileWrite-1] INFO  com.bgpay.bgai.service.deepseek.FileWriterService - Successfully wrote content to: \var\data\ai_responses\b724a2c8-3e35-4c89-a2e5-0458734df962.txt
2025-05-19 13:35:05.520 [boundedElastic-1] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - ==>  Preparing: INSERT INTO chat_completions ( object, created, model, system_fingerprint, api_key ) VALUES ( ?, ?, ?, ?, ? )
2025-05-19 13:35:05.520 [boundedElastic-1] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - ==> Parameters: chat.completion(String), 1747632860(Long), deepseek-chat(String), fp_8802369eaa_prod0425fp8(String), chat-dfb9ca2d-5910-4282-9554-29474caec418(String)
2025-05-19 13:35:05.530 [boundedElastic-1] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - <==    Updates: 1
2025-05-19 13:35:05.552 [boundedElastic-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.insert - ==>  Preparing: INSERT INTO usage_info ( chat_completion_id, prompt_tokens, completion_tokens, total_tokens, prompt_tokens_cached, completion_reasoning_tokens, prompt_cache_hit_tokens, prompt_cache_miss_tokens, created_at, model_type ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-05-19 13:35:05.552 [boundedElastic-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.insert - ==> Parameters: chat-dfb9ca2d-5910-4282-9554-29474caec418(String), 3796(Integer), 870(Integer), 4666(Integer), 3776(Integer), 0(Integer), 0(Integer), 20(Integer), 2025-05-19T13:35:05.543865900(LocalDateTime), deepseek-chat(String)
2025-05-19 13:35:05.569 [boundedElastic-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.insert - <==    Updates: 1
2025-05-19 13:35:05.583 [boundedElastic-1] INFO  org.reflections.Reflections - Completion data saved synchronously for chatCompletionId: chat-dfb9ca2d-5910-4282-9554-29474caec418
2025-05-19 13:35:05.588 [boundedElastic-2] INFO  org.reflections.Reflections - 开始发送账单消息，chatCompletionId: chat-dfb9ca2d-5910-4282-9554-29474caec418, userId: 689258T
2025-05-19 13:35:05.658 [boundedElastic-2] INFO  org.reflections.Reflections - 账单消息发送成功，chatCompletionId: chat-dfb9ca2d-5910-4282-9554-29474caec418, userId: 689258T
2025-05-19 13:35:05.662 [boundedElastic-1] INFO  org.reflections.Reflections - Complete processing chain completed: 以下是张陇阳简历的优化建议及分点总结，旨在提升专业性、清晰度和竞争力：

---

### **一、格式与结构优化**
1. **统一排版**  
   - 中英文混排时增加空格（如"Personal resume"后）。  
   - 使用项目符号（•）替代“-”或“·”，保持列表一致性。  
   - 日期格式统一为“YYYY.MM - YYYY.MM”（如2023.04 - 2025.02）。  

2. **模块顺序调整**  
   建议按以下顺序排列：  
   - 基本信息 → 教育背景 → 工作经历（按时间倒序）→ 项目经验（合并到对应公司下）→ 技能特长 → 自我评价。  

3. **精简冗余内容**  
   - 删除重复描述（如“订单&支付系统”在工作经验和项目经验中重复出现）。  
   - 合并相似职责（如“自动化测试框架构建”可整合到技能特长中）。

---

### **二、内容强化建议**
#### **1. 工作经历**  
- **量化成果**  
  - 原句：*“重复扣款发生率降低”*  
    → 修改为：*“通过Redis分布式锁+RocketMQ消息去重，重复扣款率从2%降至0.1%”*  
  - 原句：*“支付接口响应时间缩短”*  
    → 修改为：*“优化数据库连接池与缓存策略，支付接口平均响应时间从1.2s缩短至0.5s”*  

- **技术关键词前置**  
  例：  
  > *“基于K8s+Docker构建弹性测试环境，部署效率提升50%”*  

#### **2. 项目经验**  
- **STAR法则优化**  
  - **Situation**：明确项目背景（如业务规模、痛点）。  
  - **Task**：突出个人角色（如“主导”“独立负责”）。  
  - **Action**：技术细节+工具链（如“使用Spark实时监控支付流水”）。  
  - **Result**：量化影响（如“退款成功率从85%提升至99%”）。  

#### **3. 技能特长**  
- **分层展示**：  
  ```markdown
  - **编程语言**: Java (Spring Boot), Python  
  - **中间件**: RocketMQ/Kafka, Redis, Elasticsearch  
  - **测试工具**: MeterSphere (二次开发), Selenium, Jira  
  - **云原生**: Docker/K8s, AWS EC2  
  ```  

---

### **三、语言表达优化**
1. **避免口语化**  
   - 原句：*“细心从每一个小细节开始”*  
     → 修改为：*“注重细节，追求系统稳定性与用户体验的极致优化”*  

2. **强化动作动词**  
   - 使用“构建”“设计”“优化”“主导”替代“负责”“参与”。  

3. **删除无效信息**  
   - 如“婚姻状况”“身高体重”等与岗位无关内容。

---

### **四、竞争力提升点**
1. **突出金融+新能源复合背景**  
   - 在摘要中强调：*“6年测试开发经验，覆盖金融支付、证券交易及新能源车联网系统，擅长高并发场景质量保障”*  

2. **补充证书/学习**（如有）  
   - 例如：*“ISTQB认证，持续学习云原生架构与性能测试”*  

3. **GitHub/技术博客**  
   - 若开源贡献或技术文章，可添加到联系方式中。

---

### **修改后简历优势**
- **更清晰的职业定位**：聚焦测试开发工程师角色，突出技术深度。  
- **数据驱动说服力**：量化成果提升HR和技术面试官的关注度。  
- **技术前瞻性**：云原生、实时计算等关键词贴合行业趋势。  

建议使用LaTeX或专业模板（如“超级简历”）进一步优化视觉呈现。
2025-05-19 13:35:05.663 [boundedElastic-1] INFO  com.bgpay.bgai.controller.ReactiveChatController - Processed response for user 689258T, content length: 1688
2025-05-19 13:35:46.549 [pool-7-thread-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.selectCount - ==>  Preparing: SELECT COUNT( * ) AS total FROM usage_info WHERE (chat_completion_id = ?)
2025-05-19 13:35:46.550 [pool-7-thread-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.selectCount - ==> Parameters: chat-dfb9ca2d-5910-4282-9554-29474caec418(String)
2025-05-19 13:35:46.557 [pool-7-thread-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.selectCount - <==      Total: 1
2025-05-19 13:35:46.666 [ConsumeMessageThread_billing-consumer-group_1] DEBUG c.bgpay.bgai.mapper.PriceConfigMapper.selectList - ==>  Preparing: SELECT id,model_type,time_period,cache_status,io_type,price,version,effective_time FROM price_config WHERE (model_type = ? AND time_period = ? AND io_type = ? AND effective_time <= ? AND cache_status = ?) ORDER BY effective_time DESC LIMIT 1
2025-05-19 13:35:46.666 [ConsumeMessageThread_billing-consumer-group_1] DEBUG c.bgpay.bgai.mapper.PriceConfigMapper.selectList - ==> Parameters: deepseek-chat(String), standard(String), input(String), 2025-05-19T13:35:46.664620(LocalDateTime), miss(String)
2025-05-19 13:35:46.683 [ConsumeMessageThread_billing-consumer-group_1] DEBUG c.bgpay.bgai.mapper.PriceConfigMapper.selectList - <==      Total: 1
2025-05-19 13:35:46.751 [ConsumeMessageThread_billing-consumer-group_1] DEBUG c.bgpay.bgai.mapper.PriceConfigMapper.selectList - ==>  Preparing: SELECT id,model_type,time_period,cache_status,io_type,price,version,effective_time FROM price_config WHERE (model_type = ? AND time_period = ? AND io_type = ? AND effective_time <= ? AND cache_status IS NULL) ORDER BY effective_time DESC LIMIT 1
2025-05-19 13:35:46.752 [ConsumeMessageThread_billing-consumer-group_1] DEBUG c.bgpay.bgai.mapper.PriceConfigMapper.selectList - ==> Parameters: deepseek-chat(String), standard(String), output(String), 2025-05-19T13:35:46.749991300(LocalDateTime)
2025-05-19 13:35:46.760 [ConsumeMessageThread_billing-consumer-group_1] DEBUG c.bgpay.bgai.mapper.PriceConfigMapper.selectList - <==      Total: 1
2025-05-19 13:35:46.826 [ConsumeMessageThread_billing-consumer-group_1] INFO  c.bgpay.bgai.service.mq.RocketMQBillingServiceImpl - Output price config priceVersion: 1
2025-05-19 13:35:46.829 [ConsumeMessageThread_billing-consumer-group_1] DEBUG com.bgpay.bgai.mapper.UsageRecordMapper.insert - ==>  Preparing: INSERT INTO usage_record ( model_type, chat_completion_id, user_id, input_cost, output_cost, price_version, calculated_at ) VALUES ( ?, ?, ?, ?, ?, ?, ? )
2025-05-19 13:35:46.829 [ConsumeMessageThread_billing-consumer-group_1] DEBUG com.bgpay.bgai.mapper.UsageRecordMapper.insert - ==> Parameters: deepseek-chat(String), chat-dfb9ca2d-5910-4282-9554-29474caec418(String), 689258T(String), 0.0000(BigDecimal), 0.0070(BigDecimal), 1(Integer), 2025-05-19T13:35:46.826510100(LocalDateTime)
2025-05-19 13:35:46.850 [ConsumeMessageThread_billing-consumer-group_1] DEBUG com.bgpay.bgai.mapper.UsageRecordMapper.insert - <==    Updates: 1
2025-05-19 13:35:46.859 [ConsumeMessageThread_billing-consumer-group_1] INFO  c.bgpay.bgai.service.mq.RocketMQBillingServiceImpl - Message consumed: 2408820C75288342B4869B724B724BF0861C36BAF30C5F9CB5940000
2025-05-19 13:39:09.939 [scheduling-1] WARN  com.alibaba.druid.pool.DruidAbstractDataSource - discard long time none received connection. , jdbcUrl : jdbc:mysql://8.133.246.113:3306/deepseek?autoReconnect=false&useUnicode=true&characterEncoding=UTF-8&characterSetResults=UTF-8&zeroDateTimeBehavior=convertToNull&useSSL=false&allowPublicKeyRetrieval=true&useSSL=false, version : 1.2.8, lastPacketReceivedIdleMillis : 203076
2025-05-19 13:39:10.945 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-19 13:39:10.945 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-19 13:39:10.956 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-19 13:39:10.956 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-19 13:39:10.956 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-19 13:39:10.964 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-19 13:42:01.018 [http-nio-8080-exec-6] ERROR o.s.b.a.w.r.error.AbstractErrorWebExceptionHandler - [430191f3]  500 Server Error for HTTP POST "/api/chatGatWay-internal"
org.springframework.data.redis.RedisSystemException: Redis exception
	at org.springframework.data.redis.connection.lettuce.LettuceExceptionConverter.convert(LettuceExceptionConverter.java:72)
	Suppressed: reactor.core.publisher.FluxOnAssembly$OnAssemblyException: 
Assembly trace from producer [reactor.core.publisher.MonoDefer] :
	reactor.core.publisher.Mono.defer(Mono.java:218)
	org.springframework.web.server.handler.DefaultWebFilterChain.filter(DefaultWebFilterChain.java:106)
Error has been observed at the following site(s):
	*______________Mono.defer ⇢ at org.springframework.web.server.handler.DefaultWebFilterChain.filter(DefaultWebFilterChain.java:106)
	|_             checkpoint ⇢ org.springframework.cloud.gateway.filter.WeightCalculatorWebFilter [DefaultWebFilterChain]
	*______________Mono.defer ⇢ at org.springframework.web.server.handler.DefaultWebFilterChain.filter(DefaultWebFilterChain.java:106)
	|_          Mono.doOnEach ⇢ at org.springframework.web.filter.reactive.ServerHttpObservationFilter.filter(ServerHttpObservationFilter.java:109)
	|_        Mono.doOnCancel ⇢ at org.springframework.web.filter.reactive.ServerHttpObservationFilter.filter(ServerHttpObservationFilter.java:119)
	|_      Mono.contextWrite ⇢ at org.springframework.web.filter.reactive.ServerHttpObservationFilter.filter(ServerHttpObservationFilter.java:123)
	*__Mono.transformDeferred ⇢ at org.springframework.web.filter.reactive.ServerHttpObservationFilter.filter(ServerHttpObservationFilter.java:102)
	|_             checkpoint ⇢ org.springframework.web.filter.reactive.ServerHttpObservationFilter [DefaultWebFilterChain]
	*______________Mono.defer ⇢ at org.springframework.web.server.handler.DefaultWebFilterChain.filter(DefaultWebFilterChain.java:106)
	|_     Mono.onErrorResume ⇢ at org.springframework.web.server.handler.ExceptionHandlingWebHandler.handle(ExceptionHandlingWebHandler.java:77)
	|_     Mono.onErrorResume ⇢ at org.springframework.web.server.handler.ExceptionHandlingWebHandler.handle(ExceptionHandlingWebHandler.java:77)
	*______________Mono.error ⇢ at org.springframework.web.server.handler.ExceptionHandlingWebHandler$CheckpointInsertingHandler.handle(ExceptionHandlingWebHandler.java:98)
	|_             checkpoint ⇢ HTTP POST "/api/chatGatWay-internal" [ExceptionHandlingWebHandler]
	*______________Mono.error ⇢ at org.springframework.cloud.gateway.filter.headers.observation.ObservationClosingWebExceptionHandler.handle(ObservationClosingWebExceptionHandler.java:53)
Original Stack Trace:
		at org.springframework.data.redis.connection.lettuce.LettuceExceptionConverter.convert(LettuceExceptionConverter.java:72)
		at org.springframework.data.redis.connection.lettuce.LettuceExceptionConverter.convert(LettuceExceptionConverter.java:41)
		at org.springframework.data.redis.PassThroughExceptionTranslationStrategy.translate(PassThroughExceptionTranslationStrategy.java:40)
		at org.springframework.data.redis.FallbackExceptionTranslationStrategy.translate(FallbackExceptionTranslationStrategy.java:38)
		at org.springframework.data.redis.connection.lettuce.LettuceConnection.convertLettuceAccessException(LettuceConnection.java:256)
		at org.springframework.data.redis.connection.lettuce.LettuceConnection.await(LettuceConnection.java:969)
		at org.springframework.data.redis.connection.lettuce.LettuceConnection.lambda$doInvoke$4(LettuceConnection.java:826)
		at org.springframework.data.redis.connection.lettuce.LettuceInvoker$Synchronizer.invoke(LettuceInvoker.java:665)
		at org.springframework.data.redis.connection.lettuce.LettuceInvoker.just(LettuceInvoker.java:94)
		at org.springframework.data.redis.connection.lettuce.LettuceStringCommands.get(LettuceStringCommands.java:54)
		at org.springframework.data.redis.connection.DefaultedRedisConnection.get(DefaultedRedisConnection.java:284)
		at org.springframework.data.redis.core.DefaultValueOperations$1.inRedis(DefaultValueOperations.java:54)
		at org.springframework.data.redis.core.AbstractOperations$ValueDeserializingRedisCallback.doInRedis(AbstractOperations.java:61)
		at org.springframework.data.redis.core.RedisTemplate.execute(RedisTemplate.java:406)
		at org.springframework.data.redis.core.RedisTemplate.execute(RedisTemplate.java:373)
		at org.springframework.data.redis.core.AbstractOperations.execute(AbstractOperations.java:97)
		at org.springframework.data.redis.core.DefaultValueOperations.get(DefaultValueOperations.java:50)
		at com.bgpay.bgai.service.impl.UserServiceImpl.validateToken(UserServiceImpl.java:210)
		at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
		at java.base/java.lang.reflect.Method.invoke(Method.java:580)
		at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:343)
		at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
		at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
		at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:751)
		at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)
		at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
		at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:751)
		at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:703)
		at com.bgpay.bgai.service.impl.UserServiceImpl$$SpringCGLIB$$0.validateToken(<generated>)
		at com.bgpay.bgai.config.AuthenticationFilter.filter(AuthenticationFilter.java:70)
		at org.springframework.web.server.handler.DefaultWebFilterChain.invokeFilter(DefaultWebFilterChain.java:114)
		at org.springframework.web.server.handler.DefaultWebFilterChain.lambda$filter$0(DefaultWebFilterChain.java:108)
		at reactor.core.publisher.MonoDefer.subscribe(MonoDefer.java:45)
		at reactor.core.publisher.InternalMonoOperator.subscribe(InternalMonoOperator.java:64)
		at reactor.core.publisher.MonoDefer.subscribe(MonoDefer.java:53)
		at reactor.core.publisher.InternalMonoOperator.subscribe(InternalMonoOperator.java:64)
		at reactor.core.publisher.MonoDefer.subscribe(MonoDefer.java:53)
		at reactor.core.publisher.InternalMonoOperator.subscribe(InternalMonoOperator.java:64)
		at reactor.core.publisher.MonoDefer.subscribe(MonoDefer.java:53)
		at reactor.core.publisher.Mono.subscribe(Mono.java:4495)
		at reactor.core.publisher.MonoIgnoreThen$ThenIgnoreMain.subscribeNext(MonoIgnoreThen.java:263)
		at reactor.core.publisher.MonoIgnoreThen.subscribe(MonoIgnoreThen.java:51)
		at reactor.core.publisher.Mono.subscribe(Mono.java:4495)
		at reactor.core.publisher.MonoIgnoreThen$ThenIgnoreMain.subscribeNext(MonoIgnoreThen.java:263)
		at reactor.core.publisher.MonoIgnoreThen.subscribe(MonoIgnoreThen.java:51)
		at reactor.core.publisher.Mono.subscribe(Mono.java:4495)
		at org.springframework.http.server.reactive.ServletHttpHandlerAdapter.service(ServletHttpHandlerAdapter.java:199)
		at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205)
		at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
		at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
		at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
		at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
		at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
		at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
		at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
		at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
		at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
		at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
		at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:340)
		at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
		at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
		at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
		at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744)
		at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
		at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
		at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
		at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
		at java.base/java.lang.Thread.run(Thread.java:1583)
Caused by: io.lettuce.core.RedisException: java.net.SocketException: Connection reset
	at io.lettuce.core.internal.Exceptions.bubble(Exceptions.java:83)
	at io.lettuce.core.internal.Futures.awaitOrCancel(Futures.java:250)
	at io.lettuce.core.LettuceFutures.awaitOrCancel(LettuceFutures.java:74)
	at org.springframework.data.redis.connection.lettuce.LettuceConnection.await(LettuceConnection.java:967)
	at org.springframework.data.redis.connection.lettuce.LettuceConnection.lambda$doInvoke$4(LettuceConnection.java:826)
	at org.springframework.data.redis.connection.lettuce.LettuceInvoker$Synchronizer.invoke(LettuceInvoker.java:665)
	at org.springframework.data.redis.connection.lettuce.LettuceInvoker.just(LettuceInvoker.java:94)
	at org.springframework.data.redis.connection.lettuce.LettuceStringCommands.get(LettuceStringCommands.java:54)
	at org.springframework.data.redis.connection.DefaultedRedisConnection.get(DefaultedRedisConnection.java:284)
	at org.springframework.data.redis.core.DefaultValueOperations$1.inRedis(DefaultValueOperations.java:54)
	at org.springframework.data.redis.core.AbstractOperations$ValueDeserializingRedisCallback.doInRedis(AbstractOperations.java:61)
	at org.springframework.data.redis.core.RedisTemplate.execute(RedisTemplate.java:406)
	at org.springframework.data.redis.core.RedisTemplate.execute(RedisTemplate.java:373)
	at org.springframework.data.redis.core.AbstractOperations.execute(AbstractOperations.java:97)
	at org.springframework.data.redis.core.DefaultValueOperations.get(DefaultValueOperations.java:50)
	at com.bgpay.bgai.service.impl.UserServiceImpl.validateToken(UserServiceImpl.java:210)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:343)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:751)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:751)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:703)
	at com.bgpay.bgai.service.impl.UserServiceImpl$$SpringCGLIB$$0.validateToken(<generated>)
	at com.bgpay.bgai.config.AuthenticationFilter.filter(AuthenticationFilter.java:70)
	at org.springframework.web.server.handler.DefaultWebFilterChain.invokeFilter(DefaultWebFilterChain.java:114)
	at org.springframework.web.server.handler.DefaultWebFilterChain.lambda$filter$0(DefaultWebFilterChain.java:108)
	at reactor.core.publisher.MonoDefer.subscribe(MonoDefer.java:45)
	at reactor.core.publisher.InternalMonoOperator.subscribe(InternalMonoOperator.java:64)
	at reactor.core.publisher.MonoDefer.subscribe(MonoDefer.java:53)
	at reactor.core.publisher.InternalMonoOperator.subscribe(InternalMonoOperator.java:64)
	at reactor.core.publisher.MonoDefer.subscribe(MonoDefer.java:53)
	at reactor.core.publisher.InternalMonoOperator.subscribe(InternalMonoOperator.java:64)
	at reactor.core.publisher.MonoDefer.subscribe(MonoDefer.java:53)
	at reactor.core.publisher.Mono.subscribe(Mono.java:4495)
	at reactor.core.publisher.MonoIgnoreThen$ThenIgnoreMain.subscribeNext(MonoIgnoreThen.java:263)
	at reactor.core.publisher.MonoIgnoreThen.subscribe(MonoIgnoreThen.java:51)
	at reactor.core.publisher.Mono.subscribe(Mono.java:4495)
	at reactor.core.publisher.MonoIgnoreThen$ThenIgnoreMain.subscribeNext(MonoIgnoreThen.java:263)
	at reactor.core.publisher.MonoIgnoreThen.subscribe(MonoIgnoreThen.java:51)
	at reactor.core.publisher.Mono.subscribe(Mono.java:4495)
	at org.springframework.http.server.reactive.ServletHttpHandlerAdapter.service(ServletHttpHandlerAdapter.java:199)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:340)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.base/java.lang.Thread.run(Thread.java:1583)
Caused by: java.net.SocketException: Connection reset
	at java.base/sun.nio.ch.SocketChannelImpl.throwConnectionReset(SocketChannelImpl.java:401)
	at java.base/sun.nio.ch.SocketChannelImpl.read(SocketChannelImpl.java:434)
	at io.netty.buffer.PooledByteBuf.setBytes(PooledByteBuf.java:254)
	at io.netty.buffer.AbstractByteBuf.writeBytes(AbstractByteBuf.java:1132)
	at io.netty.channel.socket.nio.NioSocketChannel.doReadBytes(NioSocketChannel.java:357)
	at io.netty.channel.nio.AbstractNioByteChannel$NioByteUnsafe.read(AbstractNioByteChannel.java:151)
	at io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:788)
	at io.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:724)
	at io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:650)
	at io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:562)
	at io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:997)
	at io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	... 1 common frames omitted
2025-05-19 13:42:23.734 [Thread-1] WARN  c.alibaba.nacos.common.http.HttpClientBeanHolder - [HttpClientBeanHolder] Start destroying common HttpClient
2025-05-19 13:42:23.734 [Thread-7] WARN  com.alibaba.nacos.common.notify.NotifyCenter - [NotifyCenter] Start destroying Publisher
2025-05-19 13:42:23.734 [Thread-7] WARN  com.alibaba.nacos.common.notify.NotifyCenter - [NotifyCenter] Destruction of the end
2025-05-19 13:42:23.735 [Thread-1] WARN  c.alibaba.nacos.common.http.HttpClientBeanHolder - [HttpClientBeanHolder] Destruction of the end
2025-05-19 13:42:23.750 [NettyClientSelector_TMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - channel inactive: [id: 0xfc74db87, L:/192.168.86.8:59406 ! R:/8.133.246.113:8091]
2025-05-19 13:42:23.750 [NettyClientSelector_TMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - return to pool, rm channel:[id: 0xfc74db87, L:/192.168.86.8:59406 ! R:/8.133.246.113:8091]
2025-05-19 13:42:23.750 [NettyClientSelector_TMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - channel valid false,channel:[id: 0xfc74db87, L:/192.168.86.8:59406 ! R:/8.133.246.113:8091]
2025-05-19 13:42:23.750 [NettyClientSelector_TMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - will destroy channel:[id: 0xfc74db87, L:/192.168.86.8:59406 ! R:/8.133.246.113:8091]
2025-05-19 13:42:23.750 [NettyClientSelector_TMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0xfc74db87, L:/192.168.86.8:59406 ! R:/8.133.246.113:8091]) will closed
2025-05-19 13:42:23.750 [NettyClientSelector_TMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0xfc74db87, L:/192.168.86.8:59406 ! R:/8.133.246.113:8091]) will closed
2025-05-19 13:42:23.751 [NettyClientSelector_RMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - channel inactive: [id: 0x4050435c, L:/192.168.86.8:59410 ! R:/8.133.246.113:8091]
2025-05-19 13:42:23.751 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - return to pool, rm channel:[id: 0x4050435c, L:/192.168.86.8:59410 ! R:/8.133.246.113:8091]
2025-05-19 13:42:23.751 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - channel valid false,channel:[id: 0x4050435c, L:/192.168.86.8:59410 ! R:/8.133.246.113:8091]
2025-05-19 13:42:23.751 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - will destroy channel:[id: 0x4050435c, L:/192.168.86.8:59410 ! R:/8.133.246.113:8091]
2025-05-19 13:42:23.751 [NettyClientSelector_RMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0x4050435c, L:/192.168.86.8:59410 ! R:/8.133.246.113:8091]) will closed
2025-05-19 13:42:23.751 [NettyClientSelector_RMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0x4050435c, L:/192.168.86.8:59410 ! R:/8.133.246.113:8091]) will closed
2025-05-19 13:42:23.753 [SpringContextShutdownHook] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - De-registering from Nacos Server now...
2025-05-19 13:42:23.753 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - [DEREGISTER-SERVICE] d750d92e-152f-4055-a641-3bc9dda85a29 deregistering service bgtech-ai with instance: Instance{instanceId='null', ip='192.168.86.8', port=8080, weight=1.0, healthy=true, enabled=true, ephemeral=true, clusterName='DEFAULT', serviceName='null', metadata={}}
2025-05-19 13:42:23.759 [SpringContextShutdownHook] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - De-registration finished.
2025-05-19 13:42:23.760 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.cache.ServiceInfoHolder do shutdown begin
2025-05-19 13:42:23.760 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.backups.FailoverReactor do shutdown begin
2025-05-19 13:42:23.761 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.backups.FailoverReactor do shutdown stop
2025-05-19 13:42:23.761 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.cache.ServiceInfoHolder do shutdown stop
2025-05-19 13:42:23.761 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.NamingClientProxyDelegate do shutdown begin
2025-05-19 13:42:23.761 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServiceInfoUpdateService do shutdown begin
2025-05-19 13:42:23.761 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServiceInfoUpdateService do shutdown stop
2025-05-19 13:42:23.761 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServerListManager do shutdown begin
2025-05-19 13:42:23.761 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Start destroying NacosRestTemplate
2025-05-19 13:42:23.761 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Destruction of the end
2025-05-19 13:42:23.761 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServerListManager do shutdown stop
2025-05-19 13:42:23.761 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.http.NamingHttpClientProxy do shutdown begin
2025-05-19 13:42:23.761 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Start destroying NacosRestTemplate
2025-05-19 13:42:23.761 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Destruction of the end
2025-05-19 13:42:23.761 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.http.NamingHttpClientProxy do shutdown stop
2025-05-19 13:42:23.761 [SpringContextShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Shutdown rpc client, set status to shutdown
2025-05-19 13:42:23.761 [SpringContextShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Shutdown client event executor java.util.concurrent.ScheduledThreadPoolExecutor@682c81b3[Running, pool size = 2, active threads = 2, queued tasks = 0, completed tasks = 0]
2025-05-19 13:42:23.761 [SpringContextShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Close current connection 1747632849737_139.227.195.203_43256
2025-05-19 13:42:23.764 [nacos-grpc-client-executor-8.133.246.113-110] WARN  c.a.nacos.common.remote.client.grpc.GrpcClient - [1747632849737_139.227.195.203_43256]Ignore error event,isRunning:false,isAbandon=false
2025-05-19 13:42:23.766 [SpringContextShutdownHook] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - Shutdown grpc executor java.util.concurrent.ThreadPoolExecutor@182a8bf8[Running, pool size = 4, active threads = 0, queued tasks = 0, completed tasks = 111]
2025-05-19 13:42:23.766 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - Shutdown grpc redo service executor java.util.concurrent.ScheduledThreadPoolExecutor@5a19393[Running, pool size = 1, active threads = 0, queued tasks = 1, completed tasks = 164]
2025-05-19 13:42:23.766 [SpringContextShutdownHook] INFO  c.a.n.client.auth.ram.identify.CredentialWatcher - [null] CredentialWatcher is stopped
2025-05-19 13:42:23.766 [SpringContextShutdownHook] INFO  c.a.n.client.auth.ram.identify.CredentialService - [null] CredentialService is freed
2025-05-19 13:42:23.766 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.NamingClientProxyDelegate do shutdown stop
2025-05-19 13:42:24.348 [com.alibaba.nacos.client.Worker] INFO  c.a.n.client.auth.ram.identify.CredentialWatcher - null No credential found
2025-05-19 13:42:25.804 [SpringContextShutdownHook] DEBUG com.bgpay.bgai.config.AsyncConfig$1 - Shutting down ExecutorService 'blockingExecutor'
2025-05-19 13:42:25.838 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:10909] result: true
2025-05-19 13:42:25.838 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:10911] result: true
2025-05-19 13:42:25.838 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:9876] result: true
2025-05-19 13:42:25.853 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:10911] result: true
2025-05-19 13:42:25.853 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:9876] result: true
2025-05-19 13:42:25.962 [SpringContextShutdownHook] INFO  o.s.orm.jpa.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-05-19 13:42:25.963 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-2} closing ...
2025-05-19 13:42:25.965 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-2} closed
2025-05-19 13:42:25.965 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} closing ...
2025-05-19 13:42:25.966 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} closed
2025-05-19 13:42:32.648 [main] WARN  com.alibaba.nacos.client.logging.NacosLogging - Load Logback Configuration of Nacos fail, message: Could not initialize Logback Nacos logging from classpath:nacos-logback.xml
2025-05-19 13:42:32.649 [main] INFO  com.bgpay.bgai.BgaiApplication - The following 1 profile is active: "dev"
2025-05-19 13:42:33.968 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-05-19 13:42:33.970 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-05-19 13:42:33.993 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 17 ms. Found 0 JPA repository interfaces.
2025-05-19 13:42:34.004 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-05-19 13:42:34.005 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-05-19 13:42:34.016 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 4 ms. Found 0 Redis repository interfaces.
2025-05-19 13:42:34.594 [main] INFO  io.seata.config.ConfigurationFactory - load Configuration from :Spring Configuration
2025-05-19 13:42:34.603 [main] INFO  io.seata.config.ConfigurationFactory - load Configuration from :Spring Configuration
2025-05-19 13:42:34.609 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Initializing Global Transaction Clients ... 
2025-05-19 13:42:34.710 [main] INFO  io.seata.core.rpc.netty.NettyClientBootstrap - NettyClientBootstrap has started
2025-05-19 13:42:34.711 [main] INFO  io.seata.discovery.registry.RegistryFactory - use registry center type: file
2025-05-19 13:42:34.722 [main] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - will connect to 8.133.246.113:8091
2025-05-19 13:42:34.726 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - NettyPool create channel to transactionRole:TMROLE,address:8.133.246.113:8091,msg:< RegisterTMRequest{version='1.7.0', applicationId='bgtech-ai', transactionServiceGroup='bgai-tx-group', extraData='ak=null
digest=bgai-tx-group,192.168.86.8,1747633354724
timestamp=1747633354724
authVersion=V4
vgroup=bgai-tx-group
ip=192.168.86.8
'} >
2025-05-19 13:42:34.879 [main] INFO  io.seata.core.rpc.netty.TmNettyRemotingClient - register TM success. client version:1.7.0, server version:1.8.1-SNAPSHOT,channel:[id: 0xaccabbe3, L:/192.168.86.8:57594 - R:/8.133.246.113:8091]
2025-05-19 13:42:34.889 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - register success, cost 78 ms, version:1.8.1-SNAPSHOT,role:TMROLE,channel:[id: 0xaccabbe3, L:/192.168.86.8:57594 - R:/8.133.246.113:8091]
2025-05-19 13:42:34.890 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Transaction Manager Client is initialized. applicationId[bgtech-ai] txServiceGroup[bgai-tx-group]
2025-05-19 13:42:34.906 [main] INFO  io.seata.rm.datasource.AsyncWorker - Async Commit Buffer Limit: 10000
2025-05-19 13:42:34.907 [main] INFO  io.seata.rm.datasource.xa.ResourceManagerXA - ResourceManagerXA init ...
2025-05-19 13:42:34.914 [main] INFO  io.seata.core.rpc.netty.NettyClientBootstrap - NettyClientBootstrap has started
2025-05-19 13:42:34.914 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Resource Manager is initialized. applicationId[bgtech-ai] txServiceGroup[bgai-tx-group]
2025-05-19 13:42:34.914 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Global Transaction Clients are initialized. 
2025-05-19 13:42:36.043 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat initialized with port(s): 8080 (http)
2025-05-19 13:42:36.055 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - The ["http-nio-8080"] connector has been configured to support HTTP upgrade to [h2c]
2025-05-19 13:42:36.055 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - Initializing ProtocolHandler ["http-nio-8080"]
2025-05-19 13:42:36.057 [main] INFO  org.apache.catalina.core.StandardService - Starting service [Tomcat]
2025-05-19 13:42:36.057 [main] INFO  org.apache.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.15]
2025-05-19 13:42:36.451 [main] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} inited
2025-05-19 13:42:36.708 [main] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - will connect to 8.133.246.113:8091
2025-05-19 13:42:36.708 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - RM will register :jdbc:mysql://8.133.246.113:3306/deepseek
2025-05-19 13:42:36.708 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - NettyPool create channel to transactionRole:RMROLE,address:8.133.246.113:8091,msg:< RegisterRMRequest{resourceIds='jdbc:mysql://8.133.246.113:3306/deepseek', version='1.7.0', applicationId='bgtech-ai', transactionServiceGroup='bgai-tx-group', extraData='null'} >
2025-05-19 13:42:36.741 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - register RM success. client version:1.7.0, server version:1.8.1-SNAPSHOT,channel:[id: 0x0e68029e, L:/192.168.86.8:57615 - R:/8.133.246.113:8091]
2025-05-19 13:42:36.741 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - register success, cost 11 ms, version:1.8.1-SNAPSHOT,role:RMROLE,channel:[id: 0x0e68029e, L:/192.168.86.8:57615 - R:/8.133.246.113:8091]
2025-05-19 13:42:36.743 [main] INFO  i.s.s.a.datasource.SeataAutoDataSourceProxyCreator - Auto proxy data source 'masterDataSource' by 'AT' mode.
2025-05-19 13:42:36.814 [main] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-2} inited
2025-05-19 13:42:36.882 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - will register resourceId:jdbc:mysql://8.133.246.113:3306/deepseek
2025-05-19 13:42:36.884 [main] INFO  i.s.s.a.datasource.SeataAutoDataSourceProxyCreator - Auto proxy data source 'slaveDataSource' by 'AT' mode.
2025-05-19 13:42:36.896 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.rm.AbstractRMHandler - the rm client received response msg [RegisterRMResponse{version='1.8.1-SNAPSHOT', extraData='null', identified=true, resultCode=null, msg='null'}] from tc server.
2025-05-19 13:42:36.908 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - will register resourceId:jdbc:mysql://8.133.246.113:3306/deepseek
2025-05-19 13:42:36.909 [main] INFO  i.s.s.a.datasource.SeataAutoDataSourceProxyCreator - Auto proxy data source 'dynamicDataSource' by 'AT' mode.
2025-05-19 13:42:36.920 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.rm.AbstractRMHandler - the rm client received response msg [RegisterRMResponse{version='1.8.1-SNAPSHOT', extraData='null', identified=true, resultCode=null, msg='null'}] from tc server.
2025-05-19 13:42:37.040 [main] INFO  org.hibernate.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-05-19 13:42:37.089 [main] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.1.7.Final
2025-05-19 13:42:37.402 [main] INFO  SQL dialect - HHH000400: Using dialect: org.hibernate.dialect.MySQL8Dialect
2025-05-19 13:42:37.404 [main] WARN  org.hibernate.orm.deprecation - HHH90000026: MySQL8Dialect has been deprecated; use org.hibernate.dialect.MySQLDialect instead
2025-05-19 13:42:37.678 [main] INFO  o.h.e.t.jta.platform.internal.JtaPlatformInitiator - HHH000490: Using JtaPlatform implementation: [org.hibernate.engine.transaction.jta.platform.internal.NoJtaPlatform]
2025-05-19 13:42:37.689 [main] INFO  o.s.orm.jpa.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-05-19 13:42:38.088 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-19 13:42:38.099 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-19 13:42:38.124 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-19 13:42:38.126 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-19 13:42:38.126 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-19 13:42:38.136 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-19 13:42:38.739 [main] INFO  com.bgpay.bgai.service.impl.UserServiceImpl - 初始化SSO配置: clientId=bgai-client-id, redirectUri=http://localhost:8080/api/auth/callback
2025-05-19 13:42:38.865 [main] INFO  com.bgpay.bgai.controller.AuthController - 初始化认证控制器: clientId=bgai-client-id, redirectUri=http://localhost:8080/api/auth/callback
2025-05-19 13:42:39.467 [main] INFO  o.a.r.s.autoconfigure.RocketMQAutoConfiguration - a producer (billing-producer-group) init on namesrv 8.133.246.113:9876
2025-05-19 13:42:39.728 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Bean [com.bgpay.bgai.service.deepseek.DeepSeekServiceImp$$SpringCGLIB$$0] with name [deepSeekServiceImp] would use interceptor [io.seata.spring.annotation.GlobalTransactionalInterceptor]
2025-05-19 13:42:39.987 [main] WARN  i.s.s.b.a.provider.SpringBootConfigurationProvider - The get method not found for the field 'SeataProperties#accesskey'.
2025-05-19 13:42:39.987 [main] WARN  i.s.s.b.a.provider.SpringBootConfigurationProvider - The get method not found for the field 'SeataProperties#secretkey'.
2025-05-19 13:42:40.006 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 加载到1个Saga状态机定义文件
2025-05-19 13:42:40.140 [main] INFO  com.bgpay.bgai.saga.CustomSagaJsonParser - 开始解析状态机定义: bgai-saga-transaction
2025-05-19 13:42:40.140 [main] INFO  com.bgpay.bgai.saga.CustomSagaJsonParser - 状态机定义解析成功: bgai-saga-transaction
2025-05-19 13:42:40.140 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 成功加载状态机定义: /E:/project/bgai/target/classes/statelang/bgai-saga-transaction.json
2025-05-19 13:42:40.642 [main] INFO  org.redisson.Version - Redisson 3.24.3
2025-05-19 13:42:40.770 [redisson-netty-4-6] INFO  o.r.connection.pool.MasterPubSubConnectionPool - 1 connections initialized for 8.133.246.113/8.133.246.113:6379
2025-05-19 13:42:41.107 [redisson-netty-4-19] INFO  org.redisson.connection.pool.MasterConnectionPool - 24 connections initialized for 8.133.246.113/8.133.246.113:6379
2025-05-19 13:42:41.358 [main] INFO  com.bgpay.bgai.service.mq.MQConsumerService - MQ consumer startup successful [group=billing-consumer-group, topic=BILLING_TOPIC, tag=USER_BILLING]
2025-05-19 13:42:41.596 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Bean [com.bgpay.bgai.service.impl.SeataTransactionService$$SpringCGLIB$$0] with name [seataTransactionService] would use interceptor [io.seata.spring.annotation.GlobalTransactionalInterceptor]
2025-05-19 13:42:41.721 [main] DEBUG com.bgpay.bgai.config.AsyncConfig$1 - Initializing ExecutorService 'blockingExecutor'
2025-05-19 13:42:43.057 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [After]
2025-05-19 13:42:43.058 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Before]
2025-05-19 13:42:43.058 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Between]
2025-05-19 13:42:43.058 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Cookie]
2025-05-19 13:42:43.058 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Header]
2025-05-19 13:42:43.058 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Host]
2025-05-19 13:42:43.058 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Method]
2025-05-19 13:42:43.058 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Path]
2025-05-19 13:42:43.058 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Query]
2025-05-19 13:42:43.058 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [ReadBody]
2025-05-19 13:42:43.058 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [RemoteAddr]
2025-05-19 13:42:43.058 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [XForwardedRemoteAddr]
2025-05-19 13:42:43.058 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Weight]
2025-05-19 13:42:43.058 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [CloudFoundryRouteService]
2025-05-19 13:42:44.388 [main] INFO  o.s.b.actuate.endpoint.web.EndpointLinksResolver - Exposing 1 endpoint(s) beneath base path '/actuator'
2025-05-19 13:42:44.732 [main] WARN  i.s.s.b.a.provider.SpringBootConfigurationProvider - The get method not found for the field 'SeataProperties#accesskey'.
2025-05-19 13:42:44.733 [main] WARN  i.s.s.b.a.provider.SpringBootConfigurationProvider - The get method not found for the field 'SeataProperties#secretkey'.
2025-05-19 13:42:44.747 [main] INFO  io.seata.saga.tm.DefaultSagaTransactionalTemplate - Initializing Global Transaction Clients ... 
2025-05-19 13:42:44.747 [main] INFO  io.seata.saga.tm.DefaultSagaTransactionalTemplate - Transaction Manager Client is initialized. applicationId[bgtech-ai] txServiceGroup[bgai-tx-group]
2025-05-19 13:42:44.747 [main] INFO  io.seata.saga.tm.DefaultSagaTransactionalTemplate - Resource Manager is initialized. applicationId[bgtech-ai] txServiceGroup[bgai-tx-group]
2025-05-19 13:42:44.747 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - will register resourceId:bgtech-ai#bgai-tx-group
2025-05-19 13:42:44.748 [main] INFO  io.seata.saga.tm.DefaultSagaTransactionalTemplate - Global Transaction Clients are initialized. 
2025-05-19 13:42:44.758 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.rm.AbstractRMHandler - the rm client received response msg [RegisterRMResponse{version='1.8.1-SNAPSHOT', extraData='null', identified=true, resultCode=null, msg='null'}] from tc server.
2025-05-19 13:42:46.025 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - Starting ProtocolHandler ["http-nio-8080"]
2025-05-19 13:42:46.039 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat started on port(s): 8080 (http) with context path ''
2025-05-19 13:42:46.050 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from ans.namespace attribute : null
2025-05-19 13:42:46.050 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from ALIBABA_ALIWARE_NAMESPACE attribute :null
2025-05-19 13:42:46.051 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from namespace attribute :null
2025-05-19 13:42:46.060 [main] INFO  c.a.n.p.auth.spi.client.ClientAuthPluginManager - [ClientAuthPluginManager] Load ClientAuthService com.alibaba.nacos.client.auth.impl.NacosClientAuthServiceImpl success.
2025-05-19 13:42:46.060 [main] INFO  c.a.n.p.auth.spi.client.ClientAuthPluginManager - [ClientAuthPluginManager] Load ClientAuthService com.alibaba.nacos.client.auth.ram.RamClientAuthServiceImpl success.
2025-05-19 13:42:46.066 [main] INFO  com.alibaba.nacos.common.remote.client - [RpcClientFactory] create a new rpc client of 1f28af58-1bc8-4cc1-915c-daf56e47d9be
2025-05-19 13:42:46.068 [main] INFO  com.alibaba.nacos.common.remote.client - [1f28af58-1bc8-4cc1-915c-daf56e47d9be] RpcClient init, ServerListFactory = com.alibaba.nacos.client.naming.core.ServerListManager
2025-05-19 13:42:46.068 [main] INFO  com.alibaba.nacos.common.remote.client - [1f28af58-1bc8-4cc1-915c-daf56e47d9be] Registry connection listener to current client:com.alibaba.nacos.client.naming.remote.gprc.redo.NamingGrpcRedoService
2025-05-19 13:42:46.068 [main] INFO  com.alibaba.nacos.common.remote.client - [1f28af58-1bc8-4cc1-915c-daf56e47d9be] Register server push request handler:com.alibaba.nacos.client.naming.remote.gprc.NamingPushRequestHandler
2025-05-19 13:42:46.068 [main] INFO  com.alibaba.nacos.common.remote.client - [1f28af58-1bc8-4cc1-915c-daf56e47d9be] Try to connect to server on start up, server: {serverIp = '8.133.246.113', server main port = 8848}
2025-05-19 13:42:46.069 [main] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - grpc client connection server:8.133.246.113 ip,serverPort:9848,grpcTslConfig:{"sslProvider":"OPENSSL","enableTls":false,"mutualAuthEnable":false,"trustAll":false}
2025-05-19 13:42:46.200 [main] INFO  com.alibaba.nacos.common.remote.client - [1f28af58-1bc8-4cc1-915c-daf56e47d9be] Success to connect to server [8.133.246.113:8848] on start up, connectionId = 1747633366087_139.227.195.203_42199
2025-05-19 13:42:46.200 [main] INFO  com.alibaba.nacos.common.remote.client - [1f28af58-1bc8-4cc1-915c-daf56e47d9be] Register server push request handler:com.alibaba.nacos.common.remote.client.RpcClient$ConnectResetRequestHandler
2025-05-19 13:42:46.200 [main] INFO  com.alibaba.nacos.common.remote.client - [1f28af58-1bc8-4cc1-915c-daf56e47d9be] Register server push request handler:com.alibaba.nacos.common.remote.client.RpcClient$$Lambda/0x000001ffa85255c8
2025-05-19 13:42:46.200 [com.alibaba.nacos.client.remote.worker] INFO  com.alibaba.nacos.common.remote.client - [1f28af58-1bc8-4cc1-915c-daf56e47d9be] Notify connected event to listeners.
2025-05-19 13:42:46.200 [com.alibaba.nacos.client.remote.worker] INFO  com.alibaba.nacos.client.naming - Grpc connection connect
2025-05-19 13:42:46.200 [main] INFO  com.alibaba.nacos.client.naming - [REGISTER-SERVICE] d750d92e-152f-4055-a641-3bc9dda85a29 registering service bgtech-ai with instance Instance{instanceId='null', ip='192.168.86.8', port=8080, weight=1.0, healthy=true, enabled=true, ephemeral=true, clusterName='DEFAULT', serviceName='null', metadata={IPv6=[2408:820c:7528:8342:b486:9b72:4b72:4bf0], preserved.register.source=SPRING_CLOUD}}
2025-05-19 13:42:46.219 [main] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - nacos registry, DEFAULT_GROUP bgtech-ai 192.168.86.8:8080 register finished
2025-05-19 13:42:46.279 [main] INFO  com.bgpay.bgai.BgaiApplication - Started BgaiApplication in 15.652 seconds (process running for 17.196)
2025-05-19 13:42:46.283 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-19 13:42:46.283 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-19 13:42:46.297 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-19 13:42:46.297 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-19 13:42:46.298 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-19 13:42:46.308 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-19 13:42:46.309 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-19 13:42:46.309 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-19 13:42:46.317 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-19 13:42:46.317 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-19 13:42:46.317 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-19 13:42:46.324 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-19 13:42:46.324 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - ==================== Saga状态机加载报告 ====================
2025-05-19 13:42:46.324 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - Saga状态机配置加载状态: 成功
2025-05-19 13:42:46.325 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 已加载的状态机定义文件数量: 1
2025-05-19 13:42:46.325 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 已加载的状态机定义文件:
2025-05-19 13:42:46.325 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig -  - /E:/project/bgai/target/classes/statelang/bgai-saga-transaction.json
2025-05-19 13:42:46.325 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - Saga解析器状态: CUSTOM_FASTJSON2
2025-05-19 13:42:46.325 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 状态机解析结果: 成功 1 个, 失败 0 个
2025-05-19 13:42:46.325 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - =============================================================
2025-05-19 13:42:46.330 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - nacos.cache.data.init.snapshot = true 
2025-05-19 13:42:46.331 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] common-dev.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-19 13:42:46.342 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=common-dev.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-19 13:42:46.342 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=common-dev.yaml, group=DEFAULT_GROUP
2025-05-19 13:42:46.343 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-19 13:42:46.343 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-19 13:42:46.343 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai.yaml, group=DEFAULT_GROUP
2025-05-19 13:42:46.344 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai-dev.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-19 13:42:46.344 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai-dev.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-19 13:42:46.344 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai-dev.yaml, group=DEFAULT_GROUP
2025-05-19 13:42:46.344 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-19 13:42:46.345 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai, group=DEFAULT_GROUP, cnt=1
2025-05-19 13:42:46.345 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai, group=DEFAULT_GROUP
2025-05-19 13:42:58.102 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - 接收到请求: /api/chatGatWay-internal, 文件=新文件 17.txt, 问题参数=null, 模型参数=null
2025-05-19 13:42:58.104 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - 请求Content-Type: multipart/form-data;boundary=--------------------------482915283580857674954948
2025-05-19 13:42:58.104 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - 收集到的完整参数: question="null", apiUrl="null", modelName="null", multiTurn=false
2025-05-19 13:42:58.106 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - Processing request for user ID: 689258T
2025-05-19 13:42:58.106 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - Processing file with circuit breaker: fileName=新文件 17.txt, question=
2025-05-19 13:42:58.108 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.config.ReactiveFileProcessor - Processing file: 新文件 17.txt, content-type: text/plain
2025-05-19 13:42:58.116 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - PARAM TRACE [689258T]: 尝试查找匹配配置 - 参数: apiUrl=null, modelName=null
2025-05-19 13:42:58.126 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 查询配置 - userId=689258T
2025-05-19 13:42:58.127 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 排序方式 - 按ID降序
2025-05-19 13:42:58.127 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 限制结果数 - LIMIT 1
2025-05-19 13:42:58.194 [http-nio-8080-exec-2] DEBUG com.bgpay.bgai.mapper.ApiConfigMapper.selectList - ==>  Preparing: SELECT id,api_url,api_key,model_name,user_id FROM api_config WHERE (user_id = ?) ORDER BY id DESC LIMIT 1
2025-05-19 13:42:58.196 [http-nio-8080-exec-2] DEBUG com.bgpay.bgai.mapper.ApiConfigMapper.selectList - ==> Parameters: 689258T(String)
2025-05-19 13:42:58.204 [http-nio-8080-exec-2] DEBUG com.bgpay.bgai.mapper.ApiConfigMapper.selectList - <==      Total: 1
2025-05-19 13:42:58.204 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 查询结果 - 找到配置: id=2, modelName=deepseek-chat
2025-05-19 13:42:58.204 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - PARAM TRACE [689258T]: 找到匹配配置 - apiUrl=https://api.deepseek.com/chat/completions, modelName=deepseek-chat (原始请求: null)
2025-05-19 13:42:58.204 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - API config resolved: url=https://api.deepseek.com/chat/completions, model=deepseek-chat
2025-05-19 13:42:58.221 [Thread-50] INFO  com.bgpay.bgai.config.ReactiveFileProcessor - File processed successfully: size=6680 bytes
2025-05-19 13:42:58.226 [Thread-50] INFO  com.bgpay.bgai.controller.ReactiveChatController - Content processed, length: 6603
2025-05-19 13:42:58.232 [Thread-50] INFO  io.seata.tm.TransactionManagerHolder - TransactionManager Singleton io.seata.tm.DefaultTransactionManager@2356503e
2025-05-19 13:42:58.246 [Thread-50] INFO  io.seata.tm.api.DefaultGlobalTransaction - Begin new global transaction [seata-server:8091:27673667088527366]
2025-05-19 13:42:58.264 [Thread-50] INFO  c.b.bgai.service.impl.TransactionLogServiceImpl - 记录分布式事务开始: XID=seata-server:8091:27673667088527366, 业务=com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive
2025-05-19 13:42:58.272 [Thread-50] DEBUG com.bgpay.bgai.mapper.TransactionLogMapper.insert - ==>  Preparing: INSERT INTO transaction_log ( xid, transaction_name, transaction_mode, status, request_path, source_ip, start_time, user_id, create_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-05-19 13:42:58.275 [Thread-50] DEBUG com.bgpay.bgai.mapper.TransactionLogMapper.insert - ==> Parameters: seata-server:8091:27673667088527366(String), com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive(String), AT(String), ACTIVE(String), (String), (String), 2025-05-19T13:42:58.265169100(LocalDateTime), (String), 2025-05-19T13:42:58.265169100(LocalDateTime)
2025-05-19 13:42:58.650 [Thread-50] DEBUG com.bgpay.bgai.mapper.TransactionLogMapper.insert - <==    Updates: 1
2025-05-19 13:42:58.667 [Thread-50] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:27673667088527366, branchId:27673667088527367, lockKeys:transaction_log:2
2025-05-19 13:42:58.676 [Thread-50] WARN  i.s.c.l.EnhancedServiceLoader$InnerEnhancedServiceLoader - Load [io.seata.rm.datasource.undo.parser.ProtostuffUndoLogParser] class fail: io/protostuff/runtime/IdStrategy
2025-05-19 13:42:58.758 [Thread-50] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:27673667088527366, branchId:27673667088527368, lockKeys:undo_log:5;transaction_log:2
2025-05-19 13:42:58.792 [Thread-50] INFO  c.b.bgai.interceptor.SeataTransactionInterceptor - 开始分布式事务: XID=seata-server:8091:27673667088527366, 方法=com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive
2025-05-19 13:42:58.803 [Thread-50] INFO  org.reflections.Reflections - Processing reactive request: content length=6603, apiUrl=https://api.deepseek.com/chat/completions, modelName=deepseek-chat, userId=689258T, multiTurn=false
2025-05-19 13:42:58.826 [Thread-50] INFO  com.bgpay.bgai.transaction.TransactionCoordinator - Transaction prepared for user 689258T: chatCompletionId=chat-acd973c0-9b9f-4b46-88fb-fbc8dea4e500
2025-05-19 13:42:58.829 [Thread-50] INFO  org.reflections.Reflections - Generated request JSON with 2PC transaction: {"stream":false,"max_tokens":2000,"temperature":1.0,"messages":[{"role":"system","content":"You are ...
2025-05-19 13:42:58.854 [Thread-50] INFO  c.b.bgai.service.impl.TransactionLogServiceImpl - 记录分布式事务结束: XID=seata-server:8091:27673667088527366, 状态=COMMITTED
2025-05-19 13:42:58.856 [Thread-50] DEBUG c.b.bgai.mapper.TransactionLogMapper.selectList - ==>  Preparing: SELECT id,xid,branch_id,transaction_name,transaction_mode,status,request_path,source_ip,start_time,end_time,user_id,extra_data,create_time,update_time FROM transaction_log WHERE (xid = ?) LIMIT 1
2025-05-19 13:42:58.858 [Thread-50] DEBUG c.b.bgai.mapper.TransactionLogMapper.selectList - ==> Parameters: seata-server:8091:27673667088527366(String)
2025-05-19 13:42:58.866 [Thread-50] DEBUG c.b.bgai.mapper.TransactionLogMapper.selectList - <==      Total: 1
2025-05-19 13:42:58.870 [Thread-50] DEBUG c.b.bgai.mapper.TransactionLogMapper.updateById - ==>  Preparing: UPDATE transaction_log SET xid=?, transaction_name=?, transaction_mode=?, status=?, request_path=?, source_ip=?, start_time=?, end_time=?, user_id=?, extra_data=?, create_time=?, update_time=? WHERE id=?
2025-05-19 13:42:58.877 [Thread-50] DEBUG c.b.bgai.mapper.TransactionLogMapper.updateById - ==> Parameters: seata-server:8091:27673667088527366(String), com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive(String), AT(String), COMMITTED(String), (String), (String), 2025-05-19T13:42:58(LocalDateTime), 2025-05-19T13:42:58.867757900(LocalDateTime), (String), {"duration":56,"result":"success"}(String), 2025-05-19T13:42:58(LocalDateTime), 2025-05-19T13:42:58.867757900(LocalDateTime), 2(Long)
2025-05-19 13:42:58.924 [Thread-50] DEBUG c.b.bgai.mapper.TransactionLogMapper.updateById - <==    Updates: 1
2025-05-19 13:42:58.934 [Thread-50] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:27673667088527366, branchId:27673667088527369, lockKeys:transaction_log:2
2025-05-19 13:42:58.963 [Thread-50] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:27673667088527366, branchId:27673667088527370, lockKeys:undo_log:7;transaction_log:2
2025-05-19 13:42:59.014 [Thread-50] INFO  c.b.bgai.interceptor.SeataTransactionInterceptor - 分布式事务成功完成: XID=seata-server:8091:27673667088527366, 耗时=56ms
2025-05-19 13:42:59.014 [Thread-50] INFO  io.seata.tm.api.DefaultGlobalTransaction - transaction seata-server:8091:27673667088527366 will be commit
2025-05-19 13:42:59.030 [Thread-50] INFO  io.seata.tm.api.DefaultGlobalTransaction - transaction end, xid = seata-server:8091:27673667088527366
2025-05-19 13:42:59.030 [Thread-50] INFO  io.seata.tm.api.DefaultGlobalTransaction - [seata-server:8091:27673667088527366] commit status: Committed
2025-05-19 13:42:59.629 [rpcDispatch_RMROLE_1_1_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:27673667088527366', branchId=27673667088527367, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false,"skipCheckLock":true}'}
2025-05-19 13:42:59.632 [rpcDispatch_RMROLE_1_1_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:27673667088527366 27673667088527367 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false,"skipCheckLock":true}
2025-05-19 13:42:59.634 [rpcDispatch_RMROLE_1_1_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-19 13:42:59.644 [rpcDispatch_RMROLE_1_2_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:27673667088527366', branchId=27673667088527368, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false,"skipCheckLock":true}'}
2025-05-19 13:42:59.644 [rpcDispatch_RMROLE_1_2_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:27673667088527366 27673667088527368 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false,"skipCheckLock":true}
2025-05-19 13:42:59.644 [rpcDispatch_RMROLE_1_2_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-19 13:42:59.653 [rpcDispatch_RMROLE_1_3_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:27673667088527366', branchId=27673667088527369, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false}'}
2025-05-19 13:42:59.654 [rpcDispatch_RMROLE_1_3_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:27673667088527366 27673667088527369 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false}
2025-05-19 13:42:59.654 [rpcDispatch_RMROLE_1_3_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-19 13:42:59.666 [rpcDispatch_RMROLE_1_4_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:27673667088527366', branchId=27673667088527370, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false}'}
2025-05-19 13:42:59.667 [rpcDispatch_RMROLE_1_4_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:27673667088527366 27673667088527370 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false}
2025-05-19 13:42:59.667 [rpcDispatch_RMROLE_1_4_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-19 13:43:43.487 [reactor-http-nio-3] INFO  org.reflections.Reflections - Raw response received, length: 2402
2025-05-19 13:43:43.492 [reactor-http-nio-3] WARN  org.reflections.Reflections - Received different chatCompletionId from response: 1d26d365-8c0d-49a0-81f5-d8f437d37011 vs prepared: chat-acd973c0-9b9f-4b46-88fb-fbc8dea4e500
2025-05-19 13:43:43.506 [reactor-http-nio-3] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - ==>  Preparing: INSERT INTO chat_completions ( object, created, model, system_fingerprint, api_key ) VALUES ( ?, ?, ?, ?, ? )
2025-05-19 13:43:43.507 [reactor-http-nio-3] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - ==> Parameters: chat.completion(String), 1747633423505(Long), deepseek-chat(String), 689258T(String), chat-acd973c0-9b9f-4b46-88fb-fbc8dea4e500(String)
2025-05-19 13:43:43.519 [reactor-http-nio-3] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - <==    Updates: 1
2025-05-19 13:43:43.519 [reactor-http-nio-3] INFO  com.bgpay.bgai.transaction.TransactionCoordinator - Transaction committed for user 689258T: chatCompletionId=chat-acd973c0-9b9f-4b46-88fb-fbc8dea4e500
2025-05-19 13:43:43.539 [FileWrite-1] INFO  com.bgpay.bgai.service.deepseek.FileWriterService - Successfully wrote content to: \var\data\ai_responses\37d2cb5c-0b98-48e1-8e93-af37fac770bd.txt
2025-05-19 13:43:43.549 [boundedElastic-1] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - ==>  Preparing: INSERT INTO chat_completions ( object, created, model, system_fingerprint, api_key ) VALUES ( ?, ?, ?, ?, ? )
2025-05-19 13:43:43.550 [boundedElastic-1] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - ==> Parameters: chat.completion(String), 1747633379(Long), deepseek-chat(String), fp_8802369eaa_prod0425fp8(String), chat-acd973c0-9b9f-4b46-88fb-fbc8dea4e500(String)
2025-05-19 13:43:43.560 [boundedElastic-1] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - <==    Updates: 1
2025-05-19 13:43:43.583 [boundedElastic-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.insert - ==>  Preparing: INSERT INTO usage_info ( chat_completion_id, prompt_tokens, completion_tokens, total_tokens, prompt_tokens_cached, completion_reasoning_tokens, prompt_cache_hit_tokens, prompt_cache_miss_tokens, created_at, model_type ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-05-19 13:43:43.584 [boundedElastic-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.insert - ==> Parameters: chat-acd973c0-9b9f-4b46-88fb-fbc8dea4e500(String), 2209(Integer), 871(Integer), 3080(Integer), 0(Integer), 0(Integer), 0(Integer), 2209(Integer), 2025-05-19T13:43:43.576437800(LocalDateTime), deepseek-chat(String)
2025-05-19 13:43:43.597 [boundedElastic-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.insert - <==    Updates: 1
2025-05-19 13:43:43.618 [boundedElastic-1] INFO  org.reflections.Reflections - Completion data saved synchronously for chatCompletionId: chat-acd973c0-9b9f-4b46-88fb-fbc8dea4e500
2025-05-19 13:43:43.622 [boundedElastic-2] INFO  org.reflections.Reflections - 开始发送账单消息，chatCompletionId: chat-acd973c0-9b9f-4b46-88fb-fbc8dea4e500, userId: 689258T
2025-05-19 13:43:43.665 [boundedElastic-2] INFO  org.reflections.Reflections - 账单消息发送成功，chatCompletionId: chat-acd973c0-9b9f-4b46-88fb-fbc8dea4e500, userId: 689258T
2025-05-19 13:43:43.667 [boundedElastic-1] INFO  org.reflections.Reflections - Complete processing chain completed: 这个配置文件看起来是一个Spring Boot应用的YAML配置文件，包含了许多重要的配置信息。以下是一些关键点的分析：

### 1. **基本配置**
- **应用名称**: `bgai`
- **激活的Profile**: `dev`
- **允许Bean定义覆盖**: `true`
- **会话存储**: 禁用 (`store-type: none`)

### 2. **数据库配置**
- **Redis**:
  - 主机: `8.133.246.113`
  - 端口: `6379`
  - 密码: `5z25u2sk`
  - 数据库: `0`
  
- **MySQL (动态数据源)**:
  - 主从配置 (`master` 和 `slave`)，使用相同的连接信息:
    - URL: `jdbc:mysql://8.133.246.113:3306/deepseek`
    - 用户名: `bgtech`
    - 密码: `Zly689258..`
    - 连接池使用Druid，配置了初始连接数、最小空闲连接、最大连接数等。

### 3. **JPA/Hibernate配置**
- 数据库平台: `MySQL8Dialect`
- DDL策略: `update`
- 显示SQL: `true`
- 关闭Open-in-View: `false`

### 4. **文件上传配置**
- 最大文件大小: `200MB`
- 最大请求大小: `200MB`

### 5. **任务执行配置**
- 线程池:
  - 核心大小: `50`
  - 最大大小: `200`
  - 队列容量: `1000`
  - 线程名前缀: `async-task-`

### 6. **RocketMQ配置**
- Name Server: `8.133.246.113:9876`
- 生产者和消费者组配置，以及超时和重试设置。

### 7. **Resilience4j配置**
- 熔断器 (`circuitbreaker`)、限时器 (`timelimiter`) 和重试 (`retry`) 的详细配置，用于处理服务调用的容错。

### 8. **其他配置**
- **Tesseract OCR**: 数据路径 `/usr/share/tesseract-ocr`
- **MyBatis-Plus**: 开启下划线转驼峰，日志实现为StdOutImpl。
- **Flink Job Manager**: 主机 `8.133.246.113`，端口 `8081`
- **文件输出路径**: `/var/data/ai_responses`
- **日志配置**: JSON格式，路径 `/var/data/ai_responses/application.log`

### 9. **安全配置**
- **SSO OAuth2**:
  - Client ID: `bgai-client-id`
  - Client Secret: `bgai-client-secret`
  - 各种URL配置（授权、令牌、用户信息、登出）
- **API密钥**:
  - 两个客户端密钥配置。

### 潜在的安全风险
1. **敏感信息暴露**:
   - Redis密码 (`5z25u2sk`) 和MySQL密码 (`Zly689258..`) 直接写在配置文件中，建议使用环境变量或配置中心加密存储。
   - RocketMQ、MySQL、Redis等服务的IP地址和端口暴露，如果是生产环境，建议使用内网地址或VPN。

2. **数据库连接**:
   - 主从配置使用了相同的连接信息，可能是笔误或配置错误，通常主从数据库应该有不同的连接信息。

3. **SSL配置**:
   - MySQL连接URL中 `useSSL=false`，建议在生产环境中启用SSL加密连接。

### 建议
1. **使用配置加密**:
   - 使用Spring Cloud Config或Vault等工具加密敏感信息。
   
2. **环境隔离**:
   - 将开发、测试、生产环境的配置分开，避免敏感信息泄露。

3. **日志安全**:
   - 确保日志文件不会记录敏感信息（如密码、密钥等）。

如果需要进一步优化或调整某些配置，可以提供更具体的需求或问题。
2025-05-19 13:43:43.667 [boundedElastic-1] INFO  com.bgpay.bgai.controller.ReactiveChatController - Processed response for user 689258T, content length: 1868
2025-05-19 13:44:16.567 [pool-7-thread-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.selectCount - ==>  Preparing: SELECT COUNT( * ) AS total FROM usage_info WHERE (chat_completion_id = ?)
2025-05-19 13:44:16.567 [pool-7-thread-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.selectCount - ==> Parameters: chat-acd973c0-9b9f-4b46-88fb-fbc8dea4e500(String)
2025-05-19 13:44:16.572 [pool-7-thread-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.selectCount - <==      Total: 1
2025-05-19 13:44:16.744 [ConsumeMessageThread_billing-consumer-group_1] INFO  c.bgpay.bgai.service.mq.RocketMQBillingServiceImpl - Output price config priceVersion: 1
2025-05-19 13:44:16.756 [ConsumeMessageThread_billing-consumer-group_1] DEBUG com.bgpay.bgai.mapper.UsageRecordMapper.insert - ==>  Preparing: INSERT INTO usage_record ( model_type, chat_completion_id, user_id, input_cost, output_cost, price_version, calculated_at ) VALUES ( ?, ?, ?, ?, ?, ?, ? )
2025-05-19 13:44:16.757 [ConsumeMessageThread_billing-consumer-group_1] DEBUG com.bgpay.bgai.mapper.UsageRecordMapper.insert - ==> Parameters: deepseek-chat(String), chat-acd973c0-9b9f-4b46-88fb-fbc8dea4e500(String), 689258T(String), 0.0044(BigDecimal), 0.0070(BigDecimal), 1(Integer), 2025-05-19T13:44:16.744294300(LocalDateTime)
2025-05-19 13:44:16.783 [ConsumeMessageThread_billing-consumer-group_1] DEBUG com.bgpay.bgai.mapper.UsageRecordMapper.insert - <==    Updates: 1
2025-05-19 13:44:16.796 [ConsumeMessageThread_billing-consumer-group_1] INFO  c.bgpay.bgai.service.mq.RocketMQBillingServiceImpl - Message consumed: 2408820C75288342B4869B724B724BF0740436BAF30C5FA49D210000
2025-05-19 13:44:53.790 [Thread-7] WARN  com.alibaba.nacos.common.notify.NotifyCenter - [NotifyCenter] Start destroying Publisher
2025-05-19 13:44:53.790 [Thread-1] WARN  c.alibaba.nacos.common.http.HttpClientBeanHolder - [HttpClientBeanHolder] Start destroying common HttpClient
2025-05-19 13:44:53.790 [Thread-7] WARN  com.alibaba.nacos.common.notify.NotifyCenter - [NotifyCenter] Destruction of the end
2025-05-19 13:44:53.790 [Thread-1] WARN  c.alibaba.nacos.common.http.HttpClientBeanHolder - [HttpClientBeanHolder] Destruction of the end
2025-05-19 13:44:53.806 [NettyClientSelector_TMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - channel inactive: [id: 0xaccabbe3, L:/192.168.86.8:57594 ! R:/8.133.246.113:8091]
2025-05-19 13:44:53.806 [NettyClientSelector_TMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - return to pool, rm channel:[id: 0xaccabbe3, L:/192.168.86.8:57594 ! R:/8.133.246.113:8091]
2025-05-19 13:44:53.807 [NettyClientSelector_TMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - channel valid false,channel:[id: 0xaccabbe3, L:/192.168.86.8:57594 ! R:/8.133.246.113:8091]
2025-05-19 13:44:53.807 [NettyClientSelector_TMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - will destroy channel:[id: 0xaccabbe3, L:/192.168.86.8:57594 ! R:/8.133.246.113:8091]
2025-05-19 13:44:53.807 [NettyClientSelector_TMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0xaccabbe3, L:/192.168.86.8:57594 ! R:/8.133.246.113:8091]) will closed
2025-05-19 13:44:53.807 [NettyClientSelector_TMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0xaccabbe3, L:/192.168.86.8:57594 ! R:/8.133.246.113:8091]) will closed
2025-05-19 13:44:53.807 [NettyClientSelector_RMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - channel inactive: [id: 0x0e68029e, L:/192.168.86.8:57615 ! R:/8.133.246.113:8091]
2025-05-19 13:44:53.807 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - return to pool, rm channel:[id: 0x0e68029e, L:/192.168.86.8:57615 ! R:/8.133.246.113:8091]
2025-05-19 13:44:53.808 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - channel valid false,channel:[id: 0x0e68029e, L:/192.168.86.8:57615 ! R:/8.133.246.113:8091]
2025-05-19 13:44:53.808 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - will destroy channel:[id: 0x0e68029e, L:/192.168.86.8:57615 ! R:/8.133.246.113:8091]
2025-05-19 13:44:53.808 [NettyClientSelector_RMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0x0e68029e, L:/192.168.86.8:57615 ! R:/8.133.246.113:8091]) will closed
2025-05-19 13:44:53.808 [NettyClientSelector_RMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0x0e68029e, L:/192.168.86.8:57615 ! R:/8.133.246.113:8091]) will closed
2025-05-19 13:44:53.809 [SpringContextShutdownHook] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - De-registering from Nacos Server now...
2025-05-19 13:44:53.810 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - [DEREGISTER-SERVICE] d750d92e-152f-4055-a641-3bc9dda85a29 deregistering service bgtech-ai with instance: Instance{instanceId='null', ip='192.168.86.8', port=8080, weight=1.0, healthy=true, enabled=true, ephemeral=true, clusterName='DEFAULT', serviceName='null', metadata={}}
2025-05-19 13:44:53.819 [SpringContextShutdownHook] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - De-registration finished.
2025-05-19 13:44:53.820 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.cache.ServiceInfoHolder do shutdown begin
2025-05-19 13:44:53.820 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.backups.FailoverReactor do shutdown begin
2025-05-19 13:44:53.820 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.backups.FailoverReactor do shutdown stop
2025-05-19 13:44:53.820 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.cache.ServiceInfoHolder do shutdown stop
2025-05-19 13:44:53.820 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.NamingClientProxyDelegate do shutdown begin
2025-05-19 13:44:53.820 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServiceInfoUpdateService do shutdown begin
2025-05-19 13:44:53.821 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServiceInfoUpdateService do shutdown stop
2025-05-19 13:44:53.821 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServerListManager do shutdown begin
2025-05-19 13:44:53.821 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Start destroying NacosRestTemplate
2025-05-19 13:44:53.821 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Destruction of the end
2025-05-19 13:44:53.821 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServerListManager do shutdown stop
2025-05-19 13:44:53.821 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.http.NamingHttpClientProxy do shutdown begin
2025-05-19 13:44:53.821 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Start destroying NacosRestTemplate
2025-05-19 13:44:53.821 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Destruction of the end
2025-05-19 13:44:53.821 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.http.NamingHttpClientProxy do shutdown stop
2025-05-19 13:44:53.821 [SpringContextShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Shutdown rpc client, set status to shutdown
2025-05-19 13:44:53.821 [SpringContextShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Shutdown client event executor java.util.concurrent.ScheduledThreadPoolExecutor@3a4a86a9[Running, pool size = 2, active threads = 2, queued tasks = 0, completed tasks = 0]
2025-05-19 13:44:53.821 [SpringContextShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Close current connection 1747633366087_139.227.195.203_42199
2025-05-19 13:44:53.824 [nacos-grpc-client-executor-8.133.246.113-37] WARN  c.a.nacos.common.remote.client.grpc.GrpcClient - [1747633366087_139.227.195.203_42199]Ignore error event,isRunning:false,isAbandon=false
2025-05-19 13:44:53.826 [SpringContextShutdownHook] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - Shutdown grpc executor java.util.concurrent.ThreadPoolExecutor@68af530a[Running, pool size = 5, active threads = 0, queued tasks = 0, completed tasks = 38]
2025-05-19 13:44:53.826 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - Shutdown grpc redo service executor java.util.concurrent.ScheduledThreadPoolExecutor@41c9d35f[Running, pool size = 1, active threads = 0, queued tasks = 1, completed tasks = 42]
2025-05-19 13:44:53.826 [SpringContextShutdownHook] INFO  c.a.n.client.auth.ram.identify.CredentialWatcher - [null] CredentialWatcher is stopped
2025-05-19 13:44:53.826 [SpringContextShutdownHook] INFO  c.a.n.client.auth.ram.identify.CredentialService - [null] CredentialService is freed
2025-05-19 13:44:53.826 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.NamingClientProxyDelegate do shutdown stop
2025-05-19 13:44:55.856 [SpringContextShutdownHook] DEBUG com.bgpay.bgai.config.AsyncConfig$1 - Shutting down ExecutorService 'blockingExecutor'
2025-05-19 13:44:55.890 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:10909] result: true
2025-05-19 13:44:55.890 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:9876] result: true
2025-05-19 13:44:55.890 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:10911] result: true
2025-05-19 13:44:55.903 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:10911] result: true
2025-05-19 13:44:55.903 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:9876] result: true
2025-05-19 13:44:56.018 [SpringContextShutdownHook] INFO  o.s.orm.jpa.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-05-19 13:44:56.019 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-2} closing ...
2025-05-19 13:44:56.025 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-2} closed
2025-05-19 13:44:56.025 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} closing ...
2025-05-19 13:44:56.025 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} closed
2025-05-19 13:55:33.351 [main] WARN  com.alibaba.nacos.client.logging.NacosLogging - Load Logback Configuration of Nacos fail, message: Could not initialize Logback Nacos logging from classpath:nacos-logback.xml
2025-05-19 13:55:33.352 [main] INFO  com.bgpay.bgai.BgaiApplication - The following 1 profile is active: "dev"
2025-05-19 13:55:34.677 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-05-19 13:55:34.679 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-05-19 13:55:34.703 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 17 ms. Found 0 JPA repository interfaces.
2025-05-19 13:55:34.715 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-05-19 13:55:34.716 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-05-19 13:55:34.727 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 4 ms. Found 0 Redis repository interfaces.
2025-05-19 13:55:35.348 [main] INFO  io.seata.config.ConfigurationFactory - load Configuration from :Spring Configuration
2025-05-19 13:55:35.356 [main] INFO  io.seata.config.ConfigurationFactory - load Configuration from :Spring Configuration
2025-05-19 13:55:35.363 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Initializing Global Transaction Clients ... 
2025-05-19 13:55:35.466 [main] INFO  io.seata.core.rpc.netty.NettyClientBootstrap - NettyClientBootstrap has started
2025-05-19 13:55:35.466 [main] INFO  io.seata.discovery.registry.RegistryFactory - use registry center type: file
2025-05-19 13:55:35.476 [main] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - will connect to 8.133.246.113:8091
2025-05-19 13:55:35.480 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - NettyPool create channel to transactionRole:TMROLE,address:8.133.246.113:8091,msg:< RegisterTMRequest{version='1.7.0', applicationId='bgtech-ai', transactionServiceGroup='bgai-tx-group', extraData='ak=null
digest=bgai-tx-group,192.168.86.8,1747634135479
timestamp=1747634135479
authVersion=V4
vgroup=bgai-tx-group
ip=192.168.86.8
'} >
2025-05-19 13:55:35.629 [main] INFO  io.seata.core.rpc.netty.TmNettyRemotingClient - register TM success. client version:1.7.0, server version:1.8.1-SNAPSHOT,channel:[id: 0x191ab4bf, L:/192.168.86.8:51367 - R:/8.133.246.113:8091]
2025-05-19 13:55:35.636 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - register success, cost 82 ms, version:1.8.1-SNAPSHOT,role:TMROLE,channel:[id: 0x191ab4bf, L:/192.168.86.8:51367 - R:/8.133.246.113:8091]
2025-05-19 13:55:35.637 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Transaction Manager Client is initialized. applicationId[bgtech-ai] txServiceGroup[bgai-tx-group]
2025-05-19 13:55:35.654 [main] INFO  io.seata.rm.datasource.AsyncWorker - Async Commit Buffer Limit: 10000
2025-05-19 13:55:35.655 [main] INFO  io.seata.rm.datasource.xa.ResourceManagerXA - ResourceManagerXA init ...
2025-05-19 13:55:35.663 [main] INFO  io.seata.core.rpc.netty.NettyClientBootstrap - NettyClientBootstrap has started
2025-05-19 13:55:35.663 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Resource Manager is initialized. applicationId[bgtech-ai] txServiceGroup[bgai-tx-group]
2025-05-19 13:55:35.663 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Global Transaction Clients are initialized. 
2025-05-19 13:55:36.739 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat initialized with port(s): 8080 (http)
2025-05-19 13:55:36.749 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - The ["http-nio-8080"] connector has been configured to support HTTP upgrade to [h2c]
2025-05-19 13:55:36.749 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - Initializing ProtocolHandler ["http-nio-8080"]
2025-05-19 13:55:36.751 [main] INFO  org.apache.catalina.core.StandardService - Starting service [Tomcat]
2025-05-19 13:55:36.751 [main] INFO  org.apache.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.15]
2025-05-19 13:55:37.131 [main] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} inited
2025-05-19 13:55:37.370 [main] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - will connect to 8.133.246.113:8091
2025-05-19 13:55:37.370 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - RM will register :jdbc:mysql://8.133.246.113:3306/deepseek
2025-05-19 13:55:37.370 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - NettyPool create channel to transactionRole:RMROLE,address:8.133.246.113:8091,msg:< RegisterRMRequest{resourceIds='jdbc:mysql://8.133.246.113:3306/deepseek', version='1.7.0', applicationId='bgtech-ai', transactionServiceGroup='bgai-tx-group', extraData='null'} >
2025-05-19 13:55:37.387 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - register RM success. client version:1.7.0, server version:1.8.1-SNAPSHOT,channel:[id: 0x100060c9, L:/192.168.86.8:51372 - R:/8.133.246.113:8091]
2025-05-19 13:55:37.387 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - register success, cost 10 ms, version:1.8.1-SNAPSHOT,role:RMROLE,channel:[id: 0x100060c9, L:/192.168.86.8:51372 - R:/8.133.246.113:8091]
2025-05-19 13:55:37.389 [main] INFO  i.s.s.a.datasource.SeataAutoDataSourceProxyCreator - Auto proxy data source 'masterDataSource' by 'AT' mode.
2025-05-19 13:55:37.453 [main] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-2} inited
2025-05-19 13:55:37.522 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - will register resourceId:jdbc:mysql://8.133.246.113:3306/deepseek
2025-05-19 13:55:37.523 [main] INFO  i.s.s.a.datasource.SeataAutoDataSourceProxyCreator - Auto proxy data source 'slaveDataSource' by 'AT' mode.
2025-05-19 13:55:37.531 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.rm.AbstractRMHandler - the rm client received response msg [RegisterRMResponse{version='1.8.1-SNAPSHOT', extraData='null', identified=true, resultCode=null, msg='null'}] from tc server.
2025-05-19 13:55:37.549 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - will register resourceId:jdbc:mysql://8.133.246.113:3306/deepseek
2025-05-19 13:55:37.550 [main] INFO  i.s.s.a.datasource.SeataAutoDataSourceProxyCreator - Auto proxy data source 'dynamicDataSource' by 'AT' mode.
2025-05-19 13:55:37.572 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.rm.AbstractRMHandler - the rm client received response msg [RegisterRMResponse{version='1.8.1-SNAPSHOT', extraData='null', identified=true, resultCode=null, msg='null'}] from tc server.
2025-05-19 13:55:37.709 [main] INFO  org.hibernate.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-05-19 13:55:37.792 [main] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.1.7.Final
2025-05-19 13:55:38.120 [main] INFO  SQL dialect - HHH000400: Using dialect: org.hibernate.dialect.MySQL8Dialect
2025-05-19 13:55:38.122 [main] WARN  org.hibernate.orm.deprecation - HHH90000026: MySQL8Dialect has been deprecated; use org.hibernate.dialect.MySQLDialect instead
2025-05-19 13:55:38.392 [main] INFO  o.h.e.t.jta.platform.internal.JtaPlatformInitiator - HHH000490: Using JtaPlatform implementation: [org.hibernate.engine.transaction.jta.platform.internal.NoJtaPlatform]
2025-05-19 13:55:38.402 [main] INFO  o.s.orm.jpa.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-05-19 13:55:38.763 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-19 13:55:38.774 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-19 13:55:38.800 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-19 13:55:38.802 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-19 13:55:38.802 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-19 13:55:38.813 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-19 13:55:39.434 [main] INFO  com.bgpay.bgai.service.impl.UserServiceImpl - 初始化SSO配置: clientId=bgai-client-id, redirectUri=http://localhost:8080/api/auth/callback
2025-05-19 13:55:39.557 [main] INFO  com.bgpay.bgai.controller.AuthController - 初始化认证控制器: clientId=bgai-client-id, redirectUri=http://localhost:8080/api/auth/callback
2025-05-19 13:55:40.134 [main] INFO  o.a.r.s.autoconfigure.RocketMQAutoConfiguration - a producer (billing-producer-group) init on namesrv 8.133.246.113:9876
2025-05-19 13:55:40.426 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Bean [com.bgpay.bgai.service.deepseek.DeepSeekServiceImp$$SpringCGLIB$$0] with name [deepSeekServiceImp] would use interceptor [io.seata.spring.annotation.GlobalTransactionalInterceptor]
2025-05-19 13:55:40.736 [main] WARN  i.s.s.b.a.provider.SpringBootConfigurationProvider - The get method not found for the field 'SeataProperties#accesskey'.
2025-05-19 13:55:40.736 [main] WARN  i.s.s.b.a.provider.SpringBootConfigurationProvider - The get method not found for the field 'SeataProperties#secretkey'.
2025-05-19 13:55:40.747 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 加载到1个Saga状态机定义文件
2025-05-19 13:55:40.881 [main] INFO  com.bgpay.bgai.saga.CustomSagaJsonParser - 开始解析状态机定义: bgai-saga-transaction
2025-05-19 13:55:40.881 [main] INFO  com.bgpay.bgai.saga.CustomSagaJsonParser - 状态机定义解析成功: bgai-saga-transaction
2025-05-19 13:55:40.881 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 成功加载状态机定义: /E:/project/bgai/target/classes/statelang/bgai-saga-transaction.json
2025-05-19 13:55:41.362 [main] INFO  org.redisson.Version - Redisson 3.24.3
2025-05-19 13:55:41.490 [redisson-netty-4-6] INFO  o.r.connection.pool.MasterPubSubConnectionPool - 1 connections initialized for 8.133.246.113/8.133.246.113:6379
2025-05-19 13:55:41.936 [redisson-netty-4-19] INFO  org.redisson.connection.pool.MasterConnectionPool - 24 connections initialized for 8.133.246.113/8.133.246.113:6379
2025-05-19 13:55:42.185 [main] INFO  com.bgpay.bgai.service.mq.MQConsumerService - MQ consumer startup successful [group=billing-consumer-group, topic=BILLING_TOPIC, tag=USER_BILLING]
2025-05-19 13:55:42.360 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Bean [com.bgpay.bgai.service.impl.SeataTransactionService$$SpringCGLIB$$0] with name [seataTransactionService] would use interceptor [io.seata.spring.annotation.GlobalTransactionalInterceptor]
2025-05-19 13:55:42.502 [main] DEBUG com.bgpay.bgai.config.AsyncConfig$1 - Initializing ExecutorService 'blockingExecutor'
2025-05-19 13:55:43.806 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [After]
2025-05-19 13:55:43.807 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Before]
2025-05-19 13:55:43.807 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Between]
2025-05-19 13:55:43.807 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Cookie]
2025-05-19 13:55:43.807 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Header]
2025-05-19 13:55:43.807 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Host]
2025-05-19 13:55:43.807 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Method]
2025-05-19 13:55:43.807 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Path]
2025-05-19 13:55:43.807 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Query]
2025-05-19 13:55:43.807 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [ReadBody]
2025-05-19 13:55:43.807 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [RemoteAddr]
2025-05-19 13:55:43.807 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [XForwardedRemoteAddr]
2025-05-19 13:55:43.807 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Weight]
2025-05-19 13:55:43.807 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [CloudFoundryRouteService]
2025-05-19 13:55:45.136 [main] INFO  o.s.b.actuate.endpoint.web.EndpointLinksResolver - Exposing 1 endpoint(s) beneath base path '/actuator'
2025-05-19 13:55:45.461 [main] WARN  i.s.s.b.a.provider.SpringBootConfigurationProvider - The get method not found for the field 'SeataProperties#accesskey'.
2025-05-19 13:55:45.461 [main] WARN  i.s.s.b.a.provider.SpringBootConfigurationProvider - The get method not found for the field 'SeataProperties#secretkey'.
2025-05-19 13:55:45.486 [main] INFO  io.seata.saga.tm.DefaultSagaTransactionalTemplate - Initializing Global Transaction Clients ... 
2025-05-19 13:55:45.486 [main] INFO  io.seata.saga.tm.DefaultSagaTransactionalTemplate - Transaction Manager Client is initialized. applicationId[bgtech-ai] txServiceGroup[bgai-tx-group]
2025-05-19 13:55:45.486 [main] INFO  io.seata.saga.tm.DefaultSagaTransactionalTemplate - Resource Manager is initialized. applicationId[bgtech-ai] txServiceGroup[bgai-tx-group]
2025-05-19 13:55:45.487 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - will register resourceId:bgtech-ai#bgai-tx-group
2025-05-19 13:55:45.487 [main] INFO  io.seata.saga.tm.DefaultSagaTransactionalTemplate - Global Transaction Clients are initialized. 
2025-05-19 13:55:45.496 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.rm.AbstractRMHandler - the rm client received response msg [RegisterRMResponse{version='1.8.1-SNAPSHOT', extraData='null', identified=true, resultCode=null, msg='null'}] from tc server.
2025-05-19 13:55:46.725 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - Starting ProtocolHandler ["http-nio-8080"]
2025-05-19 13:55:46.741 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat started on port(s): 8080 (http) with context path ''
2025-05-19 13:55:46.753 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from ans.namespace attribute : null
2025-05-19 13:55:46.753 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from ALIBABA_ALIWARE_NAMESPACE attribute :null
2025-05-19 13:55:46.754 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from namespace attribute :null
2025-05-19 13:55:46.763 [main] INFO  c.a.n.p.auth.spi.client.ClientAuthPluginManager - [ClientAuthPluginManager] Load ClientAuthService com.alibaba.nacos.client.auth.impl.NacosClientAuthServiceImpl success.
2025-05-19 13:55:46.763 [main] INFO  c.a.n.p.auth.spi.client.ClientAuthPluginManager - [ClientAuthPluginManager] Load ClientAuthService com.alibaba.nacos.client.auth.ram.RamClientAuthServiceImpl success.
2025-05-19 13:55:46.768 [main] INFO  com.alibaba.nacos.common.remote.client - [RpcClientFactory] create a new rpc client of 635c48bc-c4ec-4f06-a76c-06177b81ab60
2025-05-19 13:55:46.770 [main] INFO  com.alibaba.nacos.common.remote.client - [635c48bc-c4ec-4f06-a76c-06177b81ab60] RpcClient init, ServerListFactory = com.alibaba.nacos.client.naming.core.ServerListManager
2025-05-19 13:55:46.770 [main] INFO  com.alibaba.nacos.common.remote.client - [635c48bc-c4ec-4f06-a76c-06177b81ab60] Registry connection listener to current client:com.alibaba.nacos.client.naming.remote.gprc.redo.NamingGrpcRedoService
2025-05-19 13:55:46.771 [main] INFO  com.alibaba.nacos.common.remote.client - [635c48bc-c4ec-4f06-a76c-06177b81ab60] Register server push request handler:com.alibaba.nacos.client.naming.remote.gprc.NamingPushRequestHandler
2025-05-19 13:55:46.771 [main] INFO  com.alibaba.nacos.common.remote.client - [635c48bc-c4ec-4f06-a76c-06177b81ab60] Try to connect to server on start up, server: {serverIp = '8.133.246.113', server main port = 8848}
2025-05-19 13:55:46.771 [main] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - grpc client connection server:8.133.246.113 ip,serverPort:9848,grpcTslConfig:{"sslProvider":"OPENSSL","enableTls":false,"mutualAuthEnable":false,"trustAll":false}
2025-05-19 13:55:46.901 [main] INFO  com.alibaba.nacos.common.remote.client - [635c48bc-c4ec-4f06-a76c-06177b81ab60] Success to connect to server [8.133.246.113:8848] on start up, connectionId = 1747634146790_139.227.195.203_43808
2025-05-19 13:55:46.901 [main] INFO  com.alibaba.nacos.common.remote.client - [635c48bc-c4ec-4f06-a76c-06177b81ab60] Register server push request handler:com.alibaba.nacos.common.remote.client.RpcClient$ConnectResetRequestHandler
2025-05-19 13:55:46.901 [com.alibaba.nacos.client.remote.worker] INFO  com.alibaba.nacos.common.remote.client - [635c48bc-c4ec-4f06-a76c-06177b81ab60] Notify connected event to listeners.
2025-05-19 13:55:46.901 [main] INFO  com.alibaba.nacos.common.remote.client - [635c48bc-c4ec-4f06-a76c-06177b81ab60] Register server push request handler:com.alibaba.nacos.common.remote.client.RpcClient$$Lambda/0x0000026ebe526b60
2025-05-19 13:55:46.901 [com.alibaba.nacos.client.remote.worker] INFO  com.alibaba.nacos.client.naming - Grpc connection connect
2025-05-19 13:55:46.902 [main] INFO  com.alibaba.nacos.client.naming - [REGISTER-SERVICE] d750d92e-152f-4055-a641-3bc9dda85a29 registering service bgtech-ai with instance Instance{instanceId='null', ip='192.168.86.8', port=8080, weight=1.0, healthy=true, enabled=true, ephemeral=true, clusterName='DEFAULT', serviceName='null', metadata={IPv6=[2408:820c:7528:8342:b486:9b72:4b72:4bf0], preserved.register.source=SPRING_CLOUD}}
2025-05-19 13:55:46.918 [main] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - nacos registry, DEFAULT_GROUP bgtech-ai 192.168.86.8:8080 register finished
2025-05-19 13:55:46.972 [main] INFO  com.bgpay.bgai.BgaiApplication - Started BgaiApplication in 15.865 seconds (process running for 17.278)
2025-05-19 13:55:46.976 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-19 13:55:46.976 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-19 13:55:46.986 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-19 13:55:46.986 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-19 13:55:46.987 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-19 13:55:46.997 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-19 13:55:46.997 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-19 13:55:46.998 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-19 13:55:47.005 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-19 13:55:47.005 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-19 13:55:47.005 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-19 13:55:47.012 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-19 13:55:47.013 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - ==================== Saga状态机加载报告 ====================
2025-05-19 13:55:47.013 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - Saga状态机配置加载状态: 成功
2025-05-19 13:55:47.013 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 已加载的状态机定义文件数量: 1
2025-05-19 13:55:47.013 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 已加载的状态机定义文件:
2025-05-19 13:55:47.013 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig -  - /E:/project/bgai/target/classes/statelang/bgai-saga-transaction.json
2025-05-19 13:55:47.013 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - Saga解析器状态: CUSTOM_FASTJSON2
2025-05-19 13:55:47.013 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 状态机解析结果: 成功 1 个, 失败 0 个
2025-05-19 13:55:47.014 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - =============================================================
2025-05-19 13:55:47.018 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - nacos.cache.data.init.snapshot = true 
2025-05-19 13:55:47.018 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] common-dev.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-19 13:55:47.029 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=common-dev.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-19 13:55:47.030 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=common-dev.yaml, group=DEFAULT_GROUP
2025-05-19 13:55:47.030 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-19 13:55:47.030 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-19 13:55:47.030 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai.yaml, group=DEFAULT_GROUP
2025-05-19 13:55:47.032 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai-dev.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-19 13:55:47.032 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai-dev.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-19 13:55:47.032 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai-dev.yaml, group=DEFAULT_GROUP
2025-05-19 13:55:47.033 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-19 13:55:47.033 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai, group=DEFAULT_GROUP, cnt=1
2025-05-19 13:55:47.033 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai, group=DEFAULT_GROUP
2025-05-19 13:55:53.701 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - 接收到请求: /api/chatGatWay-internal, 文件=新文件 17.txt, 问题参数=null, 模型参数=null
2025-05-19 13:55:53.705 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - 请求Content-Type: multipart/form-data;boundary=--------------------------521378675217219197327308
2025-05-19 13:55:53.706 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - 收集到的完整参数: question="null", apiUrl="null", modelName="null", multiTurn=false
2025-05-19 13:55:53.708 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - Processing request for user ID: 689258T
2025-05-19 13:55:53.708 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - Processing file with circuit breaker: fileName=新文件 17.txt, question=
2025-05-19 13:55:53.711 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.config.ReactiveFileProcessor - Processing file: 新文件 17.txt, content-type: text/plain
2025-05-19 13:55:53.722 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - PARAM TRACE [689258T]: 尝试查找匹配配置 - 参数: apiUrl=null, modelName=null
2025-05-19 13:55:53.739 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 查询配置 - userId=689258T
2025-05-19 13:55:53.740 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 排序方式 - 按ID降序
2025-05-19 13:55:53.740 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 限制结果数 - LIMIT 1
2025-05-19 13:55:53.812 [http-nio-8080-exec-2] DEBUG com.bgpay.bgai.mapper.ApiConfigMapper.selectList - ==>  Preparing: SELECT id,api_url,api_key,model_name,user_id FROM api_config WHERE (user_id = ?) ORDER BY id DESC LIMIT 1
2025-05-19 13:55:53.813 [http-nio-8080-exec-2] DEBUG com.bgpay.bgai.mapper.ApiConfigMapper.selectList - ==> Parameters: 689258T(String)
2025-05-19 13:55:53.820 [http-nio-8080-exec-2] DEBUG com.bgpay.bgai.mapper.ApiConfigMapper.selectList - <==      Total: 1
2025-05-19 13:55:53.821 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 查询结果 - 找到配置: id=2, modelName=deepseek-chat
2025-05-19 13:55:53.821 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - PARAM TRACE [689258T]: 找到匹配配置 - apiUrl=https://api.deepseek.com/chat/completions, modelName=deepseek-chat (原始请求: null)
2025-05-19 13:55:53.821 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - API config resolved: url=https://api.deepseek.com/chat/completions, model=deepseek-chat
2025-05-19 13:55:53.840 [Thread-49] INFO  com.bgpay.bgai.config.ReactiveFileProcessor - File processed successfully: size=6680 bytes
2025-05-19 13:55:53.845 [Thread-49] INFO  com.bgpay.bgai.controller.ReactiveChatController - Content processed, length: 6603
2025-05-19 13:55:53.852 [Thread-49] INFO  io.seata.tm.TransactionManagerHolder - TransactionManager Singleton io.seata.tm.DefaultTransactionManager@20bf83be
2025-05-19 13:55:53.874 [Thread-49] INFO  io.seata.tm.api.DefaultGlobalTransaction - Begin new global transaction [seata-server:8091:27673667088527371]
2025-05-19 13:55:53.876 [Thread-49] INFO  c.b.bgai.interceptor.SeataTransactionInterceptor - 准备记录分布式事务开始: XID=seata-server:8091:27673667088527371, 业务=com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive, 路径=, IP=, 用户=system
2025-05-19 13:55:53.893 [Thread-49] INFO  c.b.bgai.service.impl.TransactionLogServiceImpl - 记录分布式事务开始: XID=seata-server:8091:27673667088527371, 业务=com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive
2025-05-19 13:55:53.900 [Thread-49] DEBUG com.bgpay.bgai.mapper.TransactionLogMapper.insert - ==>  Preparing: INSERT INTO transaction_log ( xid, transaction_name, transaction_mode, status, request_path, source_ip, start_time, user_id, create_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-05-19 13:55:53.904 [Thread-49] DEBUG com.bgpay.bgai.mapper.TransactionLogMapper.insert - ==> Parameters: seata-server:8091:27673667088527371(String), com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive(String), AT(String), ACTIVE(String), (String), (String), 2025-05-19T13:55:53.893208400(LocalDateTime), system(String), 2025-05-19T13:55:53.893208400(LocalDateTime)
2025-05-19 13:55:54.273 [Thread-49] DEBUG com.bgpay.bgai.mapper.TransactionLogMapper.insert - <==    Updates: 1
2025-05-19 13:55:54.290 [Thread-49] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:27673667088527371, branchId:27673667088527372, lockKeys:transaction_log:3
2025-05-19 13:55:54.301 [Thread-49] WARN  i.s.c.l.EnhancedServiceLoader$InnerEnhancedServiceLoader - Load [io.seata.rm.datasource.undo.parser.ProtostuffUndoLogParser] class fail: io/protostuff/runtime/IdStrategy
2025-05-19 13:55:54.368 [Thread-49] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:27673667088527371, branchId:27673667088527373, lockKeys:transaction_log:3;undo_log:9
2025-05-19 13:55:54.398 [Thread-49] INFO  c.b.bgai.interceptor.SeataTransactionInterceptor - 开始分布式事务: XID=seata-server:8091:27673667088527371, 方法=com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive
2025-05-19 13:55:54.408 [Thread-49] INFO  org.reflections.Reflections - Processing reactive request: content length=6603, apiUrl=https://api.deepseek.com/chat/completions, modelName=deepseek-chat, userId=689258T, multiTurn=false
2025-05-19 13:55:54.431 [Thread-49] INFO  com.bgpay.bgai.transaction.TransactionCoordinator - Transaction prepared for user 689258T: chatCompletionId=chat-7ea11837-3cd7-4b5c-a466-dc3bc18fe899
2025-05-19 13:55:54.432 [Thread-49] INFO  org.reflections.Reflections - Generated request JSON with 2PC transaction: {"stream":false,"max_tokens":2000,"temperature":1.0,"messages":[{"role":"system","content":"You are ...
2025-05-19 13:55:54.454 [Thread-49] INFO  c.b.bgai.service.impl.TransactionLogServiceImpl - 记录分布式事务结束: XID=seata-server:8091:27673667088527371, 状态=COMMITTED
2025-05-19 13:55:54.455 [Thread-49] DEBUG c.b.bgai.mapper.TransactionLogMapper.selectList - ==>  Preparing: SELECT id,xid,branch_id,transaction_name,transaction_mode,status,request_path,source_ip,start_time,end_time,user_id,extra_data,create_time,update_time FROM transaction_log WHERE (xid = ?) LIMIT 1
2025-05-19 13:55:54.457 [Thread-49] DEBUG c.b.bgai.mapper.TransactionLogMapper.selectList - ==> Parameters: seata-server:8091:27673667088527371(String)
2025-05-19 13:55:54.465 [Thread-49] DEBUG c.b.bgai.mapper.TransactionLogMapper.selectList - <==      Total: 1
2025-05-19 13:55:54.468 [Thread-49] DEBUG c.b.bgai.mapper.TransactionLogMapper.updateById - ==>  Preparing: UPDATE transaction_log SET xid=?, transaction_name=?, transaction_mode=?, status=?, request_path=?, source_ip=?, start_time=?, end_time=?, user_id=?, extra_data=?, create_time=?, update_time=? WHERE id=?
2025-05-19 13:55:54.475 [Thread-49] DEBUG c.b.bgai.mapper.TransactionLogMapper.updateById - ==> Parameters: seata-server:8091:27673667088527371(String), com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive(String), AT(String), COMMITTED(String), (String), (String), 2025-05-19T13:55:54(LocalDateTime), 2025-05-19T13:55:54.465847200(LocalDateTime), system(String), {"duration":50,"result":"success"}(String), 2025-05-19T13:55:54(LocalDateTime), 2025-05-19T13:55:54.465847200(LocalDateTime), 3(Long)
2025-05-19 13:55:54.526 [Thread-49] DEBUG c.b.bgai.mapper.TransactionLogMapper.updateById - <==    Updates: 1
2025-05-19 13:55:54.536 [Thread-49] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:27673667088527371, branchId:27673667088527374, lockKeys:transaction_log:3
2025-05-19 13:55:54.561 [Thread-49] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:27673667088527371, branchId:27673667088527375, lockKeys:undo_log:11;transaction_log:3
2025-05-19 13:55:54.584 [Thread-49] INFO  c.b.bgai.interceptor.SeataTransactionInterceptor - 分布式事务成功完成: XID=seata-server:8091:27673667088527371, 耗时=50ms
2025-05-19 13:55:54.585 [Thread-49] INFO  io.seata.tm.api.DefaultGlobalTransaction - transaction seata-server:8091:27673667088527371 will be commit
2025-05-19 13:55:54.597 [Thread-49] INFO  io.seata.tm.api.DefaultGlobalTransaction - transaction end, xid = seata-server:8091:27673667088527371
2025-05-19 13:55:54.597 [Thread-49] INFO  io.seata.tm.api.DefaultGlobalTransaction - [seata-server:8091:27673667088527371] commit status: Committed
2025-05-19 13:55:54.641 [rpcDispatch_RMROLE_1_1_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:27673667088527371', branchId=27673667088527372, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false,"skipCheckLock":true}'}
2025-05-19 13:55:54.642 [rpcDispatch_RMROLE_1_1_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:27673667088527371 27673667088527372 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false,"skipCheckLock":true}
2025-05-19 13:55:54.643 [rpcDispatch_RMROLE_1_1_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-19 13:55:54.652 [rpcDispatch_RMROLE_1_2_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:27673667088527371', branchId=27673667088527373, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false,"skipCheckLock":true}'}
2025-05-19 13:55:54.652 [rpcDispatch_RMROLE_1_2_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:27673667088527371 27673667088527373 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false,"skipCheckLock":true}
2025-05-19 13:55:54.653 [rpcDispatch_RMROLE_1_2_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-19 13:55:54.661 [rpcDispatch_RMROLE_1_3_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:27673667088527371', branchId=27673667088527374, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false}'}
2025-05-19 13:55:54.661 [rpcDispatch_RMROLE_1_3_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:27673667088527371 27673667088527374 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false}
2025-05-19 13:55:54.661 [rpcDispatch_RMROLE_1_3_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-19 13:55:54.670 [rpcDispatch_RMROLE_1_4_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:27673667088527371', branchId=27673667088527375, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false}'}
2025-05-19 13:55:54.670 [rpcDispatch_RMROLE_1_4_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:27673667088527371 27673667088527375 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false}
2025-05-19 13:55:54.670 [rpcDispatch_RMROLE_1_4_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-19 13:56:17.368 [reactor-http-nio-3] INFO  org.reflections.Reflections - Raw response received, length: 2009
2025-05-19 13:56:17.374 [reactor-http-nio-3] WARN  org.reflections.Reflections - Received different chatCompletionId from response: ff991df4-69d8-4b02-8e71-36e9947e09f9 vs prepared: chat-7ea11837-3cd7-4b5c-a466-dc3bc18fe899
2025-05-19 13:56:17.391 [reactor-http-nio-3] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - ==>  Preparing: INSERT INTO chat_completions ( object, created, model, system_fingerprint, api_key ) VALUES ( ?, ?, ?, ?, ? )
2025-05-19 13:56:17.392 [reactor-http-nio-3] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - ==> Parameters: chat.completion(String), 1747634177390(Long), deepseek-chat(String), 689258T(String), chat-7ea11837-3cd7-4b5c-a466-dc3bc18fe899(String)
2025-05-19 13:56:17.403 [reactor-http-nio-3] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - <==    Updates: 1
2025-05-19 13:56:17.403 [reactor-http-nio-3] INFO  com.bgpay.bgai.transaction.TransactionCoordinator - Transaction committed for user 689258T: chatCompletionId=chat-7ea11837-3cd7-4b5c-a466-dc3bc18fe899
2025-05-19 13:56:17.422 [FileWrite-1] INFO  com.bgpay.bgai.service.deepseek.FileWriterService - Successfully wrote content to: \var\data\ai_responses\d2c2eb0b-023b-44a0-ad7d-9f56953705e3.txt
2025-05-19 13:56:17.431 [boundedElastic-1] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - ==>  Preparing: INSERT INTO chat_completions ( object, created, model, system_fingerprint, api_key ) VALUES ( ?, ?, ?, ?, ? )
2025-05-19 13:56:17.432 [boundedElastic-1] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - ==> Parameters: chat.completion(String), 1747634155(Long), deepseek-chat(String), fp_8802369eaa_prod0425fp8(String), chat-7ea11837-3cd7-4b5c-a466-dc3bc18fe899(String)
2025-05-19 13:56:17.443 [boundedElastic-1] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - <==    Updates: 1
2025-05-19 13:56:17.466 [boundedElastic-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.insert - ==>  Preparing: INSERT INTO usage_info ( chat_completion_id, prompt_tokens, completion_tokens, total_tokens, prompt_tokens_cached, completion_reasoning_tokens, prompt_cache_hit_tokens, prompt_cache_miss_tokens, created_at, model_type ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-05-19 13:56:17.468 [boundedElastic-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.insert - ==> Parameters: chat-7ea11837-3cd7-4b5c-a466-dc3bc18fe899(String), 2209(Integer), 394(Integer), 2603(Integer), 2176(Integer), 0(Integer), 0(Integer), 33(Integer), 2025-05-19T13:56:17.458043800(LocalDateTime), deepseek-chat(String)
2025-05-19 13:56:17.480 [boundedElastic-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.insert - <==    Updates: 1
2025-05-19 13:56:17.508 [boundedElastic-1] INFO  org.reflections.Reflections - Completion data saved synchronously for chatCompletionId: chat-7ea11837-3cd7-4b5c-a466-dc3bc18fe899
2025-05-19 13:56:17.514 [boundedElastic-2] INFO  org.reflections.Reflections - 开始发送账单消息，chatCompletionId: chat-7ea11837-3cd7-4b5c-a466-dc3bc18fe899, userId: 689258T
2025-05-19 13:56:17.566 [boundedElastic-2] INFO  org.reflections.Reflections - 账单消息发送成功，chatCompletionId: chat-7ea11837-3cd7-4b5c-a466-dc3bc18fe899, userId: 689258T
2025-05-19 13:56:17.569 [boundedElastic-1] INFO  org.reflections.Reflections - Complete processing chain completed: This appears to be a Spring Boot application configuration file (likely `application.yml`). Here are the key components I can see:

1. **Basic Application Config**:
   - App name: `bgai`
   - Active profile: `dev`
   - Allows bean definition overriding

2. **Database Config**:
   - MySQL master/slave setup using Druid connection pool
   - Both pointing to `8.133.246.113:3306/deepseek`
   - Username: `bgtech`, Password: `Zly689258..`
   - Hibernate/JPA configured for MySQL8 with auto-update

3. **Redis Config**:
   - Single Redis instance at `8.133.246.113:6379`
   - Password: `5z25u2sk`
   - Used for both Spring Session and application cache

4. **Other Services**:
   - RocketMQ at `8.133.246.113:9876`
   - Flink Job Manager at `8.133.246.113:8081`
   - Tesseract OCR data path configured

5. **Resilience Config**:
   - Circuit breakers for API calls (deepseekApiBreaker)
   - Time limiters and retry configurations

6. **Security**:
   - SSO OAuth2 configuration
   - API key authentication with 2 sample keys

7. **Performance**:
   - Async task thread pool configuration
   - HTTP connection limits
   - File upload size limits (200MB)

8. **Logging**:
   - JSON format logs written to `/var/data/ai_responses/application.log`

The configuration shows this is likely an AI service application with conversation capabilities (max 5 rounds retained), file processing, and integration with various backend services.

Would you like me to analyze any specific part of this configuration in more detail?
2025-05-19 13:56:17.569 [boundedElastic-1] INFO  com.bgpay.bgai.controller.ReactiveChatController - Processed response for user 689258T, content length: 1512
2025-05-19 13:56:46.578 [pool-7-thread-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.selectCount - ==>  Preparing: SELECT COUNT( * ) AS total FROM usage_info WHERE (chat_completion_id = ?)
2025-05-19 13:56:46.579 [pool-7-thread-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.selectCount - ==> Parameters: chat-7ea11837-3cd7-4b5c-a466-dc3bc18fe899(String)
2025-05-19 13:56:46.585 [pool-7-thread-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.selectCount - <==      Total: 1
2025-05-19 13:56:46.730 [ConsumeMessageThread_billing-consumer-group_1] INFO  c.bgpay.bgai.service.mq.RocketMQBillingServiceImpl - Output price config priceVersion: 1
2025-05-19 13:56:46.732 [ConsumeMessageThread_billing-consumer-group_1] DEBUG com.bgpay.bgai.mapper.UsageRecordMapper.insert - ==>  Preparing: INSERT INTO usage_record ( model_type, chat_completion_id, user_id, input_cost, output_cost, price_version, calculated_at ) VALUES ( ?, ?, ?, ?, ?, ?, ? )
2025-05-19 13:56:46.733 [ConsumeMessageThread_billing-consumer-group_1] DEBUG com.bgpay.bgai.mapper.UsageRecordMapper.insert - ==> Parameters: deepseek-chat(String), chat-7ea11837-3cd7-4b5c-a466-dc3bc18fe899(String), 689258T(String), 0.0001(BigDecimal), 0.0032(BigDecimal), 1(Integer), 2025-05-19T13:56:46.730583300(LocalDateTime)
2025-05-19 13:56:46.750 [ConsumeMessageThread_billing-consumer-group_1] DEBUG com.bgpay.bgai.mapper.UsageRecordMapper.insert - <==    Updates: 1
2025-05-19 13:56:46.759 [ConsumeMessageThread_billing-consumer-group_1] INFO  c.bgpay.bgai.service.mq.RocketMQBillingServiceImpl - Message consumed: 2408820C75288342B4869B724B724BF08C0C36BAF30C5FB01E0A0000
2025-05-19 13:58:43.461 [Thread-1] WARN  c.alibaba.nacos.common.http.HttpClientBeanHolder - [HttpClientBeanHolder] Start destroying common HttpClient
2025-05-19 13:58:43.461 [Thread-7] WARN  com.alibaba.nacos.common.notify.NotifyCenter - [NotifyCenter] Start destroying Publisher
2025-05-19 13:58:43.461 [Thread-7] WARN  com.alibaba.nacos.common.notify.NotifyCenter - [NotifyCenter] Destruction of the end
2025-05-19 13:58:43.462 [Thread-1] WARN  c.alibaba.nacos.common.http.HttpClientBeanHolder - [HttpClientBeanHolder] Destruction of the end
2025-05-19 13:58:43.480 [NettyClientSelector_TMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - channel inactive: [id: 0x191ab4bf, L:/192.168.86.8:51367 ! R:/8.133.246.113:8091]
2025-05-19 13:58:43.480 [NettyClientSelector_TMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - return to pool, rm channel:[id: 0x191ab4bf, L:/192.168.86.8:51367 ! R:/8.133.246.113:8091]
2025-05-19 13:58:43.480 [NettyClientSelector_TMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - channel valid false,channel:[id: 0x191ab4bf, L:/192.168.86.8:51367 ! R:/8.133.246.113:8091]
2025-05-19 13:58:43.480 [NettyClientSelector_TMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - will destroy channel:[id: 0x191ab4bf, L:/192.168.86.8:51367 ! R:/8.133.246.113:8091]
2025-05-19 13:58:43.480 [NettyClientSelector_TMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0x191ab4bf, L:/192.168.86.8:51367 ! R:/8.133.246.113:8091]) will closed
2025-05-19 13:58:43.480 [NettyClientSelector_TMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0x191ab4bf, L:/192.168.86.8:51367 ! R:/8.133.246.113:8091]) will closed
2025-05-19 13:58:43.481 [NettyClientSelector_RMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - channel inactive: [id: 0x100060c9, L:/192.168.86.8:51372 ! R:/8.133.246.113:8091]
2025-05-19 13:58:43.481 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - return to pool, rm channel:[id: 0x100060c9, L:/192.168.86.8:51372 ! R:/8.133.246.113:8091]
2025-05-19 13:58:43.481 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - channel valid false,channel:[id: 0x100060c9, L:/192.168.86.8:51372 ! R:/8.133.246.113:8091]
2025-05-19 13:58:43.481 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - will destroy channel:[id: 0x100060c9, L:/192.168.86.8:51372 ! R:/8.133.246.113:8091]
2025-05-19 13:58:43.481 [NettyClientSelector_RMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0x100060c9, L:/192.168.86.8:51372 ! R:/8.133.246.113:8091]) will closed
2025-05-19 13:58:43.481 [NettyClientSelector_RMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0x100060c9, L:/192.168.86.8:51372 ! R:/8.133.246.113:8091]) will closed
2025-05-19 13:58:43.483 [SpringContextShutdownHook] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - De-registering from Nacos Server now...
2025-05-19 13:58:43.483 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - [DEREGISTER-SERVICE] d750d92e-152f-4055-a641-3bc9dda85a29 deregistering service bgtech-ai with instance: Instance{instanceId='null', ip='192.168.86.8', port=8080, weight=1.0, healthy=true, enabled=true, ephemeral=true, clusterName='DEFAULT', serviceName='null', metadata={}}
2025-05-19 13:58:43.496 [SpringContextShutdownHook] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - De-registration finished.
2025-05-19 13:58:43.497 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.cache.ServiceInfoHolder do shutdown begin
2025-05-19 13:58:43.497 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.backups.FailoverReactor do shutdown begin
2025-05-19 13:58:43.497 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.backups.FailoverReactor do shutdown stop
2025-05-19 13:58:43.497 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.cache.ServiceInfoHolder do shutdown stop
2025-05-19 13:58:43.497 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.NamingClientProxyDelegate do shutdown begin
2025-05-19 13:58:43.497 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServiceInfoUpdateService do shutdown begin
2025-05-19 13:58:43.497 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServiceInfoUpdateService do shutdown stop
2025-05-19 13:58:43.497 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServerListManager do shutdown begin
2025-05-19 13:58:43.497 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Start destroying NacosRestTemplate
2025-05-19 13:58:43.498 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Destruction of the end
2025-05-19 13:58:43.498 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServerListManager do shutdown stop
2025-05-19 13:58:43.498 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.http.NamingHttpClientProxy do shutdown begin
2025-05-19 13:58:43.498 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Start destroying NacosRestTemplate
2025-05-19 13:58:43.498 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Destruction of the end
2025-05-19 13:58:43.498 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.http.NamingHttpClientProxy do shutdown stop
2025-05-19 13:58:43.498 [SpringContextShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Shutdown rpc client, set status to shutdown
2025-05-19 13:58:43.498 [SpringContextShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Shutdown client event executor java.util.concurrent.ScheduledThreadPoolExecutor@3aae6d53[Running, pool size = 2, active threads = 2, queued tasks = 0, completed tasks = 0]
2025-05-19 13:58:43.498 [SpringContextShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Close current connection 1747634146790_139.227.195.203_43808
2025-05-19 13:58:43.501 [nacos-grpc-client-executor-8.133.246.113-55] WARN  c.a.nacos.common.remote.client.grpc.GrpcClient - [1747634146790_139.227.195.203_43808]Ignore error event,isRunning:false,isAbandon=false
2025-05-19 13:58:43.502 [SpringContextShutdownHook] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - Shutdown grpc executor java.util.concurrent.ThreadPoolExecutor@56625ce9[Running, pool size = 4, active threads = 0, queued tasks = 0, completed tasks = 56]
2025-05-19 13:58:43.502 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - Shutdown grpc redo service executor java.util.concurrent.ScheduledThreadPoolExecutor@3a02d567[Running, pool size = 1, active threads = 0, queued tasks = 1, completed tasks = 58]
2025-05-19 13:58:43.502 [SpringContextShutdownHook] INFO  c.a.n.client.auth.ram.identify.CredentialWatcher - [null] CredentialWatcher is stopped
2025-05-19 13:58:43.503 [SpringContextShutdownHook] INFO  c.a.n.client.auth.ram.identify.CredentialService - [null] CredentialService is freed
2025-05-19 13:58:43.503 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.NamingClientProxyDelegate do shutdown stop
2025-05-19 13:58:45.545 [SpringContextShutdownHook] DEBUG com.bgpay.bgai.config.AsyncConfig$1 - Shutting down ExecutorService 'blockingExecutor'
2025-05-19 13:58:45.587 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:10909] result: true
2025-05-19 13:58:45.588 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:10911] result: true
2025-05-19 13:58:45.588 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:9876] result: true
2025-05-19 13:58:45.612 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:10911] result: true
2025-05-19 13:58:45.612 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:9876] result: true
2025-05-19 13:58:45.723 [SpringContextShutdownHook] INFO  o.s.orm.jpa.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-05-19 13:58:45.726 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-2} closing ...
2025-05-19 13:58:45.731 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-2} closed
2025-05-19 13:58:45.731 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} closing ...
2025-05-19 13:58:45.732 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} closed
2025-05-19 14:04:34.592 [main] WARN  com.alibaba.nacos.client.logging.NacosLogging - Load Logback Configuration of Nacos fail, message: Could not initialize Logback Nacos logging from classpath:nacos-logback.xml
2025-05-19 14:04:34.593 [main] INFO  com.bgpay.bgai.BgaiApplication - The following 1 profile is active: "dev"
2025-05-19 14:04:35.895 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-05-19 14:04:35.897 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-05-19 14:04:35.921 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 17 ms. Found 0 JPA repository interfaces.
2025-05-19 14:04:35.931 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-05-19 14:04:35.932 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-05-19 14:04:35.944 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 4 ms. Found 0 Redis repository interfaces.
2025-05-19 14:04:36.525 [main] INFO  io.seata.config.ConfigurationFactory - load Configuration from :Spring Configuration
2025-05-19 14:04:36.534 [main] INFO  io.seata.config.ConfigurationFactory - load Configuration from :Spring Configuration
2025-05-19 14:04:36.542 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Initializing Global Transaction Clients ... 
2025-05-19 14:04:36.646 [main] INFO  io.seata.core.rpc.netty.NettyClientBootstrap - NettyClientBootstrap has started
2025-05-19 14:04:36.647 [main] INFO  io.seata.discovery.registry.RegistryFactory - use registry center type: file
2025-05-19 14:04:36.657 [main] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - will connect to 8.133.246.113:8091
2025-05-19 14:04:36.661 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - NettyPool create channel to transactionRole:TMROLE,address:8.133.246.113:8091,msg:< RegisterTMRequest{version='1.7.0', applicationId='bgtech-ai', transactionServiceGroup='bgai-tx-group', extraData='ak=null
digest=bgai-tx-group,192.168.86.8,1747634676659
timestamp=1747634676659
authVersion=V4
vgroup=bgai-tx-group
ip=192.168.86.8
'} >
2025-05-19 14:04:36.792 [main] INFO  io.seata.core.rpc.netty.TmNettyRemotingClient - register TM success. client version:1.7.0, server version:1.8.1-SNAPSHOT,channel:[id: 0x1c4d51a7, L:/192.168.86.8:61022 - R:/8.133.246.113:8091]
2025-05-19 14:04:36.799 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - register success, cost 66 ms, version:1.8.1-SNAPSHOT,role:TMROLE,channel:[id: 0x1c4d51a7, L:/192.168.86.8:61022 - R:/8.133.246.113:8091]
2025-05-19 14:04:36.799 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Transaction Manager Client is initialized. applicationId[bgtech-ai] txServiceGroup[bgai-tx-group]
2025-05-19 14:04:36.812 [main] INFO  io.seata.rm.datasource.AsyncWorker - Async Commit Buffer Limit: 10000
2025-05-19 14:04:36.813 [main] INFO  io.seata.rm.datasource.xa.ResourceManagerXA - ResourceManagerXA init ...
2025-05-19 14:04:36.821 [main] INFO  io.seata.core.rpc.netty.NettyClientBootstrap - NettyClientBootstrap has started
2025-05-19 14:04:36.821 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Resource Manager is initialized. applicationId[bgtech-ai] txServiceGroup[bgai-tx-group]
2025-05-19 14:04:36.821 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Global Transaction Clients are initialized. 
2025-05-19 14:04:37.919 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat initialized with port(s): 8080 (http)
2025-05-19 14:04:37.929 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - The ["http-nio-8080"] connector has been configured to support HTTP upgrade to [h2c]
2025-05-19 14:04:37.929 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - Initializing ProtocolHandler ["http-nio-8080"]
2025-05-19 14:04:37.930 [main] INFO  org.apache.catalina.core.StandardService - Starting service [Tomcat]
2025-05-19 14:04:37.931 [main] INFO  org.apache.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.15]
2025-05-19 14:04:38.313 [main] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} inited
2025-05-19 14:04:38.585 [main] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - will connect to 8.133.246.113:8091
2025-05-19 14:04:38.585 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - RM will register :jdbc:mysql://8.133.246.113:3306/deepseek
2025-05-19 14:04:38.585 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - NettyPool create channel to transactionRole:RMROLE,address:8.133.246.113:8091,msg:< RegisterRMRequest{resourceIds='jdbc:mysql://8.133.246.113:3306/deepseek', version='1.7.0', applicationId='bgtech-ai', transactionServiceGroup='bgai-tx-group', extraData='null'} >
2025-05-19 14:04:38.607 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - register RM success. client version:1.7.0, server version:1.8.1-SNAPSHOT,channel:[id: 0x553d6c22, L:/192.168.86.8:61026 - R:/8.133.246.113:8091]
2025-05-19 14:04:38.607 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - register success, cost 12 ms, version:1.8.1-SNAPSHOT,role:RMROLE,channel:[id: 0x553d6c22, L:/192.168.86.8:61026 - R:/8.133.246.113:8091]
2025-05-19 14:04:38.609 [main] INFO  i.s.s.a.datasource.SeataAutoDataSourceProxyCreator - Auto proxy data source 'masterDataSource' by 'AT' mode.
2025-05-19 14:04:38.686 [main] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-2} inited
2025-05-19 14:04:38.766 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - will register resourceId:jdbc:mysql://8.133.246.113:3306/deepseek
2025-05-19 14:04:38.767 [main] INFO  i.s.s.a.datasource.SeataAutoDataSourceProxyCreator - Auto proxy data source 'slaveDataSource' by 'AT' mode.
2025-05-19 14:04:38.785 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.rm.AbstractRMHandler - the rm client received response msg [RegisterRMResponse{version='1.8.1-SNAPSHOT', extraData='null', identified=true, resultCode=null, msg='null'}] from tc server.
2025-05-19 14:04:38.789 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - will register resourceId:jdbc:mysql://8.133.246.113:3306/deepseek
2025-05-19 14:04:38.790 [main] INFO  i.s.s.a.datasource.SeataAutoDataSourceProxyCreator - Auto proxy data source 'dynamicDataSource' by 'AT' mode.
2025-05-19 14:04:38.803 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.rm.AbstractRMHandler - the rm client received response msg [RegisterRMResponse{version='1.8.1-SNAPSHOT', extraData='null', identified=true, resultCode=null, msg='null'}] from tc server.
2025-05-19 14:04:38.896 [main] INFO  org.hibernate.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-05-19 14:04:38.942 [main] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.1.7.Final
2025-05-19 14:04:39.279 [main] INFO  SQL dialect - HHH000400: Using dialect: org.hibernate.dialect.MySQL8Dialect
2025-05-19 14:04:39.281 [main] WARN  org.hibernate.orm.deprecation - HHH90000026: MySQL8Dialect has been deprecated; use org.hibernate.dialect.MySQLDialect instead
2025-05-19 14:04:39.537 [main] INFO  o.h.e.t.jta.platform.internal.JtaPlatformInitiator - HHH000490: Using JtaPlatform implementation: [org.hibernate.engine.transaction.jta.platform.internal.NoJtaPlatform]
2025-05-19 14:04:39.551 [main] INFO  o.s.orm.jpa.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-05-19 14:04:39.952 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-19 14:04:39.963 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-19 14:04:39.989 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-19 14:04:39.991 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-19 14:04:39.991 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-19 14:04:40.003 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-19 14:04:40.621 [main] INFO  com.bgpay.bgai.service.impl.UserServiceImpl - 初始化SSO配置: clientId=bgai-client-id, redirectUri=http://localhost:8080/api/auth/callback
2025-05-19 14:04:40.748 [main] INFO  com.bgpay.bgai.controller.AuthController - 初始化认证控制器: clientId=bgai-client-id, redirectUri=http://localhost:8080/api/auth/callback
2025-05-19 14:04:41.321 [main] INFO  o.a.r.s.autoconfigure.RocketMQAutoConfiguration - a producer (billing-producer-group) init on namesrv 8.133.246.113:9876
2025-05-19 14:04:41.586 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Bean [com.bgpay.bgai.service.deepseek.DeepSeekServiceImp$$SpringCGLIB$$0] with name [deepSeekServiceImp] would use interceptor [io.seata.spring.annotation.GlobalTransactionalInterceptor]
2025-05-19 14:04:41.955 [main] WARN  i.s.s.b.a.provider.SpringBootConfigurationProvider - The get method not found for the field 'SeataProperties#accesskey'.
2025-05-19 14:04:41.955 [main] WARN  i.s.s.b.a.provider.SpringBootConfigurationProvider - The get method not found for the field 'SeataProperties#secretkey'.
2025-05-19 14:04:41.966 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 加载到1个Saga状态机定义文件
2025-05-19 14:04:42.110 [main] INFO  com.bgpay.bgai.saga.CustomSagaJsonParser - 开始解析状态机定义: bgai-saga-transaction
2025-05-19 14:04:42.111 [main] INFO  com.bgpay.bgai.saga.CustomSagaJsonParser - 状态机定义解析成功: bgai-saga-transaction
2025-05-19 14:04:42.111 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 成功加载状态机定义: /E:/project/bgai/target/classes/statelang/bgai-saga-transaction.json
2025-05-19 14:04:42.795 [main] INFO  org.redisson.Version - Redisson 3.24.3
2025-05-19 14:04:43.076 [redisson-netty-4-6] INFO  o.r.connection.pool.MasterPubSubConnectionPool - 1 connections initialized for 8.133.246.113/8.133.246.113:6379
2025-05-19 14:04:43.420 [redisson-netty-4-19] INFO  org.redisson.connection.pool.MasterConnectionPool - 24 connections initialized for 8.133.246.113/8.133.246.113:6379
2025-05-19 14:04:43.763 [main] INFO  com.bgpay.bgai.service.mq.MQConsumerService - MQ consumer startup successful [group=billing-consumer-group, topic=BILLING_TOPIC, tag=USER_BILLING]
2025-05-19 14:04:43.931 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Bean [com.bgpay.bgai.service.impl.SeataTransactionService$$SpringCGLIB$$0] with name [seataTransactionService] would use interceptor [io.seata.spring.annotation.GlobalTransactionalInterceptor]
2025-05-19 14:04:44.067 [main] DEBUG com.bgpay.bgai.config.AsyncConfig$1 - Initializing ExecutorService 'blockingExecutor'
2025-05-19 14:04:45.490 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [After]
2025-05-19 14:04:45.490 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Before]
2025-05-19 14:04:45.490 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Between]
2025-05-19 14:04:45.490 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Cookie]
2025-05-19 14:04:45.490 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Header]
2025-05-19 14:04:45.491 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Host]
2025-05-19 14:04:45.491 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Method]
2025-05-19 14:04:45.491 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Path]
2025-05-19 14:04:45.491 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Query]
2025-05-19 14:04:45.491 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [ReadBody]
2025-05-19 14:04:45.491 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [RemoteAddr]
2025-05-19 14:04:45.491 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [XForwardedRemoteAddr]
2025-05-19 14:04:45.491 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Weight]
2025-05-19 14:04:45.491 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [CloudFoundryRouteService]
2025-05-19 14:04:47.042 [main] INFO  o.s.b.actuate.endpoint.web.EndpointLinksResolver - Exposing 1 endpoint(s) beneath base path '/actuator'
2025-05-19 14:04:47.395 [main] WARN  i.s.s.b.a.provider.SpringBootConfigurationProvider - The get method not found for the field 'SeataProperties#accesskey'.
2025-05-19 14:04:47.396 [main] WARN  i.s.s.b.a.provider.SpringBootConfigurationProvider - The get method not found for the field 'SeataProperties#secretkey'.
2025-05-19 14:04:47.417 [main] INFO  io.seata.saga.tm.DefaultSagaTransactionalTemplate - Initializing Global Transaction Clients ... 
2025-05-19 14:04:47.417 [main] INFO  io.seata.saga.tm.DefaultSagaTransactionalTemplate - Transaction Manager Client is initialized. applicationId[bgtech-ai] txServiceGroup[bgai-tx-group]
2025-05-19 14:04:47.417 [main] INFO  io.seata.saga.tm.DefaultSagaTransactionalTemplate - Resource Manager is initialized. applicationId[bgtech-ai] txServiceGroup[bgai-tx-group]
2025-05-19 14:04:47.418 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - will register resourceId:bgtech-ai#bgai-tx-group
2025-05-19 14:04:47.418 [main] INFO  io.seata.saga.tm.DefaultSagaTransactionalTemplate - Global Transaction Clients are initialized. 
2025-05-19 14:04:47.426 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.rm.AbstractRMHandler - the rm client received response msg [RegisterRMResponse{version='1.8.1-SNAPSHOT', extraData='null', identified=true, resultCode=null, msg='null'}] from tc server.
2025-05-19 14:04:48.742 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - Starting ProtocolHandler ["http-nio-8080"]
2025-05-19 14:04:48.756 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat started on port(s): 8080 (http) with context path ''
2025-05-19 14:04:48.766 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from ans.namespace attribute : null
2025-05-19 14:04:48.766 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from ALIBABA_ALIWARE_NAMESPACE attribute :null
2025-05-19 14:04:48.767 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from namespace attribute :null
2025-05-19 14:04:48.777 [main] INFO  c.a.n.p.auth.spi.client.ClientAuthPluginManager - [ClientAuthPluginManager] Load ClientAuthService com.alibaba.nacos.client.auth.impl.NacosClientAuthServiceImpl success.
2025-05-19 14:04:48.777 [main] INFO  c.a.n.p.auth.spi.client.ClientAuthPluginManager - [ClientAuthPluginManager] Load ClientAuthService com.alibaba.nacos.client.auth.ram.RamClientAuthServiceImpl success.
2025-05-19 14:04:48.781 [main] INFO  com.alibaba.nacos.common.remote.client - [RpcClientFactory] create a new rpc client of 0f1ec11a-cb7b-4a91-bb71-b16ca1977a1c
2025-05-19 14:04:48.782 [main] INFO  com.alibaba.nacos.common.remote.client - [0f1ec11a-cb7b-4a91-bb71-b16ca1977a1c] RpcClient init, ServerListFactory = com.alibaba.nacos.client.naming.core.ServerListManager
2025-05-19 14:04:48.782 [main] INFO  com.alibaba.nacos.common.remote.client - [0f1ec11a-cb7b-4a91-bb71-b16ca1977a1c] Registry connection listener to current client:com.alibaba.nacos.client.naming.remote.gprc.redo.NamingGrpcRedoService
2025-05-19 14:04:48.783 [main] INFO  com.alibaba.nacos.common.remote.client - [0f1ec11a-cb7b-4a91-bb71-b16ca1977a1c] Register server push request handler:com.alibaba.nacos.client.naming.remote.gprc.NamingPushRequestHandler
2025-05-19 14:04:48.783 [main] INFO  com.alibaba.nacos.common.remote.client - [0f1ec11a-cb7b-4a91-bb71-b16ca1977a1c] Try to connect to server on start up, server: {serverIp = '8.133.246.113', server main port = 8848}
2025-05-19 14:04:48.783 [main] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - grpc client connection server:8.133.246.113 ip,serverPort:9848,grpcTslConfig:{"sslProvider":"OPENSSL","enableTls":false,"mutualAuthEnable":false,"trustAll":false}
2025-05-19 14:04:48.912 [main] INFO  com.alibaba.nacos.common.remote.client - [0f1ec11a-cb7b-4a91-bb71-b16ca1977a1c] Success to connect to server [8.133.246.113:8848] on start up, connectionId = 1747634688803_139.227.195.203_42522
2025-05-19 14:04:48.912 [main] INFO  com.alibaba.nacos.common.remote.client - [0f1ec11a-cb7b-4a91-bb71-b16ca1977a1c] Register server push request handler:com.alibaba.nacos.common.remote.client.RpcClient$ConnectResetRequestHandler
2025-05-19 14:04:48.912 [main] INFO  com.alibaba.nacos.common.remote.client - [0f1ec11a-cb7b-4a91-bb71-b16ca1977a1c] Register server push request handler:com.alibaba.nacos.common.remote.client.RpcClient$$Lambda/0x0000023c5152a060
2025-05-19 14:04:48.912 [com.alibaba.nacos.client.remote.worker] INFO  com.alibaba.nacos.common.remote.client - [0f1ec11a-cb7b-4a91-bb71-b16ca1977a1c] Notify connected event to listeners.
2025-05-19 14:04:48.912 [com.alibaba.nacos.client.remote.worker] INFO  com.alibaba.nacos.client.naming - Grpc connection connect
2025-05-19 14:04:48.913 [main] INFO  com.alibaba.nacos.client.naming - [REGISTER-SERVICE] d750d92e-152f-4055-a641-3bc9dda85a29 registering service bgtech-ai with instance Instance{instanceId='null', ip='192.168.86.8', port=8080, weight=1.0, healthy=true, enabled=true, ephemeral=true, clusterName='DEFAULT', serviceName='null', metadata={IPv6=[2408:820c:7528:8342:b486:9b72:4b72:4bf0], preserved.register.source=SPRING_CLOUD}}
2025-05-19 14:04:48.932 [main] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - nacos registry, DEFAULT_GROUP bgtech-ai 192.168.86.8:8080 register finished
2025-05-19 14:04:48.994 [main] INFO  com.bgpay.bgai.BgaiApplication - Started BgaiApplication in 16.727 seconds (process running for 18.172)
2025-05-19 14:04:48.997 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-19 14:04:48.998 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-19 14:04:49.011 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-19 14:04:49.012 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-19 14:04:49.013 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-19 14:04:49.022 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-19 14:04:49.023 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-19 14:04:49.024 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-19 14:04:49.032 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-19 14:04:49.032 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-19 14:04:49.033 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-19 14:04:49.039 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-19 14:04:49.040 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - ==================== Saga状态机加载报告 ====================
2025-05-19 14:04:49.040 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - Saga状态机配置加载状态: 成功
2025-05-19 14:04:49.040 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 已加载的状态机定义文件数量: 1
2025-05-19 14:04:49.040 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 已加载的状态机定义文件:
2025-05-19 14:04:49.040 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig -  - /E:/project/bgai/target/classes/statelang/bgai-saga-transaction.json
2025-05-19 14:04:49.040 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - Saga解析器状态: CUSTOM_FASTJSON2
2025-05-19 14:04:49.040 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 状态机解析结果: 成功 1 个, 失败 0 个
2025-05-19 14:04:49.040 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - =============================================================
2025-05-19 14:04:49.046 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - nacos.cache.data.init.snapshot = true 
2025-05-19 14:04:49.047 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] common-dev.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-19 14:04:49.057 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=common-dev.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-19 14:04:49.057 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=common-dev.yaml, group=DEFAULT_GROUP
2025-05-19 14:04:49.058 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-19 14:04:49.058 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-19 14:04:49.058 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai.yaml, group=DEFAULT_GROUP
2025-05-19 14:04:49.059 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai-dev.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-19 14:04:49.059 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai-dev.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-19 14:04:49.059 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai-dev.yaml, group=DEFAULT_GROUP
2025-05-19 14:04:49.060 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-19 14:04:49.060 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai, group=DEFAULT_GROUP, cnt=1
2025-05-19 14:04:49.060 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai, group=DEFAULT_GROUP
2025-05-19 14:05:01.362 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - 接收到请求: /api/chatGatWay-internal, 文件=新文件 17.txt, 问题参数=null, 模型参数=null
2025-05-19 14:05:01.363 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - 请求Content-Type: multipart/form-data;boundary=--------------------------758616327741094174574926
2025-05-19 14:05:01.364 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - 收集到的完整参数: question="null", apiUrl="null", modelName="null", multiTurn=false
2025-05-19 14:05:01.365 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - Processing request for user ID: 689258T
2025-05-19 14:05:01.365 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - Processing file with circuit breaker: fileName=新文件 17.txt, question=
2025-05-19 14:05:01.367 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.config.ReactiveFileProcessor - Processing file: 新文件 17.txt, content-type: text/plain
2025-05-19 14:05:01.374 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - PARAM TRACE [689258T]: 尝试查找匹配配置 - 参数: apiUrl=null, modelName=null
2025-05-19 14:05:01.383 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 查询配置 - userId=689258T
2025-05-19 14:05:01.385 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 排序方式 - 按ID降序
2025-05-19 14:05:01.385 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 限制结果数 - LIMIT 1
2025-05-19 14:05:01.449 [http-nio-8080-exec-2] DEBUG com.bgpay.bgai.mapper.ApiConfigMapper.selectList - ==>  Preparing: SELECT id,api_url,api_key,model_name,user_id FROM api_config WHERE (user_id = ?) ORDER BY id DESC LIMIT 1
2025-05-19 14:05:01.450 [http-nio-8080-exec-2] DEBUG com.bgpay.bgai.mapper.ApiConfigMapper.selectList - ==> Parameters: 689258T(String)
2025-05-19 14:05:01.460 [http-nio-8080-exec-2] DEBUG com.bgpay.bgai.mapper.ApiConfigMapper.selectList - <==      Total: 1
2025-05-19 14:05:01.460 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 查询结果 - 找到配置: id=2, modelName=deepseek-chat
2025-05-19 14:05:01.460 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - PARAM TRACE [689258T]: 找到匹配配置 - apiUrl=https://api.deepseek.com/chat/completions, modelName=deepseek-chat (原始请求: null)
2025-05-19 14:05:01.460 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - API config resolved: url=https://api.deepseek.com/chat/completions, model=deepseek-chat
2025-05-19 14:05:01.477 [Thread-50] INFO  com.bgpay.bgai.config.ReactiveFileProcessor - File processed successfully: size=6680 bytes
2025-05-19 14:05:01.481 [Thread-50] INFO  com.bgpay.bgai.controller.ReactiveChatController - Content processed, length: 6603
2025-05-19 14:05:01.489 [Thread-50] INFO  io.seata.tm.TransactionManagerHolder - TransactionManager Singleton io.seata.tm.DefaultTransactionManager@3c5e0d04
2025-05-19 14:05:01.508 [Thread-50] INFO  io.seata.tm.api.DefaultGlobalTransaction - Begin new global transaction [seata-server:8091:27673667088527376]
2025-05-19 14:05:01.511 [Thread-50] INFO  c.b.bgai.interceptor.SeataTransactionInterceptor - 准备记录分布式事务开始: XID=seata-server:8091:27673667088527376, 业务=com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive, 路径=, IP=, 用户=system
2025-05-19 14:05:01.529 [Thread-50] INFO  c.b.bgai.service.impl.TransactionLogServiceImpl - 记录分布式事务开始: XID=seata-server:8091:27673667088527376, 业务=com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive
2025-05-19 14:05:01.536 [Thread-50] DEBUG com.bgpay.bgai.mapper.TransactionLogMapper.insert - ==>  Preparing: INSERT INTO transaction_log ( xid, transaction_name, transaction_mode, status, request_path, source_ip, start_time, user_id, create_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-05-19 14:05:01.540 [Thread-50] DEBUG com.bgpay.bgai.mapper.TransactionLogMapper.insert - ==> Parameters: seata-server:8091:27673667088527376(String), com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive(String), AT(String), ACTIVE(String), (String), (String), 2025-05-19T14:05:01.529115400(LocalDateTime), system(String), 2025-05-19T14:05:01.529115400(LocalDateTime)
2025-05-19 14:05:01.961 [Thread-50] DEBUG com.bgpay.bgai.mapper.TransactionLogMapper.insert - <==    Updates: 1
2025-05-19 14:05:01.981 [Thread-50] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:27673667088527376, branchId:27673667088527377, lockKeys:transaction_log:4
2025-05-19 14:05:01.993 [Thread-50] WARN  i.s.c.l.EnhancedServiceLoader$InnerEnhancedServiceLoader - Load [io.seata.rm.datasource.undo.parser.ProtostuffUndoLogParser] class fail: io/protostuff/runtime/IdStrategy
2025-05-19 14:05:02.060 [Thread-50] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:27673667088527376, branchId:27673667088527378, lockKeys:transaction_log:4;undo_log:13
2025-05-19 14:05:02.090 [Thread-50] INFO  c.b.bgai.interceptor.SeataTransactionInterceptor - 开始分布式事务: XID=seata-server:8091:27673667088527376, 方法=com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive
2025-05-19 14:05:02.100 [Thread-50] INFO  org.reflections.Reflections - Processing reactive request: content length=6603, apiUrl=https://api.deepseek.com/chat/completions, modelName=deepseek-chat, userId=689258T, multiTurn=false
2025-05-19 14:05:02.122 [Thread-50] INFO  com.bgpay.bgai.transaction.TransactionCoordinator - Transaction prepared for user 689258T: chatCompletionId=chat-baa5e142-b24d-4c36-8304-2b9664522f2c
2025-05-19 14:05:02.124 [Thread-50] INFO  org.reflections.Reflections - Generated request JSON with 2PC transaction: {"stream":false,"max_tokens":2000,"temperature":1.0,"messages":[{"role":"system","content":"You are ...
2025-05-19 14:05:02.148 [Thread-50] INFO  c.b.bgai.service.impl.TransactionLogServiceImpl - 记录分布式事务结束: XID=seata-server:8091:27673667088527376, 状态=COMMITTED
2025-05-19 14:05:02.150 [Thread-50] DEBUG c.b.bgai.mapper.TransactionLogMapper.selectList - ==>  Preparing: SELECT id,xid,branch_id,transaction_name,transaction_mode,status,request_path,source_ip,start_time,end_time,user_id,extra_data,create_time,update_time FROM transaction_log WHERE (xid = ?) LIMIT 1
2025-05-19 14:05:02.153 [Thread-50] DEBUG c.b.bgai.mapper.TransactionLogMapper.selectList - ==> Parameters: seata-server:8091:27673667088527376(String)
2025-05-19 14:05:02.160 [Thread-50] DEBUG c.b.bgai.mapper.TransactionLogMapper.selectList - <==      Total: 1
2025-05-19 14:05:02.164 [Thread-50] DEBUG c.b.bgai.mapper.TransactionLogMapper.updateById - ==>  Preparing: UPDATE transaction_log SET xid=?, transaction_name=?, transaction_mode=?, status=?, request_path=?, source_ip=?, start_time=?, end_time=?, user_id=?, extra_data=?, create_time=?, update_time=? WHERE id=?
2025-05-19 14:05:02.174 [Thread-50] DEBUG c.b.bgai.mapper.TransactionLogMapper.updateById - ==> Parameters: seata-server:8091:27673667088527376(String), com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive(String), AT(String), COMMITTED(String), (String), (String), 2025-05-19T14:05:02(LocalDateTime), 2025-05-19T14:05:02.161365100(LocalDateTime), system(String), {"duration":51,"result":"success"}(String), 2025-05-19T14:05:02(LocalDateTime), 2025-05-19T14:05:02.161365100(LocalDateTime), 4(Long)
2025-05-19 14:05:02.229 [Thread-50] DEBUG c.b.bgai.mapper.TransactionLogMapper.updateById - <==    Updates: 1
2025-05-19 14:05:02.239 [Thread-50] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:27673667088527376, branchId:27673667088527379, lockKeys:transaction_log:4
2025-05-19 14:05:02.267 [Thread-50] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:27673667088527376, branchId:27673667088527380, lockKeys:transaction_log:4;undo_log:15
2025-05-19 14:05:02.291 [Thread-50] INFO  c.b.bgai.interceptor.SeataTransactionInterceptor - 分布式事务成功完成: XID=seata-server:8091:27673667088527376, 耗时=51ms
2025-05-19 14:05:02.291 [Thread-50] INFO  io.seata.tm.api.DefaultGlobalTransaction - transaction seata-server:8091:27673667088527376 will be commit
2025-05-19 14:05:02.304 [Thread-50] INFO  io.seata.tm.api.DefaultGlobalTransaction - transaction end, xid = seata-server:8091:27673667088527376
2025-05-19 14:05:02.304 [Thread-50] INFO  io.seata.tm.api.DefaultGlobalTransaction - [seata-server:8091:27673667088527376] commit status: Committed
2025-05-19 14:05:02.625 [rpcDispatch_RMROLE_1_1_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:27673667088527376', branchId=27673667088527377, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false,"skipCheckLock":true}'}
2025-05-19 14:05:02.626 [rpcDispatch_RMROLE_1_1_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:27673667088527376 27673667088527377 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false,"skipCheckLock":true}
2025-05-19 14:05:02.626 [rpcDispatch_RMROLE_1_1_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-19 14:05:02.636 [rpcDispatch_RMROLE_1_2_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:27673667088527376', branchId=27673667088527378, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false,"skipCheckLock":true}'}
2025-05-19 14:05:02.636 [rpcDispatch_RMROLE_1_2_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:27673667088527376 27673667088527378 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false,"skipCheckLock":true}
2025-05-19 14:05:02.636 [rpcDispatch_RMROLE_1_2_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-19 14:05:02.644 [rpcDispatch_RMROLE_1_3_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:27673667088527376', branchId=27673667088527379, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false}'}
2025-05-19 14:05:02.644 [rpcDispatch_RMROLE_1_3_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:27673667088527376 27673667088527379 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false}
2025-05-19 14:05:02.644 [rpcDispatch_RMROLE_1_3_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-19 14:05:02.653 [rpcDispatch_RMROLE_1_4_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:27673667088527376', branchId=27673667088527380, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false}'}
2025-05-19 14:05:02.653 [rpcDispatch_RMROLE_1_4_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:27673667088527376 27673667088527380 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false}
2025-05-19 14:05:02.653 [rpcDispatch_RMROLE_1_4_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-19 14:05:33.527 [reactor-http-nio-3] INFO  org.reflections.Reflections - Raw response received, length: 2976
2025-05-19 14:05:33.534 [reactor-http-nio-3] WARN  org.reflections.Reflections - Received different chatCompletionId from response: 66bbf2d7-730a-4a21-8fee-a0ef2f76b090 vs prepared: chat-baa5e142-b24d-4c36-8304-2b9664522f2c
2025-05-19 14:05:33.550 [reactor-http-nio-3] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - ==>  Preparing: INSERT INTO chat_completions ( object, created, model, system_fingerprint, api_key ) VALUES ( ?, ?, ?, ?, ? )
2025-05-19 14:05:33.550 [reactor-http-nio-3] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - ==> Parameters: chat.completion(String), 1747634733548(Long), deepseek-chat(String), 689258T(String), chat-baa5e142-b24d-4c36-8304-2b9664522f2c(String)
2025-05-19 14:05:33.563 [reactor-http-nio-3] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - <==    Updates: 1
2025-05-19 14:05:33.563 [reactor-http-nio-3] INFO  com.bgpay.bgai.transaction.TransactionCoordinator - Transaction committed for user 689258T: chatCompletionId=chat-baa5e142-b24d-4c36-8304-2b9664522f2c
2025-05-19 14:05:33.599 [FileWrite-1] INFO  com.bgpay.bgai.service.deepseek.FileWriterService - Successfully wrote content to: \var\data\ai_responses\a67d49ec-757f-4f7b-8e32-6d070b56b713.txt
2025-05-19 14:05:33.608 [boundedElastic-1] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - ==>  Preparing: INSERT INTO chat_completions ( object, created, model, system_fingerprint, api_key ) VALUES ( ?, ?, ?, ?, ? )
2025-05-19 14:05:33.609 [boundedElastic-1] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - ==> Parameters: chat.completion(String), 1747634702(Long), deepseek-chat(String), fp_8802369eaa_prod0425fp8(String), chat-baa5e142-b24d-4c36-8304-2b9664522f2c(String)
2025-05-19 14:05:33.623 [boundedElastic-1] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - <==    Updates: 1
2025-05-19 14:05:33.651 [boundedElastic-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.insert - ==>  Preparing: INSERT INTO usage_info ( chat_completion_id, prompt_tokens, completion_tokens, total_tokens, prompt_tokens_cached, completion_reasoning_tokens, prompt_cache_hit_tokens, prompt_cache_miss_tokens, created_at, model_type ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-05-19 14:05:33.653 [boundedElastic-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.insert - ==> Parameters: chat-baa5e142-b24d-4c36-8304-2b9664522f2c(String), 2209(Integer), 585(Integer), 2794(Integer), 2176(Integer), 0(Integer), 0(Integer), 33(Integer), 2025-05-19T14:05:33.641346600(LocalDateTime), deepseek-chat(String)
2025-05-19 14:05:33.663 [boundedElastic-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.insert - <==    Updates: 1
2025-05-19 14:05:33.679 [boundedElastic-1] INFO  org.reflections.Reflections - Completion data saved synchronously for chatCompletionId: chat-baa5e142-b24d-4c36-8304-2b9664522f2c
2025-05-19 14:05:33.684 [boundedElastic-2] INFO  org.reflections.Reflections - 开始发送账单消息，chatCompletionId: chat-baa5e142-b24d-4c36-8304-2b9664522f2c, userId: 689258T
2025-05-19 14:05:33.732 [boundedElastic-2] INFO  org.reflections.Reflections - 账单消息发送成功，chatCompletionId: chat-baa5e142-b24d-4c36-8304-2b9664522f2c, userId: 689258T
2025-05-19 14:05:33.736 [boundedElastic-1] INFO  org.reflections.Reflections - Complete processing chain completed: The provided file appears to be a Spring Boot application configuration file (likely `application.yml`) with multiple configurations for different components. Here's a summary of the key configurations:

### Core Spring Configurations
1. **Application Basics**
   - Application name: `bgai`
   - Active profile: `dev`
   - Allows bean definition overriding

2. **Database**
   - MySQL master/slave configuration using Druid connection pool
   - Connection details for `8.133.246.113:3306/deepseek`
   - JPA/Hibernate configured with MySQL8 dialect and `ddl-auto: update`

3. **Redis**
   - Single Redis instance at `8.133.246.113:6379`
   - Used for both Spring Session and application cache
   - Password protected

4. **Performance**
   - Async task pool with 50-200 threads
   - HTTP connection limits (max 200 total, 50 per route)
   - File upload limits (200MB)

### External Services
1. **RocketMQ**
   - Name server at `8.133.246.113:9876`
   - Producer/consumer groups for billing
   - Dedicated topic for chat logs

2. **Flink**
   - Job manager at `8.133.246.113:8081`

### Resilience & Reliability
1. **Resilience4j Circuit Breakers**
   - Three configured instances with different thresholds
   - Time limiters for API calls (60s timeout for deepseek API)
   - Retry configurations with exponential backoff

2. **Logging**
   - JSON formatted logs output to `/var/data/ai_responses/application.log`
   - Using Nacos logback configuration

### Security
1. **SSO OAuth2**
   - Client credentials and endpoint URLs
   - All endpoints point to localhost:8080

2. **API Security**
   - Two API keys configured for client authentication

### Special Features
1. **Conversation**
   - Maintains 5 rounds of conversation history (10 messages)

2. **File Processing**
   - Output path for AI responses at `/var/data/ai_responses`
   - Tesseract OCR data path configured

### Notable Security Observations
- All database/Redis/MQ services use the same IP (`8.133.246.113`)
- Passwords are visible in plaintext (MySQL, Redis)
- SSL is disabled for MySQL connections (`useSSL=false`)
- SSO endpoints point to localhost (may need adjustment for production)

This appears to be a backend service handling conversations, possibly with AI capabilities, using Redis for session management, MySQL for persistence, and RocketMQ for asynchronous processing. The resilience configurations suggest it makes external API calls (to Deepseek) that need fault tolerance.
2025-05-19 14:05:33.737 [boundedElastic-1] INFO  com.bgpay.bgai.controller.ReactiveChatController - Processed response for user 689258T, content length: 2456
2025-05-19 14:05:46.581 [pool-7-thread-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.selectCount - ==>  Preparing: SELECT COUNT( * ) AS total FROM usage_info WHERE (chat_completion_id = ?)
2025-05-19 14:05:46.582 [pool-7-thread-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.selectCount - ==> Parameters: chat-baa5e142-b24d-4c36-8304-2b9664522f2c(String)
2025-05-19 14:05:46.588 [pool-7-thread-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.selectCount - <==      Total: 1
2025-05-19 14:05:46.732 [ConsumeMessageThread_billing-consumer-group_1] INFO  c.bgpay.bgai.service.mq.RocketMQBillingServiceImpl - Output price config priceVersion: 1
2025-05-19 14:05:46.734 [ConsumeMessageThread_billing-consumer-group_1] DEBUG com.bgpay.bgai.mapper.UsageRecordMapper.insert - ==>  Preparing: INSERT INTO usage_record ( model_type, chat_completion_id, user_id, input_cost, output_cost, price_version, calculated_at ) VALUES ( ?, ?, ?, ?, ?, ?, ? )
2025-05-19 14:05:46.735 [ConsumeMessageThread_billing-consumer-group_1] DEBUG com.bgpay.bgai.mapper.UsageRecordMapper.insert - ==> Parameters: deepseek-chat(String), chat-baa5e142-b24d-4c36-8304-2b9664522f2c(String), 689258T(String), 0.0001(BigDecimal), 0.0047(BigDecimal), 1(Integer), 2025-05-19T14:05:46.733914400(LocalDateTime)
2025-05-19 14:05:46.761 [ConsumeMessageThread_billing-consumer-group_1] DEBUG com.bgpay.bgai.mapper.UsageRecordMapper.insert - <==    Updates: 1
2025-05-19 14:05:46.772 [ConsumeMessageThread_billing-consumer-group_1] INFO  c.bgpay.bgai.service.mq.RocketMQBillingServiceImpl - Message consumed: 2408820C75288342B4869B724B724BF077F036BAF30C5FB89A8E0000
2025-05-19 14:07:29.684 [Thread-1] WARN  c.alibaba.nacos.common.http.HttpClientBeanHolder - [HttpClientBeanHolder] Start destroying common HttpClient
2025-05-19 14:07:29.685 [Thread-7] WARN  com.alibaba.nacos.common.notify.NotifyCenter - [NotifyCenter] Start destroying Publisher
2025-05-19 14:07:29.685 [Thread-7] WARN  com.alibaba.nacos.common.notify.NotifyCenter - [NotifyCenter] Destruction of the end
2025-05-19 14:07:29.685 [Thread-1] WARN  c.alibaba.nacos.common.http.HttpClientBeanHolder - [HttpClientBeanHolder] Destruction of the end
2025-05-19 14:07:29.702 [NettyClientSelector_TMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - channel inactive: [id: 0x1c4d51a7, L:/192.168.86.8:61022 ! R:/8.133.246.113:8091]
2025-05-19 14:07:29.702 [NettyClientSelector_TMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - return to pool, rm channel:[id: 0x1c4d51a7, L:/192.168.86.8:61022 ! R:/8.133.246.113:8091]
2025-05-19 14:07:29.702 [NettyClientSelector_TMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - channel valid false,channel:[id: 0x1c4d51a7, L:/192.168.86.8:61022 ! R:/8.133.246.113:8091]
2025-05-19 14:07:29.702 [NettyClientSelector_TMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - will destroy channel:[id: 0x1c4d51a7, L:/192.168.86.8:61022 ! R:/8.133.246.113:8091]
2025-05-19 14:07:29.702 [NettyClientSelector_TMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0x1c4d51a7, L:/192.168.86.8:61022 ! R:/8.133.246.113:8091]) will closed
2025-05-19 14:07:29.702 [NettyClientSelector_TMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0x1c4d51a7, L:/192.168.86.8:61022 ! R:/8.133.246.113:8091]) will closed
2025-05-19 14:07:29.703 [NettyClientSelector_RMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - channel inactive: [id: 0x553d6c22, L:/192.168.86.8:61026 ! R:/8.133.246.113:8091]
2025-05-19 14:07:29.703 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - return to pool, rm channel:[id: 0x553d6c22, L:/192.168.86.8:61026 ! R:/8.133.246.113:8091]
2025-05-19 14:07:29.703 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - channel valid false,channel:[id: 0x553d6c22, L:/192.168.86.8:61026 ! R:/8.133.246.113:8091]
2025-05-19 14:07:29.703 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - will destroy channel:[id: 0x553d6c22, L:/192.168.86.8:61026 ! R:/8.133.246.113:8091]
2025-05-19 14:07:29.703 [NettyClientSelector_RMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0x553d6c22, L:/192.168.86.8:61026 ! R:/8.133.246.113:8091]) will closed
2025-05-19 14:07:29.703 [NettyClientSelector_RMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0x553d6c22, L:/192.168.86.8:61026 ! R:/8.133.246.113:8091]) will closed
2025-05-19 14:07:29.705 [SpringContextShutdownHook] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - De-registering from Nacos Server now...
2025-05-19 14:07:29.705 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - [DEREGISTER-SERVICE] d750d92e-152f-4055-a641-3bc9dda85a29 deregistering service bgtech-ai with instance: Instance{instanceId='null', ip='192.168.86.8', port=8080, weight=1.0, healthy=true, enabled=true, ephemeral=true, clusterName='DEFAULT', serviceName='null', metadata={}}
2025-05-19 14:07:29.714 [SpringContextShutdownHook] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - De-registration finished.
2025-05-19 14:07:29.715 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.cache.ServiceInfoHolder do shutdown begin
2025-05-19 14:07:29.715 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.backups.FailoverReactor do shutdown begin
2025-05-19 14:07:29.715 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.backups.FailoverReactor do shutdown stop
2025-05-19 14:07:29.715 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.cache.ServiceInfoHolder do shutdown stop
2025-05-19 14:07:29.715 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.NamingClientProxyDelegate do shutdown begin
2025-05-19 14:07:29.715 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServiceInfoUpdateService do shutdown begin
2025-05-19 14:07:29.715 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServiceInfoUpdateService do shutdown stop
2025-05-19 14:07:29.715 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServerListManager do shutdown begin
2025-05-19 14:07:29.715 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Start destroying NacosRestTemplate
2025-05-19 14:07:29.715 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Destruction of the end
2025-05-19 14:07:29.715 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServerListManager do shutdown stop
2025-05-19 14:07:29.715 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.http.NamingHttpClientProxy do shutdown begin
2025-05-19 14:07:29.715 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Start destroying NacosRestTemplate
2025-05-19 14:07:29.715 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Destruction of the end
2025-05-19 14:07:29.715 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.http.NamingHttpClientProxy do shutdown stop
2025-05-19 14:07:29.715 [SpringContextShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Shutdown rpc client, set status to shutdown
2025-05-19 14:07:29.715 [SpringContextShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Shutdown client event executor java.util.concurrent.ScheduledThreadPoolExecutor@21bac1a8[Running, pool size = 2, active threads = 2, queued tasks = 0, completed tasks = 0]
2025-05-19 14:07:29.715 [SpringContextShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Close current connection 1747634688803_139.227.195.203_42522
2025-05-19 14:07:29.719 [nacos-grpc-client-executor-8.133.246.113-49] WARN  c.a.nacos.common.remote.client.grpc.GrpcClient - [1747634688803_139.227.195.203_42522]Ignore error event,isRunning:false,isAbandon=false
2025-05-19 14:07:29.721 [SpringContextShutdownHook] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - Shutdown grpc executor java.util.concurrent.ThreadPoolExecutor@6c1315c3[Running, pool size = 4, active threads = 0, queued tasks = 0, completed tasks = 50]
2025-05-19 14:07:29.721 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - Shutdown grpc redo service executor java.util.concurrent.ScheduledThreadPoolExecutor@1690283c[Running, pool size = 1, active threads = 0, queued tasks = 1, completed tasks = 53]
2025-05-19 14:07:29.721 [SpringContextShutdownHook] INFO  c.a.n.client.auth.ram.identify.CredentialWatcher - [null] CredentialWatcher is stopped
2025-05-19 14:07:29.721 [SpringContextShutdownHook] INFO  c.a.n.client.auth.ram.identify.CredentialService - [null] CredentialService is freed
2025-05-19 14:07:29.721 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.NamingClientProxyDelegate do shutdown stop
2025-05-19 14:07:31.746 [SpringContextShutdownHook] DEBUG com.bgpay.bgai.config.AsyncConfig$1 - Shutting down ExecutorService 'blockingExecutor'
2025-05-19 14:07:31.792 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:10909] result: true
2025-05-19 14:07:31.792 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:10911] result: true
2025-05-19 14:07:31.792 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:9876] result: true
2025-05-19 14:07:31.807 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:10911] result: true
2025-05-19 14:07:31.807 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:9876] result: true
2025-05-19 14:07:31.916 [SpringContextShutdownHook] INFO  o.s.orm.jpa.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-05-19 14:07:31.918 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-2} closing ...
2025-05-19 14:07:31.925 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-2} closed
2025-05-19 14:07:31.925 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} closing ...
2025-05-19 14:07:31.926 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} closed
2025-05-19 14:54:55.488 [main] WARN  com.alibaba.nacos.client.logging.NacosLogging - Load Logback Configuration of Nacos fail, message: Could not initialize Logback Nacos logging from classpath:nacos-logback.xml
2025-05-19 14:54:55.489 [main] INFO  com.bgpay.bgai.BgaiApplication - The following 1 profile is active: "dev"
2025-05-19 14:54:56.954 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-05-19 14:54:56.955 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-05-19 14:54:56.982 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 20 ms. Found 0 JPA repository interfaces.
2025-05-19 14:54:56.995 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-05-19 14:54:56.996 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-05-19 14:54:57.012 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 6 ms. Found 0 Redis repository interfaces.
2025-05-19 14:54:57.594 [main] INFO  io.seata.config.ConfigurationFactory - load Configuration from :Spring Configuration
2025-05-19 14:54:57.603 [main] INFO  io.seata.config.ConfigurationFactory - load Configuration from :Spring Configuration
2025-05-19 14:54:57.609 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Initializing Global Transaction Clients ... 
2025-05-19 14:54:57.713 [main] INFO  io.seata.core.rpc.netty.NettyClientBootstrap - NettyClientBootstrap has started
2025-05-19 14:54:57.715 [main] INFO  io.seata.discovery.registry.RegistryFactory - use registry center type: file
2025-05-19 14:54:57.731 [main] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - will connect to 8.133.246.113:8091
2025-05-19 14:54:57.739 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - NettyPool create channel to transactionRole:TMROLE,address:8.133.246.113:8091,msg:< RegisterTMRequest{version='1.7.0', applicationId='bgtech-ai', transactionServiceGroup='bgai-tx-group', extraData='ak=null
digest=bgai-tx-group,192.168.86.8,1747637697735
timestamp=1747637697735
authVersion=V4
vgroup=bgai-tx-group
ip=192.168.86.8
'} >
2025-05-19 14:54:57.951 [main] INFO  io.seata.core.rpc.netty.TmNettyRemotingClient - register TM success. client version:1.7.0, server version:1.8.1-SNAPSHOT,channel:[id: 0x86801d26, L:/192.168.86.8:49290 - R:/8.133.246.113:8091]
2025-05-19 14:54:57.957 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - register success, cost 138 ms, version:1.8.1-SNAPSHOT,role:TMROLE,channel:[id: 0x86801d26, L:/192.168.86.8:49290 - R:/8.133.246.113:8091]
2025-05-19 14:54:57.958 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Transaction Manager Client is initialized. applicationId[bgtech-ai] txServiceGroup[bgai-tx-group]
2025-05-19 14:54:57.968 [main] INFO  io.seata.rm.datasource.AsyncWorker - Async Commit Buffer Limit: 10000
2025-05-19 14:54:57.968 [main] INFO  io.seata.rm.datasource.xa.ResourceManagerXA - ResourceManagerXA init ...
2025-05-19 14:54:57.973 [main] INFO  io.seata.core.rpc.netty.NettyClientBootstrap - NettyClientBootstrap has started
2025-05-19 14:54:57.974 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Resource Manager is initialized. applicationId[bgtech-ai] txServiceGroup[bgai-tx-group]
2025-05-19 14:54:57.974 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Global Transaction Clients are initialized. 
2025-05-19 14:54:59.094 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat initialized with port(s): 8080 (http)
2025-05-19 14:54:59.104 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - The ["http-nio-8080"] connector has been configured to support HTTP upgrade to [h2c]
2025-05-19 14:54:59.104 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - Initializing ProtocolHandler ["http-nio-8080"]
2025-05-19 14:54:59.105 [main] INFO  org.apache.catalina.core.StandardService - Starting service [Tomcat]
2025-05-19 14:54:59.105 [main] INFO  org.apache.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.15]
2025-05-19 14:54:59.504 [main] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} inited
2025-05-19 14:54:59.752 [main] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - will connect to 8.133.246.113:8091
2025-05-19 14:54:59.752 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - RM will register :jdbc:mysql://8.133.246.113:3306/deepseek
2025-05-19 14:54:59.752 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - NettyPool create channel to transactionRole:RMROLE,address:8.133.246.113:8091,msg:< RegisterRMRequest{resourceIds='jdbc:mysql://8.133.246.113:3306/deepseek', version='1.7.0', applicationId='bgtech-ai', transactionServiceGroup='bgai-tx-group', extraData='null'} >
2025-05-19 14:54:59.808 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - register RM success. client version:1.7.0, server version:1.8.1-SNAPSHOT,channel:[id: 0xcc5a1de7, L:/192.168.86.8:49292 - R:/8.133.246.113:8091]
2025-05-19 14:54:59.809 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - register success, cost 48 ms, version:1.8.1-SNAPSHOT,role:RMROLE,channel:[id: 0xcc5a1de7, L:/192.168.86.8:49292 - R:/8.133.246.113:8091]
2025-05-19 14:54:59.810 [main] INFO  i.s.s.a.datasource.SeataAutoDataSourceProxyCreator - Auto proxy data source 'masterDataSource' by 'AT' mode.
2025-05-19 14:54:59.877 [main] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-2} inited
2025-05-19 14:54:59.946 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - will register resourceId:jdbc:mysql://8.133.246.113:3306/deepseek
2025-05-19 14:54:59.947 [main] INFO  i.s.s.a.datasource.SeataAutoDataSourceProxyCreator - Auto proxy data source 'slaveDataSource' by 'AT' mode.
2025-05-19 14:54:59.957 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.rm.AbstractRMHandler - the rm client received response msg [RegisterRMResponse{version='1.8.1-SNAPSHOT', extraData='null', identified=true, resultCode=null, msg='null'}] from tc server.
2025-05-19 14:54:59.980 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - will register resourceId:jdbc:mysql://8.133.246.113:3306/deepseek
2025-05-19 14:54:59.981 [main] INFO  i.s.s.a.datasource.SeataAutoDataSourceProxyCreator - Auto proxy data source 'dynamicDataSource' by 'AT' mode.
2025-05-19 14:54:59.991 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.rm.AbstractRMHandler - the rm client received response msg [RegisterRMResponse{version='1.8.1-SNAPSHOT', extraData='null', identified=true, resultCode=null, msg='null'}] from tc server.
2025-05-19 14:55:00.108 [main] INFO  org.hibernate.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-05-19 14:55:00.173 [main] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.1.7.Final
2025-05-19 14:55:00.505 [main] INFO  SQL dialect - HHH000400: Using dialect: org.hibernate.dialect.MySQL8Dialect
2025-05-19 14:55:00.507 [main] WARN  org.hibernate.orm.deprecation - HHH90000026: MySQL8Dialect has been deprecated; use org.hibernate.dialect.MySQLDialect instead
2025-05-19 14:55:00.916 [main] INFO  o.h.e.t.jta.platform.internal.JtaPlatformInitiator - HHH000490: Using JtaPlatform implementation: [org.hibernate.engine.transaction.jta.platform.internal.NoJtaPlatform]
2025-05-19 14:55:00.927 [main] INFO  o.s.orm.jpa.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-05-19 14:55:01.297 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-19 14:55:01.313 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-19 14:55:01.354 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-19 14:55:01.357 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-19 14:55:01.357 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-19 14:55:01.381 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-19 14:55:01.990 [main] INFO  com.bgpay.bgai.service.impl.UserServiceImpl - 初始化SSO配置: clientId=bgai-client-id, redirectUri=http://localhost:8080/api/auth/callback
2025-05-19 14:55:02.121 [main] INFO  com.bgpay.bgai.controller.AuthController - 初始化认证控制器: clientId=bgai-client-id, redirectUri=http://localhost:8080/api/auth/callback
2025-05-19 14:55:02.705 [main] INFO  o.a.r.s.autoconfigure.RocketMQAutoConfiguration - a producer (billing-producer-group) init on namesrv 8.133.246.113:9876
2025-05-19 14:55:02.991 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Bean [com.bgpay.bgai.service.deepseek.DeepSeekServiceImp$$SpringCGLIB$$0] with name [deepSeekServiceImp] would use interceptor [io.seata.spring.annotation.GlobalTransactionalInterceptor]
2025-05-19 14:55:03.317 [main] WARN  i.s.s.b.a.provider.SpringBootConfigurationProvider - The get method not found for the field 'SeataProperties#accesskey'.
2025-05-19 14:55:03.317 [main] WARN  i.s.s.b.a.provider.SpringBootConfigurationProvider - The get method not found for the field 'SeataProperties#secretkey'.
2025-05-19 14:55:03.328 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 加载到1个Saga状态机定义文件
2025-05-19 14:55:03.468 [main] INFO  com.bgpay.bgai.saga.CustomSagaJsonParser - 开始解析状态机定义: bgai-saga-transaction
2025-05-19 14:55:03.469 [main] INFO  com.bgpay.bgai.saga.CustomSagaJsonParser - 状态机定义解析成功: bgai-saga-transaction
2025-05-19 14:55:03.469 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 成功加载状态机定义: /E:/project/bgai/target/classes/statelang/bgai-saga-transaction.json
2025-05-19 14:55:04.072 [main] INFO  org.redisson.Version - Redisson 3.24.3
2025-05-19 14:55:04.214 [redisson-netty-4-6] INFO  o.r.connection.pool.MasterPubSubConnectionPool - 1 connections initialized for 8.133.246.113/8.133.246.113:6379
2025-05-19 14:55:04.563 [redisson-netty-4-19] INFO  org.redisson.connection.pool.MasterConnectionPool - 24 connections initialized for 8.133.246.113/8.133.246.113:6379
2025-05-19 14:55:04.846 [main] INFO  com.bgpay.bgai.service.mq.MQConsumerService - MQ consumer startup successful [group=billing-consumer-group, topic=BILLING_TOPIC, tag=USER_BILLING]
2025-05-19 14:55:04.995 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Bean [com.bgpay.bgai.service.impl.SeataTransactionService$$SpringCGLIB$$0] with name [seataTransactionService] would use interceptor [io.seata.spring.annotation.GlobalTransactionalInterceptor]
2025-05-19 14:55:05.118 [main] DEBUG com.bgpay.bgai.config.AsyncConfig$1 - Initializing ExecutorService 'blockingExecutor'
2025-05-19 14:55:06.510 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [After]
2025-05-19 14:55:06.511 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Before]
2025-05-19 14:55:06.511 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Between]
2025-05-19 14:55:06.511 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Cookie]
2025-05-19 14:55:06.511 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Header]
2025-05-19 14:55:06.511 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Host]
2025-05-19 14:55:06.511 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Method]
2025-05-19 14:55:06.511 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Path]
2025-05-19 14:55:06.511 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Query]
2025-05-19 14:55:06.511 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [ReadBody]
2025-05-19 14:55:06.511 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [RemoteAddr]
2025-05-19 14:55:06.511 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [XForwardedRemoteAddr]
2025-05-19 14:55:06.511 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Weight]
2025-05-19 14:55:06.511 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [CloudFoundryRouteService]
2025-05-19 14:55:07.926 [main] INFO  o.s.b.actuate.endpoint.web.EndpointLinksResolver - Exposing 1 endpoint(s) beneath base path '/actuator'
2025-05-19 14:55:08.279 [main] WARN  i.s.s.b.a.provider.SpringBootConfigurationProvider - The get method not found for the field 'SeataProperties#accesskey'.
2025-05-19 14:55:08.279 [main] WARN  i.s.s.b.a.provider.SpringBootConfigurationProvider - The get method not found for the field 'SeataProperties#secretkey'.
2025-05-19 14:55:08.292 [main] INFO  io.seata.saga.tm.DefaultSagaTransactionalTemplate - Initializing Global Transaction Clients ... 
2025-05-19 14:55:08.293 [main] INFO  io.seata.saga.tm.DefaultSagaTransactionalTemplate - Transaction Manager Client is initialized. applicationId[bgtech-ai] txServiceGroup[bgai-tx-group]
2025-05-19 14:55:08.293 [main] INFO  io.seata.saga.tm.DefaultSagaTransactionalTemplate - Resource Manager is initialized. applicationId[bgtech-ai] txServiceGroup[bgai-tx-group]
2025-05-19 14:55:08.293 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - will register resourceId:bgtech-ai#bgai-tx-group
2025-05-19 14:55:08.293 [main] INFO  io.seata.saga.tm.DefaultSagaTransactionalTemplate - Global Transaction Clients are initialized. 
2025-05-19 14:55:08.303 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.rm.AbstractRMHandler - the rm client received response msg [RegisterRMResponse{version='1.8.1-SNAPSHOT', extraData='null', identified=true, resultCode=null, msg='null'}] from tc server.
2025-05-19 14:55:09.558 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - Starting ProtocolHandler ["http-nio-8080"]
2025-05-19 14:55:09.573 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat started on port(s): 8080 (http) with context path ''
2025-05-19 14:55:09.583 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from ans.namespace attribute : null
2025-05-19 14:55:09.583 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from ALIBABA_ALIWARE_NAMESPACE attribute :null
2025-05-19 14:55:09.584 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from namespace attribute :null
2025-05-19 14:55:09.592 [main] INFO  c.a.n.p.auth.spi.client.ClientAuthPluginManager - [ClientAuthPluginManager] Load ClientAuthService com.alibaba.nacos.client.auth.impl.NacosClientAuthServiceImpl success.
2025-05-19 14:55:09.593 [main] INFO  c.a.n.p.auth.spi.client.ClientAuthPluginManager - [ClientAuthPluginManager] Load ClientAuthService com.alibaba.nacos.client.auth.ram.RamClientAuthServiceImpl success.
2025-05-19 14:55:09.596 [main] INFO  com.alibaba.nacos.common.remote.client - [RpcClientFactory] create a new rpc client of 6452717d-acea-45f2-94bf-522b70fd7580
2025-05-19 14:55:09.598 [main] INFO  com.alibaba.nacos.common.remote.client - [6452717d-acea-45f2-94bf-522b70fd7580] RpcClient init, ServerListFactory = com.alibaba.nacos.client.naming.core.ServerListManager
2025-05-19 14:55:09.598 [main] INFO  com.alibaba.nacos.common.remote.client - [6452717d-acea-45f2-94bf-522b70fd7580] Registry connection listener to current client:com.alibaba.nacos.client.naming.remote.gprc.redo.NamingGrpcRedoService
2025-05-19 14:55:09.598 [main] INFO  com.alibaba.nacos.common.remote.client - [6452717d-acea-45f2-94bf-522b70fd7580] Register server push request handler:com.alibaba.nacos.client.naming.remote.gprc.NamingPushRequestHandler
2025-05-19 14:55:09.598 [main] INFO  com.alibaba.nacos.common.remote.client - [6452717d-acea-45f2-94bf-522b70fd7580] Try to connect to server on start up, server: {serverIp = '8.133.246.113', server main port = 8848}
2025-05-19 14:55:09.599 [main] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - grpc client connection server:8.133.246.113 ip,serverPort:9848,grpcTslConfig:{"sslProvider":"OPENSSL","enableTls":false,"mutualAuthEnable":false,"trustAll":false}
2025-05-19 14:55:09.731 [main] INFO  com.alibaba.nacos.common.remote.client - [6452717d-acea-45f2-94bf-522b70fd7580] Success to connect to server [8.133.246.113:8848] on start up, connectionId = 1747637709623_139.227.195.203_43005
2025-05-19 14:55:09.731 [main] INFO  com.alibaba.nacos.common.remote.client - [6452717d-acea-45f2-94bf-522b70fd7580] Register server push request handler:com.alibaba.nacos.common.remote.client.RpcClient$ConnectResetRequestHandler
2025-05-19 14:55:09.731 [main] INFO  com.alibaba.nacos.common.remote.client - [6452717d-acea-45f2-94bf-522b70fd7580] Register server push request handler:com.alibaba.nacos.common.remote.client.RpcClient$$Lambda/0x00000218da56dc70
2025-05-19 14:55:09.731 [com.alibaba.nacos.client.remote.worker] INFO  com.alibaba.nacos.common.remote.client - [6452717d-acea-45f2-94bf-522b70fd7580] Notify connected event to listeners.
2025-05-19 14:55:09.731 [com.alibaba.nacos.client.remote.worker] INFO  com.alibaba.nacos.client.naming - Grpc connection connect
2025-05-19 14:55:09.732 [main] INFO  com.alibaba.nacos.client.naming - [REGISTER-SERVICE] d750d92e-152f-4055-a641-3bc9dda85a29 registering service bgtech-ai with instance Instance{instanceId='null', ip='192.168.86.8', port=8080, weight=1.0, healthy=true, enabled=true, ephemeral=true, clusterName='DEFAULT', serviceName='null', metadata={IPv6=[2408:820c:7528:8342:b486:9b72:4b72:4bf0], preserved.register.source=SPRING_CLOUD}}
2025-05-19 14:55:09.761 [main] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - nacos registry, DEFAULT_GROUP bgtech-ai 192.168.86.8:8080 register finished
2025-05-19 14:55:09.819 [main] INFO  com.bgpay.bgai.BgaiApplication - Started BgaiApplication in 16.512 seconds (process running for 17.915)
2025-05-19 14:55:09.823 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-19 14:55:09.823 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-19 14:55:09.837 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-19 14:55:09.837 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-19 14:55:09.838 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-19 14:55:09.854 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-19 14:55:09.855 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-19 14:55:09.855 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-19 14:55:09.863 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-19 14:55:09.864 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-19 14:55:09.865 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-19 14:55:09.873 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-19 14:55:09.874 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - ==================== Saga状态机加载报告 ====================
2025-05-19 14:55:09.874 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - Saga状态机配置加载状态: 成功
2025-05-19 14:55:09.874 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 已加载的状态机定义文件数量: 1
2025-05-19 14:55:09.874 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 已加载的状态机定义文件:
2025-05-19 14:55:09.874 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig -  - /E:/project/bgai/target/classes/statelang/bgai-saga-transaction.json
2025-05-19 14:55:09.874 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - Saga解析器状态: CUSTOM_FASTJSON2
2025-05-19 14:55:09.874 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 状态机解析结果: 成功 1 个, 失败 0 个
2025-05-19 14:55:09.874 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - =============================================================
2025-05-19 14:55:09.878 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - nacos.cache.data.init.snapshot = true 
2025-05-19 14:55:09.878 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] common-dev.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-19 14:55:09.886 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=common-dev.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-19 14:55:09.887 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=common-dev.yaml, group=DEFAULT_GROUP
2025-05-19 14:55:09.887 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-19 14:55:09.887 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-19 14:55:09.887 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai.yaml, group=DEFAULT_GROUP
2025-05-19 14:55:09.888 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai-dev.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-19 14:55:09.888 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai-dev.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-19 14:55:09.888 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai-dev.yaml, group=DEFAULT_GROUP
2025-05-19 14:55:09.888 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-19 14:55:09.888 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai, group=DEFAULT_GROUP, cnt=1
2025-05-19 14:55:09.888 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai, group=DEFAULT_GROUP
2025-05-19 14:55:29.953 [http-nio-8080-exec-2] DEBUG com.bgpay.bgai.filter.ApiKeyAuthenticationFilter - Skipping API Key validation for excluded path: /auth/authorize
2025-05-19 14:55:29.976 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.MockAuthController - Authorization request: client_id=bgai-client-id, redirect_uri=http://localhost:8080/api/auth/callback, response_type=code
2025-05-19 14:55:40.453 [http-nio-8080-exec-4] DEBUG com.bgpay.bgai.filter.ApiKeyAuthenticationFilter - Skipping API Key validation for excluded path: /api/auth/callback
2025-05-19 14:55:40.490 [http-nio-8080-exec-5] DEBUG com.bgpay.bgai.filter.ApiKeyAuthenticationFilter - Skipping API Key validation for excluded path: /auth/token
2025-05-19 14:55:40.493 [http-nio-8080-exec-5] INFO  com.bgpay.bgai.controller.MockAuthController - Token request: grant_type=null, code=null, client_id=null
2025-05-19 14:55:40.519 [http-nio-8080-exec-6] DEBUG com.bgpay.bgai.filter.ApiKeyAuthenticationFilter - Skipping API Key validation for excluded path: /auth/userinfo
2025-05-19 14:55:40.528 [http-nio-8080-exec-4] DEBUG com.bgpay.bgai.mapper.UserMapper.findByUserId - ==>  Preparing: SELECT * FROM t_user WHERE user_id = ?
2025-05-19 14:55:40.530 [http-nio-8080-exec-4] DEBUG com.bgpay.bgai.mapper.UserMapper.findByUserId - ==> Parameters: 689258T(String)
2025-05-19 14:55:40.549 [http-nio-8080-exec-4] DEBUG com.bgpay.bgai.mapper.UserMapper.findByUserId - <==      Total: 1
2025-05-19 14:55:40.623 [http-nio-8080-exec-4] DEBUG com.bgpay.bgai.mapper.UserMapper.updateById - ==>  Preparing: UPDATE t_user SET user_id=?, username=?, email=?, avatar_url=?, last_login_time=?, access_token=?, refresh_token=?, token_expire_time=?, status=?, create_time=?, update_time=? WHERE id=?
2025-05-19 14:55:40.627 [http-nio-8080-exec-4] DEBUG com.bgpay.bgai.mapper.UserMapper.updateById - ==> Parameters: 689258T(String), 测试用户(String), test@example.com(String), https://ui-avatars.com/api/?name=测试用户(String), 2025-05-19T14:55:40.549714100(LocalDateTime), d6edc3ea-cdaf-47d8-952d-4704c668a5a0(String), 7cdd742f-8ceb-480f-bae6-4c59826a1e80(String), 2025-05-19T15:55:40.549714100(LocalDateTime), 1(Integer), 2025-04-26T23:59:16(LocalDateTime), 2025-05-19T14:55:40.549714100(LocalDateTime), 1(Long)
2025-05-19 14:55:40.645 [http-nio-8080-exec-4] DEBUG com.bgpay.bgai.mapper.UserMapper.updateById - <==    Updates: 1
2025-05-19 14:56:10.904 [http-nio-8080-exec-7] INFO  com.bgpay.bgai.controller.ReactiveChatController - 接收到请求: /api/chatGatWay-internal, 文件=新文件 17.txt, 问题参数=null, 模型参数=null
2025-05-19 14:56:10.905 [http-nio-8080-exec-7] INFO  com.bgpay.bgai.controller.ReactiveChatController - 请求Content-Type: multipart/form-data;boundary=--------------------------465532750738859146918548
2025-05-19 14:56:10.905 [http-nio-8080-exec-7] INFO  com.bgpay.bgai.controller.ReactiveChatController - 收集到的完整参数: question="null", apiUrl="null", modelName="null", multiTurn=false
2025-05-19 14:56:10.906 [http-nio-8080-exec-7] INFO  com.bgpay.bgai.controller.ReactiveChatController - Processing request for user ID: 689258T
2025-05-19 14:56:10.907 [http-nio-8080-exec-7] INFO  com.bgpay.bgai.controller.ReactiveChatController - Processing file with circuit breaker: fileName=新文件 17.txt, question=
2025-05-19 14:56:10.909 [http-nio-8080-exec-7] INFO  com.bgpay.bgai.config.ReactiveFileProcessor - Processing file: 新文件 17.txt, content-type: text/plain
2025-05-19 14:56:10.916 [http-nio-8080-exec-7] INFO  com.bgpay.bgai.controller.ReactiveChatController - PARAM TRACE [689258T]: 尝试查找匹配配置 - 参数: apiUrl=null, modelName=null
2025-05-19 14:56:10.928 [http-nio-8080-exec-7] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 查询配置 - userId=689258T
2025-05-19 14:56:10.929 [http-nio-8080-exec-7] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 排序方式 - 按ID降序
2025-05-19 14:56:10.929 [http-nio-8080-exec-7] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 限制结果数 - LIMIT 1
2025-05-19 14:56:10.941 [http-nio-8080-exec-7] DEBUG com.bgpay.bgai.mapper.ApiConfigMapper.selectList - ==>  Preparing: SELECT id,api_url,api_key,model_name,user_id FROM api_config WHERE (user_id = ?) ORDER BY id DESC LIMIT 1
2025-05-19 14:56:10.941 [http-nio-8080-exec-7] DEBUG com.bgpay.bgai.mapper.ApiConfigMapper.selectList - ==> Parameters: 689258T(String)
2025-05-19 14:56:10.958 [http-nio-8080-exec-7] DEBUG com.bgpay.bgai.mapper.ApiConfigMapper.selectList - <==      Total: 1
2025-05-19 14:56:10.958 [http-nio-8080-exec-7] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 查询结果 - 找到配置: id=2, modelName=deepseek-chat
2025-05-19 14:56:10.958 [http-nio-8080-exec-7] INFO  com.bgpay.bgai.controller.ReactiveChatController - PARAM TRACE [689258T]: 找到匹配配置 - apiUrl=https://api.deepseek.com/chat/completions, modelName=deepseek-chat (原始请求: null)
2025-05-19 14:56:10.958 [http-nio-8080-exec-7] INFO  com.bgpay.bgai.controller.ReactiveChatController - API config resolved: url=https://api.deepseek.com/chat/completions, model=deepseek-chat
2025-05-19 14:56:10.976 [Thread-57] INFO  com.bgpay.bgai.config.ReactiveFileProcessor - File processed successfully: size=6680 bytes
2025-05-19 14:56:10.982 [Thread-57] INFO  com.bgpay.bgai.controller.ReactiveChatController - Content processed, length: 6603
2025-05-19 14:56:10.988 [Thread-57] INFO  io.seata.tm.TransactionManagerHolder - TransactionManager Singleton io.seata.tm.DefaultTransactionManager@40a9e3aa
2025-05-19 14:56:11.018 [Thread-57] INFO  io.seata.tm.api.DefaultGlobalTransaction - Begin new global transaction [seata-server:8091:63702487474642945]
2025-05-19 14:56:11.020 [Thread-57] INFO  c.b.bgai.interceptor.SeataTransactionInterceptor - 准备记录分布式事务开始: XID=seata-server:8091:63702487474642945, 业务=com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive, 路径=, IP=, 用户=system
2025-05-19 14:56:11.030 [Thread-57] INFO  c.b.bgai.service.impl.TransactionLogServiceImpl - 记录分布式事务开始: XID=seata-server:8091:63702487474642945, 业务=com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive
2025-05-19 14:56:11.034 [Thread-57] DEBUG com.bgpay.bgai.mapper.TransactionLogMapper.insert - ==>  Preparing: INSERT INTO transaction_log ( xid, transaction_name, transaction_mode, status, request_path, source_ip, start_time, user_id, create_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-05-19 14:56:11.038 [Thread-57] DEBUG com.bgpay.bgai.mapper.TransactionLogMapper.insert - ==> Parameters: seata-server:8091:63702487474642945(String), com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive(String), AT(String), ACTIVE(String), (String), (String), 2025-05-19T14:56:11.030602800(LocalDateTime), system(String), 2025-05-19T14:56:11.030602800(LocalDateTime)
2025-05-19 14:56:11.443 [Thread-57] DEBUG com.bgpay.bgai.mapper.TransactionLogMapper.insert - <==    Updates: 1
2025-05-19 14:56:11.471 [Thread-57] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:63702487474642945, branchId:63702487474642946, lockKeys:transaction_log:5
2025-05-19 14:56:11.482 [Thread-57] WARN  i.s.c.l.EnhancedServiceLoader$InnerEnhancedServiceLoader - Load [io.seata.rm.datasource.undo.parser.ProtostuffUndoLogParser] class fail: io/protostuff/runtime/IdStrategy
2025-05-19 14:56:11.541 [Thread-57] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:63702487474642945, branchId:63702487474642947, lockKeys:transaction_log:5;undo_log:17
2025-05-19 14:56:11.566 [Thread-57] INFO  c.b.bgai.interceptor.SeataTransactionInterceptor - 开始分布式事务: XID=seata-server:8091:63702487474642945, 方法=com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive
2025-05-19 14:56:11.576 [Thread-57] INFO  org.reflections.Reflections - Processing reactive request: content length=6603, apiUrl=https://api.deepseek.com/chat/completions, modelName=deepseek-chat, userId=689258T, multiTurn=false
2025-05-19 14:56:11.596 [Thread-57] INFO  com.bgpay.bgai.transaction.TransactionCoordinator - Transaction prepared for user 689258T: chatCompletionId=chat-851db730-86bc-4219-ba44-8efad1f4512c
2025-05-19 14:56:11.598 [Thread-57] INFO  org.reflections.Reflections - Generated request JSON with 2PC transaction: {"stream":false,"max_tokens":2000,"temperature":1.0,"messages":[{"role":"system","content":"You are ...
2025-05-19 14:56:11.615 [Thread-57] INFO  c.b.bgai.service.impl.TransactionLogServiceImpl - 记录分布式事务结束: XID=seata-server:8091:63702487474642945, 状态=COMMITTED
2025-05-19 14:56:11.616 [Thread-57] DEBUG c.b.bgai.mapper.TransactionLogMapper.selectList - ==>  Preparing: SELECT id,xid,branch_id,transaction_name,transaction_mode,status,request_path,source_ip,start_time,end_time,user_id,extra_data,create_time,update_time FROM transaction_log WHERE (xid = ?) LIMIT 1
2025-05-19 14:56:11.618 [Thread-57] DEBUG c.b.bgai.mapper.TransactionLogMapper.selectList - ==> Parameters: seata-server:8091:63702487474642945(String)
2025-05-19 14:56:11.626 [Thread-57] DEBUG c.b.bgai.mapper.TransactionLogMapper.selectList - <==      Total: 1
2025-05-19 14:56:11.629 [Thread-57] DEBUG c.b.bgai.mapper.TransactionLogMapper.updateById - ==>  Preparing: UPDATE transaction_log SET xid=?, transaction_name=?, transaction_mode=?, status=?, request_path=?, source_ip=?, start_time=?, end_time=?, user_id=?, extra_data=?, create_time=?, update_time=? WHERE id=?
2025-05-19 14:56:11.634 [Thread-57] DEBUG c.b.bgai.mapper.TransactionLogMapper.updateById - ==> Parameters: seata-server:8091:63702487474642945(String), com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive(String), AT(String), COMMITTED(String), (String), (String), 2025-05-19T14:56:11(LocalDateTime), 2025-05-19T14:56:11.626761900(LocalDateTime), system(String), {"duration":42,"result":"success"}(String), 2025-05-19T14:56:11(LocalDateTime), 2025-05-19T14:56:11.626761900(LocalDateTime), 5(Long)
2025-05-19 14:56:11.676 [Thread-57] DEBUG c.b.bgai.mapper.TransactionLogMapper.updateById - <==    Updates: 1
2025-05-19 14:56:11.697 [Thread-57] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:63702487474642945, branchId:63702487474642948, lockKeys:transaction_log:5
2025-05-19 14:56:11.728 [Thread-57] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:63702487474642945, branchId:63702487474642949, lockKeys:undo_log:19;transaction_log:5
2025-05-19 14:56:11.768 [Thread-57] INFO  c.b.bgai.interceptor.SeataTransactionInterceptor - 分布式事务成功完成: XID=seata-server:8091:63702487474642945, 耗时=42ms
2025-05-19 14:56:11.768 [Thread-57] INFO  io.seata.tm.api.DefaultGlobalTransaction - transaction seata-server:8091:63702487474642945 will be commit
2025-05-19 14:56:11.784 [Thread-57] INFO  io.seata.tm.api.DefaultGlobalTransaction - transaction end, xid = seata-server:8091:63702487474642945
2025-05-19 14:56:11.784 [Thread-57] INFO  io.seata.tm.api.DefaultGlobalTransaction - [seata-server:8091:63702487474642945] commit status: Committed
2025-05-19 14:56:12.068 [rpcDispatch_RMROLE_1_1_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:63702487474642945', branchId=63702487474642946, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false,"skipCheckLock":true}'}
2025-05-19 14:56:12.070 [rpcDispatch_RMROLE_1_1_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:63702487474642945 63702487474642946 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false,"skipCheckLock":true}
2025-05-19 14:56:12.071 [rpcDispatch_RMROLE_1_1_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-19 14:56:12.094 [rpcDispatch_RMROLE_1_2_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:63702487474642945', branchId=63702487474642947, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false,"skipCheckLock":true}'}
2025-05-19 14:56:12.094 [rpcDispatch_RMROLE_1_2_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:63702487474642945 63702487474642947 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false,"skipCheckLock":true}
2025-05-19 14:56:12.094 [rpcDispatch_RMROLE_1_2_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-19 14:56:12.119 [rpcDispatch_RMROLE_1_3_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:63702487474642945', branchId=63702487474642948, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false}'}
2025-05-19 14:56:12.119 [rpcDispatch_RMROLE_1_3_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:63702487474642945 63702487474642948 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false}
2025-05-19 14:56:12.119 [rpcDispatch_RMROLE_1_3_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-19 14:56:12.132 [rpcDispatch_RMROLE_1_4_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:63702487474642945', branchId=63702487474642949, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false}'}
2025-05-19 14:56:12.132 [rpcDispatch_RMROLE_1_4_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:63702487474642945 63702487474642949 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false}
2025-05-19 14:56:12.132 [rpcDispatch_RMROLE_1_4_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-19 14:56:37.605 [reactor-http-nio-3] INFO  org.reflections.Reflections - Raw response received, length: 2506
2025-05-19 14:56:37.611 [reactor-http-nio-3] WARN  org.reflections.Reflections - Received different chatCompletionId from response: d011a7bc-fa15-49f2-9eb1-764f6b607182 vs prepared: chat-851db730-86bc-4219-ba44-8efad1f4512c
2025-05-19 14:56:37.628 [reactor-http-nio-3] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - ==>  Preparing: INSERT INTO chat_completions ( object, created, model, system_fingerprint, api_key ) VALUES ( ?, ?, ?, ?, ? )
2025-05-19 14:56:37.628 [reactor-http-nio-3] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - ==> Parameters: chat.completion(String), 1747637797626(Long), deepseek-chat(String), 689258T(String), chat-851db730-86bc-4219-ba44-8efad1f4512c(String)
2025-05-19 14:56:37.644 [reactor-http-nio-3] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - <==    Updates: 1
2025-05-19 14:56:37.644 [reactor-http-nio-3] INFO  com.bgpay.bgai.transaction.TransactionCoordinator - Transaction committed for user 689258T: chatCompletionId=chat-851db730-86bc-4219-ba44-8efad1f4512c
2025-05-19 14:56:37.661 [FileWrite-1] INFO  com.bgpay.bgai.service.deepseek.FileWriterService - Successfully wrote content to: \var\data\ai_responses\152b97a5-9c91-40fb-9bfa-c3e50903a080.txt
2025-05-19 14:56:37.665 [boundedElastic-1] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - ==>  Preparing: INSERT INTO chat_completions ( object, created, model, system_fingerprint, api_key ) VALUES ( ?, ?, ?, ?, ? )
2025-05-19 14:56:37.666 [boundedElastic-1] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - ==> Parameters: chat.completion(String), 1747637772(Long), deepseek-chat(String), fp_8802369eaa_prod0425fp8(String), chat-851db730-86bc-4219-ba44-8efad1f4512c(String)
2025-05-19 14:56:37.674 [boundedElastic-1] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - <==    Updates: 1
2025-05-19 14:56:37.696 [boundedElastic-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.insert - ==>  Preparing: INSERT INTO usage_info ( chat_completion_id, prompt_tokens, completion_tokens, total_tokens, prompt_tokens_cached, completion_reasoning_tokens, prompt_cache_hit_tokens, prompt_cache_miss_tokens, created_at, model_type ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-05-19 14:56:37.697 [boundedElastic-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.insert - ==> Parameters: chat-851db730-86bc-4219-ba44-8efad1f4512c(String), 2209(Integer), 441(Integer), 2650(Integer), 2176(Integer), 0(Integer), 0(Integer), 33(Integer), 2025-05-19T14:56:37.690243500(LocalDateTime), deepseek-chat(String)
2025-05-19 14:56:37.713 [boundedElastic-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.insert - <==    Updates: 1
2025-05-19 14:56:37.726 [boundedElastic-1] INFO  org.reflections.Reflections - Completion data saved synchronously for chatCompletionId: chat-851db730-86bc-4219-ba44-8efad1f4512c
2025-05-19 14:56:37.730 [boundedElastic-2] INFO  org.reflections.Reflections - 开始发送账单消息，chatCompletionId: chat-851db730-86bc-4219-ba44-8efad1f4512c, userId: 689258T
2025-05-19 14:56:37.789 [boundedElastic-2] INFO  org.reflections.Reflections - 账单消息发送成功，chatCompletionId: chat-851db730-86bc-4219-ba44-8efad1f4512c, userId: 689258T
2025-05-19 14:56:37.791 [boundedElastic-1] INFO  org.reflections.Reflections - Complete processing chain completed: # Analysis of the Configuration File

This appears to be a Spring Boot application configuration file (likely `application.yml`) with multiple sections configuring various aspects of the application. Here's a breakdown of the key configurations:

## Core Spring Configurations
- Application name: `bgai`
- Active profile: `dev`
- Bean definition overriding is allowed
- Session management is configured to use none (no session persistence)
- File upload limits set to 200MB

## Database Configurations
- **MySQL**: 
  - Master/slave setup with identical connection details (likely for read/write separation)
  - Using Druid connection pool with detailed pool settings
  - Connection to `8.133.246.113:3306/deepseek`
  
- **Redis**:
  - Single instance at `8.133.246.113:6379`
  - Password protected
  - Used for both Spring Session and application cache

## Framework Integrations
- **JPA/Hibernate**: Configured for MySQL8 with auto-update DDL
- **MyBatis-Plus**: With underscore to camelCase mapping and logging
- **RocketMQ**: Message queue configuration for producer/consumer groups
- **Flink**: Job manager connection details

## Application-Specific Configurations
- Conversation settings (max 5 rounds/10 messages)
- File output path for AI responses at `/var/data/ai_responses`
- DeepSeek API timeout (120s) and retry settings
- SSO/OAuth2 configuration for authentication

## Resilience and Performance
- Circuit breakers (Resilience4j) for API failures
- Thread pool configuration for async tasks
- HTTP connection pooling settings

## Security Notes
- Contains sensitive credentials for:
  - MySQL database (username/password)
  - Redis (password)
  - SSO client (client-id/secret)
  - API keys for client authentication

This configuration suggests a fairly complex application with multiple integration points, database access, message queuing, and resilience patterns implemented. The presence of both JPA and MyBatis-Plus indicates possible mixed persistence approaches in the application.
2025-05-19 14:56:37.791 [boundedElastic-1] INFO  com.bgpay.bgai.controller.ReactiveChatController - Processed response for user 689258T, content length: 2004
2025-05-19 14:56:49.608 [pool-7-thread-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.selectCount - ==>  Preparing: SELECT COUNT( * ) AS total FROM usage_info WHERE (chat_completion_id = ?)
2025-05-19 14:56:49.608 [pool-7-thread-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.selectCount - ==> Parameters: chat-851db730-86bc-4219-ba44-8efad1f4512c(String)
2025-05-19 14:56:49.616 [pool-7-thread-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.selectCount - <==      Total: 1
2025-05-19 14:56:49.703 [ConsumeMessageThread_billing-consumer-group_1] DEBUG c.bgpay.bgai.mapper.PriceConfigMapper.selectList - ==>  Preparing: SELECT id,model_type,time_period,cache_status,io_type,price,version,effective_time FROM price_config WHERE (model_type = ? AND time_period = ? AND io_type = ? AND effective_time <= ? AND cache_status = ?) ORDER BY effective_time DESC LIMIT 1
2025-05-19 14:56:49.704 [ConsumeMessageThread_billing-consumer-group_1] DEBUG c.bgpay.bgai.mapper.PriceConfigMapper.selectList - ==> Parameters: deepseek-chat(String), standard(String), input(String), 2025-05-19T14:56:49.702612900(LocalDateTime), miss(String)
2025-05-19 14:56:49.716 [ConsumeMessageThread_billing-consumer-group_1] DEBUG c.bgpay.bgai.mapper.PriceConfigMapper.selectList - <==      Total: 1
2025-05-19 14:56:49.769 [ConsumeMessageThread_billing-consumer-group_1] DEBUG c.bgpay.bgai.mapper.PriceConfigMapper.selectList - ==>  Preparing: SELECT id,model_type,time_period,cache_status,io_type,price,version,effective_time FROM price_config WHERE (model_type = ? AND time_period = ? AND io_type = ? AND effective_time <= ? AND cache_status IS NULL) ORDER BY effective_time DESC LIMIT 1
2025-05-19 14:56:49.769 [ConsumeMessageThread_billing-consumer-group_1] DEBUG c.bgpay.bgai.mapper.PriceConfigMapper.selectList - ==> Parameters: deepseek-chat(String), standard(String), output(String), 2025-05-19T14:56:49.768614500(LocalDateTime)
2025-05-19 14:56:49.774 [ConsumeMessageThread_billing-consumer-group_1] DEBUG c.bgpay.bgai.mapper.PriceConfigMapper.selectList - <==      Total: 1
2025-05-19 14:56:49.827 [ConsumeMessageThread_billing-consumer-group_1] INFO  c.bgpay.bgai.service.mq.RocketMQBillingServiceImpl - Output price config priceVersion: 1
2025-05-19 14:56:49.828 [ConsumeMessageThread_billing-consumer-group_1] DEBUG com.bgpay.bgai.mapper.UsageRecordMapper.insert - ==>  Preparing: INSERT INTO usage_record ( model_type, chat_completion_id, user_id, input_cost, output_cost, price_version, calculated_at ) VALUES ( ?, ?, ?, ?, ?, ?, ? )
2025-05-19 14:56:49.828 [ConsumeMessageThread_billing-consumer-group_1] DEBUG com.bgpay.bgai.mapper.UsageRecordMapper.insert - ==> Parameters: deepseek-chat(String), chat-851db730-86bc-4219-ba44-8efad1f4512c(String), 689258T(String), 0.0001(BigDecimal), 0.0035(BigDecimal), 1(Integer), 2025-05-19T14:56:49.827798300(LocalDateTime)
2025-05-19 14:56:49.849 [ConsumeMessageThread_billing-consumer-group_1] DEBUG com.bgpay.bgai.mapper.UsageRecordMapper.insert - <==    Updates: 1
2025-05-19 14:56:49.859 [ConsumeMessageThread_billing-consumer-group_1] INFO  c.bgpay.bgai.service.mq.RocketMQBillingServiceImpl - Message consumed: 2408820C75288342B4869B724B724BF07DB436BAF30C5FE75B7A0000
2025-05-19 14:57:21.660 [Thread-1] WARN  c.alibaba.nacos.common.http.HttpClientBeanHolder - [HttpClientBeanHolder] Start destroying common HttpClient
2025-05-19 14:57:21.660 [Thread-7] WARN  com.alibaba.nacos.common.notify.NotifyCenter - [NotifyCenter] Start destroying Publisher
2025-05-19 14:57:21.660 [Thread-7] WARN  com.alibaba.nacos.common.notify.NotifyCenter - [NotifyCenter] Destruction of the end
2025-05-19 14:57:21.661 [Thread-1] WARN  c.alibaba.nacos.common.http.HttpClientBeanHolder - [HttpClientBeanHolder] Destruction of the end
2025-05-19 14:57:21.678 [NettyClientSelector_TMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - channel inactive: [id: 0x86801d26, L:/192.168.86.8:49290 ! R:/8.133.246.113:8091]
2025-05-19 14:57:21.678 [NettyClientSelector_TMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - return to pool, rm channel:[id: 0x86801d26, L:/192.168.86.8:49290 ! R:/8.133.246.113:8091]
2025-05-19 14:57:21.678 [NettyClientSelector_TMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - channel valid false,channel:[id: 0x86801d26, L:/192.168.86.8:49290 ! R:/8.133.246.113:8091]
2025-05-19 14:57:21.678 [NettyClientSelector_TMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - will destroy channel:[id: 0x86801d26, L:/192.168.86.8:49290 ! R:/8.133.246.113:8091]
2025-05-19 14:57:21.678 [NettyClientSelector_TMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0x86801d26, L:/192.168.86.8:49290 ! R:/8.133.246.113:8091]) will closed
2025-05-19 14:57:21.678 [NettyClientSelector_TMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0x86801d26, L:/192.168.86.8:49290 ! R:/8.133.246.113:8091]) will closed
2025-05-19 14:57:21.678 [NettyClientSelector_RMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - channel inactive: [id: 0xcc5a1de7, L:/192.168.86.8:49292 ! R:/8.133.246.113:8091]
2025-05-19 14:57:21.678 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - return to pool, rm channel:[id: 0xcc5a1de7, L:/192.168.86.8:49292 ! R:/8.133.246.113:8091]
2025-05-19 14:57:21.678 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - channel valid false,channel:[id: 0xcc5a1de7, L:/192.168.86.8:49292 ! R:/8.133.246.113:8091]
2025-05-19 14:57:21.678 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - will destroy channel:[id: 0xcc5a1de7, L:/192.168.86.8:49292 ! R:/8.133.246.113:8091]
2025-05-19 14:57:21.678 [NettyClientSelector_RMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0xcc5a1de7, L:/192.168.86.8:49292 ! R:/8.133.246.113:8091]) will closed
2025-05-19 14:57:21.678 [NettyClientSelector_RMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0xcc5a1de7, L:/192.168.86.8:49292 ! R:/8.133.246.113:8091]) will closed
2025-05-19 14:57:21.681 [SpringContextShutdownHook] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - De-registering from Nacos Server now...
2025-05-19 14:57:21.681 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - [DEREGISTER-SERVICE] d750d92e-152f-4055-a641-3bc9dda85a29 deregistering service bgtech-ai with instance: Instance{instanceId='null', ip='192.168.86.8', port=8080, weight=1.0, healthy=true, enabled=true, ephemeral=true, clusterName='DEFAULT', serviceName='null', metadata={}}
2025-05-19 14:57:21.690 [SpringContextShutdownHook] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - De-registration finished.
2025-05-19 14:57:21.691 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.cache.ServiceInfoHolder do shutdown begin
2025-05-19 14:57:21.692 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.backups.FailoverReactor do shutdown begin
2025-05-19 14:57:21.692 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.backups.FailoverReactor do shutdown stop
2025-05-19 14:57:21.692 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.cache.ServiceInfoHolder do shutdown stop
2025-05-19 14:57:21.692 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.NamingClientProxyDelegate do shutdown begin
2025-05-19 14:57:21.692 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServiceInfoUpdateService do shutdown begin
2025-05-19 14:57:21.692 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServiceInfoUpdateService do shutdown stop
2025-05-19 14:57:21.692 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServerListManager do shutdown begin
2025-05-19 14:57:21.692 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Start destroying NacosRestTemplate
2025-05-19 14:57:21.692 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Destruction of the end
2025-05-19 14:57:21.692 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServerListManager do shutdown stop
2025-05-19 14:57:21.692 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.http.NamingHttpClientProxy do shutdown begin
2025-05-19 14:57:21.692 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Start destroying NacosRestTemplate
2025-05-19 14:57:21.692 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Destruction of the end
2025-05-19 14:57:21.692 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.http.NamingHttpClientProxy do shutdown stop
2025-05-19 14:57:21.692 [SpringContextShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Shutdown rpc client, set status to shutdown
2025-05-19 14:57:21.692 [SpringContextShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Shutdown client event executor java.util.concurrent.ScheduledThreadPoolExecutor@40c65f8d[Running, pool size = 2, active threads = 2, queued tasks = 0, completed tasks = 0]
2025-05-19 14:57:21.692 [SpringContextShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Close current connection 1747637709623_139.227.195.203_43005
2025-05-19 14:57:21.696 [nacos-grpc-client-executor-8.133.246.113-42] WARN  c.a.nacos.common.remote.client.grpc.GrpcClient - [1747637709623_139.227.195.203_43005]Ignore error event,isRunning:false,isAbandon=false
2025-05-19 14:57:21.697 [SpringContextShutdownHook] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - Shutdown grpc executor java.util.concurrent.ThreadPoolExecutor@6aaec13[Running, pool size = 5, active threads = 0, queued tasks = 0, completed tasks = 43]
2025-05-19 14:57:21.697 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - Shutdown grpc redo service executor java.util.concurrent.ScheduledThreadPoolExecutor@247dc925[Running, pool size = 1, active threads = 0, queued tasks = 1, completed tasks = 44]
2025-05-19 14:57:21.698 [SpringContextShutdownHook] INFO  c.a.n.client.auth.ram.identify.CredentialWatcher - [null] CredentialWatcher is stopped
2025-05-19 14:57:21.698 [SpringContextShutdownHook] INFO  c.a.n.client.auth.ram.identify.CredentialService - [null] CredentialService is freed
2025-05-19 14:57:21.698 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.NamingClientProxyDelegate do shutdown stop
2025-05-19 14:57:23.726 [SpringContextShutdownHook] DEBUG com.bgpay.bgai.config.AsyncConfig$1 - Shutting down ExecutorService 'blockingExecutor'
2025-05-19 14:57:23.781 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:10909] result: true
2025-05-19 14:57:23.781 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:10911] result: true
2025-05-19 14:57:23.783 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:9876] result: true
2025-05-19 14:57:23.798 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:10911] result: true
2025-05-19 14:57:23.798 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:9876] result: true
2025-05-19 14:57:23.914 [SpringContextShutdownHook] INFO  o.s.orm.jpa.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-05-19 14:57:23.916 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-2} closing ...
2025-05-19 14:57:23.922 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-2} closed
2025-05-19 14:57:23.922 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} closing ...
2025-05-19 14:57:23.922 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} closed
2025-05-19 15:04:22.183 [main] WARN  com.alibaba.nacos.client.logging.NacosLogging - Load Logback Configuration of Nacos fail, message: Could not initialize Logback Nacos logging from classpath:nacos-logback.xml
2025-05-19 15:04:22.184 [main] INFO  com.bgpay.bgai.BgaiApplication - The following 1 profile is active: "dev"
2025-05-19 15:04:23.511 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-05-19 15:04:23.513 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-05-19 15:04:23.536 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 17 ms. Found 0 JPA repository interfaces.
2025-05-19 15:04:23.548 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-05-19 15:04:23.549 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-05-19 15:04:23.563 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 5 ms. Found 0 Redis repository interfaces.
2025-05-19 15:04:24.108 [main] INFO  io.seata.config.ConfigurationFactory - load Configuration from :Spring Configuration
2025-05-19 15:04:24.116 [main] INFO  io.seata.config.ConfigurationFactory - load Configuration from :Spring Configuration
2025-05-19 15:04:24.123 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Initializing Global Transaction Clients ... 
2025-05-19 15:04:24.226 [main] INFO  io.seata.core.rpc.netty.NettyClientBootstrap - NettyClientBootstrap has started
2025-05-19 15:04:24.227 [main] INFO  io.seata.discovery.registry.RegistryFactory - use registry center type: file
2025-05-19 15:04:24.237 [main] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - will connect to 8.133.246.113:8091
2025-05-19 15:04:24.242 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - NettyPool create channel to transactionRole:TMROLE,address:8.133.246.113:8091,msg:< RegisterTMRequest{version='1.7.0', applicationId='bgtech-ai', transactionServiceGroup='bgai-tx-group', extraData='ak=null
digest=bgai-tx-group,192.168.86.8,1747638264240
timestamp=1747638264240
authVersion=V4
vgroup=bgai-tx-group
ip=192.168.86.8
'} >
2025-05-19 15:04:24.449 [main] INFO  io.seata.core.rpc.netty.TmNettyRemotingClient - register TM success. client version:1.7.0, server version:1.8.1-SNAPSHOT,channel:[id: 0x534c6ee5, L:/192.168.86.8:54139 - R:/8.133.246.113:8091]
2025-05-19 15:04:24.455 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - register success, cost 134 ms, version:1.8.1-SNAPSHOT,role:TMROLE,channel:[id: 0x534c6ee5, L:/192.168.86.8:54139 - R:/8.133.246.113:8091]
2025-05-19 15:04:24.456 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Transaction Manager Client is initialized. applicationId[bgtech-ai] txServiceGroup[bgai-tx-group]
2025-05-19 15:04:24.465 [main] INFO  io.seata.rm.datasource.AsyncWorker - Async Commit Buffer Limit: 10000
2025-05-19 15:04:24.466 [main] INFO  io.seata.rm.datasource.xa.ResourceManagerXA - ResourceManagerXA init ...
2025-05-19 15:04:24.472 [main] INFO  io.seata.core.rpc.netty.NettyClientBootstrap - NettyClientBootstrap has started
2025-05-19 15:04:24.472 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Resource Manager is initialized. applicationId[bgtech-ai] txServiceGroup[bgai-tx-group]
2025-05-19 15:04:24.472 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Global Transaction Clients are initialized. 
2025-05-19 15:04:25.663 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat initialized with port(s): 8080 (http)
2025-05-19 15:04:25.677 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - The ["http-nio-8080"] connector has been configured to support HTTP upgrade to [h2c]
2025-05-19 15:04:25.677 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - Initializing ProtocolHandler ["http-nio-8080"]
2025-05-19 15:04:25.679 [main] INFO  org.apache.catalina.core.StandardService - Starting service [Tomcat]
2025-05-19 15:04:25.680 [main] INFO  org.apache.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.15]
2025-05-19 15:04:26.138 [main] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} inited
2025-05-19 15:04:26.389 [main] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - will connect to 8.133.246.113:8091
2025-05-19 15:04:26.389 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - RM will register :jdbc:mysql://8.133.246.113:3306/deepseek
2025-05-19 15:04:26.389 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - NettyPool create channel to transactionRole:RMROLE,address:8.133.246.113:8091,msg:< RegisterRMRequest{resourceIds='jdbc:mysql://8.133.246.113:3306/deepseek', version='1.7.0', applicationId='bgtech-ai', transactionServiceGroup='bgai-tx-group', extraData='null'} >
2025-05-19 15:04:26.413 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - register RM success. client version:1.7.0, server version:1.8.1-SNAPSHOT,channel:[id: 0xb353a1e5, L:/192.168.86.8:54151 - R:/8.133.246.113:8091]
2025-05-19 15:04:26.413 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - register success, cost 17 ms, version:1.8.1-SNAPSHOT,role:RMROLE,channel:[id: 0xb353a1e5, L:/192.168.86.8:54151 - R:/8.133.246.113:8091]
2025-05-19 15:04:26.416 [main] INFO  i.s.s.a.datasource.SeataAutoDataSourceProxyCreator - Auto proxy data source 'masterDataSource' by 'AT' mode.
2025-05-19 15:04:26.491 [main] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-2} inited
2025-05-19 15:04:26.577 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - will register resourceId:jdbc:mysql://8.133.246.113:3306/deepseek
2025-05-19 15:04:26.578 [main] INFO  i.s.s.a.datasource.SeataAutoDataSourceProxyCreator - Auto proxy data source 'slaveDataSource' by 'AT' mode.
2025-05-19 15:04:26.586 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.rm.AbstractRMHandler - the rm client received response msg [RegisterRMResponse{version='1.8.1-SNAPSHOT', extraData='null', identified=true, resultCode=null, msg='null'}] from tc server.
2025-05-19 15:04:26.612 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - will register resourceId:jdbc:mysql://8.133.246.113:3306/deepseek
2025-05-19 15:04:26.613 [main] INFO  i.s.s.a.datasource.SeataAutoDataSourceProxyCreator - Auto proxy data source 'dynamicDataSource' by 'AT' mode.
2025-05-19 15:04:26.636 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.rm.AbstractRMHandler - the rm client received response msg [RegisterRMResponse{version='1.8.1-SNAPSHOT', extraData='null', identified=true, resultCode=null, msg='null'}] from tc server.
2025-05-19 15:04:26.779 [main] INFO  org.hibernate.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-05-19 15:04:26.866 [main] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.1.7.Final
2025-05-19 15:04:27.256 [main] INFO  SQL dialect - HHH000400: Using dialect: org.hibernate.dialect.MySQL8Dialect
2025-05-19 15:04:27.259 [main] WARN  org.hibernate.orm.deprecation - HHH90000026: MySQL8Dialect has been deprecated; use org.hibernate.dialect.MySQLDialect instead
2025-05-19 15:04:27.545 [main] INFO  o.h.e.t.jta.platform.internal.JtaPlatformInitiator - HHH000490: Using JtaPlatform implementation: [org.hibernate.engine.transaction.jta.platform.internal.NoJtaPlatform]
2025-05-19 15:04:27.555 [main] INFO  o.s.orm.jpa.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-05-19 15:04:27.932 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-19 15:04:27.943 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-19 15:04:27.981 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-19 15:04:27.983 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-19 15:04:27.984 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-19 15:04:28.000 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-19 15:04:28.610 [main] INFO  com.bgpay.bgai.service.impl.UserServiceImpl - 初始化SSO配置: clientId=bgai-client-id, redirectUri=http://localhost:8080/api/auth/callback
2025-05-19 15:04:28.766 [main] INFO  com.bgpay.bgai.controller.AuthController - 初始化认证控制器: clientId=bgai-client-id, redirectUri=http://localhost:8080/api/auth/callback
2025-05-19 15:04:29.355 [main] INFO  o.a.r.s.autoconfigure.RocketMQAutoConfiguration - a producer (billing-producer-group) init on namesrv 8.133.246.113:9876
2025-05-19 15:04:29.630 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Bean [com.bgpay.bgai.service.deepseek.DeepSeekServiceImp$$SpringCGLIB$$0] with name [deepSeekServiceImp] would use interceptor [io.seata.spring.annotation.GlobalTransactionalInterceptor]
2025-05-19 15:04:29.976 [main] WARN  i.s.s.b.a.provider.SpringBootConfigurationProvider - The get method not found for the field 'SeataProperties#accesskey'.
2025-05-19 15:04:29.977 [main] WARN  i.s.s.b.a.provider.SpringBootConfigurationProvider - The get method not found for the field 'SeataProperties#secretkey'.
2025-05-19 15:04:29.990 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 加载到1个Saga状态机定义文件
2025-05-19 15:04:30.133 [main] INFO  com.bgpay.bgai.saga.CustomSagaJsonParser - 开始解析状态机定义: bgai-saga-transaction
2025-05-19 15:04:30.134 [main] INFO  com.bgpay.bgai.saga.CustomSagaJsonParser - 状态机定义解析成功: bgai-saga-transaction
2025-05-19 15:04:30.134 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 成功加载状态机定义: /E:/project/bgai/target/classes/statelang/bgai-saga-transaction.json
2025-05-19 15:04:30.619 [main] INFO  org.redisson.Version - Redisson 3.24.3
2025-05-19 15:04:30.799 [redisson-netty-4-6] INFO  o.r.connection.pool.MasterPubSubConnectionPool - 1 connections initialized for 8.133.246.113/8.133.246.113:6379
2025-05-19 15:04:31.121 [redisson-netty-4-19] INFO  org.redisson.connection.pool.MasterConnectionPool - 24 connections initialized for 8.133.246.113/8.133.246.113:6379
2025-05-19 15:04:31.367 [main] INFO  com.bgpay.bgai.service.mq.MQConsumerService - MQ consumer startup successful [group=billing-consumer-group, topic=BILLING_TOPIC, tag=USER_BILLING]
2025-05-19 15:04:31.534 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Bean [com.bgpay.bgai.service.impl.SeataTransactionService$$SpringCGLIB$$0] with name [seataTransactionService] would use interceptor [io.seata.spring.annotation.GlobalTransactionalInterceptor]
2025-05-19 15:04:31.665 [main] DEBUG com.bgpay.bgai.config.AsyncConfig$1 - Initializing ExecutorService 'blockingExecutor'
2025-05-19 15:04:31.694 [main] INFO  c.b.bgai.config.NacosConfig$NacosWarningHandler - Nacos警告处理器已启用，将忽略配置中心连接警告
2025-05-19 15:04:33.072 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [After]
2025-05-19 15:04:33.072 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Before]
2025-05-19 15:04:33.072 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Between]
2025-05-19 15:04:33.073 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Cookie]
2025-05-19 15:04:33.073 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Header]
2025-05-19 15:04:33.073 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Host]
2025-05-19 15:04:33.073 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Method]
2025-05-19 15:04:33.073 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Path]
2025-05-19 15:04:33.073 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Query]
2025-05-19 15:04:33.073 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [ReadBody]
2025-05-19 15:04:33.073 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [RemoteAddr]
2025-05-19 15:04:33.073 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [XForwardedRemoteAddr]
2025-05-19 15:04:33.073 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Weight]
2025-05-19 15:04:33.073 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [CloudFoundryRouteService]
2025-05-19 15:04:34.421 [main] INFO  o.s.b.actuate.endpoint.web.EndpointLinksResolver - Exposing 1 endpoint(s) beneath base path '/actuator'
2025-05-19 15:04:34.803 [main] WARN  i.s.s.b.a.provider.SpringBootConfigurationProvider - The get method not found for the field 'SeataProperties#accesskey'.
2025-05-19 15:04:34.803 [main] WARN  i.s.s.b.a.provider.SpringBootConfigurationProvider - The get method not found for the field 'SeataProperties#secretkey'.
2025-05-19 15:04:34.817 [main] INFO  io.seata.saga.tm.DefaultSagaTransactionalTemplate - Initializing Global Transaction Clients ... 
2025-05-19 15:04:34.817 [main] INFO  io.seata.saga.tm.DefaultSagaTransactionalTemplate - Transaction Manager Client is initialized. applicationId[bgtech-ai] txServiceGroup[bgai-tx-group]
2025-05-19 15:04:34.817 [main] INFO  io.seata.saga.tm.DefaultSagaTransactionalTemplate - Resource Manager is initialized. applicationId[bgtech-ai] txServiceGroup[bgai-tx-group]
2025-05-19 15:04:34.817 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - will register resourceId:bgtech-ai#bgai-tx-group
2025-05-19 15:04:34.817 [main] INFO  io.seata.saga.tm.DefaultSagaTransactionalTemplate - Global Transaction Clients are initialized. 
2025-05-19 15:04:34.825 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.rm.AbstractRMHandler - the rm client received response msg [RegisterRMResponse{version='1.8.1-SNAPSHOT', extraData='null', identified=true, resultCode=null, msg='null'}] from tc server.
2025-05-19 15:04:36.075 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - Starting ProtocolHandler ["http-nio-8080"]
2025-05-19 15:04:36.091 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat started on port(s): 8080 (http) with context path ''
2025-05-19 15:04:36.100 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from ans.namespace attribute : null
2025-05-19 15:04:36.100 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from ALIBABA_ALIWARE_NAMESPACE attribute :null
2025-05-19 15:04:36.101 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from namespace attribute :null
2025-05-19 15:04:36.110 [main] INFO  c.a.n.p.auth.spi.client.ClientAuthPluginManager - [ClientAuthPluginManager] Load ClientAuthService com.alibaba.nacos.client.auth.impl.NacosClientAuthServiceImpl success.
2025-05-19 15:04:36.110 [main] INFO  c.a.n.p.auth.spi.client.ClientAuthPluginManager - [ClientAuthPluginManager] Load ClientAuthService com.alibaba.nacos.client.auth.ram.RamClientAuthServiceImpl success.
2025-05-19 15:04:36.114 [main] INFO  com.alibaba.nacos.common.remote.client - [RpcClientFactory] create a new rpc client of 235717a6-1af3-42d4-8f82-10841bece840
2025-05-19 15:04:36.115 [main] INFO  com.alibaba.nacos.common.remote.client - [235717a6-1af3-42d4-8f82-10841bece840] RpcClient init, ServerListFactory = com.alibaba.nacos.client.naming.core.ServerListManager
2025-05-19 15:04:36.116 [main] INFO  com.alibaba.nacos.common.remote.client - [235717a6-1af3-42d4-8f82-10841bece840] Registry connection listener to current client:com.alibaba.nacos.client.naming.remote.gprc.redo.NamingGrpcRedoService
2025-05-19 15:04:36.116 [main] INFO  com.alibaba.nacos.common.remote.client - [235717a6-1af3-42d4-8f82-10841bece840] Register server push request handler:com.alibaba.nacos.client.naming.remote.gprc.NamingPushRequestHandler
2025-05-19 15:04:36.116 [main] INFO  com.alibaba.nacos.common.remote.client - [235717a6-1af3-42d4-8f82-10841bece840] Try to connect to server on start up, server: {serverIp = '8.133.246.113', server main port = 8848}
2025-05-19 15:04:36.116 [main] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - grpc client connection server:8.133.246.113 ip,serverPort:9848,grpcTslConfig:{"sslProvider":"OPENSSL","enableTls":false,"mutualAuthEnable":false,"trustAll":false}
2025-05-19 15:04:36.248 [main] INFO  com.alibaba.nacos.common.remote.client - [235717a6-1af3-42d4-8f82-10841bece840] Success to connect to server [8.133.246.113:8848] on start up, connectionId = 1747638276142_139.227.195.203_42126
2025-05-19 15:04:36.248 [main] INFO  com.alibaba.nacos.common.remote.client - [235717a6-1af3-42d4-8f82-10841bece840] Register server push request handler:com.alibaba.nacos.common.remote.client.RpcClient$ConnectResetRequestHandler
2025-05-19 15:04:36.248 [main] INFO  com.alibaba.nacos.common.remote.client - [235717a6-1af3-42d4-8f82-10841bece840] Register server push request handler:com.alibaba.nacos.common.remote.client.RpcClient$$Lambda/0x0000025581528f48
2025-05-19 15:04:36.248 [com.alibaba.nacos.client.remote.worker] INFO  com.alibaba.nacos.common.remote.client - [235717a6-1af3-42d4-8f82-10841bece840] Notify connected event to listeners.
2025-05-19 15:04:36.248 [com.alibaba.nacos.client.remote.worker] INFO  com.alibaba.nacos.client.naming - Grpc connection connect
2025-05-19 15:04:36.249 [main] INFO  com.alibaba.nacos.client.naming - [REGISTER-SERVICE] d750d92e-152f-4055-a641-3bc9dda85a29 registering service bgtech-ai with instance Instance{instanceId='null', ip='192.168.86.8', port=8080, weight=1.0, healthy=true, enabled=true, ephemeral=true, clusterName='DEFAULT', serviceName='null', metadata={IPv6=[2408:820c:7528:8342:b486:9b72:4b72:4bf0], preserved.register.source=SPRING_CLOUD}}
2025-05-19 15:04:36.279 [main] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - nacos registry, DEFAULT_GROUP bgtech-ai 192.168.86.8:8080 register finished
2025-05-19 15:04:36.327 [main] INFO  com.bgpay.bgai.config.NacosConfig - 应用启动完成，当前环境: dev
2025-05-19 15:04:36.328 [main] INFO  com.bgpay.bgai.config.NacosConfig - Nacos配置中心: 8.133.246.113:8848, 命名空间: d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-19 15:04:36.328 [main] INFO  com.bgpay.bgai.config.NacosConfig - 注意: 如果看到Nacos配置加载警告，但应用正常启动，说明应用正在使用本地配置文件
2025-05-19 15:04:36.329 [main] INFO  com.bgpay.bgai.BgaiApplication - Started BgaiApplication in 16.21 seconds (process running for 17.588)
2025-05-19 15:04:36.332 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-19 15:04:36.332 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-19 15:04:36.343 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-19 15:04:36.343 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-19 15:04:36.343 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-19 15:04:36.360 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-19 15:04:36.360 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-19 15:04:36.360 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-19 15:04:36.367 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-19 15:04:36.367 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-19 15:04:36.367 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-19 15:04:36.375 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-19 15:04:36.375 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - ==================== Saga状态机加载报告 ====================
2025-05-19 15:04:36.375 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - Saga状态机配置加载状态: 成功
2025-05-19 15:04:36.375 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 已加载的状态机定义文件数量: 1
2025-05-19 15:04:36.375 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 已加载的状态机定义文件:
2025-05-19 15:04:36.375 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig -  - /E:/project/bgai/target/classes/statelang/bgai-saga-transaction.json
2025-05-19 15:04:36.375 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - Saga解析器状态: CUSTOM_FASTJSON2
2025-05-19 15:04:36.375 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 状态机解析结果: 成功 1 个, 失败 0 个
2025-05-19 15:04:36.375 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - =============================================================
2025-05-19 15:04:36.380 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - nacos.cache.data.init.snapshot = true 
2025-05-19 15:04:36.381 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] common-dev.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-19 15:04:36.391 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=common-dev.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-19 15:04:36.391 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=common-dev.yaml, group=DEFAULT_GROUP
2025-05-19 15:04:36.391 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-19 15:04:36.391 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-19 15:04:36.391 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai.yaml, group=DEFAULT_GROUP
2025-05-19 15:04:36.393 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai-dev.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-19 15:04:36.393 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai-dev.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-19 15:04:36.393 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai-dev.yaml, group=DEFAULT_GROUP
2025-05-19 15:04:36.393 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-19 15:04:36.394 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai, group=DEFAULT_GROUP, cnt=1
2025-05-19 15:04:36.394 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai, group=DEFAULT_GROUP
2025-05-19 15:05:21.267 [Thread-1] WARN  c.alibaba.nacos.common.http.HttpClientBeanHolder - [HttpClientBeanHolder] Start destroying common HttpClient
2025-05-19 15:05:21.269 [Thread-1] WARN  c.alibaba.nacos.common.http.HttpClientBeanHolder - [HttpClientBeanHolder] Destruction of the end
2025-05-19 15:05:21.269 [Thread-7] WARN  com.alibaba.nacos.common.notify.NotifyCenter - [NotifyCenter] Start destroying Publisher
2025-05-19 15:05:21.270 [Thread-7] WARN  com.alibaba.nacos.common.notify.NotifyCenter - [NotifyCenter] Destruction of the end
2025-05-19 15:05:21.292 [NettyClientSelector_TMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - channel inactive: [id: 0x534c6ee5, L:/192.168.86.8:54139 ! R:/8.133.246.113:8091]
2025-05-19 15:05:21.292 [NettyClientSelector_TMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - return to pool, rm channel:[id: 0x534c6ee5, L:/192.168.86.8:54139 ! R:/8.133.246.113:8091]
2025-05-19 15:05:21.292 [NettyClientSelector_TMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - channel valid false,channel:[id: 0x534c6ee5, L:/192.168.86.8:54139 ! R:/8.133.246.113:8091]
2025-05-19 15:05:21.292 [NettyClientSelector_TMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - will destroy channel:[id: 0x534c6ee5, L:/192.168.86.8:54139 ! R:/8.133.246.113:8091]
2025-05-19 15:05:21.292 [NettyClientSelector_TMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0x534c6ee5, L:/192.168.86.8:54139 ! R:/8.133.246.113:8091]) will closed
2025-05-19 15:05:21.292 [NettyClientSelector_TMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0x534c6ee5, L:/192.168.86.8:54139 ! R:/8.133.246.113:8091]) will closed
2025-05-19 15:05:21.293 [NettyClientSelector_RMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - channel inactive: [id: 0xb353a1e5, L:/192.168.86.8:54151 ! R:/8.133.246.113:8091]
2025-05-19 15:05:21.293 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - return to pool, rm channel:[id: 0xb353a1e5, L:/192.168.86.8:54151 ! R:/8.133.246.113:8091]
2025-05-19 15:05:21.293 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - channel valid false,channel:[id: 0xb353a1e5, L:/192.168.86.8:54151 ! R:/8.133.246.113:8091]
2025-05-19 15:05:21.293 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - will destroy channel:[id: 0xb353a1e5, L:/192.168.86.8:54151 ! R:/8.133.246.113:8091]
2025-05-19 15:05:21.293 [NettyClientSelector_RMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0xb353a1e5, L:/192.168.86.8:54151 ! R:/8.133.246.113:8091]) will closed
2025-05-19 15:05:21.294 [NettyClientSelector_RMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0xb353a1e5, L:/192.168.86.8:54151 ! R:/8.133.246.113:8091]) will closed
2025-05-19 15:05:21.296 [SpringContextShutdownHook] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - De-registering from Nacos Server now...
2025-05-19 15:05:21.296 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - [DEREGISTER-SERVICE] d750d92e-152f-4055-a641-3bc9dda85a29 deregistering service bgtech-ai with instance: Instance{instanceId='null', ip='192.168.86.8', port=8080, weight=1.0, healthy=true, enabled=true, ephemeral=true, clusterName='DEFAULT', serviceName='null', metadata={}}
2025-05-19 15:05:21.309 [SpringContextShutdownHook] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - De-registration finished.
2025-05-19 15:05:21.310 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.cache.ServiceInfoHolder do shutdown begin
2025-05-19 15:05:21.310 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.backups.FailoverReactor do shutdown begin
2025-05-19 15:05:21.311 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.backups.FailoverReactor do shutdown stop
2025-05-19 15:05:21.311 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.cache.ServiceInfoHolder do shutdown stop
2025-05-19 15:05:21.311 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.NamingClientProxyDelegate do shutdown begin
2025-05-19 15:05:21.311 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServiceInfoUpdateService do shutdown begin
2025-05-19 15:05:21.311 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServiceInfoUpdateService do shutdown stop
2025-05-19 15:05:21.311 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServerListManager do shutdown begin
2025-05-19 15:05:21.311 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Start destroying NacosRestTemplate
2025-05-19 15:05:21.311 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Destruction of the end
2025-05-19 15:05:21.311 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServerListManager do shutdown stop
2025-05-19 15:05:21.311 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.http.NamingHttpClientProxy do shutdown begin
2025-05-19 15:05:21.311 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Start destroying NacosRestTemplate
2025-05-19 15:05:21.311 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Destruction of the end
2025-05-19 15:05:21.311 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.http.NamingHttpClientProxy do shutdown stop
2025-05-19 15:05:21.311 [SpringContextShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Shutdown rpc client, set status to shutdown
2025-05-19 15:05:21.311 [SpringContextShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Shutdown client event executor java.util.concurrent.ScheduledThreadPoolExecutor@67488c90[Running, pool size = 2, active threads = 2, queued tasks = 0, completed tasks = 0]
2025-05-19 15:05:21.311 [SpringContextShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Close current connection 1747638276142_139.227.195.203_42126
2025-05-19 15:05:21.314 [nacos-grpc-client-executor-8.133.246.113-19] WARN  c.a.nacos.common.remote.client.grpc.GrpcClient - [1747638276142_139.227.195.203_42126]Ignore error event,isRunning:false,isAbandon=false
2025-05-19 15:05:21.315 [SpringContextShutdownHook] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - Shutdown grpc executor java.util.concurrent.ThreadPoolExecutor@5e3c33ac[Running, pool size = 5, active threads = 0, queued tasks = 0, completed tasks = 20]
2025-05-19 15:05:21.316 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - Shutdown grpc redo service executor java.util.concurrent.ScheduledThreadPoolExecutor@1f420cc9[Running, pool size = 1, active threads = 0, queued tasks = 1, completed tasks = 15]
2025-05-19 15:05:21.316 [SpringContextShutdownHook] INFO  c.a.n.client.auth.ram.identify.CredentialWatcher - [null] CredentialWatcher is stopped
2025-05-19 15:05:21.316 [SpringContextShutdownHook] INFO  c.a.n.client.auth.ram.identify.CredentialService - [null] CredentialService is freed
2025-05-19 15:05:21.316 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.NamingClientProxyDelegate do shutdown stop
2025-05-19 15:05:23.358 [SpringContextShutdownHook] DEBUG com.bgpay.bgai.config.AsyncConfig$1 - Shutting down ExecutorService 'blockingExecutor'
2025-05-19 15:05:23.402 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:10911] result: true
2025-05-19 15:05:23.402 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:9876] result: true
2025-05-19 15:05:23.420 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:10911] result: true
2025-05-19 15:05:23.420 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:9876] result: true
2025-05-19 15:05:23.432 [SpringContextShutdownHook] INFO  o.s.orm.jpa.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-05-19 15:05:23.433 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-2} closing ...
2025-05-19 15:05:23.441 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-2} closed
2025-05-19 15:05:23.441 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} closing ...
2025-05-19 15:05:23.441 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} closed
2025-05-19 15:06:05.332 [main] WARN  com.alibaba.nacos.client.logging.NacosLogging - Load Logback Configuration of Nacos fail, message: Could not initialize Logback Nacos logging from classpath:nacos-logback.xml
2025-05-19 15:06:05.332 [main] INFO  com.bgpay.bgai.BgaiApplication - The following 1 profile is active: "dev"
2025-05-19 15:06:06.629 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-05-19 15:06:06.630 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-05-19 15:06:06.654 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 17 ms. Found 0 JPA repository interfaces.
2025-05-19 15:06:06.664 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-05-19 15:06:06.665 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-05-19 15:06:06.677 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 4 ms. Found 0 Redis repository interfaces.
2025-05-19 15:06:07.285 [main] INFO  io.seata.config.ConfigurationFactory - load Configuration from :Spring Configuration
2025-05-19 15:06:07.294 [main] INFO  io.seata.config.ConfigurationFactory - load Configuration from :Spring Configuration
2025-05-19 15:06:07.302 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Initializing Global Transaction Clients ... 
2025-05-19 15:06:07.409 [main] INFO  io.seata.core.rpc.netty.NettyClientBootstrap - NettyClientBootstrap has started
2025-05-19 15:06:07.410 [main] INFO  io.seata.discovery.registry.RegistryFactory - use registry center type: file
2025-05-19 15:06:07.420 [main] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - will connect to 8.133.246.113:8091
2025-05-19 15:06:07.425 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - NettyPool create channel to transactionRole:TMROLE,address:8.133.246.113:8091,msg:< RegisterTMRequest{version='1.7.0', applicationId='bgtech-ai', transactionServiceGroup='bgai-tx-group', extraData='ak=null
digest=bgai-tx-group,192.168.86.8,1747638367423
timestamp=1747638367423
authVersion=V4
vgroup=bgai-tx-group
ip=192.168.86.8
'} >
2025-05-19 15:06:07.572 [main] INFO  io.seata.core.rpc.netty.TmNettyRemotingClient - register TM success. client version:1.7.0, server version:1.8.1-SNAPSHOT,channel:[id: 0x9fc5513a, L:/192.168.86.8:54812 - R:/8.133.246.113:8091]
2025-05-19 15:06:07.579 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - register success, cost 68 ms, version:1.8.1-SNAPSHOT,role:TMROLE,channel:[id: 0x9fc5513a, L:/192.168.86.8:54812 - R:/8.133.246.113:8091]
2025-05-19 15:06:07.580 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Transaction Manager Client is initialized. applicationId[bgtech-ai] txServiceGroup[bgai-tx-group]
2025-05-19 15:06:07.591 [main] INFO  io.seata.rm.datasource.AsyncWorker - Async Commit Buffer Limit: 10000
2025-05-19 15:06:07.592 [main] INFO  io.seata.rm.datasource.xa.ResourceManagerXA - ResourceManagerXA init ...
2025-05-19 15:06:07.598 [main] INFO  io.seata.core.rpc.netty.NettyClientBootstrap - NettyClientBootstrap has started
2025-05-19 15:06:07.598 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Resource Manager is initialized. applicationId[bgtech-ai] txServiceGroup[bgai-tx-group]
2025-05-19 15:06:07.598 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Global Transaction Clients are initialized. 
2025-05-19 15:06:08.663 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat initialized with port(s): 8080 (http)
2025-05-19 15:06:08.673 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - The ["http-nio-8080"] connector has been configured to support HTTP upgrade to [h2c]
2025-05-19 15:06:08.674 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - Initializing ProtocolHandler ["http-nio-8080"]
2025-05-19 15:06:08.675 [main] INFO  org.apache.catalina.core.StandardService - Starting service [Tomcat]
2025-05-19 15:06:08.675 [main] INFO  org.apache.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.15]
2025-05-19 15:06:09.089 [main] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} inited
2025-05-19 15:06:09.339 [main] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - will connect to 8.133.246.113:8091
2025-05-19 15:06:09.339 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - RM will register :jdbc:mysql://8.133.246.113:3306/deepseek
2025-05-19 15:06:09.339 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - NettyPool create channel to transactionRole:RMROLE,address:8.133.246.113:8091,msg:< RegisterRMRequest{resourceIds='jdbc:mysql://8.133.246.113:3306/deepseek', version='1.7.0', applicationId='bgtech-ai', transactionServiceGroup='bgai-tx-group', extraData='null'} >
2025-05-19 15:06:09.369 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - register RM success. client version:1.7.0, server version:1.8.1-SNAPSHOT,channel:[id: 0x27eabbf2, L:/192.168.86.8:54815 - R:/8.133.246.113:8091]
2025-05-19 15:06:09.369 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - register success, cost 12 ms, version:1.8.1-SNAPSHOT,role:RMROLE,channel:[id: 0x27eabbf2, L:/192.168.86.8:54815 - R:/8.133.246.113:8091]
2025-05-19 15:06:09.371 [main] INFO  i.s.s.a.datasource.SeataAutoDataSourceProxyCreator - Auto proxy data source 'masterDataSource' by 'AT' mode.
2025-05-19 15:06:09.432 [main] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-2} inited
2025-05-19 15:06:09.501 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - will register resourceId:jdbc:mysql://8.133.246.113:3306/deepseek
2025-05-19 15:06:09.502 [main] INFO  i.s.s.a.datasource.SeataAutoDataSourceProxyCreator - Auto proxy data source 'slaveDataSource' by 'AT' mode.
2025-05-19 15:06:09.510 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.rm.AbstractRMHandler - the rm client received response msg [RegisterRMResponse{version='1.8.1-SNAPSHOT', extraData='null', identified=true, resultCode=null, msg='null'}] from tc server.
2025-05-19 15:06:09.523 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - will register resourceId:jdbc:mysql://8.133.246.113:3306/deepseek
2025-05-19 15:06:09.523 [main] INFO  i.s.s.a.datasource.SeataAutoDataSourceProxyCreator - Auto proxy data source 'dynamicDataSource' by 'AT' mode.
2025-05-19 15:06:09.533 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.rm.AbstractRMHandler - the rm client received response msg [RegisterRMResponse{version='1.8.1-SNAPSHOT', extraData='null', identified=true, resultCode=null, msg='null'}] from tc server.
2025-05-19 15:06:09.634 [main] INFO  org.hibernate.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-05-19 15:06:09.682 [main] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.1.7.Final
2025-05-19 15:06:09.998 [main] INFO  SQL dialect - HHH000400: Using dialect: org.hibernate.dialect.MySQL8Dialect
2025-05-19 15:06:10.001 [main] WARN  org.hibernate.orm.deprecation - HHH90000026: MySQL8Dialect has been deprecated; use org.hibernate.dialect.MySQLDialect instead
2025-05-19 15:06:10.278 [main] INFO  o.h.e.t.jta.platform.internal.JtaPlatformInitiator - HHH000490: Using JtaPlatform implementation: [org.hibernate.engine.transaction.jta.platform.internal.NoJtaPlatform]
2025-05-19 15:06:10.289 [main] INFO  o.s.orm.jpa.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-05-19 15:06:10.650 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-19 15:06:10.661 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-19 15:06:10.687 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-19 15:06:10.689 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-19 15:06:10.689 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-19 15:06:10.701 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-19 15:06:11.472 [main] INFO  com.bgpay.bgai.service.impl.UserServiceImpl - 初始化SSO配置: clientId=bgai-client-id, redirectUri=http://localhost:8080/api/auth/callback
2025-05-19 15:06:11.615 [main] INFO  com.bgpay.bgai.controller.AuthController - 初始化认证控制器: clientId=bgai-client-id, redirectUri=http://localhost:8080/api/auth/callback
2025-05-19 15:06:12.215 [main] INFO  o.a.r.s.autoconfigure.RocketMQAutoConfiguration - a producer (billing-producer-group) init on namesrv 8.133.246.113:9876
2025-05-19 15:06:12.458 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Bean [com.bgpay.bgai.service.deepseek.DeepSeekServiceImp$$SpringCGLIB$$0] with name [deepSeekServiceImp] would use interceptor [io.seata.spring.annotation.GlobalTransactionalInterceptor]
2025-05-19 15:06:12.840 [main] WARN  i.s.s.b.a.provider.SpringBootConfigurationProvider - The get method not found for the field 'SeataProperties#accesskey'.
2025-05-19 15:06:12.841 [main] WARN  i.s.s.b.a.provider.SpringBootConfigurationProvider - The get method not found for the field 'SeataProperties#secretkey'.
2025-05-19 15:06:12.854 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 加载到1个Saga状态机定义文件
2025-05-19 15:06:12.995 [main] INFO  com.bgpay.bgai.saga.CustomSagaJsonParser - 开始解析状态机定义: bgai-saga-transaction
2025-05-19 15:06:12.996 [main] INFO  com.bgpay.bgai.saga.CustomSagaJsonParser - 状态机定义解析成功: bgai-saga-transaction
2025-05-19 15:06:12.996 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 成功加载状态机定义: /E:/project/bgai/target/classes/statelang/bgai-saga-transaction.json
2025-05-19 15:06:13.493 [main] INFO  org.redisson.Version - Redisson 3.24.3
2025-05-19 15:06:13.620 [redisson-netty-4-6] INFO  o.r.connection.pool.MasterPubSubConnectionPool - 1 connections initialized for 8.133.246.113/8.133.246.113:6379
2025-05-19 15:06:13.953 [redisson-netty-4-19] INFO  org.redisson.connection.pool.MasterConnectionPool - 24 connections initialized for 8.133.246.113/8.133.246.113:6379
2025-05-19 15:06:14.193 [main] INFO  com.bgpay.bgai.service.mq.MQConsumerService - MQ consumer startup successful [group=billing-consumer-group, topic=BILLING_TOPIC, tag=USER_BILLING]
2025-05-19 15:06:14.356 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Bean [com.bgpay.bgai.service.impl.SeataTransactionService$$SpringCGLIB$$0] with name [seataTransactionService] would use interceptor [io.seata.spring.annotation.GlobalTransactionalInterceptor]
2025-05-19 15:06:14.474 [main] DEBUG com.bgpay.bgai.config.AsyncConfig$1 - Initializing ExecutorService 'blockingExecutor'
2025-05-19 15:06:14.499 [main] INFO  c.b.bgai.config.NacosConfig$NacosWarningHandler - Nacos警告处理器已启用，将忽略配置中心连接警告
2025-05-19 15:06:15.814 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [After]
2025-05-19 15:06:15.814 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Before]
2025-05-19 15:06:15.814 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Between]
2025-05-19 15:06:15.814 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Cookie]
2025-05-19 15:06:15.814 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Header]
2025-05-19 15:06:15.814 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Host]
2025-05-19 15:06:15.814 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Method]
2025-05-19 15:06:15.814 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Path]
2025-05-19 15:06:15.814 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Query]
2025-05-19 15:06:15.815 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [ReadBody]
2025-05-19 15:06:15.815 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [RemoteAddr]
2025-05-19 15:06:15.815 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [XForwardedRemoteAddr]
2025-05-19 15:06:15.815 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Weight]
2025-05-19 15:06:15.815 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [CloudFoundryRouteService]
2025-05-19 15:06:17.201 [main] INFO  o.s.b.actuate.endpoint.web.EndpointLinksResolver - Exposing 1 endpoint(s) beneath base path '/actuator'
2025-05-19 15:06:17.548 [main] WARN  i.s.s.b.a.provider.SpringBootConfigurationProvider - The get method not found for the field 'SeataProperties#accesskey'.
2025-05-19 15:06:17.548 [main] WARN  i.s.s.b.a.provider.SpringBootConfigurationProvider - The get method not found for the field 'SeataProperties#secretkey'.
2025-05-19 15:06:17.565 [main] INFO  io.seata.saga.tm.DefaultSagaTransactionalTemplate - Initializing Global Transaction Clients ... 
2025-05-19 15:06:17.565 [main] INFO  io.seata.saga.tm.DefaultSagaTransactionalTemplate - Transaction Manager Client is initialized. applicationId[bgtech-ai] txServiceGroup[bgai-tx-group]
2025-05-19 15:06:17.565 [main] INFO  io.seata.saga.tm.DefaultSagaTransactionalTemplate - Resource Manager is initialized. applicationId[bgtech-ai] txServiceGroup[bgai-tx-group]
2025-05-19 15:06:17.565 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - will register resourceId:bgtech-ai#bgai-tx-group
2025-05-19 15:06:17.565 [main] INFO  io.seata.saga.tm.DefaultSagaTransactionalTemplate - Global Transaction Clients are initialized. 
2025-05-19 15:06:17.575 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.rm.AbstractRMHandler - the rm client received response msg [RegisterRMResponse{version='1.8.1-SNAPSHOT', extraData='null', identified=true, resultCode=null, msg='null'}] from tc server.
2025-05-19 15:06:18.776 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - Starting ProtocolHandler ["http-nio-8080"]
2025-05-19 15:06:18.790 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat started on port(s): 8080 (http) with context path ''
2025-05-19 15:06:18.800 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from ans.namespace attribute : null
2025-05-19 15:06:18.800 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from ALIBABA_ALIWARE_NAMESPACE attribute :null
2025-05-19 15:06:18.801 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from namespace attribute :null
2025-05-19 15:06:18.809 [main] INFO  c.a.n.p.auth.spi.client.ClientAuthPluginManager - [ClientAuthPluginManager] Load ClientAuthService com.alibaba.nacos.client.auth.impl.NacosClientAuthServiceImpl success.
2025-05-19 15:06:18.809 [main] INFO  c.a.n.p.auth.spi.client.ClientAuthPluginManager - [ClientAuthPluginManager] Load ClientAuthService com.alibaba.nacos.client.auth.ram.RamClientAuthServiceImpl success.
2025-05-19 15:06:18.813 [main] INFO  com.alibaba.nacos.common.remote.client - [RpcClientFactory] create a new rpc client of 20362799-a397-4d75-95d8-17b89ea240cb
2025-05-19 15:06:18.815 [main] INFO  com.alibaba.nacos.common.remote.client - [20362799-a397-4d75-95d8-17b89ea240cb] RpcClient init, ServerListFactory = com.alibaba.nacos.client.naming.core.ServerListManager
2025-05-19 15:06:18.815 [main] INFO  com.alibaba.nacos.common.remote.client - [20362799-a397-4d75-95d8-17b89ea240cb] Registry connection listener to current client:com.alibaba.nacos.client.naming.remote.gprc.redo.NamingGrpcRedoService
2025-05-19 15:06:18.815 [main] INFO  com.alibaba.nacos.common.remote.client - [20362799-a397-4d75-95d8-17b89ea240cb] Register server push request handler:com.alibaba.nacos.client.naming.remote.gprc.NamingPushRequestHandler
2025-05-19 15:06:18.816 [main] INFO  com.alibaba.nacos.common.remote.client - [20362799-a397-4d75-95d8-17b89ea240cb] Try to connect to server on start up, server: {serverIp = '8.133.246.113', server main port = 8848}
2025-05-19 15:06:18.816 [main] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - grpc client connection server:8.133.246.113 ip,serverPort:9848,grpcTslConfig:{"sslProvider":"OPENSSL","enableTls":false,"mutualAuthEnable":false,"trustAll":false}
2025-05-19 15:06:18.945 [main] INFO  com.alibaba.nacos.common.remote.client - [20362799-a397-4d75-95d8-17b89ea240cb] Success to connect to server [8.133.246.113:8848] on start up, connectionId = 1747638378839_139.227.195.203_42931
2025-05-19 15:06:18.945 [main] INFO  com.alibaba.nacos.common.remote.client - [20362799-a397-4d75-95d8-17b89ea240cb] Register server push request handler:com.alibaba.nacos.common.remote.client.RpcClient$ConnectResetRequestHandler
2025-05-19 15:06:18.945 [main] INFO  com.alibaba.nacos.common.remote.client - [20362799-a397-4d75-95d8-17b89ea240cb] Register server push request handler:com.alibaba.nacos.common.remote.client.RpcClient$$Lambda/0x0000027c81528870
2025-05-19 15:06:18.945 [com.alibaba.nacos.client.remote.worker] INFO  com.alibaba.nacos.common.remote.client - [20362799-a397-4d75-95d8-17b89ea240cb] Notify connected event to listeners.
2025-05-19 15:06:18.945 [com.alibaba.nacos.client.remote.worker] INFO  com.alibaba.nacos.client.naming - Grpc connection connect
2025-05-19 15:06:18.946 [main] INFO  com.alibaba.nacos.client.naming - [REGISTER-SERVICE] d750d92e-152f-4055-a641-3bc9dda85a29 registering service bgtech-ai with instance Instance{instanceId='null', ip='192.168.86.8', port=8080, weight=1.0, healthy=true, enabled=true, ephemeral=true, clusterName='DEFAULT', serviceName='null', metadata={IPv6=[2408:820c:7528:8342:b486:9b72:4b72:4bf0], preserved.register.source=SPRING_CLOUD}}
2025-05-19 15:06:18.966 [main] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - nacos registry, DEFAULT_GROUP bgtech-ai 192.168.86.8:8080 register finished
2025-05-19 15:06:19.017 [main] INFO  com.bgpay.bgai.config.NacosConfig - 应用启动完成，当前环境: dev
2025-05-19 15:06:19.017 [main] INFO  com.bgpay.bgai.config.NacosConfig - Nacos配置中心: 8.133.246.113:8848, 命名空间: d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-19 15:06:19.017 [main] INFO  com.bgpay.bgai.config.NacosConfig - 注意: 如果看到Nacos配置加载警告，但应用正常启动，说明应用正在使用本地配置文件
2025-05-19 15:06:19.019 [main] INFO  com.bgpay.bgai.BgaiApplication - Started BgaiApplication in 15.854 seconds (process running for 17.27)
2025-05-19 15:06:19.022 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-19 15:06:19.022 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-19 15:06:19.037 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-19 15:06:19.037 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-19 15:06:19.037 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-19 15:06:19.050 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-19 15:06:19.051 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-19 15:06:19.051 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-19 15:06:19.061 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-19 15:06:19.062 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-19 15:06:19.062 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-19 15:06:19.076 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-19 15:06:19.077 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - ==================== Saga状态机加载报告 ====================
2025-05-19 15:06:19.077 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - Saga状态机配置加载状态: 成功
2025-05-19 15:06:19.077 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 已加载的状态机定义文件数量: 1
2025-05-19 15:06:19.077 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 已加载的状态机定义文件:
2025-05-19 15:06:19.078 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig -  - /E:/project/bgai/target/classes/statelang/bgai-saga-transaction.json
2025-05-19 15:06:19.078 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - Saga解析器状态: CUSTOM_FASTJSON2
2025-05-19 15:06:19.078 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 状态机解析结果: 成功 1 个, 失败 0 个
2025-05-19 15:06:19.078 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - =============================================================
2025-05-19 15:06:19.083 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - nacos.cache.data.init.snapshot = true 
2025-05-19 15:06:19.084 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] common-dev.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-19 15:06:19.098 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=common-dev.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-19 15:06:19.098 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=common-dev.yaml, group=DEFAULT_GROUP
2025-05-19 15:06:19.098 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-19 15:06:19.099 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-19 15:06:19.099 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai.yaml, group=DEFAULT_GROUP
2025-05-19 15:06:19.101 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai-dev.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-19 15:06:19.101 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai-dev.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-19 15:06:19.101 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai-dev.yaml, group=DEFAULT_GROUP
2025-05-19 15:06:19.101 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-19 15:06:19.101 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai, group=DEFAULT_GROUP, cnt=1
2025-05-19 15:06:19.102 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai, group=DEFAULT_GROUP
2025-05-19 15:06:20.549 [rpcDispatch_RMROLE_1_1_24] INFO  i.s.core.rpc.processor.client.RmUndoLogProcessor - rm handle undo log process:UndoLogDeleteRequest{resourceId='bgtech-ai#bgai-tx-group', saveDays=7, branchType=AT}
2025-05-19 15:06:20.549 [rpcDispatch_RMROLE_1_1_24] WARN  io.seata.rm.RMHandlerAT - Failed to get dataSourceProxy for delete undolog on bgtech-ai#bgai-tx-group
2025-05-19 15:06:20.549 [rpcDispatch_RMROLE_1_2_24] INFO  i.s.core.rpc.processor.client.RmUndoLogProcessor - rm handle undo log process:UndoLogDeleteRequest{resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', saveDays=7, branchType=AT}
2025-05-19 15:06:47.010 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - 接收到请求: /api/chatGatWay-internal, 文件=新文件 17.txt, 问题参数=null, 模型参数=null
2025-05-19 15:06:47.012 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - 请求Content-Type: multipart/form-data;boundary=--------------------------542462833089365210394865
2025-05-19 15:06:47.012 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - 收集到的完整参数: question="null", apiUrl="null", modelName="null", multiTurn=false
2025-05-19 15:06:47.014 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - Processing request for user ID: 689258T
2025-05-19 15:06:47.014 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - Processing file with circuit breaker: fileName=新文件 17.txt, question=
2025-05-19 15:06:47.015 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.config.ReactiveFileProcessor - Processing file: 新文件 17.txt, content-type: text/plain
2025-05-19 15:06:47.022 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - PARAM TRACE [689258T]: 尝试查找匹配配置 - 参数: apiUrl=null, modelName=null
2025-05-19 15:06:47.031 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 查询配置 - userId=689258T
2025-05-19 15:06:47.032 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 排序方式 - 按ID降序
2025-05-19 15:06:47.033 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 限制结果数 - LIMIT 1
2025-05-19 15:06:47.097 [http-nio-8080-exec-2] DEBUG com.bgpay.bgai.mapper.ApiConfigMapper.selectList - ==>  Preparing: SELECT id,api_url,api_key,model_name,user_id FROM api_config WHERE (user_id = ?) ORDER BY id DESC LIMIT 1
2025-05-19 15:06:47.098 [http-nio-8080-exec-2] DEBUG com.bgpay.bgai.mapper.ApiConfigMapper.selectList - ==> Parameters: 689258T(String)
2025-05-19 15:06:47.117 [http-nio-8080-exec-2] DEBUG com.bgpay.bgai.mapper.ApiConfigMapper.selectList - <==      Total: 1
2025-05-19 15:06:47.118 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 查询结果 - 找到配置: id=2, modelName=deepseek-chat
2025-05-19 15:06:47.118 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - PARAM TRACE [689258T]: 找到匹配配置 - apiUrl=https://api.deepseek.com/chat/completions, modelName=deepseek-chat (原始请求: null)
2025-05-19 15:06:47.118 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - API config resolved: url=https://api.deepseek.com/chat/completions, model=deepseek-chat
2025-05-19 15:06:47.172 [Thread-43] INFO  com.bgpay.bgai.config.ReactiveFileProcessor - File processed successfully: size=2153 bytes
2025-05-19 15:06:47.178 [Thread-43] INFO  com.bgpay.bgai.controller.ReactiveChatController - Content processed, length: 2192
2025-05-19 15:06:47.187 [Thread-43] INFO  io.seata.tm.TransactionManagerHolder - TransactionManager Singleton io.seata.tm.DefaultTransactionManager@24f786b8
2025-05-19 15:06:47.216 [Thread-43] INFO  io.seata.tm.api.DefaultGlobalTransaction - Begin new global transaction [seata-server:8091:18666493999071233]
2025-05-19 15:06:47.221 [Thread-43] INFO  c.b.bgai.interceptor.SeataTransactionInterceptor - 准备记录分布式事务开始: XID=seata-server:8091:18666493999071233, 业务=com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive, 路径=, IP=, 用户=system
2025-05-19 15:06:47.246 [Thread-43] INFO  c.b.bgai.service.impl.TransactionLogServiceImpl - 记录分布式事务开始: XID=seata-server:8091:18666493999071233, 业务=com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive
2025-05-19 15:06:47.256 [Thread-43] DEBUG com.bgpay.bgai.mapper.TransactionLogMapper.insert - ==>  Preparing: INSERT INTO transaction_log ( xid, transaction_name, transaction_mode, status, request_path, source_ip, start_time, user_id, create_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-05-19 15:06:47.260 [Thread-43] DEBUG com.bgpay.bgai.mapper.TransactionLogMapper.insert - ==> Parameters: seata-server:8091:18666493999071233(String), com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive(String), AT(String), ACTIVE(String), (String), (String), 2025-05-19T15:06:47.246413700(LocalDateTime), system(String), 2025-05-19T15:06:47.246413700(LocalDateTime)
2025-05-19 15:06:47.665 [Thread-43] DEBUG com.bgpay.bgai.mapper.TransactionLogMapper.insert - <==    Updates: 1
2025-05-19 15:06:47.695 [Thread-43] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:18666493999071233, branchId:18666493999071234, lockKeys:transaction_log:6
2025-05-19 15:06:47.700 [Thread-43] WARN  i.s.c.l.EnhancedServiceLoader$InnerEnhancedServiceLoader - Load [io.seata.rm.datasource.undo.parser.ProtostuffUndoLogParser] class fail: io/protostuff/runtime/IdStrategy
2025-05-19 15:06:47.770 [Thread-43] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:18666493999071233, branchId:18666493999071235, lockKeys:undo_log:21;transaction_log:6
2025-05-19 15:06:47.800 [Thread-43] INFO  c.b.bgai.interceptor.SeataTransactionInterceptor - 开始分布式事务: XID=seata-server:8091:18666493999071233, 方法=com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive
2025-05-19 15:06:47.810 [Thread-43] INFO  org.reflections.Reflections - Processing reactive request: content length=2192, apiUrl=https://api.deepseek.com/chat/completions, modelName=deepseek-chat, userId=689258T, multiTurn=false
2025-05-19 15:06:47.845 [Thread-43] INFO  com.bgpay.bgai.transaction.TransactionCoordinator - Transaction prepared for user 689258T: chatCompletionId=chat-8f82148f-7a52-4c26-b5ae-56c05b3c05bc
2025-05-19 15:06:47.847 [Thread-43] INFO  org.reflections.Reflections - Generated request JSON with 2PC transaction: {"stream":false,"max_tokens":2000,"temperature":1.0,"messages":[{"content":"You are a helpful assist...
2025-05-19 15:06:47.870 [Thread-43] INFO  c.b.bgai.service.impl.TransactionLogServiceImpl - 记录分布式事务结束: XID=seata-server:8091:18666493999071233, 状态=COMMITTED
2025-05-19 15:06:47.872 [Thread-43] DEBUG c.b.bgai.mapper.TransactionLogMapper.selectList - ==>  Preparing: SELECT id,xid,branch_id,transaction_name,transaction_mode,status,request_path,source_ip,start_time,end_time,user_id,extra_data,create_time,update_time FROM transaction_log WHERE (xid = ?) LIMIT 1
2025-05-19 15:06:47.874 [Thread-43] DEBUG c.b.bgai.mapper.TransactionLogMapper.selectList - ==> Parameters: seata-server:8091:18666493999071233(String)
2025-05-19 15:06:47.883 [Thread-43] DEBUG c.b.bgai.mapper.TransactionLogMapper.selectList - <==      Total: 1
2025-05-19 15:06:47.888 [Thread-43] DEBUG c.b.bgai.mapper.TransactionLogMapper.updateById - ==>  Preparing: UPDATE transaction_log SET xid=?, transaction_name=?, transaction_mode=?, status=?, request_path=?, source_ip=?, start_time=?, end_time=?, user_id=?, extra_data=?, create_time=?, update_time=? WHERE id=?
2025-05-19 15:06:47.897 [Thread-43] DEBUG c.b.bgai.mapper.TransactionLogMapper.updateById - ==> Parameters: seata-server:8091:18666493999071233(String), com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive(String), AT(String), COMMITTED(String), (String), (String), 2025-05-19T15:06:47(LocalDateTime), 2025-05-19T15:06:47.883813600(LocalDateTime), system(String), {"duration":64,"result":"success"}(String), 2025-05-19T15:06:47(LocalDateTime), 2025-05-19T15:06:47.883813600(LocalDateTime), 6(Long)
2025-05-19 15:06:47.950 [Thread-43] DEBUG c.b.bgai.mapper.TransactionLogMapper.updateById - <==    Updates: 1
2025-05-19 15:06:47.960 [Thread-43] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:18666493999071233, branchId:18666493999071236, lockKeys:transaction_log:6
2025-05-19 15:06:47.983 [Thread-43] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:18666493999071233, branchId:18666493999071237, lockKeys:transaction_log:6;undo_log:23
2025-05-19 15:06:48.009 [Thread-43] INFO  c.b.bgai.interceptor.SeataTransactionInterceptor - 分布式事务成功完成: XID=seata-server:8091:18666493999071233, 耗时=64ms
2025-05-19 15:06:48.010 [Thread-43] INFO  io.seata.tm.api.DefaultGlobalTransaction - transaction seata-server:8091:18666493999071233 will be commit
2025-05-19 15:06:48.025 [Thread-43] INFO  io.seata.tm.api.DefaultGlobalTransaction - transaction end, xid = seata-server:8091:18666493999071233
2025-05-19 15:06:48.025 [Thread-43] INFO  io.seata.tm.api.DefaultGlobalTransaction - [seata-server:8091:18666493999071233] commit status: Committed
2025-05-19 15:06:48.542 [rpcDispatch_RMROLE_1_3_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:18666493999071233', branchId=18666493999071234, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false,"skipCheckLock":true}'}
2025-05-19 15:06:48.543 [rpcDispatch_RMROLE_1_3_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:18666493999071233 18666493999071234 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false,"skipCheckLock":true}
2025-05-19 15:06:48.544 [rpcDispatch_RMROLE_1_3_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-19 15:06:48.555 [rpcDispatch_RMROLE_1_4_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:18666493999071233', branchId=18666493999071235, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false,"skipCheckLock":true}'}
2025-05-19 15:06:48.556 [rpcDispatch_RMROLE_1_4_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:18666493999071233 18666493999071235 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false,"skipCheckLock":true}
2025-05-19 15:06:48.556 [rpcDispatch_RMROLE_1_4_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-19 15:06:48.563 [rpcDispatch_RMROLE_1_5_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:18666493999071233', branchId=18666493999071236, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false}'}
2025-05-19 15:06:48.563 [rpcDispatch_RMROLE_1_5_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:18666493999071233 18666493999071236 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false}
2025-05-19 15:06:48.563 [rpcDispatch_RMROLE_1_5_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-19 15:06:48.572 [rpcDispatch_RMROLE_1_6_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:18666493999071233', branchId=18666493999071237, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false}'}
2025-05-19 15:06:48.572 [rpcDispatch_RMROLE_1_6_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:18666493999071233 18666493999071237 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false}
2025-05-19 15:06:48.572 [rpcDispatch_RMROLE_1_6_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-19 15:07:11.762 [reactor-http-nio-3] INFO  org.reflections.Reflections - Raw response received, length: 2170
2025-05-19 15:07:11.770 [reactor-http-nio-3] WARN  org.reflections.Reflections - Received different chatCompletionId from response: 17d0c4ee-46ae-4f43-bcc7-678471139eb9 vs prepared: chat-8f82148f-7a52-4c26-b5ae-56c05b3c05bc
2025-05-19 15:07:11.787 [reactor-http-nio-3] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - ==>  Preparing: INSERT INTO chat_completions ( object, created, model, system_fingerprint, api_key ) VALUES ( ?, ?, ?, ?, ? )
2025-05-19 15:07:11.788 [reactor-http-nio-3] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - ==> Parameters: chat.completion(String), 1747638431785(Long), deepseek-chat(String), 689258T(String), chat-8f82148f-7a52-4c26-b5ae-56c05b3c05bc(String)
2025-05-19 15:07:11.808 [reactor-http-nio-3] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - <==    Updates: 1
2025-05-19 15:07:11.808 [reactor-http-nio-3] INFO  com.bgpay.bgai.transaction.TransactionCoordinator - Transaction committed for user 689258T: chatCompletionId=chat-8f82148f-7a52-4c26-b5ae-56c05b3c05bc
2025-05-19 15:07:11.829 [FileWrite-1] INFO  com.bgpay.bgai.service.deepseek.FileWriterService - Successfully wrote content to: \var\data\ai_responses\24148485-8697-4f25-898e-8591310b3139.txt
2025-05-19 15:07:11.838 [boundedElastic-1] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - ==>  Preparing: INSERT INTO chat_completions ( object, created, model, system_fingerprint, api_key ) VALUES ( ?, ?, ?, ?, ? )
2025-05-19 15:07:11.838 [boundedElastic-1] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - ==> Parameters: chat.completion(String), 1747638408(Long), deepseek-chat(String), fp_8802369eaa_prod0425fp8(String), chat-8f82148f-7a52-4c26-b5ae-56c05b3c05bc(String)
2025-05-19 15:07:11.850 [boundedElastic-1] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - <==    Updates: 1
2025-05-19 15:07:11.876 [boundedElastic-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.insert - ==>  Preparing: INSERT INTO usage_info ( chat_completion_id, prompt_tokens, completion_tokens, total_tokens, prompt_tokens_cached, completion_reasoning_tokens, prompt_cache_hit_tokens, prompt_cache_miss_tokens, created_at, model_type ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-05-19 15:07:11.877 [boundedElastic-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.insert - ==> Parameters: chat-8f82148f-7a52-4c26-b5ae-56c05b3c05bc(String), 721(Integer), 405(Integer), 1126(Integer), 0(Integer), 0(Integer), 0(Integer), 721(Integer), 2025-05-19T15:07:11.866853900(LocalDateTime), deepseek-chat(String)
2025-05-19 15:07:11.895 [boundedElastic-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.insert - <==    Updates: 1
2025-05-19 15:07:11.911 [boundedElastic-1] INFO  org.reflections.Reflections - Completion data saved synchronously for chatCompletionId: chat-8f82148f-7a52-4c26-b5ae-56c05b3c05bc
2025-05-19 15:07:11.918 [boundedElastic-2] INFO  org.reflections.Reflections - 开始发送账单消息，chatCompletionId: chat-8f82148f-7a52-4c26-b5ae-56c05b3c05bc, userId: 689258T
2025-05-19 15:07:11.977 [boundedElastic-2] INFO  org.reflections.Reflections - 账单消息发送成功，chatCompletionId: chat-8f82148f-7a52-4c26-b5ae-56c05b3c05bc, userId: 689258T
2025-05-19 15:07:11.979 [boundedElastic-1] INFO  org.reflections.Reflections - Complete processing chain completed: This appears to be a configuration file for Seata, an open-source distributed transaction solution. Here's an explanation of the key configurations:

### Basic Configuration
- `enabled: true` - Enables Seata functionality
- `application-id: bgai` - Application identifier
- `tx-service-group: bgai-tx-group` - Transaction service group name

### Client Configuration
1. **Resource Manager (RM)**
   - Async commit buffer limit, retry counts, and lock settings
   - Saga pattern configurations (JSON parser, retry modes)
   - Lock retry settings (interval: 10ms, times: 30)

2. **Transaction Manager (TM)**
   - Commit/rollback retry counts (5 times)
   - Default global transaction timeout (60000ms = 1 minute)
   - Degrade check settings

3. **Undo Log**
   - Data validation enabled
   - Uses Jackson for log serialization
   - Only tracks updated columns
   - Uses `undo_log` table

### Service Configuration
- Maps transaction group to default TC server
- TC server address: `8.133.246.113:8091`
- Global transaction enabled

### Transport Configuration
- Netty thread settings
- TCP protocol with NIO server
- Heartbeat enabled
- Seata serialization

### Saga Configuration
- Saga mode enabled
- State machine settings:
  - Table prefix: `seata_`
  - Thread pool configuration
  - Timeout settings (transaction: 1min, service invoke: 5min)
  - Auto-registers resources from JSON files

This configuration sets up Seata for distributed transactions with:
- A connection to a TC server at 8.133.246.113:8091
- Saga pattern support
- Undo log tracking in database
- Appropriate timeouts and retry policies

Would you like me to explain any specific part in more detail?
2025-05-19 15:07:11.979 [boundedElastic-1] INFO  com.bgpay.bgai.controller.ReactiveChatController - Processed response for user 689258T, content length: 1671
2025-05-19 15:07:49.679 [pool-7-thread-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.selectCount - ==>  Preparing: SELECT COUNT( * ) AS total FROM usage_info WHERE (chat_completion_id = ?)
2025-05-19 15:07:49.680 [pool-7-thread-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.selectCount - ==> Parameters: chat-8f82148f-7a52-4c26-b5ae-56c05b3c05bc(String)
2025-05-19 15:07:49.688 [pool-7-thread-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.selectCount - <==      Total: 1
2025-05-19 15:07:49.839 [ConsumeMessageThread_billing-consumer-group_1] INFO  c.bgpay.bgai.service.mq.RocketMQBillingServiceImpl - Output price config priceVersion: 1
2025-05-19 15:07:49.841 [ConsumeMessageThread_billing-consumer-group_1] DEBUG com.bgpay.bgai.mapper.UsageRecordMapper.insert - ==>  Preparing: INSERT INTO usage_record ( model_type, chat_completion_id, user_id, input_cost, output_cost, price_version, calculated_at ) VALUES ( ?, ?, ?, ?, ?, ?, ? )
2025-05-19 15:07:49.841 [ConsumeMessageThread_billing-consumer-group_1] DEBUG com.bgpay.bgai.mapper.UsageRecordMapper.insert - ==> Parameters: deepseek-chat(String), chat-8f82148f-7a52-4c26-b5ae-56c05b3c05bc(String), 689258T(String), 0.0014(BigDecimal), 0.0032(BigDecimal), 1(Integer), 2025-05-19T15:07:49.839741300(LocalDateTime)
2025-05-19 15:07:49.864 [ConsumeMessageThread_billing-consumer-group_1] DEBUG com.bgpay.bgai.mapper.UsageRecordMapper.insert - <==    Updates: 1
2025-05-19 15:07:49.874 [ConsumeMessageThread_billing-consumer-group_1] INFO  c.bgpay.bgai.service.mq.RocketMQBillingServiceImpl - Message consumed: 2408820C75288342B4869B724B724BF0D79C36BAF30C5FF108C60000
2025-05-19 15:08:18.453 [Thread-7] WARN  com.alibaba.nacos.common.notify.NotifyCenter - [NotifyCenter] Start destroying Publisher
2025-05-19 15:08:18.453 [Thread-7] WARN  com.alibaba.nacos.common.notify.NotifyCenter - [NotifyCenter] Destruction of the end
2025-05-19 15:08:18.453 [Thread-1] WARN  c.alibaba.nacos.common.http.HttpClientBeanHolder - [HttpClientBeanHolder] Start destroying common HttpClient
2025-05-19 15:08:18.453 [Thread-1] WARN  c.alibaba.nacos.common.http.HttpClientBeanHolder - [HttpClientBeanHolder] Destruction of the end
2025-05-19 15:08:18.471 [NettyClientSelector_TMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - channel inactive: [id: 0x9fc5513a, L:/192.168.86.8:54812 ! R:/8.133.246.113:8091]
2025-05-19 15:08:18.471 [NettyClientSelector_TMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - return to pool, rm channel:[id: 0x9fc5513a, L:/192.168.86.8:54812 ! R:/8.133.246.113:8091]
2025-05-19 15:08:18.471 [NettyClientSelector_TMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - channel valid false,channel:[id: 0x9fc5513a, L:/192.168.86.8:54812 ! R:/8.133.246.113:8091]
2025-05-19 15:08:18.471 [NettyClientSelector_TMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - will destroy channel:[id: 0x9fc5513a, L:/192.168.86.8:54812 ! R:/8.133.246.113:8091]
2025-05-19 15:08:18.471 [NettyClientSelector_TMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0x9fc5513a, L:/192.168.86.8:54812 ! R:/8.133.246.113:8091]) will closed
2025-05-19 15:08:18.471 [NettyClientSelector_TMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0x9fc5513a, L:/192.168.86.8:54812 ! R:/8.133.246.113:8091]) will closed
2025-05-19 15:08:18.472 [NettyClientSelector_RMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - channel inactive: [id: 0x27eabbf2, L:/192.168.86.8:54815 ! R:/8.133.246.113:8091]
2025-05-19 15:08:18.472 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - return to pool, rm channel:[id: 0x27eabbf2, L:/192.168.86.8:54815 ! R:/8.133.246.113:8091]
2025-05-19 15:08:18.472 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - channel valid false,channel:[id: 0x27eabbf2, L:/192.168.86.8:54815 ! R:/8.133.246.113:8091]
2025-05-19 15:08:18.472 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - will destroy channel:[id: 0x27eabbf2, L:/192.168.86.8:54815 ! R:/8.133.246.113:8091]
2025-05-19 15:08:18.472 [NettyClientSelector_RMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0x27eabbf2, L:/192.168.86.8:54815 ! R:/8.133.246.113:8091]) will closed
2025-05-19 15:08:18.472 [NettyClientSelector_RMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0x27eabbf2, L:/192.168.86.8:54815 ! R:/8.133.246.113:8091]) will closed
2025-05-19 15:08:18.474 [SpringContextShutdownHook] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - De-registering from Nacos Server now...
2025-05-19 15:08:18.474 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - [DEREGISTER-SERVICE] d750d92e-152f-4055-a641-3bc9dda85a29 deregistering service bgtech-ai with instance: Instance{instanceId='null', ip='192.168.86.8', port=8080, weight=1.0, healthy=true, enabled=true, ephemeral=true, clusterName='DEFAULT', serviceName='null', metadata={}}
2025-05-19 15:08:18.484 [SpringContextShutdownHook] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - De-registration finished.
2025-05-19 15:08:18.486 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.cache.ServiceInfoHolder do shutdown begin
2025-05-19 15:08:18.486 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.backups.FailoverReactor do shutdown begin
2025-05-19 15:08:18.486 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.backups.FailoverReactor do shutdown stop
2025-05-19 15:08:18.486 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.cache.ServiceInfoHolder do shutdown stop
2025-05-19 15:08:18.486 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.NamingClientProxyDelegate do shutdown begin
2025-05-19 15:08:18.486 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServiceInfoUpdateService do shutdown begin
2025-05-19 15:08:18.486 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServiceInfoUpdateService do shutdown stop
2025-05-19 15:08:18.486 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServerListManager do shutdown begin
2025-05-19 15:08:18.486 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Start destroying NacosRestTemplate
2025-05-19 15:08:18.486 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Destruction of the end
2025-05-19 15:08:18.486 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServerListManager do shutdown stop
2025-05-19 15:08:18.486 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.http.NamingHttpClientProxy do shutdown begin
2025-05-19 15:08:18.486 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Start destroying NacosRestTemplate
2025-05-19 15:08:18.486 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Destruction of the end
2025-05-19 15:08:18.486 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.http.NamingHttpClientProxy do shutdown stop
2025-05-19 15:08:18.486 [SpringContextShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Shutdown rpc client, set status to shutdown
2025-05-19 15:08:18.486 [SpringContextShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Shutdown client event executor java.util.concurrent.ScheduledThreadPoolExecutor@b956207[Running, pool size = 2, active threads = 2, queued tasks = 0, completed tasks = 0]
2025-05-19 15:08:18.486 [SpringContextShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Close current connection 1747638378839_139.227.195.203_42931
2025-05-19 15:08:18.490 [nacos-grpc-client-executor-8.133.246.113-44] WARN  c.a.nacos.common.remote.client.grpc.GrpcClient - [1747638378839_139.227.195.203_42931]Ignore error event,isRunning:false,isAbandon=false
2025-05-19 15:08:18.492 [SpringContextShutdownHook] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - Shutdown grpc executor java.util.concurrent.ThreadPoolExecutor@71e393a2[Running, pool size = 6, active threads = 0, queued tasks = 0, completed tasks = 45]
2025-05-19 15:08:18.492 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - Shutdown grpc redo service executor java.util.concurrent.ScheduledThreadPoolExecutor@62f732e7[Running, pool size = 1, active threads = 0, queued tasks = 1, completed tasks = 39]
2025-05-19 15:08:18.492 [SpringContextShutdownHook] INFO  c.a.n.client.auth.ram.identify.CredentialWatcher - [null] CredentialWatcher is stopped
2025-05-19 15:08:18.492 [SpringContextShutdownHook] INFO  c.a.n.client.auth.ram.identify.CredentialService - [null] CredentialService is freed
2025-05-19 15:08:18.493 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.NamingClientProxyDelegate do shutdown stop
2025-05-19 15:08:19.058 [com.alibaba.nacos.client.Worker] INFO  c.a.n.client.auth.ram.identify.CredentialWatcher - null No credential found
2025-05-19 15:08:20.521 [SpringContextShutdownHook] DEBUG com.bgpay.bgai.config.AsyncConfig$1 - Shutting down ExecutorService 'blockingExecutor'
2025-05-19 15:08:20.572 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:10911] result: true
2025-05-19 15:08:20.573 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:9876] result: true
2025-05-19 15:08:20.573 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:10909] result: true
2025-05-19 15:08:20.588 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:10911] result: true
2025-05-19 15:08:20.588 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:9876] result: true
2025-05-19 15:08:20.697 [SpringContextShutdownHook] INFO  o.s.orm.jpa.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-05-19 15:08:20.699 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-2} closing ...
2025-05-19 15:08:20.704 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-2} closed
2025-05-19 15:08:20.705 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} closing ...
2025-05-19 15:08:20.705 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} closed
2025-05-19 15:09:09.908 [main] WARN  com.alibaba.nacos.client.logging.NacosLogging - Load Logback Configuration of Nacos fail, message: Could not initialize Logback Nacos logging from classpath:nacos-logback.xml
2025-05-19 15:09:09.909 [main] INFO  com.bgpay.bgai.BgaiApplication - The following 1 profile is active: "dev"
2025-05-19 15:09:11.291 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-05-19 15:09:11.292 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-05-19 15:09:11.317 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 18 ms. Found 0 JPA repository interfaces.
2025-05-19 15:09:11.328 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-05-19 15:09:11.329 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-05-19 15:09:11.342 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 5 ms. Found 0 Redis repository interfaces.
2025-05-19 15:09:12.002 [main] INFO  io.seata.config.ConfigurationFactory - load Configuration from :Spring Configuration
2025-05-19 15:09:12.028 [main] INFO  io.seata.config.ConfigurationFactory - load Configuration from :Spring Configuration
2025-05-19 15:09:12.038 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Initializing Global Transaction Clients ... 
2025-05-19 15:09:12.234 [main] INFO  io.seata.core.rpc.netty.NettyClientBootstrap - NettyClientBootstrap has started
2025-05-19 15:09:12.236 [main] INFO  io.seata.discovery.registry.RegistryFactory - use registry center type: file
2025-05-19 15:09:12.249 [main] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - will connect to 8.133.246.113:8091
2025-05-19 15:09:12.254 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - NettyPool create channel to transactionRole:TMROLE,address:8.133.246.113:8091,msg:< RegisterTMRequest{version='1.7.0', applicationId='bgtech-ai', transactionServiceGroup='bgai-tx-group', extraData='ak=null
digest=bgai-tx-group,192.168.86.8,1747638552252
timestamp=1747638552252
authVersion=V4
vgroup=bgai-tx-group
ip=192.168.86.8
'} >
2025-05-19 15:09:12.388 [main] INFO  io.seata.core.rpc.netty.TmNettyRemotingClient - register TM success. client version:1.7.0, server version:1.8.1-SNAPSHOT,channel:[id: 0x12586f91, L:/192.168.86.8:55882 - R:/8.133.246.113:8091]
2025-05-19 15:09:12.394 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - register success, cost 60 ms, version:1.8.1-SNAPSHOT,role:TMROLE,channel:[id: 0x12586f91, L:/192.168.86.8:55882 - R:/8.133.246.113:8091]
2025-05-19 15:09:12.395 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Transaction Manager Client is initialized. applicationId[bgtech-ai] txServiceGroup[bgai-tx-group]
2025-05-19 15:09:12.405 [main] INFO  io.seata.rm.datasource.AsyncWorker - Async Commit Buffer Limit: 10000
2025-05-19 15:09:12.406 [main] INFO  io.seata.rm.datasource.xa.ResourceManagerXA - ResourceManagerXA init ...
2025-05-19 15:09:12.412 [main] INFO  io.seata.core.rpc.netty.NettyClientBootstrap - NettyClientBootstrap has started
2025-05-19 15:09:12.412 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Resource Manager is initialized. applicationId[bgtech-ai] txServiceGroup[bgai-tx-group]
2025-05-19 15:09:12.412 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Global Transaction Clients are initialized. 
2025-05-19 15:09:13.555 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat initialized with port(s): 8080 (http)
2025-05-19 15:09:13.565 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - The ["http-nio-8080"] connector has been configured to support HTTP upgrade to [h2c]
2025-05-19 15:09:13.565 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - Initializing ProtocolHandler ["http-nio-8080"]
2025-05-19 15:09:13.567 [main] INFO  org.apache.catalina.core.StandardService - Starting service [Tomcat]
2025-05-19 15:09:13.568 [main] INFO  org.apache.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.15]
2025-05-19 15:09:14.014 [main] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} inited
2025-05-19 15:09:14.255 [main] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - will connect to 8.133.246.113:8091
2025-05-19 15:09:14.255 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - RM will register :jdbc:mysql://8.133.246.113:3306/deepseek
2025-05-19 15:09:14.255 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - NettyPool create channel to transactionRole:RMROLE,address:8.133.246.113:8091,msg:< RegisterRMRequest{resourceIds='jdbc:mysql://8.133.246.113:3306/deepseek', version='1.7.0', applicationId='bgtech-ai', transactionServiceGroup='bgai-tx-group', extraData='null'} >
2025-05-19 15:09:14.280 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - register RM success. client version:1.7.0, server version:1.8.1-SNAPSHOT,channel:[id: 0xd7e3cea3, L:/192.168.86.8:55889 - R:/8.133.246.113:8091]
2025-05-19 15:09:14.281 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - register success, cost 17 ms, version:1.8.1-SNAPSHOT,role:RMROLE,channel:[id: 0xd7e3cea3, L:/192.168.86.8:55889 - R:/8.133.246.113:8091]
2025-05-19 15:09:14.283 [main] INFO  i.s.s.a.datasource.SeataAutoDataSourceProxyCreator - Auto proxy data source 'masterDataSource' by 'AT' mode.
2025-05-19 15:09:14.355 [main] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-2} inited
2025-05-19 15:09:14.441 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - will register resourceId:jdbc:mysql://8.133.246.113:3306/deepseek
2025-05-19 15:09:14.442 [main] INFO  i.s.s.a.datasource.SeataAutoDataSourceProxyCreator - Auto proxy data source 'slaveDataSource' by 'AT' mode.
2025-05-19 15:09:14.451 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.rm.AbstractRMHandler - the rm client received response msg [RegisterRMResponse{version='1.8.1-SNAPSHOT', extraData='null', identified=true, resultCode=null, msg='null'}] from tc server.
2025-05-19 15:09:14.467 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - will register resourceId:jdbc:mysql://8.133.246.113:3306/deepseek
2025-05-19 15:09:14.467 [main] INFO  i.s.s.a.datasource.SeataAutoDataSourceProxyCreator - Auto proxy data source 'dynamicDataSource' by 'AT' mode.
2025-05-19 15:09:14.478 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.rm.AbstractRMHandler - the rm client received response msg [RegisterRMResponse{version='1.8.1-SNAPSHOT', extraData='null', identified=true, resultCode=null, msg='null'}] from tc server.
2025-05-19 15:09:14.581 [main] INFO  org.hibernate.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-05-19 15:09:14.641 [main] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.1.7.Final
2025-05-19 15:09:15.019 [main] INFO  SQL dialect - HHH000400: Using dialect: org.hibernate.dialect.MySQL8Dialect
2025-05-19 15:09:15.022 [main] WARN  org.hibernate.orm.deprecation - HHH90000026: MySQL8Dialect has been deprecated; use org.hibernate.dialect.MySQLDialect instead
2025-05-19 15:09:15.358 [main] INFO  o.h.e.t.jta.platform.internal.JtaPlatformInitiator - HHH000490: Using JtaPlatform implementation: [org.hibernate.engine.transaction.jta.platform.internal.NoJtaPlatform]
2025-05-19 15:09:15.371 [main] INFO  o.s.orm.jpa.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-05-19 15:09:15.841 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-19 15:09:15.855 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-19 15:09:15.882 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-19 15:09:15.884 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-19 15:09:15.885 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-19 15:09:15.896 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-19 15:09:16.521 [main] INFO  com.bgpay.bgai.service.impl.UserServiceImpl - 初始化SSO配置: clientId=bgai-client-id, redirectUri=http://localhost:8080/api/auth/callback
2025-05-19 15:09:16.653 [main] INFO  com.bgpay.bgai.controller.AuthController - 初始化认证控制器: clientId=bgai-client-id, redirectUri=http://localhost:8080/api/auth/callback
2025-05-19 15:09:17.230 [main] INFO  o.a.r.s.autoconfigure.RocketMQAutoConfiguration - a producer (billing-producer-group) init on namesrv 8.133.246.113:9876
2025-05-19 15:09:17.481 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Bean [com.bgpay.bgai.service.deepseek.DeepSeekServiceImp$$SpringCGLIB$$0] with name [deepSeekServiceImp] would use interceptor [io.seata.spring.annotation.GlobalTransactionalInterceptor]
2025-05-19 15:09:17.813 [main] WARN  i.s.s.b.a.provider.SpringBootConfigurationProvider - The get method not found for the field 'SeataProperties#accesskey'.
2025-05-19 15:09:17.814 [main] WARN  i.s.s.b.a.provider.SpringBootConfigurationProvider - The get method not found for the field 'SeataProperties#secretkey'.
2025-05-19 15:09:17.825 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 加载到1个Saga状态机定义文件
2025-05-19 15:09:17.957 [main] INFO  com.bgpay.bgai.saga.CustomSagaJsonParser - 开始解析状态机定义: bgai-saga-transaction
2025-05-19 15:09:17.957 [main] INFO  com.bgpay.bgai.saga.CustomSagaJsonParser - 状态机定义解析成功: bgai-saga-transaction
2025-05-19 15:09:17.957 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 成功加载状态机定义: /E:/project/bgai/target/classes/statelang/bgai-saga-transaction.json
2025-05-19 15:09:18.464 [main] INFO  org.redisson.Version - Redisson 3.24.3
2025-05-19 15:09:18.599 [redisson-netty-4-6] INFO  o.r.connection.pool.MasterPubSubConnectionPool - 1 connections initialized for 8.133.246.113/8.133.246.113:6379
2025-05-19 15:09:18.930 [redisson-netty-4-19] INFO  org.redisson.connection.pool.MasterConnectionPool - 24 connections initialized for 8.133.246.113/8.133.246.113:6379
2025-05-19 15:09:19.165 [main] INFO  com.bgpay.bgai.service.mq.MQConsumerService - MQ consumer startup successful [group=billing-consumer-group, topic=BILLING_TOPIC, tag=USER_BILLING]
2025-05-19 15:09:19.315 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Bean [com.bgpay.bgai.service.impl.SeataTransactionService$$SpringCGLIB$$0] with name [seataTransactionService] would use interceptor [io.seata.spring.annotation.GlobalTransactionalInterceptor]
2025-05-19 15:09:19.459 [main] DEBUG com.bgpay.bgai.config.AsyncConfig$1 - Initializing ExecutorService 'blockingExecutor'
2025-05-19 15:09:19.484 [main] INFO  c.b.bgai.config.NacosConfig$NacosWarningHandler - Nacos警告处理器已启用，将忽略配置中心连接警告
2025-05-19 15:09:20.823 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [After]
2025-05-19 15:09:20.823 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Before]
2025-05-19 15:09:20.824 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Between]
2025-05-19 15:09:20.824 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Cookie]
2025-05-19 15:09:20.824 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Header]
2025-05-19 15:09:20.824 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Host]
2025-05-19 15:09:20.824 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Method]
2025-05-19 15:09:20.824 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Path]
2025-05-19 15:09:20.824 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Query]
2025-05-19 15:09:20.824 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [ReadBody]
2025-05-19 15:09:20.824 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [RemoteAddr]
2025-05-19 15:09:20.824 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [XForwardedRemoteAddr]
2025-05-19 15:09:20.824 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Weight]
2025-05-19 15:09:20.824 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [CloudFoundryRouteService]
2025-05-19 15:09:22.228 [main] INFO  o.s.b.actuate.endpoint.web.EndpointLinksResolver - Exposing 1 endpoint(s) beneath base path '/actuator'
2025-05-19 15:09:22.556 [main] WARN  i.s.s.b.a.provider.SpringBootConfigurationProvider - The get method not found for the field 'SeataProperties#accesskey'.
2025-05-19 15:09:22.556 [main] WARN  i.s.s.b.a.provider.SpringBootConfigurationProvider - The get method not found for the field 'SeataProperties#secretkey'.
2025-05-19 15:09:22.570 [main] INFO  io.seata.saga.tm.DefaultSagaTransactionalTemplate - Initializing Global Transaction Clients ... 
2025-05-19 15:09:22.570 [main] INFO  io.seata.saga.tm.DefaultSagaTransactionalTemplate - Transaction Manager Client is initialized. applicationId[bgtech-ai] txServiceGroup[bgai-tx-group]
2025-05-19 15:09:22.570 [main] INFO  io.seata.saga.tm.DefaultSagaTransactionalTemplate - Resource Manager is initialized. applicationId[bgtech-ai] txServiceGroup[bgai-tx-group]
2025-05-19 15:09:22.571 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - will register resourceId:bgtech-ai#bgai-tx-group
2025-05-19 15:09:22.571 [main] INFO  io.seata.saga.tm.DefaultSagaTransactionalTemplate - Global Transaction Clients are initialized. 
2025-05-19 15:09:22.581 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.rm.AbstractRMHandler - the rm client received response msg [RegisterRMResponse{version='1.8.1-SNAPSHOT', extraData='null', identified=true, resultCode=null, msg='null'}] from tc server.
2025-05-19 15:09:23.832 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - Starting ProtocolHandler ["http-nio-8080"]
2025-05-19 15:09:23.846 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat started on port(s): 8080 (http) with context path ''
2025-05-19 15:09:23.856 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from ans.namespace attribute : null
2025-05-19 15:09:23.856 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from ALIBABA_ALIWARE_NAMESPACE attribute :null
2025-05-19 15:09:23.857 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from namespace attribute :null
2025-05-19 15:09:23.866 [main] INFO  c.a.n.p.auth.spi.client.ClientAuthPluginManager - [ClientAuthPluginManager] Load ClientAuthService com.alibaba.nacos.client.auth.impl.NacosClientAuthServiceImpl success.
2025-05-19 15:09:23.866 [main] INFO  c.a.n.p.auth.spi.client.ClientAuthPluginManager - [ClientAuthPluginManager] Load ClientAuthService com.alibaba.nacos.client.auth.ram.RamClientAuthServiceImpl success.
2025-05-19 15:09:23.870 [main] INFO  com.alibaba.nacos.common.remote.client - [RpcClientFactory] create a new rpc client of 4bd33f43-6e66-4f09-8d0b-217eba00a719
2025-05-19 15:09:23.871 [main] INFO  com.alibaba.nacos.common.remote.client - [4bd33f43-6e66-4f09-8d0b-217eba00a719] RpcClient init, ServerListFactory = com.alibaba.nacos.client.naming.core.ServerListManager
2025-05-19 15:09:23.871 [main] INFO  com.alibaba.nacos.common.remote.client - [4bd33f43-6e66-4f09-8d0b-217eba00a719] Registry connection listener to current client:com.alibaba.nacos.client.naming.remote.gprc.redo.NamingGrpcRedoService
2025-05-19 15:09:23.872 [main] INFO  com.alibaba.nacos.common.remote.client - [4bd33f43-6e66-4f09-8d0b-217eba00a719] Register server push request handler:com.alibaba.nacos.client.naming.remote.gprc.NamingPushRequestHandler
2025-05-19 15:09:23.872 [main] INFO  com.alibaba.nacos.common.remote.client - [4bd33f43-6e66-4f09-8d0b-217eba00a719] Try to connect to server on start up, server: {serverIp = '8.133.246.113', server main port = 8848}
2025-05-19 15:09:23.872 [main] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - grpc client connection server:8.133.246.113 ip,serverPort:9848,grpcTslConfig:{"sslProvider":"OPENSSL","enableTls":false,"mutualAuthEnable":false,"trustAll":false}
2025-05-19 15:09:24.002 [main] INFO  com.alibaba.nacos.common.remote.client - [4bd33f43-6e66-4f09-8d0b-217eba00a719] Success to connect to server [8.133.246.113:8848] on start up, connectionId = 1747638563897_139.227.195.203_42445
2025-05-19 15:09:24.002 [main] INFO  com.alibaba.nacos.common.remote.client - [4bd33f43-6e66-4f09-8d0b-217eba00a719] Register server push request handler:com.alibaba.nacos.common.remote.client.RpcClient$ConnectResetRequestHandler
2025-05-19 15:09:24.002 [main] INFO  com.alibaba.nacos.common.remote.client - [4bd33f43-6e66-4f09-8d0b-217eba00a719] Register server push request handler:com.alibaba.nacos.common.remote.client.RpcClient$$Lambda/0x00000297d1528cd8
2025-05-19 15:09:24.002 [com.alibaba.nacos.client.remote.worker] INFO  com.alibaba.nacos.common.remote.client - [4bd33f43-6e66-4f09-8d0b-217eba00a719] Notify connected event to listeners.
2025-05-19 15:09:24.002 [com.alibaba.nacos.client.remote.worker] INFO  com.alibaba.nacos.client.naming - Grpc connection connect
2025-05-19 15:09:24.003 [main] INFO  com.alibaba.nacos.client.naming - [REGISTER-SERVICE] d750d92e-152f-4055-a641-3bc9dda85a29 registering service bgtech-ai with instance Instance{instanceId='null', ip='192.168.86.8', port=8080, weight=1.0, healthy=true, enabled=true, ephemeral=true, clusterName='DEFAULT', serviceName='null', metadata={IPv6=[2408:820c:7528:8342:b486:9b72:4b72:4bf0], preserved.register.source=SPRING_CLOUD}}
2025-05-19 15:09:24.022 [main] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - nacos registry, DEFAULT_GROUP bgtech-ai 192.168.86.8:8080 register finished
2025-05-19 15:09:24.081 [main] INFO  com.bgpay.bgai.config.NacosConfig - 应用启动完成，当前环境: dev
2025-05-19 15:09:24.081 [main] INFO  com.bgpay.bgai.config.NacosConfig - Nacos配置中心: 8.133.246.113:8848, 命名空间: d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-19 15:09:24.081 [main] INFO  com.bgpay.bgai.config.NacosConfig - 注意: 如果看到Nacos配置加载警告，但应用正常启动，说明应用正在使用本地配置文件
2025-05-19 15:09:24.083 [main] INFO  com.bgpay.bgai.BgaiApplication - Started BgaiApplication in 16.266 seconds (process running for 17.629)
2025-05-19 15:09:24.087 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-19 15:09:24.087 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-19 15:09:24.097 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-19 15:09:24.098 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-19 15:09:24.098 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-19 15:09:24.107 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-19 15:09:24.108 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-19 15:09:24.108 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-19 15:09:24.116 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-19 15:09:24.116 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-19 15:09:24.117 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-19 15:09:24.123 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-19 15:09:24.123 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - ==================== Saga状态机加载报告 ====================
2025-05-19 15:09:24.123 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - Saga状态机配置加载状态: 成功
2025-05-19 15:09:24.123 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 已加载的状态机定义文件数量: 1
2025-05-19 15:09:24.123 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 已加载的状态机定义文件:
2025-05-19 15:09:24.123 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig -  - /E:/project/bgai/target/classes/statelang/bgai-saga-transaction.json
2025-05-19 15:09:24.123 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - Saga解析器状态: CUSTOM_FASTJSON2
2025-05-19 15:09:24.123 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 状态机解析结果: 成功 1 个, 失败 0 个
2025-05-19 15:09:24.123 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - =============================================================
2025-05-19 15:09:24.127 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - nacos.cache.data.init.snapshot = true 
2025-05-19 15:09:24.128 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] common-dev.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-19 15:09:24.139 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=common-dev.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-19 15:09:24.139 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=common-dev.yaml, group=DEFAULT_GROUP
2025-05-19 15:09:24.139 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-19 15:09:24.139 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-19 15:09:24.139 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai.yaml, group=DEFAULT_GROUP
2025-05-19 15:09:24.141 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai-dev.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-19 15:09:24.141 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai-dev.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-19 15:09:24.141 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai-dev.yaml, group=DEFAULT_GROUP
2025-05-19 15:09:24.141 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-19 15:09:24.141 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai, group=DEFAULT_GROUP, cnt=1
2025-05-19 15:09:24.141 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai, group=DEFAULT_GROUP
2025-05-19 15:09:29.276 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - 接收到请求: /api/chatGatWay-internal, 文件=新文件 17.txt, 问题参数=null, 模型参数=null
2025-05-19 15:09:29.278 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - 请求Content-Type: multipart/form-data;boundary=--------------------------367467232570206071272144
2025-05-19 15:09:29.279 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - 收集到的完整参数: question="null", apiUrl="null", modelName="null", multiTurn=false
2025-05-19 15:09:29.280 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - Processing request for user ID: 689258T
2025-05-19 15:09:29.280 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - Processing file with circuit breaker: fileName=新文件 17.txt, question=
2025-05-19 15:09:29.283 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.config.ReactiveFileProcessor - Processing file: 新文件 17.txt, content-type: text/plain
2025-05-19 15:09:29.289 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - PARAM TRACE [689258T]: 尝试查找匹配配置 - 参数: apiUrl=null, modelName=null
2025-05-19 15:09:29.302 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 查询配置 - userId=689258T
2025-05-19 15:09:29.303 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 排序方式 - 按ID降序
2025-05-19 15:09:29.303 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 限制结果数 - LIMIT 1
2025-05-19 15:09:29.374 [http-nio-8080-exec-2] DEBUG com.bgpay.bgai.mapper.ApiConfigMapper.selectList - ==>  Preparing: SELECT id,api_url,api_key,model_name,user_id FROM api_config WHERE (user_id = ?) ORDER BY id DESC LIMIT 1
2025-05-19 15:09:29.375 [http-nio-8080-exec-2] DEBUG com.bgpay.bgai.mapper.ApiConfigMapper.selectList - ==> Parameters: 689258T(String)
2025-05-19 15:09:29.384 [http-nio-8080-exec-2] DEBUG com.bgpay.bgai.mapper.ApiConfigMapper.selectList - <==      Total: 1
2025-05-19 15:09:29.385 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 查询结果 - 找到配置: id=2, modelName=deepseek-chat
2025-05-19 15:09:29.385 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - PARAM TRACE [689258T]: 找到匹配配置 - apiUrl=https://api.deepseek.com/chat/completions, modelName=deepseek-chat (原始请求: null)
2025-05-19 15:09:29.385 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - API config resolved: url=https://api.deepseek.com/chat/completions, model=deepseek-chat
2025-05-19 15:09:29.402 [Thread-49] INFO  com.bgpay.bgai.config.ReactiveFileProcessor - File processed successfully: size=2153 bytes
2025-05-19 15:09:29.406 [Thread-49] INFO  com.bgpay.bgai.controller.ReactiveChatController - Content processed, length: 2192
2025-05-19 15:09:29.412 [Thread-49] INFO  io.seata.tm.TransactionManagerHolder - TransactionManager Singleton io.seata.tm.DefaultTransactionManager@341f88e4
2025-05-19 15:09:29.428 [Thread-49] INFO  io.seata.tm.api.DefaultGlobalTransaction - Begin new global transaction [seata-server:8091:18666493999071238]
2025-05-19 15:09:29.430 [Thread-49] INFO  c.b.bgai.interceptor.SeataTransactionInterceptor - 准备记录分布式事务开始: XID=seata-server:8091:18666493999071238, 业务=com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive, 路径=, IP=, 用户=system
2025-05-19 15:09:29.447 [Thread-49] INFO  c.b.bgai.service.impl.TransactionLogServiceImpl - 记录分布式事务开始: XID=seata-server:8091:18666493999071238, 业务=com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive
2025-05-19 15:09:29.454 [Thread-49] DEBUG com.bgpay.bgai.mapper.TransactionLogMapper.insert - ==>  Preparing: INSERT INTO transaction_log ( xid, transaction_name, transaction_mode, status, request_path, source_ip, start_time, user_id, create_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-05-19 15:09:29.459 [Thread-49] DEBUG com.bgpay.bgai.mapper.TransactionLogMapper.insert - ==> Parameters: seata-server:8091:18666493999071238(String), com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive(String), AT(String), ACTIVE(String), (String), (String), 2025-05-19T15:09:29.447850800(LocalDateTime), system(String), 2025-05-19T15:09:29.447850800(LocalDateTime)
2025-05-19 15:09:29.921 [Thread-49] DEBUG com.bgpay.bgai.mapper.TransactionLogMapper.insert - <==    Updates: 1
2025-05-19 15:09:29.941 [Thread-49] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:18666493999071238, branchId:18666493999071239, lockKeys:transaction_log:7
2025-05-19 15:09:29.954 [Thread-49] WARN  i.s.c.l.EnhancedServiceLoader$InnerEnhancedServiceLoader - Load [io.seata.rm.datasource.undo.parser.ProtostuffUndoLogParser] class fail: io/protostuff/runtime/IdStrategy
2025-05-19 15:09:30.031 [Thread-49] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:18666493999071238, branchId:18666493999071240, lockKeys:transaction_log:7;undo_log:25
2025-05-19 15:09:30.059 [Thread-49] INFO  c.b.bgai.interceptor.SeataTransactionInterceptor - 开始分布式事务: XID=seata-server:8091:18666493999071238, 方法=com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive
2025-05-19 15:09:30.073 [Thread-49] INFO  org.reflections.Reflections - Processing reactive request: content length=2192, apiUrl=https://api.deepseek.com/chat/completions, modelName=deepseek-chat, userId=689258T, multiTurn=false
2025-05-19 15:09:30.097 [Thread-49] INFO  com.bgpay.bgai.transaction.TransactionCoordinator - Transaction prepared for user 689258T: chatCompletionId=chat-aaa17498-11a2-47e2-afd6-cae6d8409641
2025-05-19 15:09:30.099 [Thread-49] INFO  org.reflections.Reflections - Generated request JSON with 2PC transaction: {"stream":false,"max_tokens":2000,"temperature":1.0,"messages":[{"content":"You are a helpful assist...
2025-05-19 15:09:30.125 [Thread-49] INFO  c.b.bgai.service.impl.TransactionLogServiceImpl - 记录分布式事务结束: XID=seata-server:8091:18666493999071238, 状态=COMMITTED
2025-05-19 15:09:30.128 [Thread-49] DEBUG c.b.bgai.mapper.TransactionLogMapper.selectList - ==>  Preparing: SELECT id,xid,branch_id,transaction_name,transaction_mode,status,request_path,source_ip,start_time,end_time,user_id,extra_data,create_time,update_time FROM transaction_log WHERE (xid = ?) LIMIT 1
2025-05-19 15:09:30.131 [Thread-49] DEBUG c.b.bgai.mapper.TransactionLogMapper.selectList - ==> Parameters: seata-server:8091:18666493999071238(String)
2025-05-19 15:09:30.139 [Thread-49] DEBUG c.b.bgai.mapper.TransactionLogMapper.selectList - <==      Total: 1
2025-05-19 15:09:30.145 [Thread-49] DEBUG c.b.bgai.mapper.TransactionLogMapper.updateById - ==>  Preparing: UPDATE transaction_log SET xid=?, transaction_name=?, transaction_mode=?, status=?, request_path=?, source_ip=?, start_time=?, end_time=?, user_id=?, extra_data=?, create_time=?, update_time=? WHERE id=?
2025-05-19 15:09:30.153 [Thread-49] DEBUG c.b.bgai.mapper.TransactionLogMapper.updateById - ==> Parameters: seata-server:8091:18666493999071238(String), com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive(String), AT(String), COMMITTED(String), (String), (String), 2025-05-19T15:09:29(LocalDateTime), 2025-05-19T15:09:30.139831400(LocalDateTime), system(String), {"duration":60,"result":"success"}(String), 2025-05-19T15:09:29(LocalDateTime), 2025-05-19T15:09:30.139831400(LocalDateTime), 7(Long)
2025-05-19 15:09:30.212 [Thread-49] DEBUG c.b.bgai.mapper.TransactionLogMapper.updateById - <==    Updates: 1
2025-05-19 15:09:30.223 [Thread-49] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:18666493999071238, branchId:18666493999071241, lockKeys:transaction_log:7
2025-05-19 15:09:30.246 [Thread-49] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:18666493999071238, branchId:18666493999071242, lockKeys:transaction_log:7;undo_log:27
2025-05-19 15:09:30.269 [Thread-49] INFO  c.b.bgai.interceptor.SeataTransactionInterceptor - 分布式事务成功完成: XID=seata-server:8091:18666493999071238, 耗时=60ms
2025-05-19 15:09:30.269 [Thread-49] INFO  io.seata.tm.api.DefaultGlobalTransaction - transaction seata-server:8091:18666493999071238 will be commit
2025-05-19 15:09:30.282 [Thread-49] INFO  io.seata.tm.api.DefaultGlobalTransaction - transaction end, xid = seata-server:8091:18666493999071238
2025-05-19 15:09:30.282 [Thread-49] INFO  io.seata.tm.api.DefaultGlobalTransaction - [seata-server:8091:18666493999071238] commit status: Committed
2025-05-19 15:09:30.551 [rpcDispatch_RMROLE_1_1_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:18666493999071238', branchId=18666493999071239, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false,"skipCheckLock":true}'}
2025-05-19 15:09:30.553 [rpcDispatch_RMROLE_1_1_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:18666493999071238 18666493999071239 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false,"skipCheckLock":true}
2025-05-19 15:09:30.554 [rpcDispatch_RMROLE_1_1_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-19 15:09:30.566 [rpcDispatch_RMROLE_1_2_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:18666493999071238', branchId=18666493999071240, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false,"skipCheckLock":true}'}
2025-05-19 15:09:30.566 [rpcDispatch_RMROLE_1_2_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:18666493999071238 18666493999071240 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false,"skipCheckLock":true}
2025-05-19 15:09:30.566 [rpcDispatch_RMROLE_1_2_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-19 15:09:30.581 [rpcDispatch_RMROLE_1_3_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:18666493999071238', branchId=18666493999071241, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false}'}
2025-05-19 15:09:30.581 [rpcDispatch_RMROLE_1_3_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:18666493999071238 18666493999071241 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false}
2025-05-19 15:09:30.581 [rpcDispatch_RMROLE_1_3_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-19 15:09:30.590 [rpcDispatch_RMROLE_1_4_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:18666493999071238', branchId=18666493999071242, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false}'}
2025-05-19 15:09:30.591 [rpcDispatch_RMROLE_1_4_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:18666493999071238 18666493999071242 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false}
2025-05-19 15:09:30.591 [rpcDispatch_RMROLE_1_4_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-19 15:09:56.336 [reactor-http-nio-3] INFO  org.reflections.Reflections - Raw response received, length: 2141
2025-05-19 15:09:56.341 [reactor-http-nio-3] WARN  org.reflections.Reflections - Received different chatCompletionId from response: aef1c00b-472b-4812-a35d-8f85d9f6d0ee vs prepared: chat-aaa17498-11a2-47e2-afd6-cae6d8409641
2025-05-19 15:09:56.358 [reactor-http-nio-3] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - ==>  Preparing: INSERT INTO chat_completions ( object, created, model, system_fingerprint, api_key ) VALUES ( ?, ?, ?, ?, ? )
2025-05-19 15:09:56.358 [reactor-http-nio-3] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - ==> Parameters: chat.completion(String), 1747638596356(Long), deepseek-chat(String), 689258T(String), chat-aaa17498-11a2-47e2-afd6-cae6d8409641(String)
2025-05-19 15:09:56.370 [reactor-http-nio-3] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - <==    Updates: 1
2025-05-19 15:09:56.371 [reactor-http-nio-3] INFO  com.bgpay.bgai.transaction.TransactionCoordinator - Transaction committed for user 689258T: chatCompletionId=chat-aaa17498-11a2-47e2-afd6-cae6d8409641
2025-05-19 15:09:56.404 [FileWrite-1] INFO  com.bgpay.bgai.service.deepseek.FileWriterService - Successfully wrote content to: \var\data\ai_responses\9ffa87a8-f833-4c5b-9d81-7160943357d1.txt
2025-05-19 15:09:56.415 [boundedElastic-1] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - ==>  Preparing: INSERT INTO chat_completions ( object, created, model, system_fingerprint, api_key ) VALUES ( ?, ?, ?, ?, ? )
2025-05-19 15:09:56.416 [boundedElastic-1] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - ==> Parameters: chat.completion(String), 1747638570(Long), deepseek-chat(String), fp_8802369eaa_prod0425fp8(String), chat-aaa17498-11a2-47e2-afd6-cae6d8409641(String)
2025-05-19 15:09:56.428 [boundedElastic-1] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - <==    Updates: 1
2025-05-19 15:09:56.467 [boundedElastic-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.insert - ==>  Preparing: INSERT INTO usage_info ( chat_completion_id, prompt_tokens, completion_tokens, total_tokens, prompt_tokens_cached, completion_reasoning_tokens, prompt_cache_hit_tokens, prompt_cache_miss_tokens, created_at, model_type ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-05-19 15:09:56.468 [boundedElastic-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.insert - ==> Parameters: chat-aaa17498-11a2-47e2-afd6-cae6d8409641(String), 721(Integer), 402(Integer), 1123(Integer), 704(Integer), 0(Integer), 0(Integer), 17(Integer), 2025-05-19T15:09:56.457401500(LocalDateTime), deepseek-chat(String)
2025-05-19 15:09:56.481 [boundedElastic-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.insert - <==    Updates: 1
2025-05-19 15:09:56.507 [boundedElastic-1] INFO  org.reflections.Reflections - Completion data saved synchronously for chatCompletionId: chat-aaa17498-11a2-47e2-afd6-cae6d8409641
2025-05-19 15:09:56.511 [boundedElastic-2] INFO  org.reflections.Reflections - 开始发送账单消息，chatCompletionId: chat-aaa17498-11a2-47e2-afd6-cae6d8409641, userId: 689258T
2025-05-19 15:09:56.550 [boundedElastic-2] INFO  org.reflections.Reflections - 账单消息发送成功，chatCompletionId: chat-aaa17498-11a2-47e2-afd6-cae6d8409641, userId: 689258T
2025-05-19 15:09:56.553 [boundedElastic-1] INFO  org.reflections.Reflections - Complete processing chain completed: This appears to be a configuration file for Seata, an open-source distributed transaction solution. Let me break down the key configurations:

### Basic Configuration
- `enabled: true`: Enables Seata functionality
- `application-id: bgai`: Identifies the application
- `tx-service-group: bgai-tx-group`: Transaction service group name
- `enable-auto-data-source-proxy: true`: Enables automatic data source proxying

### Resource Manager (RM) Configuration
- Async commit buffer limit: 10,000
- Report retry count: 5
- Lock settings:
  - Retry interval: 10ms
  - Retry times: 30
  - Rollback on conflict: true

### Transaction Manager (TM) Configuration
- Commit/rollback retry count: 5
- Default global transaction timeout: 60,000ms (1 minute)
- Degrade check settings

### Undo Log Configuration
- Data validation enabled
- Uses Jackson for log serialization
- Undo log table name: `undo_log`

### Service Configuration
- Maps `bgai-tx-group` to default server
- TC server address: `8.133.246.113:8091`
- Global transaction enabled

### Transport Configuration
- Uses TCP/NIO
- Heartbeat enabled
- Thread pool settings for Netty
- Batch sending enabled

### Saga Configuration
- Saga mode enabled
- State machine settings:
  - Table prefix: `seata_`
  - Thread pool configuration
  - Timeout settings
  - Auto-registers resources from JSON files

This configuration sets up Seata for distributed transactions with:
- A connection to TC server at 8.133.246.113:8091
- Saga pattern support
- Reasonable timeout and retry settings
- Undo log tracking for transaction recovery

Would you like me to explain any specific part in more detail?
2025-05-19 15:09:56.553 [boundedElastic-1] INFO  com.bgpay.bgai.controller.ReactiveChatController - Processed response for user 689258T, content length: 1637
2025-05-19 15:10:19.695 [pool-7-thread-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.selectCount - ==>  Preparing: SELECT COUNT( * ) AS total FROM usage_info WHERE (chat_completion_id = ?)
2025-05-19 15:10:19.695 [pool-7-thread-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.selectCount - ==> Parameters: chat-aaa17498-11a2-47e2-afd6-cae6d8409641(String)
2025-05-19 15:10:19.701 [pool-7-thread-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.selectCount - <==      Total: 1
2025-05-19 15:10:19.878 [ConsumeMessageThread_billing-consumer-group_1] INFO  c.bgpay.bgai.service.mq.RocketMQBillingServiceImpl - Output price config priceVersion: 1
2025-05-19 15:10:19.881 [ConsumeMessageThread_billing-consumer-group_1] DEBUG com.bgpay.bgai.mapper.UsageRecordMapper.insert - ==>  Preparing: INSERT INTO usage_record ( model_type, chat_completion_id, user_id, input_cost, output_cost, price_version, calculated_at ) VALUES ( ?, ?, ?, ?, ?, ?, ? )
2025-05-19 15:10:19.882 [ConsumeMessageThread_billing-consumer-group_1] DEBUG com.bgpay.bgai.mapper.UsageRecordMapper.insert - ==> Parameters: deepseek-chat(String), chat-aaa17498-11a2-47e2-afd6-cae6d8409641(String), 689258T(String), 0.0000(BigDecimal), 0.0032(BigDecimal), 1(Integer), 2025-05-19T15:10:19.878639600(LocalDateTime)
2025-05-19 15:10:19.898 [ConsumeMessageThread_billing-consumer-group_1] DEBUG com.bgpay.bgai.mapper.UsageRecordMapper.insert - <==    Updates: 1
2025-05-19 15:10:19.909 [ConsumeMessageThread_billing-consumer-group_1] INFO  c.bgpay.bgai.service.mq.RocketMQBillingServiceImpl - Message consumed: 2408820C75288342B4869B724B724BF0D36036BAF30C5FF38BB60000
2025-05-19 15:10:32.258 [Thread-7] WARN  com.alibaba.nacos.common.notify.NotifyCenter - [NotifyCenter] Start destroying Publisher
2025-05-19 15:10:32.259 [Thread-7] WARN  com.alibaba.nacos.common.notify.NotifyCenter - [NotifyCenter] Destruction of the end
2025-05-19 15:10:32.259 [Thread-1] WARN  c.alibaba.nacos.common.http.HttpClientBeanHolder - [HttpClientBeanHolder] Start destroying common HttpClient
2025-05-19 15:10:32.259 [Thread-1] WARN  c.alibaba.nacos.common.http.HttpClientBeanHolder - [HttpClientBeanHolder] Destruction of the end
2025-05-19 15:10:32.279 [NettyClientSelector_TMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - channel inactive: [id: 0x12586f91, L:/192.168.86.8:55882 ! R:/8.133.246.113:8091]
2025-05-19 15:10:32.279 [NettyClientSelector_TMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - return to pool, rm channel:[id: 0x12586f91, L:/192.168.86.8:55882 ! R:/8.133.246.113:8091]
2025-05-19 15:10:32.279 [NettyClientSelector_TMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - channel valid false,channel:[id: 0x12586f91, L:/192.168.86.8:55882 ! R:/8.133.246.113:8091]
2025-05-19 15:10:32.279 [NettyClientSelector_TMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - will destroy channel:[id: 0x12586f91, L:/192.168.86.8:55882 ! R:/8.133.246.113:8091]
2025-05-19 15:10:32.279 [NettyClientSelector_TMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0x12586f91, L:/192.168.86.8:55882 ! R:/8.133.246.113:8091]) will closed
2025-05-19 15:10:32.279 [NettyClientSelector_TMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0x12586f91, L:/192.168.86.8:55882 ! R:/8.133.246.113:8091]) will closed
2025-05-19 15:10:32.279 [NettyClientSelector_RMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - channel inactive: [id: 0xd7e3cea3, L:/192.168.86.8:55889 ! R:/8.133.246.113:8091]
2025-05-19 15:10:32.279 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - return to pool, rm channel:[id: 0xd7e3cea3, L:/192.168.86.8:55889 ! R:/8.133.246.113:8091]
2025-05-19 15:10:32.279 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - channel valid false,channel:[id: 0xd7e3cea3, L:/192.168.86.8:55889 ! R:/8.133.246.113:8091]
2025-05-19 15:10:32.279 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - will destroy channel:[id: 0xd7e3cea3, L:/192.168.86.8:55889 ! R:/8.133.246.113:8091]
2025-05-19 15:10:32.279 [NettyClientSelector_RMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0xd7e3cea3, L:/192.168.86.8:55889 ! R:/8.133.246.113:8091]) will closed
2025-05-19 15:10:32.279 [NettyClientSelector_RMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0xd7e3cea3, L:/192.168.86.8:55889 ! R:/8.133.246.113:8091]) will closed
2025-05-19 15:10:32.282 [SpringContextShutdownHook] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - De-registering from Nacos Server now...
2025-05-19 15:10:32.282 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - [DEREGISTER-SERVICE] d750d92e-152f-4055-a641-3bc9dda85a29 deregistering service bgtech-ai with instance: Instance{instanceId='null', ip='192.168.86.8', port=8080, weight=1.0, healthy=true, enabled=true, ephemeral=true, clusterName='DEFAULT', serviceName='null', metadata={}}
2025-05-19 15:10:32.291 [SpringContextShutdownHook] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - De-registration finished.
2025-05-19 15:10:32.292 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.cache.ServiceInfoHolder do shutdown begin
2025-05-19 15:10:32.292 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.backups.FailoverReactor do shutdown begin
2025-05-19 15:10:32.292 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.backups.FailoverReactor do shutdown stop
2025-05-19 15:10:32.292 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.cache.ServiceInfoHolder do shutdown stop
2025-05-19 15:10:32.292 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.NamingClientProxyDelegate do shutdown begin
2025-05-19 15:10:32.292 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServiceInfoUpdateService do shutdown begin
2025-05-19 15:10:32.292 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServiceInfoUpdateService do shutdown stop
2025-05-19 15:10:32.293 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServerListManager do shutdown begin
2025-05-19 15:10:32.293 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Start destroying NacosRestTemplate
2025-05-19 15:10:32.293 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Destruction of the end
2025-05-19 15:10:32.293 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServerListManager do shutdown stop
2025-05-19 15:10:32.293 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.http.NamingHttpClientProxy do shutdown begin
2025-05-19 15:10:32.293 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Start destroying NacosRestTemplate
2025-05-19 15:10:32.293 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Destruction of the end
2025-05-19 15:10:32.293 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.http.NamingHttpClientProxy do shutdown stop
2025-05-19 15:10:32.293 [SpringContextShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Shutdown rpc client, set status to shutdown
2025-05-19 15:10:32.293 [SpringContextShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Shutdown client event executor java.util.concurrent.ScheduledThreadPoolExecutor@7166a6f7[Running, pool size = 2, active threads = 2, queued tasks = 0, completed tasks = 0]
2025-05-19 15:10:32.293 [SpringContextShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Close current connection 1747638563897_139.227.195.203_42445
2025-05-19 15:10:32.296 [nacos-grpc-client-executor-8.133.246.113-22] WARN  c.a.nacos.common.remote.client.grpc.GrpcClient - [1747638563897_139.227.195.203_42445]Ignore error event,isRunning:false,isAbandon=false
2025-05-19 15:10:32.298 [SpringContextShutdownHook] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - Shutdown grpc executor java.util.concurrent.ThreadPoolExecutor@50a9fa29[Running, pool size = 6, active threads = 0, queued tasks = 0, completed tasks = 23]
2025-05-19 15:10:32.298 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - Shutdown grpc redo service executor java.util.concurrent.ScheduledThreadPoolExecutor@43dbbaf5[Running, pool size = 1, active threads = 0, queued tasks = 1, completed tasks = 22]
2025-05-19 15:10:32.299 [SpringContextShutdownHook] INFO  c.a.n.client.auth.ram.identify.CredentialWatcher - [null] CredentialWatcher is stopped
2025-05-19 15:10:32.299 [SpringContextShutdownHook] INFO  c.a.n.client.auth.ram.identify.CredentialService - [null] CredentialService is freed
2025-05-19 15:10:32.299 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.NamingClientProxyDelegate do shutdown stop
2025-05-19 15:10:33.709 [com.alibaba.nacos.client.Worker] INFO  c.a.n.client.auth.ram.identify.CredentialWatcher - null No credential found
2025-05-19 15:10:34.331 [SpringContextShutdownHook] DEBUG com.bgpay.bgai.config.AsyncConfig$1 - Shutting down ExecutorService 'blockingExecutor'
2025-05-19 15:10:34.382 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:10909] result: true
2025-05-19 15:10:34.382 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:10911] result: true
2025-05-19 15:10:34.382 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:9876] result: true
2025-05-19 15:10:34.395 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:10911] result: true
2025-05-19 15:10:34.396 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:9876] result: true
2025-05-19 15:10:34.508 [SpringContextShutdownHook] INFO  o.s.orm.jpa.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-05-19 15:10:34.510 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-2} closing ...
2025-05-19 15:10:34.515 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-2} closed
2025-05-19 15:10:34.515 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} closing ...
2025-05-19 15:10:34.515 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} closed
2025-05-19 15:17:00.999 [main] WARN  com.alibaba.nacos.client.logging.NacosLogging - Load Logback Configuration of Nacos fail, message: Could not initialize Logback Nacos logging from classpath:nacos-logback.xml
2025-05-19 15:17:01.000 [main] INFO  com.bgpay.bgai.BgaiApplication - The following 1 profile is active: "dev"
2025-05-19 15:17:02.306 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-05-19 15:17:02.307 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-05-19 15:17:02.329 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 16 ms. Found 0 JPA repository interfaces.
2025-05-19 15:17:02.340 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-05-19 15:17:02.341 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-05-19 15:17:02.352 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 4 ms. Found 0 Redis repository interfaces.
2025-05-19 15:17:02.933 [main] INFO  io.seata.config.ConfigurationFactory - load Configuration from :Spring Configuration
2025-05-19 15:17:02.942 [main] INFO  io.seata.config.ConfigurationFactory - load Configuration from :Spring Configuration
2025-05-19 15:17:02.948 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Initializing Global Transaction Clients ... 
2025-05-19 15:17:03.049 [main] INFO  io.seata.core.rpc.netty.NettyClientBootstrap - NettyClientBootstrap has started
2025-05-19 15:17:03.050 [main] INFO  io.seata.discovery.registry.RegistryFactory - use registry center type: file
2025-05-19 15:17:03.060 [main] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - will connect to 8.133.246.113:8091
2025-05-19 15:17:03.064 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - NettyPool create channel to transactionRole:TMROLE,address:8.133.246.113:8091,msg:< RegisterTMRequest{version='1.7.0', applicationId='bgtech-ai', transactionServiceGroup='bgai-tx-group', extraData='ak=null
digest=bgai-tx-group,192.168.86.8,1747639023063
timestamp=1747639023063
authVersion=V4
vgroup=bgai-tx-group
ip=192.168.86.8
'} >
2025-05-19 15:17:03.197 [main] INFO  io.seata.core.rpc.netty.TmNettyRemotingClient - register TM success. client version:1.7.0, server version:1.8.1-SNAPSHOT,channel:[id: 0x6c761f46, L:/192.168.86.8:55793 - R:/8.133.246.113:8091]
2025-05-19 15:17:03.205 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - register success, cost 65 ms, version:1.8.1-SNAPSHOT,role:TMROLE,channel:[id: 0x6c761f46, L:/192.168.86.8:55793 - R:/8.133.246.113:8091]
2025-05-19 15:17:03.205 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Transaction Manager Client is initialized. applicationId[bgtech-ai] txServiceGroup[bgai-tx-group]
2025-05-19 15:17:03.217 [main] INFO  io.seata.rm.datasource.AsyncWorker - Async Commit Buffer Limit: 10000
2025-05-19 15:17:03.218 [main] INFO  io.seata.rm.datasource.xa.ResourceManagerXA - ResourceManagerXA init ...
2025-05-19 15:17:03.225 [main] INFO  io.seata.core.rpc.netty.NettyClientBootstrap - NettyClientBootstrap has started
2025-05-19 15:17:03.225 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Resource Manager is initialized. applicationId[bgtech-ai] txServiceGroup[bgai-tx-group]
2025-05-19 15:17:03.225 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Global Transaction Clients are initialized. 
2025-05-19 15:17:04.369 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat initialized with port(s): 8080 (http)
2025-05-19 15:17:04.379 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - The ["http-nio-8080"] connector has been configured to support HTTP upgrade to [h2c]
2025-05-19 15:17:04.379 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - Initializing ProtocolHandler ["http-nio-8080"]
2025-05-19 15:17:04.380 [main] INFO  org.apache.catalina.core.StandardService - Starting service [Tomcat]
2025-05-19 15:17:04.380 [main] INFO  org.apache.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.15]
2025-05-19 15:17:04.744 [main] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} inited
2025-05-19 15:17:04.985 [main] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - will connect to 8.133.246.113:8091
2025-05-19 15:17:04.985 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - RM will register :jdbc:mysql://8.133.246.113:3306/deepseek
2025-05-19 15:17:04.985 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - NettyPool create channel to transactionRole:RMROLE,address:8.133.246.113:8091,msg:< RegisterRMRequest{resourceIds='jdbc:mysql://8.133.246.113:3306/deepseek', version='1.7.0', applicationId='bgtech-ai', transactionServiceGroup='bgai-tx-group', extraData='null'} >
2025-05-19 15:17:05.006 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - register RM success. client version:1.7.0, server version:1.8.1-SNAPSHOT,channel:[id: 0x7085cdd6, L:/192.168.86.8:55800 - R:/8.133.246.113:8091]
2025-05-19 15:17:05.006 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - register success, cost 13 ms, version:1.8.1-SNAPSHOT,role:RMROLE,channel:[id: 0x7085cdd6, L:/192.168.86.8:55800 - R:/8.133.246.113:8091]
2025-05-19 15:17:05.008 [main] INFO  i.s.s.a.datasource.SeataAutoDataSourceProxyCreator - Auto proxy data source 'masterDataSource' by 'AT' mode.
2025-05-19 15:17:05.081 [main] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-2} inited
2025-05-19 15:17:05.143 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - will register resourceId:jdbc:mysql://8.133.246.113:3306/deepseek
2025-05-19 15:17:05.144 [main] INFO  i.s.s.a.datasource.SeataAutoDataSourceProxyCreator - Auto proxy data source 'slaveDataSource' by 'AT' mode.
2025-05-19 15:17:05.152 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.rm.AbstractRMHandler - the rm client received response msg [RegisterRMResponse{version='1.8.1-SNAPSHOT', extraData='null', identified=true, resultCode=null, msg='null'}] from tc server.
2025-05-19 15:17:05.165 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - will register resourceId:jdbc:mysql://8.133.246.113:3306/deepseek
2025-05-19 15:17:05.165 [main] INFO  i.s.s.a.datasource.SeataAutoDataSourceProxyCreator - Auto proxy data source 'dynamicDataSource' by 'AT' mode.
2025-05-19 15:17:05.174 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.rm.AbstractRMHandler - the rm client received response msg [RegisterRMResponse{version='1.8.1-SNAPSHOT', extraData='null', identified=true, resultCode=null, msg='null'}] from tc server.
2025-05-19 15:17:05.276 [main] INFO  org.hibernate.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-05-19 15:17:05.345 [main] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.1.7.Final
2025-05-19 15:17:05.687 [main] INFO  SQL dialect - HHH000400: Using dialect: org.hibernate.dialect.MySQL8Dialect
2025-05-19 15:17:05.689 [main] WARN  org.hibernate.orm.deprecation - HHH90000026: MySQL8Dialect has been deprecated; use org.hibernate.dialect.MySQLDialect instead
2025-05-19 15:17:05.941 [main] INFO  o.h.e.t.jta.platform.internal.JtaPlatformInitiator - HHH000490: Using JtaPlatform implementation: [org.hibernate.engine.transaction.jta.platform.internal.NoJtaPlatform]
2025-05-19 15:17:05.951 [main] INFO  o.s.orm.jpa.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-05-19 15:17:06.305 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-19 15:17:06.315 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-19 15:17:06.341 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-19 15:17:06.343 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-19 15:17:06.343 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-19 15:17:06.354 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-19 15:17:06.965 [main] INFO  com.bgpay.bgai.service.impl.UserServiceImpl - 初始化SSO配置: clientId=bgai-client-id, redirectUri=http://localhost:8080/api/auth/callback
2025-05-19 15:17:07.094 [main] INFO  com.bgpay.bgai.controller.AuthController - 初始化认证控制器: clientId=bgai-client-id, redirectUri=http://localhost:8080/api/auth/callback
2025-05-19 15:17:07.672 [main] INFO  o.a.r.s.autoconfigure.RocketMQAutoConfiguration - a producer (billing-producer-group) init on namesrv 8.133.246.113:9876
2025-05-19 15:17:07.921 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Bean [com.bgpay.bgai.service.deepseek.DeepSeekServiceImp$$SpringCGLIB$$0] with name [deepSeekServiceImp] would use interceptor [io.seata.spring.annotation.GlobalTransactionalInterceptor]
2025-05-19 15:17:08.241 [main] WARN  i.s.s.b.a.provider.SpringBootConfigurationProvider - The get method not found for the field 'SeataProperties#accesskey'.
2025-05-19 15:17:08.241 [main] WARN  i.s.s.b.a.provider.SpringBootConfigurationProvider - The get method not found for the field 'SeataProperties#secretkey'.
2025-05-19 15:17:08.252 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 加载到1个Saga状态机定义文件
2025-05-19 15:17:08.398 [main] INFO  com.bgpay.bgai.saga.CustomSagaJsonParser - 开始解析状态机定义: bgai-saga-transaction
2025-05-19 15:17:08.399 [main] INFO  com.bgpay.bgai.saga.CustomSagaJsonParser - 状态机定义解析成功: bgai-saga-transaction
2025-05-19 15:17:08.399 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 成功加载状态机定义: /E:/project/bgai/target/classes/statelang/bgai-saga-transaction.json
2025-05-19 15:17:08.869 [main] INFO  org.redisson.Version - Redisson 3.24.3
2025-05-19 15:17:08.995 [redisson-netty-4-6] INFO  o.r.connection.pool.MasterPubSubConnectionPool - 1 connections initialized for 8.133.246.113/8.133.246.113:6379
2025-05-19 15:17:09.389 [redisson-netty-4-19] INFO  org.redisson.connection.pool.MasterConnectionPool - 24 connections initialized for 8.133.246.113/8.133.246.113:6379
2025-05-19 15:17:09.644 [main] INFO  com.bgpay.bgai.service.mq.MQConsumerService - MQ consumer startup successful [group=billing-consumer-group, topic=BILLING_TOPIC, tag=USER_BILLING]
2025-05-19 15:17:09.799 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Bean [com.bgpay.bgai.service.impl.SeataTransactionService$$SpringCGLIB$$0] with name [seataTransactionService] would use interceptor [io.seata.spring.annotation.GlobalTransactionalInterceptor]
2025-05-19 15:17:09.925 [main] DEBUG com.bgpay.bgai.config.AsyncConfig$1 - Initializing ExecutorService 'blockingExecutor'
2025-05-19 15:17:09.949 [main] INFO  c.b.bgai.config.NacosConfig$NacosWarningHandler - Nacos警告处理器已启用，将忽略配置中心连接警告
2025-05-19 15:17:11.212 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [After]
2025-05-19 15:17:11.213 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Before]
2025-05-19 15:17:11.213 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Between]
2025-05-19 15:17:11.213 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Cookie]
2025-05-19 15:17:11.213 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Header]
2025-05-19 15:17:11.213 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Host]
2025-05-19 15:17:11.213 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Method]
2025-05-19 15:17:11.213 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Path]
2025-05-19 15:17:11.213 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Query]
2025-05-19 15:17:11.213 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [ReadBody]
2025-05-19 15:17:11.213 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [RemoteAddr]
2025-05-19 15:17:11.213 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [XForwardedRemoteAddr]
2025-05-19 15:17:11.213 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Weight]
2025-05-19 15:17:11.213 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [CloudFoundryRouteService]
2025-05-19 15:17:12.718 [main] INFO  o.s.b.actuate.endpoint.web.EndpointLinksResolver - Exposing 1 endpoint(s) beneath base path '/actuator'
2025-05-19 15:17:13.080 [main] WARN  i.s.s.b.a.provider.SpringBootConfigurationProvider - The get method not found for the field 'SeataProperties#accesskey'.
2025-05-19 15:17:13.080 [main] WARN  i.s.s.b.a.provider.SpringBootConfigurationProvider - The get method not found for the field 'SeataProperties#secretkey'.
2025-05-19 15:17:13.094 [main] INFO  io.seata.saga.tm.DefaultSagaTransactionalTemplate - Initializing Global Transaction Clients ... 
2025-05-19 15:17:13.094 [main] INFO  io.seata.saga.tm.DefaultSagaTransactionalTemplate - Transaction Manager Client is initialized. applicationId[bgtech-ai] txServiceGroup[bgai-tx-group]
2025-05-19 15:17:13.094 [main] INFO  io.seata.saga.tm.DefaultSagaTransactionalTemplate - Resource Manager is initialized. applicationId[bgtech-ai] txServiceGroup[bgai-tx-group]
2025-05-19 15:17:13.095 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - will register resourceId:bgtech-ai#bgai-tx-group
2025-05-19 15:17:13.095 [main] INFO  io.seata.saga.tm.DefaultSagaTransactionalTemplate - Global Transaction Clients are initialized. 
2025-05-19 15:17:13.104 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.rm.AbstractRMHandler - the rm client received response msg [RegisterRMResponse{version='1.8.1-SNAPSHOT', extraData='null', identified=true, resultCode=null, msg='null'}] from tc server.
2025-05-19 15:17:14.379 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - Starting ProtocolHandler ["http-nio-8080"]
2025-05-19 15:17:14.393 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat started on port(s): 8080 (http) with context path ''
2025-05-19 15:17:14.404 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from ans.namespace attribute : null
2025-05-19 15:17:14.404 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from ALIBABA_ALIWARE_NAMESPACE attribute :null
2025-05-19 15:17:14.405 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from namespace attribute :null
2025-05-19 15:17:14.413 [main] INFO  c.a.n.p.auth.spi.client.ClientAuthPluginManager - [ClientAuthPluginManager] Load ClientAuthService com.alibaba.nacos.client.auth.impl.NacosClientAuthServiceImpl success.
2025-05-19 15:17:14.414 [main] INFO  c.a.n.p.auth.spi.client.ClientAuthPluginManager - [ClientAuthPluginManager] Load ClientAuthService com.alibaba.nacos.client.auth.ram.RamClientAuthServiceImpl success.
2025-05-19 15:17:14.417 [main] INFO  com.alibaba.nacos.common.remote.client - [RpcClientFactory] create a new rpc client of e32d6cd2-bf8d-4563-8a19-b3b52baa292c
2025-05-19 15:17:14.419 [main] INFO  com.alibaba.nacos.common.remote.client - [e32d6cd2-bf8d-4563-8a19-b3b52baa292c] RpcClient init, ServerListFactory = com.alibaba.nacos.client.naming.core.ServerListManager
2025-05-19 15:17:14.419 [main] INFO  com.alibaba.nacos.common.remote.client - [e32d6cd2-bf8d-4563-8a19-b3b52baa292c] Registry connection listener to current client:com.alibaba.nacos.client.naming.remote.gprc.redo.NamingGrpcRedoService
2025-05-19 15:17:14.419 [main] INFO  com.alibaba.nacos.common.remote.client - [e32d6cd2-bf8d-4563-8a19-b3b52baa292c] Register server push request handler:com.alibaba.nacos.client.naming.remote.gprc.NamingPushRequestHandler
2025-05-19 15:17:14.420 [main] INFO  com.alibaba.nacos.common.remote.client - [e32d6cd2-bf8d-4563-8a19-b3b52baa292c] Try to connect to server on start up, server: {serverIp = '8.133.246.113', server main port = 8848}
2025-05-19 15:17:14.420 [main] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - grpc client connection server:8.133.246.113 ip,serverPort:9848,grpcTslConfig:{"sslProvider":"OPENSSL","enableTls":false,"mutualAuthEnable":false,"trustAll":false}
2025-05-19 15:17:14.551 [main] INFO  com.alibaba.nacos.common.remote.client - [e32d6cd2-bf8d-4563-8a19-b3b52baa292c] Success to connect to server [8.133.246.113:8848] on start up, connectionId = 1747639034443_139.227.195.203_42427
2025-05-19 15:17:14.551 [main] INFO  com.alibaba.nacos.common.remote.client - [e32d6cd2-bf8d-4563-8a19-b3b52baa292c] Register server push request handler:com.alibaba.nacos.common.remote.client.RpcClient$ConnectResetRequestHandler
2025-05-19 15:17:14.551 [com.alibaba.nacos.client.remote.worker] INFO  com.alibaba.nacos.common.remote.client - [e32d6cd2-bf8d-4563-8a19-b3b52baa292c] Notify connected event to listeners.
2025-05-19 15:17:14.551 [main] INFO  com.alibaba.nacos.common.remote.client - [e32d6cd2-bf8d-4563-8a19-b3b52baa292c] Register server push request handler:com.alibaba.nacos.common.remote.client.RpcClient$$Lambda/0x0000022514529c60
2025-05-19 15:17:14.551 [com.alibaba.nacos.client.remote.worker] INFO  com.alibaba.nacos.client.naming - Grpc connection connect
2025-05-19 15:17:14.552 [main] INFO  com.alibaba.nacos.client.naming - [REGISTER-SERVICE] d750d92e-152f-4055-a641-3bc9dda85a29 registering service bgtech-ai with instance Instance{instanceId='null', ip='192.168.86.8', port=8080, weight=1.0, healthy=true, enabled=true, ephemeral=true, clusterName='DEFAULT', serviceName='null', metadata={IPv6=[2408:820c:7528:8342:b486:9b72:4b72:4bf0], preserved.register.source=SPRING_CLOUD}}
2025-05-19 15:17:14.574 [main] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - nacos registry, DEFAULT_GROUP bgtech-ai 192.168.86.8:8080 register finished
2025-05-19 15:17:14.637 [main] INFO  com.bgpay.bgai.config.NacosConfig - 应用启动完成，当前环境: dev
2025-05-19 15:17:14.637 [main] INFO  com.bgpay.bgai.config.NacosConfig - Nacos配置中心: 8.133.246.113:8848, 命名空间: d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-19 15:17:14.637 [main] INFO  com.bgpay.bgai.config.NacosConfig - 注意: 如果看到Nacos配置加载警告，但应用正常启动，说明应用正在使用本地配置文件
2025-05-19 15:17:14.639 [main] INFO  com.bgpay.bgai.BgaiApplication - Started BgaiApplication in 15.689 seconds (process running for 17.015)
2025-05-19 15:17:14.641 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-19 15:17:14.641 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-19 15:17:14.653 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-19 15:17:14.654 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-19 15:17:14.654 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-19 15:17:14.665 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-19 15:17:14.665 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-19 15:17:14.665 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-19 15:17:14.673 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-19 15:17:14.673 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-19 15:17:14.674 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-19 15:17:14.679 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-19 15:17:14.679 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - ==================== Saga状态机加载报告 ====================
2025-05-19 15:17:14.679 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - Saga状态机配置加载状态: 成功
2025-05-19 15:17:14.679 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 已加载的状态机定义文件数量: 1
2025-05-19 15:17:14.679 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 已加载的状态机定义文件:
2025-05-19 15:17:14.679 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig -  - /E:/project/bgai/target/classes/statelang/bgai-saga-transaction.json
2025-05-19 15:17:14.679 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - Saga解析器状态: CUSTOM_FASTJSON2
2025-05-19 15:17:14.680 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 状态机解析结果: 成功 1 个, 失败 0 个
2025-05-19 15:17:14.680 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - =============================================================
2025-05-19 15:17:14.685 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - nacos.cache.data.init.snapshot = true 
2025-05-19 15:17:14.685 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] common-dev.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-19 15:17:14.695 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=common-dev.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-19 15:17:14.695 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=common-dev.yaml, group=DEFAULT_GROUP
2025-05-19 15:17:14.695 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-19 15:17:14.696 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-19 15:17:14.696 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai.yaml, group=DEFAULT_GROUP
2025-05-19 15:17:14.697 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai-dev.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-19 15:17:14.697 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai-dev.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-19 15:17:14.697 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai-dev.yaml, group=DEFAULT_GROUP
2025-05-19 15:17:14.698 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-19 15:17:14.698 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai, group=DEFAULT_GROUP, cnt=1
2025-05-19 15:17:14.698 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai, group=DEFAULT_GROUP
2025-05-19 15:17:27.661 [Thread-7] WARN  com.alibaba.nacos.common.notify.NotifyCenter - [NotifyCenter] Start destroying Publisher
2025-05-19 15:17:27.662 [Thread-1] WARN  c.alibaba.nacos.common.http.HttpClientBeanHolder - [HttpClientBeanHolder] Start destroying common HttpClient
2025-05-19 15:17:27.662 [Thread-7] WARN  com.alibaba.nacos.common.notify.NotifyCenter - [NotifyCenter] Destruction of the end
2025-05-19 15:17:27.662 [Thread-1] WARN  c.alibaba.nacos.common.http.HttpClientBeanHolder - [HttpClientBeanHolder] Destruction of the end
2025-05-19 15:17:27.690 [NettyClientSelector_RMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - channel inactive: [id: 0x7085cdd6, L:/192.168.86.8:55800 ! R:/8.133.246.113:8091]
2025-05-19 15:17:27.691 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - return to pool, rm channel:[id: 0x7085cdd6, L:/192.168.86.8:55800 ! R:/8.133.246.113:8091]
2025-05-19 15:17:27.691 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - channel valid false,channel:[id: 0x7085cdd6, L:/192.168.86.8:55800 ! R:/8.133.246.113:8091]
2025-05-19 15:17:27.691 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - will destroy channel:[id: 0x7085cdd6, L:/192.168.86.8:55800 ! R:/8.133.246.113:8091]
2025-05-19 15:17:27.691 [NettyClientSelector_RMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0x7085cdd6, L:/192.168.86.8:55800 ! R:/8.133.246.113:8091]) will closed
2025-05-19 15:17:27.691 [NettyClientSelector_RMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0x7085cdd6, L:/192.168.86.8:55800 ! R:/8.133.246.113:8091]) will closed
2025-05-19 15:17:27.694 [SpringContextShutdownHook] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - De-registering from Nacos Server now...
2025-05-19 15:17:27.694 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - [DEREGISTER-SERVICE] d750d92e-152f-4055-a641-3bc9dda85a29 deregistering service bgtech-ai with instance: Instance{instanceId='null', ip='192.168.86.8', port=8080, weight=1.0, healthy=true, enabled=true, ephemeral=true, clusterName='DEFAULT', serviceName='null', metadata={}}
2025-05-19 15:17:27.713 [SpringContextShutdownHook] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - De-registration finished.
2025-05-19 15:17:27.715 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.cache.ServiceInfoHolder do shutdown begin
2025-05-19 15:17:27.715 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.backups.FailoverReactor do shutdown begin
2025-05-19 15:17:27.720 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.backups.FailoverReactor do shutdown stop
2025-05-19 15:17:27.721 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.cache.ServiceInfoHolder do shutdown stop
2025-05-19 15:17:27.721 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.NamingClientProxyDelegate do shutdown begin
2025-05-19 15:17:27.721 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServiceInfoUpdateService do shutdown begin
2025-05-19 15:17:27.721 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServiceInfoUpdateService do shutdown stop
2025-05-19 15:17:27.721 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServerListManager do shutdown begin
2025-05-19 15:17:27.721 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Start destroying NacosRestTemplate
2025-05-19 15:17:27.721 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Destruction of the end
2025-05-19 15:17:27.722 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServerListManager do shutdown stop
2025-05-19 15:17:27.722 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.http.NamingHttpClientProxy do shutdown begin
2025-05-19 15:17:27.722 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Start destroying NacosRestTemplate
2025-05-19 15:17:27.722 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Destruction of the end
2025-05-19 15:17:27.722 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.http.NamingHttpClientProxy do shutdown stop
2025-05-19 15:17:27.722 [SpringContextShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Shutdown rpc client, set status to shutdown
2025-05-19 15:17:27.722 [SpringContextShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Shutdown client event executor java.util.concurrent.ScheduledThreadPoolExecutor@7fd8b289[Running, pool size = 2, active threads = 2, queued tasks = 0, completed tasks = 0]
2025-05-19 15:17:27.722 [SpringContextShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Close current connection 1747639034443_139.227.195.203_42427
2025-05-19 15:17:27.788 [nacos-grpc-client-executor-8.133.246.113-10] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - [1747639034443_139.227.195.203_42427]Ignore complete event,isRunning:false,isAbandon=false
2025-05-19 15:17:27.792 [SpringContextShutdownHook] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - Shutdown grpc executor java.util.concurrent.ThreadPoolExecutor@4147f46d[Running, pool size = 4, active threads = 0, queued tasks = 0, completed tasks = 11]
2025-05-19 15:17:27.795 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - Shutdown grpc redo service executor java.util.concurrent.ScheduledThreadPoolExecutor@3a4a86a9[Running, pool size = 1, active threads = 0, queued tasks = 1, completed tasks = 4]
2025-05-19 15:17:27.795 [SpringContextShutdownHook] INFO  c.a.n.client.auth.ram.identify.CredentialWatcher - [null] CredentialWatcher is stopped
2025-05-19 15:17:27.796 [SpringContextShutdownHook] INFO  c.a.n.client.auth.ram.identify.CredentialService - [null] CredentialService is freed
2025-05-19 15:17:27.797 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.NamingClientProxyDelegate do shutdown stop
2025-05-19 15:17:29.824 [com.alibaba.nacos.client.Worker] INFO  c.a.n.client.auth.ram.identify.CredentialWatcher - null No credential found
2025-05-19 15:17:29.827 [SpringContextShutdownHook] DEBUG com.bgpay.bgai.config.AsyncConfig$1 - Shutting down ExecutorService 'blockingExecutor'
2025-05-19 15:17:29.861 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:10911] result: true
2025-05-19 15:17:29.861 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:9876] result: true
2025-05-19 15:17:29.882 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:10911] result: true
2025-05-19 15:17:29.882 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:9876] result: true
2025-05-19 15:17:29.890 [SpringContextShutdownHook] INFO  o.s.orm.jpa.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-05-19 15:17:29.892 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-2} closing ...
2025-05-19 15:17:29.896 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-2} closed
2025-05-19 15:17:29.896 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} closing ...
2025-05-19 15:17:29.897 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} closed
2025-05-19 15:31:02.231 [main] WARN  com.alibaba.nacos.client.logging.NacosLogging - Load Logback Configuration of Nacos fail, message: Could not initialize Logback Nacos logging from classpath:nacos-logback.xml
2025-05-19 15:31:02.232 [main] INFO  com.bgpay.bgai.BgaiApplication - The following 1 profile is active: "dev"
2025-05-19 15:31:03.770 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-05-19 15:31:03.771 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-05-19 15:31:03.796 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 18 ms. Found 0 JPA repository interfaces.
2025-05-19 15:31:03.809 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-05-19 15:31:03.810 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-05-19 15:31:03.823 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 4 ms. Found 0 Redis repository interfaces.
2025-05-19 15:31:04.442 [main] INFO  io.seata.config.ConfigurationFactory - load Configuration from :Spring Configuration
2025-05-19 15:31:04.450 [main] INFO  io.seata.config.ConfigurationFactory - load Configuration from :Spring Configuration
2025-05-19 15:31:04.456 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Initializing Global Transaction Clients ... 
2025-05-19 15:31:04.579 [main] INFO  io.seata.core.rpc.netty.NettyClientBootstrap - NettyClientBootstrap has started
2025-05-19 15:31:04.581 [main] INFO  io.seata.discovery.registry.RegistryFactory - use registry center type: file
2025-05-19 15:31:04.592 [main] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - will connect to 8.133.246.113:8091
2025-05-19 15:31:04.596 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - NettyPool create channel to transactionRole:TMROLE,address:8.133.246.113:8091,msg:< RegisterTMRequest{version='1.7.0', applicationId='bgtech-ai', transactionServiceGroup='bgai-tx-group', extraData='ak=null
digest=bgai-tx-group,192.168.86.8,1747639864594
timestamp=1747639864594
authVersion=V4
vgroup=bgai-tx-group
ip=192.168.86.8
'} >
2025-05-19 15:31:04.760 [main] INFO  io.seata.core.rpc.netty.TmNettyRemotingClient - register TM success. client version:1.7.0, server version:1.8.1-SNAPSHOT,channel:[id: 0x9d226378, L:/192.168.86.8:57199 - R:/8.133.246.113:8091]
2025-05-19 15:31:04.766 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - register success, cost 75 ms, version:1.8.1-SNAPSHOT,role:TMROLE,channel:[id: 0x9d226378, L:/192.168.86.8:57199 - R:/8.133.246.113:8091]
2025-05-19 15:31:04.767 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Transaction Manager Client is initialized. applicationId[bgtech-ai] txServiceGroup[bgai-tx-group]
2025-05-19 15:31:04.778 [main] INFO  io.seata.rm.datasource.AsyncWorker - Async Commit Buffer Limit: 10000
2025-05-19 15:31:04.778 [main] INFO  io.seata.rm.datasource.xa.ResourceManagerXA - ResourceManagerXA init ...
2025-05-19 15:31:04.783 [main] INFO  io.seata.core.rpc.netty.NettyClientBootstrap - NettyClientBootstrap has started
2025-05-19 15:31:04.783 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Resource Manager is initialized. applicationId[bgtech-ai] txServiceGroup[bgai-tx-group]
2025-05-19 15:31:04.783 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Global Transaction Clients are initialized. 
2025-05-19 15:31:06.022 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat initialized with port(s): 8080 (http)
2025-05-19 15:31:06.034 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - The ["http-nio-8080"] connector has been configured to support HTTP upgrade to [h2c]
2025-05-19 15:31:06.035 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - Initializing ProtocolHandler ["http-nio-8080"]
2025-05-19 15:31:06.036 [main] INFO  org.apache.catalina.core.StandardService - Starting service [Tomcat]
2025-05-19 15:31:06.037 [main] INFO  org.apache.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.15]
2025-05-19 15:31:06.485 [main] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} inited
2025-05-19 15:31:06.752 [main] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - will connect to 8.133.246.113:8091
2025-05-19 15:31:06.752 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - RM will register :jdbc:mysql://8.133.246.113:3306/deepseek
2025-05-19 15:31:06.753 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - NettyPool create channel to transactionRole:RMROLE,address:8.133.246.113:8091,msg:< RegisterRMRequest{resourceIds='jdbc:mysql://8.133.246.113:3306/deepseek', version='1.7.0', applicationId='bgtech-ai', transactionServiceGroup='bgai-tx-group', extraData='null'} >
2025-05-19 15:31:06.773 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - register RM success. client version:1.7.0, server version:1.8.1-SNAPSHOT,channel:[id: 0x21c956a6, L:/192.168.86.8:57209 - R:/8.133.246.113:8091]
2025-05-19 15:31:06.773 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - register success, cost 12 ms, version:1.8.1-SNAPSHOT,role:RMROLE,channel:[id: 0x21c956a6, L:/192.168.86.8:57209 - R:/8.133.246.113:8091]
2025-05-19 15:31:06.777 [main] INFO  i.s.s.a.datasource.SeataAutoDataSourceProxyCreator - Auto proxy data source 'masterDataSource' by 'AT' mode.
2025-05-19 15:31:06.852 [main] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-2} inited
2025-05-19 15:31:06.936 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - will register resourceId:jdbc:mysql://8.133.246.113:3306/deepseek
2025-05-19 15:31:06.937 [main] INFO  i.s.s.a.datasource.SeataAutoDataSourceProxyCreator - Auto proxy data source 'slaveDataSource' by 'AT' mode.
2025-05-19 15:31:06.946 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.rm.AbstractRMHandler - the rm client received response msg [RegisterRMResponse{version='1.8.1-SNAPSHOT', extraData='null', identified=true, resultCode=null, msg='null'}] from tc server.
2025-05-19 15:31:06.959 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - will register resourceId:jdbc:mysql://8.133.246.113:3306/deepseek
2025-05-19 15:31:06.960 [main] INFO  i.s.s.a.datasource.SeataAutoDataSourceProxyCreator - Auto proxy data source 'dynamicDataSource' by 'AT' mode.
2025-05-19 15:31:06.973 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.rm.AbstractRMHandler - the rm client received response msg [RegisterRMResponse{version='1.8.1-SNAPSHOT', extraData='null', identified=true, resultCode=null, msg='null'}] from tc server.
2025-05-19 15:31:07.081 [main] INFO  org.hibernate.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-05-19 15:31:07.144 [main] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.1.7.Final
2025-05-19 15:31:07.503 [main] INFO  SQL dialect - HHH000400: Using dialect: org.hibernate.dialect.MySQL8Dialect
2025-05-19 15:31:07.506 [main] WARN  org.hibernate.orm.deprecation - HHH90000026: MySQL8Dialect has been deprecated; use org.hibernate.dialect.MySQLDialect instead
2025-05-19 15:31:07.800 [main] INFO  o.h.e.t.jta.platform.internal.JtaPlatformInitiator - HHH000490: Using JtaPlatform implementation: [org.hibernate.engine.transaction.jta.platform.internal.NoJtaPlatform]
2025-05-19 15:31:07.813 [main] INFO  o.s.orm.jpa.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-05-19 15:31:08.277 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-19 15:31:08.292 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-19 15:31:08.329 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-19 15:31:08.332 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-19 15:31:08.333 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-19 15:31:08.344 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-19 15:31:09.002 [main] INFO  com.bgpay.bgai.service.impl.UserServiceImpl - 初始化SSO配置: clientId=bgai-client-id, redirectUri=http://localhost:8080/api/auth/callback
2025-05-19 15:31:09.132 [main] INFO  com.bgpay.bgai.controller.AuthController - 初始化认证控制器: clientId=bgai-client-id, redirectUri=http://localhost:8080/api/auth/callback
2025-05-19 15:31:09.244 [main] WARN  o.s.b.w.r.c.AnnotationConfigReactiveWebServerApplicationContext - Exception encountered during context initialization - cancelling refresh attempt: org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'enhancedChatController' defined in file [E:\project\bgai\target\classes\com\bgpay\bgai\controller\EnhancedChatController.class]: Unsatisfied dependency expressed through constructor parameter 2: Error creating bean with name 'deepSeekServiceImp' defined in file [E:\project\bgai\target\classes\com\bgpay\bgai\service\deepseek\DeepSeekServiceImp.class]: Failed to instantiate [com.bgpay.bgai.service.deepseek.DeepSeekServiceImp]: Constructor threw exception
2025-05-19 15:31:09.257 [main] INFO  o.s.orm.jpa.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-05-19 15:31:09.258 [main] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-2} closing ...
2025-05-19 15:31:09.265 [main] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-2} closed
2025-05-19 15:31:09.266 [main] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} closing ...
2025-05-19 15:31:09.266 [main] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} closed
2025-05-19 15:31:09.268 [NettyClientSelector_TMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - channel inactive: [id: 0x9d226378, L:/192.168.86.8:57199 ! R:/8.133.246.113:8091]
2025-05-19 15:31:09.268 [NettyClientSelector_TMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - return to pool, rm channel:[id: 0x9d226378, L:/192.168.86.8:57199 ! R:/8.133.246.113:8091]
2025-05-19 15:31:09.268 [NettyClientSelector_TMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - channel valid false,channel:[id: 0x9d226378, L:/192.168.86.8:57199 ! R:/8.133.246.113:8091]
2025-05-19 15:31:09.268 [NettyClientSelector_TMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - will destroy channel:[id: 0x9d226378, L:/192.168.86.8:57199 ! R:/8.133.246.113:8091]
2025-05-19 15:31:09.268 [NettyClientSelector_TMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0x9d226378, L:/192.168.86.8:57199 ! R:/8.133.246.113:8091]) will closed
2025-05-19 15:31:09.268 [NettyClientSelector_TMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0x9d226378, L:/192.168.86.8:57199 ! R:/8.133.246.113:8091]) will closed
2025-05-19 15:31:09.269 [NettyClientSelector_RMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - channel inactive: [id: 0x21c956a6, L:/192.168.86.8:57209 ! R:/8.133.246.113:8091]
2025-05-19 15:31:09.269 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - return to pool, rm channel:[id: 0x21c956a6, L:/192.168.86.8:57209 ! R:/8.133.246.113:8091]
2025-05-19 15:31:09.269 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - channel valid false,channel:[id: 0x21c956a6, L:/192.168.86.8:57209 ! R:/8.133.246.113:8091]
2025-05-19 15:31:09.269 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - will destroy channel:[id: 0x21c956a6, L:/192.168.86.8:57209 ! R:/8.133.246.113:8091]
2025-05-19 15:31:09.269 [NettyClientSelector_RMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0x21c956a6, L:/192.168.86.8:57209 ! R:/8.133.246.113:8091]) will closed
2025-05-19 15:31:09.269 [NettyClientSelector_RMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0x21c956a6, L:/192.168.86.8:57209 ! R:/8.133.246.113:8091]) will closed
2025-05-19 15:31:09.272 [main] INFO  org.apache.catalina.core.StandardService - Stopping service [Tomcat]
2025-05-19 15:31:09.294 [main] INFO  o.s.b.a.logging.ConditionEvaluationReportLogger - 

Error starting ApplicationContext. To display the condition evaluation report re-run your application with 'debug' enabled.
2025-05-19 15:31:09.318 [main] ERROR org.springframework.boot.SpringApplication - Application run failed
org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'enhancedChatController' defined in file [E:\project\bgai\target\classes\com\bgpay\bgai\controller\EnhancedChatController.class]: Unsatisfied dependency expressed through constructor parameter 2: Error creating bean with name 'deepSeekServiceImp' defined in file [E:\project\bgai\target\classes\com\bgpay\bgai\service\deepseek\DeepSeekServiceImp.class]: Failed to instantiate [com.bgpay.bgai.service.deepseek.DeepSeekServiceImp]: Constructor threw exception
	at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:801)
	at org.springframework.beans.factory.support.ConstructorResolver.autowireConstructor(ConstructorResolver.java:240)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.autowireConstructor(AbstractAutowireCapableBeanFactory.java:1352)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:1189)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:560)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:520)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:325)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:234)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:323)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:199)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.preInstantiateSingletons(DefaultListableBeanFactory.java:973)
	at org.springframework.context.support.AbstractApplicationContext.finishBeanFactoryInitialization(AbstractApplicationContext.java:950)
	at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:616)
	at org.springframework.boot.web.reactive.context.ReactiveWebServerApplicationContext.refresh(ReactiveWebServerApplicationContext.java:66)
	at org.springframework.boot.SpringApplication.refresh(SpringApplication.java:733)
	at org.springframework.boot.SpringApplication.refreshContext(SpringApplication.java:435)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:311)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1301)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1290)
	at com.bgpay.bgai.BgaiApplication.main(BgaiApplication.java:34)
Caused by: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'deepSeekServiceImp' defined in file [E:\project\bgai\target\classes\com\bgpay\bgai\service\deepseek\DeepSeekServiceImp.class]: Failed to instantiate [com.bgpay.bgai.service.deepseek.DeepSeekServiceImp]: Constructor threw exception
	at org.springframework.beans.factory.support.ConstructorResolver.instantiate(ConstructorResolver.java:321)
	at org.springframework.beans.factory.support.ConstructorResolver.autowireConstructor(ConstructorResolver.java:309)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.autowireConstructor(AbstractAutowireCapableBeanFactory.java:1352)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:1189)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:560)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:520)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:325)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:234)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:323)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:199)
	at org.springframework.beans.factory.config.DependencyDescriptor.resolveCandidate(DependencyDescriptor.java:254)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.doResolveDependency(DefaultListableBeanFactory.java:1417)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveDependency(DefaultListableBeanFactory.java:1337)
	at org.springframework.beans.factory.support.ConstructorResolver.resolveAutowiredArgument(ConstructorResolver.java:910)
	at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:788)
	... 19 common frames omitted
Caused by: org.springframework.beans.BeanInstantiationException: Failed to instantiate [com.bgpay.bgai.service.deepseek.DeepSeekServiceImp]: Constructor threw exception
	at org.springframework.beans.BeanUtils.instantiateClass(BeanUtils.java:224)
	at org.springframework.beans.factory.support.SimpleInstantiationStrategy.instantiate(SimpleInstantiationStrategy.java:110)
	at org.springframework.beans.factory.support.ConstructorResolver.instantiate(ConstructorResolver.java:318)
	... 33 common frames omitted
Caused by: java.lang.Error: Unresolved compilation problems: 
	The method defer(Supplier<? extends Mono<? extends T>>) in the type Mono is not applicable for the arguments (() -> {})
	Type mismatch: cannot convert from Mono<Void> to Mono<? extends T>

	at com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.<init>(DeepSeekServiceImp.java:412)
	at java.base/jdk.internal.reflect.DirectConstructorHandleAccessor.newInstance(DirectConstructorHandleAccessor.java:62)
	at java.base/java.lang.reflect.Constructor.newInstanceWithCaller(Constructor.java:502)
	at java.base/java.lang.reflect.Constructor.newInstance(Constructor.java:486)
	at org.springframework.beans.BeanUtils.instantiateClass(BeanUtils.java:211)
	... 35 common frames omitted
2025-05-19 15:31:09.320 [main] ERROR com.bgpay.bgai.BgaiApplication - Application startup failed
org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'enhancedChatController' defined in file [E:\project\bgai\target\classes\com\bgpay\bgai\controller\EnhancedChatController.class]: Unsatisfied dependency expressed through constructor parameter 2: Error creating bean with name 'deepSeekServiceImp' defined in file [E:\project\bgai\target\classes\com\bgpay\bgai\service\deepseek\DeepSeekServiceImp.class]: Failed to instantiate [com.bgpay.bgai.service.deepseek.DeepSeekServiceImp]: Constructor threw exception
	at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:801)
	at org.springframework.beans.factory.support.ConstructorResolver.autowireConstructor(ConstructorResolver.java:240)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.autowireConstructor(AbstractAutowireCapableBeanFactory.java:1352)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:1189)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:560)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:520)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:325)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:234)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:323)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:199)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.preInstantiateSingletons(DefaultListableBeanFactory.java:973)
	at org.springframework.context.support.AbstractApplicationContext.finishBeanFactoryInitialization(AbstractApplicationContext.java:950)
	at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:616)
	at org.springframework.boot.web.reactive.context.ReactiveWebServerApplicationContext.refresh(ReactiveWebServerApplicationContext.java:66)
	at org.springframework.boot.SpringApplication.refresh(SpringApplication.java:733)
	at org.springframework.boot.SpringApplication.refreshContext(SpringApplication.java:435)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:311)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1301)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1290)
	at com.bgpay.bgai.BgaiApplication.main(BgaiApplication.java:34)
Caused by: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'deepSeekServiceImp' defined in file [E:\project\bgai\target\classes\com\bgpay\bgai\service\deepseek\DeepSeekServiceImp.class]: Failed to instantiate [com.bgpay.bgai.service.deepseek.DeepSeekServiceImp]: Constructor threw exception
	at org.springframework.beans.factory.support.ConstructorResolver.instantiate(ConstructorResolver.java:321)
	at org.springframework.beans.factory.support.ConstructorResolver.autowireConstructor(ConstructorResolver.java:309)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.autowireConstructor(AbstractAutowireCapableBeanFactory.java:1352)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:1189)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:560)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:520)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:325)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:234)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:323)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:199)
	at org.springframework.beans.factory.config.DependencyDescriptor.resolveCandidate(DependencyDescriptor.java:254)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.doResolveDependency(DefaultListableBeanFactory.java:1417)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveDependency(DefaultListableBeanFactory.java:1337)
	at org.springframework.beans.factory.support.ConstructorResolver.resolveAutowiredArgument(ConstructorResolver.java:910)
	at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:788)
	... 19 common frames omitted
Caused by: org.springframework.beans.BeanInstantiationException: Failed to instantiate [com.bgpay.bgai.service.deepseek.DeepSeekServiceImp]: Constructor threw exception
	at org.springframework.beans.BeanUtils.instantiateClass(BeanUtils.java:224)
	at org.springframework.beans.factory.support.SimpleInstantiationStrategy.instantiate(SimpleInstantiationStrategy.java:110)
	at org.springframework.beans.factory.support.ConstructorResolver.instantiate(ConstructorResolver.java:318)
	... 33 common frames omitted
Caused by: java.lang.Error: Unresolved compilation problems: 
	The method defer(Supplier<? extends Mono<? extends T>>) in the type Mono is not applicable for the arguments (() -> {})
	Type mismatch: cannot convert from Mono<Void> to Mono<? extends T>

	at com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.<init>(DeepSeekServiceImp.java:412)
	at java.base/jdk.internal.reflect.DirectConstructorHandleAccessor.newInstance(DirectConstructorHandleAccessor.java:62)
	at java.base/java.lang.reflect.Constructor.newInstanceWithCaller(Constructor.java:502)
	at java.base/java.lang.reflect.Constructor.newInstance(Constructor.java:486)
	at org.springframework.beans.BeanUtils.instantiateClass(BeanUtils.java:211)
	... 35 common frames omitted
2025-05-19 15:31:10.261 [Thread-7] WARN  com.alibaba.nacos.common.notify.NotifyCenter - [NotifyCenter] Start destroying Publisher
2025-05-19 15:31:10.261 [Thread-7] WARN  com.alibaba.nacos.common.notify.NotifyCenter - [NotifyCenter] Destruction of the end
2025-05-19 15:31:10.261 [Thread-1] WARN  c.alibaba.nacos.common.http.HttpClientBeanHolder - [HttpClientBeanHolder] Start destroying common HttpClient
2025-05-19 15:34:14.102 [main] WARN  com.alibaba.nacos.client.logging.NacosLogging - Load Logback Configuration of Nacos fail, message: Could not initialize Logback Nacos logging from classpath:nacos-logback.xml
2025-05-19 15:34:14.103 [main] INFO  com.bgpay.bgai.BgaiApplication - The following 1 profile is active: "dev"
2025-05-19 15:34:15.712 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-05-19 15:34:15.714 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-05-19 15:34:15.738 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 17 ms. Found 0 JPA repository interfaces.
2025-05-19 15:34:15.750 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-05-19 15:34:15.751 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-05-19 15:34:15.763 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 5 ms. Found 0 Redis repository interfaces.
2025-05-19 15:34:16.392 [main] INFO  io.seata.config.ConfigurationFactory - load Configuration from :Spring Configuration
2025-05-19 15:34:16.401 [main] INFO  io.seata.config.ConfigurationFactory - load Configuration from :Spring Configuration
2025-05-19 15:34:16.407 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Initializing Global Transaction Clients ... 
2025-05-19 15:34:16.510 [main] INFO  io.seata.core.rpc.netty.NettyClientBootstrap - NettyClientBootstrap has started
2025-05-19 15:34:16.511 [main] INFO  io.seata.discovery.registry.RegistryFactory - use registry center type: file
2025-05-19 15:34:16.521 [main] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - will connect to 8.133.246.113:8091
2025-05-19 15:34:16.524 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - NettyPool create channel to transactionRole:TMROLE,address:8.133.246.113:8091,msg:< RegisterTMRequest{version='1.7.0', applicationId='bgtech-ai', transactionServiceGroup='bgai-tx-group', extraData='ak=null
digest=bgai-tx-group,192.168.86.8,1747640056523
timestamp=1747640056523
authVersion=V4
vgroup=bgai-tx-group
ip=192.168.86.8
'} >
2025-05-19 15:34:16.657 [main] INFO  io.seata.core.rpc.netty.TmNettyRemotingClient - register TM success. client version:1.7.0, server version:1.8.1-SNAPSHOT,channel:[id: 0x1953cf0c, L:/192.168.86.8:53143 - R:/8.133.246.113:8091]
2025-05-19 15:34:16.663 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - register success, cost 68 ms, version:1.8.1-SNAPSHOT,role:TMROLE,channel:[id: 0x1953cf0c, L:/192.168.86.8:53143 - R:/8.133.246.113:8091]
2025-05-19 15:34:16.664 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Transaction Manager Client is initialized. applicationId[bgtech-ai] txServiceGroup[bgai-tx-group]
2025-05-19 15:34:16.675 [main] INFO  io.seata.rm.datasource.AsyncWorker - Async Commit Buffer Limit: 10000
2025-05-19 15:34:16.676 [main] INFO  io.seata.rm.datasource.xa.ResourceManagerXA - ResourceManagerXA init ...
2025-05-19 15:34:16.684 [main] INFO  io.seata.core.rpc.netty.NettyClientBootstrap - NettyClientBootstrap has started
2025-05-19 15:34:16.685 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Resource Manager is initialized. applicationId[bgtech-ai] txServiceGroup[bgai-tx-group]
2025-05-19 15:34:16.685 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Global Transaction Clients are initialized. 
2025-05-19 15:34:17.959 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat initialized with port(s): 8080 (http)
2025-05-19 15:34:17.970 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - The ["http-nio-8080"] connector has been configured to support HTTP upgrade to [h2c]
2025-05-19 15:34:17.970 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - Initializing ProtocolHandler ["http-nio-8080"]
2025-05-19 15:34:17.972 [main] INFO  org.apache.catalina.core.StandardService - Starting service [Tomcat]
2025-05-19 15:34:17.972 [main] INFO  org.apache.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.15]
2025-05-19 15:34:18.411 [main] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} inited
2025-05-19 15:34:18.686 [main] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - will connect to 8.133.246.113:8091
2025-05-19 15:34:18.687 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - RM will register :jdbc:mysql://8.133.246.113:3306/deepseek
2025-05-19 15:34:18.687 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - NettyPool create channel to transactionRole:RMROLE,address:8.133.246.113:8091,msg:< RegisterRMRequest{resourceIds='jdbc:mysql://8.133.246.113:3306/deepseek', version='1.7.0', applicationId='bgtech-ai', transactionServiceGroup='bgai-tx-group', extraData='null'} >
2025-05-19 15:34:18.710 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - register RM success. client version:1.7.0, server version:1.8.1-SNAPSHOT,channel:[id: 0x5bc45ad2, L:/192.168.86.8:53183 - R:/8.133.246.113:8091]
2025-05-19 15:34:18.710 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - register success, cost 14 ms, version:1.8.1-SNAPSHOT,role:RMROLE,channel:[id: 0x5bc45ad2, L:/192.168.86.8:53183 - R:/8.133.246.113:8091]
2025-05-19 15:34:18.713 [main] INFO  i.s.s.a.datasource.SeataAutoDataSourceProxyCreator - Auto proxy data source 'masterDataSource' by 'AT' mode.
2025-05-19 15:34:18.825 [main] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-2} inited
2025-05-19 15:34:18.921 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - will register resourceId:jdbc:mysql://8.133.246.113:3306/deepseek
2025-05-19 15:34:18.923 [main] INFO  i.s.s.a.datasource.SeataAutoDataSourceProxyCreator - Auto proxy data source 'slaveDataSource' by 'AT' mode.
2025-05-19 15:34:18.933 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.rm.AbstractRMHandler - the rm client received response msg [RegisterRMResponse{version='1.8.1-SNAPSHOT', extraData='null', identified=true, resultCode=null, msg='null'}] from tc server.
2025-05-19 15:34:18.950 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - will register resourceId:jdbc:mysql://8.133.246.113:3306/deepseek
2025-05-19 15:34:18.951 [main] INFO  i.s.s.a.datasource.SeataAutoDataSourceProxyCreator - Auto proxy data source 'dynamicDataSource' by 'AT' mode.
2025-05-19 15:34:18.960 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.rm.AbstractRMHandler - the rm client received response msg [RegisterRMResponse{version='1.8.1-SNAPSHOT', extraData='null', identified=true, resultCode=null, msg='null'}] from tc server.
2025-05-19 15:34:19.077 [main] INFO  org.hibernate.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-05-19 15:34:19.160 [main] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.1.7.Final
2025-05-19 15:34:19.682 [main] INFO  SQL dialect - HHH000400: Using dialect: org.hibernate.dialect.MySQL8Dialect
2025-05-19 15:34:19.685 [main] WARN  org.hibernate.orm.deprecation - HHH90000026: MySQL8Dialect has been deprecated; use org.hibernate.dialect.MySQLDialect instead
2025-05-19 15:34:20.427 [main] INFO  o.h.e.t.jta.platform.internal.JtaPlatformInitiator - HHH000490: Using JtaPlatform implementation: [org.hibernate.engine.transaction.jta.platform.internal.NoJtaPlatform]
2025-05-19 15:34:20.443 [main] INFO  o.s.orm.jpa.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-05-19 15:34:20.957 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-19 15:34:20.969 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-19 15:34:21.001 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-19 15:34:21.002 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-19 15:34:21.003 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-19 15:34:21.015 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-19 15:34:21.714 [main] INFO  com.bgpay.bgai.service.impl.UserServiceImpl - 初始化SSO配置: clientId=bgai-client-id, redirectUri=http://localhost:8080/api/auth/callback
2025-05-19 15:34:21.842 [main] INFO  com.bgpay.bgai.controller.AuthController - 初始化认证控制器: clientId=bgai-client-id, redirectUri=http://localhost:8080/api/auth/callback
2025-05-19 15:34:22.360 [main] INFO  o.a.r.s.autoconfigure.RocketMQAutoConfiguration - a producer (billing-producer-group) init on namesrv 8.133.246.113:9876
2025-05-19 15:34:23.175 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Bean [com.bgpay.bgai.service.deepseek.DeepSeekServiceImp$$SpringCGLIB$$0] with name [deepSeekServiceImp] would use interceptor [io.seata.spring.annotation.GlobalTransactionalInterceptor]
2025-05-19 15:34:23.504 [main] WARN  i.s.s.b.a.provider.SpringBootConfigurationProvider - The get method not found for the field 'SeataProperties#accesskey'.
2025-05-19 15:34:23.504 [main] WARN  i.s.s.b.a.provider.SpringBootConfigurationProvider - The get method not found for the field 'SeataProperties#secretkey'.
2025-05-19 15:34:23.515 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 加载到1个Saga状态机定义文件
2025-05-19 15:34:23.701 [main] INFO  com.bgpay.bgai.saga.CustomSagaJsonParser - 开始解析状态机定义: bgai-saga-transaction
2025-05-19 15:34:23.701 [main] INFO  com.bgpay.bgai.saga.CustomSagaJsonParser - 状态机定义解析成功: bgai-saga-transaction
2025-05-19 15:34:23.701 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 成功加载状态机定义: /E:/project/bgai/target/classes/statelang/bgai-saga-transaction.json
2025-05-19 15:34:24.158 [main] INFO  org.redisson.Version - Redisson 3.24.3
2025-05-19 15:34:24.299 [redisson-netty-4-6] INFO  o.r.connection.pool.MasterPubSubConnectionPool - 1 connections initialized for 8.133.246.113/8.133.246.113:6379
2025-05-19 15:34:24.649 [redisson-netty-4-19] INFO  org.redisson.connection.pool.MasterConnectionPool - 24 connections initialized for 8.133.246.113/8.133.246.113:6379
2025-05-19 15:34:24.972 [main] INFO  com.bgpay.bgai.service.mq.MQConsumerService - MQ consumer startup successful [group=billing-consumer-group, topic=BILLING_TOPIC, tag=USER_BILLING]
2025-05-19 15:34:25.276 [main] DEBUG com.bgpay.bgai.config.AsyncConfig$1 - Initializing ExecutorService 'blockingExecutor'
2025-05-19 15:34:25.303 [main] INFO  c.b.bgai.config.NacosConfig$NacosWarningHandler - Nacos警告处理器已启用，将忽略配置中心连接警告
2025-05-19 15:34:26.510 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [After]
2025-05-19 15:34:26.510 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Before]
2025-05-19 15:34:26.510 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Between]
2025-05-19 15:34:26.511 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Cookie]
2025-05-19 15:34:26.511 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Header]
2025-05-19 15:34:26.511 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Host]
2025-05-19 15:34:26.511 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Method]
2025-05-19 15:34:26.511 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Path]
2025-05-19 15:34:26.511 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Query]
2025-05-19 15:34:26.511 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [ReadBody]
2025-05-19 15:34:26.511 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [RemoteAddr]
2025-05-19 15:34:26.511 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [XForwardedRemoteAddr]
2025-05-19 15:34:26.511 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Weight]
2025-05-19 15:34:26.511 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [CloudFoundryRouteService]
2025-05-19 15:34:28.037 [main] INFO  o.s.b.actuate.endpoint.web.EndpointLinksResolver - Exposing 1 endpoint(s) beneath base path '/actuator'
2025-05-19 15:34:28.431 [main] WARN  i.s.s.b.a.provider.SpringBootConfigurationProvider - The get method not found for the field 'SeataProperties#accesskey'.
2025-05-19 15:34:28.432 [main] WARN  i.s.s.b.a.provider.SpringBootConfigurationProvider - The get method not found for the field 'SeataProperties#secretkey'.
2025-05-19 15:34:28.452 [main] INFO  io.seata.saga.tm.DefaultSagaTransactionalTemplate - Initializing Global Transaction Clients ... 
2025-05-19 15:34:28.453 [main] INFO  io.seata.saga.tm.DefaultSagaTransactionalTemplate - Transaction Manager Client is initialized. applicationId[bgtech-ai] txServiceGroup[bgai-tx-group]
2025-05-19 15:34:28.453 [main] INFO  io.seata.saga.tm.DefaultSagaTransactionalTemplate - Resource Manager is initialized. applicationId[bgtech-ai] txServiceGroup[bgai-tx-group]
2025-05-19 15:34:28.453 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - will register resourceId:bgtech-ai#bgai-tx-group
2025-05-19 15:34:28.453 [main] INFO  io.seata.saga.tm.DefaultSagaTransactionalTemplate - Global Transaction Clients are initialized. 
2025-05-19 15:34:28.461 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.rm.AbstractRMHandler - the rm client received response msg [RegisterRMResponse{version='1.8.1-SNAPSHOT', extraData='null', identified=true, resultCode=null, msg='null'}] from tc server.
2025-05-19 15:34:29.766 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - Starting ProtocolHandler ["http-nio-8080"]
2025-05-19 15:34:29.781 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat started on port(s): 8080 (http) with context path ''
2025-05-19 15:34:29.792 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from ans.namespace attribute : null
2025-05-19 15:34:29.792 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from ALIBABA_ALIWARE_NAMESPACE attribute :null
2025-05-19 15:34:29.793 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from namespace attribute :null
2025-05-19 15:34:29.804 [main] INFO  c.a.n.p.auth.spi.client.ClientAuthPluginManager - [ClientAuthPluginManager] Load ClientAuthService com.alibaba.nacos.client.auth.impl.NacosClientAuthServiceImpl success.
2025-05-19 15:34:29.804 [main] INFO  c.a.n.p.auth.spi.client.ClientAuthPluginManager - [ClientAuthPluginManager] Load ClientAuthService com.alibaba.nacos.client.auth.ram.RamClientAuthServiceImpl success.
2025-05-19 15:34:29.808 [main] INFO  com.alibaba.nacos.common.remote.client - [RpcClientFactory] create a new rpc client of 1929b0e9-a630-4631-abb8-1ef3241389ec
2025-05-19 15:34:29.809 [main] INFO  com.alibaba.nacos.common.remote.client - [1929b0e9-a630-4631-abb8-1ef3241389ec] RpcClient init, ServerListFactory = com.alibaba.nacos.client.naming.core.ServerListManager
2025-05-19 15:34:29.810 [main] INFO  com.alibaba.nacos.common.remote.client - [1929b0e9-a630-4631-abb8-1ef3241389ec] Registry connection listener to current client:com.alibaba.nacos.client.naming.remote.gprc.redo.NamingGrpcRedoService
2025-05-19 15:34:29.810 [main] INFO  com.alibaba.nacos.common.remote.client - [1929b0e9-a630-4631-abb8-1ef3241389ec] Register server push request handler:com.alibaba.nacos.client.naming.remote.gprc.NamingPushRequestHandler
2025-05-19 15:34:29.810 [main] INFO  com.alibaba.nacos.common.remote.client - [1929b0e9-a630-4631-abb8-1ef3241389ec] Try to connect to server on start up, server: {serverIp = '8.133.246.113', server main port = 8848}
2025-05-19 15:34:29.810 [main] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - grpc client connection server:8.133.246.113 ip,serverPort:9848,grpcTslConfig:{"sslProvider":"OPENSSL","enableTls":false,"mutualAuthEnable":false,"trustAll":false}
2025-05-19 15:34:29.938 [main] INFO  com.alibaba.nacos.common.remote.client - [1929b0e9-a630-4631-abb8-1ef3241389ec] Success to connect to server [8.133.246.113:8848] on start up, connectionId = 1747640069834_139.227.195.203_43768
2025-05-19 15:34:29.938 [main] INFO  com.alibaba.nacos.common.remote.client - [1929b0e9-a630-4631-abb8-1ef3241389ec] Register server push request handler:com.alibaba.nacos.common.remote.client.RpcClient$ConnectResetRequestHandler
2025-05-19 15:34:29.938 [com.alibaba.nacos.client.remote.worker] INFO  com.alibaba.nacos.common.remote.client - [1929b0e9-a630-4631-abb8-1ef3241389ec] Notify connected event to listeners.
2025-05-19 15:34:29.938 [main] INFO  com.alibaba.nacos.common.remote.client - [1929b0e9-a630-4631-abb8-1ef3241389ec] Register server push request handler:com.alibaba.nacos.common.remote.client.RpcClient$$Lambda/0x000002600c528870
2025-05-19 15:34:29.938 [com.alibaba.nacos.client.remote.worker] INFO  com.alibaba.nacos.client.naming - Grpc connection connect
2025-05-19 15:34:29.939 [main] INFO  com.alibaba.nacos.client.naming - [REGISTER-SERVICE] d750d92e-152f-4055-a641-3bc9dda85a29 registering service bgtech-ai with instance Instance{instanceId='null', ip='192.168.86.8', port=8080, weight=1.0, healthy=true, enabled=true, ephemeral=true, clusterName='DEFAULT', serviceName='null', metadata={IPv6=[2408:820c:7528:8342:b486:9b72:4b72:4bf0], preserved.register.source=SPRING_CLOUD}}
2025-05-19 15:34:29.959 [main] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - nacos registry, DEFAULT_GROUP bgtech-ai 192.168.86.8:8080 register finished
2025-05-19 15:34:30.024 [main] INFO  com.bgpay.bgai.config.NacosConfig - 应用启动完成，当前环境: dev
2025-05-19 15:34:30.024 [main] INFO  com.bgpay.bgai.config.NacosConfig - Nacos配置中心: 8.133.246.113:8848, 命名空间: d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-19 15:34:30.024 [main] INFO  com.bgpay.bgai.config.NacosConfig - 注意: 如果看到Nacos配置加载警告，但应用正常启动，说明应用正在使用本地配置文件
2025-05-19 15:34:30.026 [main] INFO  com.bgpay.bgai.BgaiApplication - Started BgaiApplication in 18.33 seconds (process running for 19.762)
2025-05-19 15:34:30.029 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-19 15:34:30.029 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-19 15:34:30.048 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-19 15:34:30.048 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-19 15:34:30.049 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-19 15:34:30.059 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-19 15:34:30.059 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-19 15:34:30.060 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-19 15:34:30.068 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-19 15:34:30.069 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-19 15:34:30.069 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-19 15:34:30.075 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-19 15:34:30.075 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - ==================== Saga状态机加载报告 ====================
2025-05-19 15:34:30.075 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - Saga状态机配置加载状态: 成功
2025-05-19 15:34:30.075 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 已加载的状态机定义文件数量: 1
2025-05-19 15:34:30.075 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 已加载的状态机定义文件:
2025-05-19 15:34:30.075 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig -  - /E:/project/bgai/target/classes/statelang/bgai-saga-transaction.json
2025-05-19 15:34:30.075 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - Saga解析器状态: CUSTOM_FASTJSON2
2025-05-19 15:34:30.075 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 状态机解析结果: 成功 1 个, 失败 0 个
2025-05-19 15:34:30.075 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - =============================================================
2025-05-19 15:34:30.079 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - nacos.cache.data.init.snapshot = true 
2025-05-19 15:34:30.080 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] common-dev.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-19 15:34:30.089 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=common-dev.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-19 15:34:30.089 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=common-dev.yaml, group=DEFAULT_GROUP
2025-05-19 15:34:30.090 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-19 15:34:30.090 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-19 15:34:30.090 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai.yaml, group=DEFAULT_GROUP
2025-05-19 15:34:30.091 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai-dev.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-19 15:34:30.091 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai-dev.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-19 15:34:30.091 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai-dev.yaml, group=DEFAULT_GROUP
2025-05-19 15:34:30.091 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-19 15:34:30.091 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai, group=DEFAULT_GROUP, cnt=1
2025-05-19 15:34:30.091 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai, group=DEFAULT_GROUP
2025-05-19 15:34:40.313 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - 接收到请求: /api/chatGatWay-internal, 文件=新文件 17.txt, 问题参数=null, 模型参数=null
2025-05-19 15:34:40.315 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - 请求Content-Type: multipart/form-data;boundary=--------------------------624742195042075670638482
2025-05-19 15:34:40.316 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - 收集到的完整参数: question="null", apiUrl="null", modelName="null", multiTurn=false
2025-05-19 15:34:40.317 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - Processing request for user ID: 689258T
2025-05-19 15:34:40.317 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - Processing file with circuit breaker: fileName=新文件 17.txt, question=
2025-05-19 15:34:40.319 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.config.ReactiveFileProcessor - Processing file: 新文件 17.txt, content-type: text/plain
2025-05-19 15:34:40.325 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - PARAM TRACE [689258T]: 尝试查找匹配配置 - 参数: apiUrl=null, modelName=null
2025-05-19 15:34:40.342 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 查询配置 - userId=689258T
2025-05-19 15:34:40.343 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 排序方式 - 按ID降序
2025-05-19 15:34:40.343 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 限制结果数 - LIMIT 1
2025-05-19 15:34:40.419 [http-nio-8080-exec-2] DEBUG com.bgpay.bgai.mapper.ApiConfigMapper.selectList - ==>  Preparing: SELECT id,api_url,api_key,model_name,user_id FROM api_config WHERE (user_id = ?) ORDER BY id DESC LIMIT 1
2025-05-19 15:34:40.420 [http-nio-8080-exec-2] DEBUG com.bgpay.bgai.mapper.ApiConfigMapper.selectList - ==> Parameters: 689258T(String)
2025-05-19 15:34:40.428 [http-nio-8080-exec-2] DEBUG com.bgpay.bgai.mapper.ApiConfigMapper.selectList - <==      Total: 1
2025-05-19 15:34:40.429 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 查询结果 - 找到配置: id=2, modelName=deepseek-chat
2025-05-19 15:34:40.429 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - PARAM TRACE [689258T]: 找到匹配配置 - apiUrl=https://api.deepseek.com/chat/completions, modelName=deepseek-chat (原始请求: null)
2025-05-19 15:34:40.429 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - API config resolved: url=https://api.deepseek.com/chat/completions, model=deepseek-chat
2025-05-19 15:34:40.450 [Thread-50] INFO  com.bgpay.bgai.config.ReactiveFileProcessor - File processed successfully: size=2153 bytes
2025-05-19 15:34:40.455 [Thread-50] INFO  com.bgpay.bgai.controller.ReactiveChatController - Content processed, length: 2192
2025-05-19 15:34:40.461 [Thread-50] INFO  io.seata.tm.TransactionManagerHolder - TransactionManager Singleton io.seata.tm.DefaultTransactionManager@34e9a66e
2025-05-19 15:34:40.476 [Thread-50] INFO  io.seata.tm.api.DefaultGlobalTransaction - Begin new global transaction [seata-server:8091:18666493999071243]
2025-05-19 15:34:40.478 [Thread-50] INFO  c.b.bgai.interceptor.SeataTransactionInterceptor - 准备记录分布式事务开始: XID=seata-server:8091:18666493999071243, 业务=com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive, 路径=, IP=, 用户=system
2025-05-19 15:34:40.494 [Thread-50] INFO  c.b.bgai.service.impl.TransactionLogServiceImpl - 记录分布式事务开始: XID=seata-server:8091:18666493999071243, 业务=com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive
2025-05-19 15:34:40.503 [Thread-50] DEBUG com.bgpay.bgai.mapper.TransactionLogMapper.insert - ==>  Preparing: INSERT INTO transaction_log ( xid, transaction_name, transaction_mode, status, request_path, source_ip, start_time, user_id, create_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-05-19 15:34:40.507 [Thread-50] DEBUG com.bgpay.bgai.mapper.TransactionLogMapper.insert - ==> Parameters: seata-server:8091:18666493999071243(String), com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive(String), AT(String), ACTIVE(String), (String), (String), 2025-05-19T15:34:40.495972500(LocalDateTime), system(String), 2025-05-19T15:34:40.495972500(LocalDateTime)
2025-05-19 15:34:41.025 [Thread-50] DEBUG com.bgpay.bgai.mapper.TransactionLogMapper.insert - <==    Updates: 1
2025-05-19 15:34:41.050 [Thread-50] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:18666493999071243, branchId:18666493999071244, lockKeys:transaction_log:8
2025-05-19 15:34:41.066 [Thread-50] WARN  i.s.c.l.EnhancedServiceLoader$InnerEnhancedServiceLoader - Load [io.seata.rm.datasource.undo.parser.ProtostuffUndoLogParser] class fail: io/protostuff/runtime/IdStrategy
2025-05-19 15:34:41.141 [Thread-50] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:18666493999071243, branchId:18666493999071245, lockKeys:undo_log:29;transaction_log:8
2025-05-19 15:34:41.172 [Thread-50] INFO  c.b.bgai.interceptor.SeataTransactionInterceptor - 开始分布式事务: XID=seata-server:8091:18666493999071243, 方法=com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive
2025-05-19 15:34:41.193 [Thread-50] INFO  org.reflections.Reflections - Processing reactive request: content length=2192, apiUrl=https://api.deepseek.com/chat/completions, modelName=deepseek-chat, userId=689258T, multiTurn=false
2025-05-19 15:34:41.228 [Thread-50] INFO  com.bgpay.bgai.transaction.TransactionCoordinator - Transaction prepared for user 689258T: chatCompletionId=chat-210e7da5-eec0-4649-80a5-61eba26cb8ea
2025-05-19 15:34:41.231 [Thread-50] INFO  org.reflections.Reflections - Generated request JSON with 2PC transaction: {"stream":false,"max_tokens":2000,"temperature":1.0,"messages":[{"role":"system","content":"You are ...
2025-05-19 15:34:41.257 [Thread-50] INFO  c.b.bgai.service.impl.TransactionLogServiceImpl - 记录分布式事务结束: XID=seata-server:8091:18666493999071243, 状态=COMMITTED
2025-05-19 15:34:41.259 [Thread-50] DEBUG c.b.bgai.mapper.TransactionLogMapper.selectList - ==>  Preparing: SELECT id,xid,branch_id,transaction_name,transaction_mode,status,request_path,source_ip,start_time,end_time,user_id,extra_data,create_time,update_time FROM transaction_log WHERE (xid = ?) LIMIT 1
2025-05-19 15:34:41.262 [Thread-50] DEBUG c.b.bgai.mapper.TransactionLogMapper.selectList - ==> Parameters: seata-server:8091:18666493999071243(String)
2025-05-19 15:34:41.271 [Thread-50] DEBUG c.b.bgai.mapper.TransactionLogMapper.selectList - <==      Total: 1
2025-05-19 15:34:41.275 [Thread-50] DEBUG c.b.bgai.mapper.TransactionLogMapper.updateById - ==>  Preparing: UPDATE transaction_log SET xid=?, transaction_name=?, transaction_mode=?, status=?, request_path=?, source_ip=?, start_time=?, end_time=?, user_id=?, extra_data=?, create_time=?, update_time=? WHERE id=?
2025-05-19 15:34:41.284 [Thread-50] DEBUG c.b.bgai.mapper.TransactionLogMapper.updateById - ==> Parameters: seata-server:8091:18666493999071243(String), com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive(String), AT(String), COMMITTED(String), (String), (String), 2025-05-19T15:34:40(LocalDateTime), 2025-05-19T15:34:41.271086(LocalDateTime), system(String), {"duration":79,"result":"success"}(String), 2025-05-19T15:34:40(LocalDateTime), 2025-05-19T15:34:41.271086(LocalDateTime), 8(Long)
2025-05-19 15:34:41.333 [Thread-50] DEBUG c.b.bgai.mapper.TransactionLogMapper.updateById - <==    Updates: 1
2025-05-19 15:34:41.345 [Thread-50] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:18666493999071243, branchId:18666493999071246, lockKeys:transaction_log:8
2025-05-19 15:34:41.369 [Thread-50] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:18666493999071243, branchId:18666493999071247, lockKeys:transaction_log:8;undo_log:31
2025-05-19 15:34:41.392 [Thread-50] INFO  c.b.bgai.interceptor.SeataTransactionInterceptor - 分布式事务成功完成: XID=seata-server:8091:18666493999071243, 耗时=79ms
2025-05-19 15:34:41.393 [Thread-50] INFO  io.seata.tm.api.DefaultGlobalTransaction - transaction seata-server:8091:18666493999071243 will be commit
2025-05-19 15:34:41.404 [Thread-50] INFO  io.seata.tm.api.DefaultGlobalTransaction - transaction end, xid = seata-server:8091:18666493999071243
2025-05-19 15:34:41.404 [Thread-50] INFO  io.seata.tm.api.DefaultGlobalTransaction - [seata-server:8091:18666493999071243] commit status: Committed
2025-05-19 15:34:41.544 [rpcDispatch_RMROLE_1_1_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:18666493999071243', branchId=18666493999071244, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false,"skipCheckLock":true}'}
2025-05-19 15:34:41.546 [rpcDispatch_RMROLE_1_1_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:18666493999071243 18666493999071244 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false,"skipCheckLock":true}
2025-05-19 15:34:41.548 [rpcDispatch_RMROLE_1_1_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-19 15:34:41.559 [rpcDispatch_RMROLE_1_2_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:18666493999071243', branchId=18666493999071245, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false,"skipCheckLock":true}'}
2025-05-19 15:34:41.559 [rpcDispatch_RMROLE_1_2_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:18666493999071243 18666493999071245 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false,"skipCheckLock":true}
2025-05-19 15:34:41.559 [rpcDispatch_RMROLE_1_2_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-19 15:34:41.569 [rpcDispatch_RMROLE_1_3_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:18666493999071243', branchId=18666493999071246, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false}'}
2025-05-19 15:34:41.570 [rpcDispatch_RMROLE_1_3_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:18666493999071243 18666493999071246 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false}
2025-05-19 15:34:41.570 [rpcDispatch_RMROLE_1_3_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-19 15:34:41.581 [rpcDispatch_RMROLE_1_4_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:18666493999071243', branchId=18666493999071247, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false}'}
2025-05-19 15:34:41.581 [rpcDispatch_RMROLE_1_4_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:18666493999071243 18666493999071247 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false}
2025-05-19 15:34:41.581 [rpcDispatch_RMROLE_1_4_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-19 15:35:02.956 [reactor-http-nio-2] INFO  org.reflections.Reflections - Raw response received, length: 2090
2025-05-19 15:35:02.965 [reactor-http-nio-2] WARN  org.reflections.Reflections - Received different chatCompletionId from response: 1aeffae3-1b75-46ec-8022-d46a6f3f65ee vs prepared: chat-210e7da5-eec0-4649-80a5-61eba26cb8ea
2025-05-19 15:35:02.995 [reactor-http-nio-2] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - ==>  Preparing: INSERT INTO chat_completions ( object, created, model, system_fingerprint, api_key ) VALUES ( ?, ?, ?, ?, ? )
2025-05-19 15:35:02.996 [reactor-http-nio-2] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - ==> Parameters: chat.completion(String), 1747640102993(Long), deepseek-chat(String), 689258T(String), chat-210e7da5-eec0-4649-80a5-61eba26cb8ea(String)
2025-05-19 15:35:03.009 [reactor-http-nio-2] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - <==    Updates: 1
2025-05-19 15:35:03.010 [reactor-http-nio-2] INFO  com.bgpay.bgai.transaction.TransactionCoordinator - Transaction committed for user 689258T: chatCompletionId=chat-210e7da5-eec0-4649-80a5-61eba26cb8ea
2025-05-19 15:35:03.039 [FileWrite-1] INFO  com.bgpay.bgai.service.deepseek.FileWriterService - Successfully wrote content to: \var\data\ai_responses\ff5d9030-a01e-40b6-8ef1-ab91580ead86.txt
2025-05-19 15:35:03.046 [boundedElastic-1] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - ==>  Preparing: INSERT INTO chat_completions ( object, created, model, system_fingerprint, api_key ) VALUES ( ?, ?, ?, ?, ? )
2025-05-19 15:35:03.047 [boundedElastic-1] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - ==> Parameters: chat.completion(String), 1747640081(Long), deepseek-chat(String), fp_8802369eaa_prod0425fp8(String), chat-210e7da5-eec0-4649-80a5-61eba26cb8ea(String)
2025-05-19 15:35:03.057 [boundedElastic-1] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - <==    Updates: 1
2025-05-19 15:35:03.102 [boundedElastic-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.insert - ==>  Preparing: INSERT INTO usage_info ( chat_completion_id, prompt_tokens, completion_tokens, total_tokens, prompt_tokens_cached, completion_reasoning_tokens, prompt_cache_hit_tokens, prompt_cache_miss_tokens, created_at, model_type ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-05-19 15:35:03.104 [boundedElastic-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.insert - ==> Parameters: chat-210e7da5-eec0-4649-80a5-61eba26cb8ea(String), 721(Integer), 390(Integer), 1111(Integer), 704(Integer), 0(Integer), 0(Integer), 17(Integer), 2025-05-19T15:35:03.084396300(LocalDateTime), deepseek-chat(String)
2025-05-19 15:35:03.129 [boundedElastic-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.insert - <==    Updates: 1
2025-05-19 15:35:03.145 [boundedElastic-1] INFO  org.reflections.Reflections - Completion data saved synchronously for chatCompletionId: chat-210e7da5-eec0-4649-80a5-61eba26cb8ea
2025-05-19 15:35:03.152 [boundedElastic-2] INFO  org.reflections.Reflections - 开始发送账单消息，chatCompletionId: chat-210e7da5-eec0-4649-80a5-61eba26cb8ea, userId: 689258T
2025-05-19 15:35:03.218 [boundedElastic-2] INFO  org.reflections.Reflections - 账单消息发送成功，chatCompletionId: chat-210e7da5-eec0-4649-80a5-61eba26cb8ea, userId: 689258T
2025-05-19 15:35:03.221 [boundedElastic-1] INFO  org.reflections.Reflections - Complete processing chain completed: The provided content is a configuration file for Seata, a distributed transaction solution. Here's an analysis of the key configurations:

### Basic Configuration
- `enabled: true` - Enables Seata functionality
- `application-id: bgai` - Identifies the application
- `tx-service-group: bgai-tx-group` - Transaction group name
- `enable-auto-data-source-proxy: true` - Enables automatic data source proxying

### Resource Manager (RM) Configuration
- `async-commit-buffer-limit: 10000` - Async commit buffer size
- `report-retry-count: 5` - Retry count for reporting
- `lock` settings configure lock retry behavior (interval, times, rollback policy)

### Transaction Manager (TM) Configuration
- `commit-retry-count` and `rollback-retry-count` set to 5
- `default-global-transaction-timeout: 60000` (60 seconds)

### Undo Log Configuration
- `log-table: undo_log` - Specifies undo log table name
- `log-serialization: jackson` - Uses Jackson for serialization

### Service Configuration
- Maps transaction group to TC server: `bgai-tx-group: default`
- TC server address: `8.133.246.113:8091`

### Transport Configuration
- Uses TCP/NIO for communication
- Thread pool configurations for Netty
- Heartbeat enabled

### Saga Configuration
- `enabled: true` - Enables Saga mode
- State machine configuration including thread pool settings
- Timeout values for operations and service invokes

This configuration appears to be for a Spring Boot application using Seata for distributed transactions, with both AT and Saga patterns enabled. The application connects to a Seata TC server at 8.133.246.113:8091.
2025-05-19 15:35:03.221 [boundedElastic-1] INFO  com.bgpay.bgai.controller.ReactiveChatController - Processed response for user 689258T, content length: 1602
2025-05-19 15:35:32.173 [Thread-7] WARN  com.alibaba.nacos.common.notify.NotifyCenter - [NotifyCenter] Start destroying Publisher
2025-05-19 15:35:32.174 [Thread-1] WARN  c.alibaba.nacos.common.http.HttpClientBeanHolder - [HttpClientBeanHolder] Start destroying common HttpClient
2025-05-19 15:35:32.174 [Thread-7] WARN  com.alibaba.nacos.common.notify.NotifyCenter - [NotifyCenter] Destruction of the end
2025-05-19 15:35:32.174 [Thread-1] WARN  c.alibaba.nacos.common.http.HttpClientBeanHolder - [HttpClientBeanHolder] Destruction of the end
2025-05-19 15:35:32.194 [NettyClientSelector_TMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - channel inactive: [id: 0x1953cf0c, L:/192.168.86.8:53143 ! R:/8.133.246.113:8091]
2025-05-19 15:35:32.194 [NettyClientSelector_TMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - return to pool, rm channel:[id: 0x1953cf0c, L:/192.168.86.8:53143 ! R:/8.133.246.113:8091]
2025-05-19 15:35:32.194 [NettyClientSelector_TMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - channel valid false,channel:[id: 0x1953cf0c, L:/192.168.86.8:53143 ! R:/8.133.246.113:8091]
2025-05-19 15:35:32.194 [NettyClientSelector_TMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - will destroy channel:[id: 0x1953cf0c, L:/192.168.86.8:53143 ! R:/8.133.246.113:8091]
2025-05-19 15:35:32.194 [NettyClientSelector_TMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0x1953cf0c, L:/192.168.86.8:53143 ! R:/8.133.246.113:8091]) will closed
2025-05-19 15:35:32.194 [NettyClientSelector_TMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0x1953cf0c, L:/192.168.86.8:53143 ! R:/8.133.246.113:8091]) will closed
2025-05-19 15:35:32.195 [NettyClientSelector_RMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - channel inactive: [id: 0x5bc45ad2, L:/192.168.86.8:53183 ! R:/8.133.246.113:8091]
2025-05-19 15:35:32.196 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - return to pool, rm channel:[id: 0x5bc45ad2, L:/192.168.86.8:53183 ! R:/8.133.246.113:8091]
2025-05-19 15:35:32.196 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - channel valid false,channel:[id: 0x5bc45ad2, L:/192.168.86.8:53183 ! R:/8.133.246.113:8091]
2025-05-19 15:35:32.196 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - will destroy channel:[id: 0x5bc45ad2, L:/192.168.86.8:53183 ! R:/8.133.246.113:8091]
2025-05-19 15:35:32.196 [NettyClientSelector_RMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0x5bc45ad2, L:/192.168.86.8:53183 ! R:/8.133.246.113:8091]) will closed
2025-05-19 15:35:32.196 [NettyClientSelector_RMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0x5bc45ad2, L:/192.168.86.8:53183 ! R:/8.133.246.113:8091]) will closed
2025-05-19 15:35:32.199 [SpringContextShutdownHook] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - De-registering from Nacos Server now...
2025-05-19 15:35:32.199 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - [DEREGISTER-SERVICE] d750d92e-152f-4055-a641-3bc9dda85a29 deregistering service bgtech-ai with instance: Instance{instanceId='null', ip='192.168.86.8', port=8080, weight=1.0, healthy=true, enabled=true, ephemeral=true, clusterName='DEFAULT', serviceName='null', metadata={}}
2025-05-19 15:35:32.210 [SpringContextShutdownHook] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - De-registration finished.
2025-05-19 15:35:32.211 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.cache.ServiceInfoHolder do shutdown begin
2025-05-19 15:35:32.211 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.backups.FailoverReactor do shutdown begin
2025-05-19 15:35:32.212 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.backups.FailoverReactor do shutdown stop
2025-05-19 15:35:32.212 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.cache.ServiceInfoHolder do shutdown stop
2025-05-19 15:35:32.212 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.NamingClientProxyDelegate do shutdown begin
2025-05-19 15:35:32.212 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServiceInfoUpdateService do shutdown begin
2025-05-19 15:35:32.213 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServiceInfoUpdateService do shutdown stop
2025-05-19 15:35:32.213 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServerListManager do shutdown begin
2025-05-19 15:35:32.213 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Start destroying NacosRestTemplate
2025-05-19 15:35:32.213 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Destruction of the end
2025-05-19 15:35:32.213 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServerListManager do shutdown stop
2025-05-19 15:35:32.213 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.http.NamingHttpClientProxy do shutdown begin
2025-05-19 15:35:32.213 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Start destroying NacosRestTemplate
2025-05-19 15:35:32.213 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Destruction of the end
2025-05-19 15:35:32.213 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.http.NamingHttpClientProxy do shutdown stop
2025-05-19 15:35:32.213 [SpringContextShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Shutdown rpc client, set status to shutdown
2025-05-19 15:35:32.213 [SpringContextShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Shutdown client event executor java.util.concurrent.ScheduledThreadPoolExecutor@3ca1fde[Running, pool size = 2, active threads = 2, queued tasks = 0, completed tasks = 0]
2025-05-19 15:35:32.213 [SpringContextShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Close current connection 1747640069834_139.227.195.203_43768
2025-05-19 15:35:32.220 [nacos-grpc-client-executor-8.133.246.113-24] WARN  c.a.nacos.common.remote.client.grpc.GrpcClient - [1747640069834_139.227.195.203_43768]Ignore error event,isRunning:false,isAbandon=false
2025-05-19 15:35:32.222 [SpringContextShutdownHook] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - Shutdown grpc executor java.util.concurrent.ThreadPoolExecutor@7b591f4[Running, pool size = 5, active threads = 0, queued tasks = 0, completed tasks = 25]
2025-05-19 15:35:32.222 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - Shutdown grpc redo service executor java.util.concurrent.ScheduledThreadPoolExecutor@2b58ca9c[Running, pool size = 1, active threads = 0, queued tasks = 1, completed tasks = 20]
2025-05-19 15:35:32.222 [SpringContextShutdownHook] INFO  c.a.n.client.auth.ram.identify.CredentialWatcher - [null] CredentialWatcher is stopped
2025-05-19 15:35:32.223 [SpringContextShutdownHook] INFO  c.a.n.client.auth.ram.identify.CredentialService - [null] CredentialService is freed
2025-05-19 15:35:32.228 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.NamingClientProxyDelegate do shutdown stop
2025-05-19 15:35:32.245 [SpringContextShutdownHook] DEBUG com.bgpay.bgai.config.AsyncConfig$1 - Shutting down ExecutorService 'blockingExecutor'
2025-05-19 15:35:32.820 [com.alibaba.nacos.client.Worker] INFO  c.a.n.client.auth.ram.identify.CredentialWatcher - null No credential found
2025-05-19 15:35:34.452 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:10909] result: true
2025-05-19 15:35:34.452 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:10911] result: true
2025-05-19 15:35:34.452 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:9876] result: true
2025-05-19 15:35:34.466 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:10911] result: true
2025-05-19 15:35:34.466 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:9876] result: true
2025-05-19 15:35:34.579 [SpringContextShutdownHook] INFO  o.s.orm.jpa.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-05-19 15:35:34.580 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-2} closing ...
2025-05-19 15:35:34.587 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-2} closed
2025-05-19 15:35:34.587 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} closing ...
2025-05-19 15:35:34.587 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} closed
2025-05-19 15:35:43.895 [main] WARN  com.alibaba.nacos.client.logging.NacosLogging - Load Logback Configuration of Nacos fail, message: Could not initialize Logback Nacos logging from classpath:nacos-logback.xml
2025-05-19 15:35:43.895 [main] INFO  com.bgpay.bgai.BgaiApplication - The following 1 profile is active: "dev"
2025-05-19 15:35:45.228 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-05-19 15:35:45.230 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-05-19 15:35:45.253 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 16 ms. Found 0 JPA repository interfaces.
2025-05-19 15:35:45.264 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-05-19 15:35:45.265 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-05-19 15:35:45.276 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 4 ms. Found 0 Redis repository interfaces.
2025-05-19 15:35:45.821 [main] INFO  io.seata.config.ConfigurationFactory - load Configuration from :Spring Configuration
2025-05-19 15:35:45.829 [main] INFO  io.seata.config.ConfigurationFactory - load Configuration from :Spring Configuration
2025-05-19 15:35:45.835 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Initializing Global Transaction Clients ... 
2025-05-19 15:35:45.940 [main] INFO  io.seata.core.rpc.netty.NettyClientBootstrap - NettyClientBootstrap has started
2025-05-19 15:35:45.941 [main] INFO  io.seata.discovery.registry.RegistryFactory - use registry center type: file
2025-05-19 15:35:45.952 [main] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - will connect to 8.133.246.113:8091
2025-05-19 15:35:45.956 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - NettyPool create channel to transactionRole:TMROLE,address:8.133.246.113:8091,msg:< RegisterTMRequest{version='1.7.0', applicationId='bgtech-ai', transactionServiceGroup='bgai-tx-group', extraData='ak=null
digest=bgai-tx-group,192.168.86.8,1747640145954
timestamp=1747640145954
authVersion=V4
vgroup=bgai-tx-group
ip=192.168.86.8
'} >
2025-05-19 15:35:46.111 [main] INFO  io.seata.core.rpc.netty.TmNettyRemotingClient - register TM success. client version:1.7.0, server version:1.8.1-SNAPSHOT,channel:[id: 0x02c8a9d9, L:/192.168.86.8:59556 - R:/8.133.246.113:8091]
2025-05-19 15:35:46.118 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - register success, cost 74 ms, version:1.8.1-SNAPSHOT,role:TMROLE,channel:[id: 0x02c8a9d9, L:/192.168.86.8:59556 - R:/8.133.246.113:8091]
2025-05-19 15:35:46.118 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Transaction Manager Client is initialized. applicationId[bgtech-ai] txServiceGroup[bgai-tx-group]
2025-05-19 15:35:46.130 [main] INFO  io.seata.rm.datasource.AsyncWorker - Async Commit Buffer Limit: 10000
2025-05-19 15:35:46.131 [main] INFO  io.seata.rm.datasource.xa.ResourceManagerXA - ResourceManagerXA init ...
2025-05-19 15:35:46.137 [main] INFO  io.seata.core.rpc.netty.NettyClientBootstrap - NettyClientBootstrap has started
2025-05-19 15:35:46.137 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Resource Manager is initialized. applicationId[bgtech-ai] txServiceGroup[bgai-tx-group]
2025-05-19 15:35:46.137 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Global Transaction Clients are initialized. 
2025-05-19 15:35:47.248 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat initialized with port(s): 8080 (http)
2025-05-19 15:35:47.259 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - The ["http-nio-8080"] connector has been configured to support HTTP upgrade to [h2c]
2025-05-19 15:35:47.259 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - Initializing ProtocolHandler ["http-nio-8080"]
2025-05-19 15:35:47.261 [main] INFO  org.apache.catalina.core.StandardService - Starting service [Tomcat]
2025-05-19 15:35:47.262 [main] INFO  org.apache.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.15]
2025-05-19 15:35:47.659 [main] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} inited
2025-05-19 15:35:47.894 [main] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - will connect to 8.133.246.113:8091
2025-05-19 15:35:47.895 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - RM will register :jdbc:mysql://8.133.246.113:3306/deepseek
2025-05-19 15:35:47.895 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - NettyPool create channel to transactionRole:RMROLE,address:8.133.246.113:8091,msg:< RegisterRMRequest{resourceIds='jdbc:mysql://8.133.246.113:3306/deepseek', version='1.7.0', applicationId='bgtech-ai', transactionServiceGroup='bgai-tx-group', extraData='null'} >
2025-05-19 15:35:47.915 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - register RM success. client version:1.7.0, server version:1.8.1-SNAPSHOT,channel:[id: 0xea376fac, L:/192.168.86.8:59565 - R:/8.133.246.113:8091]
2025-05-19 15:35:47.915 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - register success, cost 12 ms, version:1.8.1-SNAPSHOT,role:RMROLE,channel:[id: 0xea376fac, L:/192.168.86.8:59565 - R:/8.133.246.113:8091]
2025-05-19 15:35:47.917 [main] INFO  i.s.s.a.datasource.SeataAutoDataSourceProxyCreator - Auto proxy data source 'masterDataSource' by 'AT' mode.
2025-05-19 15:35:47.989 [main] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-2} inited
2025-05-19 15:35:48.051 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - will register resourceId:jdbc:mysql://8.133.246.113:3306/deepseek
2025-05-19 15:35:48.052 [main] INFO  i.s.s.a.datasource.SeataAutoDataSourceProxyCreator - Auto proxy data source 'slaveDataSource' by 'AT' mode.
2025-05-19 15:35:48.060 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.rm.AbstractRMHandler - the rm client received response msg [RegisterRMResponse{version='1.8.1-SNAPSHOT', extraData='null', identified=true, resultCode=null, msg='null'}] from tc server.
2025-05-19 15:35:48.074 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - will register resourceId:jdbc:mysql://8.133.246.113:3306/deepseek
2025-05-19 15:35:48.075 [main] INFO  i.s.s.a.datasource.SeataAutoDataSourceProxyCreator - Auto proxy data source 'dynamicDataSource' by 'AT' mode.
2025-05-19 15:35:48.083 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.rm.AbstractRMHandler - the rm client received response msg [RegisterRMResponse{version='1.8.1-SNAPSHOT', extraData='null', identified=true, resultCode=null, msg='null'}] from tc server.
2025-05-19 15:35:48.197 [main] INFO  org.hibernate.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-05-19 15:35:48.251 [main] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.1.7.Final
2025-05-19 15:35:48.587 [main] INFO  SQL dialect - HHH000400: Using dialect: org.hibernate.dialect.MySQL8Dialect
2025-05-19 15:35:48.589 [main] WARN  org.hibernate.orm.deprecation - HHH90000026: MySQL8Dialect has been deprecated; use org.hibernate.dialect.MySQLDialect instead
2025-05-19 15:35:48.889 [main] INFO  o.h.e.t.jta.platform.internal.JtaPlatformInitiator - HHH000490: Using JtaPlatform implementation: [org.hibernate.engine.transaction.jta.platform.internal.NoJtaPlatform]
2025-05-19 15:35:48.901 [main] INFO  o.s.orm.jpa.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-05-19 15:35:49.329 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-19 15:35:49.340 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-19 15:35:49.366 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-19 15:35:49.368 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-19 15:35:49.368 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-19 15:35:49.380 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-19 15:35:50.022 [main] INFO  com.bgpay.bgai.service.impl.UserServiceImpl - 初始化SSO配置: clientId=bgai-client-id, redirectUri=http://localhost:8080/api/auth/callback
2025-05-19 15:35:50.155 [main] INFO  com.bgpay.bgai.controller.AuthController - 初始化认证控制器: clientId=bgai-client-id, redirectUri=http://localhost:8080/api/auth/callback
2025-05-19 15:35:50.592 [main] INFO  o.a.r.s.autoconfigure.RocketMQAutoConfiguration - a producer (billing-producer-group) init on namesrv 8.133.246.113:9876
2025-05-19 15:35:51.309 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Bean [com.bgpay.bgai.service.deepseek.DeepSeekServiceImp$$SpringCGLIB$$0] with name [deepSeekServiceImp] would use interceptor [io.seata.spring.annotation.GlobalTransactionalInterceptor]
2025-05-19 15:35:51.625 [main] WARN  i.s.s.b.a.provider.SpringBootConfigurationProvider - The get method not found for the field 'SeataProperties#accesskey'.
2025-05-19 15:35:51.625 [main] WARN  i.s.s.b.a.provider.SpringBootConfigurationProvider - The get method not found for the field 'SeataProperties#secretkey'.
2025-05-19 15:35:51.636 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 加载到1个Saga状态机定义文件
2025-05-19 15:35:51.772 [main] INFO  com.bgpay.bgai.saga.CustomSagaJsonParser - 开始解析状态机定义: bgai-saga-transaction
2025-05-19 15:35:51.772 [main] INFO  com.bgpay.bgai.saga.CustomSagaJsonParser - 状态机定义解析成功: bgai-saga-transaction
2025-05-19 15:35:51.772 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 成功加载状态机定义: /E:/project/bgai/target/classes/statelang/bgai-saga-transaction.json
2025-05-19 15:35:52.181 [main] INFO  org.redisson.Version - Redisson 3.24.3
2025-05-19 15:35:52.311 [redisson-netty-4-6] INFO  o.r.connection.pool.MasterPubSubConnectionPool - 1 connections initialized for 8.133.246.113/8.133.246.113:6379
2025-05-19 15:35:52.638 [redisson-netty-4-19] INFO  org.redisson.connection.pool.MasterConnectionPool - 24 connections initialized for 8.133.246.113/8.133.246.113:6379
2025-05-19 15:35:52.919 [main] INFO  com.bgpay.bgai.service.mq.MQConsumerService - MQ consumer startup successful [group=billing-consumer-group, topic=BILLING_TOPIC, tag=USER_BILLING]
2025-05-19 15:35:53.311 [main] DEBUG com.bgpay.bgai.config.AsyncConfig$1 - Initializing ExecutorService 'blockingExecutor'
2025-05-19 15:35:53.358 [main] INFO  c.b.bgai.config.NacosConfig$NacosWarningHandler - Nacos警告处理器已启用，将忽略配置中心连接警告
2025-05-19 15:35:54.570 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [After]
2025-05-19 15:35:54.570 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Before]
2025-05-19 15:35:54.570 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Between]
2025-05-19 15:35:54.570 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Cookie]
2025-05-19 15:35:54.570 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Header]
2025-05-19 15:35:54.570 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Host]
2025-05-19 15:35:54.570 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Method]
2025-05-19 15:35:54.570 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Path]
2025-05-19 15:35:54.570 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Query]
2025-05-19 15:35:54.570 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [ReadBody]
2025-05-19 15:35:54.570 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [RemoteAddr]
2025-05-19 15:35:54.570 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [XForwardedRemoteAddr]
2025-05-19 15:35:54.570 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Weight]
2025-05-19 15:35:54.570 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [CloudFoundryRouteService]
2025-05-19 15:35:55.966 [main] INFO  o.s.b.actuate.endpoint.web.EndpointLinksResolver - Exposing 1 endpoint(s) beneath base path '/actuator'
2025-05-19 15:35:56.296 [main] WARN  i.s.s.b.a.provider.SpringBootConfigurationProvider - The get method not found for the field 'SeataProperties#accesskey'.
2025-05-19 15:35:56.297 [main] WARN  i.s.s.b.a.provider.SpringBootConfigurationProvider - The get method not found for the field 'SeataProperties#secretkey'.
2025-05-19 15:35:56.311 [main] INFO  io.seata.saga.tm.DefaultSagaTransactionalTemplate - Initializing Global Transaction Clients ... 
2025-05-19 15:35:56.311 [main] INFO  io.seata.saga.tm.DefaultSagaTransactionalTemplate - Transaction Manager Client is initialized. applicationId[bgtech-ai] txServiceGroup[bgai-tx-group]
2025-05-19 15:35:56.311 [main] INFO  io.seata.saga.tm.DefaultSagaTransactionalTemplate - Resource Manager is initialized. applicationId[bgtech-ai] txServiceGroup[bgai-tx-group]
2025-05-19 15:35:56.311 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - will register resourceId:bgtech-ai#bgai-tx-group
2025-05-19 15:35:56.311 [main] INFO  io.seata.saga.tm.DefaultSagaTransactionalTemplate - Global Transaction Clients are initialized. 
2025-05-19 15:35:56.320 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.rm.AbstractRMHandler - the rm client received response msg [RegisterRMResponse{version='1.8.1-SNAPSHOT', extraData='null', identified=true, resultCode=null, msg='null'}] from tc server.
2025-05-19 15:35:57.623 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - Starting ProtocolHandler ["http-nio-8080"]
2025-05-19 15:35:57.640 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat started on port(s): 8080 (http) with context path ''
2025-05-19 15:35:57.652 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from ans.namespace attribute : null
2025-05-19 15:35:57.653 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from ALIBABA_ALIWARE_NAMESPACE attribute :null
2025-05-19 15:35:57.653 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from namespace attribute :null
2025-05-19 15:35:57.663 [main] INFO  c.a.n.p.auth.spi.client.ClientAuthPluginManager - [ClientAuthPluginManager] Load ClientAuthService com.alibaba.nacos.client.auth.impl.NacosClientAuthServiceImpl success.
2025-05-19 15:35:57.664 [main] INFO  c.a.n.p.auth.spi.client.ClientAuthPluginManager - [ClientAuthPluginManager] Load ClientAuthService com.alibaba.nacos.client.auth.ram.RamClientAuthServiceImpl success.
2025-05-19 15:35:57.668 [main] INFO  com.alibaba.nacos.common.remote.client - [RpcClientFactory] create a new rpc client of fd9cbddc-f8c3-4188-9afe-d2c0d67d1b9c
2025-05-19 15:35:57.670 [main] INFO  com.alibaba.nacos.common.remote.client - [fd9cbddc-f8c3-4188-9afe-d2c0d67d1b9c] RpcClient init, ServerListFactory = com.alibaba.nacos.client.naming.core.ServerListManager
2025-05-19 15:35:57.671 [main] INFO  com.alibaba.nacos.common.remote.client - [fd9cbddc-f8c3-4188-9afe-d2c0d67d1b9c] Registry connection listener to current client:com.alibaba.nacos.client.naming.remote.gprc.redo.NamingGrpcRedoService
2025-05-19 15:35:57.671 [main] INFO  com.alibaba.nacos.common.remote.client - [fd9cbddc-f8c3-4188-9afe-d2c0d67d1b9c] Register server push request handler:com.alibaba.nacos.client.naming.remote.gprc.NamingPushRequestHandler
2025-05-19 15:35:57.671 [main] INFO  com.alibaba.nacos.common.remote.client - [fd9cbddc-f8c3-4188-9afe-d2c0d67d1b9c] Try to connect to server on start up, server: {serverIp = '8.133.246.113', server main port = 8848}
2025-05-19 15:35:57.672 [main] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - grpc client connection server:8.133.246.113 ip,serverPort:9848,grpcTslConfig:{"sslProvider":"OPENSSL","enableTls":false,"mutualAuthEnable":false,"trustAll":false}
2025-05-19 15:35:57.815 [main] INFO  com.alibaba.nacos.common.remote.client - [fd9cbddc-f8c3-4188-9afe-d2c0d67d1b9c] Success to connect to server [8.133.246.113:8848] on start up, connectionId = 1747640157699_139.227.195.203_42614
2025-05-19 15:35:57.815 [main] INFO  com.alibaba.nacos.common.remote.client - [fd9cbddc-f8c3-4188-9afe-d2c0d67d1b9c] Register server push request handler:com.alibaba.nacos.common.remote.client.RpcClient$ConnectResetRequestHandler
2025-05-19 15:35:57.815 [main] INFO  com.alibaba.nacos.common.remote.client - [fd9cbddc-f8c3-4188-9afe-d2c0d67d1b9c] Register server push request handler:com.alibaba.nacos.common.remote.client.RpcClient$$Lambda/0x000002173e528870
2025-05-19 15:35:57.815 [com.alibaba.nacos.client.remote.worker] INFO  com.alibaba.nacos.common.remote.client - [fd9cbddc-f8c3-4188-9afe-d2c0d67d1b9c] Notify connected event to listeners.
2025-05-19 15:35:57.815 [com.alibaba.nacos.client.remote.worker] INFO  com.alibaba.nacos.client.naming - Grpc connection connect
2025-05-19 15:35:57.816 [main] INFO  com.alibaba.nacos.client.naming - [REGISTER-SERVICE] d750d92e-152f-4055-a641-3bc9dda85a29 registering service bgtech-ai with instance Instance{instanceId='null', ip='192.168.86.8', port=8080, weight=1.0, healthy=true, enabled=true, ephemeral=true, clusterName='DEFAULT', serviceName='null', metadata={IPv6=[2408:820c:7528:8342:b486:9b72:4b72:4bf0], preserved.register.source=SPRING_CLOUD}}
2025-05-19 15:35:57.834 [main] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - nacos registry, DEFAULT_GROUP bgtech-ai 192.168.86.8:8080 register finished
2025-05-19 15:35:57.897 [main] INFO  com.bgpay.bgai.config.NacosConfig - 应用启动完成，当前环境: dev
2025-05-19 15:35:57.898 [main] INFO  com.bgpay.bgai.config.NacosConfig - Nacos配置中心: 8.133.246.113:8848, 命名空间: d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-19 15:35:57.898 [main] INFO  com.bgpay.bgai.config.NacosConfig - 注意: 如果看到Nacos配置加载警告，但应用正常启动，说明应用正在使用本地配置文件
2025-05-19 15:35:57.899 [main] INFO  com.bgpay.bgai.BgaiApplication - Started BgaiApplication in 16.141 seconds (process running for 17.611)
2025-05-19 15:35:57.904 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-19 15:35:57.904 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-19 15:35:57.918 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-19 15:35:57.918 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-19 15:35:57.918 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-19 15:35:57.930 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-19 15:35:57.930 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-19 15:35:57.930 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-19 15:35:57.938 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-19 15:35:57.938 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-19 15:35:57.939 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-19 15:35:57.945 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-19 15:35:57.946 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - ==================== Saga状态机加载报告 ====================
2025-05-19 15:35:57.946 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - Saga状态机配置加载状态: 成功
2025-05-19 15:35:57.946 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 已加载的状态机定义文件数量: 1
2025-05-19 15:35:57.946 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 已加载的状态机定义文件:
2025-05-19 15:35:57.946 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig -  - /E:/project/bgai/target/classes/statelang/bgai-saga-transaction.json
2025-05-19 15:35:57.946 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - Saga解析器状态: CUSTOM_FASTJSON2
2025-05-19 15:35:57.946 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 状态机解析结果: 成功 1 个, 失败 0 个
2025-05-19 15:35:57.947 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - =============================================================
2025-05-19 15:35:57.950 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - nacos.cache.data.init.snapshot = true 
2025-05-19 15:35:57.951 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] common-dev.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-19 15:35:57.958 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=common-dev.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-19 15:35:57.959 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=common-dev.yaml, group=DEFAULT_GROUP
2025-05-19 15:35:57.959 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-19 15:35:57.959 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-19 15:35:57.959 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai.yaml, group=DEFAULT_GROUP
2025-05-19 15:35:57.961 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai-dev.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-19 15:35:57.961 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai-dev.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-19 15:35:57.961 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai-dev.yaml, group=DEFAULT_GROUP
2025-05-19 15:35:57.962 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-19 15:35:57.962 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai, group=DEFAULT_GROUP, cnt=1
2025-05-19 15:35:57.962 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai, group=DEFAULT_GROUP
2025-05-19 15:36:02.640 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - 接收到请求: /api/chatGatWay-internal, 文件=新文件 17.txt, 问题参数=null, 模型参数=null
2025-05-19 15:36:02.642 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - 请求Content-Type: multipart/form-data;boundary=--------------------------420882621970785954333409
2025-05-19 15:36:02.643 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - 收集到的完整参数: question="null", apiUrl="null", modelName="null", multiTurn=false
2025-05-19 15:36:02.646 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - Processing request for user ID: 689258T
2025-05-19 15:36:02.646 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - Processing file with circuit breaker: fileName=新文件 17.txt, question=
2025-05-19 15:36:02.649 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.config.ReactiveFileProcessor - Processing file: 新文件 17.txt, content-type: text/plain
2025-05-19 15:36:02.655 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - PARAM TRACE [689258T]: 尝试查找匹配配置 - 参数: apiUrl=null, modelName=null
2025-05-19 15:36:02.667 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 查询配置 - userId=689258T
2025-05-19 15:36:02.668 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 排序方式 - 按ID降序
2025-05-19 15:36:02.668 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 限制结果数 - LIMIT 1
2025-05-19 15:36:02.733 [http-nio-8080-exec-2] DEBUG com.bgpay.bgai.mapper.ApiConfigMapper.selectList - ==>  Preparing: SELECT id,api_url,api_key,model_name,user_id FROM api_config WHERE (user_id = ?) ORDER BY id DESC LIMIT 1
2025-05-19 15:36:02.735 [http-nio-8080-exec-2] DEBUG com.bgpay.bgai.mapper.ApiConfigMapper.selectList - ==> Parameters: 689258T(String)
2025-05-19 15:36:02.747 [http-nio-8080-exec-2] DEBUG com.bgpay.bgai.mapper.ApiConfigMapper.selectList - <==      Total: 1
2025-05-19 15:36:02.747 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 查询结果 - 找到配置: id=2, modelName=deepseek-chat
2025-05-19 15:36:02.747 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - PARAM TRACE [689258T]: 找到匹配配置 - apiUrl=https://api.deepseek.com/chat/completions, modelName=deepseek-chat (原始请求: null)
2025-05-19 15:36:02.747 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - API config resolved: url=https://api.deepseek.com/chat/completions, model=deepseek-chat
2025-05-19 15:36:02.764 [Thread-49] INFO  com.bgpay.bgai.config.ReactiveFileProcessor - File processed successfully: size=2153 bytes
2025-05-19 15:36:02.768 [Thread-49] INFO  com.bgpay.bgai.controller.ReactiveChatController - Content processed, length: 2192
2025-05-19 15:36:02.774 [Thread-49] INFO  io.seata.tm.TransactionManagerHolder - TransactionManager Singleton io.seata.tm.DefaultTransactionManager@5b9e1ea7
2025-05-19 15:36:02.787 [Thread-49] INFO  io.seata.tm.api.DefaultGlobalTransaction - Begin new global transaction [seata-server:8091:18666493999071248]
2025-05-19 15:36:02.789 [Thread-49] INFO  c.b.bgai.interceptor.SeataTransactionInterceptor - 准备记录分布式事务开始: XID=seata-server:8091:18666493999071248, 业务=com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive, 路径=, IP=, 用户=system
2025-05-19 15:36:02.806 [Thread-49] INFO  c.b.bgai.service.impl.TransactionLogServiceImpl - 记录分布式事务开始: XID=seata-server:8091:18666493999071248, 业务=com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive
2025-05-19 15:36:02.813 [Thread-49] DEBUG com.bgpay.bgai.mapper.TransactionLogMapper.insert - ==>  Preparing: INSERT INTO transaction_log ( xid, transaction_name, transaction_mode, status, request_path, source_ip, start_time, user_id, create_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-05-19 15:36:02.817 [Thread-49] DEBUG com.bgpay.bgai.mapper.TransactionLogMapper.insert - ==> Parameters: seata-server:8091:18666493999071248(String), com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive(String), AT(String), ACTIVE(String), (String), (String), 2025-05-19T15:36:02.806857800(LocalDateTime), system(String), 2025-05-19T15:36:02.806857800(LocalDateTime)
2025-05-19 15:36:03.328 [Thread-49] DEBUG com.bgpay.bgai.mapper.TransactionLogMapper.insert - <==    Updates: 1
2025-05-19 15:36:03.359 [Thread-49] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:18666493999071248, branchId:18666493999071249, lockKeys:transaction_log:9
2025-05-19 15:36:03.382 [Thread-49] WARN  i.s.c.l.EnhancedServiceLoader$InnerEnhancedServiceLoader - Load [io.seata.rm.datasource.undo.parser.ProtostuffUndoLogParser] class fail: io/protostuff/runtime/IdStrategy
2025-05-19 15:36:03.491 [Thread-49] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:18666493999071248, branchId:18666493999071250, lockKeys:transaction_log:9;undo_log:33
2025-05-19 15:36:03.531 [Thread-49] INFO  c.b.bgai.interceptor.SeataTransactionInterceptor - 开始分布式事务: XID=seata-server:8091:18666493999071248, 方法=com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive
2025-05-19 15:36:03.548 [Thread-49] INFO  org.reflections.Reflections - Processing reactive request: content length=2192, apiUrl=https://api.deepseek.com/chat/completions, modelName=deepseek-chat, userId=689258T, multiTurn=false
2025-05-19 15:36:03.582 [Thread-49] INFO  com.bgpay.bgai.transaction.TransactionCoordinator - Transaction prepared for user 689258T: chatCompletionId=chat-76e1401b-3256-4f7b-addf-f70485183661
2025-05-19 15:36:03.585 [Thread-49] INFO  org.reflections.Reflections - Generated request JSON with 2PC transaction: {"stream":false,"max_tokens":2000,"temperature":1.0,"messages":[{"content":"You are a helpful assist...
2025-05-19 15:36:03.611 [Thread-49] INFO  c.b.bgai.service.impl.TransactionLogServiceImpl - 记录分布式事务结束: XID=seata-server:8091:18666493999071248, 状态=COMMITTED
2025-05-19 15:36:03.613 [Thread-49] DEBUG c.b.bgai.mapper.TransactionLogMapper.selectList - ==>  Preparing: SELECT id,xid,branch_id,transaction_name,transaction_mode,status,request_path,source_ip,start_time,end_time,user_id,extra_data,create_time,update_time FROM transaction_log WHERE (xid = ?) LIMIT 1
2025-05-19 15:36:03.615 [Thread-49] DEBUG c.b.bgai.mapper.TransactionLogMapper.selectList - ==> Parameters: seata-server:8091:18666493999071248(String)
2025-05-19 15:36:03.623 [Thread-49] DEBUG c.b.bgai.mapper.TransactionLogMapper.selectList - <==      Total: 1
2025-05-19 15:36:03.627 [Thread-49] DEBUG c.b.bgai.mapper.TransactionLogMapper.updateById - ==>  Preparing: UPDATE transaction_log SET xid=?, transaction_name=?, transaction_mode=?, status=?, request_path=?, source_ip=?, start_time=?, end_time=?, user_id=?, extra_data=?, create_time=?, update_time=? WHERE id=?
2025-05-19 15:36:03.635 [Thread-49] DEBUG c.b.bgai.mapper.TransactionLogMapper.updateById - ==> Parameters: seata-server:8091:18666493999071248(String), com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive(String), AT(String), COMMITTED(String), (String), (String), 2025-05-19T15:36:03(LocalDateTime), 2025-05-19T15:36:03.623746100(LocalDateTime), system(String), {"duration":73,"result":"success"}(String), 2025-05-19T15:36:03(LocalDateTime), 2025-05-19T15:36:03.623746100(LocalDateTime), 9(Long)
2025-05-19 15:36:03.693 [Thread-49] DEBUG c.b.bgai.mapper.TransactionLogMapper.updateById - <==    Updates: 1
2025-05-19 15:36:03.708 [Thread-49] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:18666493999071248, branchId:18666493999071251, lockKeys:transaction_log:9
2025-05-19 15:36:03.743 [Thread-49] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:18666493999071248, branchId:18666493999071252, lockKeys:transaction_log:9;undo_log:35
2025-05-19 15:36:03.785 [Thread-49] INFO  c.b.bgai.interceptor.SeataTransactionInterceptor - 分布式事务成功完成: XID=seata-server:8091:18666493999071248, 耗时=73ms
2025-05-19 15:36:03.785 [Thread-49] INFO  io.seata.tm.api.DefaultGlobalTransaction - transaction seata-server:8091:18666493999071248 will be commit
2025-05-19 15:36:03.800 [Thread-49] INFO  io.seata.tm.api.DefaultGlobalTransaction - transaction end, xid = seata-server:8091:18666493999071248
2025-05-19 15:36:03.800 [Thread-49] INFO  io.seata.tm.api.DefaultGlobalTransaction - [seata-server:8091:18666493999071248] commit status: Committed
2025-05-19 15:36:04.536 [rpcDispatch_RMROLE_1_1_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:18666493999071248', branchId=18666493999071249, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false,"skipCheckLock":true}'}
2025-05-19 15:36:04.537 [rpcDispatch_RMROLE_1_1_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:18666493999071248 18666493999071249 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false,"skipCheckLock":true}
2025-05-19 15:36:04.538 [rpcDispatch_RMROLE_1_1_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-19 15:36:04.557 [rpcDispatch_RMROLE_1_2_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:18666493999071248', branchId=18666493999071250, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false,"skipCheckLock":true}'}
2025-05-19 15:36:04.557 [rpcDispatch_RMROLE_1_2_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:18666493999071248 18666493999071250 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false,"skipCheckLock":true}
2025-05-19 15:36:04.557 [rpcDispatch_RMROLE_1_2_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-19 15:36:04.566 [rpcDispatch_RMROLE_1_3_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:18666493999071248', branchId=18666493999071251, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false}'}
2025-05-19 15:36:04.567 [rpcDispatch_RMROLE_1_3_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:18666493999071248 18666493999071251 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false}
2025-05-19 15:36:04.567 [rpcDispatch_RMROLE_1_3_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-19 15:36:04.577 [rpcDispatch_RMROLE_1_4_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:18666493999071248', branchId=18666493999071252, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false}'}
2025-05-19 15:36:04.577 [rpcDispatch_RMROLE_1_4_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:18666493999071248 18666493999071252 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false}
2025-05-19 15:36:04.577 [rpcDispatch_RMROLE_1_4_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-19 15:36:31.014 [reactor-http-nio-2] INFO  org.reflections.Reflections - Raw response received, length: 2394
2025-05-19 15:36:31.019 [reactor-http-nio-2] WARN  org.reflections.Reflections - Received different chatCompletionId from response: 982d4b63-ebbb-4b6d-baa6-d16d2a25e0bf vs prepared: chat-76e1401b-3256-4f7b-addf-f70485183661
2025-05-19 15:36:31.036 [reactor-http-nio-2] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - ==>  Preparing: INSERT INTO chat_completions ( object, created, model, system_fingerprint, api_key ) VALUES ( ?, ?, ?, ?, ? )
2025-05-19 15:36:31.037 [reactor-http-nio-2] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - ==> Parameters: chat.completion(String), 1747640191035(Long), deepseek-chat(String), 689258T(String), chat-76e1401b-3256-4f7b-addf-f70485183661(String)
2025-05-19 15:36:31.051 [reactor-http-nio-2] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - <==    Updates: 1
2025-05-19 15:36:31.051 [reactor-http-nio-2] INFO  com.bgpay.bgai.transaction.TransactionCoordinator - Transaction committed for user 689258T: chatCompletionId=chat-76e1401b-3256-4f7b-addf-f70485183661
2025-05-19 15:36:31.073 [FileWrite-1] INFO  com.bgpay.bgai.service.deepseek.FileWriterService - Successfully wrote content to: \var\data\ai_responses\b9a917b4-0eb0-4272-a622-22e02b1668ac.txt
2025-05-19 15:36:31.084 [boundedElastic-1] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - ==>  Preparing: INSERT INTO chat_completions ( object, created, model, system_fingerprint, api_key ) VALUES ( ?, ?, ?, ?, ? )
2025-05-19 15:36:31.084 [boundedElastic-1] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - ==> Parameters: chat.completion(String), 1747640164(Long), deepseek-chat(String), fp_8802369eaa_prod0425fp8(String), chat-76e1401b-3256-4f7b-addf-f70485183661(String)
2025-05-19 15:36:31.096 [boundedElastic-1] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - <==    Updates: 1
2025-05-19 15:36:31.122 [boundedElastic-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.insert - ==>  Preparing: INSERT INTO usage_info ( chat_completion_id, prompt_tokens, completion_tokens, total_tokens, prompt_tokens_cached, completion_reasoning_tokens, prompt_cache_hit_tokens, prompt_cache_miss_tokens, created_at, model_type ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-05-19 15:36:31.123 [boundedElastic-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.insert - ==> Parameters: chat-76e1401b-3256-4f7b-addf-f70485183661(String), 721(Integer), 454(Integer), 1175(Integer), 704(Integer), 0(Integer), 0(Integer), 17(Integer), 2025-05-19T15:36:31.113188100(LocalDateTime), deepseek-chat(String)
2025-05-19 15:36:31.137 [boundedElastic-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.insert - <==    Updates: 1
2025-05-19 15:36:31.154 [boundedElastic-1] INFO  org.reflections.Reflections - Completion data saved synchronously for chatCompletionId: chat-76e1401b-3256-4f7b-addf-f70485183661
2025-05-19 15:36:31.160 [boundedElastic-2] INFO  org.reflections.Reflections - 开始发送账单消息，chatCompletionId: chat-76e1401b-3256-4f7b-addf-f70485183661, userId: 689258T
2025-05-19 15:36:31.219 [boundedElastic-2] INFO  org.reflections.Reflections - 账单消息发送成功，chatCompletionId: chat-76e1401b-3256-4f7b-addf-f70485183661, userId: 689258T
2025-05-19 15:36:31.223 [boundedElastic-1] INFO  org.reflections.Reflections - Complete processing chain completed: Based on the provided configuration file, this appears to be a Seata (Simple Extensible Autonomous Transaction Architecture) configuration for distributed transaction management. Here's an analysis of the key configurations:

### Basic Configuration
- `enabled: true` - Seata is enabled
- `application-id: bgai` - Application identifier
- `tx-service-group: bgai-tx-group` - Transaction service group name
- `enable-auto-data-source-proxy: true` - Enables automatic data source proxy

### Client Configuration
1. **Resource Manager (RM)**
   - Async commit buffer limit: 10,000
   - Report retry count: 5
   - Lock settings: 10ms retry interval, 30 retry times
   - Saga-related configurations for compensation patterns

2. **Transaction Manager (TM)**
   - Commit/rollback retry count: 5
   - Default global transaction timeout: 60,000ms (1 minute)
   - Degrade check settings

3. **Undo Log**
   - Uses Jackson for log serialization
   - Only tracks updated columns
   - Uses table `undo_log` for logging

### Service Configuration
- Maps transaction group `bgai-tx-group` to default cluster
- Default server address: `8.133.246.113:8091`
- Global transactions are enabled

### Transport Configuration
- Uses TCP/NIO for communication
- Heartbeat enabled
- Thread pool configurations for Netty
- Client batch sending enabled

### Saga Configuration
- Saga mode is enabled (`saga.enabled: true`)
- State machine configurations:
  - Table prefix: `seata_`
  - Thread pool settings (core: 1, max: 20)
  - Timeout settings (60s for operations, 300s for service invokes)
  - Auto-registers resources from JSON files in `classpath*:seata/saga/statelang/**/*.json`

This configuration sets up Seata for distributed transaction management with Saga pattern support, using a remote Seata server at the specified IP address, with detailed tuning parameters for transaction handling, retries, and timeouts.
2025-05-19 15:36:31.224 [boundedElastic-1] INFO  com.bgpay.bgai.controller.ReactiveChatController - Processed response for user 689258T, content length: 1897
2025-05-19 15:36:49.727 [pool-5-thread-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.selectCount - ==>  Preparing: SELECT COUNT( * ) AS total FROM usage_info WHERE (chat_completion_id = ?)
2025-05-19 15:36:49.727 [pool-5-thread-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.selectCount - ==> Parameters: chat-210e7da5-eec0-4649-80a5-61eba26cb8ea(String)
2025-05-19 15:36:49.734 [pool-5-thread-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.selectCount - <==      Total: 1
2025-05-19 15:36:49.916 [ConsumeMessageThread_billing-consumer-group_1] INFO  c.bgpay.bgai.service.mq.RocketMQBillingServiceImpl - Output price config priceVersion: 1
2025-05-19 15:36:49.918 [ConsumeMessageThread_billing-consumer-group_1] DEBUG com.bgpay.bgai.mapper.UsageRecordMapper.insert - ==>  Preparing: INSERT INTO usage_record ( model_type, chat_completion_id, user_id, input_cost, output_cost, price_version, calculated_at ) VALUES ( ?, ?, ?, ?, ?, ?, ? )
2025-05-19 15:36:49.919 [ConsumeMessageThread_billing-consumer-group_1] DEBUG com.bgpay.bgai.mapper.UsageRecordMapper.insert - ==> Parameters: deepseek-chat(String), chat-210e7da5-eec0-4649-80a5-61eba26cb8ea(String), 689258T(String), 0.0000(BigDecimal), 0.0031(BigDecimal), 1(Integer), 2025-05-19T15:36:49.916332800(LocalDateTime)
2025-05-19 15:36:49.942 [ConsumeMessageThread_billing-consumer-group_1] DEBUG com.bgpay.bgai.mapper.UsageRecordMapper.insert - <==    Updates: 1
2025-05-19 15:36:49.953 [ConsumeMessageThread_billing-consumer-group_1] INFO  c.bgpay.bgai.service.mq.RocketMQBillingServiceImpl - Message consumed: 2408820C75288342B4869B724B724BF0700836BAF30C600A891E0000
2025-05-19 15:36:57.819 [Thread-7] WARN  com.alibaba.nacos.common.notify.NotifyCenter - [NotifyCenter] Start destroying Publisher
2025-05-19 15:36:57.820 [Thread-1] WARN  c.alibaba.nacos.common.http.HttpClientBeanHolder - [HttpClientBeanHolder] Start destroying common HttpClient
2025-05-19 15:36:57.820 [Thread-7] WARN  com.alibaba.nacos.common.notify.NotifyCenter - [NotifyCenter] Destruction of the end
2025-05-19 15:36:57.820 [Thread-1] WARN  c.alibaba.nacos.common.http.HttpClientBeanHolder - [HttpClientBeanHolder] Destruction of the end
2025-05-19 15:36:57.839 [NettyClientSelector_TMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - channel inactive: [id: 0x02c8a9d9, L:/192.168.86.8:59556 ! R:/8.133.246.113:8091]
2025-05-19 15:36:57.839 [NettyClientSelector_TMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - return to pool, rm channel:[id: 0x02c8a9d9, L:/192.168.86.8:59556 ! R:/8.133.246.113:8091]
2025-05-19 15:36:57.840 [NettyClientSelector_TMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - channel valid false,channel:[id: 0x02c8a9d9, L:/192.168.86.8:59556 ! R:/8.133.246.113:8091]
2025-05-19 15:36:57.840 [NettyClientSelector_TMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - will destroy channel:[id: 0x02c8a9d9, L:/192.168.86.8:59556 ! R:/8.133.246.113:8091]
2025-05-19 15:36:57.840 [NettyClientSelector_TMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0x02c8a9d9, L:/192.168.86.8:59556 ! R:/8.133.246.113:8091]) will closed
2025-05-19 15:36:57.840 [NettyClientSelector_TMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0x02c8a9d9, L:/192.168.86.8:59556 ! R:/8.133.246.113:8091]) will closed
2025-05-19 15:36:57.841 [NettyClientSelector_RMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - channel inactive: [id: 0xea376fac, L:/192.168.86.8:59565 ! R:/8.133.246.113:8091]
2025-05-19 15:36:57.841 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - return to pool, rm channel:[id: 0xea376fac, L:/192.168.86.8:59565 ! R:/8.133.246.113:8091]
2025-05-19 15:36:57.841 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - channel valid false,channel:[id: 0xea376fac, L:/192.168.86.8:59565 ! R:/8.133.246.113:8091]
2025-05-19 15:36:57.841 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - will destroy channel:[id: 0xea376fac, L:/192.168.86.8:59565 ! R:/8.133.246.113:8091]
2025-05-19 15:36:57.841 [NettyClientSelector_RMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0xea376fac, L:/192.168.86.8:59565 ! R:/8.133.246.113:8091]) will closed
2025-05-19 15:36:57.841 [NettyClientSelector_RMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0xea376fac, L:/192.168.86.8:59565 ! R:/8.133.246.113:8091]) will closed
2025-05-19 15:36:57.844 [SpringContextShutdownHook] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - De-registering from Nacos Server now...
2025-05-19 15:36:57.844 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - [DEREGISTER-SERVICE] d750d92e-152f-4055-a641-3bc9dda85a29 deregistering service bgtech-ai with instance: Instance{instanceId='null', ip='192.168.86.8', port=8080, weight=1.0, healthy=true, enabled=true, ephemeral=true, clusterName='DEFAULT', serviceName='null', metadata={}}
2025-05-19 15:36:57.852 [SpringContextShutdownHook] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - De-registration finished.
2025-05-19 15:36:57.853 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.cache.ServiceInfoHolder do shutdown begin
2025-05-19 15:36:57.853 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.backups.FailoverReactor do shutdown begin
2025-05-19 15:36:57.853 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.backups.FailoverReactor do shutdown stop
2025-05-19 15:36:57.853 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.cache.ServiceInfoHolder do shutdown stop
2025-05-19 15:36:57.853 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.NamingClientProxyDelegate do shutdown begin
2025-05-19 15:36:57.853 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServiceInfoUpdateService do shutdown begin
2025-05-19 15:36:57.853 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServiceInfoUpdateService do shutdown stop
2025-05-19 15:36:57.853 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServerListManager do shutdown begin
2025-05-19 15:36:57.853 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Start destroying NacosRestTemplate
2025-05-19 15:36:57.854 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Destruction of the end
2025-05-19 15:36:57.854 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServerListManager do shutdown stop
2025-05-19 15:36:57.854 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.http.NamingHttpClientProxy do shutdown begin
2025-05-19 15:36:57.854 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Start destroying NacosRestTemplate
2025-05-19 15:36:57.854 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Destruction of the end
2025-05-19 15:36:57.855 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.http.NamingHttpClientProxy do shutdown stop
2025-05-19 15:36:57.856 [SpringContextShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Shutdown rpc client, set status to shutdown
2025-05-19 15:36:57.857 [SpringContextShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Shutdown client event executor java.util.concurrent.ScheduledThreadPoolExecutor@1501b99a[Running, pool size = 2, active threads = 2, queued tasks = 0, completed tasks = 0]
2025-05-19 15:36:57.857 [SpringContextShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Close current connection 1747640157699_139.227.195.203_42614
2025-05-19 15:36:57.874 [nacos-grpc-client-executor-8.133.246.113-25] WARN  c.a.nacos.common.remote.client.grpc.GrpcClient - [1747640157699_139.227.195.203_42614]Ignore error event,isRunning:false,isAbandon=false
2025-05-19 15:36:57.877 [SpringContextShutdownHook] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - Shutdown grpc executor java.util.concurrent.ThreadPoolExecutor@6882884b[Running, pool size = 5, active threads = 0, queued tasks = 0, completed tasks = 26]
2025-05-19 15:36:57.878 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - Shutdown grpc redo service executor java.util.concurrent.ScheduledThreadPoolExecutor@15cf976f[Running, pool size = 1, active threads = 0, queued tasks = 1, completed tasks = 20]
2025-05-19 15:36:57.879 [SpringContextShutdownHook] INFO  c.a.n.client.auth.ram.identify.CredentialWatcher - [null] CredentialWatcher is stopped
2025-05-19 15:36:57.879 [SpringContextShutdownHook] INFO  c.a.n.client.auth.ram.identify.CredentialService - [null] CredentialService is freed
2025-05-19 15:36:57.888 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.NamingClientProxyDelegate do shutdown stop
2025-05-19 15:36:57.922 [SpringContextShutdownHook] DEBUG com.bgpay.bgai.config.AsyncConfig$1 - Shutting down ExecutorService 'blockingExecutor'
2025-05-19 15:37:00.007 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:10909] result: true
2025-05-19 15:37:00.007 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:10911] result: true
2025-05-19 15:37:00.007 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:9876] result: true
2025-05-19 15:37:00.024 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:10911] result: true
2025-05-19 15:37:00.024 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:9876] result: true
2025-05-19 15:37:00.135 [SpringContextShutdownHook] INFO  o.s.orm.jpa.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-05-19 15:37:00.136 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-2} closing ...
2025-05-19 15:37:00.141 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-2} closed
2025-05-19 15:37:00.141 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} closing ...
2025-05-19 15:37:00.142 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} closed
2025-05-25 01:33:10.622 [main] WARN  com.alibaba.nacos.client.logging.NacosLogging - Load Logback Configuration of Nacos fail, message: Could not initialize Logback Nacos logging from classpath:nacos-logback.xml
2025-05-25 01:33:10.623 [main] INFO  com.bgpay.bgai.BgaiApplication - The following 1 profile is active: "dev"
2025-05-25 01:33:12.074 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-05-25 01:33:12.076 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-05-25 01:33:12.104 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 21 ms. Found 0 JPA repository interfaces.
2025-05-25 01:33:12.117 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-05-25 01:33:12.117 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-05-25 01:33:12.129 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 4 ms. Found 0 Redis repository interfaces.
2025-05-25 01:33:12.703 [main] INFO  io.seata.config.ConfigurationFactory - load Configuration from :Spring Configuration
2025-05-25 01:33:12.711 [main] INFO  io.seata.config.ConfigurationFactory - load Configuration from :Spring Configuration
2025-05-25 01:33:12.717 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Initializing Global Transaction Clients ... 
2025-05-25 01:33:12.718 [main] WARN  i.seata.spring.annotation.GlobalTransactionScanner - the default value of seata.tx-service-group: my_test_tx_group has already changed to default_tx_group since Seata 1.5, please change your default configuration as soon as possible and we don't recommend you to use default tx-service-group's value provided by seata
2025-05-25 01:33:12.825 [main] INFO  io.seata.core.rpc.netty.NettyClientBootstrap - NettyClientBootstrap has started
2025-05-25 01:33:12.826 [main] INFO  io.seata.discovery.registry.RegistryFactory - use registry center type: file
2025-05-25 01:33:12.838 [main] ERROR io.seata.core.rpc.netty.NettyClientChannelManager - Failed to get available servers: service.vgroupMapping.my_test_tx_group configuration item is required
io.seata.config.exception.ConfigNotFoundException: service.vgroupMapping.my_test_tx_group configuration item is required
	at io.seata.discovery.registry.FileRegistryServiceImpl.lookup(FileRegistryServiceImpl.java:85)
	at io.seata.core.rpc.netty.NettyClientChannelManager.getAvailServerList(NettyClientChannelManager.java:247)
	at io.seata.core.rpc.netty.NettyClientChannelManager.reconnect(NettyClientChannelManager.java:168)
	at io.seata.core.rpc.netty.TmNettyRemotingClient.init(TmNettyRemotingClient.java:198)
	at io.seata.tm.TMClient.init(TMClient.java:47)
	at io.seata.spring.annotation.GlobalTransactionScanner.initClient(GlobalTransactionScanner.java:223)
	at io.seata.spring.annotation.GlobalTransactionScanner.afterPropertiesSet(GlobalTransactionScanner.java:537)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.invokeInitMethods(AbstractAutowireCapableBeanFactory.java:1817)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1766)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:598)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:520)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:325)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:234)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:323)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:204)
	at org.springframework.context.support.PostProcessorRegistrationDelegate.registerBeanPostProcessors(PostProcessorRegistrationDelegate.java:261)
	at org.springframework.context.support.AbstractApplicationContext.registerBeanPostProcessors(AbstractApplicationContext.java:796)
	at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:600)
	at org.springframework.boot.web.reactive.context.ReactiveWebServerApplicationContext.refresh(ReactiveWebServerApplicationContext.java:66)
	at org.springframework.boot.SpringApplication.refresh(SpringApplication.java:733)
	at org.springframework.boot.SpringApplication.refreshContext(SpringApplication.java:435)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:311)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1301)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1290)
	at com.bgpay.bgai.BgaiApplication.main(BgaiApplication.java:34)
2025-05-25 01:33:12.840 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Transaction Manager Client is initialized. applicationId[bgtech-ai] txServiceGroup[my_test_tx_group]
2025-05-25 01:33:12.854 [main] INFO  io.seata.rm.datasource.AsyncWorker - Async Commit Buffer Limit: 10000
2025-05-25 01:33:12.855 [main] INFO  io.seata.rm.datasource.xa.ResourceManagerXA - ResourceManagerXA init ...
2025-05-25 01:33:12.865 [main] INFO  io.seata.core.rpc.netty.NettyClientBootstrap - NettyClientBootstrap has started
2025-05-25 01:33:12.866 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Resource Manager is initialized. applicationId[bgtech-ai] txServiceGroup[my_test_tx_group]
2025-05-25 01:33:12.866 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Global Transaction Clients are initialized. 
2025-05-25 01:33:14.031 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat initialized with port(s): 8080 (http)
2025-05-25 01:33:14.041 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - The ["http-nio-8080"] connector has been configured to support HTTP upgrade to [h2c]
2025-05-25 01:33:14.041 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - Initializing ProtocolHandler ["http-nio-8080"]
2025-05-25 01:33:14.042 [main] INFO  org.apache.catalina.core.StandardService - Starting service [Tomcat]
2025-05-25 01:33:14.042 [main] INFO  org.apache.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.15]
2025-05-25 01:33:14.506 [main] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} inited
2025-05-25 01:33:14.778 [main] ERROR io.seata.core.rpc.netty.NettyClientChannelManager - Failed to get available servers: service.vgroupMapping.my_test_tx_group configuration item is required
io.seata.config.exception.ConfigNotFoundException: service.vgroupMapping.my_test_tx_group configuration item is required
	at io.seata.discovery.registry.FileRegistryServiceImpl.lookup(FileRegistryServiceImpl.java:85)
	at io.seata.core.rpc.netty.NettyClientChannelManager.getAvailServerList(NettyClientChannelManager.java:247)
	at io.seata.core.rpc.netty.NettyClientChannelManager.reconnect(NettyClientChannelManager.java:168)
	at io.seata.core.rpc.netty.RmNettyRemotingClient.registerResource(RmNettyRemotingClient.java:213)
	at io.seata.rm.AbstractResourceManager.registerResource(AbstractResourceManager.java:128)
	at io.seata.rm.datasource.DataSourceManager.registerResource(DataSourceManager.java:90)
	at io.seata.rm.DefaultResourceManager.registerResource(DefaultResourceManager.java:114)
	at io.seata.rm.datasource.DataSourceProxy.init(DataSourceProxy.java:100)
	at io.seata.rm.datasource.DataSourceProxy.<init>(DataSourceProxy.java:82)
	at io.seata.rm.datasource.DataSourceProxy.<init>(DataSourceProxy.java:67)
	at io.seata.spring.annotation.datasource.SeataAutoDataSourceProxyCreator.buildProxy(SeataAutoDataSourceProxyCreator.java:125)
	at io.seata.spring.annotation.datasource.SeataAutoDataSourceProxyCreator.wrapIfNecessary(SeataAutoDataSourceProxyCreator.java:99)
	at org.springframework.aop.framework.autoproxy.AbstractAutoProxyCreator.postProcessAfterInitialization(AbstractAutoProxyCreator.java:318)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.applyBeanPostProcessorsAfterInitialization(AbstractAutowireCapableBeanFactory.java:434)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1773)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:598)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:520)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:325)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:234)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:323)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:199)
	at org.springframework.beans.factory.config.DependencyDescriptor.resolveCandidate(DependencyDescriptor.java:254)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.doResolveDependency(DefaultListableBeanFactory.java:1417)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveDependency(DefaultListableBeanFactory.java:1337)
	at org.springframework.beans.factory.support.ConstructorResolver.resolveAutowiredArgument(ConstructorResolver.java:910)
	at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:788)
	at org.springframework.beans.factory.support.ConstructorResolver.instantiateUsingFactoryMethod(ConstructorResolver.java:545)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.instantiateUsingFactoryMethod(AbstractAutowireCapableBeanFactory.java:1332)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:1162)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:560)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:520)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:325)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:234)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:323)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:199)
	at org.springframework.beans.factory.config.DependencyDescriptor.resolveCandidate(DependencyDescriptor.java:254)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.doResolveDependency(DefaultListableBeanFactory.java:1417)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveDependency(DefaultListableBeanFactory.java:1337)
	at org.springframework.beans.factory.support.ConstructorResolver.resolveAutowiredArgument(ConstructorResolver.java:910)
	at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:788)
	at org.springframework.beans.factory.support.ConstructorResolver.autowireConstructor(ConstructorResolver.java:240)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.autowireConstructor(AbstractAutowireCapableBeanFactory.java:1352)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:1189)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:560)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:520)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:325)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:234)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:323)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:199)
	at org.springframework.beans.factory.support.ConstructorResolver.instantiateUsingFactoryMethod(ConstructorResolver.java:412)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.instantiateUsingFactoryMethod(AbstractAutowireCapableBeanFactory.java:1332)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:1162)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:560)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:520)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:325)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:234)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:323)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:199)
	at org.springframework.context.support.AbstractApplicationContext.getBean(AbstractApplicationContext.java:1166)
	at org.springframework.context.support.AbstractApplicationContext.finishBeanFactoryInitialization(AbstractApplicationContext.java:940)
	at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:616)
	at org.springframework.boot.web.reactive.context.ReactiveWebServerApplicationContext.refresh(ReactiveWebServerApplicationContext.java:66)
	at org.springframework.boot.SpringApplication.refresh(SpringApplication.java:733)
	at org.springframework.boot.SpringApplication.refreshContext(SpringApplication.java:435)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:311)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1301)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1290)
	at com.bgpay.bgai.BgaiApplication.main(BgaiApplication.java:34)
2025-05-25 01:33:14.780 [main] INFO  i.s.s.a.datasource.SeataAutoDataSourceProxyCreator - Auto proxy data source 'masterDataSource' by 'AT' mode.
2025-05-25 01:33:14.855 [main] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-2} inited
2025-05-25 01:33:14.951 [main] ERROR io.seata.core.rpc.netty.NettyClientChannelManager - Failed to get available servers: service.vgroupMapping.my_test_tx_group configuration item is required
io.seata.config.exception.ConfigNotFoundException: service.vgroupMapping.my_test_tx_group configuration item is required
	at io.seata.discovery.registry.FileRegistryServiceImpl.lookup(FileRegistryServiceImpl.java:85)
	at io.seata.core.rpc.netty.NettyClientChannelManager.getAvailServerList(NettyClientChannelManager.java:247)
	at io.seata.core.rpc.netty.NettyClientChannelManager.reconnect(NettyClientChannelManager.java:168)
	at io.seata.core.rpc.netty.RmNettyRemotingClient.registerResource(RmNettyRemotingClient.java:213)
	at io.seata.rm.AbstractResourceManager.registerResource(AbstractResourceManager.java:128)
	at io.seata.rm.datasource.DataSourceManager.registerResource(DataSourceManager.java:90)
	at io.seata.rm.DefaultResourceManager.registerResource(DefaultResourceManager.java:114)
	at io.seata.rm.datasource.DataSourceProxy.init(DataSourceProxy.java:100)
	at io.seata.rm.datasource.DataSourceProxy.<init>(DataSourceProxy.java:82)
	at io.seata.rm.datasource.DataSourceProxy.<init>(DataSourceProxy.java:67)
	at io.seata.spring.annotation.datasource.SeataAutoDataSourceProxyCreator.buildProxy(SeataAutoDataSourceProxyCreator.java:125)
	at io.seata.spring.annotation.datasource.SeataAutoDataSourceProxyCreator.wrapIfNecessary(SeataAutoDataSourceProxyCreator.java:99)
	at org.springframework.aop.framework.autoproxy.AbstractAutoProxyCreator.postProcessAfterInitialization(AbstractAutoProxyCreator.java:318)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.applyBeanPostProcessorsAfterInitialization(AbstractAutowireCapableBeanFactory.java:434)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1773)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:598)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:520)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:325)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:234)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:323)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:199)
	at org.springframework.beans.factory.config.DependencyDescriptor.resolveCandidate(DependencyDescriptor.java:254)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.doResolveDependency(DefaultListableBeanFactory.java:1417)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveDependency(DefaultListableBeanFactory.java:1337)
	at org.springframework.beans.factory.support.ConstructorResolver.resolveAutowiredArgument(ConstructorResolver.java:910)
	at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:788)
	at org.springframework.beans.factory.support.ConstructorResolver.instantiateUsingFactoryMethod(ConstructorResolver.java:545)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.instantiateUsingFactoryMethod(AbstractAutowireCapableBeanFactory.java:1332)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:1162)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:560)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:520)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:325)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:234)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:323)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:199)
	at org.springframework.beans.factory.config.DependencyDescriptor.resolveCandidate(DependencyDescriptor.java:254)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.doResolveDependency(DefaultListableBeanFactory.java:1417)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveDependency(DefaultListableBeanFactory.java:1337)
	at org.springframework.beans.factory.support.ConstructorResolver.resolveAutowiredArgument(ConstructorResolver.java:910)
	at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:788)
	at org.springframework.beans.factory.support.ConstructorResolver.autowireConstructor(ConstructorResolver.java:240)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.autowireConstructor(AbstractAutowireCapableBeanFactory.java:1352)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:1189)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:560)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:520)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:325)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:234)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:323)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:199)
	at org.springframework.beans.factory.support.ConstructorResolver.instantiateUsingFactoryMethod(ConstructorResolver.java:412)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.instantiateUsingFactoryMethod(AbstractAutowireCapableBeanFactory.java:1332)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:1162)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:560)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:520)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:325)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:234)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:323)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:199)
	at org.springframework.context.support.AbstractApplicationContext.getBean(AbstractApplicationContext.java:1166)
	at org.springframework.context.support.AbstractApplicationContext.finishBeanFactoryInitialization(AbstractApplicationContext.java:940)
	at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:616)
	at org.springframework.boot.web.reactive.context.ReactiveWebServerApplicationContext.refresh(ReactiveWebServerApplicationContext.java:66)
	at org.springframework.boot.SpringApplication.refresh(SpringApplication.java:733)
	at org.springframework.boot.SpringApplication.refreshContext(SpringApplication.java:435)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:311)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1301)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1290)
	at com.bgpay.bgai.BgaiApplication.main(BgaiApplication.java:34)
2025-05-25 01:33:14.951 [main] INFO  i.s.s.a.datasource.SeataAutoDataSourceProxyCreator - Auto proxy data source 'slaveDataSource' by 'AT' mode.
2025-05-25 01:33:14.975 [main] ERROR io.seata.core.rpc.netty.NettyClientChannelManager - Failed to get available servers: service.vgroupMapping.my_test_tx_group configuration item is required
io.seata.config.exception.ConfigNotFoundException: service.vgroupMapping.my_test_tx_group configuration item is required
	at io.seata.discovery.registry.FileRegistryServiceImpl.lookup(FileRegistryServiceImpl.java:85)
	at io.seata.core.rpc.netty.NettyClientChannelManager.getAvailServerList(NettyClientChannelManager.java:247)
	at io.seata.core.rpc.netty.NettyClientChannelManager.reconnect(NettyClientChannelManager.java:168)
	at io.seata.core.rpc.netty.RmNettyRemotingClient.registerResource(RmNettyRemotingClient.java:213)
	at io.seata.rm.AbstractResourceManager.registerResource(AbstractResourceManager.java:128)
	at io.seata.rm.datasource.DataSourceManager.registerResource(DataSourceManager.java:90)
	at io.seata.rm.DefaultResourceManager.registerResource(DefaultResourceManager.java:114)
	at io.seata.rm.datasource.DataSourceProxy.init(DataSourceProxy.java:100)
	at io.seata.rm.datasource.DataSourceProxy.<init>(DataSourceProxy.java:82)
	at io.seata.rm.datasource.DataSourceProxy.<init>(DataSourceProxy.java:67)
	at io.seata.spring.annotation.datasource.SeataAutoDataSourceProxyCreator.buildProxy(SeataAutoDataSourceProxyCreator.java:125)
	at io.seata.spring.annotation.datasource.SeataAutoDataSourceProxyCreator.wrapIfNecessary(SeataAutoDataSourceProxyCreator.java:99)
	at org.springframework.aop.framework.autoproxy.AbstractAutoProxyCreator.postProcessAfterInitialization(AbstractAutoProxyCreator.java:318)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.applyBeanPostProcessorsAfterInitialization(AbstractAutowireCapableBeanFactory.java:434)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1773)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:598)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:520)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:325)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:234)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:323)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:199)
	at org.springframework.beans.factory.config.DependencyDescriptor.resolveCandidate(DependencyDescriptor.java:254)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.doResolveDependency(DefaultListableBeanFactory.java:1417)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveDependency(DefaultListableBeanFactory.java:1337)
	at org.springframework.beans.factory.support.ConstructorResolver.resolveAutowiredArgument(ConstructorResolver.java:910)
	at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:788)
	at org.springframework.beans.factory.support.ConstructorResolver.autowireConstructor(ConstructorResolver.java:240)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.autowireConstructor(AbstractAutowireCapableBeanFactory.java:1352)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:1189)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:560)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:520)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:325)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:234)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:323)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:199)
	at org.springframework.beans.factory.support.ConstructorResolver.instantiateUsingFactoryMethod(ConstructorResolver.java:412)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.instantiateUsingFactoryMethod(AbstractAutowireCapableBeanFactory.java:1332)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:1162)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:560)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:520)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:325)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:234)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:323)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:199)
	at org.springframework.context.support.AbstractApplicationContext.getBean(AbstractApplicationContext.java:1166)
	at org.springframework.context.support.AbstractApplicationContext.finishBeanFactoryInitialization(AbstractApplicationContext.java:940)
	at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:616)
	at org.springframework.boot.web.reactive.context.ReactiveWebServerApplicationContext.refresh(ReactiveWebServerApplicationContext.java:66)
	at org.springframework.boot.SpringApplication.refresh(SpringApplication.java:733)
	at org.springframework.boot.SpringApplication.refreshContext(SpringApplication.java:435)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:311)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1301)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1290)
	at com.bgpay.bgai.BgaiApplication.main(BgaiApplication.java:34)
2025-05-25 01:33:14.975 [main] INFO  i.s.s.a.datasource.SeataAutoDataSourceProxyCreator - Auto proxy data source 'dynamicDataSource' by 'AT' mode.
2025-05-25 01:33:15.135 [main] INFO  org.hibernate.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-05-25 01:33:15.204 [main] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.1.7.Final
2025-05-25 01:33:15.514 [main] INFO  SQL dialect - HHH000400: Using dialect: org.hibernate.dialect.MySQL8Dialect
2025-05-25 01:33:15.517 [main] WARN  org.hibernate.orm.deprecation - HHH90000026: MySQL8Dialect has been deprecated; use org.hibernate.dialect.MySQLDialect instead
2025-05-25 01:33:15.839 [main] INFO  o.h.e.t.jta.platform.internal.JtaPlatformInitiator - HHH000490: Using JtaPlatform implementation: [org.hibernate.engine.transaction.jta.platform.internal.NoJtaPlatform]
2025-05-25 01:33:15.852 [main] INFO  o.s.orm.jpa.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-05-25 01:33:16.291 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-25 01:33:16.302 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-25 01:33:16.339 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-25 01:33:16.341 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-25 01:33:16.341 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-25 01:33:16.352 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-25 01:33:17.048 [main] INFO  com.bgpay.bgai.service.impl.UserServiceImpl - 初始化SSO配置: clientId=bgai-client-id, redirectUri=http://localhost:8080/api/auth/callback
2025-05-25 01:33:17.192 [main] INFO  com.bgpay.bgai.controller.AuthController - 初始化认证控制器: clientId=bgai-client-id, redirectUri=http://localhost:8080/api/auth/callback
2025-05-25 01:33:17.689 [main] INFO  o.a.r.s.autoconfigure.RocketMQAutoConfiguration - a producer (billing-producer-group) init on namesrv 8.133.246.113:9876
2025-05-25 01:33:18.437 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Bean [com.bgpay.bgai.service.deepseek.DeepSeekServiceImp$$SpringCGLIB$$0] with name [deepSeekServiceImp] would use interceptor [io.seata.spring.annotation.GlobalTransactionalInterceptor]
2025-05-25 01:33:18.799 [main] WARN  i.s.s.b.a.provider.SpringBootConfigurationProvider - The get method not found for the field 'SeataProperties#accesskey'.
2025-05-25 01:33:18.800 [main] WARN  i.s.s.b.a.provider.SpringBootConfigurationProvider - The get method not found for the field 'SeataProperties#secretkey'.
2025-05-25 01:33:18.814 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 加载到1个Saga状态机定义文件
2025-05-25 01:33:18.993 [main] INFO  com.bgpay.bgai.saga.CustomSagaJsonParser - 开始解析状态机定义: bgai-saga-transaction
2025-05-25 01:33:18.994 [main] INFO  com.bgpay.bgai.saga.CustomSagaJsonParser - 状态机定义解析成功: bgai-saga-transaction
2025-05-25 01:33:18.994 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 成功加载状态机定义: /E:/project/bgai/target/classes/statelang/bgai-saga-transaction.json
2025-05-25 01:33:19.445 [main] INFO  org.redisson.Version - Redisson 3.24.3
2025-05-25 01:33:19.592 [redisson-netty-4-6] INFO  o.r.connection.pool.MasterPubSubConnectionPool - 1 connections initialized for 8.133.246.113/8.133.246.113:6379
2025-05-25 01:33:19.918 [redisson-netty-4-19] INFO  org.redisson.connection.pool.MasterConnectionPool - 24 connections initialized for 8.133.246.113/8.133.246.113:6379
2025-05-25 01:33:20.175 [main] INFO  com.bgpay.bgai.service.mq.MQConsumerService - MQ consumer startup successful [group=billing-consumer-group, topic=BILLING_TOPIC, tag=USER_BILLING]
2025-05-25 01:33:20.570 [Thread-1] WARN  c.alibaba.nacos.common.http.HttpClientBeanHolder - [HttpClientBeanHolder] Start destroying common HttpClient
2025-05-25 01:33:20.570 [Thread-7] WARN  com.alibaba.nacos.common.notify.NotifyCenter - [NotifyCenter] Start destroying Publisher
2025-05-25 01:33:20.571 [Thread-7] WARN  com.alibaba.nacos.common.notify.NotifyCenter - [NotifyCenter] Destruction of the end
2025-05-25 01:33:20.571 [Thread-1] WARN  c.alibaba.nacos.common.http.HttpClientBeanHolder - [HttpClientBeanHolder] Destruction of the end
2025-05-25 01:33:20.589 [main] DEBUG com.bgpay.bgai.config.AsyncConfig$1 - Initializing ExecutorService 'blockingExecutor'
2025-05-25 01:33:20.622 [main] INFO  c.b.bgai.config.NacosConfig$NacosWarningHandler - Nacos警告处理器已启用，将忽略配置中心连接警告
2025-05-25 01:33:22.071 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [After]
2025-05-25 01:33:22.072 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Before]
2025-05-25 01:33:22.072 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Between]
2025-05-25 01:33:22.072 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Cookie]
2025-05-25 01:33:22.072 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Header]
2025-05-25 01:33:22.072 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Host]
2025-05-25 01:33:22.072 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Method]
2025-05-25 01:33:22.072 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Path]
2025-05-25 01:33:22.072 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Query]
2025-05-25 01:33:22.072 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [ReadBody]
2025-05-25 01:33:22.072 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [RemoteAddr]
2025-05-25 01:33:22.072 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [XForwardedRemoteAddr]
2025-05-25 01:33:22.072 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Weight]
2025-05-25 01:33:22.072 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [CloudFoundryRouteService]
2025-05-25 01:33:23.808 [main] INFO  o.s.b.actuate.endpoint.web.EndpointLinksResolver - Exposing 3 endpoint(s) beneath base path '/actuator'
2025-05-25 01:33:25.615 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat started on port(s): 8080 (http) with context path ''
2025-05-25 01:33:25.625 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from ans.namespace attribute : null
2025-05-25 01:33:25.625 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from ALIBABA_ALIWARE_NAMESPACE attribute :null
2025-05-25 01:33:25.626 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from namespace attribute :null
2025-05-25 01:33:25.634 [main] INFO  c.a.n.p.auth.spi.client.ClientAuthPluginManager - [ClientAuthPluginManager] Load ClientAuthService com.alibaba.nacos.client.auth.impl.NacosClientAuthServiceImpl success.
2025-05-25 01:33:25.634 [main] INFO  c.a.n.p.auth.spi.client.ClientAuthPluginManager - [ClientAuthPluginManager] Load ClientAuthService com.alibaba.nacos.client.auth.ram.RamClientAuthServiceImpl success.
2025-05-25 01:33:25.637 [main] INFO  com.alibaba.nacos.common.remote.client - [RpcClientFactory] create a new rpc client of f0fd7ea6-0858-4960-a3a7-ca07a166d264
2025-05-25 01:33:25.639 [main] INFO  com.alibaba.nacos.common.remote.client - [f0fd7ea6-0858-4960-a3a7-ca07a166d264] RpcClient init, ServerListFactory = com.alibaba.nacos.client.naming.core.ServerListManager
2025-05-25 01:33:25.639 [main] INFO  com.alibaba.nacos.common.remote.client - [f0fd7ea6-0858-4960-a3a7-ca07a166d264] Registry connection listener to current client:com.alibaba.nacos.client.naming.remote.gprc.redo.NamingGrpcRedoService
2025-05-25 01:33:25.639 [main] INFO  com.alibaba.nacos.common.remote.client - [f0fd7ea6-0858-4960-a3a7-ca07a166d264] Register server push request handler:com.alibaba.nacos.client.naming.remote.gprc.NamingPushRequestHandler
2025-05-25 01:33:25.640 [main] INFO  com.alibaba.nacos.common.remote.client - [f0fd7ea6-0858-4960-a3a7-ca07a166d264] Try to connect to server on start up, server: {serverIp = '8.133.246.113', server main port = 8848}
2025-05-25 01:33:25.640 [main] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - grpc client connection server:8.133.246.113 ip,serverPort:9848,grpcTslConfig:{"sslProvider":"OPENSSL","enableTls":false,"mutualAuthEnable":false,"trustAll":false}
2025-05-25 01:33:25.779 [main] INFO  com.alibaba.nacos.common.remote.client - [f0fd7ea6-0858-4960-a3a7-ca07a166d264] Success to connect to server [8.133.246.113:8848] on start up, connectionId = 1748108005679_139.227.195.192_49393
2025-05-25 01:33:25.779 [com.alibaba.nacos.client.remote.worker] INFO  com.alibaba.nacos.common.remote.client - [f0fd7ea6-0858-4960-a3a7-ca07a166d264] Notify connected event to listeners.
2025-05-25 01:33:25.779 [main] INFO  com.alibaba.nacos.common.remote.client - [f0fd7ea6-0858-4960-a3a7-ca07a166d264] Register server push request handler:com.alibaba.nacos.common.remote.client.RpcClient$ConnectResetRequestHandler
2025-05-25 01:33:25.779 [main] INFO  com.alibaba.nacos.common.remote.client - [f0fd7ea6-0858-4960-a3a7-ca07a166d264] Register server push request handler:com.alibaba.nacos.common.remote.client.RpcClient$$Lambda/0x0000015e2e56ada8
2025-05-25 01:33:25.780 [main] INFO  com.alibaba.nacos.client.naming - [REGISTER-SERVICE] d750d92e-152f-4055-a641-3bc9dda85a29 registering service bgtech-ai with instance Instance{instanceId='null', ip='192.168.86.8', port=8080, weight=1.0, healthy=true, enabled=true, ephemeral=true, clusterName='DEFAULT', serviceName='null', metadata={IPv6=[2408:820c:7528:d042:c185:8edc:f30d:3d91], preserved.register.source=SPRING_CLOUD}}
2025-05-25 01:33:25.784 [com.alibaba.nacos.client.remote.worker] INFO  com.alibaba.nacos.client.naming - Grpc connection connect
2025-05-25 01:33:25.797 [main] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - nacos registry, DEFAULT_GROUP bgtech-ai 192.168.86.8:8080 register finished
2025-05-25 01:33:25.853 [main] INFO  com.bgpay.bgai.config.NacosConfig - 应用启动完成，当前环境: dev
2025-05-25 01:33:25.853 [main] INFO  com.bgpay.bgai.config.NacosConfig - Nacos配置中心: 8.133.246.113:8848, 命名空间: d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-25 01:33:25.853 [main] INFO  com.bgpay.bgai.config.NacosConfig - 注意: 如果看到Nacos配置加载警告，但应用正常启动，说明应用正在使用本地配置文件
2025-05-25 01:33:25.854 [main] INFO  com.bgpay.bgai.BgaiApplication - Started BgaiApplication in 17.751 seconds (process running for 19.249)
2025-05-25 01:33:25.857 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-25 01:33:25.857 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-25 01:33:25.869 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-25 01:33:25.869 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-25 01:33:25.869 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-25 01:33:25.872 [SpringApplicationShutdownHook] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - De-registering from Nacos Server now...
2025-05-25 01:33:25.872 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - [DEREGISTER-SERVICE] d750d92e-152f-4055-a641-3bc9dda85a29 deregistering service bgtech-ai with instance: Instance{instanceId='null', ip='192.168.86.8', port=8080, weight=1.0, healthy=true, enabled=true, ephemeral=true, clusterName='DEFAULT', serviceName='null', metadata={}}
2025-05-25 01:33:25.872 [scheduling-1] ERROR o.s.s.support.TaskUtils$LoggingErrorHandler - Unexpected error occurred in scheduled task
org.mybatis.spring.MyBatisSystemException: null
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:97)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:439)
	at jdk.proxy2/jdk.proxy2.$Proxy154.selectList(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.selectList(SqlSessionTemplate.java:224)
	at com.baomidou.mybatisplus.core.override.MybatisMapperMethod.executeForMany(MybatisMapperMethod.java:164)
	at com.baomidou.mybatisplus.core.override.MybatisMapperMethod.execute(MybatisMapperMethod.java:77)
	at com.baomidou.mybatisplus.core.override.MybatisMapperProxy$PlainMethodInvoker.invoke(MybatisMapperProxy.java:152)
	at com.baomidou.mybatisplus.core.override.MybatisMapperProxy.invoke(MybatisMapperProxy.java:89)
	at jdk.proxy2/jdk.proxy2.$Proxy158.selectAllowedTypes(Unknown Source)
	at com.bgpay.bgai.service.deepseek.FileTypeService.refreshCache(FileTypeService.java:49)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:343)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:751)
	at org.springframework.aop.aspectj.AspectJAfterAdvice.invoke(AspectJAfterAdvice.java:49)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:173)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:751)
	at org.springframework.aop.framework.adapter.MethodBeforeAdviceInterceptor.invoke(MethodBeforeAdviceInterceptor.java:58)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:173)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:751)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:751)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:703)
	at com.bgpay.bgai.service.deepseek.FileTypeService$$SpringCGLIB$$0.refreshCache(<generated>)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:84)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at java.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:572)
	at java.base/java.util.concurrent.FutureTask.runAndReset$$$capture(FutureTask.java:358)
	at java.base/java.util.concurrent.FutureTask.runAndReset(FutureTask.java)
	at java.base/java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:305)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642)
	at java.base/java.lang.Thread.run(Thread.java:1583)
Caused by: org.apache.ibatis.exceptions.PersistenceException: 
### Error querying database.  Cause: org.springframework.jdbc.CannotGetJdbcConnectionException: Failed to obtain JDBC Connection
### The error may exist in com/bgpay/bgai/mapper/FileTypeMapper.java (best guess)
### The error may involve com.bgpay.bgai.mapper.FileTypeMapper.selectAllowedTypes
### The error occurred while executing a query
### Cause: org.springframework.jdbc.CannotGetJdbcConnectionException: Failed to obtain JDBC Connection
	at org.apache.ibatis.exceptions.ExceptionFactory.wrapException(ExceptionFactory.java:30)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.selectList(DefaultSqlSession.java:156)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.selectList(DefaultSqlSession.java:147)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.selectList(DefaultSqlSession.java:142)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:425)
	... 36 common frames omitted
Caused by: org.springframework.jdbc.CannotGetJdbcConnectionException: Failed to obtain JDBC Connection
	at org.springframework.jdbc.datasource.DataSourceUtils.getConnection(DataSourceUtils.java:84)
	at org.mybatis.spring.transaction.SpringManagedTransaction.openConnection(SpringManagedTransaction.java:80)
	at org.mybatis.spring.transaction.SpringManagedTransaction.getConnection(SpringManagedTransaction.java:67)
	at org.apache.ibatis.executor.BaseExecutor.getConnection(BaseExecutor.java:348)
	at org.apache.ibatis.executor.SimpleExecutor.prepareStatement(SimpleExecutor.java:89)
	at org.apache.ibatis.executor.SimpleExecutor.doQuery(SimpleExecutor.java:64)
	at org.apache.ibatis.executor.BaseExecutor.queryFromDatabase(BaseExecutor.java:336)
	at org.apache.ibatis.executor.BaseExecutor.query(BaseExecutor.java:158)
	at org.apache.ibatis.executor.CachingExecutor.query(CachingExecutor.java:110)
	at org.apache.ibatis.executor.CachingExecutor.query(CachingExecutor.java:90)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.selectList(DefaultSqlSession.java:154)
	... 41 common frames omitted
Caused by: java.sql.SQLException: interrupt
	at com.alibaba.druid.pool.DruidDataSource.getConnectionInternal(DruidDataSource.java:1635)
	at com.alibaba.druid.pool.DruidDataSource.getConnectionDirect(DruidDataSource.java:1427)
	at com.alibaba.druid.pool.DruidDataSource.getConnection(DruidDataSource.java:1407)
	at com.alibaba.druid.pool.DruidDataSource.getConnection(DruidDataSource.java:1397)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:343)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:751)
	at io.seata.spring.annotation.datasource.SeataAutoDataSourceProxyAdvice.invoke(SeataAutoDataSourceProxyAdvice.java:49)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:751)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:703)
	at com.alibaba.druid.pool.DruidDataSource$$SpringCGLIB$$0.getConnection(<generated>)
	at org.springframework.jdbc.datasource.lookup.AbstractRoutingDataSource.getConnection(AbstractRoutingDataSource.java:194)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:343)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:751)
	at io.seata.spring.annotation.datasource.SeataAutoDataSourceProxyAdvice.invoke(SeataAutoDataSourceProxyAdvice.java:49)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:751)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:703)
	at com.bgpay.bgai.datasource.DynamicDataSource$$SpringCGLIB$$0.getConnection(<generated>)
	at org.springframework.jdbc.datasource.DataSourceUtils.fetchConnection(DataSourceUtils.java:160)
	at org.springframework.jdbc.datasource.DataSourceUtils.doGetConnection(DataSourceUtils.java:118)
	at org.springframework.jdbc.datasource.DataSourceUtils.getConnection(DataSourceUtils.java:81)
	... 51 common frames omitted
Caused by: java.lang.InterruptedException: null
	at java.base/java.util.concurrent.locks.ReentrantLock$Sync.lockInterruptibly(ReentrantLock.java:159)
	at java.base/java.util.concurrent.locks.ReentrantLock.lockInterruptibly(ReentrantLock.java:372)
	at com.alibaba.druid.pool.DruidDataSource.getConnectionInternal(DruidDataSource.java:1632)
	... 80 common frames omitted
2025-05-25 01:33:25.880 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-25 01:33:25.881 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-25 01:33:25.881 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-25 01:33:25.884 [SpringApplicationShutdownHook] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - De-registration finished.
2025-05-25 01:33:25.885 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.cache.ServiceInfoHolder do shutdown begin
2025-05-25 01:33:25.885 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.backups.FailoverReactor do shutdown begin
2025-05-25 01:33:25.887 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-25 01:33:25.888 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - ==================== Saga状态机加载报告 ====================
2025-05-25 01:33:25.888 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - Saga状态机配置加载状态: 成功
2025-05-25 01:33:25.888 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 已加载的状态机定义文件数量: 1
2025-05-25 01:33:25.888 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 已加载的状态机定义文件:
2025-05-25 01:33:25.888 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig -  - /E:/project/bgai/target/classes/statelang/bgai-saga-transaction.json
2025-05-25 01:33:25.888 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - Saga解析器状态: CUSTOM_FASTJSON2
2025-05-25 01:33:25.888 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 状态机解析结果: 成功 1 个, 失败 0 个
2025-05-25 01:33:25.888 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - =============================================================
2025-05-25 01:33:26.199 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.backups.FailoverReactor do shutdown stop
2025-05-25 01:33:26.199 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.cache.ServiceInfoHolder do shutdown stop
2025-05-25 01:33:26.199 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.NamingClientProxyDelegate do shutdown begin
2025-05-25 01:33:26.199 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServiceInfoUpdateService do shutdown begin
2025-05-25 01:33:26.199 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServiceInfoUpdateService do shutdown stop
2025-05-25 01:33:26.199 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServerListManager do shutdown begin
2025-05-25 01:33:26.199 [SpringApplicationShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Start destroying NacosRestTemplate
2025-05-25 01:33:26.199 [SpringApplicationShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Destruction of the end
2025-05-25 01:33:26.199 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServerListManager do shutdown stop
2025-05-25 01:33:26.199 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.http.NamingHttpClientProxy do shutdown begin
2025-05-25 01:33:26.199 [SpringApplicationShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Start destroying NacosRestTemplate
2025-05-25 01:33:26.199 [SpringApplicationShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Destruction of the end
2025-05-25 01:33:26.199 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.http.NamingHttpClientProxy do shutdown stop
2025-05-25 01:33:26.199 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Shutdown rpc client, set status to shutdown
2025-05-25 01:33:26.200 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Shutdown client event executor java.util.concurrent.ScheduledThreadPoolExecutor@e958ef[Running, pool size = 2, active threads = 2, queued tasks = 0, completed tasks = 0]
2025-05-25 01:33:26.200 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Close current connection 1748108005679_139.227.195.192_49393
2025-05-25 01:33:26.203 [nacos-grpc-client-executor-8.133.246.113-10] WARN  c.a.nacos.common.remote.client.grpc.GrpcClient - [1748108005679_139.227.195.192_49393]Ignore error event,isRunning:false,isAbandon=false
2025-05-25 01:33:26.206 [SpringApplicationShutdownHook] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - Shutdown grpc executor java.util.concurrent.ThreadPoolExecutor@9936354[Running, pool size = 11, active threads = 0, queued tasks = 0, completed tasks = 11]
2025-05-25 01:33:26.207 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - Shutdown grpc redo service executor java.util.concurrent.ScheduledThreadPoolExecutor@6d362f40[Running, pool size = 1, active threads = 0, queued tasks = 1, completed tasks = 0]
2025-05-25 01:33:26.208 [SpringApplicationShutdownHook] INFO  c.a.n.client.auth.ram.identify.CredentialWatcher - [null] CredentialWatcher is stopped
2025-05-25 01:33:26.208 [SpringApplicationShutdownHook] INFO  c.a.n.client.auth.ram.identify.CredentialService - [null] CredentialService is freed
2025-05-25 01:33:26.211 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.NamingClientProxyDelegate do shutdown stop
2025-05-25 01:33:26.221 [SpringApplicationShutdownHook] DEBUG com.bgpay.bgai.config.AsyncConfig$1 - Shutting down ExecutorService 'blockingExecutor'
2025-05-25 01:33:28.347 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:10911] result: true
2025-05-25 01:33:28.348 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:9876] result: true
2025-05-25 01:33:28.379 [SpringApplicationShutdownHook] INFO  o.s.orm.jpa.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-05-25 01:33:28.381 [SpringApplicationShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-2} closing ...
2025-05-25 01:33:28.388 [SpringApplicationShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-2} closed
2025-05-25 01:33:28.388 [SpringApplicationShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} closing ...
2025-05-25 01:33:28.389 [SpringApplicationShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} closed
2025-05-25 01:35:32.381 [main] WARN  com.alibaba.nacos.client.logging.NacosLogging - Load Logback Configuration of Nacos fail, message: Could not initialize Logback Nacos logging from classpath:nacos-logback.xml
2025-05-25 01:35:32.383 [main] INFO  com.bgpay.bgai.BgaiApplication - The following 1 profile is active: "dev"
2025-05-25 01:35:33.989 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-05-25 01:35:33.992 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-05-25 01:35:34.027 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 25 ms. Found 0 JPA repository interfaces.
2025-05-25 01:35:34.044 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-05-25 01:35:34.046 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-05-25 01:35:34.062 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 6 ms. Found 0 Redis repository interfaces.
2025-05-25 01:35:34.772 [main] INFO  io.seata.config.ConfigurationFactory - load Configuration from :Spring Configuration
2025-05-25 01:35:34.782 [main] INFO  io.seata.config.ConfigurationFactory - load Configuration from :Spring Configuration
2025-05-25 01:35:34.789 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Initializing Global Transaction Clients ... 
2025-05-25 01:35:34.927 [main] INFO  io.seata.core.rpc.netty.NettyClientBootstrap - NettyClientBootstrap has started
2025-05-25 01:35:34.928 [main] INFO  io.seata.discovery.registry.RegistryFactory - use registry center type: file
2025-05-25 01:35:34.941 [main] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - will connect to 8.133.246.113:8091
2025-05-25 01:35:34.946 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - NettyPool create channel to transactionRole:TMROLE,address:8.133.246.113:8091,msg:< RegisterTMRequest{version='1.7.0', applicationId='bgtech-ai', transactionServiceGroup='bgai-tx-group', extraData='ak=null
digest=bgai-tx-group,192.168.86.8,1748108134944
timestamp=1748108134944
authVersion=V4
vgroup=bgai-tx-group
ip=192.168.86.8
'} >
2025-05-25 01:35:35.131 [main] INFO  io.seata.core.rpc.netty.TmNettyRemotingClient - register TM success. client version:1.7.0, server version:1.8.1-SNAPSHOT,channel:[id: 0xf003696a, L:/192.168.86.8:62399 - R:/8.133.246.113:8091]
2025-05-25 01:35:35.137 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - register success, cost 95 ms, version:1.8.1-SNAPSHOT,role:TMROLE,channel:[id: 0xf003696a, L:/192.168.86.8:62399 - R:/8.133.246.113:8091]
2025-05-25 01:35:35.138 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Transaction Manager Client is initialized. applicationId[bgtech-ai] txServiceGroup[bgai-tx-group]
2025-05-25 01:35:35.150 [main] INFO  io.seata.rm.datasource.AsyncWorker - Async Commit Buffer Limit: 10000
2025-05-25 01:35:35.150 [main] INFO  io.seata.rm.datasource.xa.ResourceManagerXA - ResourceManagerXA init ...
2025-05-25 01:35:35.157 [main] INFO  io.seata.core.rpc.netty.NettyClientBootstrap - NettyClientBootstrap has started
2025-05-25 01:35:35.157 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Resource Manager is initialized. applicationId[bgtech-ai] txServiceGroup[bgai-tx-group]
2025-05-25 01:35:35.158 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Global Transaction Clients are initialized. 
2025-05-25 01:35:36.466 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat initialized with port(s): 8080 (http)
2025-05-25 01:35:36.477 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - The ["http-nio-8080"] connector has been configured to support HTTP upgrade to [h2c]
2025-05-25 01:35:36.477 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - Initializing ProtocolHandler ["http-nio-8080"]
2025-05-25 01:35:36.479 [main] INFO  org.apache.catalina.core.StandardService - Starting service [Tomcat]
2025-05-25 01:35:36.479 [main] INFO  org.apache.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.15]
2025-05-25 01:35:37.080 [main] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} inited
2025-05-25 01:35:37.372 [main] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - will connect to 8.133.246.113:8091
2025-05-25 01:35:37.448 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - RM will register :jdbc:mysql://8.133.246.113:3306/deepseek
2025-05-25 01:35:37.448 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - NettyPool create channel to transactionRole:RMROLE,address:8.133.246.113:8091,msg:< RegisterRMRequest{resourceIds='jdbc:mysql://8.133.246.113:3306/deepseek', version='1.7.0', applicationId='bgtech-ai', transactionServiceGroup='bgai-tx-group', extraData='null'} >
2025-05-25 01:35:37.476 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - register RM success. client version:1.7.0, server version:1.8.1-SNAPSHOT,channel:[id: 0xa9ea4aed, L:/192.168.86.8:62402 - R:/8.133.246.113:8091]
2025-05-25 01:35:37.476 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - register success, cost 17 ms, version:1.8.1-SNAPSHOT,role:RMROLE,channel:[id: 0xa9ea4aed, L:/192.168.86.8:62402 - R:/8.133.246.113:8091]
2025-05-25 01:35:37.479 [main] INFO  i.s.s.a.datasource.SeataAutoDataSourceProxyCreator - Auto proxy data source 'masterDataSource' by 'AT' mode.
2025-05-25 01:35:37.548 [main] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-2} inited
2025-05-25 01:35:37.644 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - will register resourceId:jdbc:mysql://8.133.246.113:3306/deepseek
2025-05-25 01:35:37.645 [main] INFO  i.s.s.a.datasource.SeataAutoDataSourceProxyCreator - Auto proxy data source 'slaveDataSource' by 'AT' mode.
2025-05-25 01:35:37.658 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.rm.AbstractRMHandler - the rm client received response msg [RegisterRMResponse{version='1.8.1-SNAPSHOT', extraData='null', identified=true, resultCode=null, msg='null'}] from tc server.
2025-05-25 01:35:37.677 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - will register resourceId:jdbc:mysql://8.133.246.113:3306/deepseek
2025-05-25 01:35:37.677 [main] INFO  i.s.s.a.datasource.SeataAutoDataSourceProxyCreator - Auto proxy data source 'dynamicDataSource' by 'AT' mode.
2025-05-25 01:35:37.686 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.rm.AbstractRMHandler - the rm client received response msg [RegisterRMResponse{version='1.8.1-SNAPSHOT', extraData='null', identified=true, resultCode=null, msg='null'}] from tc server.
2025-05-25 01:35:37.777 [main] INFO  org.hibernate.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-05-25 01:35:37.833 [main] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.1.7.Final
2025-05-25 01:35:38.189 [main] INFO  SQL dialect - HHH000400: Using dialect: org.hibernate.dialect.MySQL8Dialect
2025-05-25 01:35:38.192 [main] WARN  org.hibernate.orm.deprecation - HHH90000026: MySQL8Dialect has been deprecated; use org.hibernate.dialect.MySQLDialect instead
2025-05-25 01:35:38.556 [main] INFO  o.h.e.t.jta.platform.internal.JtaPlatformInitiator - HHH000490: Using JtaPlatform implementation: [org.hibernate.engine.transaction.jta.platform.internal.NoJtaPlatform]
2025-05-25 01:35:38.569 [main] INFO  o.s.orm.jpa.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-05-25 01:35:39.098 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-25 01:35:39.111 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-25 01:35:39.140 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-25 01:35:39.143 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-25 01:35:39.143 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-25 01:35:39.154 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-25 01:35:39.959 [main] INFO  com.bgpay.bgai.service.impl.UserServiceImpl - 初始化SSO配置: clientId=bgai-client-id, redirectUri=http://localhost:8080/api/auth/callback
2025-05-25 01:35:40.131 [main] INFO  com.bgpay.bgai.controller.AuthController - 初始化认证控制器: clientId=bgai-client-id, redirectUri=http://localhost:8080/api/auth/callback
2025-05-25 01:35:40.313 [main] WARN  o.s.b.w.r.c.AnnotationConfigReactiveWebServerApplicationContext - Exception encountered during context initialization - cancelling refresh attempt: org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'enhancedChatController' defined in file [E:\project\bgai\target\classes\com\bgpay\bgai\controller\EnhancedChatController.class]: Unsatisfied dependency expressed through constructor parameter 2: Error creating bean with name 'deepSeekServiceImp' defined in file [E:\project\bgai\target\classes\com\bgpay\bgai\service\deepseek\DeepSeekServiceImp.class]: Failed to instantiate [com.bgpay.bgai.service.deepseek.DeepSeekServiceImp]: Constructor threw exception
2025-05-25 01:35:40.330 [main] INFO  o.s.orm.jpa.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-05-25 01:35:40.332 [main] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-2} closing ...
2025-05-25 01:35:40.345 [main] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-2} closed
2025-05-25 01:35:40.345 [main] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} closing ...
2025-05-25 01:35:40.346 [main] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} closed
2025-05-25 01:35:40.347 [NettyClientSelector_TMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - channel inactive: [id: 0xf003696a, L:/192.168.86.8:62399 ! R:/8.133.246.113:8091]
2025-05-25 01:35:40.348 [NettyClientSelector_TMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - return to pool, rm channel:[id: 0xf003696a, L:/192.168.86.8:62399 ! R:/8.133.246.113:8091]
2025-05-25 01:35:40.348 [NettyClientSelector_TMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - channel valid false,channel:[id: 0xf003696a, L:/192.168.86.8:62399 ! R:/8.133.246.113:8091]
2025-05-25 01:35:40.348 [NettyClientSelector_TMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - will destroy channel:[id: 0xf003696a, L:/192.168.86.8:62399 ! R:/8.133.246.113:8091]
2025-05-25 01:35:40.348 [NettyClientSelector_TMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0xf003696a, L:/192.168.86.8:62399 ! R:/8.133.246.113:8091]) will closed
2025-05-25 01:35:40.348 [NettyClientSelector_TMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0xf003696a, L:/192.168.86.8:62399 ! R:/8.133.246.113:8091]) will closed
2025-05-25 01:35:40.348 [NettyClientSelector_RMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - channel inactive: [id: 0xa9ea4aed, L:/192.168.86.8:62402 ! R:/8.133.246.113:8091]
2025-05-25 01:35:40.348 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - return to pool, rm channel:[id: 0xa9ea4aed, L:/192.168.86.8:62402 ! R:/8.133.246.113:8091]
2025-05-25 01:35:40.348 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - channel valid false,channel:[id: 0xa9ea4aed, L:/192.168.86.8:62402 ! R:/8.133.246.113:8091]
2025-05-25 01:35:40.348 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - will destroy channel:[id: 0xa9ea4aed, L:/192.168.86.8:62402 ! R:/8.133.246.113:8091]
2025-05-25 01:35:40.349 [NettyClientSelector_RMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0xa9ea4aed, L:/192.168.86.8:62402 ! R:/8.133.246.113:8091]) will closed
2025-05-25 01:35:40.349 [NettyClientSelector_RMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0xa9ea4aed, L:/192.168.86.8:62402 ! R:/8.133.246.113:8091]) will closed
2025-05-25 01:35:40.351 [main] INFO  org.apache.catalina.core.StandardService - Stopping service [Tomcat]
2025-05-25 01:35:40.376 [main] INFO  o.s.b.a.logging.ConditionEvaluationReportLogger - 

Error starting ApplicationContext. To display the condition evaluation report re-run your application with 'debug' enabled.
2025-05-25 01:35:40.402 [main] ERROR org.springframework.boot.SpringApplication - Application run failed
org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'enhancedChatController' defined in file [E:\project\bgai\target\classes\com\bgpay\bgai\controller\EnhancedChatController.class]: Unsatisfied dependency expressed through constructor parameter 2: Error creating bean with name 'deepSeekServiceImp' defined in file [E:\project\bgai\target\classes\com\bgpay\bgai\service\deepseek\DeepSeekServiceImp.class]: Failed to instantiate [com.bgpay.bgai.service.deepseek.DeepSeekServiceImp]: Constructor threw exception
	at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:801)
	at org.springframework.beans.factory.support.ConstructorResolver.autowireConstructor(ConstructorResolver.java:240)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.autowireConstructor(AbstractAutowireCapableBeanFactory.java:1352)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:1189)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:560)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:520)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:325)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:234)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:323)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:199)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.preInstantiateSingletons(DefaultListableBeanFactory.java:973)
	at org.springframework.context.support.AbstractApplicationContext.finishBeanFactoryInitialization(AbstractApplicationContext.java:950)
	at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:616)
	at org.springframework.boot.web.reactive.context.ReactiveWebServerApplicationContext.refresh(ReactiveWebServerApplicationContext.java:66)
	at org.springframework.boot.SpringApplication.refresh(SpringApplication.java:733)
	at org.springframework.boot.SpringApplication.refreshContext(SpringApplication.java:435)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:311)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1301)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1290)
	at com.bgpay.bgai.BgaiApplication.main(BgaiApplication.java:34)
Caused by: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'deepSeekServiceImp' defined in file [E:\project\bgai\target\classes\com\bgpay\bgai\service\deepseek\DeepSeekServiceImp.class]: Failed to instantiate [com.bgpay.bgai.service.deepseek.DeepSeekServiceImp]: Constructor threw exception
	at org.springframework.beans.factory.support.ConstructorResolver.instantiate(ConstructorResolver.java:321)
	at org.springframework.beans.factory.support.ConstructorResolver.autowireConstructor(ConstructorResolver.java:309)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.autowireConstructor(AbstractAutowireCapableBeanFactory.java:1352)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:1189)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:560)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:520)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:325)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:234)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:323)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:199)
	at org.springframework.beans.factory.config.DependencyDescriptor.resolveCandidate(DependencyDescriptor.java:254)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.doResolveDependency(DefaultListableBeanFactory.java:1417)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveDependency(DefaultListableBeanFactory.java:1337)
	at org.springframework.beans.factory.support.ConstructorResolver.resolveAutowiredArgument(ConstructorResolver.java:910)
	at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:788)
	... 19 common frames omitted
Caused by: org.springframework.beans.BeanInstantiationException: Failed to instantiate [com.bgpay.bgai.service.deepseek.DeepSeekServiceImp]: Constructor threw exception
	at org.springframework.beans.BeanUtils.instantiateClass(BeanUtils.java:224)
	at org.springframework.beans.factory.support.SimpleInstantiationStrategy.instantiate(SimpleInstantiationStrategy.java:110)
	at org.springframework.beans.factory.support.ConstructorResolver.instantiate(ConstructorResolver.java:318)
	... 33 common frames omitted
Caused by: java.lang.Error: Unresolved compilation problems: 
	The method defer(Supplier<? extends Mono<? extends T>>) in the type Mono is not applicable for the arguments (() -> {})
	Type mismatch: cannot convert from Mono<Void> to Mono<? extends T>

	at com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.<init>(DeepSeekServiceImp.java:414)
	at java.base/jdk.internal.reflect.DirectConstructorHandleAccessor.newInstance(DirectConstructorHandleAccessor.java:62)
	at java.base/java.lang.reflect.Constructor.newInstanceWithCaller(Constructor.java:502)
	at java.base/java.lang.reflect.Constructor.newInstance(Constructor.java:486)
	at org.springframework.beans.BeanUtils.instantiateClass(BeanUtils.java:211)
	... 35 common frames omitted
2025-05-25 01:35:40.404 [main] ERROR com.bgpay.bgai.BgaiApplication - Application startup failed
org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'enhancedChatController' defined in file [E:\project\bgai\target\classes\com\bgpay\bgai\controller\EnhancedChatController.class]: Unsatisfied dependency expressed through constructor parameter 2: Error creating bean with name 'deepSeekServiceImp' defined in file [E:\project\bgai\target\classes\com\bgpay\bgai\service\deepseek\DeepSeekServiceImp.class]: Failed to instantiate [com.bgpay.bgai.service.deepseek.DeepSeekServiceImp]: Constructor threw exception
	at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:801)
	at org.springframework.beans.factory.support.ConstructorResolver.autowireConstructor(ConstructorResolver.java:240)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.autowireConstructor(AbstractAutowireCapableBeanFactory.java:1352)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:1189)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:560)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:520)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:325)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:234)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:323)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:199)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.preInstantiateSingletons(DefaultListableBeanFactory.java:973)
	at org.springframework.context.support.AbstractApplicationContext.finishBeanFactoryInitialization(AbstractApplicationContext.java:950)
	at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:616)
	at org.springframework.boot.web.reactive.context.ReactiveWebServerApplicationContext.refresh(ReactiveWebServerApplicationContext.java:66)
	at org.springframework.boot.SpringApplication.refresh(SpringApplication.java:733)
	at org.springframework.boot.SpringApplication.refreshContext(SpringApplication.java:435)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:311)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1301)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1290)
	at com.bgpay.bgai.BgaiApplication.main(BgaiApplication.java:34)
Caused by: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'deepSeekServiceImp' defined in file [E:\project\bgai\target\classes\com\bgpay\bgai\service\deepseek\DeepSeekServiceImp.class]: Failed to instantiate [com.bgpay.bgai.service.deepseek.DeepSeekServiceImp]: Constructor threw exception
	at org.springframework.beans.factory.support.ConstructorResolver.instantiate(ConstructorResolver.java:321)
	at org.springframework.beans.factory.support.ConstructorResolver.autowireConstructor(ConstructorResolver.java:309)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.autowireConstructor(AbstractAutowireCapableBeanFactory.java:1352)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:1189)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:560)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:520)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:325)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:234)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:323)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:199)
	at org.springframework.beans.factory.config.DependencyDescriptor.resolveCandidate(DependencyDescriptor.java:254)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.doResolveDependency(DefaultListableBeanFactory.java:1417)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveDependency(DefaultListableBeanFactory.java:1337)
	at org.springframework.beans.factory.support.ConstructorResolver.resolveAutowiredArgument(ConstructorResolver.java:910)
	at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:788)
	... 19 common frames omitted
Caused by: org.springframework.beans.BeanInstantiationException: Failed to instantiate [com.bgpay.bgai.service.deepseek.DeepSeekServiceImp]: Constructor threw exception
	at org.springframework.beans.BeanUtils.instantiateClass(BeanUtils.java:224)
	at org.springframework.beans.factory.support.SimpleInstantiationStrategy.instantiate(SimpleInstantiationStrategy.java:110)
	at org.springframework.beans.factory.support.ConstructorResolver.instantiate(ConstructorResolver.java:318)
	... 33 common frames omitted
Caused by: java.lang.Error: Unresolved compilation problems: 
	The method defer(Supplier<? extends Mono<? extends T>>) in the type Mono is not applicable for the arguments (() -> {})
	Type mismatch: cannot convert from Mono<Void> to Mono<? extends T>

	at com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.<init>(DeepSeekServiceImp.java:414)
	at java.base/jdk.internal.reflect.DirectConstructorHandleAccessor.newInstance(DirectConstructorHandleAccessor.java:62)
	at java.base/java.lang.reflect.Constructor.newInstanceWithCaller(Constructor.java:502)
	at java.base/java.lang.reflect.Constructor.newInstance(Constructor.java:486)
	at org.springframework.beans.BeanUtils.instantiateClass(BeanUtils.java:211)
	... 35 common frames omitted
2025-05-25 01:35:41.331 [Thread-7] WARN  com.alibaba.nacos.common.notify.NotifyCenter - [NotifyCenter] Start destroying Publisher
2025-05-25 01:35:41.331 [Thread-1] WARN  c.alibaba.nacos.common.http.HttpClientBeanHolder - [HttpClientBeanHolder] Start destroying common HttpClient
2025-05-25 01:35:41.331 [Thread-7] WARN  com.alibaba.nacos.common.notify.NotifyCenter - [NotifyCenter] Destruction of the end
2025-05-25 01:35:41.332 [Thread-1] WARN  c.alibaba.nacos.common.http.HttpClientBeanHolder - [HttpClientBeanHolder] Destruction of the end
2025-05-25 01:37:23.028 [main] WARN  com.alibaba.nacos.client.logging.NacosLogging - Load Logback Configuration of Nacos fail, message: Could not initialize Logback Nacos logging from classpath:nacos-logback.xml
2025-05-25 01:37:23.029 [main] INFO  com.bgpay.bgai.BgaiApplication - The following 1 profile is active: "dev"
2025-05-25 01:37:24.441 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-05-25 01:37:24.443 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-05-25 01:37:24.467 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 18 ms. Found 0 JPA repository interfaces.
2025-05-25 01:37:24.479 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-05-25 01:37:24.480 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-05-25 01:37:24.490 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 4 ms. Found 0 Redis repository interfaces.
2025-05-25 01:37:25.126 [main] INFO  io.seata.config.ConfigurationFactory - load Configuration from :Spring Configuration
2025-05-25 01:37:25.135 [main] INFO  io.seata.config.ConfigurationFactory - load Configuration from :Spring Configuration
2025-05-25 01:37:25.142 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Initializing Global Transaction Clients ... 
2025-05-25 01:37:25.243 [main] INFO  io.seata.core.rpc.netty.NettyClientBootstrap - NettyClientBootstrap has started
2025-05-25 01:37:25.244 [main] INFO  io.seata.discovery.registry.RegistryFactory - use registry center type: file
2025-05-25 01:37:25.258 [main] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - will connect to 8.133.246.113:8091
2025-05-25 01:37:25.263 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - NettyPool create channel to transactionRole:TMROLE,address:8.133.246.113:8091,msg:< RegisterTMRequest{version='1.7.0', applicationId='bgtech-ai', transactionServiceGroup='bgai-tx-group', extraData='ak=null
digest=bgai-tx-group,192.168.86.8,1748108245261
timestamp=1748108245261
authVersion=V4
vgroup=bgai-tx-group
ip=192.168.86.8
'} >
2025-05-25 01:37:25.433 [main] INFO  io.seata.core.rpc.netty.TmNettyRemotingClient - register TM success. client version:1.7.0, server version:1.8.1-SNAPSHOT,channel:[id: 0x2189d796, L:/192.168.86.8:62571 - R:/8.133.246.113:8091]
2025-05-25 01:37:25.440 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - register success, cost 79 ms, version:1.8.1-SNAPSHOT,role:TMROLE,channel:[id: 0x2189d796, L:/192.168.86.8:62571 - R:/8.133.246.113:8091]
2025-05-25 01:37:25.441 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Transaction Manager Client is initialized. applicationId[bgtech-ai] txServiceGroup[bgai-tx-group]
2025-05-25 01:37:25.454 [main] INFO  io.seata.rm.datasource.AsyncWorker - Async Commit Buffer Limit: 10000
2025-05-25 01:37:25.454 [main] INFO  io.seata.rm.datasource.xa.ResourceManagerXA - ResourceManagerXA init ...
2025-05-25 01:37:25.460 [main] INFO  io.seata.core.rpc.netty.NettyClientBootstrap - NettyClientBootstrap has started
2025-05-25 01:37:25.460 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Resource Manager is initialized. applicationId[bgtech-ai] txServiceGroup[bgai-tx-group]
2025-05-25 01:37:25.460 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Global Transaction Clients are initialized. 
2025-05-25 01:37:26.541 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat initialized with port(s): 8080 (http)
2025-05-25 01:37:26.552 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - The ["http-nio-8080"] connector has been configured to support HTTP upgrade to [h2c]
2025-05-25 01:37:26.552 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - Initializing ProtocolHandler ["http-nio-8080"]
2025-05-25 01:37:26.553 [main] INFO  org.apache.catalina.core.StandardService - Starting service [Tomcat]
2025-05-25 01:37:26.554 [main] INFO  org.apache.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.15]
2025-05-25 01:37:26.979 [main] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} inited
2025-05-25 01:37:27.230 [main] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - will connect to 8.133.246.113:8091
2025-05-25 01:37:27.230 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - RM will register :jdbc:mysql://8.133.246.113:3306/deepseek
2025-05-25 01:37:27.230 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - NettyPool create channel to transactionRole:RMROLE,address:8.133.246.113:8091,msg:< RegisterRMRequest{resourceIds='jdbc:mysql://8.133.246.113:3306/deepseek', version='1.7.0', applicationId='bgtech-ai', transactionServiceGroup='bgai-tx-group', extraData='null'} >
2025-05-25 01:37:27.249 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - register RM success. client version:1.7.0, server version:1.8.1-SNAPSHOT,channel:[id: 0xed1e6153, L:/192.168.86.8:62575 - R:/8.133.246.113:8091]
2025-05-25 01:37:27.250 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - register success, cost 12 ms, version:1.8.1-SNAPSHOT,role:RMROLE,channel:[id: 0xed1e6153, L:/192.168.86.8:62575 - R:/8.133.246.113:8091]
2025-05-25 01:37:27.252 [main] INFO  i.s.s.a.datasource.SeataAutoDataSourceProxyCreator - Auto proxy data source 'masterDataSource' by 'AT' mode.
2025-05-25 01:37:27.339 [main] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-2} inited
2025-05-25 01:37:27.406 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - will register resourceId:jdbc:mysql://8.133.246.113:3306/deepseek
2025-05-25 01:37:27.408 [main] INFO  i.s.s.a.datasource.SeataAutoDataSourceProxyCreator - Auto proxy data source 'slaveDataSource' by 'AT' mode.
2025-05-25 01:37:27.416 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.rm.AbstractRMHandler - the rm client received response msg [RegisterRMResponse{version='1.8.1-SNAPSHOT', extraData='null', identified=true, resultCode=null, msg='null'}] from tc server.
2025-05-25 01:37:27.430 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - will register resourceId:jdbc:mysql://8.133.246.113:3306/deepseek
2025-05-25 01:37:27.430 [main] INFO  i.s.s.a.datasource.SeataAutoDataSourceProxyCreator - Auto proxy data source 'dynamicDataSource' by 'AT' mode.
2025-05-25 01:37:27.440 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.rm.AbstractRMHandler - the rm client received response msg [RegisterRMResponse{version='1.8.1-SNAPSHOT', extraData='null', identified=true, resultCode=null, msg='null'}] from tc server.
2025-05-25 01:37:27.563 [main] INFO  org.hibernate.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-05-25 01:37:27.610 [main] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.1.7.Final
2025-05-25 01:37:27.978 [main] INFO  SQL dialect - HHH000400: Using dialect: org.hibernate.dialect.MySQL8Dialect
2025-05-25 01:37:27.982 [main] WARN  org.hibernate.orm.deprecation - HHH90000026: MySQL8Dialect has been deprecated; use org.hibernate.dialect.MySQLDialect instead
2025-05-25 01:37:28.270 [main] INFO  o.h.e.t.jta.platform.internal.JtaPlatformInitiator - HHH000490: Using JtaPlatform implementation: [org.hibernate.engine.transaction.jta.platform.internal.NoJtaPlatform]
2025-05-25 01:37:28.281 [main] INFO  o.s.orm.jpa.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-05-25 01:37:28.651 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-25 01:37:28.663 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-25 01:37:28.694 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-25 01:37:28.696 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-25 01:37:28.696 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-25 01:37:28.709 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-25 01:37:29.413 [main] INFO  com.bgpay.bgai.service.impl.UserServiceImpl - 初始化SSO配置: clientId=bgai-client-id, redirectUri=http://localhost:8080/api/auth/callback
2025-05-25 01:37:29.576 [main] INFO  com.bgpay.bgai.controller.AuthController - 初始化认证控制器: clientId=bgai-client-id, redirectUri=http://localhost:8080/api/auth/callback
2025-05-25 01:37:30.102 [main] INFO  o.a.r.s.autoconfigure.RocketMQAutoConfiguration - a producer (billing-producer-group) init on namesrv 8.133.246.113:9876
2025-05-25 01:37:30.737 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Bean [com.bgpay.bgai.service.deepseek.DeepSeekServiceImp$$SpringCGLIB$$0] with name [deepSeekServiceImp] would use interceptor [io.seata.spring.annotation.GlobalTransactionalInterceptor]
2025-05-25 01:37:31.068 [main] WARN  i.s.s.b.a.provider.SpringBootConfigurationProvider - The get method not found for the field 'SeataProperties#accesskey'.
2025-05-25 01:37:31.069 [main] WARN  i.s.s.b.a.provider.SpringBootConfigurationProvider - The get method not found for the field 'SeataProperties#secretkey'.
2025-05-25 01:37:31.081 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 加载到1个Saga状态机定义文件
2025-05-25 01:37:31.221 [main] INFO  com.bgpay.bgai.saga.CustomSagaJsonParser - 开始解析状态机定义: bgai-saga-transaction
2025-05-25 01:37:31.221 [main] INFO  com.bgpay.bgai.saga.CustomSagaJsonParser - 状态机定义解析成功: bgai-saga-transaction
2025-05-25 01:37:31.221 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 成功加载状态机定义: /E:/project/bgai/target/classes/statelang/bgai-saga-transaction.json
2025-05-25 01:37:31.703 [main] INFO  org.redisson.Version - Redisson 3.24.3
2025-05-25 01:37:31.864 [redisson-netty-4-8] INFO  o.r.connection.pool.MasterPubSubConnectionPool - 1 connections initialized for 8.133.246.113/8.133.246.113:6379
2025-05-25 01:37:32.223 [redisson-netty-4-19] INFO  org.redisson.connection.pool.MasterConnectionPool - 24 connections initialized for 8.133.246.113/8.133.246.113:6379
2025-05-25 01:37:32.471 [main] INFO  com.bgpay.bgai.service.mq.MQConsumerService - MQ consumer startup successful [group=billing-consumer-group, topic=BILLING_TOPIC, tag=USER_BILLING]
2025-05-25 01:37:32.769 [main] DEBUG com.bgpay.bgai.config.AsyncConfig$1 - Initializing ExecutorService 'blockingExecutor'
2025-05-25 01:37:32.793 [main] INFO  c.b.bgai.config.NacosConfig$NacosWarningHandler - Nacos警告处理器已启用，将忽略配置中心连接警告
2025-05-25 01:37:33.904 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [After]
2025-05-25 01:37:33.904 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Before]
2025-05-25 01:37:33.904 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Between]
2025-05-25 01:37:33.904 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Cookie]
2025-05-25 01:37:33.905 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Header]
2025-05-25 01:37:33.905 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Host]
2025-05-25 01:37:33.905 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Method]
2025-05-25 01:37:33.905 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Path]
2025-05-25 01:37:33.905 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Query]
2025-05-25 01:37:33.905 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [ReadBody]
2025-05-25 01:37:33.905 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [RemoteAddr]
2025-05-25 01:37:33.905 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [XForwardedRemoteAddr]
2025-05-25 01:37:33.905 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Weight]
2025-05-25 01:37:33.905 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [CloudFoundryRouteService]
2025-05-25 01:37:35.406 [main] INFO  o.s.b.actuate.endpoint.web.EndpointLinksResolver - Exposing 3 endpoint(s) beneath base path '/actuator'
2025-05-25 01:37:36.946 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - Starting ProtocolHandler ["http-nio-8080"]
2025-05-25 01:37:36.967 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat started on port(s): 8080 (http) with context path ''
2025-05-25 01:37:36.978 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from ans.namespace attribute : null
2025-05-25 01:37:36.979 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from ALIBABA_ALIWARE_NAMESPACE attribute :null
2025-05-25 01:37:36.979 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from namespace attribute :null
2025-05-25 01:37:36.988 [main] INFO  c.a.n.p.auth.spi.client.ClientAuthPluginManager - [ClientAuthPluginManager] Load ClientAuthService com.alibaba.nacos.client.auth.impl.NacosClientAuthServiceImpl success.
2025-05-25 01:37:36.988 [main] INFO  c.a.n.p.auth.spi.client.ClientAuthPluginManager - [ClientAuthPluginManager] Load ClientAuthService com.alibaba.nacos.client.auth.ram.RamClientAuthServiceImpl success.
2025-05-25 01:37:36.992 [main] INFO  com.alibaba.nacos.common.remote.client - [RpcClientFactory] create a new rpc client of 93b72b3c-f03f-423e-8f08-1c83f980b155
2025-05-25 01:37:36.994 [main] INFO  com.alibaba.nacos.common.remote.client - [93b72b3c-f03f-423e-8f08-1c83f980b155] RpcClient init, ServerListFactory = com.alibaba.nacos.client.naming.core.ServerListManager
2025-05-25 01:37:36.994 [main] INFO  com.alibaba.nacos.common.remote.client - [93b72b3c-f03f-423e-8f08-1c83f980b155] Registry connection listener to current client:com.alibaba.nacos.client.naming.remote.gprc.redo.NamingGrpcRedoService
2025-05-25 01:37:36.994 [main] INFO  com.alibaba.nacos.common.remote.client - [93b72b3c-f03f-423e-8f08-1c83f980b155] Register server push request handler:com.alibaba.nacos.client.naming.remote.gprc.NamingPushRequestHandler
2025-05-25 01:37:36.995 [main] INFO  com.alibaba.nacos.common.remote.client - [93b72b3c-f03f-423e-8f08-1c83f980b155] Try to connect to server on start up, server: {serverIp = '8.133.246.113', server main port = 8848}
2025-05-25 01:37:36.995 [main] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - grpc client connection server:8.133.246.113 ip,serverPort:9848,grpcTslConfig:{"sslProvider":"OPENSSL","enableTls":false,"mutualAuthEnable":false,"trustAll":false}
2025-05-25 01:37:37.198 [main] INFO  com.alibaba.nacos.common.remote.client - [93b72b3c-f03f-423e-8f08-1c83f980b155] Success to connect to server [8.133.246.113:8848] on start up, connectionId = 1748108257109_139.227.195.192_48562
2025-05-25 01:37:37.198 [main] INFO  com.alibaba.nacos.common.remote.client - [93b72b3c-f03f-423e-8f08-1c83f980b155] Register server push request handler:com.alibaba.nacos.common.remote.client.RpcClient$ConnectResetRequestHandler
2025-05-25 01:37:37.198 [com.alibaba.nacos.client.remote.worker] INFO  com.alibaba.nacos.common.remote.client - [93b72b3c-f03f-423e-8f08-1c83f980b155] Notify connected event to listeners.
2025-05-25 01:37:37.198 [main] INFO  com.alibaba.nacos.common.remote.client - [93b72b3c-f03f-423e-8f08-1c83f980b155] Register server push request handler:com.alibaba.nacos.common.remote.client.RpcClient$$Lambda/0x0000027487529c60
2025-05-25 01:37:37.198 [com.alibaba.nacos.client.remote.worker] INFO  com.alibaba.nacos.client.naming - Grpc connection connect
2025-05-25 01:37:37.199 [main] INFO  com.alibaba.nacos.client.naming - [REGISTER-SERVICE] d750d92e-152f-4055-a641-3bc9dda85a29 registering service bgtech-ai with instance Instance{instanceId='null', ip='192.168.86.8', port=8080, weight=1.0, healthy=true, enabled=true, ephemeral=true, clusterName='DEFAULT', serviceName='null', metadata={IPv6=[2408:820c:7528:d042:c185:8edc:f30d:3d91], preserved.register.source=SPRING_CLOUD}}
2025-05-25 01:37:37.241 [main] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - nacos registry, DEFAULT_GROUP bgtech-ai 192.168.86.8:8080 register finished
2025-05-25 01:37:37.313 [main] INFO  com.bgpay.bgai.config.NacosConfig - 应用启动完成，当前环境: dev
2025-05-25 01:37:37.313 [main] INFO  com.bgpay.bgai.config.NacosConfig - Nacos配置中心: 8.133.246.113:8848, 命名空间: d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-25 01:37:37.313 [main] INFO  com.bgpay.bgai.config.NacosConfig - 注意: 如果看到Nacos配置加载警告，但应用正常启动，说明应用正在使用本地配置文件
2025-05-25 01:37:37.315 [main] INFO  com.bgpay.bgai.BgaiApplication - Started BgaiApplication in 16.38 seconds (process running for 17.77)
2025-05-25 01:37:37.317 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-25 01:37:37.317 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-25 01:37:37.331 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-25 01:37:37.331 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-25 01:37:37.332 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-25 01:37:37.343 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-25 01:37:37.344 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-25 01:37:37.344 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-25 01:37:37.362 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-25 01:37:37.362 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-25 01:37:37.363 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-25 01:37:37.369 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-25 01:37:37.369 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - ==================== Saga状态机加载报告 ====================
2025-05-25 01:37:37.369 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - Saga状态机配置加载状态: 成功
2025-05-25 01:37:37.369 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 已加载的状态机定义文件数量: 1
2025-05-25 01:37:37.369 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 已加载的状态机定义文件:
2025-05-25 01:37:37.369 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig -  - /E:/project/bgai/target/classes/statelang/bgai-saga-transaction.json
2025-05-25 01:37:37.369 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - Saga解析器状态: CUSTOM_FASTJSON2
2025-05-25 01:37:37.370 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 状态机解析结果: 成功 1 个, 失败 0 个
2025-05-25 01:37:37.370 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - =============================================================
2025-05-25 01:37:37.373 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - nacos.cache.data.init.snapshot = true 
2025-05-25 01:37:37.374 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] common-dev.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-25 01:37:37.381 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=common-dev.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-25 01:37:37.381 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=common-dev.yaml, group=DEFAULT_GROUP
2025-05-25 01:37:37.382 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-25 01:37:37.382 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-25 01:37:37.382 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai.yaml, group=DEFAULT_GROUP
2025-05-25 01:37:37.383 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai-dev.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-25 01:37:37.383 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai-dev.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-25 01:37:37.383 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai-dev.yaml, group=DEFAULT_GROUP
2025-05-25 01:37:37.384 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-25 01:37:37.384 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai, group=DEFAULT_GROUP, cnt=1
2025-05-25 01:37:37.384 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai, group=DEFAULT_GROUP
2025-05-25 01:37:45.081 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - 接收到请求: /api/chatGatWay-internal, 文件=新文件 17.txt, 问题参数=null, 模型参数=null
2025-05-25 01:37:45.083 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - 请求Content-Type: multipart/form-data;boundary=--------------------------353141425312409045126838
2025-05-25 01:37:45.083 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - 收集到的完整参数: question="null", apiUrl="null", modelName="null", multiTurn=false
2025-05-25 01:37:45.085 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - Processing request for user ID: 689258T
2025-05-25 01:37:45.085 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - Processing file with circuit breaker: fileName=新文件 17.txt, question=
2025-05-25 01:37:45.087 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.config.ReactiveFileProcessor - Processing file: 新文件 17.txt, content-type: text/plain
2025-05-25 01:37:45.093 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - PARAM TRACE [689258T]: 尝试查找匹配配置 - 参数: apiUrl=null, modelName=null
2025-05-25 01:37:45.101 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 查询配置 - userId=689258T
2025-05-25 01:37:45.102 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 排序方式 - 按ID降序
2025-05-25 01:37:45.102 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 限制结果数 - LIMIT 1
2025-05-25 01:37:45.162 [http-nio-8080-exec-2] DEBUG com.bgpay.bgai.mapper.ApiConfigMapper.selectList - ==>  Preparing: SELECT id,api_url,api_key,model_name,user_id FROM api_config WHERE (user_id = ?) ORDER BY id DESC LIMIT 1
2025-05-25 01:37:45.163 [http-nio-8080-exec-2] DEBUG com.bgpay.bgai.mapper.ApiConfigMapper.selectList - ==> Parameters: 689258T(String)
2025-05-25 01:37:45.172 [http-nio-8080-exec-2] DEBUG com.bgpay.bgai.mapper.ApiConfigMapper.selectList - <==      Total: 1
2025-05-25 01:37:45.173 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 查询结果 - 找到配置: id=2, modelName=deepseek-chat
2025-05-25 01:37:45.173 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - PARAM TRACE [689258T]: 找到匹配配置 - apiUrl=https://api.deepseek.com/chat/completions, modelName=deepseek-chat (原始请求: null)
2025-05-25 01:37:45.173 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - API config resolved: url=https://api.deepseek.com/chat/completions, model=deepseek-chat
2025-05-25 01:37:45.190 [Thread-49] INFO  com.bgpay.bgai.config.ReactiveFileProcessor - File processed successfully: size=37 bytes
2025-05-25 01:37:45.195 [Thread-49] INFO  com.bgpay.bgai.controller.ReactiveChatController - Content processed, length: 54
2025-05-25 01:37:45.201 [Thread-49] INFO  io.seata.tm.TransactionManagerHolder - TransactionManager Singleton io.seata.tm.DefaultTransactionManager@22bed855
2025-05-25 01:37:45.216 [Thread-49] INFO  io.seata.tm.api.DefaultGlobalTransaction - Begin new global transaction [seata-server:8091:153776404394049552]
2025-05-25 01:37:45.218 [Thread-49] INFO  c.b.bgai.interceptor.SeataTransactionInterceptor - 准备记录分布式事务开始: XID=seata-server:8091:153776404394049552, 业务=com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive, 路径=, IP=, 用户=system
2025-05-25 01:37:45.232 [Thread-49] INFO  c.b.bgai.service.impl.TransactionLogServiceImpl - 记录分布式事务开始: XID=seata-server:8091:153776404394049552, 业务=com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive
2025-05-25 01:37:45.239 [Thread-49] DEBUG com.bgpay.bgai.mapper.TransactionLogMapper.insert - ==>  Preparing: INSERT INTO transaction_log ( xid, transaction_name, transaction_mode, status, request_path, source_ip, start_time, user_id, create_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-05-25 01:37:45.243 [Thread-49] DEBUG com.bgpay.bgai.mapper.TransactionLogMapper.insert - ==> Parameters: seata-server:8091:153776404394049552(String), com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive(String), AT(String), ACTIVE(String), (String), (String), 2025-05-25T01:37:45.233128600(LocalDateTime), system(String), 2025-05-25T01:37:45.233128600(LocalDateTime)
2025-05-25 01:37:45.637 [Thread-49] DEBUG com.bgpay.bgai.mapper.TransactionLogMapper.insert - <==    Updates: 1
2025-05-25 01:37:45.681 [Thread-49] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:153776404394049552, branchId:153776404394049553, lockKeys:transaction_log:34
2025-05-25 01:37:45.693 [Thread-49] WARN  i.s.c.l.EnhancedServiceLoader$InnerEnhancedServiceLoader - Load [io.seata.rm.datasource.undo.parser.ProtostuffUndoLogParser] class fail: io/protostuff/runtime/IdStrategy
2025-05-25 01:37:45.763 [Thread-49] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:153776404394049552, branchId:153776404394049554, lockKeys:undo_log:133;transaction_log:34
2025-05-25 01:37:45.790 [Thread-49] INFO  c.b.bgai.interceptor.SeataTransactionInterceptor - 开始分布式事务: XID=seata-server:8091:153776404394049552, 方法=com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive
2025-05-25 01:37:45.801 [Thread-49] INFO  org.reflections.Reflections - Processing reactive request: content length=54, apiUrl=https://api.deepseek.com/chat/completions, modelName=deepseek-chat, userId=689258T, multiTurn=false
2025-05-25 01:37:45.827 [Thread-49] INFO  com.bgpay.bgai.transaction.TransactionCoordinator - Transaction prepared for user 689258T: chatCompletionId=chat-9d359bec-5596-4dd0-b1e0-9646444da3ff
2025-05-25 01:37:45.828 [Thread-49] INFO  org.reflections.Reflections - Generated request JSON with 2PC transaction: {"stream":false,"max_tokens":2000,"temperature":1.0,"messages":[{"content":"You are a helpful assist...
2025-05-25 01:37:45.852 [Thread-49] INFO  c.b.bgai.service.impl.TransactionLogServiceImpl - 记录分布式事务结束: XID=seata-server:8091:153776404394049552, 状态=COMMITTED
2025-05-25 01:37:45.854 [Thread-49] DEBUG c.b.bgai.mapper.TransactionLogMapper.selectList - ==>  Preparing: SELECT id,xid,branch_id,transaction_name,transaction_mode,status,request_path,source_ip,start_time,end_time,user_id,extra_data,create_time,update_time FROM transaction_log WHERE (xid = ?) LIMIT 1
2025-05-25 01:37:45.857 [Thread-49] DEBUG c.b.bgai.mapper.TransactionLogMapper.selectList - ==> Parameters: seata-server:8091:153776404394049552(String)
2025-05-25 01:37:45.865 [Thread-49] DEBUG c.b.bgai.mapper.TransactionLogMapper.selectList - <==      Total: 1
2025-05-25 01:37:45.872 [Thread-49] DEBUG c.b.bgai.mapper.TransactionLogMapper.updateById - ==>  Preparing: UPDATE transaction_log SET xid=?, transaction_name=?, transaction_mode=?, status=?, request_path=?, source_ip=?, start_time=?, end_time=?, user_id=?, extra_data=?, create_time=?, update_time=? WHERE id=?
2025-05-25 01:37:45.879 [Thread-49] DEBUG c.b.bgai.mapper.TransactionLogMapper.updateById - ==> Parameters: seata-server:8091:153776404394049552(String), com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive(String), AT(String), COMMITTED(String), (String), (String), 2025-05-25T01:37:45(LocalDateTime), 2025-05-25T01:37:45.865379800(LocalDateTime), system(String), {"duration":56,"result":"success"}(String), 2025-05-25T01:37:45(LocalDateTime), 2025-05-25T01:37:45.865379800(LocalDateTime), 34(Long)
2025-05-25 01:37:45.947 [Thread-49] DEBUG c.b.bgai.mapper.TransactionLogMapper.updateById - <==    Updates: 1
2025-05-25 01:37:45.967 [Thread-49] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:153776404394049552, branchId:153776404394049555, lockKeys:transaction_log:34
2025-05-25 01:37:46.006 [Thread-49] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:153776404394049552, branchId:153776404394049556, lockKeys:undo_log:135;transaction_log:34
2025-05-25 01:37:46.030 [Thread-49] INFO  c.b.bgai.interceptor.SeataTransactionInterceptor - 分布式事务成功完成: XID=seata-server:8091:153776404394049552, 耗时=56ms
2025-05-25 01:37:46.030 [Thread-49] INFO  io.seata.tm.api.DefaultGlobalTransaction - transaction seata-server:8091:153776404394049552 will be commit
2025-05-25 01:37:46.043 [Thread-49] INFO  io.seata.tm.api.DefaultGlobalTransaction - transaction end, xid = seata-server:8091:153776404394049552
2025-05-25 01:37:46.043 [Thread-49] INFO  io.seata.tm.api.DefaultGlobalTransaction - [seata-server:8091:153776404394049552] commit status: Committed
2025-05-25 01:37:46.764 [rpcDispatch_RMROLE_1_1_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:153776404394049552', branchId=153776404394049553, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false,"skipCheckLock":true}'}
2025-05-25 01:37:46.765 [rpcDispatch_RMROLE_1_1_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:153776404394049552 153776404394049553 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false,"skipCheckLock":true}
2025-05-25 01:37:46.766 [rpcDispatch_RMROLE_1_1_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-25 01:37:46.777 [rpcDispatch_RMROLE_1_2_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:153776404394049552', branchId=153776404394049554, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false,"skipCheckLock":true}'}
2025-05-25 01:37:46.777 [rpcDispatch_RMROLE_1_2_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:153776404394049552 153776404394049554 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false,"skipCheckLock":true}
2025-05-25 01:37:46.777 [rpcDispatch_RMROLE_1_2_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-25 01:37:46.786 [rpcDispatch_RMROLE_1_3_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:153776404394049552', branchId=153776404394049555, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false}'}
2025-05-25 01:37:46.786 [rpcDispatch_RMROLE_1_3_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:153776404394049552 153776404394049555 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false}
2025-05-25 01:37:46.787 [rpcDispatch_RMROLE_1_3_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-25 01:37:46.796 [rpcDispatch_RMROLE_1_4_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:153776404394049552', branchId=153776404394049556, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false}'}
2025-05-25 01:37:46.796 [rpcDispatch_RMROLE_1_4_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:153776404394049552 153776404394049556 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false}
2025-05-25 01:37:46.796 [rpcDispatch_RMROLE_1_4_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-25 01:38:24.035 [reactor-http-nio-2] INFO  org.reflections.Reflections - Raw response received, length: 3371
2025-05-25 01:38:24.041 [reactor-http-nio-2] WARN  org.reflections.Reflections - Received different chatCompletionId from response: 11605165-5955-4af9-b59a-64270b12b364 vs prepared: chat-9d359bec-5596-4dd0-b1e0-9646444da3ff
2025-05-25 01:38:24.057 [reactor-http-nio-2] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - ==>  Preparing: INSERT INTO chat_completions ( object, created, model, system_fingerprint, api_key ) VALUES ( ?, ?, ?, ?, ? )
2025-05-25 01:38:24.057 [reactor-http-nio-2] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - ==> Parameters: chat.completion(String), 1748108304055(Long), deepseek-chat(String), 689258T(String), chat-9d359bec-5596-4dd0-b1e0-9646444da3ff(String)
2025-05-25 01:38:24.067 [reactor-http-nio-2] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - <==    Updates: 1
2025-05-25 01:38:24.068 [reactor-http-nio-2] INFO  com.bgpay.bgai.transaction.TransactionCoordinator - Transaction committed for user 689258T: chatCompletionId=chat-9d359bec-5596-4dd0-b1e0-9646444da3ff
2025-05-25 01:38:24.097 [FileWrite-1] INFO  com.bgpay.bgai.service.deepseek.FileWriterService - Successfully wrote content to: \var\data\ai_responses\c7d13923-3254-45d7-89e6-d6d0887fb90d.txt
2025-05-25 01:38:24.108 [boundedElastic-1] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - ==>  Preparing: INSERT INTO chat_completions ( object, created, model, system_fingerprint, api_key ) VALUES ( ?, ?, ?, ?, ? )
2025-05-25 01:38:24.109 [boundedElastic-1] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - ==> Parameters: chat.completion(String), 1748108266(Long), deepseek-chat(String), fp_8802369eaa_prod0425fp8(String), chat-9d359bec-5596-4dd0-b1e0-9646444da3ff(String)
2025-05-25 01:38:24.126 [boundedElastic-1] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - <==    Updates: 1
2025-05-25 01:38:24.160 [boundedElastic-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.insert - ==>  Preparing: INSERT INTO usage_info ( chat_completion_id, prompt_tokens, completion_tokens, total_tokens, prompt_tokens_cached, completion_reasoning_tokens, prompt_cache_hit_tokens, prompt_cache_miss_tokens, created_at, model_type ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-05-25 01:38:24.161 [boundedElastic-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.insert - ==> Parameters: chat-9d359bec-5596-4dd0-b1e0-9646444da3ff(String), 30(Integer), 800(Integer), 830(Integer), 0(Integer), 0(Integer), 0(Integer), 30(Integer), 2025-05-25T01:38:24.153526600(LocalDateTime), deepseek-chat(String)
2025-05-25 01:38:24.206 [boundedElastic-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.insert - <==    Updates: 1
2025-05-25 01:38:24.226 [boundedElastic-1] INFO  org.reflections.Reflections - Completion data saved synchronously for chatCompletionId: chat-9d359bec-5596-4dd0-b1e0-9646444da3ff
2025-05-25 01:38:24.229 [boundedElastic-2] INFO  org.reflections.Reflections - 开始发送账单消息，chatCompletionId: chat-9d359bec-5596-4dd0-b1e0-9646444da3ff, userId: 689258T
2025-05-25 01:38:24.294 [boundedElastic-2] INFO  org.reflections.Reflections - 账单消息发送成功，chatCompletionId: chat-9d359bec-5596-4dd0-b1e0-9646444da3ff, userId: 689258T
2025-05-25 01:38:24.297 [boundedElastic-1] INFO  org.reflections.Reflections - Complete processing chain completed: # Java代码实现乐观锁和悲观锁

乐观锁和悲观锁是并发控制中两种重要的策略，下面我将分别展示它们在Java中的实现方式。

## 悲观锁实现

悲观锁假设会发生并发冲突，因此在访问数据前会先加锁。Java中的`synchronized`关键字和`ReentrantLock`类都是悲观锁的实现。

### 1. 使用synchronized实现悲观锁

```java
public class PessimisticLockDemo {
    private int counter = 0;
    
    public synchronized void increment() {
        counter++; // 同步方法，同一时间只有一个线程能执行
    }
    
    public synchronized int getCounter() {
        return counter;
    }
}
```

### 2. 使用ReentrantLock实现悲观锁

```java
import java.util.concurrent.locks.ReentrantLock;

public class PessimisticLockWithReentrant {
    private int counter = 0;
    private final ReentrantLock lock = new ReentrantLock();
    
    public void increment() {
        lock.lock(); // 获取锁
        try {
            counter++;
        } finally {
            lock.unlock(); // 确保锁被释放
        }
    }
    
    public int getCounter() {
        lock.lock();
        try {
            return counter;
        } finally {
            lock.unlock();
        }
    }
}
```

## 乐观锁实现

乐观锁假设不会发生并发冲突，只在更新时检查是否有冲突。Java中可以通过版本号机制或CAS操作实现。

### 1. 使用版本号实现乐观锁

```java
public class OptimisticLockWithVersion {
    private int value;
    private int version; // 版本号
    
    public synchronized int getValue() {
        return value;
    }
    
    public synchronized int getVersion() {
        return version;
    }
    
    public synchronized boolean update(int expectedValue, int newValue, int expectedVersion) {
        if (this.value == expectedValue && this.version == expectedVersion) {
            this.value = newValue;
            this.version++; // 更新成功时版本号+1
            return true;
        }
        return false; // 更新失败
    }
}
```

### 2. 使用Atomic类实现乐观锁(CAS)

```java
import java.util.concurrent.atomic.AtomicInteger;

public class OptimisticLockWithCAS {
    private AtomicInteger counter = new AtomicInteger(0);
    
    public void increment() {
        int oldValue;
        int newValue;
        do {
            oldValue = counter.get(); // 获取当前值
            newValue = oldValue + 1;  // 计算新值
        } while (!counter.compareAndSet(oldValue, newValue)); // CAS操作
    }
    
    public int getCounter() {
        return counter.get();
    }
}
```

## 使用场景对比

- **悲观锁**适合写操作多的场景，能防止并发修改导致的数据不一致
- **乐观锁**适合读操作多的场景，能提高并发性能，减少锁的开销

## 实际应用示例

### 数据库乐观锁实现

```java
// 假设有一个User实体类
public class User {
    private int id;
    private String name;
    private int version; // 乐观锁版本号
    
    // getters and setters
}

// 更新操作
public boolean updateUser(User user) {
    // 伪代码表示数据库更新操作
    int affectedRows = executeUpdate(
        "UPDATE users SET name = ?, version = version + 1 WHERE id = ? AND version = ?",
        user.getName(), user.getId(), user.getVersion());
    return affectedRows > 0;
}
```

以上代码展示了Java中乐观锁和悲观锁的主要实现方式，开发者可以根据具体场景选择合适的并发控制策略。
2025-05-25 01:38:24.297 [boundedElastic-1] INFO  com.bgpay.bgai.controller.ReactiveChatController - Processed response for user 689258T, content length: 2787
2025-05-25 01:38:44.626 [pool-5-thread-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.selectCount - ==>  Preparing: SELECT COUNT( * ) AS total FROM usage_info WHERE (chat_completion_id = ?)
2025-05-25 01:38:44.626 [pool-5-thread-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.selectCount - ==> Parameters: chat-9d359bec-5596-4dd0-b1e0-9646444da3ff(String)
2025-05-25 01:38:44.634 [pool-5-thread-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.selectCount - <==      Total: 1
2025-05-25 01:38:44.728 [ConsumeMessageThread_billing-consumer-group_1] DEBUG c.bgpay.bgai.mapper.PriceConfigMapper.selectList - ==>  Preparing: SELECT id,model_type,time_period,cache_status,io_type,price,version,effective_time FROM price_config WHERE (model_type = ? AND time_period = ? AND io_type = ? AND effective_time <= ? AND cache_status = ?) ORDER BY effective_time DESC LIMIT 1
2025-05-25 01:38:44.728 [ConsumeMessageThread_billing-consumer-group_1] DEBUG c.bgpay.bgai.mapper.PriceConfigMapper.selectList - ==> Parameters: deepseek-chat(String), standard(String), input(String), 2025-05-25T01:38:44.726920(LocalDateTime), miss(String)
2025-05-25 01:38:44.740 [ConsumeMessageThread_billing-consumer-group_1] DEBUG c.bgpay.bgai.mapper.PriceConfigMapper.selectList - <==      Total: 1
2025-05-25 01:38:44.792 [ConsumeMessageThread_billing-consumer-group_1] DEBUG c.bgpay.bgai.mapper.PriceConfigMapper.selectList - ==>  Preparing: SELECT id,model_type,time_period,cache_status,io_type,price,version,effective_time FROM price_config WHERE (model_type = ? AND time_period = ? AND io_type = ? AND effective_time <= ? AND cache_status IS NULL) ORDER BY effective_time DESC LIMIT 1
2025-05-25 01:38:44.793 [ConsumeMessageThread_billing-consumer-group_1] DEBUG c.bgpay.bgai.mapper.PriceConfigMapper.selectList - ==> Parameters: deepseek-chat(String), standard(String), output(String), 2025-05-25T01:38:44.791839300(LocalDateTime)
2025-05-25 01:38:44.797 [ConsumeMessageThread_billing-consumer-group_1] DEBUG c.bgpay.bgai.mapper.PriceConfigMapper.selectList - <==      Total: 1
2025-05-25 01:38:44.856 [ConsumeMessageThread_billing-consumer-group_1] INFO  c.bgpay.bgai.service.mq.RocketMQBillingServiceImpl - Output price config priceVersion: 1
2025-05-25 01:38:44.858 [ConsumeMessageThread_billing-consumer-group_1] DEBUG com.bgpay.bgai.mapper.UsageRecordMapper.insert - ==>  Preparing: INSERT INTO usage_record ( model_type, chat_completion_id, user_id, input_cost, output_cost, price_version, calculated_at ) VALUES ( ?, ?, ?, ?, ?, ?, ? )
2025-05-25 01:38:44.859 [ConsumeMessageThread_billing-consumer-group_1] DEBUG com.bgpay.bgai.mapper.UsageRecordMapper.insert - ==> Parameters: deepseek-chat(String), chat-9d359bec-5596-4dd0-b1e0-9646444da3ff(String), 689258T(String), 0.0001(BigDecimal), 0.0064(BigDecimal), 1(Integer), 2025-05-25T01:38:44.857867500(LocalDateTime)
2025-05-25 01:38:44.879 [ConsumeMessageThread_billing-consumer-group_1] DEBUG com.bgpay.bgai.mapper.UsageRecordMapper.insert - <==    Updates: 1
2025-05-25 01:38:44.888 [ConsumeMessageThread_billing-consumer-group_1] INFO  c.bgpay.bgai.service.mq.RocketMQBillingServiceImpl - Message consumed: 2408820C7528D042C1858EDCF30D3D9176BC36BAF30C7BF2B7810000
2025-05-25 01:39:00.097 [Thread-7] WARN  com.alibaba.nacos.common.notify.NotifyCenter - [NotifyCenter] Start destroying Publisher
2025-05-25 01:39:00.097 [Thread-7] WARN  com.alibaba.nacos.common.notify.NotifyCenter - [NotifyCenter] Destruction of the end
2025-05-25 01:39:00.097 [Thread-1] WARN  c.alibaba.nacos.common.http.HttpClientBeanHolder - [HttpClientBeanHolder] Start destroying common HttpClient
2025-05-25 01:39:00.097 [Thread-1] WARN  c.alibaba.nacos.common.http.HttpClientBeanHolder - [HttpClientBeanHolder] Destruction of the end
2025-05-25 01:39:00.126 [SpringContextShutdownHook] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - De-registering from Nacos Server now...
2025-05-25 01:39:00.126 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - [DEREGISTER-SERVICE] d750d92e-152f-4055-a641-3bc9dda85a29 deregistering service bgtech-ai with instance: Instance{instanceId='null', ip='192.168.86.8', port=8080, weight=1.0, healthy=true, enabled=true, ephemeral=true, clusterName='DEFAULT', serviceName='null', metadata={}}
2025-05-25 01:39:00.138 [SpringContextShutdownHook] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - De-registration finished.
2025-05-25 01:39:00.140 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.cache.ServiceInfoHolder do shutdown begin
2025-05-25 01:39:00.140 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.backups.FailoverReactor do shutdown begin
2025-05-25 01:39:00.140 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.backups.FailoverReactor do shutdown stop
2025-05-25 01:39:00.140 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.cache.ServiceInfoHolder do shutdown stop
2025-05-25 01:39:00.140 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.NamingClientProxyDelegate do shutdown begin
2025-05-25 01:39:00.140 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServiceInfoUpdateService do shutdown begin
2025-05-25 01:39:00.140 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServiceInfoUpdateService do shutdown stop
2025-05-25 01:39:00.140 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServerListManager do shutdown begin
2025-05-25 01:39:00.140 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Start destroying NacosRestTemplate
2025-05-25 01:39:00.140 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Destruction of the end
2025-05-25 01:39:00.140 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServerListManager do shutdown stop
2025-05-25 01:39:00.140 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.http.NamingHttpClientProxy do shutdown begin
2025-05-25 01:39:00.140 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Start destroying NacosRestTemplate
2025-05-25 01:39:00.140 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Destruction of the end
2025-05-25 01:39:00.140 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.http.NamingHttpClientProxy do shutdown stop
2025-05-25 01:39:00.140 [SpringContextShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Shutdown rpc client, set status to shutdown
2025-05-25 01:39:00.140 [SpringContextShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Shutdown client event executor java.util.concurrent.ScheduledThreadPoolExecutor@206185b3[Running, pool size = 2, active threads = 2, queued tasks = 0, completed tasks = 0]
2025-05-25 01:39:00.141 [SpringContextShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Close current connection 1748108257109_139.227.195.192_48562
2025-05-25 01:39:00.144 [nacos-grpc-client-executor-8.133.246.113-27] WARN  c.a.nacos.common.remote.client.grpc.GrpcClient - [1748108257109_139.227.195.192_48562]Ignore error event,isRunning:false,isAbandon=false
2025-05-25 01:39:00.146 [SpringContextShutdownHook] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - Shutdown grpc executor java.util.concurrent.ThreadPoolExecutor@4fd7ded3[Running, pool size = 4, active threads = 0, queued tasks = 0, completed tasks = 28]
2025-05-25 01:39:00.146 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - Shutdown grpc redo service executor java.util.concurrent.ScheduledThreadPoolExecutor@177e6486[Running, pool size = 1, active threads = 0, queued tasks = 1, completed tasks = 27]
2025-05-25 01:39:00.147 [SpringContextShutdownHook] INFO  c.a.n.client.auth.ram.identify.CredentialWatcher - [null] CredentialWatcher is stopped
2025-05-25 01:39:00.147 [SpringContextShutdownHook] INFO  c.a.n.client.auth.ram.identify.CredentialService - [null] CredentialService is freed
2025-05-25 01:39:00.147 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.NamingClientProxyDelegate do shutdown stop
2025-05-25 01:39:00.156 [SpringContextShutdownHook] DEBUG com.bgpay.bgai.config.AsyncConfig$1 - Shutting down ExecutorService 'blockingExecutor'
2025-05-25 01:39:01.818 [com.alibaba.nacos.client.Worker] INFO  c.a.n.client.auth.ram.identify.CredentialWatcher - null No credential found
2025-05-25 01:39:02.243 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:10911] result: true
2025-05-25 01:39:02.243 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:10909] result: true
2025-05-25 01:39:02.243 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:9876] result: true
2025-05-25 01:39:02.269 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:9876] result: true
2025-05-25 01:39:02.269 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:10911] result: true
2025-05-25 01:39:02.397 [SpringContextShutdownHook] INFO  o.s.orm.jpa.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-05-25 01:39:02.399 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-2} closing ...
2025-05-25 01:39:02.405 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-2} closed
2025-05-25 01:39:02.406 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} closing ...
2025-05-25 01:39:02.406 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} closed
2025-05-25 01:39:02.407 [NettyClientSelector_TMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - channel inactive: [id: 0x2189d796, L:/192.168.86.8:62571 ! R:/8.133.246.113:8091]
2025-05-25 01:39:02.407 [NettyClientSelector_TMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - return to pool, rm channel:[id: 0x2189d796, L:/192.168.86.8:62571 ! R:/8.133.246.113:8091]
2025-05-25 01:39:02.407 [NettyClientSelector_TMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - channel valid false,channel:[id: 0x2189d796, L:/192.168.86.8:62571 ! R:/8.133.246.113:8091]
2025-05-25 01:39:02.407 [NettyClientSelector_TMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - will destroy channel:[id: 0x2189d796, L:/192.168.86.8:62571 ! R:/8.133.246.113:8091]
2025-05-25 01:39:02.407 [NettyClientSelector_TMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0x2189d796, L:/192.168.86.8:62571 ! R:/8.133.246.113:8091]) will closed
2025-05-25 01:39:02.407 [NettyClientSelector_TMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0x2189d796, L:/192.168.86.8:62571 ! R:/8.133.246.113:8091]) will closed
2025-05-25 01:39:02.408 [NettyClientSelector_RMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - channel inactive: [id: 0xed1e6153, L:/192.168.86.8:62575 ! R:/8.133.246.113:8091]
2025-05-25 01:39:02.409 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - return to pool, rm channel:[id: 0xed1e6153, L:/192.168.86.8:62575 ! R:/8.133.246.113:8091]
2025-05-25 01:39:02.409 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - channel valid false,channel:[id: 0xed1e6153, L:/192.168.86.8:62575 ! R:/8.133.246.113:8091]
2025-05-25 01:39:02.409 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - will destroy channel:[id: 0xed1e6153, L:/192.168.86.8:62575 ! R:/8.133.246.113:8091]
2025-05-25 01:39:02.409 [NettyClientSelector_RMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0xed1e6153, L:/192.168.86.8:62575 ! R:/8.133.246.113:8091]) will closed
2025-05-25 01:39:02.409 [NettyClientSelector_RMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0xed1e6153, L:/192.168.86.8:62575 ! R:/8.133.246.113:8091]) will closed
2025-05-25 01:48:23.174 [main] WARN  com.alibaba.nacos.client.logging.NacosLogging - Load Logback Configuration of Nacos fail, message: Could not initialize Logback Nacos logging from classpath:nacos-logback.xml
2025-05-25 01:48:23.175 [main] INFO  com.bgpay.bgai.BgaiApplication - The following 1 profile is active: "dev"
2025-05-25 01:48:24.725 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-05-25 01:48:24.727 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-05-25 01:48:24.753 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 20 ms. Found 0 JPA repository interfaces.
2025-05-25 01:48:24.766 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-05-25 01:48:24.767 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-05-25 01:48:24.779 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 5 ms. Found 0 Redis repository interfaces.
2025-05-25 01:48:25.394 [main] INFO  io.seata.config.ConfigurationFactory - load Configuration from :Spring Configuration
2025-05-25 01:48:25.404 [main] INFO  io.seata.config.ConfigurationFactory - load Configuration from :Spring Configuration
2025-05-25 01:48:25.411 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Initializing Global Transaction Clients ... 
2025-05-25 01:48:25.542 [main] INFO  io.seata.core.rpc.netty.NettyClientBootstrap - NettyClientBootstrap has started
2025-05-25 01:48:25.543 [main] INFO  io.seata.discovery.registry.RegistryFactory - use registry center type: file
2025-05-25 01:48:25.555 [main] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - will connect to 8.133.246.113:8091
2025-05-25 01:48:25.562 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - NettyPool create channel to transactionRole:TMROLE,address:8.133.246.113:8091,msg:< RegisterTMRequest{version='1.7.0', applicationId='bgtech-ai', transactionServiceGroup='bgai-tx-group', extraData='ak=null
digest=bgai-tx-group,192.168.86.8,1748108905560
timestamp=1748108905560
authVersion=V4
vgroup=bgai-tx-group
ip=192.168.86.8
'} >
2025-05-25 01:48:25.783 [main] INFO  io.seata.core.rpc.netty.TmNettyRemotingClient - register TM success. client version:1.7.0, server version:1.8.1-SNAPSHOT,channel:[id: 0x13961b47, L:/192.168.86.8:53299 - R:/8.133.246.113:8091]
2025-05-25 01:48:25.789 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - register success, cost 66 ms, version:1.8.1-SNAPSHOT,role:TMROLE,channel:[id: 0x13961b47, L:/192.168.86.8:53299 - R:/8.133.246.113:8091]
2025-05-25 01:48:25.790 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Transaction Manager Client is initialized. applicationId[bgtech-ai] txServiceGroup[bgai-tx-group]
2025-05-25 01:48:25.802 [main] INFO  io.seata.rm.datasource.AsyncWorker - Async Commit Buffer Limit: 10000
2025-05-25 01:48:25.803 [main] INFO  io.seata.rm.datasource.xa.ResourceManagerXA - ResourceManagerXA init ...
2025-05-25 01:48:25.808 [main] INFO  io.seata.core.rpc.netty.NettyClientBootstrap - NettyClientBootstrap has started
2025-05-25 01:48:25.809 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Resource Manager is initialized. applicationId[bgtech-ai] txServiceGroup[bgai-tx-group]
2025-05-25 01:48:25.809 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Global Transaction Clients are initialized. 
2025-05-25 01:48:26.945 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat initialized with port(s): 8080 (http)
2025-05-25 01:48:26.955 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - The ["http-nio-8080"] connector has been configured to support HTTP upgrade to [h2c]
2025-05-25 01:48:26.955 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - Initializing ProtocolHandler ["http-nio-8080"]
2025-05-25 01:48:26.957 [main] INFO  org.apache.catalina.core.StandardService - Starting service [Tomcat]
2025-05-25 01:48:26.958 [main] INFO  org.apache.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.15]
2025-05-25 01:48:27.437 [main] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} inited
2025-05-25 01:48:27.711 [main] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - will connect to 8.133.246.113:8091
2025-05-25 01:48:27.711 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - RM will register :jdbc:mysql://8.133.246.113:3306/deepseek
2025-05-25 01:48:27.711 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - NettyPool create channel to transactionRole:RMROLE,address:8.133.246.113:8091,msg:< RegisterRMRequest{resourceIds='jdbc:mysql://8.133.246.113:3306/deepseek', version='1.7.0', applicationId='bgtech-ai', transactionServiceGroup='bgai-tx-group', extraData='null'} >
2025-05-25 01:48:27.730 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - register RM success. client version:1.7.0, server version:1.8.1-SNAPSHOT,channel:[id: 0x59cbb873, L:/192.168.86.8:53305 - R:/8.133.246.113:8091]
2025-05-25 01:48:27.730 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - register success, cost 12 ms, version:1.8.1-SNAPSHOT,role:RMROLE,channel:[id: 0x59cbb873, L:/192.168.86.8:53305 - R:/8.133.246.113:8091]
2025-05-25 01:48:27.732 [main] INFO  i.s.s.a.datasource.SeataAutoDataSourceProxyCreator - Auto proxy data source 'masterDataSource' by 'AT' mode.
2025-05-25 01:48:27.798 [main] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-2} inited
2025-05-25 01:48:27.874 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - will register resourceId:jdbc:mysql://8.133.246.113:3306/deepseek
2025-05-25 01:48:27.875 [main] INFO  i.s.s.a.datasource.SeataAutoDataSourceProxyCreator - Auto proxy data source 'slaveDataSource' by 'AT' mode.
2025-05-25 01:48:27.884 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.rm.AbstractRMHandler - the rm client received response msg [RegisterRMResponse{version='1.8.1-SNAPSHOT', extraData='null', identified=true, resultCode=null, msg='null'}] from tc server.
2025-05-25 01:48:27.899 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - will register resourceId:jdbc:mysql://8.133.246.113:3306/deepseek
2025-05-25 01:48:27.900 [main] INFO  i.s.s.a.datasource.SeataAutoDataSourceProxyCreator - Auto proxy data source 'dynamicDataSource' by 'AT' mode.
2025-05-25 01:48:27.908 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.rm.AbstractRMHandler - the rm client received response msg [RegisterRMResponse{version='1.8.1-SNAPSHOT', extraData='null', identified=true, resultCode=null, msg='null'}] from tc server.
2025-05-25 01:48:28.040 [main] INFO  org.hibernate.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-05-25 01:48:28.108 [main] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.1.7.Final
2025-05-25 01:48:28.459 [main] INFO  SQL dialect - HHH000400: Using dialect: org.hibernate.dialect.MySQL8Dialect
2025-05-25 01:48:28.461 [main] WARN  org.hibernate.orm.deprecation - HHH90000026: MySQL8Dialect has been deprecated; use org.hibernate.dialect.MySQLDialect instead
2025-05-25 01:48:28.854 [main] INFO  o.h.e.t.jta.platform.internal.JtaPlatformInitiator - HHH000490: Using JtaPlatform implementation: [org.hibernate.engine.transaction.jta.platform.internal.NoJtaPlatform]
2025-05-25 01:48:28.866 [main] INFO  o.s.orm.jpa.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-05-25 01:48:29.253 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-25 01:48:29.264 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-25 01:48:29.290 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-25 01:48:29.292 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-25 01:48:29.293 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-25 01:48:29.303 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-25 01:48:29.964 [main] INFO  com.bgpay.bgai.service.impl.UserServiceImpl - 初始化SSO配置: clientId=bgai-client-id, redirectUri=http://localhost:8080/api/auth/callback
2025-05-25 01:48:30.133 [main] INFO  com.bgpay.bgai.controller.AuthController - 初始化认证控制器: clientId=bgai-client-id, redirectUri=http://localhost:8080/api/auth/callback
2025-05-25 01:48:30.658 [main] INFO  o.a.r.s.autoconfigure.RocketMQAutoConfiguration - a producer (billing-producer-group) init on namesrv 8.133.246.113:9876
2025-05-25 01:48:31.377 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Bean [com.bgpay.bgai.service.deepseek.DeepSeekServiceImp$$SpringCGLIB$$0] with name [deepSeekServiceImp] would use interceptor [io.seata.spring.annotation.GlobalTransactionalInterceptor]
2025-05-25 01:48:31.729 [main] WARN  i.s.s.b.a.provider.SpringBootConfigurationProvider - The get method not found for the field 'SeataProperties#accesskey'.
2025-05-25 01:48:31.729 [main] WARN  i.s.s.b.a.provider.SpringBootConfigurationProvider - The get method not found for the field 'SeataProperties#secretkey'.
2025-05-25 01:48:31.747 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 加载到1个Saga状态机定义文件
2025-05-25 01:48:31.902 [main] INFO  com.bgpay.bgai.saga.CustomSagaJsonParser - 开始解析状态机定义: bgai-saga-transaction
2025-05-25 01:48:31.902 [main] INFO  com.bgpay.bgai.saga.CustomSagaJsonParser - 状态机定义解析成功: bgai-saga-transaction
2025-05-25 01:48:31.902 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 成功加载状态机定义: /E:/project/bgai/target/classes/statelang/bgai-saga-transaction.json
2025-05-25 01:48:32.360 [main] INFO  org.redisson.Version - Redisson 3.24.3
2025-05-25 01:48:32.501 [redisson-netty-4-4] INFO  o.r.connection.pool.MasterPubSubConnectionPool - 1 connections initialized for 8.133.246.113/8.133.246.113:6379
2025-05-25 01:48:32.867 [redisson-netty-4-19] INFO  org.redisson.connection.pool.MasterConnectionPool - 24 connections initialized for 8.133.246.113/8.133.246.113:6379
2025-05-25 01:48:33.147 [main] INFO  com.bgpay.bgai.service.mq.MQConsumerService - MQ consumer startup successful [group=billing-consumer-group, topic=BILLING_TOPIC, tag=USER_BILLING]
2025-05-25 01:48:33.403 [main] DEBUG com.bgpay.bgai.config.AsyncConfig$1 - Initializing ExecutorService 'blockingExecutor'
2025-05-25 01:48:33.427 [main] INFO  c.b.bgai.config.NacosConfig$NacosWarningHandler - Nacos警告处理器已启用，将忽略配置中心连接警告
2025-05-25 01:48:34.702 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [After]
2025-05-25 01:48:34.702 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Before]
2025-05-25 01:48:34.702 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Between]
2025-05-25 01:48:34.703 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Cookie]
2025-05-25 01:48:34.703 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Header]
2025-05-25 01:48:34.703 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Host]
2025-05-25 01:48:34.703 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Method]
2025-05-25 01:48:34.703 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Path]
2025-05-25 01:48:34.703 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Query]
2025-05-25 01:48:34.703 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [ReadBody]
2025-05-25 01:48:34.703 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [RemoteAddr]
2025-05-25 01:48:34.703 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [XForwardedRemoteAddr]
2025-05-25 01:48:34.703 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Weight]
2025-05-25 01:48:34.703 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [CloudFoundryRouteService]
2025-05-25 01:48:36.157 [main] INFO  o.s.b.actuate.endpoint.web.EndpointLinksResolver - Exposing 3 endpoint(s) beneath base path '/actuator'
2025-05-25 01:48:37.751 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - Starting ProtocolHandler ["http-nio-8080"]
2025-05-25 01:48:37.766 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat started on port(s): 8080 (http) with context path ''
2025-05-25 01:48:37.778 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from ans.namespace attribute : null
2025-05-25 01:48:37.778 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from ALIBABA_ALIWARE_NAMESPACE attribute :null
2025-05-25 01:48:37.779 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from namespace attribute :null
2025-05-25 01:48:37.789 [main] INFO  c.a.n.p.auth.spi.client.ClientAuthPluginManager - [ClientAuthPluginManager] Load ClientAuthService com.alibaba.nacos.client.auth.impl.NacosClientAuthServiceImpl success.
2025-05-25 01:48:37.789 [main] INFO  c.a.n.p.auth.spi.client.ClientAuthPluginManager - [ClientAuthPluginManager] Load ClientAuthService com.alibaba.nacos.client.auth.ram.RamClientAuthServiceImpl success.
2025-05-25 01:48:37.793 [main] INFO  com.alibaba.nacos.common.remote.client - [RpcClientFactory] create a new rpc client of 1f3a2ee9-6cf6-43d4-882f-f4b111b8599c
2025-05-25 01:48:37.795 [main] INFO  com.alibaba.nacos.common.remote.client - [1f3a2ee9-6cf6-43d4-882f-f4b111b8599c] RpcClient init, ServerListFactory = com.alibaba.nacos.client.naming.core.ServerListManager
2025-05-25 01:48:37.795 [main] INFO  com.alibaba.nacos.common.remote.client - [1f3a2ee9-6cf6-43d4-882f-f4b111b8599c] Registry connection listener to current client:com.alibaba.nacos.client.naming.remote.gprc.redo.NamingGrpcRedoService
2025-05-25 01:48:37.796 [main] INFO  com.alibaba.nacos.common.remote.client - [1f3a2ee9-6cf6-43d4-882f-f4b111b8599c] Register server push request handler:com.alibaba.nacos.client.naming.remote.gprc.NamingPushRequestHandler
2025-05-25 01:48:37.796 [main] INFO  com.alibaba.nacos.common.remote.client - [1f3a2ee9-6cf6-43d4-882f-f4b111b8599c] Try to connect to server on start up, server: {serverIp = '8.133.246.113', server main port = 8848}
2025-05-25 01:48:37.796 [main] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - grpc client connection server:8.133.246.113 ip,serverPort:9848,grpcTslConfig:{"sslProvider":"OPENSSL","enableTls":false,"mutualAuthEnable":false,"trustAll":false}
2025-05-25 01:48:37.927 [main] INFO  com.alibaba.nacos.common.remote.client - [1f3a2ee9-6cf6-43d4-882f-f4b111b8599c] Success to connect to server [8.133.246.113:8848] on start up, connectionId = 1748108917835_139.227.195.192_49329
2025-05-25 01:48:37.927 [main] INFO  com.alibaba.nacos.common.remote.client - [1f3a2ee9-6cf6-43d4-882f-f4b111b8599c] Register server push request handler:com.alibaba.nacos.common.remote.client.RpcClient$ConnectResetRequestHandler
2025-05-25 01:48:37.927 [com.alibaba.nacos.client.remote.worker] INFO  com.alibaba.nacos.common.remote.client - [1f3a2ee9-6cf6-43d4-882f-f4b111b8599c] Notify connected event to listeners.
2025-05-25 01:48:37.927 [main] INFO  com.alibaba.nacos.common.remote.client - [1f3a2ee9-6cf6-43d4-882f-f4b111b8599c] Register server push request handler:com.alibaba.nacos.common.remote.client.RpcClient$$Lambda/0x0000027727544518
2025-05-25 01:48:37.927 [com.alibaba.nacos.client.remote.worker] INFO  com.alibaba.nacos.client.naming - Grpc connection connect
2025-05-25 01:48:37.929 [main] INFO  com.alibaba.nacos.client.naming - [REGISTER-SERVICE] d750d92e-152f-4055-a641-3bc9dda85a29 registering service bgtech-ai with instance Instance{instanceId='null', ip='192.168.86.8', port=8080, weight=1.0, healthy=true, enabled=true, ephemeral=true, clusterName='DEFAULT', serviceName='null', metadata={IPv6=[2408:820c:7528:d042:c185:8edc:f30d:3d91], preserved.register.source=SPRING_CLOUD}}
2025-05-25 01:48:37.952 [main] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - nacos registry, DEFAULT_GROUP bgtech-ai 192.168.86.8:8080 register finished
2025-05-25 01:48:38.014 [main] INFO  com.bgpay.bgai.config.NacosConfig - 应用启动完成，当前环境: dev
2025-05-25 01:48:38.014 [main] INFO  com.bgpay.bgai.config.NacosConfig - Nacos配置中心: 8.133.246.113:8848, 命名空间: d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-25 01:48:38.014 [main] INFO  com.bgpay.bgai.config.NacosConfig - 注意: 如果看到Nacos配置加载警告，但应用正常启动，说明应用正在使用本地配置文件
2025-05-25 01:48:38.015 [main] INFO  com.bgpay.bgai.BgaiApplication - Started BgaiApplication in 17.419 seconds (process running for 18.964)
2025-05-25 01:48:38.019 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-25 01:48:38.020 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-25 01:48:38.046 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-25 01:48:38.046 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-25 01:48:38.046 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-25 01:48:38.061 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-25 01:48:38.061 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-25 01:48:38.061 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-25 01:48:38.069 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-25 01:48:38.070 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-25 01:48:38.070 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-25 01:48:38.077 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-25 01:48:38.077 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - ==================== Saga状态机加载报告 ====================
2025-05-25 01:48:38.078 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - Saga状态机配置加载状态: 成功
2025-05-25 01:48:38.078 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 已加载的状态机定义文件数量: 1
2025-05-25 01:48:38.078 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 已加载的状态机定义文件:
2025-05-25 01:48:38.078 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig -  - /E:/project/bgai/target/classes/statelang/bgai-saga-transaction.json
2025-05-25 01:48:38.078 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - Saga解析器状态: CUSTOM_FASTJSON2
2025-05-25 01:48:38.078 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 状态机解析结果: 成功 1 个, 失败 0 个
2025-05-25 01:48:38.078 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - =============================================================
2025-05-25 01:48:38.081 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - nacos.cache.data.init.snapshot = true 
2025-05-25 01:48:38.082 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] common-dev.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-25 01:48:38.089 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=common-dev.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-25 01:48:38.089 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=common-dev.yaml, group=DEFAULT_GROUP
2025-05-25 01:48:38.089 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-25 01:48:38.089 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-25 01:48:38.089 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai.yaml, group=DEFAULT_GROUP
2025-05-25 01:48:38.091 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai-dev.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-25 01:48:38.091 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai-dev.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-25 01:48:38.091 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai-dev.yaml, group=DEFAULT_GROUP
2025-05-25 01:48:38.091 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-25 01:48:38.091 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai, group=DEFAULT_GROUP, cnt=1
2025-05-25 01:48:38.091 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai, group=DEFAULT_GROUP
2025-05-25 01:51:15.638 [Thread-1] WARN  c.alibaba.nacos.common.http.HttpClientBeanHolder - [HttpClientBeanHolder] Start destroying common HttpClient
2025-05-25 01:51:15.638 [Thread-7] WARN  com.alibaba.nacos.common.notify.NotifyCenter - [NotifyCenter] Start destroying Publisher
2025-05-25 01:51:15.638 [Thread-7] WARN  com.alibaba.nacos.common.notify.NotifyCenter - [NotifyCenter] Destruction of the end
2025-05-25 01:51:15.643 [Thread-1] WARN  c.alibaba.nacos.common.http.HttpClientBeanHolder - [HttpClientBeanHolder] Destruction of the end
2025-05-25 01:51:15.654 [SpringContextShutdownHook] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - De-registering from Nacos Server now...
2025-05-25 01:51:15.654 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - [DEREGISTER-SERVICE] d750d92e-152f-4055-a641-3bc9dda85a29 deregistering service bgtech-ai with instance: Instance{instanceId='null', ip='192.168.86.8', port=8080, weight=1.0, healthy=true, enabled=true, ephemeral=true, clusterName='DEFAULT', serviceName='null', metadata={}}
2025-05-25 01:51:15.662 [SpringContextShutdownHook] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - De-registration finished.
2025-05-25 01:51:15.663 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.cache.ServiceInfoHolder do shutdown begin
2025-05-25 01:51:15.663 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.backups.FailoverReactor do shutdown begin
2025-05-25 01:51:15.663 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.backups.FailoverReactor do shutdown stop
2025-05-25 01:51:15.663 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.cache.ServiceInfoHolder do shutdown stop
2025-05-25 01:51:15.663 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.NamingClientProxyDelegate do shutdown begin
2025-05-25 01:51:15.663 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServiceInfoUpdateService do shutdown begin
2025-05-25 01:51:15.663 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServiceInfoUpdateService do shutdown stop
2025-05-25 01:51:15.664 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServerListManager do shutdown begin
2025-05-25 01:51:15.664 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Start destroying NacosRestTemplate
2025-05-25 01:51:15.664 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Destruction of the end
2025-05-25 01:51:15.664 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServerListManager do shutdown stop
2025-05-25 01:51:15.664 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.http.NamingHttpClientProxy do shutdown begin
2025-05-25 01:51:15.664 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Start destroying NacosRestTemplate
2025-05-25 01:51:15.664 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Destruction of the end
2025-05-25 01:51:15.664 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.http.NamingHttpClientProxy do shutdown stop
2025-05-25 01:51:15.664 [SpringContextShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Shutdown rpc client, set status to shutdown
2025-05-25 01:51:15.664 [SpringContextShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Shutdown client event executor java.util.concurrent.ScheduledThreadPoolExecutor@7be4f55[Running, pool size = 2, active threads = 2, queued tasks = 0, completed tasks = 0]
2025-05-25 01:51:15.664 [SpringContextShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Close current connection 1748108917835_139.227.195.192_49329
2025-05-25 01:51:15.667 [nacos-grpc-client-executor-8.133.246.113-53] WARN  c.a.nacos.common.remote.client.grpc.GrpcClient - [1748108917835_139.227.195.192_49329]Ignore error event,isRunning:false,isAbandon=false
2025-05-25 01:51:15.668 [SpringContextShutdownHook] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - Shutdown grpc executor java.util.concurrent.ThreadPoolExecutor@21002025[Running, pool size = 5, active threads = 0, queued tasks = 0, completed tasks = 54]
2025-05-25 01:51:15.668 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - Shutdown grpc redo service executor java.util.concurrent.ScheduledThreadPoolExecutor@38527a68[Running, pool size = 1, active threads = 0, queued tasks = 1, completed tasks = 52]
2025-05-25 01:51:15.668 [SpringContextShutdownHook] INFO  c.a.n.client.auth.ram.identify.CredentialWatcher - [null] CredentialWatcher is stopped
2025-05-25 01:51:15.668 [SpringContextShutdownHook] INFO  c.a.n.client.auth.ram.identify.CredentialService - [null] CredentialService is freed
2025-05-25 01:51:15.668 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.NamingClientProxyDelegate do shutdown stop
2025-05-25 01:51:15.674 [SpringContextShutdownHook] DEBUG com.bgpay.bgai.config.AsyncConfig$1 - Shutting down ExecutorService 'blockingExecutor'
2025-05-25 01:51:16.744 [com.alibaba.nacos.client.Worker] INFO  c.a.n.client.auth.ram.identify.CredentialWatcher - null No credential found
2025-05-25 01:51:17.755 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:10911] result: true
2025-05-25 01:51:17.755 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:9876] result: true
2025-05-25 01:51:17.768 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:10911] result: true
2025-05-25 01:51:17.768 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:9876] result: true
2025-05-25 01:51:17.884 [SpringContextShutdownHook] INFO  o.s.orm.jpa.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-05-25 01:51:17.886 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-2} closing ...
2025-05-25 01:51:17.894 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-2} closed
2025-05-25 01:51:17.894 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} closing ...
2025-05-25 01:51:17.895 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} closed
2025-05-25 01:51:17.895 [NettyClientSelector_TMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - channel inactive: [id: 0x13961b47, L:/192.168.86.8:53299 ! R:/8.133.246.113:8091]
2025-05-25 01:51:17.895 [NettyClientSelector_TMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - return to pool, rm channel:[id: 0x13961b47, L:/192.168.86.8:53299 ! R:/8.133.246.113:8091]
2025-05-25 01:51:17.895 [NettyClientSelector_TMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - channel valid false,channel:[id: 0x13961b47, L:/192.168.86.8:53299 ! R:/8.133.246.113:8091]
2025-05-25 01:51:17.896 [NettyClientSelector_TMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - will destroy channel:[id: 0x13961b47, L:/192.168.86.8:53299 ! R:/8.133.246.113:8091]
2025-05-25 01:51:17.896 [NettyClientSelector_TMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0x13961b47, L:/192.168.86.8:53299 ! R:/8.133.246.113:8091]) will closed
2025-05-25 01:51:17.896 [NettyClientSelector_TMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0x13961b47, L:/192.168.86.8:53299 ! R:/8.133.246.113:8091]) will closed
2025-05-25 01:51:17.897 [NettyClientSelector_RMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - channel inactive: [id: 0x59cbb873, L:/192.168.86.8:53305 ! R:/8.133.246.113:8091]
2025-05-25 01:51:17.897 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - return to pool, rm channel:[id: 0x59cbb873, L:/192.168.86.8:53305 ! R:/8.133.246.113:8091]
2025-05-25 01:51:17.897 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - channel valid false,channel:[id: 0x59cbb873, L:/192.168.86.8:53305 ! R:/8.133.246.113:8091]
2025-05-25 01:51:17.897 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - will destroy channel:[id: 0x59cbb873, L:/192.168.86.8:53305 ! R:/8.133.246.113:8091]
2025-05-25 01:51:17.897 [NettyClientSelector_RMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0x59cbb873, L:/192.168.86.8:53305 ! R:/8.133.246.113:8091]) will closed
2025-05-25 01:51:17.897 [NettyClientSelector_RMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0x59cbb873, L:/192.168.86.8:53305 ! R:/8.133.246.113:8091]) will closed
2025-05-25 02:20:44.771 [main] WARN  com.alibaba.nacos.client.logging.NacosLogging - Load Logback Configuration of Nacos fail, message: Could not initialize Logback Nacos logging from classpath:nacos-logback.xml
2025-05-25 02:20:44.772 [main] INFO  com.bgpay.bgai.BgaiApplication - The following 1 profile is active: "dev"
2025-05-25 02:20:46.192 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-05-25 02:20:46.194 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-05-25 02:20:46.218 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 17 ms. Found 0 JPA repository interfaces.
2025-05-25 02:20:46.228 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-05-25 02:20:46.229 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-05-25 02:20:46.240 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 4 ms. Found 0 Redis repository interfaces.
2025-05-25 02:20:46.943 [main] INFO  io.seata.config.ConfigurationFactory - load Configuration from :Spring Configuration
2025-05-25 02:20:46.952 [main] INFO  io.seata.config.ConfigurationFactory - load Configuration from :Spring Configuration
2025-05-25 02:20:46.958 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Initializing Global Transaction Clients ... 
2025-05-25 02:20:47.062 [main] INFO  io.seata.core.rpc.netty.NettyClientBootstrap - NettyClientBootstrap has started
2025-05-25 02:20:47.063 [main] INFO  io.seata.discovery.registry.RegistryFactory - use registry center type: file
2025-05-25 02:20:47.072 [main] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - will connect to 8.133.246.113:8091
2025-05-25 02:20:47.076 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - NettyPool create channel to transactionRole:TMROLE,address:8.133.246.113:8091,msg:< RegisterTMRequest{version='1.7.0', applicationId='bgtech-ai', transactionServiceGroup='bgai-tx-group', extraData='ak=null
digest=bgai-tx-group,192.168.86.8,1748110847074
timestamp=1748110847074
authVersion=V4
vgroup=bgai-tx-group
ip=192.168.86.8
'} >
2025-05-25 02:20:47.217 [main] INFO  io.seata.core.rpc.netty.TmNettyRemotingClient - register TM success. client version:1.7.0, server version:1.8.1-SNAPSHOT,channel:[id: 0x57f9606a, L:/192.168.86.8:56079 - R:/8.133.246.113:8091]
2025-05-25 02:20:47.224 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - register success, cost 79 ms, version:1.8.1-SNAPSHOT,role:TMROLE,channel:[id: 0x57f9606a, L:/192.168.86.8:56079 - R:/8.133.246.113:8091]
2025-05-25 02:20:47.225 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Transaction Manager Client is initialized. applicationId[bgtech-ai] txServiceGroup[bgai-tx-group]
2025-05-25 02:20:47.239 [main] INFO  io.seata.rm.datasource.AsyncWorker - Async Commit Buffer Limit: 10000
2025-05-25 02:20:47.240 [main] INFO  io.seata.rm.datasource.xa.ResourceManagerXA - ResourceManagerXA init ...
2025-05-25 02:20:47.246 [main] INFO  io.seata.core.rpc.netty.NettyClientBootstrap - NettyClientBootstrap has started
2025-05-25 02:20:47.247 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Resource Manager is initialized. applicationId[bgtech-ai] txServiceGroup[bgai-tx-group]
2025-05-25 02:20:47.247 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Global Transaction Clients are initialized. 
2025-05-25 02:20:48.418 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat initialized with port(s): 8080 (http)
2025-05-25 02:20:48.428 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - The ["http-nio-8080"] connector has been configured to support HTTP upgrade to [h2c]
2025-05-25 02:20:48.428 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - Initializing ProtocolHandler ["http-nio-8080"]
2025-05-25 02:20:48.430 [main] INFO  org.apache.catalina.core.StandardService - Starting service [Tomcat]
2025-05-25 02:20:48.430 [main] INFO  org.apache.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.15]
2025-05-25 02:20:48.814 [main] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} inited
2025-05-25 02:20:49.060 [main] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - will connect to 8.133.246.113:8091
2025-05-25 02:20:49.060 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - RM will register :jdbc:mysql://8.133.246.113:3306/deepseek
2025-05-25 02:20:49.060 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - NettyPool create channel to transactionRole:RMROLE,address:8.133.246.113:8091,msg:< RegisterRMRequest{resourceIds='jdbc:mysql://8.133.246.113:3306/deepseek', version='1.7.0', applicationId='bgtech-ai', transactionServiceGroup='bgai-tx-group', extraData='null'} >
2025-05-25 02:20:49.092 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - register RM success. client version:1.7.0, server version:1.8.1-SNAPSHOT,channel:[id: 0x2d5e3af1, L:/192.168.86.8:56084 - R:/8.133.246.113:8091]
2025-05-25 02:20:49.092 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - register success, cost 24 ms, version:1.8.1-SNAPSHOT,role:RMROLE,channel:[id: 0x2d5e3af1, L:/192.168.86.8:56084 - R:/8.133.246.113:8091]
2025-05-25 02:20:49.095 [main] INFO  i.s.s.a.datasource.SeataAutoDataSourceProxyCreator - Auto proxy data source 'masterDataSource' by 'AT' mode.
2025-05-25 02:20:49.170 [main] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-2} inited
2025-05-25 02:20:49.262 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - will register resourceId:jdbc:mysql://8.133.246.113:3306/deepseek
2025-05-25 02:20:49.264 [main] INFO  i.s.s.a.datasource.SeataAutoDataSourceProxyCreator - Auto proxy data source 'slaveDataSource' by 'AT' mode.
2025-05-25 02:20:49.271 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.rm.AbstractRMHandler - the rm client received response msg [RegisterRMResponse{version='1.8.1-SNAPSHOT', extraData='null', identified=true, resultCode=null, msg='null'}] from tc server.
2025-05-25 02:20:49.287 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - will register resourceId:jdbc:mysql://8.133.246.113:3306/deepseek
2025-05-25 02:20:49.287 [main] INFO  i.s.s.a.datasource.SeataAutoDataSourceProxyCreator - Auto proxy data source 'dynamicDataSource' by 'AT' mode.
2025-05-25 02:20:49.297 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.rm.AbstractRMHandler - the rm client received response msg [RegisterRMResponse{version='1.8.1-SNAPSHOT', extraData='null', identified=true, resultCode=null, msg='null'}] from tc server.
2025-05-25 02:20:49.392 [main] INFO  org.hibernate.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-05-25 02:20:49.444 [main] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.1.7.Final
2025-05-25 02:20:49.798 [main] INFO  SQL dialect - HHH000400: Using dialect: org.hibernate.dialect.MySQL8Dialect
2025-05-25 02:20:49.800 [main] WARN  org.hibernate.orm.deprecation - HHH90000026: MySQL8Dialect has been deprecated; use org.hibernate.dialect.MySQLDialect instead
2025-05-25 02:20:50.150 [main] INFO  o.h.e.t.jta.platform.internal.JtaPlatformInitiator - HHH000490: Using JtaPlatform implementation: [org.hibernate.engine.transaction.jta.platform.internal.NoJtaPlatform]
2025-05-25 02:20:50.160 [main] INFO  o.s.orm.jpa.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-05-25 02:20:50.542 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-25 02:20:50.553 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-25 02:20:50.580 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-25 02:20:50.583 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-25 02:20:50.583 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-25 02:20:50.592 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-25 02:20:51.234 [main] INFO  com.bgpay.bgai.service.impl.UserServiceImpl - 初始化SSO配置: clientId=bgai-client-id, redirectUri=http://localhost:8080/api/auth/callback
2025-05-25 02:20:51.399 [main] INFO  com.bgpay.bgai.controller.AuthController - 初始化认证控制器: clientId=bgai-client-id, redirectUri=http://localhost:8080/api/auth/callback
2025-05-25 02:20:51.932 [main] INFO  o.a.r.s.autoconfigure.RocketMQAutoConfiguration - a producer (billing-producer-group) init on namesrv 8.133.246.113:9876
2025-05-25 02:20:52.617 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Bean [com.bgpay.bgai.service.deepseek.DeepSeekServiceImp$$SpringCGLIB$$0] with name [deepSeekServiceImp] would use interceptor [io.seata.spring.annotation.GlobalTransactionalInterceptor]
2025-05-25 02:20:52.955 [main] WARN  i.s.s.b.a.provider.SpringBootConfigurationProvider - The get method not found for the field 'SeataProperties#accesskey'.
2025-05-25 02:20:52.955 [main] WARN  i.s.s.b.a.provider.SpringBootConfigurationProvider - The get method not found for the field 'SeataProperties#secretkey'.
2025-05-25 02:20:52.971 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 加载到1个Saga状态机定义文件
2025-05-25 02:20:53.115 [main] INFO  com.bgpay.bgai.saga.CustomSagaJsonParser - 开始解析状态机定义: bgai-saga-transaction
2025-05-25 02:20:53.115 [main] INFO  com.bgpay.bgai.saga.CustomSagaJsonParser - 状态机定义解析成功: bgai-saga-transaction
2025-05-25 02:20:53.115 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 成功加载状态机定义: /E:/project/bgai/target/classes/statelang/bgai-saga-transaction.json
2025-05-25 02:20:53.569 [main] INFO  org.redisson.Version - Redisson 3.24.3
2025-05-25 02:20:53.702 [redisson-netty-4-6] INFO  o.r.connection.pool.MasterPubSubConnectionPool - 1 connections initialized for 8.133.246.113/8.133.246.113:6379
2025-05-25 02:20:54.048 [redisson-netty-4-19] INFO  org.redisson.connection.pool.MasterConnectionPool - 24 connections initialized for 8.133.246.113/8.133.246.113:6379
2025-05-25 02:20:54.243 [main] INFO  com.bgpay.bgai.service.mq.MQConsumerService - MQ consumer startup successful [group=billing-consumer-group, topic=BILLING_TOPIC, tag=USER_BILLING]
2025-05-25 02:20:54.445 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Bean [com.bgpay.bgai.service.mq.BillingTransactionListenerImpl$$SpringCGLIB$$0] with name [billingTransactionListenerImpl] would use interceptor [io.seata.spring.annotation.GlobalTransactionalInterceptor]
2025-05-25 02:20:54.568 [main] DEBUG com.bgpay.bgai.config.AsyncConfig$1 - Initializing ExecutorService 'blockingExecutor'
2025-05-25 02:20:54.593 [main] INFO  c.b.bgai.config.NacosConfig$NacosWarningHandler - Nacos警告处理器已启用，将忽略配置中心连接警告
2025-05-25 02:20:55.716 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [After]
2025-05-25 02:20:55.716 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Before]
2025-05-25 02:20:55.716 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Between]
2025-05-25 02:20:55.716 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Cookie]
2025-05-25 02:20:55.716 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Header]
2025-05-25 02:20:55.716 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Host]
2025-05-25 02:20:55.716 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Method]
2025-05-25 02:20:55.716 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Path]
2025-05-25 02:20:55.717 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Query]
2025-05-25 02:20:55.717 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [ReadBody]
2025-05-25 02:20:55.717 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [RemoteAddr]
2025-05-25 02:20:55.717 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [XForwardedRemoteAddr]
2025-05-25 02:20:55.717 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Weight]
2025-05-25 02:20:55.717 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [CloudFoundryRouteService]
2025-05-25 02:20:57.149 [main] INFO  o.s.b.actuate.endpoint.web.EndpointLinksResolver - Exposing 3 endpoint(s) beneath base path '/actuator'
2025-05-25 02:20:58.837 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - Starting ProtocolHandler ["http-nio-8080"]
2025-05-25 02:20:58.852 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat started on port(s): 8080 (http) with context path ''
2025-05-25 02:20:58.863 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from ans.namespace attribute : null
2025-05-25 02:20:58.863 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from ALIBABA_ALIWARE_NAMESPACE attribute :null
2025-05-25 02:20:58.864 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from namespace attribute :null
2025-05-25 02:20:58.873 [main] INFO  c.a.n.p.auth.spi.client.ClientAuthPluginManager - [ClientAuthPluginManager] Load ClientAuthService com.alibaba.nacos.client.auth.impl.NacosClientAuthServiceImpl success.
2025-05-25 02:20:58.873 [main] INFO  c.a.n.p.auth.spi.client.ClientAuthPluginManager - [ClientAuthPluginManager] Load ClientAuthService com.alibaba.nacos.client.auth.ram.RamClientAuthServiceImpl success.
2025-05-25 02:20:58.877 [main] INFO  com.alibaba.nacos.common.remote.client - [RpcClientFactory] create a new rpc client of 222841d0-f11a-4d7e-949f-6e9f8972f0c6
2025-05-25 02:20:58.879 [main] INFO  com.alibaba.nacos.common.remote.client - [222841d0-f11a-4d7e-949f-6e9f8972f0c6] RpcClient init, ServerListFactory = com.alibaba.nacos.client.naming.core.ServerListManager
2025-05-25 02:20:58.879 [main] INFO  com.alibaba.nacos.common.remote.client - [222841d0-f11a-4d7e-949f-6e9f8972f0c6] Registry connection listener to current client:com.alibaba.nacos.client.naming.remote.gprc.redo.NamingGrpcRedoService
2025-05-25 02:20:58.880 [main] INFO  com.alibaba.nacos.common.remote.client - [222841d0-f11a-4d7e-949f-6e9f8972f0c6] Register server push request handler:com.alibaba.nacos.client.naming.remote.gprc.NamingPushRequestHandler
2025-05-25 02:20:58.880 [main] INFO  com.alibaba.nacos.common.remote.client - [222841d0-f11a-4d7e-949f-6e9f8972f0c6] Try to connect to server on start up, server: {serverIp = '8.133.246.113', server main port = 8848}
2025-05-25 02:20:58.880 [main] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - grpc client connection server:8.133.246.113 ip,serverPort:9848,grpcTslConfig:{"sslProvider":"OPENSSL","enableTls":false,"mutualAuthEnable":false,"trustAll":false}
2025-05-25 02:20:59.044 [main] INFO  com.alibaba.nacos.common.remote.client - [222841d0-f11a-4d7e-949f-6e9f8972f0c6] Success to connect to server [8.133.246.113:8848] on start up, connectionId = 1748110858951_139.227.195.192_48485
2025-05-25 02:20:59.044 [main] INFO  com.alibaba.nacos.common.remote.client - [222841d0-f11a-4d7e-949f-6e9f8972f0c6] Register server push request handler:com.alibaba.nacos.common.remote.client.RpcClient$ConnectResetRequestHandler
2025-05-25 02:20:59.044 [com.alibaba.nacos.client.remote.worker] INFO  com.alibaba.nacos.common.remote.client - [222841d0-f11a-4d7e-949f-6e9f8972f0c6] Notify connected event to listeners.
2025-05-25 02:20:59.044 [main] INFO  com.alibaba.nacos.common.remote.client - [222841d0-f11a-4d7e-949f-6e9f8972f0c6] Register server push request handler:com.alibaba.nacos.common.remote.client.RpcClient$$Lambda/0x000001a13252dc70
2025-05-25 02:20:59.044 [com.alibaba.nacos.client.remote.worker] INFO  com.alibaba.nacos.client.naming - Grpc connection connect
2025-05-25 02:20:59.045 [main] INFO  com.alibaba.nacos.client.naming - [REGISTER-SERVICE] d750d92e-152f-4055-a641-3bc9dda85a29 registering service bgtech-ai with instance Instance{instanceId='null', ip='192.168.86.8', port=8080, weight=1.0, healthy=true, enabled=true, ephemeral=true, clusterName='DEFAULT', serviceName='null', metadata={IPv6=[2408:820c:7528:d042:c185:8edc:f30d:3d91], preserved.register.source=SPRING_CLOUD}}
2025-05-25 02:20:59.067 [main] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - nacos registry, DEFAULT_GROUP bgtech-ai 192.168.86.8:8080 register finished
2025-05-25 02:20:59.118 [main] INFO  com.bgpay.bgai.config.NacosConfig - 应用启动完成，当前环境: dev
2025-05-25 02:20:59.118 [main] INFO  com.bgpay.bgai.config.NacosConfig - Nacos配置中心: 8.133.246.113:8848, 命名空间: d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-25 02:20:59.118 [main] INFO  com.bgpay.bgai.config.NacosConfig - 注意: 如果看到Nacos配置加载警告，但应用正常启动，说明应用正在使用本地配置文件
2025-05-25 02:20:59.119 [main] INFO  com.bgpay.bgai.BgaiApplication - Started BgaiApplication in 16.55 seconds (process running for 18.038)
2025-05-25 02:20:59.122 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-25 02:20:59.122 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-25 02:20:59.133 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-25 02:20:59.133 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-25 02:20:59.134 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-25 02:20:59.143 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-25 02:20:59.143 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-25 02:20:59.143 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-25 02:20:59.150 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-25 02:20:59.150 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-25 02:20:59.150 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-25 02:20:59.156 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-25 02:20:59.157 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - ==================== Saga状态机加载报告 ====================
2025-05-25 02:20:59.157 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - Saga状态机配置加载状态: 成功
2025-05-25 02:20:59.157 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 已加载的状态机定义文件数量: 1
2025-05-25 02:20:59.157 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 已加载的状态机定义文件:
2025-05-25 02:20:59.157 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig -  - /E:/project/bgai/target/classes/statelang/bgai-saga-transaction.json
2025-05-25 02:20:59.157 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - Saga解析器状态: CUSTOM_FASTJSON2
2025-05-25 02:20:59.157 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 状态机解析结果: 成功 1 个, 失败 0 个
2025-05-25 02:20:59.157 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - =============================================================
2025-05-25 02:20:59.160 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - nacos.cache.data.init.snapshot = true 
2025-05-25 02:20:59.161 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] common-dev.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-25 02:20:59.168 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=common-dev.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-25 02:20:59.168 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=common-dev.yaml, group=DEFAULT_GROUP
2025-05-25 02:20:59.169 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-25 02:20:59.169 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-25 02:20:59.169 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai.yaml, group=DEFAULT_GROUP
2025-05-25 02:20:59.170 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai-dev.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-25 02:20:59.170 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai-dev.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-25 02:20:59.170 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai-dev.yaml, group=DEFAULT_GROUP
2025-05-25 02:20:59.170 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-25 02:20:59.170 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai, group=DEFAULT_GROUP, cnt=1
2025-05-25 02:20:59.171 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai, group=DEFAULT_GROUP
2025-05-25 02:21:03.945 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - 接收到请求: /api/chatGatWay-internal, 文件=新文件 17.txt, 问题参数=null, 模型参数=null
2025-05-25 02:21:03.946 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - 请求Content-Type: multipart/form-data;boundary=--------------------------294309184802440856484998
2025-05-25 02:21:03.947 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - 收集到的完整参数: question="null", apiUrl="null", modelName="null", multiTurn=false
2025-05-25 02:21:03.949 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - Processing request for user ID: 689258T
2025-05-25 02:21:03.949 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - Processing file with circuit breaker: fileName=新文件 17.txt, question=
2025-05-25 02:21:03.951 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.config.ReactiveFileProcessor - Processing file: 新文件 17.txt, content-type: text/plain
2025-05-25 02:21:03.957 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - PARAM TRACE [689258T]: 尝试查找匹配配置 - 参数: apiUrl=null, modelName=null
2025-05-25 02:21:03.967 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 查询配置 - userId=689258T
2025-05-25 02:21:03.968 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 排序方式 - 按ID降序
2025-05-25 02:21:03.968 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 限制结果数 - LIMIT 1
2025-05-25 02:21:04.057 [http-nio-8080-exec-2] DEBUG com.bgpay.bgai.mapper.ApiConfigMapper.selectList - ==>  Preparing: SELECT id,api_url,api_key,model_name,user_id FROM api_config WHERE (user_id = ?) ORDER BY id DESC LIMIT 1
2025-05-25 02:21:04.059 [http-nio-8080-exec-2] DEBUG com.bgpay.bgai.mapper.ApiConfigMapper.selectList - ==> Parameters: 689258T(String)
2025-05-25 02:21:04.076 [http-nio-8080-exec-2] DEBUG com.bgpay.bgai.mapper.ApiConfigMapper.selectList - <==      Total: 1
2025-05-25 02:21:04.076 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 查询结果 - 找到配置: id=2, modelName=deepseek-chat
2025-05-25 02:21:04.076 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - PARAM TRACE [689258T]: 找到匹配配置 - apiUrl=https://api.deepseek.com/chat/completions, modelName=deepseek-chat (原始请求: null)
2025-05-25 02:21:04.076 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - API config resolved: url=https://api.deepseek.com/chat/completions, model=deepseek-chat
2025-05-25 02:21:04.103 [Thread-49] INFO  com.bgpay.bgai.config.ReactiveFileProcessor - File processed successfully: size=37 bytes
2025-05-25 02:21:04.109 [Thread-49] INFO  com.bgpay.bgai.controller.ReactiveChatController - Content processed, length: 54
2025-05-25 02:21:04.117 [Thread-49] INFO  io.seata.tm.TransactionManagerHolder - TransactionManager Singleton io.seata.tm.DefaultTransactionManager@f0c6486
2025-05-25 02:21:04.132 [Thread-49] INFO  io.seata.tm.api.DefaultGlobalTransaction - Begin new global transaction [seata-server:8091:153776404394049557]
2025-05-25 02:21:04.135 [Thread-49] INFO  c.b.bgai.interceptor.SeataTransactionInterceptor - 准备记录分布式事务开始: XID=seata-server:8091:153776404394049557, 业务=com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive, 路径=, IP=, 用户=system
2025-05-25 02:21:04.151 [Thread-49] INFO  c.b.bgai.service.impl.TransactionLogServiceImpl - 记录分布式事务开始: XID=seata-server:8091:153776404394049557, 业务=com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive
2025-05-25 02:21:04.157 [Thread-49] DEBUG com.bgpay.bgai.mapper.TransactionLogMapper.insert - ==>  Preparing: INSERT INTO transaction_log ( xid, transaction_name, transaction_mode, status, request_path, source_ip, start_time, user_id, create_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-05-25 02:21:04.161 [Thread-49] DEBUG com.bgpay.bgai.mapper.TransactionLogMapper.insert - ==> Parameters: seata-server:8091:153776404394049557(String), com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive(String), AT(String), ACTIVE(String), (String), (String), 2025-05-25T02:21:04.151051500(LocalDateTime), system(String), 2025-05-25T02:21:04.151051500(LocalDateTime)
2025-05-25 02:21:04.534 [Thread-49] DEBUG com.bgpay.bgai.mapper.TransactionLogMapper.insert - <==    Updates: 1
2025-05-25 02:21:04.552 [Thread-49] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:153776404394049557, branchId:153776404394049558, lockKeys:transaction_log:35
2025-05-25 02:21:04.568 [Thread-49] WARN  i.s.c.l.EnhancedServiceLoader$InnerEnhancedServiceLoader - Load [io.seata.rm.datasource.undo.parser.ProtostuffUndoLogParser] class fail: io/protostuff/runtime/IdStrategy
2025-05-25 02:21:04.646 [Thread-49] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:153776404394049557, branchId:153776404394049559, lockKeys:transaction_log:35;undo_log:137
2025-05-25 02:21:04.681 [Thread-49] INFO  c.b.bgai.interceptor.SeataTransactionInterceptor - 开始分布式事务: XID=seata-server:8091:153776404394049557, 方法=com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive
2025-05-25 02:21:04.695 [Thread-49] INFO  org.reflections.Reflections - Processing reactive request: content length=54, apiUrl=https://api.deepseek.com/chat/completions, modelName=deepseek-chat, userId=689258T, multiTurn=false
2025-05-25 02:21:04.703 [Thread-49] INFO  c.b.bgai.service.impl.TransactionLogServiceImpl - 记录分布式事务结束: XID=seata-server:8091:153776404394049557, 状态=COMMITTED
2025-05-25 02:21:04.705 [Thread-49] DEBUG c.b.bgai.mapper.TransactionLogMapper.selectList - ==>  Preparing: SELECT id,xid,branch_id,transaction_name,transaction_mode,status,request_path,source_ip,start_time,end_time,user_id,extra_data,create_time,update_time FROM transaction_log WHERE (xid = ?) LIMIT 1
2025-05-25 02:21:04.707 [Thread-49] DEBUG c.b.bgai.mapper.TransactionLogMapper.selectList - ==> Parameters: seata-server:8091:153776404394049557(String)
2025-05-25 02:21:04.714 [Thread-49] DEBUG c.b.bgai.mapper.TransactionLogMapper.selectList - <==      Total: 1
2025-05-25 02:21:04.720 [Thread-49] DEBUG c.b.bgai.mapper.TransactionLogMapper.updateById - ==>  Preparing: UPDATE transaction_log SET xid=?, transaction_name=?, transaction_mode=?, status=?, request_path=?, source_ip=?, start_time=?, end_time=?, user_id=?, extra_data=?, create_time=?, update_time=? WHERE id=?
2025-05-25 02:21:04.726 [Thread-49] DEBUG c.b.bgai.mapper.TransactionLogMapper.updateById - ==> Parameters: seata-server:8091:153776404394049557(String), com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive(String), AT(String), COMMITTED(String), (String), (String), 2025-05-25T02:21:04(LocalDateTime), 2025-05-25T02:21:04.715051100(LocalDateTime), system(String), {"duration":15,"result":"success"}(String), 2025-05-25T02:21:04(LocalDateTime), 2025-05-25T02:21:04.715051100(LocalDateTime), 35(Long)
2025-05-25 02:21:04.783 [Thread-49] DEBUG c.b.bgai.mapper.TransactionLogMapper.updateById - <==    Updates: 1
2025-05-25 02:21:04.794 [Thread-49] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:153776404394049557, branchId:153776404394049560, lockKeys:transaction_log:35
2025-05-25 02:21:04.819 [Thread-49] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:153776404394049557, branchId:153776404394049561, lockKeys:transaction_log:35;undo_log:139
2025-05-25 02:21:04.845 [Thread-49] INFO  c.b.bgai.interceptor.SeataTransactionInterceptor - 分布式事务成功完成: XID=seata-server:8091:153776404394049557, 耗时=15ms
2025-05-25 02:21:04.845 [Thread-49] INFO  io.seata.tm.api.DefaultGlobalTransaction - transaction seata-server:8091:153776404394049557 will be commit
2025-05-25 02:21:04.860 [Thread-49] INFO  io.seata.tm.api.DefaultGlobalTransaction - transaction end, xid = seata-server:8091:153776404394049557
2025-05-25 02:21:04.860 [Thread-49] INFO  io.seata.tm.api.DefaultGlobalTransaction - [seata-server:8091:153776404394049557] commit status: Committed
2025-05-25 02:21:04.904 [boundedElastic-1] INFO  com.bgpay.bgai.transaction.TransactionCoordinator - Transaction prepared for user 689258T: chatCompletionId=chat-3f198275-b226-4aa9-b8ea-61eb6e24e87c
2025-05-25 02:21:04.904 [boundedElastic-1] INFO  org.reflections.Reflections - Transaction prepared with chatCompletionId: chat-3f198275-b226-4aa9-b8ea-61eb6e24e87c
2025-05-25 02:21:05.762 [rpcDispatch_RMROLE_1_1_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:153776404394049557', branchId=153776404394049558, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false,"skipCheckLock":true}'}
2025-05-25 02:21:05.763 [rpcDispatch_RMROLE_1_1_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:153776404394049557 153776404394049558 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false,"skipCheckLock":true}
2025-05-25 02:21:05.769 [rpcDispatch_RMROLE_1_1_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-25 02:21:05.778 [rpcDispatch_RMROLE_1_2_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:153776404394049557', branchId=153776404394049559, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false,"skipCheckLock":true}'}
2025-05-25 02:21:05.778 [rpcDispatch_RMROLE_1_2_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:153776404394049557 153776404394049559 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false,"skipCheckLock":true}
2025-05-25 02:21:05.778 [rpcDispatch_RMROLE_1_2_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-25 02:21:05.785 [rpcDispatch_RMROLE_1_3_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:153776404394049557', branchId=153776404394049560, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false}'}
2025-05-25 02:21:05.785 [rpcDispatch_RMROLE_1_3_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:153776404394049557 153776404394049560 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false}
2025-05-25 02:21:05.785 [rpcDispatch_RMROLE_1_3_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-25 02:21:05.792 [rpcDispatch_RMROLE_1_4_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:153776404394049557', branchId=153776404394049561, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false}'}
2025-05-25 02:21:05.792 [rpcDispatch_RMROLE_1_4_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:153776404394049557 153776404394049561 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false}
2025-05-25 02:21:05.792 [rpcDispatch_RMROLE_1_4_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-25 02:21:38.556 [FileWrite-1] INFO  com.bgpay.bgai.service.deepseek.FileWriterService - Successfully wrote content to: \var\data\ai_responses\c2dc6e31-e81b-4e16-a471-78c4aa8a8e99.txt
2025-05-25 02:21:38.571 [reactor-http-nio-2] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - ==>  Preparing: INSERT INTO chat_completions ( object, created, model, system_fingerprint, api_key ) VALUES ( ?, ?, ?, ?, ? )
2025-05-25 02:21:38.571 [reactor-http-nio-2] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - ==> Parameters: chat.completion(String), 1748110898569(Long), deepseek-chat(String), 689258T(String), chat-3f198275-b226-4aa9-b8ea-61eb6e24e87c(String)
2025-05-25 02:21:38.584 [reactor-http-nio-2] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - <==    Updates: 1
2025-05-25 02:21:38.584 [reactor-http-nio-2] INFO  com.bgpay.bgai.transaction.TransactionCoordinator - Transaction committed for user 689258T: chatCompletionId=chat-3f198275-b226-4aa9-b8ea-61eb6e24e87c
2025-05-25 02:21:38.611 [reactor-http-nio-2] INFO  org.reflections.Reflections - 开始发送账单消息，chatCompletionId: chat-3f198275-b226-4aa9-b8ea-61eb6e24e87c, userId: 689258T
2025-05-25 02:21:38.658 [reactor-http-nio-2] INFO  io.seata.tm.api.DefaultGlobalTransaction - Begin new global transaction [seata-server:8091:153776404394049562]
2025-05-25 02:21:38.659 [reactor-http-nio-2] INFO  c.b.bgai.interceptor.SeataTransactionInterceptor - 准备记录分布式事务开始: XID=seata-server:8091:153776404394049562, 业务=com.bgpay.bgai.service.mq.BillingTransactionListenerImpl.executeLocalTransaction, 路径=, IP=, 用户=system
2025-05-25 02:21:38.665 [reactor-http-nio-2] INFO  c.b.bgai.service.impl.TransactionLogServiceImpl - 记录分布式事务开始: XID=seata-server:8091:153776404394049562, 业务=com.bgpay.bgai.service.mq.BillingTransactionListenerImpl.executeLocalTransaction
2025-05-25 02:21:38.666 [reactor-http-nio-2] DEBUG com.bgpay.bgai.mapper.TransactionLogMapper.insert - ==>  Preparing: INSERT INTO transaction_log ( xid, transaction_name, transaction_mode, status, request_path, source_ip, start_time, user_id, create_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-05-25 02:21:38.666 [reactor-http-nio-2] DEBUG com.bgpay.bgai.mapper.TransactionLogMapper.insert - ==> Parameters: seata-server:8091:153776404394049562(String), com.bgpay.bgai.service.mq.BillingTransactionListenerImpl.executeLocalTransaction(String), AT(String), ACTIVE(String), (String), (String), 2025-05-25T02:21:38.665250200(LocalDateTime), system(String), 2025-05-25T02:21:38.665250200(LocalDateTime)
2025-05-25 02:21:38.694 [reactor-http-nio-2] DEBUG com.bgpay.bgai.mapper.TransactionLogMapper.insert - <==    Updates: 1
2025-05-25 02:21:38.704 [reactor-http-nio-2] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:153776404394049562, branchId:153776404394049563, lockKeys:transaction_log:36
2025-05-25 02:21:38.724 [reactor-http-nio-2] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:153776404394049562, branchId:153776404394049564, lockKeys:transaction_log:36;undo_log:141
2025-05-25 02:21:38.749 [reactor-http-nio-2] INFO  c.b.bgai.interceptor.SeataTransactionInterceptor - 开始分布式事务: XID=seata-server:8091:153776404394049562, 方法=com.bgpay.bgai.service.mq.BillingTransactionListenerImpl.executeLocalTransaction
2025-05-25 02:21:38.749 [reactor-http-nio-2] INFO  c.b.bgai.service.mq.BillingTransactionListenerImpl - 开始执行本地事务, xid: seata-server:8091:153776404394049562, userId: 689258T, completionId: chat-3f198275-b226-4aa9-b8ea-61eb6e24e87c
2025-05-25 02:21:38.762 [reactor-http-nio-2] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.selectCount - ==>  Preparing: SELECT COUNT( * ) AS total FROM usage_info WHERE (chat_completion_id = ?)
2025-05-25 02:21:38.763 [reactor-http-nio-2] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.selectCount - ==> Parameters: chat-3f198275-b226-4aa9-b8ea-61eb6e24e87c(String)
2025-05-25 02:21:38.770 [reactor-http-nio-2] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.selectCount - <==      Total: 1
2025-05-25 02:21:38.787 [reactor-http-nio-2] INFO  com.bgpay.bgai.transaction.TransactionCoordinator - Transaction prepared for user 689258T: chatCompletionId=chat-56cd4f83-6121-45ca-98f6-6fe2575aca40
2025-05-25 02:21:38.787 [reactor-http-nio-2] ERROR c.b.bgai.service.mq.BillingTransactionListenerImpl - 事务ID不一致，回滚事务, expected: chat-3f198275-b226-4aa9-b8ea-61eb6e24e87c, actual: chat-56cd4f83-6121-45ca-98f6-6fe2575aca40
2025-05-25 02:21:38.794 [reactor-http-nio-2] INFO  c.b.bgai.service.impl.TransactionLogServiceImpl - 记录分布式事务结束: XID=seata-server:8091:153776404394049562, 状态=COMMITTED
2025-05-25 02:21:38.795 [reactor-http-nio-2] DEBUG c.b.bgai.mapper.TransactionLogMapper.selectList - ==>  Preparing: SELECT id,xid,branch_id,transaction_name,transaction_mode,status,request_path,source_ip,start_time,end_time,user_id,extra_data,create_time,update_time FROM transaction_log WHERE (xid = ?) LIMIT 1
2025-05-25 02:21:38.795 [reactor-http-nio-2] DEBUG c.b.bgai.mapper.TransactionLogMapper.selectList - ==> Parameters: seata-server:8091:153776404394049562(String)
2025-05-25 02:21:38.802 [reactor-http-nio-2] DEBUG c.b.bgai.mapper.TransactionLogMapper.selectList - <==      Total: 1
2025-05-25 02:21:38.803 [reactor-http-nio-2] DEBUG c.b.bgai.mapper.TransactionLogMapper.updateById - ==>  Preparing: UPDATE transaction_log SET xid=?, transaction_name=?, transaction_mode=?, status=?, request_path=?, source_ip=?, start_time=?, end_time=?, user_id=?, extra_data=?, create_time=?, update_time=? WHERE id=?
2025-05-25 02:21:38.803 [reactor-http-nio-2] DEBUG c.b.bgai.mapper.TransactionLogMapper.updateById - ==> Parameters: seata-server:8091:153776404394049562(String), com.bgpay.bgai.service.mq.BillingTransactionListenerImpl.executeLocalTransaction(String), AT(String), COMMITTED(String), (String), (String), 2025-05-25T02:21:39(LocalDateTime), 2025-05-25T02:21:38.802248500(LocalDateTime), system(String), {"duration":38,"result":"success"}(String), 2025-05-25T02:21:39(LocalDateTime), 2025-05-25T02:21:38.802248500(LocalDateTime), 36(Long)
2025-05-25 02:21:38.841 [reactor-http-nio-2] DEBUG c.b.bgai.mapper.TransactionLogMapper.updateById - <==    Updates: 1
2025-05-25 02:21:38.849 [reactor-http-nio-2] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:153776404394049562, branchId:153776404394049565, lockKeys:transaction_log:36
2025-05-25 02:21:38.873 [reactor-http-nio-2] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:153776404394049562, branchId:153776404394049566, lockKeys:transaction_log:36;undo_log:143
2025-05-25 02:21:38.901 [reactor-http-nio-2] INFO  c.b.bgai.interceptor.SeataTransactionInterceptor - 分布式事务成功完成: XID=seata-server:8091:153776404394049562, 耗时=38ms
2025-05-25 02:21:38.901 [reactor-http-nio-2] INFO  io.seata.tm.api.DefaultGlobalTransaction - transaction seata-server:8091:153776404394049562 will be commit
2025-05-25 02:21:38.909 [reactor-http-nio-2] INFO  io.seata.tm.api.DefaultGlobalTransaction - transaction end, xid = seata-server:8091:153776404394049562
2025-05-25 02:21:38.909 [reactor-http-nio-2] INFO  io.seata.tm.api.DefaultGlobalTransaction - [seata-server:8091:153776404394049562] commit status: Committed
2025-05-25 02:21:38.911 [reactor-http-nio-2] INFO  org.reflections.Reflections - 账单消息发送成功，chatCompletionId: chat-3f198275-b226-4aa9-b8ea-61eb6e24e87c, userId: 689258T
2025-05-25 02:21:38.916 [reactor-http-nio-2] INFO  com.bgpay.bgai.service.impl.BGAIServiceImpl - 执行第一步操作 - 发送账单消息, businessKey: 689258T:chat-3f198275-b226-4aa9-b8ea-61eb6e24e87c
2025-05-25 02:21:38.917 [reactor-http-nio-2] DEBUG c.bgpay.bgai.mapper.UsageRecordMapper.selectCount - ==>  Preparing: SELECT COUNT( * ) AS total FROM usage_record WHERE (chat_completion_id = ?)
2025-05-25 02:21:38.917 [reactor-http-nio-2] DEBUG c.bgpay.bgai.mapper.UsageRecordMapper.selectCount - ==> Parameters: chat-3f198275-b226-4aa9-b8ea-61eb6e24e87c(String)
2025-05-25 02:21:38.924 [reactor-http-nio-2] DEBUG c.bgpay.bgai.mapper.UsageRecordMapper.selectCount - <==      Total: 1
2025-05-25 02:21:38.938 [reactor-http-nio-2] DEBUG c.bgpay.bgai.mapper.UsageRecordMapper.selectList - ==>  Preparing: SELECT id,model_type,chat_completion_id,user_id,input_cost,output_cost,price_version,calculated_at,message_id,input_tokens,output_tokens,status,created_at,updated_at FROM usage_record WHERE (chat_completion_id = ?)
2025-05-25 02:21:38.939 [reactor-http-nio-2] DEBUG c.bgpay.bgai.mapper.UsageRecordMapper.selectList - ==> Parameters: chat-3f198275-b226-4aa9-b8ea-61eb6e24e87c(String)
2025-05-25 02:21:39.022 [reactor-http-nio-2] ERROR com.bgpay.bgai.service.impl.BGAIServiceImpl - 发送账单消息失败, businessKey: 689258T:chat-3f198275-b226-4aa9-b8ea-61eb6e24e87c
org.springframework.jdbc.BadSqlGrammarException: 
### Error querying database.  Cause: java.sql.SQLSyntaxErrorException: Unknown column 'message_id' in 'field list'
### The error may exist in com/bgpay/bgai/mapper/UsageRecordMapper.java (best guess)
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: SELECT  id,model_type,chat_completion_id,user_id,input_cost,output_cost,price_version,calculated_at,message_id,input_tokens,output_tokens,status,created_at,updated_at  FROM usage_record      WHERE  (chat_completion_id = ?)
### Cause: java.sql.SQLSyntaxErrorException: Unknown column 'message_id' in 'field list'
; bad SQL grammar []
	at org.springframework.jdbc.support.SQLErrorCodeSQLExceptionTranslator.doTranslate(SQLErrorCodeSQLExceptionTranslator.java:246)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:73)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:92)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:439)
	at jdk.proxy2/jdk.proxy2.$Proxy156.selectList(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.selectList(SqlSessionTemplate.java:224)
	at com.baomidou.mybatisplus.core.override.MybatisMapperMethod.executeForMany(MybatisMapperMethod.java:164)
	at com.baomidou.mybatisplus.core.override.MybatisMapperMethod.execute(MybatisMapperMethod.java:77)
	at com.baomidou.mybatisplus.core.override.MybatisMapperProxy$PlainMethodInvoker.invoke(MybatisMapperProxy.java:152)
	at com.baomidou.mybatisplus.core.override.MybatisMapperProxy.invoke(MybatisMapperProxy.java:89)
	at jdk.proxy2/jdk.proxy2.$Proxy184.selectList(Unknown Source)
	at com.baomidou.mybatisplus.core.mapper.BaseMapper.selectOne(BaseMapper.java:222)
	at java.base/java.lang.invoke.MethodHandle.invokeWithArguments(MethodHandle.java:733)
	at com.baomidou.mybatisplus.core.override.MybatisMapperProxy$DefaultMethodInvoker.invoke(MybatisMapperProxy.java:166)
	at com.baomidou.mybatisplus.core.override.MybatisMapperProxy.invoke(MybatisMapperProxy.java:89)
	at jdk.proxy2/jdk.proxy2.$Proxy184.selectOne(Unknown Source)
	at com.baomidou.mybatisplus.extension.service.impl.ServiceImpl.getOne(ServiceImpl.java:242)
	at com.baomidou.mybatisplus.extension.service.IService.getOne(IService.java:327)
	at com.bgpay.bgai.service.impl.UsageRecordServiceImpl.findByCompletionId(UsageRecordServiceImpl.java:39)
	at com.bgpay.bgai.service.impl.UsageRecordServiceImpl.getCalculationDTO(UsageRecordServiceImpl.java:58)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:343)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:751)
	at org.springframework.cache.interceptor.CacheInterceptor.lambda$invoke$0(CacheInterceptor.java:54)
	at org.springframework.cache.interceptor.CacheAspectSupport.invokeOperation(CacheAspectSupport.java:366)
	at org.springframework.cache.interceptor.CacheAspectSupport.execute(CacheAspectSupport.java:420)
	at org.springframework.cache.interceptor.CacheAspectSupport.execute(CacheAspectSupport.java:345)
	at org.springframework.cache.interceptor.CacheInterceptor.invoke(CacheInterceptor.java:64)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:751)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:703)
	at com.bgpay.bgai.service.impl.UsageRecordServiceImpl$$SpringCGLIB$$0.getCalculationDTO(<generated>)
	at com.bgpay.bgai.service.impl.BGAIServiceImpl.executeFirstStep(BGAIServiceImpl.java:46)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:343)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:751)
	at org.springframework.transaction.interceptor.TransactionInterceptor$1.proceedWithInvocation(TransactionInterceptor.java:123)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:391)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:751)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:703)
	at com.bgpay.bgai.service.impl.BGAIServiceImpl$$SpringCGLIB$$0.executeFirstStep(<generated>)
	at com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.lambda$sendBillingMessage$10(DeepSeekServiceImp.java:385)
	at reactor.core.publisher.MonoPeekTerminal$MonoTerminalPeekSubscriber.onComplete(MonoPeekTerminal.java:289)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onComplete(FluxOnAssembly.java:549)
	at reactor.core.publisher.SerializedSubscriber.onComplete(SerializedSubscriber.java:146)
	at reactor.core.publisher.FluxRetryWhen$RetryWhenMainSubscriber.onComplete(FluxRetryWhen.java:200)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onComplete(FluxOnAssembly.java:549)
	at reactor.core.publisher.MonoIgnoreElements$IgnoreElementsSubscriber.onComplete(MonoIgnoreElements.java:89)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onComplete(FluxOnAssembly.java:549)
	at reactor.core.publisher.MonoFlatMap$FlatMapMain.onNext(MonoFlatMap.java:159)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onNext(FluxOnAssembly.java:539)
	at reactor.core.publisher.FluxSubscribeOnCallable$CallableSubscribeOnSubscription.run(FluxSubscribeOnCallable.java:251)
	at reactor.core.scheduler.ImmediateScheduler.schedule(ImmediateScheduler.java:52)
	at reactor.core.publisher.MonoSubscribeOnCallable.subscribe(MonoSubscribeOnCallable.java:52)
	at reactor.core.publisher.InternalMonoOperator.subscribe(InternalMonoOperator.java:64)
	at reactor.core.publisher.FluxRetryWhen.subscribe(FluxRetryWhen.java:77)
	at reactor.core.publisher.MonoRetryWhen.subscribeOrReturn(MonoRetryWhen.java:46)
	at reactor.core.publisher.Mono.subscribe(Mono.java:4480)
	at reactor.core.publisher.Mono.subscribeWith(Mono.java:4561)
	at reactor.core.publisher.Mono.subscribe(Mono.java:4462)
	at reactor.core.publisher.Mono.subscribe(Mono.java:4398)
	at reactor.core.publisher.Mono.subscribe(Mono.java:4370)
	at com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.lambda$processRequestReactive$7(DeepSeekServiceImp.java:321)
	at reactor.core.publisher.MonoPeekTerminal$MonoTerminalPeekSubscriber.onNext(MonoPeekTerminal.java:171)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onNext(FluxOnAssembly.java:539)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onNext(FluxOnAssembly.java:539)
	at reactor.core.publisher.FluxOnErrorResume$ResumeSubscriber.onNext(FluxOnErrorResume.java:79)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onNext(FluxOnAssembly.java:539)
	at reactor.core.publisher.MonoFlatMap$FlatMapMain.secondComplete(MonoFlatMap.java:245)
	at reactor.core.publisher.MonoFlatMap$FlatMapInner.onNext(MonoFlatMap.java:305)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onNext(FluxOnAssembly.java:539)
	at reactor.core.publisher.FluxMap$MapSubscriber.onNext(FluxMap.java:122)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onNext(FluxOnAssembly.java:539)
	at reactor.core.publisher.MonoCallable$MonoCallableSubscription.request(MonoCallable.java:156)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.request(FluxOnAssembly.java:649)
	at reactor.core.publisher.FluxMap$MapSubscriber.request(FluxMap.java:164)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.request(FluxOnAssembly.java:649)
	at reactor.core.publisher.MonoFlatMap$FlatMapInner.onSubscribe(MonoFlatMap.java:291)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onSubscribe(FluxOnAssembly.java:633)
	at reactor.core.publisher.FluxMap$MapSubscriber.onSubscribe(FluxMap.java:92)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onSubscribe(FluxOnAssembly.java:633)
	at reactor.core.publisher.MonoCallable.subscribe(MonoCallable.java:48)
	at reactor.core.publisher.InternalMonoOperator.subscribe(InternalMonoOperator.java:64)
	at reactor.core.publisher.MonoFlatMap$FlatMapMain.onNext(MonoFlatMap.java:165)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onNext(FluxOnAssembly.java:539)
	at reactor.core.publisher.SerializedSubscriber.onNext(SerializedSubscriber.java:99)
	at reactor.core.publisher.FluxRetryWhen$RetryWhenMainSubscriber.onNext(FluxRetryWhen.java:174)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onNext(FluxOnAssembly.java:539)
	at reactor.core.publisher.SerializedSubscriber.onNext(SerializedSubscriber.java:99)
	at reactor.core.publisher.FluxTimeout$TimeoutMainSubscriber.onNext(FluxTimeout.java:180)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onNext(FluxOnAssembly.java:539)
	at reactor.core.publisher.MonoFlatMap$FlatMapMain.secondComplete(MonoFlatMap.java:245)
	at reactor.core.publisher.MonoFlatMap$FlatMapInner.onNext(MonoFlatMap.java:305)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onNext(FluxOnAssembly.java:539)
	at reactor.core.publisher.FluxOnErrorResume$ResumeSubscriber.onNext(FluxOnErrorResume.java:79)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onNext(FluxOnAssembly.java:539)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onNext(FluxOnAssembly.java:539)
	at reactor.core.publisher.FluxMapFuseable$MapFuseableSubscriber.onNext(FluxMapFuseable.java:129)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onNext(FluxOnAssembly.java:539)
	at reactor.core.publisher.FluxContextWrite$ContextWriteSubscriber.onNext(FluxContextWrite.java:107)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onNext(FluxOnAssembly.java:539)
	at reactor.core.publisher.FluxMapFuseable$MapFuseableConditionalSubscriber.onNext(FluxMapFuseable.java:299)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onNext(FluxOnAssembly.java:539)
	at reactor.core.publisher.FluxFilterFuseable$FilterFuseableConditionalSubscriber.onNext(FluxFilterFuseable.java:337)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onNext(FluxOnAssembly.java:539)
	at reactor.core.publisher.Operators$BaseFluxToMonoOperator.completePossiblyEmpty(Operators.java:2071)
	at reactor.core.publisher.MonoCollect$CollectSubscriber.onComplete(MonoCollect.java:145)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onComplete(FluxOnAssembly.java:549)
	at reactor.core.publisher.FluxMapFuseable$MapFuseableSubscriber.onComplete(FluxMapFuseable.java:152)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onComplete(FluxOnAssembly.java:549)
	at reactor.core.publisher.FluxPeekFuseable$PeekFuseableSubscriber.onComplete(FluxPeekFuseable.java:277)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onComplete(FluxOnAssembly.java:549)
	at reactor.core.publisher.FluxMap$MapSubscriber.onComplete(FluxMap.java:144)
	at reactor.netty.channel.FluxReceive.onInboundComplete(FluxReceive.java:413)
	at reactor.netty.channel.ChannelOperations.onInboundComplete(ChannelOperations.java:444)
	at reactor.netty.channel.ChannelOperations.terminate(ChannelOperations.java:498)
	at reactor.netty.http.client.HttpClientOperations.onInboundNext(HttpClientOperations.java:753)
	at reactor.netty.channel.ChannelOperationsHandler.channelRead(ChannelOperationsHandler.java:114)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:444)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)
	at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412)
	at io.netty.handler.codec.MessageToMessageDecoder.channelRead(MessageToMessageDecoder.java:103)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:444)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)
	at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412)
	at io.netty.channel.CombinedChannelDuplexHandler$DelegatingChannelHandlerContext.fireChannelRead(CombinedChannelDuplexHandler.java:436)
	at io.netty.handler.codec.ByteToMessageDecoder.fireChannelRead(ByteToMessageDecoder.java:346)
	at io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:318)
	at io.netty.channel.CombinedChannelDuplexHandler.channelRead(CombinedChannelDuplexHandler.java:251)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:442)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)
	at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412)
	at io.netty.handler.ssl.SslHandler.unwrap(SslHandler.java:1471)
	at io.netty.handler.ssl.SslHandler.decodeJdkCompatible(SslHandler.java:1334)
	at io.netty.handler.ssl.SslHandler.decode(SslHandler.java:1383)
	at io.netty.handler.codec.ByteToMessageDecoder.decodeRemovalReentryProtection(ByteToMessageDecoder.java:529)
	at io.netty.handler.codec.ByteToMessageDecoder.callDecode(ByteToMessageDecoder.java:468)
	at io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:290)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:444)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)
	at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412)
	at io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1410)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:440)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)
	at io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:919)
	at io.netty.channel.nio.AbstractNioByteChannel$NioByteUnsafe.read(AbstractNioByteChannel.java:166)
	at io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:788)
	at io.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:724)
	at io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:650)
	at io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:562)
	at io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:997)
	at io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.base/java.lang.Thread.run(Thread.java:1583)
Caused by: java.sql.SQLSyntaxErrorException: Unknown column 'message_id' in 'field list'
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:121)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:916)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:354)
	at com.alibaba.druid.pool.DruidPooledPreparedStatement.execute(DruidPooledPreparedStatement.java:497)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:58)
	at jdk.proxy3/jdk.proxy3.$Proxy162.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.query(PreparedStatementHandler.java:65)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.query(RoutingStatementHandler.java:80)
	at org.apache.ibatis.executor.SimpleExecutor.doQuery(SimpleExecutor.java:65)
	at org.apache.ibatis.executor.BaseExecutor.queryFromDatabase(BaseExecutor.java:336)
	at org.apache.ibatis.executor.BaseExecutor.query(BaseExecutor.java:158)
	at org.apache.ibatis.executor.CachingExecutor.query(CachingExecutor.java:110)
	at org.apache.ibatis.executor.CachingExecutor.query(CachingExecutor.java:90)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.selectList(DefaultSqlSession.java:154)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.selectList(DefaultSqlSession.java:147)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.selectList(DefaultSqlSession.java:142)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:425)
	... 158 common frames omitted
2025-05-25 02:21:39.037 [reactor-http-nio-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - Processed response for user 689258T, content length: 2255
2025-05-25 02:21:39.037 [reactor-http-nio-2] WARN  com.bgpay.bgai.controller.ReactiveChatController - ChatCompletionId inconsistency detected, using transaction coordinator ID
2025-05-25 02:21:39.764 [rpcDispatch_RMROLE_1_5_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:153776404394049562', branchId=153776404394049563, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false,"skipCheckLock":true}'}
2025-05-25 02:21:39.765 [rpcDispatch_RMROLE_1_5_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:153776404394049562 153776404394049563 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false,"skipCheckLock":true}
2025-05-25 02:21:39.765 [rpcDispatch_RMROLE_1_5_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-25 02:21:39.772 [rpcDispatch_RMROLE_1_6_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:153776404394049562', branchId=153776404394049564, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false,"skipCheckLock":true}'}
2025-05-25 02:21:39.772 [rpcDispatch_RMROLE_1_6_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:153776404394049562 153776404394049564 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false,"skipCheckLock":true}
2025-05-25 02:21:39.772 [rpcDispatch_RMROLE_1_6_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-25 02:21:39.780 [rpcDispatch_RMROLE_1_7_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:153776404394049562', branchId=153776404394049565, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false}'}
2025-05-25 02:21:39.780 [rpcDispatch_RMROLE_1_7_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:153776404394049562 153776404394049565 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false}
2025-05-25 02:21:39.780 [rpcDispatch_RMROLE_1_7_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-25 02:21:39.789 [rpcDispatch_RMROLE_1_8_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:153776404394049562', branchId=153776404394049566, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false}'}
2025-05-25 02:21:39.789 [rpcDispatch_RMROLE_1_8_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:153776404394049562 153776404394049566 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false}
2025-05-25 02:21:39.789 [rpcDispatch_RMROLE_1_8_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-25 02:22:01.593 [Thread-7] WARN  com.alibaba.nacos.common.notify.NotifyCenter - [NotifyCenter] Start destroying Publisher
2025-05-25 02:22:01.593 [Thread-1] WARN  c.alibaba.nacos.common.http.HttpClientBeanHolder - [HttpClientBeanHolder] Start destroying common HttpClient
2025-05-25 02:22:01.593 [Thread-7] WARN  com.alibaba.nacos.common.notify.NotifyCenter - [NotifyCenter] Destruction of the end
2025-05-25 02:22:01.594 [Thread-1] WARN  c.alibaba.nacos.common.http.HttpClientBeanHolder - [HttpClientBeanHolder] Destruction of the end
2025-05-25 02:22:01.610 [SpringContextShutdownHook] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - De-registering from Nacos Server now...
2025-05-25 02:22:01.610 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - [DEREGISTER-SERVICE] d750d92e-152f-4055-a641-3bc9dda85a29 deregistering service bgtech-ai with instance: Instance{instanceId='null', ip='192.168.86.8', port=8080, weight=1.0, healthy=true, enabled=true, ephemeral=true, clusterName='DEFAULT', serviceName='null', metadata={}}
2025-05-25 02:22:01.619 [SpringContextShutdownHook] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - De-registration finished.
2025-05-25 02:22:01.621 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.cache.ServiceInfoHolder do shutdown begin
2025-05-25 02:22:01.621 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.backups.FailoverReactor do shutdown begin
2025-05-25 02:22:01.621 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.backups.FailoverReactor do shutdown stop
2025-05-25 02:22:01.621 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.cache.ServiceInfoHolder do shutdown stop
2025-05-25 02:22:01.621 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.NamingClientProxyDelegate do shutdown begin
2025-05-25 02:22:01.621 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServiceInfoUpdateService do shutdown begin
2025-05-25 02:22:01.621 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServiceInfoUpdateService do shutdown stop
2025-05-25 02:22:01.621 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServerListManager do shutdown begin
2025-05-25 02:22:01.622 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Start destroying NacosRestTemplate
2025-05-25 02:22:01.622 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Destruction of the end
2025-05-25 02:22:01.622 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServerListManager do shutdown stop
2025-05-25 02:22:01.622 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.http.NamingHttpClientProxy do shutdown begin
2025-05-25 02:22:01.622 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Start destroying NacosRestTemplate
2025-05-25 02:22:01.622 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Destruction of the end
2025-05-25 02:22:01.622 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.http.NamingHttpClientProxy do shutdown stop
2025-05-25 02:22:01.622 [SpringContextShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Shutdown rpc client, set status to shutdown
2025-05-25 02:22:01.622 [SpringContextShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Shutdown client event executor java.util.concurrent.ScheduledThreadPoolExecutor@7f8a2f71[Running, pool size = 2, active threads = 2, queued tasks = 0, completed tasks = 0]
2025-05-25 02:22:01.622 [SpringContextShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Close current connection 1748110858951_139.227.195.192_48485
2025-05-25 02:22:01.625 [nacos-grpc-client-executor-8.133.246.113-24] WARN  c.a.nacos.common.remote.client.grpc.GrpcClient - [1748110858951_139.227.195.192_48485]Ignore error event,isRunning:false,isAbandon=false
2025-05-25 02:22:01.626 [SpringContextShutdownHook] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - Shutdown grpc executor java.util.concurrent.ThreadPoolExecutor@1d49cb96[Running, pool size = 5, active threads = 0, queued tasks = 0, completed tasks = 25]
2025-05-25 02:22:01.627 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - Shutdown grpc redo service executor java.util.concurrent.ScheduledThreadPoolExecutor@6113d713[Running, pool size = 1, active threads = 0, queued tasks = 1, completed tasks = 20]
2025-05-25 02:22:01.627 [SpringContextShutdownHook] INFO  c.a.n.client.auth.ram.identify.CredentialWatcher - [null] CredentialWatcher is stopped
2025-05-25 02:22:01.627 [SpringContextShutdownHook] INFO  c.a.n.client.auth.ram.identify.CredentialService - [null] CredentialService is freed
2025-05-25 02:22:01.627 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.NamingClientProxyDelegate do shutdown stop
2025-05-25 02:22:01.633 [SpringContextShutdownHook] DEBUG com.bgpay.bgai.config.AsyncConfig$1 - Shutting down ExecutorService 'blockingExecutor'
2025-05-25 02:22:03.499 [com.alibaba.nacos.client.Worker] INFO  c.a.n.client.auth.ram.identify.CredentialWatcher - null No credential found
2025-05-25 02:22:03.708 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:10911] result: true
2025-05-25 02:22:03.708 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:9876] result: true
2025-05-25 02:22:03.724 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:10911] result: true
2025-05-25 02:22:03.724 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:9876] result: true
2025-05-25 02:22:03.840 [SpringContextShutdownHook] INFO  o.s.orm.jpa.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-05-25 02:22:03.842 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-2} closing ...
2025-05-25 02:22:03.850 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-2} closed
2025-05-25 02:22:03.850 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} closing ...
2025-05-25 02:22:03.851 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} closed
2025-05-25 02:22:03.851 [NettyClientSelector_TMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - channel inactive: [id: 0x57f9606a, L:/192.168.86.8:56079 ! R:/8.133.246.113:8091]
2025-05-25 02:22:03.851 [NettyClientSelector_TMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - return to pool, rm channel:[id: 0x57f9606a, L:/192.168.86.8:56079 ! R:/8.133.246.113:8091]
2025-05-25 02:22:03.851 [NettyClientSelector_TMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - channel valid false,channel:[id: 0x57f9606a, L:/192.168.86.8:56079 ! R:/8.133.246.113:8091]
2025-05-25 02:22:03.851 [NettyClientSelector_TMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - will destroy channel:[id: 0x57f9606a, L:/192.168.86.8:56079 ! R:/8.133.246.113:8091]
2025-05-25 02:22:03.851 [NettyClientSelector_TMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0x57f9606a, L:/192.168.86.8:56079 ! R:/8.133.246.113:8091]) will closed
2025-05-25 02:22:03.851 [NettyClientSelector_TMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0x57f9606a, L:/192.168.86.8:56079 ! R:/8.133.246.113:8091]) will closed
2025-05-25 02:22:03.853 [NettyClientSelector_RMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - channel inactive: [id: 0x2d5e3af1, L:/192.168.86.8:56084 ! R:/8.133.246.113:8091]
2025-05-25 02:22:03.853 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - return to pool, rm channel:[id: 0x2d5e3af1, L:/192.168.86.8:56084 ! R:/8.133.246.113:8091]
2025-05-25 02:22:03.853 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - channel valid false,channel:[id: 0x2d5e3af1, L:/192.168.86.8:56084 ! R:/8.133.246.113:8091]
2025-05-25 02:22:03.853 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - will destroy channel:[id: 0x2d5e3af1, L:/192.168.86.8:56084 ! R:/8.133.246.113:8091]
2025-05-25 02:22:03.853 [NettyClientSelector_RMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0x2d5e3af1, L:/192.168.86.8:56084 ! R:/8.133.246.113:8091]) will closed
2025-05-25 02:22:03.853 [NettyClientSelector_RMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0x2d5e3af1, L:/192.168.86.8:56084 ! R:/8.133.246.113:8091]) will closed
2025-05-25 02:24:05.482 [main] WARN  com.alibaba.nacos.client.logging.NacosLogging - Load Logback Configuration of Nacos fail, message: Could not initialize Logback Nacos logging from classpath:nacos-logback.xml
2025-05-25 02:24:05.483 [main] INFO  com.bgpay.bgai.BgaiApplication - The following 1 profile is active: "dev"
2025-05-25 02:24:06.899 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-05-25 02:24:06.901 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-05-25 02:24:06.937 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 26 ms. Found 0 JPA repository interfaces.
2025-05-25 02:24:06.955 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-05-25 02:24:06.957 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-05-25 02:24:06.978 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 8 ms. Found 0 Redis repository interfaces.
2025-05-25 02:24:07.597 [main] INFO  io.seata.config.ConfigurationFactory - load Configuration from :Spring Configuration
2025-05-25 02:24:07.606 [main] INFO  io.seata.config.ConfigurationFactory - load Configuration from :Spring Configuration
2025-05-25 02:24:07.612 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Initializing Global Transaction Clients ... 
2025-05-25 02:24:07.716 [main] INFO  io.seata.core.rpc.netty.NettyClientBootstrap - NettyClientBootstrap has started
2025-05-25 02:24:07.717 [main] INFO  io.seata.discovery.registry.RegistryFactory - use registry center type: file
2025-05-25 02:24:07.726 [main] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - will connect to 8.133.246.113:8091
2025-05-25 02:24:07.729 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - NettyPool create channel to transactionRole:TMROLE,address:8.133.246.113:8091,msg:< RegisterTMRequest{version='1.7.0', applicationId='bgtech-ai', transactionServiceGroup='bgai-tx-group', extraData='ak=null
digest=bgai-tx-group,192.168.86.8,1748111047728
timestamp=1748111047728
authVersion=V4
vgroup=bgai-tx-group
ip=192.168.86.8
'} >
2025-05-25 02:24:07.867 [main] INFO  io.seata.core.rpc.netty.TmNettyRemotingClient - register TM success. client version:1.7.0, server version:1.8.1-SNAPSHOT,channel:[id: 0x4816a927, L:/192.168.86.8:58831 - R:/8.133.246.113:8091]
2025-05-25 02:24:07.873 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - register success, cost 73 ms, version:1.8.1-SNAPSHOT,role:TMROLE,channel:[id: 0x4816a927, L:/192.168.86.8:58831 - R:/8.133.246.113:8091]
2025-05-25 02:24:07.874 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Transaction Manager Client is initialized. applicationId[bgtech-ai] txServiceGroup[bgai-tx-group]
2025-05-25 02:24:07.885 [main] INFO  io.seata.rm.datasource.AsyncWorker - Async Commit Buffer Limit: 10000
2025-05-25 02:24:07.887 [main] INFO  io.seata.rm.datasource.xa.ResourceManagerXA - ResourceManagerXA init ...
2025-05-25 02:24:07.893 [main] INFO  io.seata.core.rpc.netty.NettyClientBootstrap - NettyClientBootstrap has started
2025-05-25 02:24:07.893 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Resource Manager is initialized. applicationId[bgtech-ai] txServiceGroup[bgai-tx-group]
2025-05-25 02:24:07.893 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Global Transaction Clients are initialized. 
2025-05-25 02:24:09.045 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat initialized with port(s): 8080 (http)
2025-05-25 02:24:09.054 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - The ["http-nio-8080"] connector has been configured to support HTTP upgrade to [h2c]
2025-05-25 02:24:09.055 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - Initializing ProtocolHandler ["http-nio-8080"]
2025-05-25 02:24:09.056 [main] INFO  org.apache.catalina.core.StandardService - Starting service [Tomcat]
2025-05-25 02:24:09.056 [main] INFO  org.apache.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.15]
2025-05-25 02:24:09.422 [main] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} inited
2025-05-25 02:24:09.679 [main] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - will connect to 8.133.246.113:8091
2025-05-25 02:24:09.680 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - RM will register :jdbc:mysql://8.133.246.113:3306/deepseek
2025-05-25 02:24:09.680 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - NettyPool create channel to transactionRole:RMROLE,address:8.133.246.113:8091,msg:< RegisterRMRequest{resourceIds='jdbc:mysql://8.133.246.113:3306/deepseek', version='1.7.0', applicationId='bgtech-ai', transactionServiceGroup='bgai-tx-group', extraData='null'} >
2025-05-25 02:24:09.698 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - register RM success. client version:1.7.0, server version:1.8.1-SNAPSHOT,channel:[id: 0x766319a1, L:/192.168.86.8:58834 - R:/8.133.246.113:8091]
2025-05-25 02:24:09.698 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - register success, cost 9 ms, version:1.8.1-SNAPSHOT,role:RMROLE,channel:[id: 0x766319a1, L:/192.168.86.8:58834 - R:/8.133.246.113:8091]
2025-05-25 02:24:09.701 [main] INFO  i.s.s.a.datasource.SeataAutoDataSourceProxyCreator - Auto proxy data source 'masterDataSource' by 'AT' mode.
2025-05-25 02:24:09.816 [main] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-2} inited
2025-05-25 02:24:09.883 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - will register resourceId:jdbc:mysql://8.133.246.113:3306/deepseek
2025-05-25 02:24:09.885 [main] INFO  i.s.s.a.datasource.SeataAutoDataSourceProxyCreator - Auto proxy data source 'slaveDataSource' by 'AT' mode.
2025-05-25 02:24:09.891 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.rm.AbstractRMHandler - the rm client received response msg [RegisterRMResponse{version='1.8.1-SNAPSHOT', extraData='null', identified=true, resultCode=null, msg='null'}] from tc server.
2025-05-25 02:24:09.929 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - will register resourceId:jdbc:mysql://8.133.246.113:3306/deepseek
2025-05-25 02:24:09.930 [main] INFO  i.s.s.a.datasource.SeataAutoDataSourceProxyCreator - Auto proxy data source 'dynamicDataSource' by 'AT' mode.
2025-05-25 02:24:09.942 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.rm.AbstractRMHandler - the rm client received response msg [RegisterRMResponse{version='1.8.1-SNAPSHOT', extraData='null', identified=true, resultCode=null, msg='null'}] from tc server.
2025-05-25 02:24:10.079 [main] INFO  org.hibernate.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-05-25 02:24:10.149 [main] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.1.7.Final
2025-05-25 02:24:10.479 [main] INFO  SQL dialect - HHH000400: Using dialect: org.hibernate.dialect.MySQL8Dialect
2025-05-25 02:24:10.481 [main] WARN  org.hibernate.orm.deprecation - HHH90000026: MySQL8Dialect has been deprecated; use org.hibernate.dialect.MySQLDialect instead
2025-05-25 02:24:10.732 [main] INFO  o.h.e.t.jta.platform.internal.JtaPlatformInitiator - HHH000490: Using JtaPlatform implementation: [org.hibernate.engine.transaction.jta.platform.internal.NoJtaPlatform]
2025-05-25 02:24:10.742 [main] INFO  o.s.orm.jpa.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-05-25 02:24:11.149 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-25 02:24:11.161 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-25 02:24:11.188 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-25 02:24:11.190 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-25 02:24:11.191 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-25 02:24:11.203 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-25 02:24:11.833 [main] INFO  com.bgpay.bgai.service.impl.UserServiceImpl - 初始化SSO配置: clientId=bgai-client-id, redirectUri=http://localhost:8080/api/auth/callback
2025-05-25 02:24:11.990 [main] INFO  com.bgpay.bgai.controller.AuthController - 初始化认证控制器: clientId=bgai-client-id, redirectUri=http://localhost:8080/api/auth/callback
2025-05-25 02:24:12.489 [main] INFO  o.a.r.s.autoconfigure.RocketMQAutoConfiguration - a producer (billing-producer-group) init on namesrv 8.133.246.113:9876
2025-05-25 02:24:13.253 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Bean [com.bgpay.bgai.service.deepseek.DeepSeekServiceImp$$SpringCGLIB$$0] with name [deepSeekServiceImp] would use interceptor [io.seata.spring.annotation.GlobalTransactionalInterceptor]
2025-05-25 02:24:13.540 [main] WARN  i.s.s.b.a.provider.SpringBootConfigurationProvider - The get method not found for the field 'SeataProperties#accesskey'.
2025-05-25 02:24:13.540 [main] WARN  i.s.s.b.a.provider.SpringBootConfigurationProvider - The get method not found for the field 'SeataProperties#secretkey'.
2025-05-25 02:24:13.551 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 加载到1个Saga状态机定义文件
2025-05-25 02:24:13.692 [main] INFO  com.bgpay.bgai.saga.CustomSagaJsonParser - 开始解析状态机定义: bgai-saga-transaction
2025-05-25 02:24:13.692 [main] INFO  com.bgpay.bgai.saga.CustomSagaJsonParser - 状态机定义解析成功: bgai-saga-transaction
2025-05-25 02:24:13.693 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 成功加载状态机定义: /E:/project/bgai/target/classes/statelang/bgai-saga-transaction.json
2025-05-25 02:24:14.178 [main] INFO  org.redisson.Version - Redisson 3.24.3
2025-05-25 02:24:14.332 [redisson-netty-4-6] INFO  o.r.connection.pool.MasterPubSubConnectionPool - 1 connections initialized for 8.133.246.113/8.133.246.113:6379
2025-05-25 02:24:14.658 [redisson-netty-4-19] INFO  org.redisson.connection.pool.MasterConnectionPool - 24 connections initialized for 8.133.246.113/8.133.246.113:6379
2025-05-25 02:24:14.838 [main] INFO  com.bgpay.bgai.service.mq.MQConsumerService - MQ consumer startup successful [group=billing-consumer-group, topic=BILLING_TOPIC, tag=USER_BILLING]
2025-05-25 02:24:15.012 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Bean [com.bgpay.bgai.service.mq.BillingTransactionListenerImpl$$SpringCGLIB$$0] with name [billingTransactionListenerImpl] would use interceptor [io.seata.spring.annotation.GlobalTransactionalInterceptor]
2025-05-25 02:24:15.128 [main] DEBUG com.bgpay.bgai.config.AsyncConfig$1 - Initializing ExecutorService 'blockingExecutor'
2025-05-25 02:24:15.153 [main] INFO  c.b.bgai.config.NacosConfig$NacosWarningHandler - Nacos警告处理器已启用，将忽略配置中心连接警告
2025-05-25 02:24:16.309 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [After]
2025-05-25 02:24:16.310 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Before]
2025-05-25 02:24:16.310 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Between]
2025-05-25 02:24:16.310 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Cookie]
2025-05-25 02:24:16.310 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Header]
2025-05-25 02:24:16.310 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Host]
2025-05-25 02:24:16.310 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Method]
2025-05-25 02:24:16.310 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Path]
2025-05-25 02:24:16.310 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Query]
2025-05-25 02:24:16.310 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [ReadBody]
2025-05-25 02:24:16.310 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [RemoteAddr]
2025-05-25 02:24:16.310 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [XForwardedRemoteAddr]
2025-05-25 02:24:16.310 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Weight]
2025-05-25 02:24:16.311 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [CloudFoundryRouteService]
2025-05-25 02:24:17.775 [main] INFO  o.s.b.actuate.endpoint.web.EndpointLinksResolver - Exposing 3 endpoint(s) beneath base path '/actuator'
2025-05-25 02:24:19.308 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - Starting ProtocolHandler ["http-nio-8080"]
2025-05-25 02:24:19.324 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat started on port(s): 8080 (http) with context path ''
2025-05-25 02:24:19.335 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from ans.namespace attribute : null
2025-05-25 02:24:19.336 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from ALIBABA_ALIWARE_NAMESPACE attribute :null
2025-05-25 02:24:19.336 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from namespace attribute :null
2025-05-25 02:24:19.351 [main] INFO  c.a.n.p.auth.spi.client.ClientAuthPluginManager - [ClientAuthPluginManager] Load ClientAuthService com.alibaba.nacos.client.auth.impl.NacosClientAuthServiceImpl success.
2025-05-25 02:24:19.352 [main] INFO  c.a.n.p.auth.spi.client.ClientAuthPluginManager - [ClientAuthPluginManager] Load ClientAuthService com.alibaba.nacos.client.auth.ram.RamClientAuthServiceImpl success.
2025-05-25 02:24:19.357 [main] INFO  com.alibaba.nacos.common.remote.client - [RpcClientFactory] create a new rpc client of 2492f90e-f609-4509-83fd-57f9a84f6959
2025-05-25 02:24:19.359 [main] INFO  com.alibaba.nacos.common.remote.client - [2492f90e-f609-4509-83fd-57f9a84f6959] RpcClient init, ServerListFactory = com.alibaba.nacos.client.naming.core.ServerListManager
2025-05-25 02:24:19.359 [main] INFO  com.alibaba.nacos.common.remote.client - [2492f90e-f609-4509-83fd-57f9a84f6959] Registry connection listener to current client:com.alibaba.nacos.client.naming.remote.gprc.redo.NamingGrpcRedoService
2025-05-25 02:24:19.360 [main] INFO  com.alibaba.nacos.common.remote.client - [2492f90e-f609-4509-83fd-57f9a84f6959] Register server push request handler:com.alibaba.nacos.client.naming.remote.gprc.NamingPushRequestHandler
2025-05-25 02:24:19.360 [main] INFO  com.alibaba.nacos.common.remote.client - [2492f90e-f609-4509-83fd-57f9a84f6959] Try to connect to server on start up, server: {serverIp = '8.133.246.113', server main port = 8848}
2025-05-25 02:24:19.361 [main] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - grpc client connection server:8.133.246.113 ip,serverPort:9848,grpcTslConfig:{"sslProvider":"OPENSSL","enableTls":false,"mutualAuthEnable":false,"trustAll":false}
2025-05-25 02:24:19.636 [main] INFO  com.alibaba.nacos.common.remote.client - [2492f90e-f609-4509-83fd-57f9a84f6959] Success to connect to server [8.133.246.113:8848] on start up, connectionId = 1748111059438_139.227.195.192_49607
2025-05-25 02:24:19.636 [main] INFO  com.alibaba.nacos.common.remote.client - [2492f90e-f609-4509-83fd-57f9a84f6959] Register server push request handler:com.alibaba.nacos.common.remote.client.RpcClient$ConnectResetRequestHandler
2025-05-25 02:24:19.636 [com.alibaba.nacos.client.remote.worker] INFO  com.alibaba.nacos.common.remote.client - [2492f90e-f609-4509-83fd-57f9a84f6959] Notify connected event to listeners.
2025-05-25 02:24:19.636 [main] INFO  com.alibaba.nacos.common.remote.client - [2492f90e-f609-4509-83fd-57f9a84f6959] Register server push request handler:com.alibaba.nacos.common.remote.client.RpcClient$$Lambda/0x0000023859528870
2025-05-25 02:24:19.636 [com.alibaba.nacos.client.remote.worker] INFO  com.alibaba.nacos.client.naming - Grpc connection connect
2025-05-25 02:24:19.637 [main] INFO  com.alibaba.nacos.client.naming - [REGISTER-SERVICE] d750d92e-152f-4055-a641-3bc9dda85a29 registering service bgtech-ai with instance Instance{instanceId='null', ip='192.168.86.8', port=8080, weight=1.0, healthy=true, enabled=true, ephemeral=true, clusterName='DEFAULT', serviceName='null', metadata={IPv6=[2408:820c:7528:d042:c185:8edc:f30d:3d91], preserved.register.source=SPRING_CLOUD}}
2025-05-25 02:24:19.653 [main] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - nacos registry, DEFAULT_GROUP bgtech-ai 192.168.86.8:8080 register finished
2025-05-25 02:24:19.698 [main] INFO  com.bgpay.bgai.config.NacosConfig - 应用启动完成，当前环境: dev
2025-05-25 02:24:19.698 [main] INFO  com.bgpay.bgai.config.NacosConfig - Nacos配置中心: 8.133.246.113:8848, 命名空间: d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-25 02:24:19.698 [main] INFO  com.bgpay.bgai.config.NacosConfig - 注意: 如果看到Nacos配置加载警告，但应用正常启动，说明应用正在使用本地配置文件
2025-05-25 02:24:19.699 [main] INFO  com.bgpay.bgai.BgaiApplication - Started BgaiApplication in 16.315 seconds (process running for 17.857)
2025-05-25 02:24:19.702 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-25 02:24:19.702 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-25 02:24:19.723 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-25 02:24:19.723 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-25 02:24:19.723 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-25 02:24:19.731 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-25 02:24:19.732 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-25 02:24:19.732 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-25 02:24:19.739 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-25 02:24:19.739 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-25 02:24:19.739 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-25 02:24:19.744 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-25 02:24:19.745 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - ==================== Saga状态机加载报告 ====================
2025-05-25 02:24:19.745 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - Saga状态机配置加载状态: 成功
2025-05-25 02:24:19.745 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 已加载的状态机定义文件数量: 1
2025-05-25 02:24:19.745 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 已加载的状态机定义文件:
2025-05-25 02:24:19.745 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig -  - /E:/project/bgai/target/classes/statelang/bgai-saga-transaction.json
2025-05-25 02:24:19.745 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - Saga解析器状态: CUSTOM_FASTJSON2
2025-05-25 02:24:19.745 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 状态机解析结果: 成功 1 个, 失败 0 个
2025-05-25 02:24:19.745 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - =============================================================
2025-05-25 02:24:19.749 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - nacos.cache.data.init.snapshot = true 
2025-05-25 02:24:19.749 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] common-dev.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-25 02:24:19.758 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=common-dev.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-25 02:24:19.758 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=common-dev.yaml, group=DEFAULT_GROUP
2025-05-25 02:24:19.758 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-25 02:24:19.758 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-25 02:24:19.758 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai.yaml, group=DEFAULT_GROUP
2025-05-25 02:24:19.760 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai-dev.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-25 02:24:19.761 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai-dev.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-25 02:24:19.761 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai-dev.yaml, group=DEFAULT_GROUP
2025-05-25 02:24:19.761 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-25 02:24:19.761 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai, group=DEFAULT_GROUP, cnt=1
2025-05-25 02:24:19.761 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai, group=DEFAULT_GROUP
2025-05-25 02:24:44.405 [http-nio-8080-exec-3] DEBUG com.bgpay.bgai.filter.ApiKeyAuthenticationFilter - Skipping API Key validation for excluded path: /auth/authorize
2025-05-25 02:24:44.430 [http-nio-8080-exec-3] INFO  com.bgpay.bgai.controller.MockAuthController - Authorization request: client_id=bgai-client-id, redirect_uri=http://localhost:8080/api/auth/callback, response_type=code
2025-05-25 02:24:54.403 [http-nio-8080-exec-4] DEBUG com.bgpay.bgai.filter.ApiKeyAuthenticationFilter - Skipping API Key validation for excluded path: /api/auth/callback
2025-05-25 02:24:54.458 [http-nio-8080-exec-5] DEBUG com.bgpay.bgai.filter.ApiKeyAuthenticationFilter - Skipping API Key validation for excluded path: /auth/token
2025-05-25 02:24:54.461 [http-nio-8080-exec-5] INFO  com.bgpay.bgai.controller.MockAuthController - Token request: grant_type=null, code=null, client_id=null
2025-05-25 02:24:54.479 [http-nio-8080-exec-6] DEBUG com.bgpay.bgai.filter.ApiKeyAuthenticationFilter - Skipping API Key validation for excluded path: /auth/userinfo
2025-05-25 02:24:54.490 [http-nio-8080-exec-4] DEBUG com.bgpay.bgai.mapper.UserMapper.findByUserId - ==>  Preparing: SELECT * FROM t_user WHERE user_id = ?
2025-05-25 02:24:54.491 [http-nio-8080-exec-4] DEBUG com.bgpay.bgai.mapper.UserMapper.findByUserId - ==> Parameters: 689258T(String)
2025-05-25 02:24:54.501 [http-nio-8080-exec-4] DEBUG com.bgpay.bgai.mapper.UserMapper.findByUserId - <==      Total: 1
2025-05-25 02:24:54.575 [http-nio-8080-exec-4] DEBUG com.bgpay.bgai.mapper.UserMapper.updateById - ==>  Preparing: UPDATE t_user SET user_id=?, username=?, email=?, avatar_url=?, last_login_time=?, access_token=?, refresh_token=?, token_expire_time=?, status=?, create_time=?, update_time=? WHERE id=?
2025-05-25 02:24:54.582 [http-nio-8080-exec-4] DEBUG com.bgpay.bgai.mapper.UserMapper.updateById - ==> Parameters: 689258T(String), 测试用户(String), test@example.com(String), https://ui-avatars.com/api/?name=测试用户(String), 2025-05-25T02:24:54.501831300(LocalDateTime), b535af14-5ecb-49dd-b2ad-1f8616d40c4c(String), 1e9e48a3-ff47-47d0-8f16-1e1adcebf411(String), 2025-05-25T03:24:54.501831300(LocalDateTime), 1(Integer), 2025-04-26T23:59:16(LocalDateTime), 2025-05-25T02:24:54.501831300(LocalDateTime), 1(Long)
2025-05-25 02:24:54.600 [http-nio-8080-exec-4] DEBUG com.bgpay.bgai.mapper.UserMapper.updateById - <==    Updates: 1
2025-05-25 02:25:09.027 [http-nio-8080-exec-7] INFO  com.bgpay.bgai.controller.ReactiveChatController - 接收到请求: /api/chatGatWay-internal, 文件=新文件 17.txt, 问题参数=null, 模型参数=null
2025-05-25 02:25:09.029 [http-nio-8080-exec-7] INFO  com.bgpay.bgai.controller.ReactiveChatController - 请求Content-Type: multipart/form-data;boundary=--------------------------183698795682579156138454
2025-05-25 02:25:09.030 [http-nio-8080-exec-7] INFO  com.bgpay.bgai.controller.ReactiveChatController - 收集到的完整参数: question="null", apiUrl="null", modelName="null", multiTurn=false
2025-05-25 02:25:09.032 [http-nio-8080-exec-7] INFO  com.bgpay.bgai.controller.ReactiveChatController - Processing request for user ID: 689258T
2025-05-25 02:25:09.032 [http-nio-8080-exec-7] INFO  com.bgpay.bgai.controller.ReactiveChatController - Processing file with circuit breaker: fileName=新文件 17.txt, question=
2025-05-25 02:25:09.034 [http-nio-8080-exec-7] INFO  com.bgpay.bgai.config.ReactiveFileProcessor - Processing file: 新文件 17.txt, content-type: text/plain
2025-05-25 02:25:09.043 [http-nio-8080-exec-7] INFO  com.bgpay.bgai.controller.ReactiveChatController - PARAM TRACE [689258T]: 尝试查找匹配配置 - 参数: apiUrl=null, modelName=null
2025-05-25 02:25:09.054 [http-nio-8080-exec-7] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 查询配置 - userId=689258T
2025-05-25 02:25:09.056 [http-nio-8080-exec-7] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 排序方式 - 按ID降序
2025-05-25 02:25:09.056 [http-nio-8080-exec-7] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 限制结果数 - LIMIT 1
2025-05-25 02:25:09.065 [http-nio-8080-exec-7] DEBUG com.bgpay.bgai.mapper.ApiConfigMapper.selectList - ==>  Preparing: SELECT id,api_url,api_key,model_name,user_id FROM api_config WHERE (user_id = ?) ORDER BY id DESC LIMIT 1
2025-05-25 02:25:09.066 [http-nio-8080-exec-7] DEBUG com.bgpay.bgai.mapper.ApiConfigMapper.selectList - ==> Parameters: 689258T(String)
2025-05-25 02:25:09.074 [http-nio-8080-exec-7] DEBUG com.bgpay.bgai.mapper.ApiConfigMapper.selectList - <==      Total: 1
2025-05-25 02:25:09.075 [http-nio-8080-exec-7] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 查询结果 - 找到配置: id=2, modelName=deepseek-chat
2025-05-25 02:25:09.075 [http-nio-8080-exec-7] INFO  com.bgpay.bgai.controller.ReactiveChatController - PARAM TRACE [689258T]: 找到匹配配置 - apiUrl=https://api.deepseek.com/chat/completions, modelName=deepseek-chat (原始请求: null)
2025-05-25 02:25:09.075 [http-nio-8080-exec-7] INFO  com.bgpay.bgai.controller.ReactiveChatController - API config resolved: url=https://api.deepseek.com/chat/completions, model=deepseek-chat
2025-05-25 02:25:09.094 [Thread-57] INFO  com.bgpay.bgai.config.ReactiveFileProcessor - File processed successfully: size=37 bytes
2025-05-25 02:25:09.098 [Thread-57] INFO  com.bgpay.bgai.controller.ReactiveChatController - Content processed, length: 54
2025-05-25 02:25:09.103 [Thread-57] INFO  io.seata.tm.TransactionManagerHolder - TransactionManager Singleton io.seata.tm.DefaultTransactionManager@48136ccb
2025-05-25 02:25:09.118 [Thread-57] INFO  io.seata.tm.api.DefaultGlobalTransaction - Begin new global transaction [seata-server:8091:153776404394049567]
2025-05-25 02:25:09.119 [Thread-57] INFO  c.b.bgai.interceptor.SeataTransactionInterceptor - 准备记录分布式事务开始: XID=seata-server:8091:153776404394049567, 业务=com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive, 路径=, IP=, 用户=system
2025-05-25 02:25:09.131 [Thread-57] INFO  c.b.bgai.service.impl.TransactionLogServiceImpl - 记录分布式事务开始: XID=seata-server:8091:153776404394049567, 业务=com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive
2025-05-25 02:25:09.135 [Thread-57] DEBUG com.bgpay.bgai.mapper.TransactionLogMapper.insert - ==>  Preparing: INSERT INTO transaction_log ( xid, transaction_name, transaction_mode, status, request_path, source_ip, start_time, user_id, create_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-05-25 02:25:09.138 [Thread-57] DEBUG com.bgpay.bgai.mapper.TransactionLogMapper.insert - ==> Parameters: seata-server:8091:153776404394049567(String), com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive(String), AT(String), ACTIVE(String), (String), (String), 2025-05-25T02:25:09.131638700(LocalDateTime), system(String), 2025-05-25T02:25:09.131638700(LocalDateTime)
2025-05-25 02:25:09.545 [Thread-57] DEBUG com.bgpay.bgai.mapper.TransactionLogMapper.insert - <==    Updates: 1
2025-05-25 02:25:09.562 [Thread-57] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:153776404394049567, branchId:153776404394049568, lockKeys:transaction_log:37
2025-05-25 02:25:09.574 [Thread-57] WARN  i.s.c.l.EnhancedServiceLoader$InnerEnhancedServiceLoader - Load [io.seata.rm.datasource.undo.parser.ProtostuffUndoLogParser] class fail: io/protostuff/runtime/IdStrategy
2025-05-25 02:25:09.646 [Thread-57] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:153776404394049567, branchId:153776404394049569, lockKeys:transaction_log:37;undo_log:145
2025-05-25 02:25:09.677 [Thread-57] INFO  c.b.bgai.interceptor.SeataTransactionInterceptor - 开始分布式事务: XID=seata-server:8091:153776404394049567, 方法=com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive
2025-05-25 02:25:09.690 [Thread-57] INFO  org.reflections.Reflections - Processing reactive request: content length=54, apiUrl=https://api.deepseek.com/chat/completions, modelName=deepseek-chat, userId=689258T, multiTurn=false
2025-05-25 02:25:09.700 [Thread-57] INFO  c.b.bgai.service.impl.TransactionLogServiceImpl - 记录分布式事务结束: XID=seata-server:8091:153776404394049567, 状态=COMMITTED
2025-05-25 02:25:09.702 [Thread-57] DEBUG c.b.bgai.mapper.TransactionLogMapper.selectList - ==>  Preparing: SELECT id,xid,branch_id,transaction_name,transaction_mode,status,request_path,source_ip,start_time,end_time,user_id,extra_data,create_time,update_time FROM transaction_log WHERE (xid = ?) LIMIT 1
2025-05-25 02:25:09.704 [Thread-57] DEBUG c.b.bgai.mapper.TransactionLogMapper.selectList - ==> Parameters: seata-server:8091:153776404394049567(String)
2025-05-25 02:25:09.712 [Thread-57] DEBUG c.b.bgai.mapper.TransactionLogMapper.selectList - <==      Total: 1
2025-05-25 02:25:09.715 [Thread-57] DEBUG c.b.bgai.mapper.TransactionLogMapper.updateById - ==>  Preparing: UPDATE transaction_log SET xid=?, transaction_name=?, transaction_mode=?, status=?, request_path=?, source_ip=?, start_time=?, end_time=?, user_id=?, extra_data=?, create_time=?, update_time=? WHERE id=?
2025-05-25 02:25:09.720 [Thread-57] DEBUG c.b.bgai.mapper.TransactionLogMapper.updateById - ==> Parameters: seata-server:8091:153776404394049567(String), com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive(String), AT(String), COMMITTED(String), (String), (String), 2025-05-25T02:25:09(LocalDateTime), 2025-05-25T02:25:09.712440200(LocalDateTime), system(String), {"duration":14,"result":"success"}(String), 2025-05-25T02:25:09(LocalDateTime), 2025-05-25T02:25:09.712440200(LocalDateTime), 37(Long)
2025-05-25 02:25:09.783 [Thread-57] DEBUG c.b.bgai.mapper.TransactionLogMapper.updateById - <==    Updates: 1
2025-05-25 02:25:09.793 [Thread-57] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:153776404394049567, branchId:153776404394049570, lockKeys:transaction_log:37
2025-05-25 02:25:09.822 [Thread-57] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:153776404394049567, branchId:153776404394049571, lockKeys:transaction_log:37;undo_log:147
2025-05-25 02:25:09.848 [Thread-57] INFO  c.b.bgai.interceptor.SeataTransactionInterceptor - 分布式事务成功完成: XID=seata-server:8091:153776404394049567, 耗时=14ms
2025-05-25 02:25:09.849 [Thread-57] INFO  io.seata.tm.api.DefaultGlobalTransaction - transaction seata-server:8091:153776404394049567 will be commit
2025-05-25 02:25:09.860 [Thread-57] INFO  io.seata.tm.api.DefaultGlobalTransaction - transaction end, xid = seata-server:8091:153776404394049567
2025-05-25 02:25:09.860 [Thread-57] INFO  io.seata.tm.api.DefaultGlobalTransaction - [seata-server:8091:153776404394049567] commit status: Committed
2025-05-25 02:25:09.903 [boundedElastic-1] INFO  com.bgpay.bgai.transaction.TransactionCoordinator - Transaction prepared for user 689258T: chatCompletionId=chat-60820bd5-2cbc-4155-88af-9ffce5512261
2025-05-25 02:25:09.903 [boundedElastic-1] INFO  org.reflections.Reflections - Transaction prepared with chatCompletionId: chat-60820bd5-2cbc-4155-88af-9ffce5512261
2025-05-25 02:25:10.762 [rpcDispatch_RMROLE_1_1_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:153776404394049567', branchId=153776404394049568, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false,"skipCheckLock":true}'}
2025-05-25 02:25:10.763 [rpcDispatch_RMROLE_1_1_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:153776404394049567 153776404394049568 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false,"skipCheckLock":true}
2025-05-25 02:25:10.764 [rpcDispatch_RMROLE_1_1_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-25 02:25:10.775 [rpcDispatch_RMROLE_1_2_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:153776404394049567', branchId=153776404394049569, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false,"skipCheckLock":true}'}
2025-05-25 02:25:10.775 [rpcDispatch_RMROLE_1_2_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:153776404394049567 153776404394049569 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false,"skipCheckLock":true}
2025-05-25 02:25:10.775 [rpcDispatch_RMROLE_1_2_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-25 02:25:10.785 [rpcDispatch_RMROLE_1_3_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:153776404394049567', branchId=153776404394049570, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false}'}
2025-05-25 02:25:10.785 [rpcDispatch_RMROLE_1_3_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:153776404394049567 153776404394049570 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false}
2025-05-25 02:25:10.785 [rpcDispatch_RMROLE_1_3_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-25 02:25:10.793 [rpcDispatch_RMROLE_1_4_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:153776404394049567', branchId=153776404394049571, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false}'}
2025-05-25 02:25:10.793 [rpcDispatch_RMROLE_1_4_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:153776404394049567 153776404394049571 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false}
2025-05-25 02:25:10.793 [rpcDispatch_RMROLE_1_4_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-25 02:25:46.880 [FileWrite-1] INFO  com.bgpay.bgai.service.deepseek.FileWriterService - Successfully wrote content to: \var\data\ai_responses\9ff21db1-2fb6-4db0-8f5a-7de28798fe92.txt
2025-05-25 02:25:46.890 [reactor-http-nio-2] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - ==>  Preparing: INSERT INTO chat_completions ( object, created, model, system_fingerprint, api_key ) VALUES ( ?, ?, ?, ?, ? )
2025-05-25 02:25:46.891 [reactor-http-nio-2] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - ==> Parameters: chat.completion(String), 1748111146889(Long), deepseek-chat(String), 689258T(String), chat-60820bd5-2cbc-4155-88af-9ffce5512261(String)
2025-05-25 02:25:46.902 [reactor-http-nio-2] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - <==    Updates: 1
2025-05-25 02:25:46.902 [reactor-http-nio-2] INFO  com.bgpay.bgai.transaction.TransactionCoordinator - Transaction committed for user 689258T: chatCompletionId=chat-60820bd5-2cbc-4155-88af-9ffce5512261
2025-05-25 02:25:46.919 [reactor-http-nio-2] INFO  org.reflections.Reflections - 开始发送账单消息，chatCompletionId: chat-60820bd5-2cbc-4155-88af-9ffce5512261, userId: 689258T
2025-05-25 02:25:46.964 [reactor-http-nio-2] INFO  io.seata.tm.api.DefaultGlobalTransaction - Begin new global transaction [seata-server:8091:153776404394049572]
2025-05-25 02:25:46.964 [reactor-http-nio-2] INFO  c.b.bgai.interceptor.SeataTransactionInterceptor - 准备记录分布式事务开始: XID=seata-server:8091:153776404394049572, 业务=com.bgpay.bgai.service.mq.BillingTransactionListenerImpl.executeLocalTransaction, 路径=, IP=, 用户=system
2025-05-25 02:25:46.969 [reactor-http-nio-2] INFO  c.b.bgai.service.impl.TransactionLogServiceImpl - 记录分布式事务开始: XID=seata-server:8091:153776404394049572, 业务=com.bgpay.bgai.service.mq.BillingTransactionListenerImpl.executeLocalTransaction
2025-05-25 02:25:46.969 [reactor-http-nio-2] DEBUG com.bgpay.bgai.mapper.TransactionLogMapper.insert - ==>  Preparing: INSERT INTO transaction_log ( xid, transaction_name, transaction_mode, status, request_path, source_ip, start_time, user_id, create_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-05-25 02:25:46.970 [reactor-http-nio-2] DEBUG com.bgpay.bgai.mapper.TransactionLogMapper.insert - ==> Parameters: seata-server:8091:153776404394049572(String), com.bgpay.bgai.service.mq.BillingTransactionListenerImpl.executeLocalTransaction(String), AT(String), ACTIVE(String), (String), (String), 2025-05-25T02:25:46.969268900(LocalDateTime), system(String), 2025-05-25T02:25:46.969268900(LocalDateTime)
2025-05-25 02:25:46.997 [reactor-http-nio-2] DEBUG com.bgpay.bgai.mapper.TransactionLogMapper.insert - <==    Updates: 1
2025-05-25 02:25:47.006 [reactor-http-nio-2] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:153776404394049572, branchId:153776404394049573, lockKeys:transaction_log:38
2025-05-25 02:25:47.027 [reactor-http-nio-2] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:153776404394049572, branchId:153776404394049574, lockKeys:transaction_log:38;undo_log:149
2025-05-25 02:25:47.073 [reactor-http-nio-2] INFO  c.b.bgai.interceptor.SeataTransactionInterceptor - 开始分布式事务: XID=seata-server:8091:153776404394049572, 方法=com.bgpay.bgai.service.mq.BillingTransactionListenerImpl.executeLocalTransaction
2025-05-25 02:25:47.073 [reactor-http-nio-2] INFO  c.b.bgai.service.mq.BillingTransactionListenerImpl - 开始执行本地事务, xid: seata-server:8091:153776404394049572, userId: 689258T, completionId: chat-60820bd5-2cbc-4155-88af-9ffce5512261
2025-05-25 02:25:47.087 [reactor-http-nio-2] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.selectCount - ==>  Preparing: SELECT COUNT( * ) AS total FROM usage_info WHERE (chat_completion_id = ?)
2025-05-25 02:25:47.088 [reactor-http-nio-2] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.selectCount - ==> Parameters: chat-60820bd5-2cbc-4155-88af-9ffce5512261(String)
2025-05-25 02:25:47.094 [reactor-http-nio-2] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.selectCount - <==      Total: 1
2025-05-25 02:25:47.103 [reactor-http-nio-2] INFO  com.bgpay.bgai.transaction.TransactionCoordinator - Transaction prepared for user 689258T: chatCompletionId=chat-a33da779-693d-42b6-9871-fdc079b3e57f
2025-05-25 02:25:47.103 [reactor-http-nio-2] ERROR c.b.bgai.service.mq.BillingTransactionListenerImpl - 事务ID不一致，回滚事务, expected: chat-60820bd5-2cbc-4155-88af-9ffce5512261, actual: chat-a33da779-693d-42b6-9871-fdc079b3e57f
2025-05-25 02:25:47.118 [reactor-http-nio-2] INFO  c.b.bgai.service.impl.TransactionLogServiceImpl - 记录分布式事务结束: XID=seata-server:8091:153776404394049572, 状态=COMMITTED
2025-05-25 02:25:47.119 [reactor-http-nio-2] DEBUG c.b.bgai.mapper.TransactionLogMapper.selectList - ==>  Preparing: SELECT id,xid,branch_id,transaction_name,transaction_mode,status,request_path,source_ip,start_time,end_time,user_id,extra_data,create_time,update_time FROM transaction_log WHERE (xid = ?) LIMIT 1
2025-05-25 02:25:47.119 [reactor-http-nio-2] DEBUG c.b.bgai.mapper.TransactionLogMapper.selectList - ==> Parameters: seata-server:8091:153776404394049572(String)
2025-05-25 02:25:47.128 [reactor-http-nio-2] DEBUG c.b.bgai.mapper.TransactionLogMapper.selectList - <==      Total: 1
2025-05-25 02:25:47.129 [reactor-http-nio-2] DEBUG c.b.bgai.mapper.TransactionLogMapper.updateById - ==>  Preparing: UPDATE transaction_log SET xid=?, transaction_name=?, transaction_mode=?, status=?, request_path=?, source_ip=?, start_time=?, end_time=?, user_id=?, extra_data=?, create_time=?, update_time=? WHERE id=?
2025-05-25 02:25:47.130 [reactor-http-nio-2] DEBUG c.b.bgai.mapper.TransactionLogMapper.updateById - ==> Parameters: seata-server:8091:153776404394049572(String), com.bgpay.bgai.service.mq.BillingTransactionListenerImpl.executeLocalTransaction(String), AT(String), COMMITTED(String), (String), (String), 2025-05-25T02:25:47(LocalDateTime), 2025-05-25T02:25:47.128304900(LocalDateTime), system(String), {"duration":30,"result":"success"}(String), 2025-05-25T02:25:47(LocalDateTime), 2025-05-25T02:25:47.128304900(LocalDateTime), 38(Long)
2025-05-25 02:25:47.206 [reactor-http-nio-2] DEBUG c.b.bgai.mapper.TransactionLogMapper.updateById - <==    Updates: 1
2025-05-25 02:25:47.223 [reactor-http-nio-2] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:153776404394049572, branchId:153776404394049575, lockKeys:transaction_log:38
2025-05-25 02:25:47.260 [reactor-http-nio-2] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:153776404394049572, branchId:153776404394049576, lockKeys:transaction_log:38;undo_log:151
2025-05-25 02:25:47.288 [reactor-http-nio-2] INFO  c.b.bgai.interceptor.SeataTransactionInterceptor - 分布式事务成功完成: XID=seata-server:8091:153776404394049572, 耗时=30ms
2025-05-25 02:25:47.288 [reactor-http-nio-2] INFO  io.seata.tm.api.DefaultGlobalTransaction - transaction seata-server:8091:153776404394049572 will be commit
2025-05-25 02:25:47.301 [reactor-http-nio-2] INFO  io.seata.tm.api.DefaultGlobalTransaction - transaction end, xid = seata-server:8091:153776404394049572
2025-05-25 02:25:47.301 [reactor-http-nio-2] INFO  io.seata.tm.api.DefaultGlobalTransaction - [seata-server:8091:153776404394049572] commit status: Committed
2025-05-25 02:25:47.303 [reactor-http-nio-2] INFO  org.reflections.Reflections - 账单消息发送成功，chatCompletionId: chat-60820bd5-2cbc-4155-88af-9ffce5512261, userId: 689258T
2025-05-25 02:25:47.311 [reactor-http-nio-2] INFO  com.bgpay.bgai.service.impl.BGAIServiceImpl - 执行第一步操作 - 发送账单消息, businessKey: 689258T:chat-60820bd5-2cbc-4155-88af-9ffce5512261
2025-05-25 02:25:47.312 [reactor-http-nio-2] DEBUG c.bgpay.bgai.mapper.UsageRecordMapper.selectCount - ==>  Preparing: SELECT COUNT( * ) AS total FROM usage_record WHERE (chat_completion_id = ?)
2025-05-25 02:25:47.312 [reactor-http-nio-2] DEBUG c.bgpay.bgai.mapper.UsageRecordMapper.selectCount - ==> Parameters: chat-60820bd5-2cbc-4155-88af-9ffce5512261(String)
2025-05-25 02:25:47.320 [reactor-http-nio-2] DEBUG c.bgpay.bgai.mapper.UsageRecordMapper.selectCount - <==      Total: 1
2025-05-25 02:25:47.340 [reactor-http-nio-2] DEBUG c.bgpay.bgai.mapper.UsageRecordMapper.selectList - ==>  Preparing: SELECT id,model_type,chat_completion_id,user_id,input_cost,output_cost,price_version,calculated_at,message_id,input_tokens,output_tokens,status,created_at,updated_at FROM usage_record WHERE (chat_completion_id = ?)
2025-05-25 02:25:47.340 [reactor-http-nio-2] DEBUG c.bgpay.bgai.mapper.UsageRecordMapper.selectList - ==> Parameters: chat-60820bd5-2cbc-4155-88af-9ffce5512261(String)
2025-05-25 02:25:47.421 [reactor-http-nio-2] ERROR com.bgpay.bgai.service.impl.BGAIServiceImpl - 发送账单消息失败, businessKey: 689258T:chat-60820bd5-2cbc-4155-88af-9ffce5512261
org.springframework.jdbc.BadSqlGrammarException: 
### Error querying database.  Cause: java.sql.SQLSyntaxErrorException: Unknown column 'message_id' in 'field list'
### The error may exist in com/bgpay/bgai/mapper/UsageRecordMapper.java (best guess)
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: SELECT  id,model_type,chat_completion_id,user_id,input_cost,output_cost,price_version,calculated_at,message_id,input_tokens,output_tokens,status,created_at,updated_at  FROM usage_record      WHERE  (chat_completion_id = ?)
### Cause: java.sql.SQLSyntaxErrorException: Unknown column 'message_id' in 'field list'
; bad SQL grammar []
	at org.springframework.jdbc.support.SQLErrorCodeSQLExceptionTranslator.doTranslate(SQLErrorCodeSQLExceptionTranslator.java:246)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:73)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:92)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:439)
	at jdk.proxy2/jdk.proxy2.$Proxy156.selectList(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.selectList(SqlSessionTemplate.java:224)
	at com.baomidou.mybatisplus.core.override.MybatisMapperMethod.executeForMany(MybatisMapperMethod.java:164)
	at com.baomidou.mybatisplus.core.override.MybatisMapperMethod.execute(MybatisMapperMethod.java:77)
	at com.baomidou.mybatisplus.core.override.MybatisMapperProxy$PlainMethodInvoker.invoke(MybatisMapperProxy.java:152)
	at com.baomidou.mybatisplus.core.override.MybatisMapperProxy.invoke(MybatisMapperProxy.java:89)
	at jdk.proxy2/jdk.proxy2.$Proxy184.selectList(Unknown Source)
	at com.baomidou.mybatisplus.core.mapper.BaseMapper.selectOne(BaseMapper.java:222)
	at java.base/java.lang.invoke.MethodHandle.invokeWithArguments(MethodHandle.java:733)
	at com.baomidou.mybatisplus.core.override.MybatisMapperProxy$DefaultMethodInvoker.invoke(MybatisMapperProxy.java:166)
	at com.baomidou.mybatisplus.core.override.MybatisMapperProxy.invoke(MybatisMapperProxy.java:89)
	at jdk.proxy2/jdk.proxy2.$Proxy184.selectOne(Unknown Source)
	at com.baomidou.mybatisplus.extension.service.impl.ServiceImpl.getOne(ServiceImpl.java:242)
	at com.baomidou.mybatisplus.extension.service.IService.getOne(IService.java:327)
	at com.bgpay.bgai.service.impl.UsageRecordServiceImpl.findByCompletionId(UsageRecordServiceImpl.java:39)
	at com.bgpay.bgai.service.impl.UsageRecordServiceImpl.getCalculationDTO(UsageRecordServiceImpl.java:58)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:343)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:751)
	at org.springframework.cache.interceptor.CacheInterceptor.lambda$invoke$0(CacheInterceptor.java:54)
	at org.springframework.cache.interceptor.CacheAspectSupport.invokeOperation(CacheAspectSupport.java:366)
	at org.springframework.cache.interceptor.CacheAspectSupport.execute(CacheAspectSupport.java:420)
	at org.springframework.cache.interceptor.CacheAspectSupport.execute(CacheAspectSupport.java:345)
	at org.springframework.cache.interceptor.CacheInterceptor.invoke(CacheInterceptor.java:64)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:751)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:703)
	at com.bgpay.bgai.service.impl.UsageRecordServiceImpl$$SpringCGLIB$$0.getCalculationDTO(<generated>)
	at com.bgpay.bgai.service.impl.BGAIServiceImpl.executeFirstStep(BGAIServiceImpl.java:46)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:343)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:751)
	at org.springframework.transaction.interceptor.TransactionInterceptor$1.proceedWithInvocation(TransactionInterceptor.java:123)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:391)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:751)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:703)
	at com.bgpay.bgai.service.impl.BGAIServiceImpl$$SpringCGLIB$$0.executeFirstStep(<generated>)
	at com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.lambda$sendBillingMessage$10(DeepSeekServiceImp.java:385)
	at reactor.core.publisher.MonoPeekTerminal$MonoTerminalPeekSubscriber.onComplete(MonoPeekTerminal.java:289)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onComplete(FluxOnAssembly.java:549)
	at reactor.core.publisher.SerializedSubscriber.onComplete(SerializedSubscriber.java:146)
	at reactor.core.publisher.FluxRetryWhen$RetryWhenMainSubscriber.onComplete(FluxRetryWhen.java:200)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onComplete(FluxOnAssembly.java:549)
	at reactor.core.publisher.MonoIgnoreElements$IgnoreElementsSubscriber.onComplete(MonoIgnoreElements.java:89)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onComplete(FluxOnAssembly.java:549)
	at reactor.core.publisher.MonoFlatMap$FlatMapMain.onNext(MonoFlatMap.java:159)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onNext(FluxOnAssembly.java:539)
	at reactor.core.publisher.FluxSubscribeOnCallable$CallableSubscribeOnSubscription.run(FluxSubscribeOnCallable.java:251)
	at reactor.core.scheduler.ImmediateScheduler.schedule(ImmediateScheduler.java:52)
	at reactor.core.publisher.MonoSubscribeOnCallable.subscribe(MonoSubscribeOnCallable.java:52)
	at reactor.core.publisher.InternalMonoOperator.subscribe(InternalMonoOperator.java:64)
	at reactor.core.publisher.FluxRetryWhen.subscribe(FluxRetryWhen.java:77)
	at reactor.core.publisher.MonoRetryWhen.subscribeOrReturn(MonoRetryWhen.java:46)
	at reactor.core.publisher.Mono.subscribe(Mono.java:4480)
	at reactor.core.publisher.Mono.subscribeWith(Mono.java:4561)
	at reactor.core.publisher.Mono.subscribe(Mono.java:4462)
	at reactor.core.publisher.Mono.subscribe(Mono.java:4398)
	at reactor.core.publisher.Mono.subscribe(Mono.java:4370)
	at com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.lambda$processRequestReactive$7(DeepSeekServiceImp.java:321)
	at reactor.core.publisher.MonoPeekTerminal$MonoTerminalPeekSubscriber.onNext(MonoPeekTerminal.java:171)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onNext(FluxOnAssembly.java:539)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onNext(FluxOnAssembly.java:539)
	at reactor.core.publisher.FluxOnErrorResume$ResumeSubscriber.onNext(FluxOnErrorResume.java:79)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onNext(FluxOnAssembly.java:539)
	at reactor.core.publisher.MonoFlatMap$FlatMapMain.secondComplete(MonoFlatMap.java:245)
	at reactor.core.publisher.MonoFlatMap$FlatMapInner.onNext(MonoFlatMap.java:305)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onNext(FluxOnAssembly.java:539)
	at reactor.core.publisher.FluxMap$MapSubscriber.onNext(FluxMap.java:122)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onNext(FluxOnAssembly.java:539)
	at reactor.core.publisher.MonoCallable$MonoCallableSubscription.request(MonoCallable.java:156)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.request(FluxOnAssembly.java:649)
	at reactor.core.publisher.FluxMap$MapSubscriber.request(FluxMap.java:164)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.request(FluxOnAssembly.java:649)
	at reactor.core.publisher.MonoFlatMap$FlatMapInner.onSubscribe(MonoFlatMap.java:291)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onSubscribe(FluxOnAssembly.java:633)
	at reactor.core.publisher.FluxMap$MapSubscriber.onSubscribe(FluxMap.java:92)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onSubscribe(FluxOnAssembly.java:633)
	at reactor.core.publisher.MonoCallable.subscribe(MonoCallable.java:48)
	at reactor.core.publisher.InternalMonoOperator.subscribe(InternalMonoOperator.java:64)
	at reactor.core.publisher.MonoFlatMap$FlatMapMain.onNext(MonoFlatMap.java:165)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onNext(FluxOnAssembly.java:539)
	at reactor.core.publisher.SerializedSubscriber.onNext(SerializedSubscriber.java:99)
	at reactor.core.publisher.FluxRetryWhen$RetryWhenMainSubscriber.onNext(FluxRetryWhen.java:174)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onNext(FluxOnAssembly.java:539)
	at reactor.core.publisher.SerializedSubscriber.onNext(SerializedSubscriber.java:99)
	at reactor.core.publisher.FluxTimeout$TimeoutMainSubscriber.onNext(FluxTimeout.java:180)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onNext(FluxOnAssembly.java:539)
	at reactor.core.publisher.MonoFlatMap$FlatMapMain.secondComplete(MonoFlatMap.java:245)
	at reactor.core.publisher.MonoFlatMap$FlatMapInner.onNext(MonoFlatMap.java:305)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onNext(FluxOnAssembly.java:539)
	at reactor.core.publisher.FluxOnErrorResume$ResumeSubscriber.onNext(FluxOnErrorResume.java:79)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onNext(FluxOnAssembly.java:539)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onNext(FluxOnAssembly.java:539)
	at reactor.core.publisher.FluxMapFuseable$MapFuseableSubscriber.onNext(FluxMapFuseable.java:129)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onNext(FluxOnAssembly.java:539)
	at reactor.core.publisher.FluxContextWrite$ContextWriteSubscriber.onNext(FluxContextWrite.java:107)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onNext(FluxOnAssembly.java:539)
	at reactor.core.publisher.FluxMapFuseable$MapFuseableConditionalSubscriber.onNext(FluxMapFuseable.java:299)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onNext(FluxOnAssembly.java:539)
	at reactor.core.publisher.FluxFilterFuseable$FilterFuseableConditionalSubscriber.onNext(FluxFilterFuseable.java:337)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onNext(FluxOnAssembly.java:539)
	at reactor.core.publisher.Operators$BaseFluxToMonoOperator.completePossiblyEmpty(Operators.java:2071)
	at reactor.core.publisher.MonoCollect$CollectSubscriber.onComplete(MonoCollect.java:145)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onComplete(FluxOnAssembly.java:549)
	at reactor.core.publisher.FluxMapFuseable$MapFuseableSubscriber.onComplete(FluxMapFuseable.java:152)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onComplete(FluxOnAssembly.java:549)
	at reactor.core.publisher.FluxPeekFuseable$PeekFuseableSubscriber.onComplete(FluxPeekFuseable.java:277)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onComplete(FluxOnAssembly.java:549)
	at reactor.core.publisher.FluxMap$MapSubscriber.onComplete(FluxMap.java:144)
	at reactor.netty.channel.FluxReceive.onInboundComplete(FluxReceive.java:413)
	at reactor.netty.channel.ChannelOperations.onInboundComplete(ChannelOperations.java:444)
	at reactor.netty.channel.ChannelOperations.terminate(ChannelOperations.java:498)
	at reactor.netty.http.client.HttpClientOperations.onInboundNext(HttpClientOperations.java:753)
	at reactor.netty.channel.ChannelOperationsHandler.channelRead(ChannelOperationsHandler.java:114)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:444)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)
	at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412)
	at io.netty.handler.codec.MessageToMessageDecoder.channelRead(MessageToMessageDecoder.java:103)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:444)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)
	at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412)
	at io.netty.channel.CombinedChannelDuplexHandler$DelegatingChannelHandlerContext.fireChannelRead(CombinedChannelDuplexHandler.java:436)
	at io.netty.handler.codec.ByteToMessageDecoder.fireChannelRead(ByteToMessageDecoder.java:346)
	at io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:318)
	at io.netty.channel.CombinedChannelDuplexHandler.channelRead(CombinedChannelDuplexHandler.java:251)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:442)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)
	at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412)
	at io.netty.handler.ssl.SslHandler.unwrap(SslHandler.java:1471)
	at io.netty.handler.ssl.SslHandler.decodeJdkCompatible(SslHandler.java:1334)
	at io.netty.handler.ssl.SslHandler.decode(SslHandler.java:1383)
	at io.netty.handler.codec.ByteToMessageDecoder.decodeRemovalReentryProtection(ByteToMessageDecoder.java:529)
	at io.netty.handler.codec.ByteToMessageDecoder.callDecode(ByteToMessageDecoder.java:468)
	at io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:290)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:444)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)
	at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412)
	at io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1410)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:440)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)
	at io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:919)
	at io.netty.channel.nio.AbstractNioByteChannel$NioByteUnsafe.read(AbstractNioByteChannel.java:166)
	at io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:788)
	at io.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:724)
	at io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:650)
	at io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:562)
	at io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:997)
	at io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.base/java.lang.Thread.run(Thread.java:1583)
Caused by: java.sql.SQLSyntaxErrorException: Unknown column 'message_id' in 'field list'
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:121)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:916)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:354)
	at com.alibaba.druid.pool.DruidPooledPreparedStatement.execute(DruidPooledPreparedStatement.java:497)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:58)
	at jdk.proxy3/jdk.proxy3.$Proxy162.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.query(PreparedStatementHandler.java:65)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.query(RoutingStatementHandler.java:80)
	at org.apache.ibatis.executor.SimpleExecutor.doQuery(SimpleExecutor.java:65)
	at org.apache.ibatis.executor.BaseExecutor.queryFromDatabase(BaseExecutor.java:336)
	at org.apache.ibatis.executor.BaseExecutor.query(BaseExecutor.java:158)
	at org.apache.ibatis.executor.CachingExecutor.query(CachingExecutor.java:110)
	at org.apache.ibatis.executor.CachingExecutor.query(CachingExecutor.java:90)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.selectList(DefaultSqlSession.java:154)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.selectList(DefaultSqlSession.java:147)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.selectList(DefaultSqlSession.java:142)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:425)
	... 158 common frames omitted
2025-05-25 02:25:47.446 [reactor-http-nio-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - Processed response for user 689258T, content length: 2797
2025-05-25 02:25:47.446 [reactor-http-nio-2] WARN  com.bgpay.bgai.controller.ReactiveChatController - ChatCompletionId inconsistency detected, using transaction coordinator ID
2025-05-25 02:25:47.760 [rpcDispatch_RMROLE_1_5_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:153776404394049572', branchId=153776404394049573, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false,"skipCheckLock":true}'}
2025-05-25 02:25:47.760 [rpcDispatch_RMROLE_1_5_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:153776404394049572 153776404394049573 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false,"skipCheckLock":true}
2025-05-25 02:25:47.760 [rpcDispatch_RMROLE_1_5_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-25 02:25:47.768 [rpcDispatch_RMROLE_1_6_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:153776404394049572', branchId=153776404394049574, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false,"skipCheckLock":true}'}
2025-05-25 02:25:47.768 [rpcDispatch_RMROLE_1_6_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:153776404394049572 153776404394049574 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false,"skipCheckLock":true}
2025-05-25 02:25:47.768 [rpcDispatch_RMROLE_1_6_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-25 02:25:47.777 [rpcDispatch_RMROLE_1_7_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:153776404394049572', branchId=153776404394049575, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false}'}
2025-05-25 02:25:47.777 [rpcDispatch_RMROLE_1_7_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:153776404394049572 153776404394049575 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false}
2025-05-25 02:25:47.777 [rpcDispatch_RMROLE_1_7_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-25 02:25:47.784 [rpcDispatch_RMROLE_1_8_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:153776404394049572', branchId=153776404394049576, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false}'}
2025-05-25 02:25:47.784 [rpcDispatch_RMROLE_1_8_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:153776404394049572 153776404394049576 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false}
2025-05-25 02:25:47.784 [rpcDispatch_RMROLE_1_8_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-25 02:26:23.382 [Thread-1] WARN  c.alibaba.nacos.common.http.HttpClientBeanHolder - [HttpClientBeanHolder] Start destroying common HttpClient
2025-05-25 02:26:23.382 [Thread-1] WARN  c.alibaba.nacos.common.http.HttpClientBeanHolder - [HttpClientBeanHolder] Destruction of the end
2025-05-25 02:26:23.383 [Thread-7] WARN  com.alibaba.nacos.common.notify.NotifyCenter - [NotifyCenter] Start destroying Publisher
2025-05-25 02:26:23.383 [Thread-7] WARN  com.alibaba.nacos.common.notify.NotifyCenter - [NotifyCenter] Destruction of the end
2025-05-25 02:26:23.400 [SpringContextShutdownHook] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - De-registering from Nacos Server now...
2025-05-25 02:26:23.400 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - [DEREGISTER-SERVICE] d750d92e-152f-4055-a641-3bc9dda85a29 deregistering service bgtech-ai with instance: Instance{instanceId='null', ip='192.168.86.8', port=8080, weight=1.0, healthy=true, enabled=true, ephemeral=true, clusterName='DEFAULT', serviceName='null', metadata={}}
2025-05-25 02:26:23.411 [SpringContextShutdownHook] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - De-registration finished.
2025-05-25 02:26:23.413 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.cache.ServiceInfoHolder do shutdown begin
2025-05-25 02:26:23.413 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.backups.FailoverReactor do shutdown begin
2025-05-25 02:26:23.413 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.backups.FailoverReactor do shutdown stop
2025-05-25 02:26:23.413 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.cache.ServiceInfoHolder do shutdown stop
2025-05-25 02:26:23.413 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.NamingClientProxyDelegate do shutdown begin
2025-05-25 02:26:23.413 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServiceInfoUpdateService do shutdown begin
2025-05-25 02:26:23.413 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServiceInfoUpdateService do shutdown stop
2025-05-25 02:26:23.413 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServerListManager do shutdown begin
2025-05-25 02:26:23.413 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Start destroying NacosRestTemplate
2025-05-25 02:26:23.413 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Destruction of the end
2025-05-25 02:26:23.413 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServerListManager do shutdown stop
2025-05-25 02:26:23.413 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.http.NamingHttpClientProxy do shutdown begin
2025-05-25 02:26:23.413 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Start destroying NacosRestTemplate
2025-05-25 02:26:23.413 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Destruction of the end
2025-05-25 02:26:23.413 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.http.NamingHttpClientProxy do shutdown stop
2025-05-25 02:26:23.413 [SpringContextShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Shutdown rpc client, set status to shutdown
2025-05-25 02:26:23.414 [SpringContextShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Shutdown client event executor java.util.concurrent.ScheduledThreadPoolExecutor@2ba859bf[Running, pool size = 2, active threads = 2, queued tasks = 0, completed tasks = 0]
2025-05-25 02:26:23.414 [SpringContextShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Close current connection 1748111059438_139.227.195.192_49607
2025-05-25 02:26:23.416 [nacos-grpc-client-executor-8.133.246.113-46] WARN  c.a.nacos.common.remote.client.grpc.GrpcClient - [1748111059438_139.227.195.192_49607]Ignore error event,isRunning:false,isAbandon=false
2025-05-25 02:26:23.418 [SpringContextShutdownHook] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - Shutdown grpc executor java.util.concurrent.ThreadPoolExecutor@206185b3[Running, pool size = 6, active threads = 0, queued tasks = 0, completed tasks = 47]
2025-05-25 02:26:23.418 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - Shutdown grpc redo service executor java.util.concurrent.ScheduledThreadPoolExecutor@2417f69f[Running, pool size = 1, active threads = 0, queued tasks = 1, completed tasks = 41]
2025-05-25 02:26:23.418 [SpringContextShutdownHook] INFO  c.a.n.client.auth.ram.identify.CredentialWatcher - [null] CredentialWatcher is stopped
2025-05-25 02:26:23.418 [SpringContextShutdownHook] INFO  c.a.n.client.auth.ram.identify.CredentialService - [null] CredentialService is freed
2025-05-25 02:26:23.418 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.NamingClientProxyDelegate do shutdown stop
2025-05-25 02:26:23.425 [SpringContextShutdownHook] DEBUG com.bgpay.bgai.config.AsyncConfig$1 - Shutting down ExecutorService 'blockingExecutor'
2025-05-25 02:26:24.304 [com.alibaba.nacos.client.Worker] INFO  c.a.n.client.auth.ram.identify.CredentialWatcher - null No credential found
2025-05-25 02:26:25.504 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:9876] result: true
2025-05-25 02:26:25.504 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:10911] result: true
2025-05-25 02:26:25.519 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:10911] result: true
2025-05-25 02:26:25.519 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:9876] result: true
2025-05-25 02:26:25.632 [SpringContextShutdownHook] INFO  o.s.orm.jpa.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-05-25 02:26:25.633 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-2} closing ...
2025-05-25 02:26:25.638 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-2} closed
2025-05-25 02:26:25.638 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} closing ...
2025-05-25 02:26:25.638 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} closed
2025-05-25 02:26:25.639 [NettyClientSelector_TMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - channel inactive: [id: 0x4816a927, L:/192.168.86.8:58831 ! R:/8.133.246.113:8091]
2025-05-25 02:26:25.639 [NettyClientSelector_TMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - return to pool, rm channel:[id: 0x4816a927, L:/192.168.86.8:58831 ! R:/8.133.246.113:8091]
2025-05-25 02:26:25.639 [NettyClientSelector_TMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - channel valid false,channel:[id: 0x4816a927, L:/192.168.86.8:58831 ! R:/8.133.246.113:8091]
2025-05-25 02:26:25.639 [NettyClientSelector_TMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - will destroy channel:[id: 0x4816a927, L:/192.168.86.8:58831 ! R:/8.133.246.113:8091]
2025-05-25 02:26:25.639 [NettyClientSelector_TMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0x4816a927, L:/192.168.86.8:58831 ! R:/8.133.246.113:8091]) will closed
2025-05-25 02:26:25.639 [NettyClientSelector_TMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0x4816a927, L:/192.168.86.8:58831 ! R:/8.133.246.113:8091]) will closed
2025-05-25 02:26:25.640 [NettyClientSelector_RMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - channel inactive: [id: 0x766319a1, L:/192.168.86.8:58834 ! R:/8.133.246.113:8091]
2025-05-25 02:26:25.640 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - return to pool, rm channel:[id: 0x766319a1, L:/192.168.86.8:58834 ! R:/8.133.246.113:8091]
2025-05-25 02:26:25.640 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - channel valid false,channel:[id: 0x766319a1, L:/192.168.86.8:58834 ! R:/8.133.246.113:8091]
2025-05-25 02:26:25.640 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - will destroy channel:[id: 0x766319a1, L:/192.168.86.8:58834 ! R:/8.133.246.113:8091]
2025-05-25 02:26:25.640 [NettyClientSelector_RMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0x766319a1, L:/192.168.86.8:58834 ! R:/8.133.246.113:8091]) will closed
2025-05-25 02:26:25.640 [NettyClientSelector_RMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0x766319a1, L:/192.168.86.8:58834 ! R:/8.133.246.113:8091]) will closed
2025-05-25 02:27:11.766 [main] WARN  com.alibaba.nacos.client.logging.NacosLogging - Load Logback Configuration of Nacos fail, message: Could not initialize Logback Nacos logging from classpath:nacos-logback.xml
2025-05-25 02:27:11.767 [main] INFO  com.bgpay.bgai.BgaiApplication - The following 1 profile is active: "dev"
2025-05-25 02:27:13.153 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-05-25 02:27:13.154 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-05-25 02:27:13.178 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 17 ms. Found 0 JPA repository interfaces.
2025-05-25 02:27:13.189 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-05-25 02:27:13.191 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-05-25 02:27:13.203 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 4 ms. Found 0 Redis repository interfaces.
2025-05-25 02:27:13.857 [main] INFO  io.seata.config.ConfigurationFactory - load Configuration from :Spring Configuration
2025-05-25 02:27:13.866 [main] INFO  io.seata.config.ConfigurationFactory - load Configuration from :Spring Configuration
2025-05-25 02:27:13.872 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Initializing Global Transaction Clients ... 
2025-05-25 02:27:13.981 [main] INFO  io.seata.core.rpc.netty.NettyClientBootstrap - NettyClientBootstrap has started
2025-05-25 02:27:13.982 [main] INFO  io.seata.discovery.registry.RegistryFactory - use registry center type: file
2025-05-25 02:27:13.994 [main] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - will connect to 8.133.246.113:8091
2025-05-25 02:27:13.998 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - NettyPool create channel to transactionRole:TMROLE,address:8.133.246.113:8091,msg:< RegisterTMRequest{version='1.7.0', applicationId='bgtech-ai', transactionServiceGroup='bgai-tx-group', extraData='ak=null
digest=bgai-tx-group,192.168.86.8,1748111233997
timestamp=1748111233997
authVersion=V4
vgroup=bgai-tx-group
ip=192.168.86.8
'} >
2025-05-25 02:27:14.176 [main] INFO  io.seata.core.rpc.netty.TmNettyRemotingClient - register TM success. client version:1.7.0, server version:1.8.1-SNAPSHOT,channel:[id: 0xd0c48d1f, L:/192.168.86.8:57547 - R:/8.133.246.113:8091]
2025-05-25 02:27:14.182 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - register success, cost 74 ms, version:1.8.1-SNAPSHOT,role:TMROLE,channel:[id: 0xd0c48d1f, L:/192.168.86.8:57547 - R:/8.133.246.113:8091]
2025-05-25 02:27:14.183 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Transaction Manager Client is initialized. applicationId[bgtech-ai] txServiceGroup[bgai-tx-group]
2025-05-25 02:27:14.194 [main] INFO  io.seata.rm.datasource.AsyncWorker - Async Commit Buffer Limit: 10000
2025-05-25 02:27:14.195 [main] INFO  io.seata.rm.datasource.xa.ResourceManagerXA - ResourceManagerXA init ...
2025-05-25 02:27:14.201 [main] INFO  io.seata.core.rpc.netty.NettyClientBootstrap - NettyClientBootstrap has started
2025-05-25 02:27:14.201 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Resource Manager is initialized. applicationId[bgtech-ai] txServiceGroup[bgai-tx-group]
2025-05-25 02:27:14.201 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Global Transaction Clients are initialized. 
2025-05-25 02:27:15.288 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat initialized with port(s): 8080 (http)
2025-05-25 02:27:15.298 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - The ["http-nio-8080"] connector has been configured to support HTTP upgrade to [h2c]
2025-05-25 02:27:15.299 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - Initializing ProtocolHandler ["http-nio-8080"]
2025-05-25 02:27:15.301 [main] INFO  org.apache.catalina.core.StandardService - Starting service [Tomcat]
2025-05-25 02:27:15.301 [main] INFO  org.apache.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.15]
2025-05-25 02:27:15.798 [main] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} inited
2025-05-25 02:27:16.037 [main] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - will connect to 8.133.246.113:8091
2025-05-25 02:27:16.037 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - RM will register :jdbc:mysql://8.133.246.113:3306/deepseek
2025-05-25 02:27:16.037 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - NettyPool create channel to transactionRole:RMROLE,address:8.133.246.113:8091,msg:< RegisterRMRequest{resourceIds='jdbc:mysql://8.133.246.113:3306/deepseek', version='1.7.0', applicationId='bgtech-ai', transactionServiceGroup='bgai-tx-group', extraData='null'} >
2025-05-25 02:27:16.059 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - register RM success. client version:1.7.0, server version:1.8.1-SNAPSHOT,channel:[id: 0xf2713c25, L:/192.168.86.8:57549 - R:/8.133.246.113:8091]
2025-05-25 02:27:16.059 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - register success, cost 11 ms, version:1.8.1-SNAPSHOT,role:RMROLE,channel:[id: 0xf2713c25, L:/192.168.86.8:57549 - R:/8.133.246.113:8091]
2025-05-25 02:27:16.062 [main] INFO  i.s.s.a.datasource.SeataAutoDataSourceProxyCreator - Auto proxy data source 'masterDataSource' by 'AT' mode.
2025-05-25 02:27:16.125 [main] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-2} inited
2025-05-25 02:27:16.212 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - will register resourceId:jdbc:mysql://8.133.246.113:3306/deepseek
2025-05-25 02:27:16.213 [main] INFO  i.s.s.a.datasource.SeataAutoDataSourceProxyCreator - Auto proxy data source 'slaveDataSource' by 'AT' mode.
2025-05-25 02:27:16.221 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.rm.AbstractRMHandler - the rm client received response msg [RegisterRMResponse{version='1.8.1-SNAPSHOT', extraData='null', identified=true, resultCode=null, msg='null'}] from tc server.
2025-05-25 02:27:16.233 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - will register resourceId:jdbc:mysql://8.133.246.113:3306/deepseek
2025-05-25 02:27:16.233 [main] INFO  i.s.s.a.datasource.SeataAutoDataSourceProxyCreator - Auto proxy data source 'dynamicDataSource' by 'AT' mode.
2025-05-25 02:27:16.246 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.rm.AbstractRMHandler - the rm client received response msg [RegisterRMResponse{version='1.8.1-SNAPSHOT', extraData='null', identified=true, resultCode=null, msg='null'}] from tc server.
2025-05-25 02:27:16.340 [main] INFO  org.hibernate.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-05-25 02:27:16.388 [main] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.1.7.Final
2025-05-25 02:27:16.695 [main] INFO  SQL dialect - HHH000400: Using dialect: org.hibernate.dialect.MySQL8Dialect
2025-05-25 02:27:16.697 [main] WARN  org.hibernate.orm.deprecation - HHH90000026: MySQL8Dialect has been deprecated; use org.hibernate.dialect.MySQLDialect instead
2025-05-25 02:27:16.994 [main] INFO  o.h.e.t.jta.platform.internal.JtaPlatformInitiator - HHH000490: Using JtaPlatform implementation: [org.hibernate.engine.transaction.jta.platform.internal.NoJtaPlatform]
2025-05-25 02:27:17.005 [main] INFO  o.s.orm.jpa.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-05-25 02:27:17.464 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-25 02:27:17.483 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-25 02:27:17.509 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-25 02:27:17.511 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-25 02:27:17.511 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-25 02:27:17.521 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-25 02:27:18.124 [main] INFO  com.bgpay.bgai.service.impl.UserServiceImpl - 初始化SSO配置: clientId=bgai-client-id, redirectUri=http://localhost:8080/api/auth/callback
2025-05-25 02:27:18.250 [main] INFO  com.bgpay.bgai.controller.AuthController - 初始化认证控制器: clientId=bgai-client-id, redirectUri=http://localhost:8080/api/auth/callback
2025-05-25 02:27:18.858 [main] INFO  o.a.r.s.autoconfigure.RocketMQAutoConfiguration - a producer (billing-producer-group) init on namesrv 8.133.246.113:9876
2025-05-25 02:27:19.479 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Bean [com.bgpay.bgai.service.deepseek.DeepSeekServiceImp$$SpringCGLIB$$0] with name [deepSeekServiceImp] would use interceptor [io.seata.spring.annotation.GlobalTransactionalInterceptor]
2025-05-25 02:27:19.765 [main] WARN  i.s.s.b.a.provider.SpringBootConfigurationProvider - The get method not found for the field 'SeataProperties#accesskey'.
2025-05-25 02:27:19.766 [main] WARN  i.s.s.b.a.provider.SpringBootConfigurationProvider - The get method not found for the field 'SeataProperties#secretkey'.
2025-05-25 02:27:19.785 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 加载到1个Saga状态机定义文件
2025-05-25 02:27:19.944 [main] INFO  com.bgpay.bgai.saga.CustomSagaJsonParser - 开始解析状态机定义: bgai-saga-transaction
2025-05-25 02:27:19.944 [main] INFO  com.bgpay.bgai.saga.CustomSagaJsonParser - 状态机定义解析成功: bgai-saga-transaction
2025-05-25 02:27:19.944 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 成功加载状态机定义: /E:/project/bgai/target/classes/statelang/bgai-saga-transaction.json
2025-05-25 02:27:20.437 [main] INFO  org.redisson.Version - Redisson 3.24.3
2025-05-25 02:27:20.587 [redisson-netty-4-6] INFO  o.r.connection.pool.MasterPubSubConnectionPool - 1 connections initialized for 8.133.246.113/8.133.246.113:6379
2025-05-25 02:27:20.910 [redisson-netty-4-19] INFO  org.redisson.connection.pool.MasterConnectionPool - 24 connections initialized for 8.133.246.113/8.133.246.113:6379
2025-05-25 02:27:21.072 [main] INFO  com.bgpay.bgai.service.mq.MQConsumerService - MQ consumer startup successful [group=billing-consumer-group, topic=BILLING_TOPIC, tag=USER_BILLING]
2025-05-25 02:27:21.225 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Bean [com.bgpay.bgai.service.mq.BillingTransactionListenerImpl$$SpringCGLIB$$0] with name [billingTransactionListenerImpl] would use interceptor [io.seata.spring.annotation.GlobalTransactionalInterceptor]
2025-05-25 02:27:21.356 [main] DEBUG com.bgpay.bgai.config.AsyncConfig$1 - Initializing ExecutorService 'blockingExecutor'
2025-05-25 02:27:21.381 [main] INFO  c.b.bgai.config.NacosConfig$NacosWarningHandler - Nacos警告处理器已启用，将忽略配置中心连接警告
2025-05-25 02:27:22.550 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [After]
2025-05-25 02:27:22.551 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Before]
2025-05-25 02:27:22.551 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Between]
2025-05-25 02:27:22.551 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Cookie]
2025-05-25 02:27:22.551 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Header]
2025-05-25 02:27:22.551 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Host]
2025-05-25 02:27:22.551 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Method]
2025-05-25 02:27:22.551 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Path]
2025-05-25 02:27:22.551 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Query]
2025-05-25 02:27:22.551 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [ReadBody]
2025-05-25 02:27:22.551 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [RemoteAddr]
2025-05-25 02:27:22.551 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [XForwardedRemoteAddr]
2025-05-25 02:27:22.551 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Weight]
2025-05-25 02:27:22.551 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [CloudFoundryRouteService]
2025-05-25 02:27:23.992 [main] INFO  o.s.b.actuate.endpoint.web.EndpointLinksResolver - Exposing 3 endpoint(s) beneath base path '/actuator'
2025-05-25 02:27:25.604 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - Starting ProtocolHandler ["http-nio-8080"]
2025-05-25 02:27:25.618 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat started on port(s): 8080 (http) with context path ''
2025-05-25 02:27:25.627 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from ans.namespace attribute : null
2025-05-25 02:27:25.628 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from ALIBABA_ALIWARE_NAMESPACE attribute :null
2025-05-25 02:27:25.628 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from namespace attribute :null
2025-05-25 02:27:25.636 [main] INFO  c.a.n.p.auth.spi.client.ClientAuthPluginManager - [ClientAuthPluginManager] Load ClientAuthService com.alibaba.nacos.client.auth.impl.NacosClientAuthServiceImpl success.
2025-05-25 02:27:25.636 [main] INFO  c.a.n.p.auth.spi.client.ClientAuthPluginManager - [ClientAuthPluginManager] Load ClientAuthService com.alibaba.nacos.client.auth.ram.RamClientAuthServiceImpl success.
2025-05-25 02:27:25.640 [main] INFO  com.alibaba.nacos.common.remote.client - [RpcClientFactory] create a new rpc client of 448873e7-a6c9-4d85-99f0-3a2387ddb2ed
2025-05-25 02:27:25.642 [main] INFO  com.alibaba.nacos.common.remote.client - [448873e7-a6c9-4d85-99f0-3a2387ddb2ed] RpcClient init, ServerListFactory = com.alibaba.nacos.client.naming.core.ServerListManager
2025-05-25 02:27:25.642 [main] INFO  com.alibaba.nacos.common.remote.client - [448873e7-a6c9-4d85-99f0-3a2387ddb2ed] Registry connection listener to current client:com.alibaba.nacos.client.naming.remote.gprc.redo.NamingGrpcRedoService
2025-05-25 02:27:25.643 [main] INFO  com.alibaba.nacos.common.remote.client - [448873e7-a6c9-4d85-99f0-3a2387ddb2ed] Register server push request handler:com.alibaba.nacos.client.naming.remote.gprc.NamingPushRequestHandler
2025-05-25 02:27:25.643 [main] INFO  com.alibaba.nacos.common.remote.client - [448873e7-a6c9-4d85-99f0-3a2387ddb2ed] Try to connect to server on start up, server: {serverIp = '8.133.246.113', server main port = 8848}
2025-05-25 02:27:25.643 [main] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - grpc client connection server:8.133.246.113 ip,serverPort:9848,grpcTslConfig:{"sslProvider":"OPENSSL","enableTls":false,"mutualAuthEnable":false,"trustAll":false}
2025-05-25 02:27:25.770 [main] INFO  com.alibaba.nacos.common.remote.client - [448873e7-a6c9-4d85-99f0-3a2387ddb2ed] Success to connect to server [8.133.246.113:8848] on start up, connectionId = 1748111245682_139.227.195.192_50149
2025-05-25 02:27:25.770 [main] INFO  com.alibaba.nacos.common.remote.client - [448873e7-a6c9-4d85-99f0-3a2387ddb2ed] Register server push request handler:com.alibaba.nacos.common.remote.client.RpcClient$ConnectResetRequestHandler
2025-05-25 02:27:25.770 [main] INFO  com.alibaba.nacos.common.remote.client - [448873e7-a6c9-4d85-99f0-3a2387ddb2ed] Register server push request handler:com.alibaba.nacos.common.remote.client.RpcClient$$Lambda/0x000001889356c120
2025-05-25 02:27:25.770 [com.alibaba.nacos.client.remote.worker] INFO  com.alibaba.nacos.common.remote.client - [448873e7-a6c9-4d85-99f0-3a2387ddb2ed] Notify connected event to listeners.
2025-05-25 02:27:25.770 [com.alibaba.nacos.client.remote.worker] INFO  com.alibaba.nacos.client.naming - Grpc connection connect
2025-05-25 02:27:25.771 [main] INFO  com.alibaba.nacos.client.naming - [REGISTER-SERVICE] d750d92e-152f-4055-a641-3bc9dda85a29 registering service bgtech-ai with instance Instance{instanceId='null', ip='192.168.86.8', port=8080, weight=1.0, healthy=true, enabled=true, ephemeral=true, clusterName='DEFAULT', serviceName='null', metadata={IPv6=[2408:820c:7528:d042:c185:8edc:f30d:3d91], preserved.register.source=SPRING_CLOUD}}
2025-05-25 02:27:25.881 [main] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - nacos registry, DEFAULT_GROUP bgtech-ai 192.168.86.8:8080 register finished
2025-05-25 02:27:25.931 [main] INFO  com.bgpay.bgai.config.NacosConfig - 应用启动完成，当前环境: dev
2025-05-25 02:27:25.932 [main] INFO  com.bgpay.bgai.config.NacosConfig - Nacos配置中心: 8.133.246.113:8848, 命名空间: d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-25 02:27:25.932 [main] INFO  com.bgpay.bgai.config.NacosConfig - 注意: 如果看到Nacos配置加载警告，但应用正常启动，说明应用正在使用本地配置文件
2025-05-25 02:27:25.933 [main] INFO  com.bgpay.bgai.BgaiApplication - Started BgaiApplication in 16.27 seconds (process running for 17.793)
2025-05-25 02:27:25.936 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-25 02:27:25.936 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-25 02:27:25.945 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-25 02:27:25.945 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-25 02:27:25.945 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-25 02:27:25.954 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-25 02:27:25.954 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-25 02:27:25.954 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-25 02:27:25.960 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-25 02:27:25.961 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-25 02:27:25.961 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-25 02:27:25.967 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-25 02:27:25.967 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - ==================== Saga状态机加载报告 ====================
2025-05-25 02:27:25.967 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - Saga状态机配置加载状态: 成功
2025-05-25 02:27:25.967 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 已加载的状态机定义文件数量: 1
2025-05-25 02:27:25.967 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 已加载的状态机定义文件:
2025-05-25 02:27:25.968 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig -  - /E:/project/bgai/target/classes/statelang/bgai-saga-transaction.json
2025-05-25 02:27:25.968 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - Saga解析器状态: CUSTOM_FASTJSON2
2025-05-25 02:27:25.968 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 状态机解析结果: 成功 1 个, 失败 0 个
2025-05-25 02:27:25.968 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - =============================================================
2025-05-25 02:27:25.971 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - nacos.cache.data.init.snapshot = true 
2025-05-25 02:27:25.972 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] common-dev.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-25 02:27:25.980 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=common-dev.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-25 02:27:25.980 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=common-dev.yaml, group=DEFAULT_GROUP
2025-05-25 02:27:25.981 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-25 02:27:25.981 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-25 02:27:25.981 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai.yaml, group=DEFAULT_GROUP
2025-05-25 02:27:25.983 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai-dev.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-25 02:27:25.983 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai-dev.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-25 02:27:25.983 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai-dev.yaml, group=DEFAULT_GROUP
2025-05-25 02:27:25.983 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-25 02:27:25.983 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai, group=DEFAULT_GROUP, cnt=1
2025-05-25 02:27:25.983 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai, group=DEFAULT_GROUP
2025-05-25 02:27:33.447 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - 接收到请求: /api/chatGatWay-internal, 文件=新文件 17.txt, 问题参数=null, 模型参数=null
2025-05-25 02:27:33.449 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - 请求Content-Type: multipart/form-data;boundary=--------------------------405981306986242709084461
2025-05-25 02:27:33.450 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - 收集到的完整参数: question="null", apiUrl="null", modelName="null", multiTurn=false
2025-05-25 02:27:33.452 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - Processing request for user ID: 689258T
2025-05-25 02:27:33.452 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - Processing file with circuit breaker: fileName=新文件 17.txt, question=
2025-05-25 02:27:33.454 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.config.ReactiveFileProcessor - Processing file: 新文件 17.txt, content-type: text/plain
2025-05-25 02:27:33.464 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - PARAM TRACE [689258T]: 尝试查找匹配配置 - 参数: apiUrl=null, modelName=null
2025-05-25 02:27:33.475 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 查询配置 - userId=689258T
2025-05-25 02:27:33.476 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 排序方式 - 按ID降序
2025-05-25 02:27:33.476 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 限制结果数 - LIMIT 1
2025-05-25 02:27:33.564 [http-nio-8080-exec-2] DEBUG com.bgpay.bgai.mapper.ApiConfigMapper.selectList - ==>  Preparing: SELECT id,api_url,api_key,model_name,user_id FROM api_config WHERE (user_id = ?) ORDER BY id DESC LIMIT 1
2025-05-25 02:27:33.565 [http-nio-8080-exec-2] DEBUG com.bgpay.bgai.mapper.ApiConfigMapper.selectList - ==> Parameters: 689258T(String)
2025-05-25 02:27:33.574 [http-nio-8080-exec-2] DEBUG com.bgpay.bgai.mapper.ApiConfigMapper.selectList - <==      Total: 1
2025-05-25 02:27:33.575 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 查询结果 - 找到配置: id=2, modelName=deepseek-chat
2025-05-25 02:27:33.575 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - PARAM TRACE [689258T]: 找到匹配配置 - apiUrl=https://api.deepseek.com/chat/completions, modelName=deepseek-chat (原始请求: null)
2025-05-25 02:27:33.575 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - API config resolved: url=https://api.deepseek.com/chat/completions, model=deepseek-chat
2025-05-25 02:27:33.594 [Thread-49] INFO  com.bgpay.bgai.config.ReactiveFileProcessor - File processed successfully: size=37 bytes
2025-05-25 02:27:33.600 [Thread-49] INFO  com.bgpay.bgai.controller.ReactiveChatController - Content processed, length: 54
2025-05-25 02:27:33.607 [Thread-49] INFO  io.seata.tm.TransactionManagerHolder - TransactionManager Singleton io.seata.tm.DefaultTransactionManager@151e9d5b
2025-05-25 02:27:33.619 [Thread-49] INFO  io.seata.tm.api.DefaultGlobalTransaction - Begin new global transaction [seata-server:8091:153776404394049577]
2025-05-25 02:27:33.621 [Thread-49] INFO  c.b.bgai.interceptor.SeataTransactionInterceptor - 准备记录分布式事务开始: XID=seata-server:8091:153776404394049577, 业务=com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive, 路径=, IP=, 用户=system
2025-05-25 02:27:33.646 [Thread-49] INFO  c.b.bgai.service.impl.TransactionLogServiceImpl - 记录分布式事务开始: XID=seata-server:8091:153776404394049577, 业务=com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive
2025-05-25 02:27:33.652 [Thread-49] DEBUG com.bgpay.bgai.mapper.TransactionLogMapper.insert - ==>  Preparing: INSERT INTO transaction_log ( xid, transaction_name, transaction_mode, status, request_path, source_ip, start_time, user_id, create_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-05-25 02:27:33.656 [Thread-49] DEBUG com.bgpay.bgai.mapper.TransactionLogMapper.insert - ==> Parameters: seata-server:8091:153776404394049577(String), com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive(String), AT(String), ACTIVE(String), (String), (String), 2025-05-25T02:27:33.646412600(LocalDateTime), system(String), 2025-05-25T02:27:33.646412600(LocalDateTime)
2025-05-25 02:27:34.091 [Thread-49] DEBUG com.bgpay.bgai.mapper.TransactionLogMapper.insert - <==    Updates: 1
2025-05-25 02:27:34.109 [Thread-49] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:153776404394049577, branchId:153776404394049578, lockKeys:transaction_log:39
2025-05-25 02:27:34.120 [Thread-49] WARN  i.s.c.l.EnhancedServiceLoader$InnerEnhancedServiceLoader - Load [io.seata.rm.datasource.undo.parser.ProtostuffUndoLogParser] class fail: io/protostuff/runtime/IdStrategy
2025-05-25 02:27:34.186 [Thread-49] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:153776404394049577, branchId:153776404394049579, lockKeys:transaction_log:39;undo_log:153
2025-05-25 02:27:34.215 [Thread-49] INFO  c.b.bgai.interceptor.SeataTransactionInterceptor - 开始分布式事务: XID=seata-server:8091:153776404394049577, 方法=com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive
2025-05-25 02:27:34.227 [Thread-49] INFO  org.reflections.Reflections - Processing reactive request: content length=54, apiUrl=https://api.deepseek.com/chat/completions, modelName=deepseek-chat, userId=689258T, multiTurn=false
2025-05-25 02:27:34.236 [Thread-49] INFO  c.b.bgai.service.impl.TransactionLogServiceImpl - 记录分布式事务结束: XID=seata-server:8091:153776404394049577, 状态=COMMITTED
2025-05-25 02:27:34.237 [Thread-49] DEBUG c.b.bgai.mapper.TransactionLogMapper.selectList - ==>  Preparing: SELECT id,xid,branch_id,transaction_name,transaction_mode,status,request_path,source_ip,start_time,end_time,user_id,extra_data,create_time,update_time FROM transaction_log WHERE (xid = ?) LIMIT 1
2025-05-25 02:27:34.239 [Thread-49] DEBUG c.b.bgai.mapper.TransactionLogMapper.selectList - ==> Parameters: seata-server:8091:153776404394049577(String)
2025-05-25 02:27:34.247 [Thread-49] DEBUG c.b.bgai.mapper.TransactionLogMapper.selectList - <==      Total: 1
2025-05-25 02:27:34.251 [Thread-49] DEBUG c.b.bgai.mapper.TransactionLogMapper.updateById - ==>  Preparing: UPDATE transaction_log SET xid=?, transaction_name=?, transaction_mode=?, status=?, request_path=?, source_ip=?, start_time=?, end_time=?, user_id=?, extra_data=?, create_time=?, update_time=? WHERE id=?
2025-05-25 02:27:34.258 [Thread-49] DEBUG c.b.bgai.mapper.TransactionLogMapper.updateById - ==> Parameters: seata-server:8091:153776404394049577(String), com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive(String), AT(String), COMMITTED(String), (String), (String), 2025-05-25T02:27:34(LocalDateTime), 2025-05-25T02:27:34.248576700(LocalDateTime), system(String), {"duration":13,"result":"success"}(String), 2025-05-25T02:27:34(LocalDateTime), 2025-05-25T02:27:34.248576700(LocalDateTime), 39(Long)
2025-05-25 02:27:34.307 [Thread-49] DEBUG c.b.bgai.mapper.TransactionLogMapper.updateById - <==    Updates: 1
2025-05-25 02:27:34.320 [Thread-49] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:153776404394049577, branchId:153776404394049580, lockKeys:transaction_log:39
2025-05-25 02:27:34.352 [Thread-49] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:153776404394049577, branchId:153776404394049581, lockKeys:undo_log:155;transaction_log:39
2025-05-25 02:27:34.400 [Thread-49] INFO  c.b.bgai.interceptor.SeataTransactionInterceptor - 分布式事务成功完成: XID=seata-server:8091:153776404394049577, 耗时=13ms
2025-05-25 02:27:34.400 [Thread-49] INFO  io.seata.tm.api.DefaultGlobalTransaction - transaction seata-server:8091:153776404394049577 will be commit
2025-05-25 02:27:34.410 [Thread-49] INFO  io.seata.tm.api.DefaultGlobalTransaction - transaction end, xid = seata-server:8091:153776404394049577
2025-05-25 02:27:34.410 [Thread-49] INFO  io.seata.tm.api.DefaultGlobalTransaction - [seata-server:8091:153776404394049577] commit status: Committed
2025-05-25 02:27:34.447 [boundedElastic-1] INFO  com.bgpay.bgai.transaction.TransactionCoordinator - Transaction prepared for user 689258T: chatCompletionId=chat-a098c829-2fce-4a07-850c-5705e116f4b4
2025-05-25 02:27:34.447 [boundedElastic-1] INFO  org.reflections.Reflections - Transaction prepared with chatCompletionId: chat-a098c829-2fce-4a07-850c-5705e116f4b4
2025-05-25 02:27:34.767 [rpcDispatch_RMROLE_1_1_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:153776404394049577', branchId=153776404394049578, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false,"skipCheckLock":true}'}
2025-05-25 02:27:34.768 [rpcDispatch_RMROLE_1_1_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:153776404394049577 153776404394049578 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false,"skipCheckLock":true}
2025-05-25 02:27:34.769 [rpcDispatch_RMROLE_1_1_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-25 02:27:34.778 [rpcDispatch_RMROLE_1_2_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:153776404394049577', branchId=153776404394049579, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false,"skipCheckLock":true}'}
2025-05-25 02:27:34.778 [rpcDispatch_RMROLE_1_2_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:153776404394049577 153776404394049579 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false,"skipCheckLock":true}
2025-05-25 02:27:34.778 [rpcDispatch_RMROLE_1_2_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-25 02:27:34.785 [rpcDispatch_RMROLE_1_3_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:153776404394049577', branchId=153776404394049580, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false}'}
2025-05-25 02:27:34.785 [rpcDispatch_RMROLE_1_3_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:153776404394049577 153776404394049580 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false}
2025-05-25 02:27:34.785 [rpcDispatch_RMROLE_1_3_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-25 02:27:34.793 [rpcDispatch_RMROLE_1_4_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:153776404394049577', branchId=153776404394049581, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false}'}
2025-05-25 02:27:34.794 [rpcDispatch_RMROLE_1_4_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:153776404394049577 153776404394049581 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false}
2025-05-25 02:27:34.794 [rpcDispatch_RMROLE_1_4_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-25 02:28:11.581 [FileWrite-1] INFO  com.bgpay.bgai.service.deepseek.FileWriterService - Successfully wrote content to: \var\data\ai_responses\48320ae1-9f79-4b3a-af85-6c605ae03096.txt
2025-05-25 02:28:11.596 [reactor-http-nio-2] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - ==>  Preparing: INSERT INTO chat_completions ( object, created, model, system_fingerprint, api_key ) VALUES ( ?, ?, ?, ?, ? )
2025-05-25 02:28:11.596 [reactor-http-nio-2] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - ==> Parameters: chat.completion(String), 1748111291594(Long), deepseek-chat(String), 689258T(String), chat-a098c829-2fce-4a07-850c-5705e116f4b4(String)
2025-05-25 02:28:11.619 [reactor-http-nio-2] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - <==    Updates: 1
2025-05-25 02:28:11.620 [reactor-http-nio-2] INFO  com.bgpay.bgai.transaction.TransactionCoordinator - Transaction committed for user 689258T: chatCompletionId=chat-a098c829-2fce-4a07-850c-5705e116f4b4
2025-05-25 02:28:11.651 [reactor-http-nio-2] INFO  org.reflections.Reflections - 开始发送账单消息，chatCompletionId: chat-a098c829-2fce-4a07-850c-5705e116f4b4, userId: 689258T
2025-05-25 02:28:11.711 [reactor-http-nio-2] INFO  io.seata.tm.api.DefaultGlobalTransaction - Begin new global transaction [seata-server:8091:153776404394049582]
2025-05-25 02:28:11.711 [reactor-http-nio-2] INFO  c.b.bgai.interceptor.SeataTransactionInterceptor - 准备记录分布式事务开始: XID=seata-server:8091:153776404394049582, 业务=com.bgpay.bgai.service.mq.BillingTransactionListenerImpl.executeLocalTransaction, 路径=, IP=, 用户=system
2025-05-25 02:28:11.717 [reactor-http-nio-2] INFO  c.b.bgai.service.impl.TransactionLogServiceImpl - 记录分布式事务开始: XID=seata-server:8091:153776404394049582, 业务=com.bgpay.bgai.service.mq.BillingTransactionListenerImpl.executeLocalTransaction
2025-05-25 02:28:11.718 [reactor-http-nio-2] DEBUG com.bgpay.bgai.mapper.TransactionLogMapper.insert - ==>  Preparing: INSERT INTO transaction_log ( xid, transaction_name, transaction_mode, status, request_path, source_ip, start_time, user_id, create_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-05-25 02:28:11.718 [reactor-http-nio-2] DEBUG com.bgpay.bgai.mapper.TransactionLogMapper.insert - ==> Parameters: seata-server:8091:153776404394049582(String), com.bgpay.bgai.service.mq.BillingTransactionListenerImpl.executeLocalTransaction(String), AT(String), ACTIVE(String), (String), (String), 2025-05-25T02:28:11.717613100(LocalDateTime), system(String), 2025-05-25T02:28:11.717613100(LocalDateTime)
2025-05-25 02:28:11.747 [reactor-http-nio-2] DEBUG com.bgpay.bgai.mapper.TransactionLogMapper.insert - <==    Updates: 1
2025-05-25 02:28:11.757 [reactor-http-nio-2] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:153776404394049582, branchId:153776404394049583, lockKeys:transaction_log:40
2025-05-25 02:28:11.780 [reactor-http-nio-2] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:153776404394049582, branchId:153776404394049584, lockKeys:undo_log:157;transaction_log:40
2025-05-25 02:28:11.811 [reactor-http-nio-2] INFO  c.b.bgai.interceptor.SeataTransactionInterceptor - 开始分布式事务: XID=seata-server:8091:153776404394049582, 方法=com.bgpay.bgai.service.mq.BillingTransactionListenerImpl.executeLocalTransaction
2025-05-25 02:28:11.811 [reactor-http-nio-2] INFO  c.b.bgai.service.mq.BillingTransactionListenerImpl - 开始执行本地事务, xid: seata-server:8091:153776404394049582, userId: 689258T, completionId: chat-a098c829-2fce-4a07-850c-5705e116f4b4
2025-05-25 02:28:11.828 [reactor-http-nio-2] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.selectCount - ==>  Preparing: SELECT COUNT( * ) AS total FROM usage_info WHERE (chat_completion_id = ?)
2025-05-25 02:28:11.830 [reactor-http-nio-2] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.selectCount - ==> Parameters: chat-a098c829-2fce-4a07-850c-5705e116f4b4(String)
2025-05-25 02:28:11.838 [reactor-http-nio-2] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.selectCount - <==      Total: 1
2025-05-25 02:28:11.852 [reactor-http-nio-2] INFO  com.bgpay.bgai.transaction.TransactionCoordinator - Transaction prepared for user 689258T: chatCompletionId=chat-e388a4cb-3a36-4a89-b9d1-a7648bf3b0dc
2025-05-25 02:28:11.853 [reactor-http-nio-2] ERROR c.b.bgai.service.mq.BillingTransactionListenerImpl - 事务ID不一致，回滚事务, expected: chat-a098c829-2fce-4a07-850c-5705e116f4b4, actual: chat-e388a4cb-3a36-4a89-b9d1-a7648bf3b0dc
2025-05-25 02:28:11.863 [reactor-http-nio-2] INFO  c.b.bgai.service.impl.TransactionLogServiceImpl - 记录分布式事务结束: XID=seata-server:8091:153776404394049582, 状态=COMMITTED
2025-05-25 02:28:11.865 [reactor-http-nio-2] DEBUG c.b.bgai.mapper.TransactionLogMapper.selectList - ==>  Preparing: SELECT id,xid,branch_id,transaction_name,transaction_mode,status,request_path,source_ip,start_time,end_time,user_id,extra_data,create_time,update_time FROM transaction_log WHERE (xid = ?) LIMIT 1
2025-05-25 02:28:11.865 [reactor-http-nio-2] DEBUG c.b.bgai.mapper.TransactionLogMapper.selectList - ==> Parameters: seata-server:8091:153776404394049582(String)
2025-05-25 02:28:11.873 [reactor-http-nio-2] DEBUG c.b.bgai.mapper.TransactionLogMapper.selectList - <==      Total: 1
2025-05-25 02:28:11.874 [reactor-http-nio-2] DEBUG c.b.bgai.mapper.TransactionLogMapper.updateById - ==>  Preparing: UPDATE transaction_log SET xid=?, transaction_name=?, transaction_mode=?, status=?, request_path=?, source_ip=?, start_time=?, end_time=?, user_id=?, extra_data=?, create_time=?, update_time=? WHERE id=?
2025-05-25 02:28:11.875 [reactor-http-nio-2] DEBUG c.b.bgai.mapper.TransactionLogMapper.updateById - ==> Parameters: seata-server:8091:153776404394049582(String), com.bgpay.bgai.service.mq.BillingTransactionListenerImpl.executeLocalTransaction(String), AT(String), COMMITTED(String), (String), (String), 2025-05-25T02:28:12(LocalDateTime), 2025-05-25T02:28:11.874614(LocalDateTime), system(String), {"duration":42,"result":"success"}(String), 2025-05-25T02:28:12(LocalDateTime), 2025-05-25T02:28:11.874614(LocalDateTime), 40(Long)
2025-05-25 02:28:11.921 [reactor-http-nio-2] DEBUG c.b.bgai.mapper.TransactionLogMapper.updateById - <==    Updates: 1
2025-05-25 02:28:11.929 [reactor-http-nio-2] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:153776404394049582, branchId:153776404394049585, lockKeys:transaction_log:40
2025-05-25 02:28:11.964 [reactor-http-nio-2] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:153776404394049582, branchId:153776404394049586, lockKeys:undo_log:159;transaction_log:40
2025-05-25 02:28:11.991 [reactor-http-nio-2] INFO  c.b.bgai.interceptor.SeataTransactionInterceptor - 分布式事务成功完成: XID=seata-server:8091:153776404394049582, 耗时=42ms
2025-05-25 02:28:11.991 [reactor-http-nio-2] INFO  io.seata.tm.api.DefaultGlobalTransaction - transaction seata-server:8091:153776404394049582 will be commit
2025-05-25 02:28:12.003 [reactor-http-nio-2] INFO  io.seata.tm.api.DefaultGlobalTransaction - transaction end, xid = seata-server:8091:153776404394049582
2025-05-25 02:28:12.003 [reactor-http-nio-2] INFO  io.seata.tm.api.DefaultGlobalTransaction - [seata-server:8091:153776404394049582] commit status: Committed
2025-05-25 02:28:12.005 [reactor-http-nio-2] INFO  org.reflections.Reflections - 账单消息发送成功，chatCompletionId: chat-a098c829-2fce-4a07-850c-5705e116f4b4, userId: 689258T
2025-05-25 02:28:12.014 [reactor-http-nio-2] INFO  com.bgpay.bgai.service.impl.BGAIServiceImpl - 执行第一步操作 - 发送账单消息, businessKey: 689258T:chat-a098c829-2fce-4a07-850c-5705e116f4b4
2025-05-25 02:28:12.016 [reactor-http-nio-2] DEBUG c.bgpay.bgai.mapper.UsageRecordMapper.selectCount - ==>  Preparing: SELECT COUNT( * ) AS total FROM usage_record WHERE (chat_completion_id = ?)
2025-05-25 02:28:12.016 [reactor-http-nio-2] DEBUG c.bgpay.bgai.mapper.UsageRecordMapper.selectCount - ==> Parameters: chat-a098c829-2fce-4a07-850c-5705e116f4b4(String)
2025-05-25 02:28:12.023 [reactor-http-nio-2] DEBUG c.bgpay.bgai.mapper.UsageRecordMapper.selectCount - <==      Total: 1
2025-05-25 02:28:12.046 [reactor-http-nio-2] DEBUG c.bgpay.bgai.mapper.UsageRecordMapper.selectList - ==>  Preparing: SELECT id,model_type,chat_completion_id,user_id,input_cost,output_cost,price_version,calculated_at,message_id,input_tokens,output_tokens,status,created_at,updated_at FROM usage_record WHERE (chat_completion_id = ?)
2025-05-25 02:28:12.046 [reactor-http-nio-2] DEBUG c.bgpay.bgai.mapper.UsageRecordMapper.selectList - ==> Parameters: chat-a098c829-2fce-4a07-850c-5705e116f4b4(String)
2025-05-25 02:28:12.053 [reactor-http-nio-2] DEBUG c.bgpay.bgai.mapper.UsageRecordMapper.selectList - <==      Total: 0
2025-05-25 02:28:12.073 [reactor-http-nio-2] ERROR com.bgpay.bgai.service.impl.BGAIServiceImpl - 未找到计费数据, completionId: chat-a098c829-2fce-4a07-850c-5705e116f4b4
2025-05-25 02:28:12.086 [reactor-http-nio-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - Processed response for user 689258T, content length: 2767
2025-05-25 02:28:12.086 [reactor-http-nio-2] WARN  com.bgpay.bgai.controller.ReactiveChatController - ChatCompletionId inconsistency detected, using transaction coordinator ID
2025-05-25 02:28:12.762 [rpcDispatch_RMROLE_1_5_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:153776404394049582', branchId=153776404394049583, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false,"skipCheckLock":true}'}
2025-05-25 02:28:12.763 [rpcDispatch_RMROLE_1_5_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:153776404394049582 153776404394049583 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false,"skipCheckLock":true}
2025-05-25 02:28:12.763 [rpcDispatch_RMROLE_1_5_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-25 02:28:12.772 [rpcDispatch_RMROLE_1_6_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:153776404394049582', branchId=153776404394049584, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false,"skipCheckLock":true}'}
2025-05-25 02:28:12.772 [rpcDispatch_RMROLE_1_6_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:153776404394049582 153776404394049584 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false,"skipCheckLock":true}
2025-05-25 02:28:12.772 [rpcDispatch_RMROLE_1_6_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-25 02:28:12.780 [rpcDispatch_RMROLE_1_7_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:153776404394049582', branchId=153776404394049585, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false}'}
2025-05-25 02:28:12.780 [rpcDispatch_RMROLE_1_7_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:153776404394049582 153776404394049585 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false}
2025-05-25 02:28:12.780 [rpcDispatch_RMROLE_1_7_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-25 02:28:12.788 [rpcDispatch_RMROLE_1_8_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:153776404394049582', branchId=153776404394049586, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false}'}
2025-05-25 02:28:12.788 [rpcDispatch_RMROLE_1_8_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:153776404394049582 153776404394049586 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false}
2025-05-25 02:28:12.789 [rpcDispatch_RMROLE_1_8_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-25 02:32:27.949 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-25 02:32:27.950 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-25 02:32:27.957 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-25 02:32:27.957 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-25 02:32:27.957 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-25 02:32:27.962 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-25 02:34:09.955 [Thread-7] WARN  com.alibaba.nacos.common.notify.NotifyCenter - [NotifyCenter] Start destroying Publisher
2025-05-25 02:34:09.955 [Thread-1] WARN  c.alibaba.nacos.common.http.HttpClientBeanHolder - [HttpClientBeanHolder] Start destroying common HttpClient
2025-05-25 02:34:09.956 [Thread-7] WARN  com.alibaba.nacos.common.notify.NotifyCenter - [NotifyCenter] Destruction of the end
2025-05-25 02:34:09.956 [Thread-1] WARN  c.alibaba.nacos.common.http.HttpClientBeanHolder - [HttpClientBeanHolder] Destruction of the end
2025-05-25 02:34:09.973 [SpringContextShutdownHook] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - De-registering from Nacos Server now...
2025-05-25 02:34:09.973 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - [DEREGISTER-SERVICE] d750d92e-152f-4055-a641-3bc9dda85a29 deregistering service bgtech-ai with instance: Instance{instanceId='null', ip='192.168.86.8', port=8080, weight=1.0, healthy=true, enabled=true, ephemeral=true, clusterName='DEFAULT', serviceName='null', metadata={}}
2025-05-25 02:34:09.981 [SpringContextShutdownHook] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - De-registration finished.
2025-05-25 02:34:09.982 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.cache.ServiceInfoHolder do shutdown begin
2025-05-25 02:34:09.982 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.backups.FailoverReactor do shutdown begin
2025-05-25 02:34:09.982 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.backups.FailoverReactor do shutdown stop
2025-05-25 02:34:09.982 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.cache.ServiceInfoHolder do shutdown stop
2025-05-25 02:34:09.982 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.NamingClientProxyDelegate do shutdown begin
2025-05-25 02:34:09.982 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServiceInfoUpdateService do shutdown begin
2025-05-25 02:34:09.982 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServiceInfoUpdateService do shutdown stop
2025-05-25 02:34:09.982 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServerListManager do shutdown begin
2025-05-25 02:34:09.982 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Start destroying NacosRestTemplate
2025-05-25 02:34:09.982 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Destruction of the end
2025-05-25 02:34:09.982 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServerListManager do shutdown stop
2025-05-25 02:34:09.982 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.http.NamingHttpClientProxy do shutdown begin
2025-05-25 02:34:09.982 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Start destroying NacosRestTemplate
2025-05-25 02:34:09.982 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Destruction of the end
2025-05-25 02:34:09.982 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.http.NamingHttpClientProxy do shutdown stop
2025-05-25 02:34:09.982 [SpringContextShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Shutdown rpc client, set status to shutdown
2025-05-25 02:34:09.982 [SpringContextShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Shutdown client event executor java.util.concurrent.ScheduledThreadPoolExecutor@177e6486[Running, pool size = 2, active threads = 2, queued tasks = 0, completed tasks = 0]
2025-05-25 02:34:09.982 [SpringContextShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Close current connection 1748111245682_139.227.195.192_50149
2025-05-25 02:34:09.985 [nacos-grpc-client-executor-8.133.246.113-99] WARN  c.a.nacos.common.remote.client.grpc.GrpcClient - [1748111245682_139.227.195.192_50149]Ignore error event,isRunning:false,isAbandon=false
2025-05-25 02:34:09.986 [SpringContextShutdownHook] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - Shutdown grpc executor java.util.concurrent.ThreadPoolExecutor@18f92361[Running, pool size = 4, active threads = 0, queued tasks = 0, completed tasks = 100]
2025-05-25 02:34:09.986 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - Shutdown grpc redo service executor java.util.concurrent.ScheduledThreadPoolExecutor@4a467e68[Running, pool size = 1, active threads = 0, queued tasks = 1, completed tasks = 134]
2025-05-25 02:34:09.987 [SpringContextShutdownHook] INFO  c.a.n.client.auth.ram.identify.CredentialWatcher - [null] CredentialWatcher is stopped
2025-05-25 02:34:09.987 [SpringContextShutdownHook] INFO  c.a.n.client.auth.ram.identify.CredentialService - [null] CredentialService is freed
2025-05-25 02:34:09.987 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.NamingClientProxyDelegate do shutdown stop
2025-05-25 02:34:09.993 [SpringContextShutdownHook] DEBUG com.bgpay.bgai.config.AsyncConfig$1 - Shutting down ExecutorService 'blockingExecutor'
2025-05-25 02:34:10.595 [com.alibaba.nacos.client.Worker] INFO  c.a.n.client.auth.ram.identify.CredentialWatcher - null No credential found
2025-05-25 02:34:12.059 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:9876] result: true
2025-05-25 02:34:12.059 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:10911] result: true
2025-05-25 02:34:12.078 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:10911] result: true
2025-05-25 02:34:12.078 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:9876] result: true
2025-05-25 02:34:12.190 [SpringContextShutdownHook] INFO  o.s.orm.jpa.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-05-25 02:34:12.192 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-2} closing ...
2025-05-25 02:34:12.195 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-2} closed
2025-05-25 02:34:12.195 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} closing ...
2025-05-25 02:34:12.195 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} closed
2025-05-25 02:34:12.196 [NettyClientSelector_TMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - channel inactive: [id: 0xd0c48d1f, L:/192.168.86.8:57547 ! R:/8.133.246.113:8091]
2025-05-25 02:34:12.196 [NettyClientSelector_TMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - return to pool, rm channel:[id: 0xd0c48d1f, L:/192.168.86.8:57547 ! R:/8.133.246.113:8091]
2025-05-25 02:34:12.196 [NettyClientSelector_TMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - channel valid false,channel:[id: 0xd0c48d1f, L:/192.168.86.8:57547 ! R:/8.133.246.113:8091]
2025-05-25 02:34:12.196 [NettyClientSelector_TMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - will destroy channel:[id: 0xd0c48d1f, L:/192.168.86.8:57547 ! R:/8.133.246.113:8091]
2025-05-25 02:34:12.196 [NettyClientSelector_TMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0xd0c48d1f, L:/192.168.86.8:57547 ! R:/8.133.246.113:8091]) will closed
2025-05-25 02:34:12.196 [NettyClientSelector_TMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0xd0c48d1f, L:/192.168.86.8:57547 ! R:/8.133.246.113:8091]) will closed
2025-05-25 02:34:12.198 [NettyClientSelector_RMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - channel inactive: [id: 0xf2713c25, L:/192.168.86.8:57549 ! R:/8.133.246.113:8091]
2025-05-25 02:34:12.199 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - return to pool, rm channel:[id: 0xf2713c25, L:/192.168.86.8:57549 ! R:/8.133.246.113:8091]
2025-05-25 02:34:12.199 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - channel valid false,channel:[id: 0xf2713c25, L:/192.168.86.8:57549 ! R:/8.133.246.113:8091]
2025-05-25 02:34:12.199 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - will destroy channel:[id: 0xf2713c25, L:/192.168.86.8:57549 ! R:/8.133.246.113:8091]
2025-05-25 02:34:12.199 [NettyClientSelector_RMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0xf2713c25, L:/192.168.86.8:57549 ! R:/8.133.246.113:8091]) will closed
2025-05-25 02:34:12.199 [NettyClientSelector_RMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0xf2713c25, L:/192.168.86.8:57549 ! R:/8.133.246.113:8091]) will closed
2025-05-25 02:36:17.906 [main] WARN  com.alibaba.nacos.client.logging.NacosLogging - Load Logback Configuration of Nacos fail, message: Could not initialize Logback Nacos logging from classpath:nacos-logback.xml
2025-05-25 02:36:17.907 [main] INFO  com.bgpay.bgai.BgaiApplication - The following 1 profile is active: "dev"
2025-05-25 02:36:19.378 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-05-25 02:36:19.380 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-05-25 02:36:19.404 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 17 ms. Found 0 JPA repository interfaces.
2025-05-25 02:36:19.416 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-05-25 02:36:19.417 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-05-25 02:36:19.428 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 4 ms. Found 0 Redis repository interfaces.
2025-05-25 02:36:20.146 [main] INFO  io.seata.config.ConfigurationFactory - load Configuration from :Spring Configuration
2025-05-25 02:36:20.154 [main] INFO  io.seata.config.ConfigurationFactory - load Configuration from :Spring Configuration
2025-05-25 02:36:20.161 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Initializing Global Transaction Clients ... 
2025-05-25 02:36:20.261 [main] INFO  io.seata.core.rpc.netty.NettyClientBootstrap - NettyClientBootstrap has started
2025-05-25 02:36:20.263 [main] INFO  io.seata.discovery.registry.RegistryFactory - use registry center type: file
2025-05-25 02:36:20.272 [main] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - will connect to 8.133.246.113:8091
2025-05-25 02:36:20.275 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - NettyPool create channel to transactionRole:TMROLE,address:8.133.246.113:8091,msg:< RegisterTMRequest{version='1.7.0', applicationId='bgtech-ai', transactionServiceGroup='bgai-tx-group', extraData='ak=null
digest=bgai-tx-group,192.168.86.8,1748111780274
timestamp=1748111780274
authVersion=V4
vgroup=bgai-tx-group
ip=192.168.86.8
'} >
2025-05-25 02:36:20.400 [main] INFO  io.seata.core.rpc.netty.TmNettyRemotingClient - register TM success. client version:1.7.0, server version:1.8.1-SNAPSHOT,channel:[id: 0xdfc0e432, L:/192.168.86.8:59424 - R:/8.133.246.113:8091]
2025-05-25 02:36:20.406 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - register success, cost 62 ms, version:1.8.1-SNAPSHOT,role:TMROLE,channel:[id: 0xdfc0e432, L:/192.168.86.8:59424 - R:/8.133.246.113:8091]
2025-05-25 02:36:20.407 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Transaction Manager Client is initialized. applicationId[bgtech-ai] txServiceGroup[bgai-tx-group]
2025-05-25 02:36:20.417 [main] INFO  io.seata.rm.datasource.AsyncWorker - Async Commit Buffer Limit: 10000
2025-05-25 02:36:20.418 [main] INFO  io.seata.rm.datasource.xa.ResourceManagerXA - ResourceManagerXA init ...
2025-05-25 02:36:20.424 [main] INFO  io.seata.core.rpc.netty.NettyClientBootstrap - NettyClientBootstrap has started
2025-05-25 02:36:20.424 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Resource Manager is initialized. applicationId[bgtech-ai] txServiceGroup[bgai-tx-group]
2025-05-25 02:36:20.424 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Global Transaction Clients are initialized. 
2025-05-25 02:36:21.541 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat initialized with port(s): 8080 (http)
2025-05-25 02:36:21.550 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - The ["http-nio-8080"] connector has been configured to support HTTP upgrade to [h2c]
2025-05-25 02:36:21.550 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - Initializing ProtocolHandler ["http-nio-8080"]
2025-05-25 02:36:21.552 [main] INFO  org.apache.catalina.core.StandardService - Starting service [Tomcat]
2025-05-25 02:36:21.552 [main] INFO  org.apache.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.15]
2025-05-25 02:36:21.945 [main] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} inited
2025-05-25 02:36:22.193 [main] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - will connect to 8.133.246.113:8091
2025-05-25 02:36:22.193 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - RM will register :jdbc:mysql://8.133.246.113:3306/deepseek
2025-05-25 02:36:22.193 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - NettyPool create channel to transactionRole:RMROLE,address:8.133.246.113:8091,msg:< RegisterRMRequest{resourceIds='jdbc:mysql://8.133.246.113:3306/deepseek', version='1.7.0', applicationId='bgtech-ai', transactionServiceGroup='bgai-tx-group', extraData='null'} >
2025-05-25 02:36:22.213 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - register RM success. client version:1.7.0, server version:1.8.1-SNAPSHOT,channel:[id: 0x693bc0e7, L:/192.168.86.8:59427 - R:/8.133.246.113:8091]
2025-05-25 02:36:22.213 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - register success, cost 11 ms, version:1.8.1-SNAPSHOT,role:RMROLE,channel:[id: 0x693bc0e7, L:/192.168.86.8:59427 - R:/8.133.246.113:8091]
2025-05-25 02:36:22.216 [main] INFO  i.s.s.a.datasource.SeataAutoDataSourceProxyCreator - Auto proxy data source 'masterDataSource' by 'AT' mode.
2025-05-25 02:36:22.279 [main] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-2} inited
2025-05-25 02:36:22.350 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - will register resourceId:jdbc:mysql://8.133.246.113:3306/deepseek
2025-05-25 02:36:22.351 [main] INFO  i.s.s.a.datasource.SeataAutoDataSourceProxyCreator - Auto proxy data source 'slaveDataSource' by 'AT' mode.
2025-05-25 02:36:22.359 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.rm.AbstractRMHandler - the rm client received response msg [RegisterRMResponse{version='1.8.1-SNAPSHOT', extraData='null', identified=true, resultCode=null, msg='null'}] from tc server.
2025-05-25 02:36:22.372 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - will register resourceId:jdbc:mysql://8.133.246.113:3306/deepseek
2025-05-25 02:36:22.372 [main] INFO  i.s.s.a.datasource.SeataAutoDataSourceProxyCreator - Auto proxy data source 'dynamicDataSource' by 'AT' mode.
2025-05-25 02:36:22.381 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.rm.AbstractRMHandler - the rm client received response msg [RegisterRMResponse{version='1.8.1-SNAPSHOT', extraData='null', identified=true, resultCode=null, msg='null'}] from tc server.
2025-05-25 02:36:22.478 [main] INFO  org.hibernate.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-05-25 02:36:22.543 [main] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.1.7.Final
2025-05-25 02:36:22.977 [main] INFO  SQL dialect - HHH000400: Using dialect: org.hibernate.dialect.MySQL8Dialect
2025-05-25 02:36:22.979 [main] WARN  org.hibernate.orm.deprecation - HHH90000026: MySQL8Dialect has been deprecated; use org.hibernate.dialect.MySQLDialect instead
2025-05-25 02:36:23.253 [main] INFO  o.h.e.t.jta.platform.internal.JtaPlatformInitiator - HHH000490: Using JtaPlatform implementation: [org.hibernate.engine.transaction.jta.platform.internal.NoJtaPlatform]
2025-05-25 02:36:23.264 [main] INFO  o.s.orm.jpa.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-05-25 02:36:23.636 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-25 02:36:23.647 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-25 02:36:23.676 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-25 02:36:23.679 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-25 02:36:23.679 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-25 02:36:23.694 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-25 02:36:24.366 [main] INFO  com.bgpay.bgai.service.impl.UserServiceImpl - 初始化SSO配置: clientId=bgai-client-id, redirectUri=http://localhost:8080/api/auth/callback
2025-05-25 02:36:24.506 [main] INFO  com.bgpay.bgai.controller.AuthController - 初始化认证控制器: clientId=bgai-client-id, redirectUri=http://localhost:8080/api/auth/callback
2025-05-25 02:36:25.033 [main] INFO  o.a.r.s.autoconfigure.RocketMQAutoConfiguration - a producer (billing-producer-group) init on namesrv 8.133.246.113:9876
2025-05-25 02:36:25.609 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Bean [com.bgpay.bgai.service.deepseek.DeepSeekServiceImp$$SpringCGLIB$$0] with name [deepSeekServiceImp] would use interceptor [io.seata.spring.annotation.GlobalTransactionalInterceptor]
2025-05-25 02:36:26.012 [main] WARN  i.s.s.b.a.provider.SpringBootConfigurationProvider - The get method not found for the field 'SeataProperties#accesskey'.
2025-05-25 02:36:26.013 [main] WARN  i.s.s.b.a.provider.SpringBootConfigurationProvider - The get method not found for the field 'SeataProperties#secretkey'.
2025-05-25 02:36:26.025 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 加载到1个Saga状态机定义文件
2025-05-25 02:36:26.172 [main] INFO  com.bgpay.bgai.saga.CustomSagaJsonParser - 开始解析状态机定义: bgai-saga-transaction
2025-05-25 02:36:26.172 [main] INFO  com.bgpay.bgai.saga.CustomSagaJsonParser - 状态机定义解析成功: bgai-saga-transaction
2025-05-25 02:36:26.172 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 成功加载状态机定义: /E:/project/bgai/target/classes/statelang/bgai-saga-transaction.json
2025-05-25 02:36:26.584 [main] INFO  org.redisson.Version - Redisson 3.24.3
2025-05-25 02:36:26.732 [redisson-netty-4-6] INFO  o.r.connection.pool.MasterPubSubConnectionPool - 1 connections initialized for 8.133.246.113/8.133.246.113:6379
2025-05-25 02:36:27.064 [redisson-netty-4-19] INFO  org.redisson.connection.pool.MasterConnectionPool - 24 connections initialized for 8.133.246.113/8.133.246.113:6379
2025-05-25 02:36:27.225 [main] INFO  com.bgpay.bgai.service.mq.MQConsumerService - MQ consumer startup successful [group=billing-consumer-group, topic=BILLING_TOPIC, tag=USER_BILLING]
2025-05-25 02:36:27.388 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Bean [com.bgpay.bgai.service.mq.BillingTransactionListenerImpl$$SpringCGLIB$$0] with name [billingTransactionListenerImpl] would use interceptor [io.seata.spring.annotation.GlobalTransactionalInterceptor]
2025-05-25 02:36:27.535 [main] DEBUG com.bgpay.bgai.config.AsyncConfig$1 - Initializing ExecutorService 'blockingExecutor'
2025-05-25 02:36:27.570 [main] INFO  c.b.bgai.config.NacosConfig$NacosWarningHandler - Nacos警告处理器已启用，将忽略配置中心连接警告
2025-05-25 02:36:28.688 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [After]
2025-05-25 02:36:28.688 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Before]
2025-05-25 02:36:28.688 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Between]
2025-05-25 02:36:28.688 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Cookie]
2025-05-25 02:36:28.688 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Header]
2025-05-25 02:36:28.688 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Host]
2025-05-25 02:36:28.688 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Method]
2025-05-25 02:36:28.688 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Path]
2025-05-25 02:36:28.688 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Query]
2025-05-25 02:36:28.688 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [ReadBody]
2025-05-25 02:36:28.688 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [RemoteAddr]
2025-05-25 02:36:28.688 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [XForwardedRemoteAddr]
2025-05-25 02:36:28.688 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Weight]
2025-05-25 02:36:28.688 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [CloudFoundryRouteService]
2025-05-25 02:36:30.069 [main] INFO  o.s.b.actuate.endpoint.web.EndpointLinksResolver - Exposing 3 endpoint(s) beneath base path '/actuator'
2025-05-25 02:36:31.647 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - Starting ProtocolHandler ["http-nio-8080"]
2025-05-25 02:36:31.662 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat started on port(s): 8080 (http) with context path ''
2025-05-25 02:36:31.672 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from ans.namespace attribute : null
2025-05-25 02:36:31.672 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from ALIBABA_ALIWARE_NAMESPACE attribute :null
2025-05-25 02:36:31.673 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from namespace attribute :null
2025-05-25 02:36:31.682 [main] INFO  c.a.n.p.auth.spi.client.ClientAuthPluginManager - [ClientAuthPluginManager] Load ClientAuthService com.alibaba.nacos.client.auth.impl.NacosClientAuthServiceImpl success.
2025-05-25 02:36:31.682 [main] INFO  c.a.n.p.auth.spi.client.ClientAuthPluginManager - [ClientAuthPluginManager] Load ClientAuthService com.alibaba.nacos.client.auth.ram.RamClientAuthServiceImpl success.
2025-05-25 02:36:31.686 [main] INFO  com.alibaba.nacos.common.remote.client - [RpcClientFactory] create a new rpc client of 22a7286c-f12f-42fd-8b64-51d88f127548
2025-05-25 02:36:31.687 [main] INFO  com.alibaba.nacos.common.remote.client - [22a7286c-f12f-42fd-8b64-51d88f127548] RpcClient init, ServerListFactory = com.alibaba.nacos.client.naming.core.ServerListManager
2025-05-25 02:36:31.688 [main] INFO  com.alibaba.nacos.common.remote.client - [22a7286c-f12f-42fd-8b64-51d88f127548] Registry connection listener to current client:com.alibaba.nacos.client.naming.remote.gprc.redo.NamingGrpcRedoService
2025-05-25 02:36:31.688 [main] INFO  com.alibaba.nacos.common.remote.client - [22a7286c-f12f-42fd-8b64-51d88f127548] Register server push request handler:com.alibaba.nacos.client.naming.remote.gprc.NamingPushRequestHandler
2025-05-25 02:36:31.688 [main] INFO  com.alibaba.nacos.common.remote.client - [22a7286c-f12f-42fd-8b64-51d88f127548] Try to connect to server on start up, server: {serverIp = '8.133.246.113', server main port = 8848}
2025-05-25 02:36:31.689 [main] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - grpc client connection server:8.133.246.113 ip,serverPort:9848,grpcTslConfig:{"sslProvider":"OPENSSL","enableTls":false,"mutualAuthEnable":false,"trustAll":false}
2025-05-25 02:36:31.839 [main] INFO  com.alibaba.nacos.common.remote.client - [22a7286c-f12f-42fd-8b64-51d88f127548] Success to connect to server [8.133.246.113:8848] on start up, connectionId = 1748111791730_139.227.195.192_49500
2025-05-25 02:36:31.839 [main] INFO  com.alibaba.nacos.common.remote.client - [22a7286c-f12f-42fd-8b64-51d88f127548] Register server push request handler:com.alibaba.nacos.common.remote.client.RpcClient$ConnectResetRequestHandler
2025-05-25 02:36:31.839 [com.alibaba.nacos.client.remote.worker] INFO  com.alibaba.nacos.common.remote.client - [22a7286c-f12f-42fd-8b64-51d88f127548] Notify connected event to listeners.
2025-05-25 02:36:31.839 [main] INFO  com.alibaba.nacos.common.remote.client - [22a7286c-f12f-42fd-8b64-51d88f127548] Register server push request handler:com.alibaba.nacos.common.remote.client.RpcClient$$Lambda/0x0000028e81528430
2025-05-25 02:36:31.839 [com.alibaba.nacos.client.remote.worker] INFO  com.alibaba.nacos.client.naming - Grpc connection connect
2025-05-25 02:36:31.840 [main] INFO  com.alibaba.nacos.client.naming - [REGISTER-SERVICE] d750d92e-152f-4055-a641-3bc9dda85a29 registering service bgtech-ai with instance Instance{instanceId='null', ip='192.168.86.8', port=8080, weight=1.0, healthy=true, enabled=true, ephemeral=true, clusterName='DEFAULT', serviceName='null', metadata={IPv6=[2408:820c:7528:d042:c185:8edc:f30d:3d91], preserved.register.source=SPRING_CLOUD}}
2025-05-25 02:36:31.859 [main] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - nacos registry, DEFAULT_GROUP bgtech-ai 192.168.86.8:8080 register finished
2025-05-25 02:36:31.915 [main] INFO  com.bgpay.bgai.config.NacosConfig - 应用启动完成，当前环境: dev
2025-05-25 02:36:31.915 [main] INFO  com.bgpay.bgai.config.NacosConfig - Nacos配置中心: 8.133.246.113:8848, 命名空间: d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-25 02:36:31.915 [main] INFO  com.bgpay.bgai.config.NacosConfig - 注意: 如果看到Nacos配置加载警告，但应用正常启动，说明应用正在使用本地配置文件
2025-05-25 02:36:31.916 [main] INFO  com.bgpay.bgai.BgaiApplication - Started BgaiApplication in 16.055 seconds (process running for 17.429)
2025-05-25 02:36:31.921 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-25 02:36:31.922 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-25 02:36:31.935 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-25 02:36:31.935 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-25 02:36:31.935 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-25 02:36:31.947 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-25 02:36:31.948 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-25 02:36:31.948 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-25 02:36:31.956 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-25 02:36:31.956 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-25 02:36:31.956 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-25 02:36:31.962 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-25 02:36:31.963 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - ==================== Saga状态机加载报告 ====================
2025-05-25 02:36:31.963 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - Saga状态机配置加载状态: 成功
2025-05-25 02:36:31.963 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 已加载的状态机定义文件数量: 1
2025-05-25 02:36:31.963 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 已加载的状态机定义文件:
2025-05-25 02:36:31.963 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig -  - /E:/project/bgai/target/classes/statelang/bgai-saga-transaction.json
2025-05-25 02:36:31.963 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - Saga解析器状态: CUSTOM_FASTJSON2
2025-05-25 02:36:31.963 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 状态机解析结果: 成功 1 个, 失败 0 个
2025-05-25 02:36:31.963 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - =============================================================
2025-05-25 02:36:31.967 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - nacos.cache.data.init.snapshot = true 
2025-05-25 02:36:31.968 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] common-dev.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-25 02:36:31.976 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=common-dev.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-25 02:36:31.976 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=common-dev.yaml, group=DEFAULT_GROUP
2025-05-25 02:36:31.976 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-25 02:36:31.976 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-25 02:36:31.976 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai.yaml, group=DEFAULT_GROUP
2025-05-25 02:36:31.977 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai-dev.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-25 02:36:31.978 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai-dev.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-25 02:36:31.978 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai-dev.yaml, group=DEFAULT_GROUP
2025-05-25 02:36:31.978 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-25 02:36:31.978 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai, group=DEFAULT_GROUP, cnt=1
2025-05-25 02:36:31.978 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai, group=DEFAULT_GROUP
2025-05-25 02:36:36.770 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - 接收到请求: /api/chatGatWay-internal, 文件=新文件 17.txt, 问题参数=null, 模型参数=null
2025-05-25 02:36:36.772 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - 请求Content-Type: multipart/form-data;boundary=--------------------------645003069923986034807374
2025-05-25 02:36:36.773 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - 收集到的完整参数: question="null", apiUrl="null", modelName="null", multiTurn=false
2025-05-25 02:36:36.775 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - Processing request for user ID: 689258T
2025-05-25 02:36:36.775 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - Processing file with circuit breaker: fileName=新文件 17.txt, question=
2025-05-25 02:36:36.777 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.config.ReactiveFileProcessor - Processing file: 新文件 17.txt, content-type: text/plain
2025-05-25 02:36:36.785 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - PARAM TRACE [689258T]: 尝试查找匹配配置 - 参数: apiUrl=null, modelName=null
2025-05-25 02:36:36.807 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 查询配置 - userId=689258T
2025-05-25 02:36:36.808 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 排序方式 - 按ID降序
2025-05-25 02:36:36.809 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 限制结果数 - LIMIT 1
2025-05-25 02:36:36.917 [http-nio-8080-exec-2] DEBUG com.bgpay.bgai.mapper.ApiConfigMapper.selectList - ==>  Preparing: SELECT id,api_url,api_key,model_name,user_id FROM api_config WHERE (user_id = ?) ORDER BY id DESC LIMIT 1
2025-05-25 02:36:36.919 [http-nio-8080-exec-2] DEBUG com.bgpay.bgai.mapper.ApiConfigMapper.selectList - ==> Parameters: 689258T(String)
2025-05-25 02:36:36.929 [http-nio-8080-exec-2] DEBUG com.bgpay.bgai.mapper.ApiConfigMapper.selectList - <==      Total: 1
2025-05-25 02:36:36.929 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 查询结果 - 找到配置: id=2, modelName=deepseek-chat
2025-05-25 02:36:36.929 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - PARAM TRACE [689258T]: 找到匹配配置 - apiUrl=https://api.deepseek.com/chat/completions, modelName=deepseek-chat (原始请求: null)
2025-05-25 02:36:36.930 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - API config resolved: url=https://api.deepseek.com/chat/completions, model=deepseek-chat
2025-05-25 02:36:36.950 [Thread-49] INFO  com.bgpay.bgai.config.ReactiveFileProcessor - File processed successfully: size=37 bytes
2025-05-25 02:36:36.954 [Thread-49] INFO  com.bgpay.bgai.controller.ReactiveChatController - Content processed, length: 54
2025-05-25 02:36:36.961 [Thread-49] INFO  io.seata.tm.TransactionManagerHolder - TransactionManager Singleton io.seata.tm.DefaultTransactionManager@4ba50e5c
2025-05-25 02:36:36.979 [Thread-49] INFO  io.seata.tm.api.DefaultGlobalTransaction - Begin new global transaction [seata-server:8091:153776404394049587]
2025-05-25 02:36:36.982 [Thread-49] INFO  c.b.bgai.interceptor.SeataTransactionInterceptor - 准备记录分布式事务开始: XID=seata-server:8091:153776404394049587, 业务=com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive, 路径=, IP=, 用户=system
2025-05-25 02:36:37.000 [Thread-49] INFO  c.b.bgai.service.impl.TransactionLogServiceImpl - 记录分布式事务开始: XID=seata-server:8091:153776404394049587, 业务=com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive
2025-05-25 02:36:37.008 [Thread-49] DEBUG com.bgpay.bgai.mapper.TransactionLogMapper.insert - ==>  Preparing: INSERT INTO transaction_log ( xid, transaction_name, transaction_mode, status, request_path, source_ip, start_time, user_id, create_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-05-25 02:36:37.013 [Thread-49] DEBUG com.bgpay.bgai.mapper.TransactionLogMapper.insert - ==> Parameters: seata-server:8091:153776404394049587(String), com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive(String), AT(String), ACTIVE(String), (String), (String), 2025-05-25T02:36:37.001991400(LocalDateTime), system(String), 2025-05-25T02:36:37.001991400(LocalDateTime)
2025-05-25 02:36:37.379 [Thread-49] DEBUG com.bgpay.bgai.mapper.TransactionLogMapper.insert - <==    Updates: 1
2025-05-25 02:36:37.395 [Thread-49] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:153776404394049587, branchId:153776404394049588, lockKeys:transaction_log:41
2025-05-25 02:36:37.405 [Thread-49] WARN  i.s.c.l.EnhancedServiceLoader$InnerEnhancedServiceLoader - Load [io.seata.rm.datasource.undo.parser.ProtostuffUndoLogParser] class fail: io/protostuff/runtime/IdStrategy
2025-05-25 02:36:37.470 [Thread-49] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:153776404394049587, branchId:153776404394049589, lockKeys:undo_log:161;transaction_log:41
2025-05-25 02:36:37.501 [Thread-49] INFO  c.b.bgai.interceptor.SeataTransactionInterceptor - 开始分布式事务: XID=seata-server:8091:153776404394049587, 方法=com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive
2025-05-25 02:36:37.510 [Thread-49] INFO  org.reflections.Reflections - Processing reactive request: content length=54, apiUrl=https://api.deepseek.com/chat/completions, modelName=deepseek-chat, userId=689258T, multiTurn=false
2025-05-25 02:36:37.519 [Thread-49] INFO  c.b.bgai.service.impl.TransactionLogServiceImpl - 记录分布式事务结束: XID=seata-server:8091:153776404394049587, 状态=COMMITTED
2025-05-25 02:36:37.521 [Thread-49] DEBUG c.b.bgai.mapper.TransactionLogMapper.selectList - ==>  Preparing: SELECT id,xid,branch_id,transaction_name,transaction_mode,status,request_path,source_ip,start_time,end_time,user_id,extra_data,create_time,update_time FROM transaction_log WHERE (xid = ?) LIMIT 1
2025-05-25 02:36:37.523 [Thread-49] DEBUG c.b.bgai.mapper.TransactionLogMapper.selectList - ==> Parameters: seata-server:8091:153776404394049587(String)
2025-05-25 02:36:37.530 [Thread-49] DEBUG c.b.bgai.mapper.TransactionLogMapper.selectList - <==      Total: 1
2025-05-25 02:36:37.534 [Thread-49] DEBUG c.b.bgai.mapper.TransactionLogMapper.updateById - ==>  Preparing: UPDATE transaction_log SET xid=?, transaction_name=?, transaction_mode=?, status=?, request_path=?, source_ip=?, start_time=?, end_time=?, user_id=?, extra_data=?, create_time=?, update_time=? WHERE id=?
2025-05-25 02:36:37.540 [Thread-49] DEBUG c.b.bgai.mapper.TransactionLogMapper.updateById - ==> Parameters: seata-server:8091:153776404394049587(String), com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive(String), AT(String), COMMITTED(String), (String), (String), 2025-05-25T02:36:37(LocalDateTime), 2025-05-25T02:36:37.530782500(LocalDateTime), system(String), {"duration":12,"result":"success"}(String), 2025-05-25T02:36:37(LocalDateTime), 2025-05-25T02:36:37.530782500(LocalDateTime), 41(Long)
2025-05-25 02:36:37.587 [Thread-49] DEBUG c.b.bgai.mapper.TransactionLogMapper.updateById - <==    Updates: 1
2025-05-25 02:36:37.598 [Thread-49] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:153776404394049587, branchId:153776404394049590, lockKeys:transaction_log:41
2025-05-25 02:36:37.636 [Thread-49] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:153776404394049587, branchId:153776404394049591, lockKeys:transaction_log:41;undo_log:163
2025-05-25 02:36:37.659 [Thread-49] INFO  c.b.bgai.interceptor.SeataTransactionInterceptor - 分布式事务成功完成: XID=seata-server:8091:153776404394049587, 耗时=12ms
2025-05-25 02:36:37.659 [Thread-49] INFO  io.seata.tm.api.DefaultGlobalTransaction - transaction seata-server:8091:153776404394049587 will be commit
2025-05-25 02:36:37.669 [Thread-49] INFO  io.seata.tm.api.DefaultGlobalTransaction - transaction end, xid = seata-server:8091:153776404394049587
2025-05-25 02:36:37.669 [Thread-49] INFO  io.seata.tm.api.DefaultGlobalTransaction - [seata-server:8091:153776404394049587] commit status: Committed
2025-05-25 02:36:37.707 [boundedElastic-1] WARN  com.bgpay.bgai.transaction.TransactionCoordinator - Found existing transaction for user 689258T: chat-e388a4cb-3a36-4a89-b9d1-a7648bf3b0dc
2025-05-25 02:36:37.707 [boundedElastic-1] INFO  org.reflections.Reflections - Transaction prepared with chatCompletionId: chat-e388a4cb-3a36-4a89-b9d1-a7648bf3b0dc
2025-05-25 02:36:37.769 [rpcDispatch_RMROLE_1_1_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:153776404394049587', branchId=153776404394049588, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false,"skipCheckLock":true}'}
2025-05-25 02:36:37.770 [rpcDispatch_RMROLE_1_1_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:153776404394049587 153776404394049588 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false,"skipCheckLock":true}
2025-05-25 02:36:37.770 [rpcDispatch_RMROLE_1_1_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-25 02:36:37.785 [rpcDispatch_RMROLE_1_2_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:153776404394049587', branchId=153776404394049589, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false,"skipCheckLock":true}'}
2025-05-25 02:36:37.785 [rpcDispatch_RMROLE_1_2_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:153776404394049587 153776404394049589 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false,"skipCheckLock":true}
2025-05-25 02:36:37.785 [rpcDispatch_RMROLE_1_2_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-25 02:36:37.795 [rpcDispatch_RMROLE_1_3_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:153776404394049587', branchId=153776404394049590, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false}'}
2025-05-25 02:36:37.795 [rpcDispatch_RMROLE_1_3_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:153776404394049587 153776404394049590 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false}
2025-05-25 02:36:37.795 [rpcDispatch_RMROLE_1_3_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-25 02:36:37.817 [rpcDispatch_RMROLE_1_4_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:153776404394049587', branchId=153776404394049591, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false}'}
2025-05-25 02:36:37.817 [rpcDispatch_RMROLE_1_4_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:153776404394049587 153776404394049591 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false}
2025-05-25 02:36:37.818 [rpcDispatch_RMROLE_1_4_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-25 02:37:07.074 [FileWrite-1] INFO  com.bgpay.bgai.service.deepseek.FileWriterService - Successfully wrote content to: \var\data\ai_responses\e00ca351-4102-4e6c-ab06-934a8031546b.txt
2025-05-25 02:37:07.088 [reactor-http-nio-2] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - ==>  Preparing: INSERT INTO chat_completions ( object, created, model, system_fingerprint, api_key ) VALUES ( ?, ?, ?, ?, ? )
2025-05-25 02:37:07.088 [reactor-http-nio-2] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - ==> Parameters: chat.completion(String), 1748111827086(Long), deepseek-chat(String), 689258T(String), chat-e388a4cb-3a36-4a89-b9d1-a7648bf3b0dc(String)
2025-05-25 02:37:07.101 [reactor-http-nio-2] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - <==    Updates: 1
2025-05-25 02:37:07.101 [reactor-http-nio-2] INFO  com.bgpay.bgai.transaction.TransactionCoordinator - Transaction committed for user 689258T: chatCompletionId=chat-e388a4cb-3a36-4a89-b9d1-a7648bf3b0dc
2025-05-25 02:37:07.123 [reactor-http-nio-2] INFO  org.reflections.Reflections - 开始发送账单消息，chatCompletionId: chat-e388a4cb-3a36-4a89-b9d1-a7648bf3b0dc, userId: 689258T
2025-05-25 02:37:07.193 [reactor-http-nio-2] INFO  io.seata.tm.api.DefaultGlobalTransaction - Begin new global transaction [seata-server:8091:153776404394049592]
2025-05-25 02:37:07.193 [reactor-http-nio-2] INFO  c.b.bgai.interceptor.SeataTransactionInterceptor - 准备记录分布式事务开始: XID=seata-server:8091:153776404394049592, 业务=com.bgpay.bgai.service.mq.BillingTransactionListenerImpl.executeLocalTransaction, 路径=, IP=, 用户=system
2025-05-25 02:37:07.199 [reactor-http-nio-2] INFO  c.b.bgai.service.impl.TransactionLogServiceImpl - 记录分布式事务开始: XID=seata-server:8091:153776404394049592, 业务=com.bgpay.bgai.service.mq.BillingTransactionListenerImpl.executeLocalTransaction
2025-05-25 02:37:07.199 [reactor-http-nio-2] DEBUG com.bgpay.bgai.mapper.TransactionLogMapper.insert - ==>  Preparing: INSERT INTO transaction_log ( xid, transaction_name, transaction_mode, status, request_path, source_ip, start_time, user_id, create_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-05-25 02:37:07.200 [reactor-http-nio-2] DEBUG com.bgpay.bgai.mapper.TransactionLogMapper.insert - ==> Parameters: seata-server:8091:153776404394049592(String), com.bgpay.bgai.service.mq.BillingTransactionListenerImpl.executeLocalTransaction(String), AT(String), ACTIVE(String), (String), (String), 2025-05-25T02:37:07.199437600(LocalDateTime), system(String), 2025-05-25T02:37:07.199437600(LocalDateTime)
2025-05-25 02:37:07.224 [reactor-http-nio-2] DEBUG com.bgpay.bgai.mapper.TransactionLogMapper.insert - <==    Updates: 1
2025-05-25 02:37:07.236 [reactor-http-nio-2] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:153776404394049592, branchId:153776404394049593, lockKeys:transaction_log:42
2025-05-25 02:37:07.260 [reactor-http-nio-2] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:153776404394049592, branchId:153776404394049594, lockKeys:undo_log:165;transaction_log:42
2025-05-25 02:37:07.282 [reactor-http-nio-2] INFO  c.b.bgai.interceptor.SeataTransactionInterceptor - 开始分布式事务: XID=seata-server:8091:153776404394049592, 方法=com.bgpay.bgai.service.mq.BillingTransactionListenerImpl.executeLocalTransaction
2025-05-25 02:37:07.283 [reactor-http-nio-2] INFO  c.b.bgai.service.mq.BillingTransactionListenerImpl - 开始执行本地事务, xid: seata-server:8091:153776404394049592, userId: 689258T, completionId: chat-e388a4cb-3a36-4a89-b9d1-a7648bf3b0dc
2025-05-25 02:37:07.297 [reactor-http-nio-2] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.selectCount - ==>  Preparing: SELECT COUNT( * ) AS total FROM usage_info WHERE (chat_completion_id = ?)
2025-05-25 02:37:07.298 [reactor-http-nio-2] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.selectCount - ==> Parameters: chat-e388a4cb-3a36-4a89-b9d1-a7648bf3b0dc(String)
2025-05-25 02:37:07.303 [reactor-http-nio-2] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.selectCount - <==      Total: 1
2025-05-25 02:37:07.360 [reactor-http-nio-2] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.selectCount - ==>  Preparing: SELECT COUNT( * ) AS total FROM usage_info WHERE (chat_completion_id = ?)
2025-05-25 02:37:07.360 [reactor-http-nio-2] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.selectCount - ==> Parameters: chat-e388a4cb-3a36-4a89-b9d1-a7648bf3b0dc(String)
2025-05-25 02:37:07.365 [reactor-http-nio-2] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.selectCount - <==      Total: 1
2025-05-25 02:37:07.369 [reactor-http-nio-2] DEBUG com.bgpay.bgai.mapper.UsageRecordMapper.insert - ==>  Preparing: INSERT INTO usage_record ( model_type, chat_completion_id, user_id, input_cost, output_cost, calculated_at, input_tokens, output_tokens, status, created_at ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-05-25 02:37:07.370 [reactor-http-nio-2] DEBUG com.bgpay.bgai.mapper.UsageRecordMapper.insert - ==> Parameters: deepseek-chat(String), chat-e388a4cb-3a36-4a89-b9d1-a7648bf3b0dc(String), 689258T(String), 0.030(BigDecimal), 1.152(BigDecimal), 2025-05-25T02:37:07.123437800(LocalDateTime), 30(Integer), 576(Integer), PENDING(String), 2025-05-25T02:37:07.365643200(LocalDateTime)
2025-05-25 02:37:07.475 [reactor-http-nio-2] ERROR com.bgpay.bgai.service.impl.UsageInfoServiceImpl - Failed to process usage info for completionId: chat-e388a4cb-3a36-4a89-b9d1-a7648bf3b0dc
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLException: Field 'price_version' doesn't have a default value
### The error may exist in com/bgpay/bgai/mapper/UsageRecordMapper.java (best guess)
### The error may involve com.bgpay.bgai.mapper.UsageRecordMapper.insert-Inline
### The error occurred while setting parameters
### SQL: INSERT INTO usage_record  ( model_type, chat_completion_id, user_id, input_cost, output_cost,  calculated_at,  input_tokens, output_tokens, status, created_at )  VALUES (  ?, ?, ?, ?, ?,  ?,  ?, ?, ?, ?  )
### Cause: java.sql.SQLException: Field 'price_version' doesn't have a default value
; Field 'price_version' doesn't have a default value
	at org.springframework.jdbc.support.SQLErrorCodeSQLExceptionTranslator.doTranslate(SQLErrorCodeSQLExceptionTranslator.java:258)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:73)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:92)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:439)
	at jdk.proxy2/jdk.proxy2.$Proxy156.insert(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.insert(SqlSessionTemplate.java:272)
	at com.baomidou.mybatisplus.core.override.MybatisMapperMethod.execute(MybatisMapperMethod.java:59)
	at com.baomidou.mybatisplus.core.override.MybatisMapperProxy$PlainMethodInvoker.invoke(MybatisMapperProxy.java:152)
	at com.baomidou.mybatisplus.core.override.MybatisMapperProxy.invoke(MybatisMapperProxy.java:89)
	at jdk.proxy2/jdk.proxy2.$Proxy184.insert(Unknown Source)
	at com.baomidou.mybatisplus.extension.service.IService.save(IService.java:60)
	at com.bgpay.bgai.service.impl.UsageRecordServiceImpl.insertUsageRecord(UsageRecordServiceImpl.java:31)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:343)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:751)
	at org.springframework.transaction.interceptor.TransactionInterceptor$1.proceedWithInvocation(TransactionInterceptor.java:123)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:391)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:751)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:703)
	at com.bgpay.bgai.service.impl.UsageRecordServiceImpl$$SpringCGLIB$$0.insertUsageRecord(<generated>)
	at com.bgpay.bgai.service.impl.UsageInfoServiceImpl.processUsageInfo(UsageInfoServiceImpl.java:81)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:343)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:751)
	at org.springframework.transaction.interceptor.TransactionInterceptor$1.proceedWithInvocation(TransactionInterceptor.java:123)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:391)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:751)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:703)
	at com.bgpay.bgai.service.impl.UsageInfoServiceImpl$$SpringCGLIB$$0.processUsageInfo(<generated>)
	at com.bgpay.bgai.service.mq.BillingTransactionListenerImpl.executeLocalTransaction(BillingTransactionListenerImpl.java:73)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:343)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:751)
	at org.springframework.aop.aspectj.AspectJAfterThrowingAdvice.invoke(AspectJAfterThrowingAdvice.java:64)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:173)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:751)
	at org.springframework.aop.framework.adapter.AfterReturningAdviceInterceptor.invoke(AfterReturningAdviceInterceptor.java:57)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:173)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:751)
	at org.springframework.aop.framework.adapter.MethodBeforeAdviceInterceptor.invoke(MethodBeforeAdviceInterceptor.java:58)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:173)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:751)
	at io.seata.spring.annotation.GlobalTransactionalInterceptor$2.execute(GlobalTransactionalInterceptor.java:208)
	at io.seata.tm.api.TransactionalTemplate.execute(TransactionalTemplate.java:128)
	at io.seata.spring.annotation.GlobalTransactionalInterceptor.handleGlobalTransaction(GlobalTransactionalInterceptor.java:205)
	at io.seata.spring.annotation.GlobalTransactionalInterceptor.invoke(GlobalTransactionalInterceptor.java:175)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:751)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:751)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:703)
	at com.bgpay.bgai.service.mq.BillingTransactionListenerImpl$$SpringCGLIB$$0.executeLocalTransaction(<generated>)
	at org.apache.rocketmq.spring.support.RocketMQUtil$1.executeLocalTransaction(RocketMQUtil.java:63)
	at org.apache.rocketmq.client.impl.producer.DefaultMQProducerImpl.sendMessageInTransaction(DefaultMQProducerImpl.java:1322)
	at org.apache.rocketmq.client.producer.TransactionMQProducer.sendMessageInTransaction(TransactionMQProducer.java:94)
	at org.apache.rocketmq.spring.core.RocketMQTemplate.sendMessageInTransaction(RocketMQTemplate.java:1183)
	at com.bgpay.bgai.service.mq.RocketMQProducerService.lambda$1(RocketMQProducerService.java:111)
	at reactor.core.publisher.MonoCallable.call(MonoCallable.java:72)
	at reactor.core.publisher.MonoCallableOnAssembly.call(MonoCallableOnAssembly.java:91)
	at reactor.core.publisher.MonoFlatMap$FlatMapMain.onNext(MonoFlatMap.java:146)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onNext(FluxOnAssembly.java:539)
	at reactor.core.publisher.FluxSubscribeOnCallable$CallableSubscribeOnSubscription.run(FluxSubscribeOnCallable.java:251)
	at reactor.core.scheduler.ImmediateScheduler.schedule(ImmediateScheduler.java:52)
	at reactor.core.publisher.MonoSubscribeOnCallable.subscribe(MonoSubscribeOnCallable.java:52)
	at reactor.core.publisher.InternalMonoOperator.subscribe(InternalMonoOperator.java:64)
	at reactor.core.publisher.FluxRetryWhen.subscribe(FluxRetryWhen.java:77)
	at reactor.core.publisher.MonoRetryWhen.subscribeOrReturn(MonoRetryWhen.java:46)
	at reactor.core.publisher.Mono.subscribe(Mono.java:4480)
	at reactor.core.publisher.Mono.subscribeWith(Mono.java:4561)
	at reactor.core.publisher.Mono.subscribe(Mono.java:4462)
	at reactor.core.publisher.Mono.subscribe(Mono.java:4398)
	at reactor.core.publisher.Mono.subscribe(Mono.java:4370)
	at com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.lambda$5(DeepSeekServiceImp.java:321)
	at reactor.core.publisher.MonoPeekTerminal$MonoTerminalPeekSubscriber.onNext(MonoPeekTerminal.java:171)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onNext(FluxOnAssembly.java:539)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onNext(FluxOnAssembly.java:539)
	at reactor.core.publisher.FluxOnErrorResume$ResumeSubscriber.onNext(FluxOnErrorResume.java:79)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onNext(FluxOnAssembly.java:539)
	at reactor.core.publisher.MonoFlatMap$FlatMapMain.secondComplete(MonoFlatMap.java:245)
	at reactor.core.publisher.MonoFlatMap$FlatMapInner.onNext(MonoFlatMap.java:305)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onNext(FluxOnAssembly.java:539)
	at reactor.core.publisher.FluxMap$MapSubscriber.onNext(FluxMap.java:122)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onNext(FluxOnAssembly.java:539)
	at reactor.core.publisher.MonoCallable$MonoCallableSubscription.request(MonoCallable.java:156)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.request(FluxOnAssembly.java:649)
	at reactor.core.publisher.FluxMap$MapSubscriber.request(FluxMap.java:164)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.request(FluxOnAssembly.java:649)
	at reactor.core.publisher.MonoFlatMap$FlatMapInner.onSubscribe(MonoFlatMap.java:291)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onSubscribe(FluxOnAssembly.java:633)
	at reactor.core.publisher.FluxMap$MapSubscriber.onSubscribe(FluxMap.java:92)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onSubscribe(FluxOnAssembly.java:633)
	at reactor.core.publisher.MonoCallable.subscribe(MonoCallable.java:48)
	at reactor.core.publisher.InternalMonoOperator.subscribe(InternalMonoOperator.java:64)
	at reactor.core.publisher.MonoFlatMap$FlatMapMain.onNext(MonoFlatMap.java:165)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onNext(FluxOnAssembly.java:539)
	at reactor.core.publisher.SerializedSubscriber.onNext(SerializedSubscriber.java:99)
	at reactor.core.publisher.FluxRetryWhen$RetryWhenMainSubscriber.onNext(FluxRetryWhen.java:174)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onNext(FluxOnAssembly.java:539)
	at reactor.core.publisher.SerializedSubscriber.onNext(SerializedSubscriber.java:99)
	at reactor.core.publisher.FluxTimeout$TimeoutMainSubscriber.onNext(FluxTimeout.java:180)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onNext(FluxOnAssembly.java:539)
	at reactor.core.publisher.MonoFlatMap$FlatMapMain.secondComplete(MonoFlatMap.java:245)
	at reactor.core.publisher.MonoFlatMap$FlatMapInner.onNext(MonoFlatMap.java:305)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onNext(FluxOnAssembly.java:539)
	at reactor.core.publisher.FluxOnErrorResume$ResumeSubscriber.onNext(FluxOnErrorResume.java:79)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onNext(FluxOnAssembly.java:539)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onNext(FluxOnAssembly.java:539)
	at reactor.core.publisher.FluxMapFuseable$MapFuseableSubscriber.onNext(FluxMapFuseable.java:129)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onNext(FluxOnAssembly.java:539)
	at reactor.core.publisher.FluxContextWrite$ContextWriteSubscriber.onNext(FluxContextWrite.java:107)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onNext(FluxOnAssembly.java:539)
	at reactor.core.publisher.FluxMapFuseable$MapFuseableConditionalSubscriber.onNext(FluxMapFuseable.java:299)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onNext(FluxOnAssembly.java:539)
	at reactor.core.publisher.FluxFilterFuseable$FilterFuseableConditionalSubscriber.onNext(FluxFilterFuseable.java:337)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onNext(FluxOnAssembly.java:539)
	at reactor.core.publisher.Operators$BaseFluxToMonoOperator.completePossiblyEmpty(Operators.java:2071)
	at reactor.core.publisher.MonoCollect$CollectSubscriber.onComplete(MonoCollect.java:145)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onComplete(FluxOnAssembly.java:549)
	at reactor.core.publisher.FluxMapFuseable$MapFuseableSubscriber.onComplete(FluxMapFuseable.java:152)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onComplete(FluxOnAssembly.java:549)
	at reactor.core.publisher.FluxPeekFuseable$PeekFuseableSubscriber.onComplete(FluxPeekFuseable.java:277)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onComplete(FluxOnAssembly.java:549)
	at reactor.core.publisher.FluxMap$MapSubscriber.onComplete(FluxMap.java:144)
	at reactor.netty.channel.FluxReceive.onInboundComplete(FluxReceive.java:413)
	at reactor.netty.channel.ChannelOperations.onInboundComplete(ChannelOperations.java:444)
	at reactor.netty.channel.ChannelOperations.terminate(ChannelOperations.java:498)
	at reactor.netty.http.client.HttpClientOperations.onInboundNext(HttpClientOperations.java:753)
	at reactor.netty.channel.ChannelOperationsHandler.channelRead(ChannelOperationsHandler.java:114)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:444)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)
	at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412)
	at io.netty.handler.codec.MessageToMessageDecoder.channelRead(MessageToMessageDecoder.java:103)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:444)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)
	at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412)
	at io.netty.channel.CombinedChannelDuplexHandler$DelegatingChannelHandlerContext.fireChannelRead(CombinedChannelDuplexHandler.java:436)
	at io.netty.handler.codec.ByteToMessageDecoder.fireChannelRead(ByteToMessageDecoder.java:346)
	at io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:318)
	at io.netty.channel.CombinedChannelDuplexHandler.channelRead(CombinedChannelDuplexHandler.java:251)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:442)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)
	at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412)
	at io.netty.handler.ssl.SslHandler.unwrap(SslHandler.java:1471)
	at io.netty.handler.ssl.SslHandler.decodeJdkCompatible(SslHandler.java:1334)
	at io.netty.handler.ssl.SslHandler.decode(SslHandler.java:1383)
	at io.netty.handler.codec.ByteToMessageDecoder.decodeRemovalReentryProtection(ByteToMessageDecoder.java:529)
	at io.netty.handler.codec.ByteToMessageDecoder.callDecode(ByteToMessageDecoder.java:468)
	at io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:290)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:444)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)
	at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412)
	at io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1410)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:440)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)
	at io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:919)
	at io.netty.channel.nio.AbstractNioByteChannel$NioByteUnsafe.read(AbstractNioByteChannel.java:166)
	at io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:788)
	at io.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:724)
	at io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:650)
	at io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:562)
	at io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:997)
	at io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.base/java.lang.Thread.run(Thread.java:1583)
Caused by: java.sql.SQLException: Field 'price_version' doesn't have a default value
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:130)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:916)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:354)
	at com.alibaba.druid.pool.DruidPooledPreparedStatement.execute(DruidPooledPreparedStatement.java:497)
	at io.seata.rm.datasource.PreparedStatementProxy.lambda$execute$0(PreparedStatementProxy.java:55)
	at io.seata.rm.datasource.exec.AbstractDMLBaseExecutor.executeAutoCommitFalse(AbstractDMLBaseExecutor.java:99)
	at io.seata.rm.datasource.exec.AbstractDMLBaseExecutor.doExecute(AbstractDMLBaseExecutor.java:85)
	at io.seata.rm.datasource.exec.BaseTransactionalExecutor.execute(BaseTransactionalExecutor.java:125)
	at io.seata.rm.datasource.exec.ExecuteTemplate.execute(ExecuteTemplate.java:137)
	at io.seata.rm.datasource.exec.ExecuteTemplate.execute(ExecuteTemplate.java:56)
	at io.seata.rm.datasource.PreparedStatementProxy.execute(PreparedStatementProxy.java:55)
	at io.seata.rm.datasource.PreparedStatementProxy.lambda$execute$0(PreparedStatementProxy.java:55)
	at io.seata.rm.datasource.exec.AbstractDMLBaseExecutor.executeAutoCommitFalse(AbstractDMLBaseExecutor.java:99)
	at io.seata.rm.datasource.exec.AbstractDMLBaseExecutor.doExecute(AbstractDMLBaseExecutor.java:85)
	at io.seata.rm.datasource.exec.BaseTransactionalExecutor.execute(BaseTransactionalExecutor.java:125)
	at io.seata.rm.datasource.exec.ExecuteTemplate.execute(ExecuteTemplate.java:137)
	at io.seata.rm.datasource.exec.ExecuteTemplate.execute(ExecuteTemplate.java:56)
	at io.seata.rm.datasource.PreparedStatementProxy.execute(PreparedStatementProxy.java:55)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:58)
	at jdk.proxy3/jdk.proxy3.$Proxy162.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:48)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:75)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.insert(DefaultSqlSession.java:184)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:425)
	... 174 common frames omitted
2025-05-25 02:37:07.489 [reactor-http-nio-2] ERROR c.b.bgai.service.mq.BillingTransactionListenerImpl - 本地事务执行异常，回滚事务, xid: seata-server:8091:153776404394049592, completionId: chat-e388a4cb-3a36-4a89-b9d1-a7648bf3b0dc
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLException: Field 'price_version' doesn't have a default value
### The error may exist in com/bgpay/bgai/mapper/UsageRecordMapper.java (best guess)
### The error may involve com.bgpay.bgai.mapper.UsageRecordMapper.insert-Inline
### The error occurred while setting parameters
### SQL: INSERT INTO usage_record  ( model_type, chat_completion_id, user_id, input_cost, output_cost,  calculated_at,  input_tokens, output_tokens, status, created_at )  VALUES (  ?, ?, ?, ?, ?,  ?,  ?, ?, ?, ?  )
### Cause: java.sql.SQLException: Field 'price_version' doesn't have a default value
; Field 'price_version' doesn't have a default value
	at org.springframework.jdbc.support.SQLErrorCodeSQLExceptionTranslator.doTranslate(SQLErrorCodeSQLExceptionTranslator.java:258)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:73)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:92)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:439)
	at jdk.proxy2/jdk.proxy2.$Proxy156.insert(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.insert(SqlSessionTemplate.java:272)
	at com.baomidou.mybatisplus.core.override.MybatisMapperMethod.execute(MybatisMapperMethod.java:59)
	at com.baomidou.mybatisplus.core.override.MybatisMapperProxy$PlainMethodInvoker.invoke(MybatisMapperProxy.java:152)
	at com.baomidou.mybatisplus.core.override.MybatisMapperProxy.invoke(MybatisMapperProxy.java:89)
	at jdk.proxy2/jdk.proxy2.$Proxy184.insert(Unknown Source)
	at com.baomidou.mybatisplus.extension.service.IService.save(IService.java:60)
	at com.bgpay.bgai.service.impl.UsageRecordServiceImpl.insertUsageRecord(UsageRecordServiceImpl.java:31)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:343)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:751)
	at org.springframework.transaction.interceptor.TransactionInterceptor$1.proceedWithInvocation(TransactionInterceptor.java:123)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:391)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:751)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:703)
	at com.bgpay.bgai.service.impl.UsageRecordServiceImpl$$SpringCGLIB$$0.insertUsageRecord(<generated>)
	at com.bgpay.bgai.service.impl.UsageInfoServiceImpl.processUsageInfo(UsageInfoServiceImpl.java:81)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:343)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:751)
	at org.springframework.transaction.interceptor.TransactionInterceptor$1.proceedWithInvocation(TransactionInterceptor.java:123)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:391)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:751)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:703)
	at com.bgpay.bgai.service.impl.UsageInfoServiceImpl$$SpringCGLIB$$0.processUsageInfo(<generated>)
	at com.bgpay.bgai.service.mq.BillingTransactionListenerImpl.executeLocalTransaction(BillingTransactionListenerImpl.java:73)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:343)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:751)
	at org.springframework.aop.aspectj.AspectJAfterThrowingAdvice.invoke(AspectJAfterThrowingAdvice.java:64)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:173)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:751)
	at org.springframework.aop.framework.adapter.AfterReturningAdviceInterceptor.invoke(AfterReturningAdviceInterceptor.java:57)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:173)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:751)
	at org.springframework.aop.framework.adapter.MethodBeforeAdviceInterceptor.invoke(MethodBeforeAdviceInterceptor.java:58)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:173)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:751)
	at io.seata.spring.annotation.GlobalTransactionalInterceptor$2.execute(GlobalTransactionalInterceptor.java:208)
	at io.seata.tm.api.TransactionalTemplate.execute(TransactionalTemplate.java:128)
	at io.seata.spring.annotation.GlobalTransactionalInterceptor.handleGlobalTransaction(GlobalTransactionalInterceptor.java:205)
	at io.seata.spring.annotation.GlobalTransactionalInterceptor.invoke(GlobalTransactionalInterceptor.java:175)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:751)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:751)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:703)
	at com.bgpay.bgai.service.mq.BillingTransactionListenerImpl$$SpringCGLIB$$0.executeLocalTransaction(<generated>)
	at org.apache.rocketmq.spring.support.RocketMQUtil$1.executeLocalTransaction(RocketMQUtil.java:63)
	at org.apache.rocketmq.client.impl.producer.DefaultMQProducerImpl.sendMessageInTransaction(DefaultMQProducerImpl.java:1322)
	at org.apache.rocketmq.client.producer.TransactionMQProducer.sendMessageInTransaction(TransactionMQProducer.java:94)
	at org.apache.rocketmq.spring.core.RocketMQTemplate.sendMessageInTransaction(RocketMQTemplate.java:1183)
	at com.bgpay.bgai.service.mq.RocketMQProducerService.lambda$1(RocketMQProducerService.java:111)
	at reactor.core.publisher.MonoCallable.call(MonoCallable.java:72)
	at reactor.core.publisher.MonoCallableOnAssembly.call(MonoCallableOnAssembly.java:91)
	at reactor.core.publisher.MonoFlatMap$FlatMapMain.onNext(MonoFlatMap.java:146)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onNext(FluxOnAssembly.java:539)
	at reactor.core.publisher.FluxSubscribeOnCallable$CallableSubscribeOnSubscription.run(FluxSubscribeOnCallable.java:251)
	at reactor.core.scheduler.ImmediateScheduler.schedule(ImmediateScheduler.java:52)
	at reactor.core.publisher.MonoSubscribeOnCallable.subscribe(MonoSubscribeOnCallable.java:52)
	at reactor.core.publisher.InternalMonoOperator.subscribe(InternalMonoOperator.java:64)
	at reactor.core.publisher.FluxRetryWhen.subscribe(FluxRetryWhen.java:77)
	at reactor.core.publisher.MonoRetryWhen.subscribeOrReturn(MonoRetryWhen.java:46)
	at reactor.core.publisher.Mono.subscribe(Mono.java:4480)
	at reactor.core.publisher.Mono.subscribeWith(Mono.java:4561)
	at reactor.core.publisher.Mono.subscribe(Mono.java:4462)
	at reactor.core.publisher.Mono.subscribe(Mono.java:4398)
	at reactor.core.publisher.Mono.subscribe(Mono.java:4370)
	at com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.lambda$5(DeepSeekServiceImp.java:321)
	at reactor.core.publisher.MonoPeekTerminal$MonoTerminalPeekSubscriber.onNext(MonoPeekTerminal.java:171)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onNext(FluxOnAssembly.java:539)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onNext(FluxOnAssembly.java:539)
	at reactor.core.publisher.FluxOnErrorResume$ResumeSubscriber.onNext(FluxOnErrorResume.java:79)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onNext(FluxOnAssembly.java:539)
	at reactor.core.publisher.MonoFlatMap$FlatMapMain.secondComplete(MonoFlatMap.java:245)
	at reactor.core.publisher.MonoFlatMap$FlatMapInner.onNext(MonoFlatMap.java:305)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onNext(FluxOnAssembly.java:539)
	at reactor.core.publisher.FluxMap$MapSubscriber.onNext(FluxMap.java:122)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onNext(FluxOnAssembly.java:539)
	at reactor.core.publisher.MonoCallable$MonoCallableSubscription.request(MonoCallable.java:156)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.request(FluxOnAssembly.java:649)
	at reactor.core.publisher.FluxMap$MapSubscriber.request(FluxMap.java:164)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.request(FluxOnAssembly.java:649)
	at reactor.core.publisher.MonoFlatMap$FlatMapInner.onSubscribe(MonoFlatMap.java:291)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onSubscribe(FluxOnAssembly.java:633)
	at reactor.core.publisher.FluxMap$MapSubscriber.onSubscribe(FluxMap.java:92)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onSubscribe(FluxOnAssembly.java:633)
	at reactor.core.publisher.MonoCallable.subscribe(MonoCallable.java:48)
	at reactor.core.publisher.InternalMonoOperator.subscribe(InternalMonoOperator.java:64)
	at reactor.core.publisher.MonoFlatMap$FlatMapMain.onNext(MonoFlatMap.java:165)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onNext(FluxOnAssembly.java:539)
	at reactor.core.publisher.SerializedSubscriber.onNext(SerializedSubscriber.java:99)
	at reactor.core.publisher.FluxRetryWhen$RetryWhenMainSubscriber.onNext(FluxRetryWhen.java:174)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onNext(FluxOnAssembly.java:539)
	at reactor.core.publisher.SerializedSubscriber.onNext(SerializedSubscriber.java:99)
	at reactor.core.publisher.FluxTimeout$TimeoutMainSubscriber.onNext(FluxTimeout.java:180)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onNext(FluxOnAssembly.java:539)
	at reactor.core.publisher.MonoFlatMap$FlatMapMain.secondComplete(MonoFlatMap.java:245)
	at reactor.core.publisher.MonoFlatMap$FlatMapInner.onNext(MonoFlatMap.java:305)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onNext(FluxOnAssembly.java:539)
	at reactor.core.publisher.FluxOnErrorResume$ResumeSubscriber.onNext(FluxOnErrorResume.java:79)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onNext(FluxOnAssembly.java:539)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onNext(FluxOnAssembly.java:539)
	at reactor.core.publisher.FluxMapFuseable$MapFuseableSubscriber.onNext(FluxMapFuseable.java:129)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onNext(FluxOnAssembly.java:539)
	at reactor.core.publisher.FluxContextWrite$ContextWriteSubscriber.onNext(FluxContextWrite.java:107)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onNext(FluxOnAssembly.java:539)
	at reactor.core.publisher.FluxMapFuseable$MapFuseableConditionalSubscriber.onNext(FluxMapFuseable.java:299)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onNext(FluxOnAssembly.java:539)
	at reactor.core.publisher.FluxFilterFuseable$FilterFuseableConditionalSubscriber.onNext(FluxFilterFuseable.java:337)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onNext(FluxOnAssembly.java:539)
	at reactor.core.publisher.Operators$BaseFluxToMonoOperator.completePossiblyEmpty(Operators.java:2071)
	at reactor.core.publisher.MonoCollect$CollectSubscriber.onComplete(MonoCollect.java:145)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onComplete(FluxOnAssembly.java:549)
	at reactor.core.publisher.FluxMapFuseable$MapFuseableSubscriber.onComplete(FluxMapFuseable.java:152)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onComplete(FluxOnAssembly.java:549)
	at reactor.core.publisher.FluxPeekFuseable$PeekFuseableSubscriber.onComplete(FluxPeekFuseable.java:277)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onComplete(FluxOnAssembly.java:549)
	at reactor.core.publisher.FluxMap$MapSubscriber.onComplete(FluxMap.java:144)
	at reactor.netty.channel.FluxReceive.onInboundComplete(FluxReceive.java:413)
	at reactor.netty.channel.ChannelOperations.onInboundComplete(ChannelOperations.java:444)
	at reactor.netty.channel.ChannelOperations.terminate(ChannelOperations.java:498)
	at reactor.netty.http.client.HttpClientOperations.onInboundNext(HttpClientOperations.java:753)
	at reactor.netty.channel.ChannelOperationsHandler.channelRead(ChannelOperationsHandler.java:114)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:444)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)
	at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412)
	at io.netty.handler.codec.MessageToMessageDecoder.channelRead(MessageToMessageDecoder.java:103)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:444)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)
	at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412)
	at io.netty.channel.CombinedChannelDuplexHandler$DelegatingChannelHandlerContext.fireChannelRead(CombinedChannelDuplexHandler.java:436)
	at io.netty.handler.codec.ByteToMessageDecoder.fireChannelRead(ByteToMessageDecoder.java:346)
	at io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:318)
	at io.netty.channel.CombinedChannelDuplexHandler.channelRead(CombinedChannelDuplexHandler.java:251)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:442)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)
	at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412)
	at io.netty.handler.ssl.SslHandler.unwrap(SslHandler.java:1471)
	at io.netty.handler.ssl.SslHandler.decodeJdkCompatible(SslHandler.java:1334)
	at io.netty.handler.ssl.SslHandler.decode(SslHandler.java:1383)
	at io.netty.handler.codec.ByteToMessageDecoder.decodeRemovalReentryProtection(ByteToMessageDecoder.java:529)
	at io.netty.handler.codec.ByteToMessageDecoder.callDecode(ByteToMessageDecoder.java:468)
	at io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:290)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:444)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)
	at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412)
	at io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1410)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:440)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)
	at io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:919)
	at io.netty.channel.nio.AbstractNioByteChannel$NioByteUnsafe.read(AbstractNioByteChannel.java:166)
	at io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:788)
	at io.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:724)
	at io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:650)
	at io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:562)
	at io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:997)
	at io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.base/java.lang.Thread.run(Thread.java:1583)
Caused by: java.sql.SQLException: Field 'price_version' doesn't have a default value
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:130)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:916)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:354)
	at com.alibaba.druid.pool.DruidPooledPreparedStatement.execute(DruidPooledPreparedStatement.java:497)
	at io.seata.rm.datasource.PreparedStatementProxy.lambda$execute$0(PreparedStatementProxy.java:55)
	at io.seata.rm.datasource.exec.AbstractDMLBaseExecutor.executeAutoCommitFalse(AbstractDMLBaseExecutor.java:99)
	at io.seata.rm.datasource.exec.AbstractDMLBaseExecutor.doExecute(AbstractDMLBaseExecutor.java:85)
	at io.seata.rm.datasource.exec.BaseTransactionalExecutor.execute(BaseTransactionalExecutor.java:125)
	at io.seata.rm.datasource.exec.ExecuteTemplate.execute(ExecuteTemplate.java:137)
	at io.seata.rm.datasource.exec.ExecuteTemplate.execute(ExecuteTemplate.java:56)
	at io.seata.rm.datasource.PreparedStatementProxy.execute(PreparedStatementProxy.java:55)
	at io.seata.rm.datasource.PreparedStatementProxy.lambda$execute$0(PreparedStatementProxy.java:55)
	at io.seata.rm.datasource.exec.AbstractDMLBaseExecutor.executeAutoCommitFalse(AbstractDMLBaseExecutor.java:99)
	at io.seata.rm.datasource.exec.AbstractDMLBaseExecutor.doExecute(AbstractDMLBaseExecutor.java:85)
	at io.seata.rm.datasource.exec.BaseTransactionalExecutor.execute(BaseTransactionalExecutor.java:125)
	at io.seata.rm.datasource.exec.ExecuteTemplate.execute(ExecuteTemplate.java:137)
	at io.seata.rm.datasource.exec.ExecuteTemplate.execute(ExecuteTemplate.java:56)
	at io.seata.rm.datasource.PreparedStatementProxy.execute(PreparedStatementProxy.java:55)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:58)
	at jdk.proxy3/jdk.proxy3.$Proxy162.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:48)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:75)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.insert(DefaultSqlSession.java:184)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:425)
	... 174 common frames omitted
2025-05-25 02:37:07.491 [reactor-http-nio-2] INFO  com.bgpay.bgai.transaction.TransactionCoordinator - Compensating transaction for user 689258T: chatCompletionId=chat-e388a4cb-3a36-4a89-b9d1-a7648bf3b0dc
2025-05-25 02:37:07.516 [reactor-http-nio-2] INFO  c.b.bgai.service.impl.TransactionLogServiceImpl - 记录分布式事务结束: XID=seata-server:8091:153776404394049592, 状态=COMMITTED
2025-05-25 02:37:07.518 [reactor-http-nio-2] DEBUG c.b.bgai.mapper.TransactionLogMapper.selectList - ==>  Preparing: SELECT id,xid,branch_id,transaction_name,transaction_mode,status,request_path,source_ip,start_time,end_time,user_id,extra_data,create_time,update_time FROM transaction_log WHERE (xid = ?) LIMIT 1
2025-05-25 02:37:07.519 [reactor-http-nio-2] DEBUG c.b.bgai.mapper.TransactionLogMapper.selectList - ==> Parameters: seata-server:8091:153776404394049592(String)
2025-05-25 02:37:07.525 [reactor-http-nio-2] DEBUG c.b.bgai.mapper.TransactionLogMapper.selectList - <==      Total: 1
2025-05-25 02:37:07.527 [reactor-http-nio-2] DEBUG c.b.bgai.mapper.TransactionLogMapper.updateById - ==>  Preparing: UPDATE transaction_log SET xid=?, transaction_name=?, transaction_mode=?, status=?, request_path=?, source_ip=?, start_time=?, end_time=?, user_id=?, extra_data=?, create_time=?, update_time=? WHERE id=?
2025-05-25 02:37:07.529 [reactor-http-nio-2] DEBUG c.b.bgai.mapper.TransactionLogMapper.updateById - ==> Parameters: seata-server:8091:153776404394049592(String), com.bgpay.bgai.service.mq.BillingTransactionListenerImpl.executeLocalTransaction(String), AT(String), COMMITTED(String), (String), (String), 2025-05-25T02:37:07(LocalDateTime), 2025-05-25T02:37:07.526812400(LocalDateTime), system(String), {"duration":229,"result":"success"}(String), 2025-05-25T02:37:07(LocalDateTime), 2025-05-25T02:37:07.526812400(LocalDateTime), 42(Long)
2025-05-25 02:37:07.596 [reactor-http-nio-2] DEBUG c.b.bgai.mapper.TransactionLogMapper.updateById - <==    Updates: 1
2025-05-25 02:37:07.607 [reactor-http-nio-2] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:153776404394049592, branchId:153776404394049595, lockKeys:transaction_log:42
2025-05-25 02:37:07.630 [reactor-http-nio-2] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:153776404394049592, branchId:153776404394049596, lockKeys:undo_log:167;transaction_log:42
2025-05-25 02:37:07.652 [reactor-http-nio-2] INFO  c.b.bgai.interceptor.SeataTransactionInterceptor - 分布式事务成功完成: XID=seata-server:8091:153776404394049592, 耗时=229ms
2025-05-25 02:37:07.652 [reactor-http-nio-2] INFO  io.seata.tm.api.DefaultGlobalTransaction - transaction seata-server:8091:153776404394049592 will be commit
2025-05-25 02:37:07.661 [reactor-http-nio-2] INFO  io.seata.tm.api.DefaultGlobalTransaction - transaction end, xid = seata-server:8091:153776404394049592
2025-05-25 02:37:07.661 [reactor-http-nio-2] INFO  io.seata.tm.api.DefaultGlobalTransaction - [seata-server:8091:153776404394049592] commit status: Committed
2025-05-25 02:37:07.664 [reactor-http-nio-2] INFO  org.reflections.Reflections - 账单消息发送成功，chatCompletionId: chat-e388a4cb-3a36-4a89-b9d1-a7648bf3b0dc, userId: 689258T
2025-05-25 02:37:07.670 [reactor-http-nio-2] INFO  com.bgpay.bgai.service.impl.BGAIServiceImpl - 执行第一步操作 - 发送账单消息, businessKey: 689258T:chat-e388a4cb-3a36-4a89-b9d1-a7648bf3b0dc
2025-05-25 02:37:07.671 [reactor-http-nio-2] DEBUG c.bgpay.bgai.mapper.UsageRecordMapper.selectCount - ==>  Preparing: SELECT COUNT( * ) AS total FROM usage_record WHERE (chat_completion_id = ?)
2025-05-25 02:37:07.671 [reactor-http-nio-2] DEBUG c.bgpay.bgai.mapper.UsageRecordMapper.selectCount - ==> Parameters: chat-e388a4cb-3a36-4a89-b9d1-a7648bf3b0dc(String)
2025-05-25 02:37:07.679 [reactor-http-nio-2] DEBUG c.bgpay.bgai.mapper.UsageRecordMapper.selectCount - <==      Total: 1
2025-05-25 02:37:07.696 [reactor-http-nio-2] DEBUG c.bgpay.bgai.mapper.UsageRecordMapper.selectList - ==>  Preparing: SELECT id,model_type,chat_completion_id,user_id,input_cost,output_cost,price_version,calculated_at,message_id,input_tokens,output_tokens,status,created_at,updated_at FROM usage_record WHERE (chat_completion_id = ?)
2025-05-25 02:37:07.696 [reactor-http-nio-2] DEBUG c.bgpay.bgai.mapper.UsageRecordMapper.selectList - ==> Parameters: chat-e388a4cb-3a36-4a89-b9d1-a7648bf3b0dc(String)
2025-05-25 02:37:07.701 [reactor-http-nio-2] DEBUG c.bgpay.bgai.mapper.UsageRecordMapper.selectList - <==      Total: 0
2025-05-25 02:37:07.710 [reactor-http-nio-2] ERROR com.bgpay.bgai.service.impl.BGAIServiceImpl - 未找到计费数据, completionId: chat-e388a4cb-3a36-4a89-b9d1-a7648bf3b0dc
2025-05-25 02:37:07.719 [reactor-http-nio-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - Processed response for user 689258T, content length: 2008
2025-05-25 02:37:07.764 [rpcDispatch_RMROLE_1_5_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:153776404394049592', branchId=153776404394049593, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false,"skipCheckLock":true}'}
2025-05-25 02:37:07.764 [rpcDispatch_RMROLE_1_5_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:153776404394049592 153776404394049593 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false,"skipCheckLock":true}
2025-05-25 02:37:07.764 [rpcDispatch_RMROLE_1_5_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-25 02:37:07.782 [rpcDispatch_RMROLE_1_6_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:153776404394049592', branchId=153776404394049594, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false,"skipCheckLock":true}'}
2025-05-25 02:37:07.783 [rpcDispatch_RMROLE_1_6_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:153776404394049592 153776404394049594 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false,"skipCheckLock":true}
2025-05-25 02:37:07.783 [rpcDispatch_RMROLE_1_6_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-25 02:37:07.791 [rpcDispatch_RMROLE_1_7_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:153776404394049592', branchId=153776404394049595, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false}'}
2025-05-25 02:37:07.791 [rpcDispatch_RMROLE_1_7_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:153776404394049592 153776404394049595 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false}
2025-05-25 02:37:07.791 [rpcDispatch_RMROLE_1_7_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-25 02:37:07.798 [rpcDispatch_RMROLE_1_8_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:153776404394049592', branchId=153776404394049596, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false}'}
2025-05-25 02:37:07.799 [rpcDispatch_RMROLE_1_8_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:153776404394049592 153776404394049596 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false}
2025-05-25 02:37:07.799 [rpcDispatch_RMROLE_1_8_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-25 02:37:59.438 [Thread-1] WARN  c.alibaba.nacos.common.http.HttpClientBeanHolder - [HttpClientBeanHolder] Start destroying common HttpClient
2025-05-25 02:37:59.438 [Thread-7] WARN  com.alibaba.nacos.common.notify.NotifyCenter - [NotifyCenter] Start destroying Publisher
2025-05-25 02:37:59.439 [Thread-7] WARN  com.alibaba.nacos.common.notify.NotifyCenter - [NotifyCenter] Destruction of the end
2025-05-25 02:37:59.440 [Thread-1] WARN  c.alibaba.nacos.common.http.HttpClientBeanHolder - [HttpClientBeanHolder] Destruction of the end
2025-05-25 02:37:59.468 [SpringApplicationShutdownHook] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - De-registering from Nacos Server now...
2025-05-25 02:37:59.469 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - [DEREGISTER-SERVICE] d750d92e-152f-4055-a641-3bc9dda85a29 deregistering service bgtech-ai with instance: Instance{instanceId='null', ip='192.168.86.8', port=8080, weight=1.0, healthy=true, enabled=true, ephemeral=true, clusterName='DEFAULT', serviceName='null', metadata={}}
2025-05-25 02:37:59.482 [SpringApplicationShutdownHook] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - De-registration finished.
2025-05-25 02:37:59.484 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.cache.ServiceInfoHolder do shutdown begin
2025-05-25 02:37:59.484 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.backups.FailoverReactor do shutdown begin
2025-05-25 02:37:59.484 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.backups.FailoverReactor do shutdown stop
2025-05-25 02:37:59.484 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.cache.ServiceInfoHolder do shutdown stop
2025-05-25 02:37:59.484 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.NamingClientProxyDelegate do shutdown begin
2025-05-25 02:37:59.484 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServiceInfoUpdateService do shutdown begin
2025-05-25 02:37:59.484 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServiceInfoUpdateService do shutdown stop
2025-05-25 02:37:59.484 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServerListManager do shutdown begin
2025-05-25 02:37:59.484 [SpringApplicationShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Start destroying NacosRestTemplate
2025-05-25 02:37:59.484 [SpringApplicationShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Destruction of the end
2025-05-25 02:37:59.484 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServerListManager do shutdown stop
2025-05-25 02:37:59.484 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.http.NamingHttpClientProxy do shutdown begin
2025-05-25 02:37:59.484 [SpringApplicationShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Start destroying NacosRestTemplate
2025-05-25 02:37:59.484 [SpringApplicationShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Destruction of the end
2025-05-25 02:37:59.484 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.http.NamingHttpClientProxy do shutdown stop
2025-05-25 02:37:59.484 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Shutdown rpc client, set status to shutdown
2025-05-25 02:37:59.484 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Shutdown client event executor java.util.concurrent.ScheduledThreadPoolExecutor@7c018b33[Running, pool size = 2, active threads = 2, queued tasks = 0, completed tasks = 0]
2025-05-25 02:37:59.485 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Close current connection 1748111791730_139.227.195.192_49500
2025-05-25 02:37:59.489 [nacos-grpc-client-executor-8.133.246.113-28] WARN  c.a.nacos.common.remote.client.grpc.GrpcClient - [1748111791730_139.227.195.192_49500]Ignore error event,isRunning:false,isAbandon=false
2025-05-25 02:37:59.492 [SpringApplicationShutdownHook] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - Shutdown grpc executor java.util.concurrent.ThreadPoolExecutor@2a97559f[Running, pool size = 5, active threads = 0, queued tasks = 0, completed tasks = 29]
2025-05-25 02:37:59.492 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - Shutdown grpc redo service executor java.util.concurrent.ScheduledThreadPoolExecutor@356e71a4[Running, pool size = 1, active threads = 0, queued tasks = 1, completed tasks = 29]
2025-05-25 02:37:59.492 [SpringApplicationShutdownHook] INFO  c.a.n.client.auth.ram.identify.CredentialWatcher - [null] CredentialWatcher is stopped
2025-05-25 02:37:59.492 [SpringApplicationShutdownHook] INFO  c.a.n.client.auth.ram.identify.CredentialService - [null] CredentialService is freed
2025-05-25 02:37:59.493 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.NamingClientProxyDelegate do shutdown stop
2025-05-25 02:37:59.502 [SpringApplicationShutdownHook] DEBUG com.bgpay.bgai.config.AsyncConfig$1 - Shutting down ExecutorService 'blockingExecutor'
2025-05-25 02:38:01.579 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:10911] result: true
2025-05-25 02:38:01.579 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:9876] result: true
2025-05-25 02:38:01.602 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:10911] result: true
2025-05-25 02:38:01.602 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:9876] result: true
2025-05-25 02:38:01.714 [SpringApplicationShutdownHook] INFO  o.s.orm.jpa.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-05-25 02:38:01.716 [SpringApplicationShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-2} closing ...
2025-05-25 02:38:01.721 [SpringApplicationShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-2} closed
2025-05-25 02:38:01.721 [SpringApplicationShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} closing ...
2025-05-25 02:38:01.722 [SpringApplicationShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} closed
2025-05-25 02:38:01.722 [NettyClientSelector_TMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - channel inactive: [id: 0xdfc0e432, L:/192.168.86.8:59424 ! R:/8.133.246.113:8091]
2025-05-25 02:38:01.722 [NettyClientSelector_TMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - return to pool, rm channel:[id: 0xdfc0e432, L:/192.168.86.8:59424 ! R:/8.133.246.113:8091]
2025-05-25 02:38:01.722 [NettyClientSelector_TMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - channel valid false,channel:[id: 0xdfc0e432, L:/192.168.86.8:59424 ! R:/8.133.246.113:8091]
2025-05-25 02:38:01.722 [NettyClientSelector_TMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - will destroy channel:[id: 0xdfc0e432, L:/192.168.86.8:59424 ! R:/8.133.246.113:8091]
2025-05-25 02:38:01.723 [NettyClientSelector_TMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0xdfc0e432, L:/192.168.86.8:59424 ! R:/8.133.246.113:8091]) will closed
2025-05-25 02:38:01.723 [NettyClientSelector_TMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0xdfc0e432, L:/192.168.86.8:59424 ! R:/8.133.246.113:8091]) will closed
2025-05-25 02:38:01.724 [NettyClientSelector_RMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - channel inactive: [id: 0x693bc0e7, L:/192.168.86.8:59427 ! R:/8.133.246.113:8091]
2025-05-25 02:38:01.724 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - return to pool, rm channel:[id: 0x693bc0e7, L:/192.168.86.8:59427 ! R:/8.133.246.113:8091]
2025-05-25 02:38:01.724 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - channel valid false,channel:[id: 0x693bc0e7, L:/192.168.86.8:59427 ! R:/8.133.246.113:8091]
2025-05-25 02:38:01.724 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - will destroy channel:[id: 0x693bc0e7, L:/192.168.86.8:59427 ! R:/8.133.246.113:8091]
2025-05-25 02:38:01.724 [NettyClientSelector_RMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0x693bc0e7, L:/192.168.86.8:59427 ! R:/8.133.246.113:8091]) will closed
2025-05-25 02:38:01.724 [NettyClientSelector_RMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0x693bc0e7, L:/192.168.86.8:59427 ! R:/8.133.246.113:8091]) will closed
2025-05-25 02:39:36.693 [main] WARN  com.alibaba.nacos.client.logging.NacosLogging - Load Logback Configuration of Nacos fail, message: Could not initialize Logback Nacos logging from classpath:nacos-logback.xml
2025-05-25 02:39:36.694 [main] INFO  com.bgpay.bgai.BgaiApplication - The following 1 profile is active: "dev"
2025-05-25 02:39:38.056 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-05-25 02:39:38.058 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-05-25 02:39:38.081 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 17 ms. Found 0 JPA repository interfaces.
2025-05-25 02:39:38.095 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-05-25 02:39:38.096 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-05-25 02:39:38.108 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 4 ms. Found 0 Redis repository interfaces.
2025-05-25 02:39:38.796 [main] INFO  io.seata.config.ConfigurationFactory - load Configuration from :Spring Configuration
2025-05-25 02:39:38.805 [main] INFO  io.seata.config.ConfigurationFactory - load Configuration from :Spring Configuration
2025-05-25 02:39:38.812 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Initializing Global Transaction Clients ... 
2025-05-25 02:39:38.930 [main] INFO  io.seata.core.rpc.netty.NettyClientBootstrap - NettyClientBootstrap has started
2025-05-25 02:39:38.931 [main] INFO  io.seata.discovery.registry.RegistryFactory - use registry center type: file
2025-05-25 02:39:38.941 [main] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - will connect to 8.133.246.113:8091
2025-05-25 02:39:38.945 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - NettyPool create channel to transactionRole:TMROLE,address:8.133.246.113:8091,msg:< RegisterTMRequest{version='1.7.0', applicationId='bgtech-ai', transactionServiceGroup='bgai-tx-group', extraData='ak=null
digest=bgai-tx-group,192.168.86.8,1748111978944
timestamp=1748111978944
authVersion=V4
vgroup=bgai-tx-group
ip=192.168.86.8
'} >
2025-05-25 02:39:39.103 [main] INFO  io.seata.core.rpc.netty.TmNettyRemotingClient - register TM success. client version:1.7.0, server version:1.8.1-SNAPSHOT,channel:[id: 0xd664aa77, L:/192.168.86.8:64779 - R:/8.133.246.113:8091]
2025-05-25 02:39:39.112 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - register success, cost 84 ms, version:1.8.1-SNAPSHOT,role:TMROLE,channel:[id: 0xd664aa77, L:/192.168.86.8:64779 - R:/8.133.246.113:8091]
2025-05-25 02:39:39.113 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Transaction Manager Client is initialized. applicationId[bgtech-ai] txServiceGroup[bgai-tx-group]
2025-05-25 02:39:39.126 [main] INFO  io.seata.rm.datasource.AsyncWorker - Async Commit Buffer Limit: 10000
2025-05-25 02:39:39.126 [main] INFO  io.seata.rm.datasource.xa.ResourceManagerXA - ResourceManagerXA init ...
2025-05-25 02:39:39.132 [main] INFO  io.seata.core.rpc.netty.NettyClientBootstrap - NettyClientBootstrap has started
2025-05-25 02:39:39.132 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Resource Manager is initialized. applicationId[bgtech-ai] txServiceGroup[bgai-tx-group]
2025-05-25 02:39:39.132 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Global Transaction Clients are initialized. 
2025-05-25 02:39:40.275 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat initialized with port(s): 8080 (http)
2025-05-25 02:39:40.284 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - The ["http-nio-8080"] connector has been configured to support HTTP upgrade to [h2c]
2025-05-25 02:39:40.284 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - Initializing ProtocolHandler ["http-nio-8080"]
2025-05-25 02:39:40.286 [main] INFO  org.apache.catalina.core.StandardService - Starting service [Tomcat]
2025-05-25 02:39:40.286 [main] INFO  org.apache.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.15]
2025-05-25 02:39:40.724 [main] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} inited
2025-05-25 02:39:40.961 [main] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - will connect to 8.133.246.113:8091
2025-05-25 02:39:40.961 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - RM will register :jdbc:mysql://8.133.246.113:3306/deepseek
2025-05-25 02:39:40.961 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - NettyPool create channel to transactionRole:RMROLE,address:8.133.246.113:8091,msg:< RegisterRMRequest{resourceIds='jdbc:mysql://8.133.246.113:3306/deepseek', version='1.7.0', applicationId='bgtech-ai', transactionServiceGroup='bgai-tx-group', extraData='null'} >
2025-05-25 02:39:40.978 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - register RM success. client version:1.7.0, server version:1.8.1-SNAPSHOT,channel:[id: 0xb720866c, L:/192.168.86.8:64782 - R:/8.133.246.113:8091]
2025-05-25 02:39:40.978 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - register success, cost 9 ms, version:1.8.1-SNAPSHOT,role:RMROLE,channel:[id: 0xb720866c, L:/192.168.86.8:64782 - R:/8.133.246.113:8091]
2025-05-25 02:39:40.980 [main] INFO  i.s.s.a.datasource.SeataAutoDataSourceProxyCreator - Auto proxy data source 'masterDataSource' by 'AT' mode.
2025-05-25 02:39:41.053 [main] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-2} inited
2025-05-25 02:39:41.118 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - will register resourceId:jdbc:mysql://8.133.246.113:3306/deepseek
2025-05-25 02:39:41.119 [main] INFO  i.s.s.a.datasource.SeataAutoDataSourceProxyCreator - Auto proxy data source 'slaveDataSource' by 'AT' mode.
2025-05-25 02:39:41.127 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.rm.AbstractRMHandler - the rm client received response msg [RegisterRMResponse{version='1.8.1-SNAPSHOT', extraData='null', identified=true, resultCode=null, msg='null'}] from tc server.
2025-05-25 02:39:41.141 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - will register resourceId:jdbc:mysql://8.133.246.113:3306/deepseek
2025-05-25 02:39:41.142 [main] INFO  i.s.s.a.datasource.SeataAutoDataSourceProxyCreator - Auto proxy data source 'dynamicDataSource' by 'AT' mode.
2025-05-25 02:39:41.150 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.rm.AbstractRMHandler - the rm client received response msg [RegisterRMResponse{version='1.8.1-SNAPSHOT', extraData='null', identified=true, resultCode=null, msg='null'}] from tc server.
2025-05-25 02:39:41.262 [main] INFO  org.hibernate.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-05-25 02:39:41.316 [main] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.1.7.Final
2025-05-25 02:39:41.659 [main] INFO  SQL dialect - HHH000400: Using dialect: org.hibernate.dialect.MySQL8Dialect
2025-05-25 02:39:41.661 [main] WARN  org.hibernate.orm.deprecation - HHH90000026: MySQL8Dialect has been deprecated; use org.hibernate.dialect.MySQLDialect instead
2025-05-25 02:39:41.961 [main] INFO  o.h.e.t.jta.platform.internal.JtaPlatformInitiator - HHH000490: Using JtaPlatform implementation: [org.hibernate.engine.transaction.jta.platform.internal.NoJtaPlatform]
2025-05-25 02:39:41.971 [main] INFO  o.s.orm.jpa.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-05-25 02:39:42.335 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-25 02:39:42.346 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-25 02:39:42.371 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-25 02:39:42.374 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-25 02:39:42.374 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-25 02:39:42.385 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-25 02:39:43.022 [main] INFO  com.bgpay.bgai.service.impl.UserServiceImpl - 初始化SSO配置: clientId=bgai-client-id, redirectUri=http://localhost:8080/api/auth/callback
2025-05-25 02:39:43.163 [main] INFO  com.bgpay.bgai.controller.AuthController - 初始化认证控制器: clientId=bgai-client-id, redirectUri=http://localhost:8080/api/auth/callback
2025-05-25 02:39:43.709 [main] INFO  o.a.r.s.autoconfigure.RocketMQAutoConfiguration - a producer (billing-producer-group) init on namesrv 8.133.246.113:9876
2025-05-25 02:39:44.355 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Bean [com.bgpay.bgai.service.deepseek.DeepSeekServiceImp$$SpringCGLIB$$0] with name [deepSeekServiceImp] would use interceptor [io.seata.spring.annotation.GlobalTransactionalInterceptor]
2025-05-25 02:39:44.714 [main] WARN  i.s.s.b.a.provider.SpringBootConfigurationProvider - The get method not found for the field 'SeataProperties#accesskey'.
2025-05-25 02:39:44.715 [main] WARN  i.s.s.b.a.provider.SpringBootConfigurationProvider - The get method not found for the field 'SeataProperties#secretkey'.
2025-05-25 02:39:44.726 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 加载到1个Saga状态机定义文件
2025-05-25 02:39:44.869 [main] INFO  com.bgpay.bgai.saga.CustomSagaJsonParser - 开始解析状态机定义: bgai-saga-transaction
2025-05-25 02:39:44.869 [main] INFO  com.bgpay.bgai.saga.CustomSagaJsonParser - 状态机定义解析成功: bgai-saga-transaction
2025-05-25 02:39:44.869 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 成功加载状态机定义: /E:/project/bgai/target/classes/statelang/bgai-saga-transaction.json
2025-05-25 02:39:45.266 [main] INFO  org.redisson.Version - Redisson 3.24.3
2025-05-25 02:39:45.390 [redisson-netty-4-6] INFO  o.r.connection.pool.MasterPubSubConnectionPool - 1 connections initialized for 8.133.246.113/8.133.246.113:6379
2025-05-25 02:39:45.734 [redisson-netty-4-19] INFO  org.redisson.connection.pool.MasterConnectionPool - 24 connections initialized for 8.133.246.113/8.133.246.113:6379
2025-05-25 02:39:45.922 [main] INFO  com.bgpay.bgai.service.mq.MQConsumerService - MQ consumer startup successful [group=billing-consumer-group, topic=BILLING_TOPIC, tag=USER_BILLING]
2025-05-25 02:39:46.120 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Bean [com.bgpay.bgai.service.mq.BillingTransactionListenerImpl$$SpringCGLIB$$0] with name [billingTransactionListenerImpl] would use interceptor [io.seata.spring.annotation.GlobalTransactionalInterceptor]
2025-05-25 02:39:46.258 [main] DEBUG com.bgpay.bgai.config.AsyncConfig$1 - Initializing ExecutorService 'blockingExecutor'
2025-05-25 02:39:46.285 [main] INFO  c.b.bgai.config.NacosConfig$NacosWarningHandler - Nacos警告处理器已启用，将忽略配置中心连接警告
2025-05-25 02:39:47.455 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [After]
2025-05-25 02:39:47.455 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Before]
2025-05-25 02:39:47.455 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Between]
2025-05-25 02:39:47.455 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Cookie]
2025-05-25 02:39:47.455 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Header]
2025-05-25 02:39:47.455 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Host]
2025-05-25 02:39:47.455 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Method]
2025-05-25 02:39:47.455 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Path]
2025-05-25 02:39:47.455 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Query]
2025-05-25 02:39:47.455 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [ReadBody]
2025-05-25 02:39:47.455 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [RemoteAddr]
2025-05-25 02:39:47.455 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [XForwardedRemoteAddr]
2025-05-25 02:39:47.455 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Weight]
2025-05-25 02:39:47.455 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [CloudFoundryRouteService]
2025-05-25 02:39:48.980 [main] INFO  o.s.b.actuate.endpoint.web.EndpointLinksResolver - Exposing 3 endpoint(s) beneath base path '/actuator'
2025-05-25 02:39:50.456 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - Starting ProtocolHandler ["http-nio-8080"]
2025-05-25 02:39:50.491 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat started on port(s): 8080 (http) with context path ''
2025-05-25 02:39:50.506 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from ans.namespace attribute : null
2025-05-25 02:39:50.507 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from ALIBABA_ALIWARE_NAMESPACE attribute :null
2025-05-25 02:39:50.507 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from namespace attribute :null
2025-05-25 02:39:50.520 [main] INFO  c.a.n.p.auth.spi.client.ClientAuthPluginManager - [ClientAuthPluginManager] Load ClientAuthService com.alibaba.nacos.client.auth.impl.NacosClientAuthServiceImpl success.
2025-05-25 02:39:50.520 [main] INFO  c.a.n.p.auth.spi.client.ClientAuthPluginManager - [ClientAuthPluginManager] Load ClientAuthService com.alibaba.nacos.client.auth.ram.RamClientAuthServiceImpl success.
2025-05-25 02:39:50.526 [main] INFO  com.alibaba.nacos.common.remote.client - [RpcClientFactory] create a new rpc client of f029e48b-ddfd-42f7-b062-bffe731eaf0c
2025-05-25 02:39:50.530 [main] INFO  com.alibaba.nacos.common.remote.client - [f029e48b-ddfd-42f7-b062-bffe731eaf0c] RpcClient init, ServerListFactory = com.alibaba.nacos.client.naming.core.ServerListManager
2025-05-25 02:39:50.530 [main] INFO  com.alibaba.nacos.common.remote.client - [f029e48b-ddfd-42f7-b062-bffe731eaf0c] Registry connection listener to current client:com.alibaba.nacos.client.naming.remote.gprc.redo.NamingGrpcRedoService
2025-05-25 02:39:50.530 [main] INFO  com.alibaba.nacos.common.remote.client - [f029e48b-ddfd-42f7-b062-bffe731eaf0c] Register server push request handler:com.alibaba.nacos.client.naming.remote.gprc.NamingPushRequestHandler
2025-05-25 02:39:50.531 [main] INFO  com.alibaba.nacos.common.remote.client - [f029e48b-ddfd-42f7-b062-bffe731eaf0c] Try to connect to server on start up, server: {serverIp = '8.133.246.113', server main port = 8848}
2025-05-25 02:39:50.531 [main] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - grpc client connection server:8.133.246.113 ip,serverPort:9848,grpcTslConfig:{"sslProvider":"OPENSSL","enableTls":false,"mutualAuthEnable":false,"trustAll":false}
2025-05-25 02:39:50.677 [main] INFO  com.alibaba.nacos.common.remote.client - [f029e48b-ddfd-42f7-b062-bffe731eaf0c] Success to connect to server [8.133.246.113:8848] on start up, connectionId = 1748111990586_139.227.195.192_50056
2025-05-25 02:39:50.677 [main] INFO  com.alibaba.nacos.common.remote.client - [f029e48b-ddfd-42f7-b062-bffe731eaf0c] Register server push request handler:com.alibaba.nacos.common.remote.client.RpcClient$ConnectResetRequestHandler
2025-05-25 02:39:50.677 [com.alibaba.nacos.client.remote.worker] INFO  com.alibaba.nacos.common.remote.client - [f029e48b-ddfd-42f7-b062-bffe731eaf0c] Notify connected event to listeners.
2025-05-25 02:39:50.677 [main] INFO  com.alibaba.nacos.common.remote.client - [f029e48b-ddfd-42f7-b062-bffe731eaf0c] Register server push request handler:com.alibaba.nacos.common.remote.client.RpcClient$$Lambda/0x000002348156d120
2025-05-25 02:39:50.677 [com.alibaba.nacos.client.remote.worker] INFO  com.alibaba.nacos.client.naming - Grpc connection connect
2025-05-25 02:39:50.679 [main] INFO  com.alibaba.nacos.client.naming - [REGISTER-SERVICE] d750d92e-152f-4055-a641-3bc9dda85a29 registering service bgtech-ai with instance Instance{instanceId='null', ip='192.168.86.8', port=8080, weight=1.0, healthy=true, enabled=true, ephemeral=true, clusterName='DEFAULT', serviceName='null', metadata={IPv6=[2408:820c:7528:d042:c185:8edc:f30d:3d91], preserved.register.source=SPRING_CLOUD}}
2025-05-25 02:39:50.700 [main] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - nacos registry, DEFAULT_GROUP bgtech-ai 192.168.86.8:8080 register finished
2025-05-25 02:39:50.754 [main] INFO  com.bgpay.bgai.config.NacosConfig - 应用启动完成，当前环境: dev
2025-05-25 02:39:50.754 [main] INFO  com.bgpay.bgai.config.NacosConfig - Nacos配置中心: 8.133.246.113:8848, 命名空间: d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-25 02:39:50.754 [main] INFO  com.bgpay.bgai.config.NacosConfig - 注意: 如果看到Nacos配置加载警告，但应用正常启动，说明应用正在使用本地配置文件
2025-05-25 02:39:50.755 [main] INFO  com.bgpay.bgai.BgaiApplication - Started BgaiApplication in 16.419 seconds (process running for 17.816)
2025-05-25 02:39:50.759 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-25 02:39:50.760 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-25 02:39:50.769 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-25 02:39:50.770 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-25 02:39:50.770 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-25 02:39:50.780 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-25 02:39:50.780 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-25 02:39:50.781 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-25 02:39:50.788 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-25 02:39:50.788 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-25 02:39:50.788 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-25 02:39:50.794 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-25 02:39:50.794 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - ==================== Saga状态机加载报告 ====================
2025-05-25 02:39:50.794 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - Saga状态机配置加载状态: 成功
2025-05-25 02:39:50.794 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 已加载的状态机定义文件数量: 1
2025-05-25 02:39:50.794 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 已加载的状态机定义文件:
2025-05-25 02:39:50.794 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig -  - /E:/project/bgai/target/classes/statelang/bgai-saga-transaction.json
2025-05-25 02:39:50.794 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - Saga解析器状态: CUSTOM_FASTJSON2
2025-05-25 02:39:50.794 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 状态机解析结果: 成功 1 个, 失败 0 个
2025-05-25 02:39:50.794 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - =============================================================
2025-05-25 02:39:50.798 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - nacos.cache.data.init.snapshot = true 
2025-05-25 02:39:50.798 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] common-dev.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-25 02:39:50.805 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=common-dev.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-25 02:39:50.805 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=common-dev.yaml, group=DEFAULT_GROUP
2025-05-25 02:39:50.805 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-25 02:39:50.805 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-25 02:39:50.805 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai.yaml, group=DEFAULT_GROUP
2025-05-25 02:39:50.807 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai-dev.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-25 02:39:50.807 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai-dev.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-25 02:39:50.807 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai-dev.yaml, group=DEFAULT_GROUP
2025-05-25 02:39:50.807 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-25 02:39:50.807 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai, group=DEFAULT_GROUP, cnt=1
2025-05-25 02:39:50.807 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai, group=DEFAULT_GROUP
2025-05-25 02:39:57.811 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - 接收到请求: /api/chatGatWay-internal, 文件=新文件 17.txt, 问题参数=null, 模型参数=null
2025-05-25 02:39:57.813 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - 请求Content-Type: multipart/form-data;boundary=--------------------------517548276185220861714483
2025-05-25 02:39:57.813 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - 收集到的完整参数: question="null", apiUrl="null", modelName="null", multiTurn=false
2025-05-25 02:39:57.815 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - Processing request for user ID: 689258T
2025-05-25 02:39:57.815 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - Processing file with circuit breaker: fileName=新文件 17.txt, question=
2025-05-25 02:39:57.817 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.config.ReactiveFileProcessor - Processing file: 新文件 17.txt, content-type: text/plain
2025-05-25 02:39:57.823 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - PARAM TRACE [689258T]: 尝试查找匹配配置 - 参数: apiUrl=null, modelName=null
2025-05-25 02:39:57.834 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 查询配置 - userId=689258T
2025-05-25 02:39:57.835 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 排序方式 - 按ID降序
2025-05-25 02:39:57.835 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 限制结果数 - LIMIT 1
2025-05-25 02:39:57.905 [http-nio-8080-exec-2] DEBUG com.bgpay.bgai.mapper.ApiConfigMapper.selectList - ==>  Preparing: SELECT id,api_url,api_key,model_name,user_id FROM api_config WHERE (user_id = ?) ORDER BY id DESC LIMIT 1
2025-05-25 02:39:57.908 [http-nio-8080-exec-2] DEBUG com.bgpay.bgai.mapper.ApiConfigMapper.selectList - ==> Parameters: 689258T(String)
2025-05-25 02:39:57.916 [http-nio-8080-exec-2] DEBUG com.bgpay.bgai.mapper.ApiConfigMapper.selectList - <==      Total: 1
2025-05-25 02:39:57.917 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 查询结果 - 找到配置: id=2, modelName=deepseek-chat
2025-05-25 02:39:57.917 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - PARAM TRACE [689258T]: 找到匹配配置 - apiUrl=https://api.deepseek.com/chat/completions, modelName=deepseek-chat (原始请求: null)
2025-05-25 02:39:57.917 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - API config resolved: url=https://api.deepseek.com/chat/completions, model=deepseek-chat
2025-05-25 02:39:57.934 [Thread-49] INFO  com.bgpay.bgai.config.ReactiveFileProcessor - File processed successfully: size=37 bytes
2025-05-25 02:39:57.940 [Thread-49] INFO  com.bgpay.bgai.controller.ReactiveChatController - Content processed, length: 54
2025-05-25 02:39:57.946 [Thread-49] INFO  io.seata.tm.TransactionManagerHolder - TransactionManager Singleton io.seata.tm.DefaultTransactionManager@6f5224a4
2025-05-25 02:39:57.962 [Thread-49] INFO  io.seata.tm.api.DefaultGlobalTransaction - Begin new global transaction [seata-server:8091:153776404394049597]
2025-05-25 02:39:57.964 [Thread-49] INFO  c.b.bgai.interceptor.SeataTransactionInterceptor - 准备记录分布式事务开始: XID=seata-server:8091:153776404394049597, 业务=com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive, 路径=, IP=, 用户=system
2025-05-25 02:39:57.989 [Thread-49] INFO  c.b.bgai.service.impl.TransactionLogServiceImpl - 记录分布式事务开始: XID=seata-server:8091:153776404394049597, 业务=com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive
2025-05-25 02:39:57.996 [Thread-49] DEBUG com.bgpay.bgai.mapper.TransactionLogMapper.insert - ==>  Preparing: INSERT INTO transaction_log ( xid, transaction_name, transaction_mode, status, request_path, source_ip, start_time, user_id, create_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-05-25 02:39:57.999 [Thread-49] DEBUG com.bgpay.bgai.mapper.TransactionLogMapper.insert - ==> Parameters: seata-server:8091:153776404394049597(String), com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive(String), AT(String), ACTIVE(String), (String), (String), 2025-05-25T02:39:57.989326200(LocalDateTime), system(String), 2025-05-25T02:39:57.989326200(LocalDateTime)
2025-05-25 02:39:58.364 [Thread-49] DEBUG com.bgpay.bgai.mapper.TransactionLogMapper.insert - <==    Updates: 1
2025-05-25 02:39:58.381 [Thread-49] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:153776404394049597, branchId:153776404394049598, lockKeys:transaction_log:43
2025-05-25 02:39:58.392 [Thread-49] WARN  i.s.c.l.EnhancedServiceLoader$InnerEnhancedServiceLoader - Load [io.seata.rm.datasource.undo.parser.ProtostuffUndoLogParser] class fail: io/protostuff/runtime/IdStrategy
2025-05-25 02:39:58.446 [Thread-49] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:153776404394049597, branchId:153776404394049599, lockKeys:undo_log:169;transaction_log:43
2025-05-25 02:39:58.475 [Thread-49] INFO  c.b.bgai.interceptor.SeataTransactionInterceptor - 开始分布式事务: XID=seata-server:8091:153776404394049597, 方法=com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive
2025-05-25 02:39:58.486 [Thread-49] INFO  org.reflections.Reflections - Processing reactive request: content length=54, apiUrl=https://api.deepseek.com/chat/completions, modelName=deepseek-chat, userId=689258T, multiTurn=false
2025-05-25 02:39:58.494 [Thread-49] INFO  c.b.bgai.service.impl.TransactionLogServiceImpl - 记录分布式事务结束: XID=seata-server:8091:153776404394049597, 状态=COMMITTED
2025-05-25 02:39:58.496 [Thread-49] DEBUG c.b.bgai.mapper.TransactionLogMapper.selectList - ==>  Preparing: SELECT id,xid,branch_id,transaction_name,transaction_mode,status,request_path,source_ip,start_time,end_time,user_id,extra_data,create_time,update_time FROM transaction_log WHERE (xid = ?) LIMIT 1
2025-05-25 02:39:58.498 [Thread-49] DEBUG c.b.bgai.mapper.TransactionLogMapper.selectList - ==> Parameters: seata-server:8091:153776404394049597(String)
2025-05-25 02:39:58.510 [Thread-49] DEBUG c.b.bgai.mapper.TransactionLogMapper.selectList - <==      Total: 1
2025-05-25 02:39:58.515 [Thread-49] DEBUG c.b.bgai.mapper.TransactionLogMapper.updateById - ==>  Preparing: UPDATE transaction_log SET xid=?, transaction_name=?, transaction_mode=?, status=?, request_path=?, source_ip=?, start_time=?, end_time=?, user_id=?, extra_data=?, create_time=?, update_time=? WHERE id=?
2025-05-25 02:39:58.524 [Thread-49] DEBUG c.b.bgai.mapper.TransactionLogMapper.updateById - ==> Parameters: seata-server:8091:153776404394049597(String), com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive(String), AT(String), COMMITTED(String), (String), (String), 2025-05-25T02:39:58(LocalDateTime), 2025-05-25T02:39:58.510960100(LocalDateTime), system(String), {"duration":13,"result":"success"}(String), 2025-05-25T02:39:58(LocalDateTime), 2025-05-25T02:39:58.510960100(LocalDateTime), 43(Long)
2025-05-25 02:39:58.587 [Thread-49] DEBUG c.b.bgai.mapper.TransactionLogMapper.updateById - <==    Updates: 1
2025-05-25 02:39:58.598 [Thread-49] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:153776404394049597, branchId:153776404394049600, lockKeys:transaction_log:43
2025-05-25 02:39:58.625 [Thread-49] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:153776404394049597, branchId:153776404394049601, lockKeys:undo_log:171;transaction_log:43
2025-05-25 02:39:58.649 [Thread-49] INFO  c.b.bgai.interceptor.SeataTransactionInterceptor - 分布式事务成功完成: XID=seata-server:8091:153776404394049597, 耗时=13ms
2025-05-25 02:39:58.649 [Thread-49] INFO  io.seata.tm.api.DefaultGlobalTransaction - transaction seata-server:8091:153776404394049597 will be commit
2025-05-25 02:39:58.660 [Thread-49] INFO  io.seata.tm.api.DefaultGlobalTransaction - transaction end, xid = seata-server:8091:153776404394049597
2025-05-25 02:39:58.660 [Thread-49] INFO  io.seata.tm.api.DefaultGlobalTransaction - [seata-server:8091:153776404394049597] commit status: Committed
2025-05-25 02:39:58.705 [boundedElastic-1] WARN  com.bgpay.bgai.transaction.TransactionCoordinator - Found existing transaction for user 689258T: chat-e388a4cb-3a36-4a89-b9d1-a7648bf3b0dc
2025-05-25 02:39:58.705 [boundedElastic-1] INFO  org.reflections.Reflections - Transaction prepared with chatCompletionId: chat-e388a4cb-3a36-4a89-b9d1-a7648bf3b0dc
2025-05-25 02:39:58.761 [rpcDispatch_RMROLE_1_1_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:153776404394049597', branchId=153776404394049598, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false,"skipCheckLock":true}'}
2025-05-25 02:39:58.762 [rpcDispatch_RMROLE_1_1_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:153776404394049597 153776404394049598 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false,"skipCheckLock":true}
2025-05-25 02:39:58.763 [rpcDispatch_RMROLE_1_1_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-25 02:39:58.773 [rpcDispatch_RMROLE_1_2_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:153776404394049597', branchId=153776404394049599, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false,"skipCheckLock":true}'}
2025-05-25 02:39:58.773 [rpcDispatch_RMROLE_1_2_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:153776404394049597 153776404394049599 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false,"skipCheckLock":true}
2025-05-25 02:39:58.773 [rpcDispatch_RMROLE_1_2_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-25 02:39:58.782 [rpcDispatch_RMROLE_1_3_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:153776404394049597', branchId=153776404394049600, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false}'}
2025-05-25 02:39:58.783 [rpcDispatch_RMROLE_1_3_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:153776404394049597 153776404394049600 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false}
2025-05-25 02:39:58.783 [rpcDispatch_RMROLE_1_3_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-25 02:39:58.792 [rpcDispatch_RMROLE_1_4_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:153776404394049597', branchId=153776404394049601, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false}'}
2025-05-25 02:39:58.792 [rpcDispatch_RMROLE_1_4_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:153776404394049597 153776404394049601 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false}
2025-05-25 02:39:58.792 [rpcDispatch_RMROLE_1_4_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-25 02:40:31.040 [FileWrite-1] INFO  com.bgpay.bgai.service.deepseek.FileWriterService - Successfully wrote content to: \var\data\ai_responses\bafac418-65be-4923-9449-41a4617865ac.txt
2025-05-25 02:40:31.055 [reactor-http-nio-2] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - ==>  Preparing: INSERT INTO chat_completions ( object, created, model, system_fingerprint, api_key ) VALUES ( ?, ?, ?, ?, ? )
2025-05-25 02:40:31.056 [reactor-http-nio-2] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - ==> Parameters: chat.completion(String), 1748112031054(Long), deepseek-chat(String), 689258T(String), chat-e388a4cb-3a36-4a89-b9d1-a7648bf3b0dc(String)
2025-05-25 02:40:31.065 [reactor-http-nio-2] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - <==    Updates: 1
2025-05-25 02:40:31.065 [reactor-http-nio-2] INFO  com.bgpay.bgai.transaction.TransactionCoordinator - Transaction committed for user 689258T: chatCompletionId=chat-e388a4cb-3a36-4a89-b9d1-a7648bf3b0dc
2025-05-25 02:40:31.078 [reactor-http-nio-2] INFO  org.reflections.Reflections - 开始发送账单消息，chatCompletionId: chat-e388a4cb-3a36-4a89-b9d1-a7648bf3b0dc, userId: 689258T
2025-05-25 02:40:31.125 [reactor-http-nio-2] INFO  io.seata.tm.api.DefaultGlobalTransaction - Begin new global transaction [seata-server:8091:153776404394049602]
2025-05-25 02:40:31.126 [reactor-http-nio-2] INFO  c.b.bgai.interceptor.SeataTransactionInterceptor - 准备记录分布式事务开始: XID=seata-server:8091:153776404394049602, 业务=com.bgpay.bgai.service.mq.BillingTransactionListenerImpl.executeLocalTransaction, 路径=, IP=, 用户=system
2025-05-25 02:40:31.129 [reactor-http-nio-2] INFO  c.b.bgai.service.impl.TransactionLogServiceImpl - 记录分布式事务开始: XID=seata-server:8091:153776404394049602, 业务=com.bgpay.bgai.service.mq.BillingTransactionListenerImpl.executeLocalTransaction
2025-05-25 02:40:31.130 [reactor-http-nio-2] DEBUG com.bgpay.bgai.mapper.TransactionLogMapper.insert - ==>  Preparing: INSERT INTO transaction_log ( xid, transaction_name, transaction_mode, status, request_path, source_ip, start_time, user_id, create_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-05-25 02:40:31.130 [reactor-http-nio-2] DEBUG com.bgpay.bgai.mapper.TransactionLogMapper.insert - ==> Parameters: seata-server:8091:153776404394049602(String), com.bgpay.bgai.service.mq.BillingTransactionListenerImpl.executeLocalTransaction(String), AT(String), ACTIVE(String), (String), (String), 2025-05-25T02:40:31.129694900(LocalDateTime), system(String), 2025-05-25T02:40:31.129694900(LocalDateTime)
2025-05-25 02:40:31.152 [reactor-http-nio-2] DEBUG com.bgpay.bgai.mapper.TransactionLogMapper.insert - <==    Updates: 1
2025-05-25 02:40:31.163 [reactor-http-nio-2] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:153776404394049602, branchId:153776404394049603, lockKeys:transaction_log:44
2025-05-25 02:40:31.186 [reactor-http-nio-2] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:153776404394049602, branchId:153776404394049604, lockKeys:transaction_log:44;undo_log:173
2025-05-25 02:40:31.209 [reactor-http-nio-2] INFO  c.b.bgai.interceptor.SeataTransactionInterceptor - 开始分布式事务: XID=seata-server:8091:153776404394049602, 方法=com.bgpay.bgai.service.mq.BillingTransactionListenerImpl.executeLocalTransaction
2025-05-25 02:40:31.210 [reactor-http-nio-2] INFO  c.b.bgai.service.mq.BillingTransactionListenerImpl - 开始执行本地事务, xid: seata-server:8091:153776404394049602, userId: 689258T, completionId: chat-e388a4cb-3a36-4a89-b9d1-a7648bf3b0dc
2025-05-25 02:40:31.225 [reactor-http-nio-2] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.selectCount - ==>  Preparing: SELECT COUNT( * ) AS total FROM usage_info WHERE (chat_completion_id = ?)
2025-05-25 02:40:31.226 [reactor-http-nio-2] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.selectCount - ==> Parameters: chat-e388a4cb-3a36-4a89-b9d1-a7648bf3b0dc(String)
2025-05-25 02:40:31.233 [reactor-http-nio-2] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.selectCount - <==      Total: 1
2025-05-25 02:40:31.279 [reactor-http-nio-2] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.selectCount - ==>  Preparing: SELECT COUNT( * ) AS total FROM usage_info WHERE (chat_completion_id = ?)
2025-05-25 02:40:31.279 [reactor-http-nio-2] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.selectCount - ==> Parameters: chat-e388a4cb-3a36-4a89-b9d1-a7648bf3b0dc(String)
2025-05-25 02:40:31.283 [reactor-http-nio-2] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.selectCount - <==      Total: 1
2025-05-25 02:40:31.287 [reactor-http-nio-2] DEBUG com.bgpay.bgai.mapper.UsageRecordMapper.insert - ==>  Preparing: INSERT INTO usage_record ( model_type, chat_completion_id, user_id, input_cost, output_cost, price_version, calculated_at, input_tokens, output_tokens, status, created_at ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-05-25 02:40:31.289 [reactor-http-nio-2] DEBUG com.bgpay.bgai.mapper.UsageRecordMapper.insert - ==> Parameters: deepseek-chat(String), chat-e388a4cb-3a36-4a89-b9d1-a7648bf3b0dc(String), 689258T(String), 0.030(BigDecimal), 1.382(BigDecimal), 1(Integer), 2025-05-25T02:40:31.078727400(LocalDateTime), 30(Integer), 691(Integer), PENDING(String), 2025-05-25T02:40:31.284695700(LocalDateTime)
2025-05-25 02:40:31.344 [reactor-http-nio-2] DEBUG com.bgpay.bgai.mapper.UsageRecordMapper.insert - <==    Updates: 1
2025-05-25 02:40:31.347 [reactor-http-nio-2] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.insert - ==>  Preparing: INSERT INTO usage_info ( chat_completion_id, prompt_tokens, completion_tokens, total_tokens, prompt_cache_hit_tokens, prompt_cache_miss_tokens, created_at, model_type ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ? )
2025-05-25 02:40:31.347 [reactor-http-nio-2] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.insert - ==> Parameters: chat-e388a4cb-3a36-4a89-b9d1-a7648bf3b0dc(String), 30(Integer), 691(Integer), 721(Integer), 0(Integer), 30(Integer), 2025-05-25T02:40:31.345729900(LocalDateTime), deepseek-chat(String)
2025-05-25 02:40:31.473 [reactor-http-nio-2] ERROR com.bgpay.bgai.service.impl.UsageInfoServiceImpl - Failed to process usage info for completionId: chat-e388a4cb-3a36-4a89-b9d1-a7648bf3b0dc
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLException: Field 'prompt_tokens_cached' doesn't have a default value
### The error may exist in com/bgpay/bgai/mapper/UsageInfoMapper.java (best guess)
### The error may involve com.bgpay.bgai.mapper.UsageInfoMapper.insert-Inline
### The error occurred while setting parameters
### SQL: INSERT INTO usage_info  ( chat_completion_id, prompt_tokens, completion_tokens, total_tokens,   prompt_cache_hit_tokens, prompt_cache_miss_tokens, created_at, model_type )  VALUES (  ?, ?, ?, ?,   ?, ?, ?, ?  )
### Cause: java.sql.SQLException: Field 'prompt_tokens_cached' doesn't have a default value
; Field 'prompt_tokens_cached' doesn't have a default value
	at org.springframework.jdbc.support.SQLErrorCodeSQLExceptionTranslator.doTranslate(SQLErrorCodeSQLExceptionTranslator.java:258)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:73)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:92)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:439)
	at jdk.proxy2/jdk.proxy2.$Proxy156.insert(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.insert(SqlSessionTemplate.java:272)
	at com.baomidou.mybatisplus.core.override.MybatisMapperMethod.execute(MybatisMapperMethod.java:59)
	at com.baomidou.mybatisplus.core.override.MybatisMapperProxy$PlainMethodInvoker.invoke(MybatisMapperProxy.java:152)
	at com.baomidou.mybatisplus.core.override.MybatisMapperProxy.invoke(MybatisMapperProxy.java:89)
	at jdk.proxy2/jdk.proxy2.$Proxy180.insert(Unknown Source)
	at com.baomidou.mybatisplus.extension.service.IService.save(IService.java:60)
	at com.bgpay.bgai.service.impl.UsageInfoServiceImpl.insertUsageInfo(UsageInfoServiceImpl.java:42)
	at com.bgpay.bgai.service.impl.UsageInfoServiceImpl.processUsageInfo(UsageInfoServiceImpl.java:96)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:343)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:751)
	at org.springframework.transaction.interceptor.TransactionInterceptor$1.proceedWithInvocation(TransactionInterceptor.java:123)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:391)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:751)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:703)
	at com.bgpay.bgai.service.impl.UsageInfoServiceImpl$$SpringCGLIB$$0.processUsageInfo(<generated>)
	at com.bgpay.bgai.service.mq.BillingTransactionListenerImpl.executeLocalTransaction(BillingTransactionListenerImpl.java:73)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:343)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:751)
	at org.springframework.aop.aspectj.AspectJAfterThrowingAdvice.invoke(AspectJAfterThrowingAdvice.java:64)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:173)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:751)
	at org.springframework.aop.framework.adapter.AfterReturningAdviceInterceptor.invoke(AfterReturningAdviceInterceptor.java:57)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:173)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:751)
	at org.springframework.aop.framework.adapter.MethodBeforeAdviceInterceptor.invoke(MethodBeforeAdviceInterceptor.java:58)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:173)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:751)
	at io.seata.spring.annotation.GlobalTransactionalInterceptor$2.execute(GlobalTransactionalInterceptor.java:208)
	at io.seata.tm.api.TransactionalTemplate.execute(TransactionalTemplate.java:128)
	at io.seata.spring.annotation.GlobalTransactionalInterceptor.handleGlobalTransaction(GlobalTransactionalInterceptor.java:205)
	at io.seata.spring.annotation.GlobalTransactionalInterceptor.invoke(GlobalTransactionalInterceptor.java:175)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:751)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:751)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:703)
	at com.bgpay.bgai.service.mq.BillingTransactionListenerImpl$$SpringCGLIB$$0.executeLocalTransaction(<generated>)
	at org.apache.rocketmq.spring.support.RocketMQUtil$1.executeLocalTransaction(RocketMQUtil.java:63)
	at org.apache.rocketmq.client.impl.producer.DefaultMQProducerImpl.sendMessageInTransaction(DefaultMQProducerImpl.java:1322)
	at org.apache.rocketmq.client.producer.TransactionMQProducer.sendMessageInTransaction(TransactionMQProducer.java:94)
	at org.apache.rocketmq.spring.core.RocketMQTemplate.sendMessageInTransaction(RocketMQTemplate.java:1183)
	at com.bgpay.bgai.service.mq.RocketMQProducerService.lambda$1(RocketMQProducerService.java:111)
	at reactor.core.publisher.MonoCallable.call(MonoCallable.java:72)
	at reactor.core.publisher.MonoCallableOnAssembly.call(MonoCallableOnAssembly.java:91)
	at reactor.core.publisher.MonoFlatMap$FlatMapMain.onNext(MonoFlatMap.java:146)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onNext(FluxOnAssembly.java:539)
	at reactor.core.publisher.FluxSubscribeOnCallable$CallableSubscribeOnSubscription.run(FluxSubscribeOnCallable.java:251)
	at reactor.core.scheduler.ImmediateScheduler.schedule(ImmediateScheduler.java:52)
	at reactor.core.publisher.MonoSubscribeOnCallable.subscribe(MonoSubscribeOnCallable.java:52)
	at reactor.core.publisher.InternalMonoOperator.subscribe(InternalMonoOperator.java:64)
	at reactor.core.publisher.FluxRetryWhen.subscribe(FluxRetryWhen.java:77)
	at reactor.core.publisher.MonoRetryWhen.subscribeOrReturn(MonoRetryWhen.java:46)
	at reactor.core.publisher.Mono.subscribe(Mono.java:4480)
	at reactor.core.publisher.Mono.subscribeWith(Mono.java:4561)
	at reactor.core.publisher.Mono.subscribe(Mono.java:4462)
	at reactor.core.publisher.Mono.subscribe(Mono.java:4398)
	at reactor.core.publisher.Mono.subscribe(Mono.java:4370)
	at com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.lambda$5(DeepSeekServiceImp.java:321)
	at reactor.core.publisher.MonoPeekTerminal$MonoTerminalPeekSubscriber.onNext(MonoPeekTerminal.java:171)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onNext(FluxOnAssembly.java:539)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onNext(FluxOnAssembly.java:539)
	at reactor.core.publisher.FluxOnErrorResume$ResumeSubscriber.onNext(FluxOnErrorResume.java:79)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onNext(FluxOnAssembly.java:539)
	at reactor.core.publisher.MonoFlatMap$FlatMapMain.secondComplete(MonoFlatMap.java:245)
	at reactor.core.publisher.MonoFlatMap$FlatMapInner.onNext(MonoFlatMap.java:305)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onNext(FluxOnAssembly.java:539)
	at reactor.core.publisher.FluxMap$MapSubscriber.onNext(FluxMap.java:122)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onNext(FluxOnAssembly.java:539)
	at reactor.core.publisher.MonoCallable$MonoCallableSubscription.request(MonoCallable.java:156)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.request(FluxOnAssembly.java:649)
	at reactor.core.publisher.FluxMap$MapSubscriber.request(FluxMap.java:164)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.request(FluxOnAssembly.java:649)
	at reactor.core.publisher.MonoFlatMap$FlatMapInner.onSubscribe(MonoFlatMap.java:291)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onSubscribe(FluxOnAssembly.java:633)
	at reactor.core.publisher.FluxMap$MapSubscriber.onSubscribe(FluxMap.java:92)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onSubscribe(FluxOnAssembly.java:633)
	at reactor.core.publisher.MonoCallable.subscribe(MonoCallable.java:48)
	at reactor.core.publisher.InternalMonoOperator.subscribe(InternalMonoOperator.java:64)
	at reactor.core.publisher.MonoFlatMap$FlatMapMain.onNext(MonoFlatMap.java:165)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onNext(FluxOnAssembly.java:539)
	at reactor.core.publisher.SerializedSubscriber.onNext(SerializedSubscriber.java:99)
	at reactor.core.publisher.FluxRetryWhen$RetryWhenMainSubscriber.onNext(FluxRetryWhen.java:174)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onNext(FluxOnAssembly.java:539)
	at reactor.core.publisher.SerializedSubscriber.onNext(SerializedSubscriber.java:99)
	at reactor.core.publisher.FluxTimeout$TimeoutMainSubscriber.onNext(FluxTimeout.java:180)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onNext(FluxOnAssembly.java:539)
	at reactor.core.publisher.MonoFlatMap$FlatMapMain.secondComplete(MonoFlatMap.java:245)
	at reactor.core.publisher.MonoFlatMap$FlatMapInner.onNext(MonoFlatMap.java:305)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onNext(FluxOnAssembly.java:539)
	at reactor.core.publisher.FluxOnErrorResume$ResumeSubscriber.onNext(FluxOnErrorResume.java:79)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onNext(FluxOnAssembly.java:539)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onNext(FluxOnAssembly.java:539)
	at reactor.core.publisher.FluxMapFuseable$MapFuseableSubscriber.onNext(FluxMapFuseable.java:129)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onNext(FluxOnAssembly.java:539)
	at reactor.core.publisher.FluxContextWrite$ContextWriteSubscriber.onNext(FluxContextWrite.java:107)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onNext(FluxOnAssembly.java:539)
	at reactor.core.publisher.FluxMapFuseable$MapFuseableConditionalSubscriber.onNext(FluxMapFuseable.java:299)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onNext(FluxOnAssembly.java:539)
	at reactor.core.publisher.FluxFilterFuseable$FilterFuseableConditionalSubscriber.onNext(FluxFilterFuseable.java:337)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onNext(FluxOnAssembly.java:539)
	at reactor.core.publisher.Operators$BaseFluxToMonoOperator.completePossiblyEmpty(Operators.java:2071)
	at reactor.core.publisher.MonoCollect$CollectSubscriber.onComplete(MonoCollect.java:145)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onComplete(FluxOnAssembly.java:549)
	at reactor.core.publisher.FluxMapFuseable$MapFuseableSubscriber.onComplete(FluxMapFuseable.java:152)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onComplete(FluxOnAssembly.java:549)
	at reactor.core.publisher.FluxPeekFuseable$PeekFuseableSubscriber.onComplete(FluxPeekFuseable.java:277)
	at reactor.core.publisher.FluxOnAssembly$OnAssemblySubscriber.onComplete(FluxOnAssembly.java:549)
	at reactor.core.publisher.FluxMap$MapSubscriber.onComplete(FluxMap.java:144)
	at reactor.netty.channel.FluxReceive.onInboundComplete(FluxReceive.java:413)
	at reactor.netty.channel.ChannelOperations.onInboundComplete(ChannelOperations.java:444)
	at reactor.netty.channel.ChannelOperations.terminate(ChannelOperations.java:498)
	at reactor.netty.http.client.HttpClientOperations.onInboundNext(HttpClientOperations.java:753)
	at reactor.netty.channel.ChannelOperationsHandler.channelRead(ChannelOperationsHandler.java:114)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:444)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)
	at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412)
	at io.netty.handler.codec.MessageToMessageDecoder.channelRead(MessageToMessageDecoder.java:103)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:444)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)
	at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412)
	at io.netty.channel.CombinedChannelDuplexHandler$DelegatingChannelHandlerContext.fireChannelRead(CombinedChannelDuplexHandler.java:436)
	at io.netty.handler.codec.ByteToMessageDecoder.fireChannelRead(ByteToMessageDecoder.java:346)
	at io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:318)
	at io.netty.channel.CombinedChannelDuplexHandler.channelRead(CombinedChannelDuplexHandler.java:251)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:442)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)
	at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412)
	at io.netty.handler.ssl.SslHandler.unwrap(SslHandler.java:1471)
	at io.netty.handler.ssl.SslHandler.decodeJdkCompatible(SslHandler.java:1334)
	at io.netty.handler.ssl.SslHandler.decode(SslHandler.java:1383)
	at io.netty.handler.codec.ByteToMessageDecoder.decodeRemovalReentryProtection(ByteToMessageDecoder.java:529)
	at io.netty.handler.codec.ByteToMessageDecoder.callDecode(ByteToMessageDecoder.java:468)
	at io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:290)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:444)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)
	at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412)
	at io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1410)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:440)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)
	at io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:919)
	at io.netty.channel.nio.AbstractNioByteChannel$NioByteUnsafe.read(AbstractNioByteChannel.java:166)
	at io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:788)
	at io.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:724)
	at io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:650)
	at io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:562)
	at io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:997)
	at io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.base/java.lang.Thread.run(Thread.java:1583)
Caused by: java.sql.SQLException: Field 'prompt_tokens_cached' doesn't have a default value
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:130)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:916)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:354)
	at com.alibaba.druid.pool.DruidPooledPreparedStatement.execute(DruidPooledPreparedStatement.java:497)
	at io.seata.rm.datasource.PreparedStatementProxy.lambda$execute$0(PreparedStatementProxy.java:55)
	at io.seata.rm.datasource.exec.AbstractDMLBaseExecutor.executeAutoCommitFalse(AbstractDMLBaseExecutor.java:99)
	at io.seata.rm.datasource.exec.AbstractDMLBaseExecutor.doExecute(AbstractDMLBaseExecutor.java:85)
	at io.seata.rm.datasource.exec.BaseTransactionalExecutor.execute(BaseTransactionalExecutor.java:125)
	at io.seata.rm.datasource.exec.ExecuteTemplate.execute(ExecuteTemplate.java:137)
	at io.seata.rm.datasource.exec.ExecuteTemplate.execute(ExecuteTemplate.java:56)
	at io.seata.rm.datasource.PreparedStatementProxy.execute(PreparedStatementProxy.java:55)
	at io.seata.rm.datasource.PreparedStatementProxy.lambda$execute$0(PreparedStatementProxy.java:55)
	at io.seata.rm.datasource.exec.AbstractDMLBaseExecutor.executeAutoCommitFalse(AbstractDMLBaseExecutor.java:99)
	at io.seata.rm.datasource.exec.AbstractDMLBaseExecutor.doExecute(AbstractDMLBaseExecutor.java:85)
	at io.seata.rm.datasource.exec.BaseTransactionalExecutor.execute(BaseTransactionalExecutor.java:125)
	at io.seata.rm.datasource.exec.ExecuteTemplate.execute(ExecuteTemplate.java:137)
	at io.seata.rm.datasource.exec.ExecuteTemplate.execute(ExecuteTemplate.java:56)
	at io.seata.rm.datasource.PreparedStatementProxy.execute(PreparedStatementProxy.java:55)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:58)
	at jdk.proxy3/jdk.proxy3.$Proxy162.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:48)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:75)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.insert(DefaultSqlSession.java:184)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:425)
	... 161 common frames omitted
2025-05-25 02:40:31.485 [reactor-http-nio-2] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:153776404394049602, branchId:153776404394049605, lockKeys:usage_record:171
2025-05-25 02:40:31.525 [reactor-http-nio-2] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:153776404394049602, branchId:153776404394049606, lockKeys:usage_record:171;undo_log:175
2025-05-25 02:40:31.543 [reactor-http-nio-2] WARN  c.b.bgai.service.mq.BillingTransactionListenerImpl - 本地事务执行失败，回滚事务, completionId: chat-e388a4cb-3a36-4a89-b9d1-a7648bf3b0dc
2025-05-25 02:40:31.544 [reactor-http-nio-2] INFO  com.bgpay.bgai.transaction.TransactionCoordinator - Compensating transaction for user 689258T: chatCompletionId=chat-e388a4cb-3a36-4a89-b9d1-a7648bf3b0dc
2025-05-25 02:40:31.560 [reactor-http-nio-2] INFO  c.b.bgai.service.impl.TransactionLogServiceImpl - 记录分布式事务结束: XID=seata-server:8091:153776404394049602, 状态=COMMITTED
2025-05-25 02:40:31.561 [reactor-http-nio-2] DEBUG c.b.bgai.mapper.TransactionLogMapper.selectList - ==>  Preparing: SELECT id,xid,branch_id,transaction_name,transaction_mode,status,request_path,source_ip,start_time,end_time,user_id,extra_data,create_time,update_time FROM transaction_log WHERE (xid = ?) LIMIT 1
2025-05-25 02:40:31.561 [reactor-http-nio-2] DEBUG c.b.bgai.mapper.TransactionLogMapper.selectList - ==> Parameters: seata-server:8091:153776404394049602(String)
2025-05-25 02:40:31.567 [reactor-http-nio-2] DEBUG c.b.bgai.mapper.TransactionLogMapper.selectList - <==      Total: 1
2025-05-25 02:40:31.568 [reactor-http-nio-2] DEBUG c.b.bgai.mapper.TransactionLogMapper.updateById - ==>  Preparing: UPDATE transaction_log SET xid=?, transaction_name=?, transaction_mode=?, status=?, request_path=?, source_ip=?, start_time=?, end_time=?, user_id=?, extra_data=?, create_time=?, update_time=? WHERE id=?
2025-05-25 02:40:31.568 [reactor-http-nio-2] DEBUG c.b.bgai.mapper.TransactionLogMapper.updateById - ==> Parameters: seata-server:8091:153776404394049602(String), com.bgpay.bgai.service.mq.BillingTransactionListenerImpl.executeLocalTransaction(String), AT(String), COMMITTED(String), (String), (String), 2025-05-25T02:40:31(LocalDateTime), 2025-05-25T02:40:31.567350100(LocalDateTime), system(String), {"duration":346,"result":"success"}(String), 2025-05-25T02:40:31(LocalDateTime), 2025-05-25T02:40:31.567350100(LocalDateTime), 44(Long)
2025-05-25 02:40:31.597 [reactor-http-nio-2] DEBUG c.b.bgai.mapper.TransactionLogMapper.updateById - <==    Updates: 1
2025-05-25 02:40:31.605 [reactor-http-nio-2] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:153776404394049602, branchId:153776404394049607, lockKeys:transaction_log:44
2025-05-25 02:40:31.625 [reactor-http-nio-2] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:153776404394049602, branchId:153776404394049608, lockKeys:undo_log:177;transaction_log:44
2025-05-25 02:40:31.647 [reactor-http-nio-2] INFO  c.b.bgai.interceptor.SeataTransactionInterceptor - 分布式事务成功完成: XID=seata-server:8091:153776404394049602, 耗时=346ms
2025-05-25 02:40:31.647 [reactor-http-nio-2] INFO  io.seata.tm.api.DefaultGlobalTransaction - transaction seata-server:8091:153776404394049602 will be commit
2025-05-25 02:40:31.656 [reactor-http-nio-2] INFO  io.seata.tm.api.DefaultGlobalTransaction - transaction end, xid = seata-server:8091:153776404394049602
2025-05-25 02:40:31.656 [reactor-http-nio-2] INFO  io.seata.tm.api.DefaultGlobalTransaction - [seata-server:8091:153776404394049602] commit status: Committed
2025-05-25 02:40:31.658 [reactor-http-nio-2] INFO  org.reflections.Reflections - 账单消息发送成功，chatCompletionId: chat-e388a4cb-3a36-4a89-b9d1-a7648bf3b0dc, userId: 689258T
2025-05-25 02:40:31.662 [reactor-http-nio-2] INFO  com.bgpay.bgai.service.impl.BGAIServiceImpl - 执行第一步操作 - 发送账单消息, businessKey: 689258T:chat-e388a4cb-3a36-4a89-b9d1-a7648bf3b0dc
2025-05-25 02:40:31.663 [reactor-http-nio-2] DEBUG c.bgpay.bgai.mapper.UsageRecordMapper.selectCount - ==>  Preparing: SELECT COUNT( * ) AS total FROM usage_record WHERE (chat_completion_id = ?)
2025-05-25 02:40:31.663 [reactor-http-nio-2] DEBUG c.bgpay.bgai.mapper.UsageRecordMapper.selectCount - ==> Parameters: chat-e388a4cb-3a36-4a89-b9d1-a7648bf3b0dc(String)
2025-05-25 02:40:31.668 [reactor-http-nio-2] DEBUG c.bgpay.bgai.mapper.UsageRecordMapper.selectCount - <==      Total: 1
2025-05-25 02:40:31.668 [reactor-http-nio-2] INFO  com.bgpay.bgai.service.impl.BGAIServiceImpl - 账单消息已处理，跳过发送, completionId: chat-e388a4cb-3a36-4a89-b9d1-a7648bf3b0dc
2025-05-25 02:40:31.676 [reactor-http-nio-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - Processed response for user 689258T, content length: 2262
2025-05-25 02:40:31.760 [rpcDispatch_RMROLE_1_5_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:153776404394049602', branchId=153776404394049603, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false,"skipCheckLock":true}'}
2025-05-25 02:40:31.760 [rpcDispatch_RMROLE_1_5_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:153776404394049602 153776404394049603 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false,"skipCheckLock":true}
2025-05-25 02:40:31.760 [rpcDispatch_RMROLE_1_5_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-25 02:40:31.780 [rpcDispatch_RMROLE_1_6_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:153776404394049602', branchId=153776404394049604, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false,"skipCheckLock":true}'}
2025-05-25 02:40:31.781 [rpcDispatch_RMROLE_1_6_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:153776404394049602 153776404394049604 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false,"skipCheckLock":true}
2025-05-25 02:40:31.781 [rpcDispatch_RMROLE_1_6_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-25 02:40:31.789 [rpcDispatch_RMROLE_1_7_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:153776404394049602', branchId=153776404394049605, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false,"skipCheckLock":true}'}
2025-05-25 02:40:31.789 [rpcDispatch_RMROLE_1_7_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:153776404394049602 153776404394049605 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false,"skipCheckLock":true}
2025-05-25 02:40:31.789 [rpcDispatch_RMROLE_1_7_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-25 02:40:31.798 [rpcDispatch_RMROLE_1_8_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:153776404394049602', branchId=153776404394049606, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false,"skipCheckLock":true}'}
2025-05-25 02:40:31.798 [rpcDispatch_RMROLE_1_8_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:153776404394049602 153776404394049606 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false,"skipCheckLock":true}
2025-05-25 02:40:31.798 [rpcDispatch_RMROLE_1_8_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-25 02:40:31.809 [rpcDispatch_RMROLE_1_9_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:153776404394049602', branchId=153776404394049607, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false}'}
2025-05-25 02:40:31.809 [rpcDispatch_RMROLE_1_9_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:153776404394049602 153776404394049607 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false}
2025-05-25 02:40:31.809 [rpcDispatch_RMROLE_1_9_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-25 02:40:31.820 [rpcDispatch_RMROLE_1_10_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:153776404394049602', branchId=153776404394049608, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false}'}
2025-05-25 02:40:31.820 [rpcDispatch_RMROLE_1_10_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:153776404394049602 153776404394049608 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false}
2025-05-25 02:40:31.820 [rpcDispatch_RMROLE_1_10_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-25 02:40:53.191 [Thread-7] WARN  com.alibaba.nacos.common.notify.NotifyCenter - [NotifyCenter] Start destroying Publisher
2025-05-25 02:40:53.191 [Thread-1] WARN  c.alibaba.nacos.common.http.HttpClientBeanHolder - [HttpClientBeanHolder] Start destroying common HttpClient
2025-05-25 02:40:53.191 [Thread-7] WARN  com.alibaba.nacos.common.notify.NotifyCenter - [NotifyCenter] Destruction of the end
2025-05-25 02:40:53.191 [Thread-1] WARN  c.alibaba.nacos.common.http.HttpClientBeanHolder - [HttpClientBeanHolder] Destruction of the end
2025-05-25 02:40:53.207 [SpringContextShutdownHook] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - De-registering from Nacos Server now...
2025-05-25 02:40:53.207 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - [DEREGISTER-SERVICE] d750d92e-152f-4055-a641-3bc9dda85a29 deregistering service bgtech-ai with instance: Instance{instanceId='null', ip='192.168.86.8', port=8080, weight=1.0, healthy=true, enabled=true, ephemeral=true, clusterName='DEFAULT', serviceName='null', metadata={}}
2025-05-25 02:40:53.215 [SpringContextShutdownHook] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - De-registration finished.
2025-05-25 02:40:53.216 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.cache.ServiceInfoHolder do shutdown begin
2025-05-25 02:40:53.216 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.backups.FailoverReactor do shutdown begin
2025-05-25 02:40:53.216 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.backups.FailoverReactor do shutdown stop
2025-05-25 02:40:53.216 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.cache.ServiceInfoHolder do shutdown stop
2025-05-25 02:40:53.216 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.NamingClientProxyDelegate do shutdown begin
2025-05-25 02:40:53.216 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServiceInfoUpdateService do shutdown begin
2025-05-25 02:40:53.216 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServiceInfoUpdateService do shutdown stop
2025-05-25 02:40:53.216 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServerListManager do shutdown begin
2025-05-25 02:40:53.216 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Start destroying NacosRestTemplate
2025-05-25 02:40:53.216 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Destruction of the end
2025-05-25 02:40:53.217 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServerListManager do shutdown stop
2025-05-25 02:40:53.217 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.http.NamingHttpClientProxy do shutdown begin
2025-05-25 02:40:53.217 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Start destroying NacosRestTemplate
2025-05-25 02:40:53.217 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Destruction of the end
2025-05-25 02:40:53.217 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.http.NamingHttpClientProxy do shutdown stop
2025-05-25 02:40:53.217 [SpringContextShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Shutdown rpc client, set status to shutdown
2025-05-25 02:40:53.217 [SpringContextShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Shutdown client event executor java.util.concurrent.ScheduledThreadPoolExecutor@4bf17184[Running, pool size = 2, active threads = 2, queued tasks = 0, completed tasks = 0]
2025-05-25 02:40:53.217 [SpringContextShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Close current connection 1748111990586_139.227.195.192_50056
2025-05-25 02:40:53.219 [nacos-grpc-client-executor-8.133.246.113-24] WARN  c.a.nacos.common.remote.client.grpc.GrpcClient - [1748111990586_139.227.195.192_50056]Ignore error event,isRunning:false,isAbandon=false
2025-05-25 02:40:53.220 [SpringContextShutdownHook] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - Shutdown grpc executor java.util.concurrent.ThreadPoolExecutor@6664d5e9[Running, pool size = 4, active threads = 0, queued tasks = 0, completed tasks = 25]
2025-05-25 02:40:53.221 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - Shutdown grpc redo service executor java.util.concurrent.ScheduledThreadPoolExecutor@7a2141b4[Running, pool size = 1, active threads = 0, queued tasks = 1, completed tasks = 20]
2025-05-25 02:40:53.221 [SpringContextShutdownHook] INFO  c.a.n.client.auth.ram.identify.CredentialWatcher - [null] CredentialWatcher is stopped
2025-05-25 02:40:53.221 [SpringContextShutdownHook] INFO  c.a.n.client.auth.ram.identify.CredentialService - [null] CredentialService is freed
2025-05-25 02:40:53.221 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.NamingClientProxyDelegate do shutdown stop
2025-05-25 02:40:53.227 [SpringContextShutdownHook] DEBUG com.bgpay.bgai.config.AsyncConfig$1 - Shutting down ExecutorService 'blockingExecutor'
2025-05-25 02:40:55.292 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:10911] result: true
2025-05-25 02:40:55.293 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:9876] result: true
2025-05-25 02:40:55.307 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:10911] result: true
2025-05-25 02:40:55.307 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:9876] result: true
2025-05-25 02:40:55.409 [com.alibaba.nacos.client.Worker] INFO  c.a.n.client.auth.ram.identify.CredentialWatcher - null No credential found
2025-05-25 02:40:55.418 [SpringContextShutdownHook] INFO  o.s.orm.jpa.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-05-25 02:40:55.419 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-2} closing ...
2025-05-25 02:40:55.424 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-2} closed
2025-05-25 02:40:55.424 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} closing ...
2025-05-25 02:40:55.424 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} closed
2025-05-25 02:40:55.424 [NettyClientSelector_TMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - channel inactive: [id: 0xd664aa77, L:/192.168.86.8:64779 ! R:/8.133.246.113:8091]
2025-05-25 02:40:55.425 [NettyClientSelector_TMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - return to pool, rm channel:[id: 0xd664aa77, L:/192.168.86.8:64779 ! R:/8.133.246.113:8091]
2025-05-25 02:40:55.425 [NettyClientSelector_TMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - channel valid false,channel:[id: 0xd664aa77, L:/192.168.86.8:64779 ! R:/8.133.246.113:8091]
2025-05-25 02:40:55.425 [NettyClientSelector_TMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - will destroy channel:[id: 0xd664aa77, L:/192.168.86.8:64779 ! R:/8.133.246.113:8091]
2025-05-25 02:40:55.425 [NettyClientSelector_TMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0xd664aa77, L:/192.168.86.8:64779 ! R:/8.133.246.113:8091]) will closed
2025-05-25 02:40:55.425 [NettyClientSelector_TMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0xd664aa77, L:/192.168.86.8:64779 ! R:/8.133.246.113:8091]) will closed
2025-05-25 02:40:55.425 [NettyClientSelector_RMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - channel inactive: [id: 0xb720866c, L:/192.168.86.8:64782 ! R:/8.133.246.113:8091]
2025-05-25 02:40:55.426 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - return to pool, rm channel:[id: 0xb720866c, L:/192.168.86.8:64782 ! R:/8.133.246.113:8091]
2025-05-25 02:40:55.426 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - channel valid false,channel:[id: 0xb720866c, L:/192.168.86.8:64782 ! R:/8.133.246.113:8091]
2025-05-25 02:40:55.426 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - will destroy channel:[id: 0xb720866c, L:/192.168.86.8:64782 ! R:/8.133.246.113:8091]
2025-05-25 02:40:55.426 [NettyClientSelector_RMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0xb720866c, L:/192.168.86.8:64782 ! R:/8.133.246.113:8091]) will closed
2025-05-25 02:40:55.426 [NettyClientSelector_RMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0xb720866c, L:/192.168.86.8:64782 ! R:/8.133.246.113:8091]) will closed
2025-05-25 02:42:17.597 [main] WARN  com.alibaba.nacos.client.logging.NacosLogging - Load Logback Configuration of Nacos fail, message: Could not initialize Logback Nacos logging from classpath:nacos-logback.xml
2025-05-25 02:42:17.598 [main] INFO  com.bgpay.bgai.BgaiApplication - The following 1 profile is active: "dev"
2025-05-25 02:42:18.934 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-05-25 02:42:18.936 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-05-25 02:42:18.960 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 17 ms. Found 0 JPA repository interfaces.
2025-05-25 02:42:18.971 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-05-25 02:42:18.972 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-05-25 02:42:18.983 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 4 ms. Found 0 Redis repository interfaces.
2025-05-25 02:42:19.652 [main] INFO  io.seata.config.ConfigurationFactory - load Configuration from :Spring Configuration
2025-05-25 02:42:19.660 [main] INFO  io.seata.config.ConfigurationFactory - load Configuration from :Spring Configuration
2025-05-25 02:42:19.667 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Initializing Global Transaction Clients ... 
2025-05-25 02:42:19.789 [main] INFO  io.seata.core.rpc.netty.NettyClientBootstrap - NettyClientBootstrap has started
2025-05-25 02:42:19.790 [main] INFO  io.seata.discovery.registry.RegistryFactory - use registry center type: file
2025-05-25 02:42:19.800 [main] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - will connect to 8.133.246.113:8091
2025-05-25 02:42:19.803 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - NettyPool create channel to transactionRole:TMROLE,address:8.133.246.113:8091,msg:< RegisterTMRequest{version='1.7.0', applicationId='bgtech-ai', transactionServiceGroup='bgai-tx-group', extraData='ak=null
digest=bgai-tx-group,192.168.86.8,1748112139802
timestamp=1748112139802
authVersion=V4
vgroup=bgai-tx-group
ip=192.168.86.8
'} >
2025-05-25 02:42:19.935 [main] INFO  io.seata.core.rpc.netty.TmNettyRemotingClient - register TM success. client version:1.7.0, server version:1.8.1-SNAPSHOT,channel:[id: 0x205e4845, L:/192.168.86.8:64989 - R:/8.133.246.113:8091]
2025-05-25 02:42:19.942 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - register success, cost 66 ms, version:1.8.1-SNAPSHOT,role:TMROLE,channel:[id: 0x205e4845, L:/192.168.86.8:64989 - R:/8.133.246.113:8091]
2025-05-25 02:42:19.943 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Transaction Manager Client is initialized. applicationId[bgtech-ai] txServiceGroup[bgai-tx-group]
2025-05-25 02:42:19.955 [main] INFO  io.seata.rm.datasource.AsyncWorker - Async Commit Buffer Limit: 10000
2025-05-25 02:42:19.956 [main] INFO  io.seata.rm.datasource.xa.ResourceManagerXA - ResourceManagerXA init ...
2025-05-25 02:42:19.962 [main] INFO  io.seata.core.rpc.netty.NettyClientBootstrap - NettyClientBootstrap has started
2025-05-25 02:42:19.962 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Resource Manager is initialized. applicationId[bgtech-ai] txServiceGroup[bgai-tx-group]
2025-05-25 02:42:19.962 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Global Transaction Clients are initialized. 
2025-05-25 02:42:21.047 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat initialized with port(s): 8080 (http)
2025-05-25 02:42:21.060 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - The ["http-nio-8080"] connector has been configured to support HTTP upgrade to [h2c]
2025-05-25 02:42:21.060 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - Initializing ProtocolHandler ["http-nio-8080"]
2025-05-25 02:42:21.062 [main] INFO  org.apache.catalina.core.StandardService - Starting service [Tomcat]
2025-05-25 02:42:21.063 [main] INFO  org.apache.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.15]
2025-05-25 02:42:21.486 [main] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} inited
2025-05-25 02:42:21.749 [main] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - will connect to 8.133.246.113:8091
2025-05-25 02:42:21.749 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - RM will register :jdbc:mysql://8.133.246.113:3306/deepseek
2025-05-25 02:42:21.749 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - NettyPool create channel to transactionRole:RMROLE,address:8.133.246.113:8091,msg:< RegisterRMRequest{resourceIds='jdbc:mysql://8.133.246.113:3306/deepseek', version='1.7.0', applicationId='bgtech-ai', transactionServiceGroup='bgai-tx-group', extraData='null'} >
2025-05-25 02:42:21.772 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - register RM success. client version:1.7.0, server version:1.8.1-SNAPSHOT,channel:[id: 0xf2bb6d3d, L:/192.168.86.8:64991 - R:/8.133.246.113:8091]
2025-05-25 02:42:21.772 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - register success, cost 14 ms, version:1.8.1-SNAPSHOT,role:RMROLE,channel:[id: 0xf2bb6d3d, L:/192.168.86.8:64991 - R:/8.133.246.113:8091]
2025-05-25 02:42:21.774 [main] INFO  i.s.s.a.datasource.SeataAutoDataSourceProxyCreator - Auto proxy data source 'masterDataSource' by 'AT' mode.
2025-05-25 02:42:21.863 [main] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-2} inited
2025-05-25 02:42:21.935 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - will register resourceId:jdbc:mysql://8.133.246.113:3306/deepseek
2025-05-25 02:42:21.936 [main] INFO  i.s.s.a.datasource.SeataAutoDataSourceProxyCreator - Auto proxy data source 'slaveDataSource' by 'AT' mode.
2025-05-25 02:42:21.944 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.rm.AbstractRMHandler - the rm client received response msg [RegisterRMResponse{version='1.8.1-SNAPSHOT', extraData='null', identified=true, resultCode=null, msg='null'}] from tc server.
2025-05-25 02:42:21.960 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - will register resourceId:jdbc:mysql://8.133.246.113:3306/deepseek
2025-05-25 02:42:21.960 [main] INFO  i.s.s.a.datasource.SeataAutoDataSourceProxyCreator - Auto proxy data source 'dynamicDataSource' by 'AT' mode.
2025-05-25 02:42:21.967 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.rm.AbstractRMHandler - the rm client received response msg [RegisterRMResponse{version='1.8.1-SNAPSHOT', extraData='null', identified=true, resultCode=null, msg='null'}] from tc server.
2025-05-25 02:42:22.071 [main] INFO  org.hibernate.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-05-25 02:42:22.154 [main] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.1.7.Final
2025-05-25 02:42:22.582 [main] INFO  SQL dialect - HHH000400: Using dialect: org.hibernate.dialect.MySQL8Dialect
2025-05-25 02:42:22.585 [main] WARN  org.hibernate.orm.deprecation - HHH90000026: MySQL8Dialect has been deprecated; use org.hibernate.dialect.MySQLDialect instead
2025-05-25 02:42:22.906 [main] INFO  o.h.e.t.jta.platform.internal.JtaPlatformInitiator - HHH000490: Using JtaPlatform implementation: [org.hibernate.engine.transaction.jta.platform.internal.NoJtaPlatform]
2025-05-25 02:42:22.919 [main] INFO  o.s.orm.jpa.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-05-25 02:42:23.390 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-25 02:42:23.406 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-25 02:42:23.436 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-25 02:42:23.438 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-25 02:42:23.439 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-25 02:42:23.455 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-25 02:42:24.155 [main] INFO  com.bgpay.bgai.service.impl.UserServiceImpl - 初始化SSO配置: clientId=bgai-client-id, redirectUri=http://localhost:8080/api/auth/callback
2025-05-25 02:42:24.307 [main] INFO  com.bgpay.bgai.controller.AuthController - 初始化认证控制器: clientId=bgai-client-id, redirectUri=http://localhost:8080/api/auth/callback
2025-05-25 02:42:24.897 [main] INFO  o.a.r.s.autoconfigure.RocketMQAutoConfiguration - a producer (billing-producer-group) init on namesrv 8.133.246.113:9876
2025-05-25 02:42:25.619 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Bean [com.bgpay.bgai.service.deepseek.DeepSeekServiceImp$$SpringCGLIB$$0] with name [deepSeekServiceImp] would use interceptor [io.seata.spring.annotation.GlobalTransactionalInterceptor]
2025-05-25 02:42:25.946 [main] WARN  i.s.s.b.a.provider.SpringBootConfigurationProvider - The get method not found for the field 'SeataProperties#accesskey'.
2025-05-25 02:42:25.947 [main] WARN  i.s.s.b.a.provider.SpringBootConfigurationProvider - The get method not found for the field 'SeataProperties#secretkey'.
2025-05-25 02:42:25.958 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 加载到1个Saga状态机定义文件
2025-05-25 02:42:26.104 [main] INFO  com.bgpay.bgai.saga.CustomSagaJsonParser - 开始解析状态机定义: bgai-saga-transaction
2025-05-25 02:42:26.105 [main] INFO  com.bgpay.bgai.saga.CustomSagaJsonParser - 状态机定义解析成功: bgai-saga-transaction
2025-05-25 02:42:26.105 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 成功加载状态机定义: /E:/project/bgai/target/classes/statelang/bgai-saga-transaction.json
2025-05-25 02:42:26.527 [main] INFO  org.redisson.Version - Redisson 3.24.3
2025-05-25 02:42:26.668 [redisson-netty-4-6] INFO  o.r.connection.pool.MasterPubSubConnectionPool - 1 connections initialized for 8.133.246.113/8.133.246.113:6379
2025-05-25 02:42:27.003 [redisson-netty-4-19] INFO  org.redisson.connection.pool.MasterConnectionPool - 24 connections initialized for 8.133.246.113/8.133.246.113:6379
2025-05-25 02:42:27.205 [main] INFO  com.bgpay.bgai.service.mq.MQConsumerService - MQ consumer startup successful [group=billing-consumer-group, topic=BILLING_TOPIC, tag=USER_BILLING]
2025-05-25 02:42:27.375 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Bean [com.bgpay.bgai.service.mq.BillingTransactionListenerImpl$$SpringCGLIB$$0] with name [billingTransactionListenerImpl] would use interceptor [io.seata.spring.annotation.GlobalTransactionalInterceptor]
2025-05-25 02:42:27.502 [main] DEBUG com.bgpay.bgai.config.AsyncConfig$1 - Initializing ExecutorService 'blockingExecutor'
2025-05-25 02:42:27.527 [main] INFO  c.b.bgai.config.NacosConfig$NacosWarningHandler - Nacos警告处理器已启用，将忽略配置中心连接警告
2025-05-25 02:42:28.673 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [After]
2025-05-25 02:42:28.673 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Before]
2025-05-25 02:42:28.673 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Between]
2025-05-25 02:42:28.673 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Cookie]
2025-05-25 02:42:28.673 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Header]
2025-05-25 02:42:28.673 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Host]
2025-05-25 02:42:28.673 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Method]
2025-05-25 02:42:28.673 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Path]
2025-05-25 02:42:28.674 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Query]
2025-05-25 02:42:28.674 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [ReadBody]
2025-05-25 02:42:28.674 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [RemoteAddr]
2025-05-25 02:42:28.674 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [XForwardedRemoteAddr]
2025-05-25 02:42:28.674 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Weight]
2025-05-25 02:42:28.674 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [CloudFoundryRouteService]
2025-05-25 02:42:30.280 [main] INFO  o.s.b.actuate.endpoint.web.EndpointLinksResolver - Exposing 3 endpoint(s) beneath base path '/actuator'
2025-05-25 02:42:31.802 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - Starting ProtocolHandler ["http-nio-8080"]
2025-05-25 02:42:31.821 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat started on port(s): 8080 (http) with context path ''
2025-05-25 02:42:31.831 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from ans.namespace attribute : null
2025-05-25 02:42:31.832 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from ALIBABA_ALIWARE_NAMESPACE attribute :null
2025-05-25 02:42:31.832 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from namespace attribute :null
2025-05-25 02:42:31.843 [main] INFO  c.a.n.p.auth.spi.client.ClientAuthPluginManager - [ClientAuthPluginManager] Load ClientAuthService com.alibaba.nacos.client.auth.impl.NacosClientAuthServiceImpl success.
2025-05-25 02:42:31.843 [main] INFO  c.a.n.p.auth.spi.client.ClientAuthPluginManager - [ClientAuthPluginManager] Load ClientAuthService com.alibaba.nacos.client.auth.ram.RamClientAuthServiceImpl success.
2025-05-25 02:42:31.847 [main] INFO  com.alibaba.nacos.common.remote.client - [RpcClientFactory] create a new rpc client of 017bbf3b-db7d-4a0b-a004-22043ba3b940
2025-05-25 02:42:31.848 [main] INFO  com.alibaba.nacos.common.remote.client - [017bbf3b-db7d-4a0b-a004-22043ba3b940] RpcClient init, ServerListFactory = com.alibaba.nacos.client.naming.core.ServerListManager
2025-05-25 02:42:31.848 [main] INFO  com.alibaba.nacos.common.remote.client - [017bbf3b-db7d-4a0b-a004-22043ba3b940] Registry connection listener to current client:com.alibaba.nacos.client.naming.remote.gprc.redo.NamingGrpcRedoService
2025-05-25 02:42:31.849 [main] INFO  com.alibaba.nacos.common.remote.client - [017bbf3b-db7d-4a0b-a004-22043ba3b940] Register server push request handler:com.alibaba.nacos.client.naming.remote.gprc.NamingPushRequestHandler
2025-05-25 02:42:31.849 [main] INFO  com.alibaba.nacos.common.remote.client - [017bbf3b-db7d-4a0b-a004-22043ba3b940] Try to connect to server on start up, server: {serverIp = '8.133.246.113', server main port = 8848}
2025-05-25 02:42:31.849 [main] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - grpc client connection server:8.133.246.113 ip,serverPort:9848,grpcTslConfig:{"sslProvider":"OPENSSL","enableTls":false,"mutualAuthEnable":false,"trustAll":false}
2025-05-25 02:42:31.986 [main] INFO  com.alibaba.nacos.common.remote.client - [017bbf3b-db7d-4a0b-a004-22043ba3b940] Success to connect to server [8.133.246.113:8848] on start up, connectionId = 1748112151898_139.227.195.192_48438
2025-05-25 02:42:31.986 [main] INFO  com.alibaba.nacos.common.remote.client - [017bbf3b-db7d-4a0b-a004-22043ba3b940] Register server push request handler:com.alibaba.nacos.common.remote.client.RpcClient$ConnectResetRequestHandler
2025-05-25 02:42:31.986 [com.alibaba.nacos.client.remote.worker] INFO  com.alibaba.nacos.common.remote.client - [017bbf3b-db7d-4a0b-a004-22043ba3b940] Notify connected event to listeners.
2025-05-25 02:42:31.986 [main] INFO  com.alibaba.nacos.common.remote.client - [017bbf3b-db7d-4a0b-a004-22043ba3b940] Register server push request handler:com.alibaba.nacos.common.remote.client.RpcClient$$Lambda/0x000001863b56e0d8
2025-05-25 02:42:31.986 [com.alibaba.nacos.client.remote.worker] INFO  com.alibaba.nacos.client.naming - Grpc connection connect
2025-05-25 02:42:31.987 [main] INFO  com.alibaba.nacos.client.naming - [REGISTER-SERVICE] d750d92e-152f-4055-a641-3bc9dda85a29 registering service bgtech-ai with instance Instance{instanceId='null', ip='192.168.86.8', port=8080, weight=1.0, healthy=true, enabled=true, ephemeral=true, clusterName='DEFAULT', serviceName='null', metadata={IPv6=[2408:820c:7528:d042:c185:8edc:f30d:3d91], preserved.register.source=SPRING_CLOUD}}
2025-05-25 02:42:32.006 [main] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - nacos registry, DEFAULT_GROUP bgtech-ai 192.168.86.8:8080 register finished
2025-05-25 02:42:32.071 [main] INFO  com.bgpay.bgai.config.NacosConfig - 应用启动完成，当前环境: dev
2025-05-25 02:42:32.071 [main] INFO  com.bgpay.bgai.config.NacosConfig - Nacos配置中心: 8.133.246.113:8848, 命名空间: d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-25 02:42:32.071 [main] INFO  com.bgpay.bgai.config.NacosConfig - 注意: 如果看到Nacos配置加载警告，但应用正常启动，说明应用正在使用本地配置文件
2025-05-25 02:42:32.073 [main] INFO  com.bgpay.bgai.BgaiApplication - Started BgaiApplication in 16.664 seconds (process running for 18.113)
2025-05-25 02:42:32.075 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-25 02:42:32.076 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-25 02:42:32.089 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-25 02:42:32.090 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-25 02:42:32.090 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-25 02:42:32.103 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-25 02:42:32.104 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-25 02:42:32.104 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-25 02:42:32.113 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-25 02:42:32.114 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-25 02:42:32.114 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-25 02:42:32.129 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-25 02:42:32.129 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - ==================== Saga状态机加载报告 ====================
2025-05-25 02:42:32.129 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - Saga状态机配置加载状态: 成功
2025-05-25 02:42:32.129 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 已加载的状态机定义文件数量: 1
2025-05-25 02:42:32.129 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 已加载的状态机定义文件:
2025-05-25 02:42:32.129 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig -  - /E:/project/bgai/target/classes/statelang/bgai-saga-transaction.json
2025-05-25 02:42:32.130 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - Saga解析器状态: CUSTOM_FASTJSON2
2025-05-25 02:42:32.130 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 状态机解析结果: 成功 1 个, 失败 0 个
2025-05-25 02:42:32.130 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - =============================================================
2025-05-25 02:42:32.134 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - nacos.cache.data.init.snapshot = true 
2025-05-25 02:42:32.134 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] common-dev.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-25 02:42:32.143 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=common-dev.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-25 02:42:32.143 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=common-dev.yaml, group=DEFAULT_GROUP
2025-05-25 02:42:32.143 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-25 02:42:32.144 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-25 02:42:32.144 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai.yaml, group=DEFAULT_GROUP
2025-05-25 02:42:32.145 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai-dev.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-25 02:42:32.145 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai-dev.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-25 02:42:32.145 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai-dev.yaml, group=DEFAULT_GROUP
2025-05-25 02:42:32.146 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-25 02:42:32.146 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai, group=DEFAULT_GROUP, cnt=1
2025-05-25 02:42:32.146 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai, group=DEFAULT_GROUP
2025-05-25 02:42:39.499 [Thread-7] WARN  com.alibaba.nacos.common.notify.NotifyCenter - [NotifyCenter] Start destroying Publisher
2025-05-25 02:42:39.499 [Thread-1] WARN  c.alibaba.nacos.common.http.HttpClientBeanHolder - [HttpClientBeanHolder] Start destroying common HttpClient
2025-05-25 02:42:39.500 [Thread-7] WARN  com.alibaba.nacos.common.notify.NotifyCenter - [NotifyCenter] Destruction of the end
2025-05-25 02:42:39.500 [Thread-1] WARN  c.alibaba.nacos.common.http.HttpClientBeanHolder - [HttpClientBeanHolder] Destruction of the end
2025-05-25 02:42:39.515 [SpringContextShutdownHook] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - De-registering from Nacos Server now...
2025-05-25 02:42:39.515 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - [DEREGISTER-SERVICE] d750d92e-152f-4055-a641-3bc9dda85a29 deregistering service bgtech-ai with instance: Instance{instanceId='null', ip='192.168.86.8', port=8080, weight=1.0, healthy=true, enabled=true, ephemeral=true, clusterName='DEFAULT', serviceName='null', metadata={}}
2025-05-25 02:42:39.528 [SpringContextShutdownHook] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - De-registration finished.
2025-05-25 02:42:39.529 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.cache.ServiceInfoHolder do shutdown begin
2025-05-25 02:42:39.529 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.backups.FailoverReactor do shutdown begin
2025-05-25 02:42:39.833 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.backups.FailoverReactor do shutdown stop
2025-05-25 02:42:39.833 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.cache.ServiceInfoHolder do shutdown stop
2025-05-25 02:42:39.833 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.NamingClientProxyDelegate do shutdown begin
2025-05-25 02:42:39.833 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServiceInfoUpdateService do shutdown begin
2025-05-25 02:42:39.833 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServiceInfoUpdateService do shutdown stop
2025-05-25 02:42:39.833 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServerListManager do shutdown begin
2025-05-25 02:42:39.833 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Start destroying NacosRestTemplate
2025-05-25 02:42:39.833 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Destruction of the end
2025-05-25 02:42:39.833 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServerListManager do shutdown stop
2025-05-25 02:42:39.833 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.http.NamingHttpClientProxy do shutdown begin
2025-05-25 02:42:39.833 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Start destroying NacosRestTemplate
2025-05-25 02:42:39.833 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Destruction of the end
2025-05-25 02:42:39.833 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.http.NamingHttpClientProxy do shutdown stop
2025-05-25 02:42:39.833 [SpringContextShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Shutdown rpc client, set status to shutdown
2025-05-25 02:42:39.833 [SpringContextShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Shutdown client event executor java.util.concurrent.ScheduledThreadPoolExecutor@5fe7f384[Running, pool size = 2, active threads = 2, queued tasks = 0, completed tasks = 0]
2025-05-25 02:42:39.834 [SpringContextShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Close current connection 1748112151898_139.227.195.192_48438
2025-05-25 02:42:39.838 [nacos-grpc-client-executor-8.133.246.113-9] WARN  c.a.nacos.common.remote.client.grpc.GrpcClient - [1748112151898_139.227.195.192_48438]Ignore error event,isRunning:false,isAbandon=false
2025-05-25 02:42:39.840 [SpringContextShutdownHook] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - Shutdown grpc executor java.util.concurrent.ThreadPoolExecutor@651ae325[Running, pool size = 10, active threads = 0, queued tasks = 0, completed tasks = 10]
2025-05-25 02:42:39.840 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - Shutdown grpc redo service executor java.util.concurrent.ScheduledThreadPoolExecutor@5e8e40e8[Running, pool size = 1, active threads = 0, queued tasks = 1, completed tasks = 2]
2025-05-25 02:42:39.840 [SpringContextShutdownHook] INFO  c.a.n.client.auth.ram.identify.CredentialWatcher - [null] CredentialWatcher is stopped
2025-05-25 02:42:39.840 [SpringContextShutdownHook] INFO  c.a.n.client.auth.ram.identify.CredentialService - [null] CredentialService is freed
2025-05-25 02:42:39.841 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.NamingClientProxyDelegate do shutdown stop
2025-05-25 02:42:39.849 [SpringContextShutdownHook] DEBUG com.bgpay.bgai.config.AsyncConfig$1 - Shutting down ExecutorService 'blockingExecutor'
2025-05-25 02:42:41.346 [com.alibaba.nacos.client.Worker] INFO  c.a.n.client.auth.ram.identify.CredentialWatcher - null No credential found
2025-05-25 02:42:41.912 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:10911] result: true
2025-05-25 02:42:41.912 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:9876] result: true
2025-05-25 02:42:41.934 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:10911] result: true
2025-05-25 02:42:41.934 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:9876] result: true
2025-05-25 02:42:42.046 [SpringContextShutdownHook] INFO  o.s.orm.jpa.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-05-25 02:42:42.048 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-2} closing ...
2025-05-25 02:42:42.052 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-2} closed
2025-05-25 02:42:42.053 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} closing ...
2025-05-25 02:42:42.053 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} closed
2025-05-25 02:42:42.053 [NettyClientSelector_TMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - channel inactive: [id: 0x205e4845, L:/192.168.86.8:64989 ! R:/8.133.246.113:8091]
2025-05-25 02:42:42.053 [NettyClientSelector_TMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - return to pool, rm channel:[id: 0x205e4845, L:/192.168.86.8:64989 ! R:/8.133.246.113:8091]
2025-05-25 02:42:42.054 [NettyClientSelector_TMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - channel valid false,channel:[id: 0x205e4845, L:/192.168.86.8:64989 ! R:/8.133.246.113:8091]
2025-05-25 02:42:42.054 [NettyClientSelector_TMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - will destroy channel:[id: 0x205e4845, L:/192.168.86.8:64989 ! R:/8.133.246.113:8091]
2025-05-25 02:42:42.054 [NettyClientSelector_TMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0x205e4845, L:/192.168.86.8:64989 ! R:/8.133.246.113:8091]) will closed
2025-05-25 02:42:42.054 [NettyClientSelector_TMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0x205e4845, L:/192.168.86.8:64989 ! R:/8.133.246.113:8091]) will closed
2025-05-25 02:42:42.054 [NettyClientSelector_RMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - channel inactive: [id: 0xf2bb6d3d, L:/192.168.86.8:64991 ! R:/8.133.246.113:8091]
2025-05-25 02:42:42.055 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - return to pool, rm channel:[id: 0xf2bb6d3d, L:/192.168.86.8:64991 ! R:/8.133.246.113:8091]
2025-05-25 02:42:42.055 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - channel valid false,channel:[id: 0xf2bb6d3d, L:/192.168.86.8:64991 ! R:/8.133.246.113:8091]
2025-05-25 02:42:42.055 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - will destroy channel:[id: 0xf2bb6d3d, L:/192.168.86.8:64991 ! R:/8.133.246.113:8091]
2025-05-25 02:42:42.055 [NettyClientSelector_RMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0xf2bb6d3d, L:/192.168.86.8:64991 ! R:/8.133.246.113:8091]) will closed
2025-05-25 02:42:42.055 [NettyClientSelector_RMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0xf2bb6d3d, L:/192.168.86.8:64991 ! R:/8.133.246.113:8091]) will closed
2025-05-25 03:04:56.957 [main] WARN  com.alibaba.nacos.client.logging.NacosLogging - Load Logback Configuration of Nacos fail, message: Could not initialize Logback Nacos logging from classpath:nacos-logback.xml
2025-05-25 03:04:56.958 [main] INFO  com.bgpay.bgai.BgaiApplication - The following 1 profile is active: "dev"
2025-05-25 03:04:58.251 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-05-25 03:04:58.252 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-05-25 03:04:58.284 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 23 ms. Found 0 JPA repository interfaces.
2025-05-25 03:04:58.301 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-05-25 03:04:58.302 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-05-25 03:04:58.320 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 6 ms. Found 0 Redis repository interfaces.
2025-05-25 03:04:58.975 [main] INFO  io.seata.config.ConfigurationFactory - load Configuration from :Spring Configuration
2025-05-25 03:04:58.986 [main] INFO  io.seata.config.ConfigurationFactory - load Configuration from :Spring Configuration
2025-05-25 03:04:58.994 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Initializing Global Transaction Clients ... 
2025-05-25 03:04:59.102 [main] INFO  io.seata.core.rpc.netty.NettyClientBootstrap - NettyClientBootstrap has started
2025-05-25 03:04:59.103 [main] INFO  io.seata.discovery.registry.RegistryFactory - use registry center type: file
2025-05-25 03:04:59.113 [main] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - will connect to 8.133.246.113:8091
2025-05-25 03:04:59.117 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - NettyPool create channel to transactionRole:TMROLE,address:8.133.246.113:8091,msg:< RegisterTMRequest{version='1.7.0', applicationId='bgtech-ai', transactionServiceGroup='bgai-tx-group', extraData='ak=null
digest=bgai-tx-group,192.168.86.8,1748113499115
timestamp=1748113499115
authVersion=V4
vgroup=bgai-tx-group
ip=192.168.86.8
'} >
2025-05-25 03:04:59.259 [main] INFO  io.seata.core.rpc.netty.TmNettyRemotingClient - register TM success. client version:1.7.0, server version:1.8.1-SNAPSHOT,channel:[id: 0x9705679e, L:/192.168.86.8:49777 - R:/8.133.246.113:8091]
2025-05-25 03:04:59.265 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - register success, cost 69 ms, version:1.8.1-SNAPSHOT,role:TMROLE,channel:[id: 0x9705679e, L:/192.168.86.8:49777 - R:/8.133.246.113:8091]
2025-05-25 03:04:59.266 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Transaction Manager Client is initialized. applicationId[bgtech-ai] txServiceGroup[bgai-tx-group]
2025-05-25 03:04:59.279 [main] INFO  io.seata.rm.datasource.AsyncWorker - Async Commit Buffer Limit: 10000
2025-05-25 03:04:59.280 [main] INFO  io.seata.rm.datasource.xa.ResourceManagerXA - ResourceManagerXA init ...
2025-05-25 03:04:59.287 [main] INFO  io.seata.core.rpc.netty.NettyClientBootstrap - NettyClientBootstrap has started
2025-05-25 03:04:59.287 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Resource Manager is initialized. applicationId[bgtech-ai] txServiceGroup[bgai-tx-group]
2025-05-25 03:04:59.287 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Global Transaction Clients are initialized. 
2025-05-25 03:05:00.400 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat initialized with port(s): 8080 (http)
2025-05-25 03:05:00.412 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - The ["http-nio-8080"] connector has been configured to support HTTP upgrade to [h2c]
2025-05-25 03:05:00.412 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - Initializing ProtocolHandler ["http-nio-8080"]
2025-05-25 03:05:00.414 [main] INFO  org.apache.catalina.core.StandardService - Starting service [Tomcat]
2025-05-25 03:05:00.414 [main] INFO  org.apache.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.15]
2025-05-25 03:05:00.816 [main] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} inited
2025-05-25 03:05:01.074 [main] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - will connect to 8.133.246.113:8091
2025-05-25 03:05:01.074 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - RM will register :jdbc:mysql://8.133.246.113:3306/deepseek
2025-05-25 03:05:01.074 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - NettyPool create channel to transactionRole:RMROLE,address:8.133.246.113:8091,msg:< RegisterRMRequest{resourceIds='jdbc:mysql://8.133.246.113:3306/deepseek', version='1.7.0', applicationId='bgtech-ai', transactionServiceGroup='bgai-tx-group', extraData='null'} >
2025-05-25 03:05:01.119 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - register RM success. client version:1.7.0, server version:1.8.1-SNAPSHOT,channel:[id: 0xcdda072f, L:/192.168.86.8:49779 - R:/8.133.246.113:8091]
2025-05-25 03:05:01.119 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - register success, cost 37 ms, version:1.8.1-SNAPSHOT,role:RMROLE,channel:[id: 0xcdda072f, L:/192.168.86.8:49779 - R:/8.133.246.113:8091]
2025-05-25 03:05:01.127 [main] INFO  i.s.s.a.datasource.SeataAutoDataSourceProxyCreator - Auto proxy data source 'masterDataSource' by 'AT' mode.
2025-05-25 03:05:01.201 [main] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-2} inited
2025-05-25 03:05:01.264 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - will register resourceId:jdbc:mysql://8.133.246.113:3306/deepseek
2025-05-25 03:05:01.265 [main] INFO  i.s.s.a.datasource.SeataAutoDataSourceProxyCreator - Auto proxy data source 'slaveDataSource' by 'AT' mode.
2025-05-25 03:05:01.272 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.rm.AbstractRMHandler - the rm client received response msg [RegisterRMResponse{version='1.8.1-SNAPSHOT', extraData='null', identified=true, resultCode=null, msg='null'}] from tc server.
2025-05-25 03:05:01.286 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - will register resourceId:jdbc:mysql://8.133.246.113:3306/deepseek
2025-05-25 03:05:01.287 [main] INFO  i.s.s.a.datasource.SeataAutoDataSourceProxyCreator - Auto proxy data source 'dynamicDataSource' by 'AT' mode.
2025-05-25 03:05:01.298 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.rm.AbstractRMHandler - the rm client received response msg [RegisterRMResponse{version='1.8.1-SNAPSHOT', extraData='null', identified=true, resultCode=null, msg='null'}] from tc server.
2025-05-25 03:05:01.392 [main] INFO  org.hibernate.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-05-25 03:05:01.437 [main] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.1.7.Final
2025-05-25 03:05:01.765 [main] INFO  SQL dialect - HHH000400: Using dialect: org.hibernate.dialect.MySQL8Dialect
2025-05-25 03:05:01.769 [main] WARN  org.hibernate.orm.deprecation - HHH90000026: MySQL8Dialect has been deprecated; use org.hibernate.dialect.MySQLDialect instead
2025-05-25 03:05:02.087 [main] INFO  o.h.e.t.jta.platform.internal.JtaPlatformInitiator - HHH000490: Using JtaPlatform implementation: [org.hibernate.engine.transaction.jta.platform.internal.NoJtaPlatform]
2025-05-25 03:05:02.098 [main] INFO  o.s.orm.jpa.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-05-25 03:05:02.479 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-25 03:05:02.490 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-25 03:05:02.515 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-25 03:05:02.517 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-25 03:05:02.517 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-25 03:05:02.527 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-25 03:05:03.117 [main] INFO  com.bgpay.bgai.service.impl.UserServiceImpl - 初始化SSO配置: clientId=bgai-client-id, redirectUri=http://localhost:8080/api/auth/callback
2025-05-25 03:05:03.281 [main] INFO  com.bgpay.bgai.controller.AuthController - 初始化认证控制器: clientId=bgai-client-id, redirectUri=http://localhost:8080/api/auth/callback
2025-05-25 03:05:03.869 [main] INFO  o.a.r.s.autoconfigure.RocketMQAutoConfiguration - a producer (billing-producer-group) init on namesrv 8.133.246.113:9876
2025-05-25 03:05:04.483 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Bean [com.bgpay.bgai.service.deepseek.DeepSeekServiceImp$$SpringCGLIB$$0] with name [deepSeekServiceImp] would use interceptor [io.seata.spring.annotation.GlobalTransactionalInterceptor]
2025-05-25 03:05:04.816 [main] WARN  i.s.s.b.a.provider.SpringBootConfigurationProvider - The get method not found for the field 'SeataProperties#accesskey'.
2025-05-25 03:05:04.817 [main] WARN  i.s.s.b.a.provider.SpringBootConfigurationProvider - The get method not found for the field 'SeataProperties#secretkey'.
2025-05-25 03:05:04.831 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 加载到1个Saga状态机定义文件
2025-05-25 03:05:05.020 [main] INFO  com.bgpay.bgai.saga.CustomSagaJsonParser - 开始解析状态机定义: bgai-saga-transaction
2025-05-25 03:05:05.021 [main] INFO  com.bgpay.bgai.saga.CustomSagaJsonParser - 状态机定义解析成功: bgai-saga-transaction
2025-05-25 03:05:05.021 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 成功加载状态机定义: /E:/project/bgai/target/classes/statelang/bgai-saga-transaction.json
2025-05-25 03:05:05.422 [main] INFO  org.redisson.Version - Redisson 3.24.3
2025-05-25 03:05:05.550 [redisson-netty-4-8] INFO  o.r.connection.pool.MasterPubSubConnectionPool - 1 connections initialized for 8.133.246.113/8.133.246.113:6379
2025-05-25 03:05:05.862 [redisson-netty-4-19] INFO  org.redisson.connection.pool.MasterConnectionPool - 24 connections initialized for 8.133.246.113/8.133.246.113:6379
2025-05-25 03:05:06.024 [main] INFO  com.bgpay.bgai.service.mq.MQConsumerService - MQ consumer startup successful [group=billing-consumer-group, topic=BILLING_TOPIC, tag=USER_BILLING]
2025-05-25 03:05:06.170 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Bean [com.bgpay.bgai.service.mq.BillingTransactionListenerImpl$$SpringCGLIB$$0] with name [billingTransactionListenerImpl] would use interceptor [io.seata.spring.annotation.GlobalTransactionalInterceptor]
2025-05-25 03:05:06.358 [main] DEBUG com.bgpay.bgai.config.AsyncConfig$1 - Initializing ExecutorService 'blockingExecutor'
2025-05-25 03:05:06.429 [main] INFO  c.b.bgai.config.NacosConfig$NacosWarningHandler - Nacos警告处理器已启用，将忽略配置中心连接警告
2025-05-25 03:05:07.491 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [After]
2025-05-25 03:05:07.492 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Before]
2025-05-25 03:05:07.492 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Between]
2025-05-25 03:05:07.492 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Cookie]
2025-05-25 03:05:07.492 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Header]
2025-05-25 03:05:07.492 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Host]
2025-05-25 03:05:07.492 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Method]
2025-05-25 03:05:07.492 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Path]
2025-05-25 03:05:07.492 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Query]
2025-05-25 03:05:07.492 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [ReadBody]
2025-05-25 03:05:07.492 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [RemoteAddr]
2025-05-25 03:05:07.492 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [XForwardedRemoteAddr]
2025-05-25 03:05:07.492 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Weight]
2025-05-25 03:05:07.492 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [CloudFoundryRouteService]
2025-05-25 03:05:08.913 [main] INFO  o.s.b.actuate.endpoint.web.EndpointLinksResolver - Exposing 3 endpoint(s) beneath base path '/actuator'
2025-05-25 03:05:10.400 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - Starting ProtocolHandler ["http-nio-8080"]
2025-05-25 03:05:10.418 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat started on port(s): 8080 (http) with context path ''
2025-05-25 03:05:10.428 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from ans.namespace attribute : null
2025-05-25 03:05:10.429 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from ALIBABA_ALIWARE_NAMESPACE attribute :null
2025-05-25 03:05:10.429 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from namespace attribute :null
2025-05-25 03:05:10.437 [main] INFO  c.a.n.p.auth.spi.client.ClientAuthPluginManager - [ClientAuthPluginManager] Load ClientAuthService com.alibaba.nacos.client.auth.impl.NacosClientAuthServiceImpl success.
2025-05-25 03:05:10.437 [main] INFO  c.a.n.p.auth.spi.client.ClientAuthPluginManager - [ClientAuthPluginManager] Load ClientAuthService com.alibaba.nacos.client.auth.ram.RamClientAuthServiceImpl success.
2025-05-25 03:05:10.441 [main] INFO  com.alibaba.nacos.common.remote.client - [RpcClientFactory] create a new rpc client of ab235272-6817-480e-9e98-acec6307f918
2025-05-25 03:05:10.444 [main] INFO  com.alibaba.nacos.common.remote.client - [ab235272-6817-480e-9e98-acec6307f918] RpcClient init, ServerListFactory = com.alibaba.nacos.client.naming.core.ServerListManager
2025-05-25 03:05:10.444 [main] INFO  com.alibaba.nacos.common.remote.client - [ab235272-6817-480e-9e98-acec6307f918] Registry connection listener to current client:com.alibaba.nacos.client.naming.remote.gprc.redo.NamingGrpcRedoService
2025-05-25 03:05:10.444 [main] INFO  com.alibaba.nacos.common.remote.client - [ab235272-6817-480e-9e98-acec6307f918] Register server push request handler:com.alibaba.nacos.client.naming.remote.gprc.NamingPushRequestHandler
2025-05-25 03:05:10.445 [main] INFO  com.alibaba.nacos.common.remote.client - [ab235272-6817-480e-9e98-acec6307f918] Try to connect to server on start up, server: {serverIp = '8.133.246.113', server main port = 8848}
2025-05-25 03:05:10.445 [main] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - grpc client connection server:8.133.246.113 ip,serverPort:9848,grpcTslConfig:{"sslProvider":"OPENSSL","enableTls":false,"mutualAuthEnable":false,"trustAll":false}
2025-05-25 03:05:10.581 [main] INFO  com.alibaba.nacos.common.remote.client - [ab235272-6817-480e-9e98-acec6307f918] Success to connect to server [8.133.246.113:8848] on start up, connectionId = 1748113510491_139.227.195.192_48971
2025-05-25 03:05:10.581 [main] INFO  com.alibaba.nacos.common.remote.client - [ab235272-6817-480e-9e98-acec6307f918] Register server push request handler:com.alibaba.nacos.common.remote.client.RpcClient$ConnectResetRequestHandler
2025-05-25 03:05:10.581 [main] INFO  com.alibaba.nacos.common.remote.client - [ab235272-6817-480e-9e98-acec6307f918] Register server push request handler:com.alibaba.nacos.common.remote.client.RpcClient$$Lambda/0x0000024681528cd8
2025-05-25 03:05:10.581 [com.alibaba.nacos.client.remote.worker] INFO  com.alibaba.nacos.common.remote.client - [ab235272-6817-480e-9e98-acec6307f918] Notify connected event to listeners.
2025-05-25 03:05:10.581 [com.alibaba.nacos.client.remote.worker] INFO  com.alibaba.nacos.client.naming - Grpc connection connect
2025-05-25 03:05:10.582 [main] INFO  com.alibaba.nacos.client.naming - [REGISTER-SERVICE] d750d92e-152f-4055-a641-3bc9dda85a29 registering service bgtech-ai with instance Instance{instanceId='null', ip='192.168.86.8', port=8080, weight=1.0, healthy=true, enabled=true, ephemeral=true, clusterName='DEFAULT', serviceName='null', metadata={IPv6=[2408:820c:7528:d042:c185:8edc:f30d:3d91], preserved.register.source=SPRING_CLOUD}}
2025-05-25 03:05:10.602 [main] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - nacos registry, DEFAULT_GROUP bgtech-ai 192.168.86.8:8080 register finished
2025-05-25 03:05:10.660 [main] INFO  com.bgpay.bgai.config.NacosConfig - 应用启动完成，当前环境: dev
2025-05-25 03:05:10.660 [main] INFO  com.bgpay.bgai.config.NacosConfig - Nacos配置中心: 8.133.246.113:8848, 命名空间: d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-25 03:05:10.661 [main] INFO  com.bgpay.bgai.config.NacosConfig - 注意: 如果看到Nacos配置加载警告，但应用正常启动，说明应用正在使用本地配置文件
2025-05-25 03:05:10.662 [main] INFO  com.bgpay.bgai.BgaiApplication - Started BgaiApplication in 15.845 seconds (process running for 17.179)
2025-05-25 03:05:10.664 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-25 03:05:10.664 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-25 03:05:10.676 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-25 03:05:10.677 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-25 03:05:10.677 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-25 03:05:10.688 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-25 03:05:10.689 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-25 03:05:10.689 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-25 03:05:10.697 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-25 03:05:10.697 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-25 03:05:10.698 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-25 03:05:10.703 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-25 03:05:10.703 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - ==================== Saga状态机加载报告 ====================
2025-05-25 03:05:10.703 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - Saga状态机配置加载状态: 成功
2025-05-25 03:05:10.703 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 已加载的状态机定义文件数量: 1
2025-05-25 03:05:10.703 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 已加载的状态机定义文件:
2025-05-25 03:05:10.703 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig -  - /E:/project/bgai/target/classes/statelang/bgai-saga-transaction.json
2025-05-25 03:05:10.703 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - Saga解析器状态: CUSTOM_FASTJSON2
2025-05-25 03:05:10.703 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 状态机解析结果: 成功 1 个, 失败 0 个
2025-05-25 03:05:10.703 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - =============================================================
2025-05-25 03:05:10.708 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - nacos.cache.data.init.snapshot = true 
2025-05-25 03:05:10.709 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] common-dev.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-25 03:05:10.719 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=common-dev.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-25 03:05:10.719 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=common-dev.yaml, group=DEFAULT_GROUP
2025-05-25 03:05:10.719 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-25 03:05:10.720 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-25 03:05:10.720 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai.yaml, group=DEFAULT_GROUP
2025-05-25 03:05:10.722 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai-dev.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-25 03:05:10.722 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai-dev.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-25 03:05:10.722 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai-dev.yaml, group=DEFAULT_GROUP
2025-05-25 03:05:10.723 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-25 03:05:10.723 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai, group=DEFAULT_GROUP, cnt=1
2025-05-25 03:05:10.723 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai, group=DEFAULT_GROUP
2025-05-25 03:05:16.099 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - 接收到请求: /api/chatGatWay-internal, 文件=新文件 17.txt, 问题参数=null, 模型参数=null
2025-05-25 03:05:16.100 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - 请求Content-Type: multipart/form-data;boundary=--------------------------157330544582161975256717
2025-05-25 03:05:16.101 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - 收集到的完整参数: question="null", apiUrl="null", modelName="null", multiTurn=false
2025-05-25 03:05:16.102 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - Processing request for user ID: 689258T
2025-05-25 03:05:16.102 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - Processing file with circuit breaker: fileName=新文件 17.txt, question=
2025-05-25 03:05:16.104 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.config.ReactiveFileProcessor - Processing file: 新文件 17.txt, content-type: text/plain
2025-05-25 03:05:16.110 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - PARAM TRACE [689258T]: 尝试查找匹配配置 - 参数: apiUrl=null, modelName=null
2025-05-25 03:05:16.119 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 查询配置 - userId=689258T
2025-05-25 03:05:16.120 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 排序方式 - 按ID降序
2025-05-25 03:05:16.120 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 限制结果数 - LIMIT 1
2025-05-25 03:05:16.179 [http-nio-8080-exec-2] DEBUG com.bgpay.bgai.mapper.ApiConfigMapper.selectList - ==>  Preparing: SELECT id,api_url,api_key,model_name,user_id FROM api_config WHERE (user_id = ?) ORDER BY id DESC LIMIT 1
2025-05-25 03:05:16.180 [http-nio-8080-exec-2] DEBUG com.bgpay.bgai.mapper.ApiConfigMapper.selectList - ==> Parameters: 689258T(String)
2025-05-25 03:05:16.188 [http-nio-8080-exec-2] DEBUG com.bgpay.bgai.mapper.ApiConfigMapper.selectList - <==      Total: 1
2025-05-25 03:05:16.189 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 查询结果 - 找到配置: id=2, modelName=deepseek-chat
2025-05-25 03:05:16.189 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - PARAM TRACE [689258T]: 找到匹配配置 - apiUrl=https://api.deepseek.com/chat/completions, modelName=deepseek-chat (原始请求: null)
2025-05-25 03:05:16.189 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - API config resolved: url=https://api.deepseek.com/chat/completions, model=deepseek-chat
2025-05-25 03:05:16.204 [Thread-49] INFO  com.bgpay.bgai.config.ReactiveFileProcessor - File processed successfully: size=37 bytes
2025-05-25 03:05:16.209 [Thread-49] INFO  com.bgpay.bgai.controller.ReactiveChatController - Content processed, length: 54
2025-05-25 03:05:16.214 [Thread-49] INFO  io.seata.tm.TransactionManagerHolder - TransactionManager Singleton io.seata.tm.DefaultTransactionManager@4b9d7ff7
2025-05-25 03:05:16.232 [Thread-49] INFO  io.seata.tm.api.DefaultGlobalTransaction - Begin new global transaction [seata-server:8091:153776404394049609]
2025-05-25 03:05:16.234 [Thread-49] INFO  c.b.bgai.interceptor.SeataTransactionInterceptor - 准备记录分布式事务开始: XID=seata-server:8091:153776404394049609, 业务=com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive, 路径=, IP=, 用户=system
2025-05-25 03:05:16.250 [Thread-49] INFO  c.b.bgai.service.impl.TransactionLogServiceImpl - 记录分布式事务开始: XID=seata-server:8091:153776404394049609, 业务=com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive
2025-05-25 03:05:16.256 [Thread-49] DEBUG com.bgpay.bgai.mapper.TransactionLogMapper.insert - ==>  Preparing: INSERT INTO transaction_log ( xid, transaction_name, transaction_mode, status, request_path, source_ip, start_time, user_id, create_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-05-25 03:05:16.260 [Thread-49] DEBUG com.bgpay.bgai.mapper.TransactionLogMapper.insert - ==> Parameters: seata-server:8091:153776404394049609(String), com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive(String), AT(String), ACTIVE(String), (String), (String), 2025-05-25T03:05:16.250950900(LocalDateTime), system(String), 2025-05-25T03:05:16.250950900(LocalDateTime)
2025-05-25 03:05:16.687 [Thread-49] DEBUG com.bgpay.bgai.mapper.TransactionLogMapper.insert - <==    Updates: 1
2025-05-25 03:05:16.716 [Thread-49] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:153776404394049609, branchId:153776404394049610, lockKeys:transaction_log:45
2025-05-25 03:05:16.727 [Thread-49] WARN  i.s.c.l.EnhancedServiceLoader$InnerEnhancedServiceLoader - Load [io.seata.rm.datasource.undo.parser.ProtostuffUndoLogParser] class fail: io/protostuff/runtime/IdStrategy
2025-05-25 03:05:16.805 [Thread-49] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:153776404394049609, branchId:153776404394049611, lockKeys:undo_log:179;transaction_log:45
2025-05-25 03:05:16.845 [Thread-49] INFO  c.b.bgai.interceptor.SeataTransactionInterceptor - 开始分布式事务: XID=seata-server:8091:153776404394049609, 方法=com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive
2025-05-25 03:05:16.857 [Thread-49] INFO  org.reflections.Reflections - Processing reactive request: content length=54, apiUrl=https://api.deepseek.com/chat/completions, modelName=deepseek-chat, userId=689258T, multiTurn=false
2025-05-25 03:05:16.867 [Thread-49] INFO  c.b.bgai.service.impl.TransactionLogServiceImpl - 记录分布式事务结束: XID=seata-server:8091:153776404394049609, 状态=COMMITTED
2025-05-25 03:05:16.868 [Thread-49] DEBUG c.b.bgai.mapper.TransactionLogMapper.selectList - ==>  Preparing: SELECT id,xid,branch_id,transaction_name,transaction_mode,status,request_path,source_ip,start_time,end_time,user_id,extra_data,create_time,update_time FROM transaction_log WHERE (xid = ?) LIMIT 1
2025-05-25 03:05:16.870 [Thread-49] DEBUG c.b.bgai.mapper.TransactionLogMapper.selectList - ==> Parameters: seata-server:8091:153776404394049609(String)
2025-05-25 03:05:16.877 [Thread-49] DEBUG c.b.bgai.mapper.TransactionLogMapper.selectList - <==      Total: 1
2025-05-25 03:05:16.881 [Thread-49] DEBUG c.b.bgai.mapper.TransactionLogMapper.updateById - ==>  Preparing: UPDATE transaction_log SET xid=?, transaction_name=?, transaction_mode=?, status=?, request_path=?, source_ip=?, start_time=?, end_time=?, user_id=?, extra_data=?, create_time=?, update_time=? WHERE id=?
2025-05-25 03:05:16.888 [Thread-49] DEBUG c.b.bgai.mapper.TransactionLogMapper.updateById - ==> Parameters: seata-server:8091:153776404394049609(String), com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive(String), AT(String), COMMITTED(String), (String), (String), 2025-05-25T03:05:16(LocalDateTime), 2025-05-25T03:05:16.878524600(LocalDateTime), system(String), {"duration":14,"result":"success"}(String), 2025-05-25T03:05:16(LocalDateTime), 2025-05-25T03:05:16.878524600(LocalDateTime), 45(Long)
2025-05-25 03:05:16.969 [Thread-49] DEBUG c.b.bgai.mapper.TransactionLogMapper.updateById - <==    Updates: 1
2025-05-25 03:05:16.986 [Thread-49] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:153776404394049609, branchId:153776404394049612, lockKeys:transaction_log:45
2025-05-25 03:05:17.014 [Thread-49] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:153776404394049609, branchId:153776404394049613, lockKeys:transaction_log:45;undo_log:181
2025-05-25 03:05:17.058 [Thread-49] INFO  c.b.bgai.interceptor.SeataTransactionInterceptor - 分布式事务成功完成: XID=seata-server:8091:153776404394049609, 耗时=14ms
2025-05-25 03:05:17.058 [Thread-49] INFO  io.seata.tm.api.DefaultGlobalTransaction - transaction seata-server:8091:153776404394049609 will be commit
2025-05-25 03:05:17.068 [Thread-49] INFO  io.seata.tm.api.DefaultGlobalTransaction - transaction end, xid = seata-server:8091:153776404394049609
2025-05-25 03:05:17.068 [Thread-49] INFO  io.seata.tm.api.DefaultGlobalTransaction - [seata-server:8091:153776404394049609] commit status: Committed
2025-05-25 03:05:17.126 [boundedElastic-1] INFO  com.bgpay.bgai.transaction.TransactionCoordinator - Transaction prepared for user 689258T: chatCompletionId=chat-9461c381-b596-46f4-9d66-62aed4f11183
2025-05-25 03:05:17.127 [boundedElastic-1] INFO  org.reflections.Reflections - Transaction prepared with chatCompletionId: chat-9461c381-b596-46f4-9d66-62aed4f11183
2025-05-25 03:05:17.771 [rpcDispatch_RMROLE_1_1_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:153776404394049609', branchId=153776404394049610, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false,"skipCheckLock":true}'}
2025-05-25 03:05:17.772 [rpcDispatch_RMROLE_1_1_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:153776404394049609 153776404394049610 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false,"skipCheckLock":true}
2025-05-25 03:05:17.773 [rpcDispatch_RMROLE_1_1_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-25 03:05:17.783 [rpcDispatch_RMROLE_1_2_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:153776404394049609', branchId=153776404394049611, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false,"skipCheckLock":true}'}
2025-05-25 03:05:17.783 [rpcDispatch_RMROLE_1_2_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:153776404394049609 153776404394049611 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false,"skipCheckLock":true}
2025-05-25 03:05:17.783 [rpcDispatch_RMROLE_1_2_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-25 03:05:17.799 [rpcDispatch_RMROLE_1_3_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:153776404394049609', branchId=153776404394049612, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false}'}
2025-05-25 03:05:17.799 [rpcDispatch_RMROLE_1_3_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:153776404394049609 153776404394049612 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false}
2025-05-25 03:05:17.800 [rpcDispatch_RMROLE_1_3_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-25 03:05:17.808 [rpcDispatch_RMROLE_1_4_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:153776404394049609', branchId=153776404394049613, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false}'}
2025-05-25 03:05:17.809 [rpcDispatch_RMROLE_1_4_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:153776404394049609 153776404394049613 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false}
2025-05-25 03:05:17.809 [rpcDispatch_RMROLE_1_4_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-25 03:05:54.021 [FileWrite-1] INFO  com.bgpay.bgai.service.deepseek.FileWriterService - Successfully wrote content to: \var\data\ai_responses\b4ada3b0-9f9f-4807-a803-47bb39bf6d13.txt
2025-05-25 03:05:54.037 [reactor-http-nio-2] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - ==>  Preparing: INSERT INTO chat_completions ( object, created, model, system_fingerprint, api_key ) VALUES ( ?, ?, ?, ?, ? )
2025-05-25 03:05:54.038 [reactor-http-nio-2] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - ==> Parameters: chat.completion(String), 1748113554035(Long), deepseek-chat(String), 689258T(String), chat-9461c381-b596-46f4-9d66-62aed4f11183(String)
2025-05-25 03:05:54.050 [reactor-http-nio-2] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - <==    Updates: 1
2025-05-25 03:05:54.052 [reactor-http-nio-2] INFO  com.bgpay.bgai.transaction.TransactionCoordinator - Transaction committed for user 689258T: chatCompletionId=chat-9461c381-b596-46f4-9d66-62aed4f11183
2025-05-25 03:05:54.072 [reactor-http-nio-2] INFO  org.reflections.Reflections - 开始发送账单消息，chatCompletionId: chat-9461c381-b596-46f4-9d66-62aed4f11183, userId: 689258T
2025-05-25 03:05:54.131 [reactor-http-nio-2] INFO  io.seata.tm.api.DefaultGlobalTransaction - Begin new global transaction [seata-server:8091:153776404394049614]
2025-05-25 03:05:54.132 [reactor-http-nio-2] INFO  c.b.bgai.interceptor.SeataTransactionInterceptor - 准备记录分布式事务开始: XID=seata-server:8091:153776404394049614, 业务=com.bgpay.bgai.service.mq.BillingTransactionListenerImpl.executeLocalTransaction, 路径=, IP=, 用户=system
2025-05-25 03:05:54.142 [reactor-http-nio-2] INFO  c.b.bgai.service.impl.TransactionLogServiceImpl - 记录分布式事务开始: XID=seata-server:8091:153776404394049614, 业务=com.bgpay.bgai.service.mq.BillingTransactionListenerImpl.executeLocalTransaction
2025-05-25 03:05:54.143 [reactor-http-nio-2] DEBUG com.bgpay.bgai.mapper.TransactionLogMapper.insert - ==>  Preparing: INSERT INTO transaction_log ( xid, transaction_name, transaction_mode, status, request_path, source_ip, start_time, user_id, create_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-05-25 03:05:54.144 [reactor-http-nio-2] DEBUG com.bgpay.bgai.mapper.TransactionLogMapper.insert - ==> Parameters: seata-server:8091:153776404394049614(String), com.bgpay.bgai.service.mq.BillingTransactionListenerImpl.executeLocalTransaction(String), AT(String), ACTIVE(String), (String), (String), 2025-05-25T03:05:54.142585700(LocalDateTime), system(String), 2025-05-25T03:05:54.142585700(LocalDateTime)
2025-05-25 03:05:54.169 [reactor-http-nio-2] DEBUG com.bgpay.bgai.mapper.TransactionLogMapper.insert - <==    Updates: 1
2025-05-25 03:05:54.180 [reactor-http-nio-2] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:153776404394049614, branchId:153776404394049615, lockKeys:transaction_log:46
2025-05-25 03:05:54.202 [reactor-http-nio-2] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:153776404394049614, branchId:153776404394049616, lockKeys:transaction_log:46;undo_log:183
2025-05-25 03:05:54.228 [reactor-http-nio-2] INFO  c.b.bgai.interceptor.SeataTransactionInterceptor - 开始分布式事务: XID=seata-server:8091:153776404394049614, 方法=com.bgpay.bgai.service.mq.BillingTransactionListenerImpl.executeLocalTransaction
2025-05-25 03:05:54.229 [reactor-http-nio-2] INFO  c.b.bgai.service.mq.BillingTransactionListenerImpl - 开始执行本地事务, xid: seata-server:8091:153776404394049614, userId: 689258T, completionId: chat-9461c381-b596-46f4-9d66-62aed4f11183
2025-05-25 03:05:54.239 [reactor-http-nio-2] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.selectCount - ==>  Preparing: SELECT COUNT( * ) AS total FROM usage_info WHERE (chat_completion_id = ?)
2025-05-25 03:05:54.240 [reactor-http-nio-2] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.selectCount - ==> Parameters: chat-9461c381-b596-46f4-9d66-62aed4f11183(String)
2025-05-25 03:05:54.246 [reactor-http-nio-2] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.selectCount - <==      Total: 1
2025-05-25 03:05:54.290 [reactor-http-nio-2] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.selectCount - ==>  Preparing: SELECT COUNT( * ) AS total FROM usage_info WHERE (chat_completion_id = ?)
2025-05-25 03:05:54.290 [reactor-http-nio-2] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.selectCount - ==> Parameters: chat-9461c381-b596-46f4-9d66-62aed4f11183(String)
2025-05-25 03:05:54.295 [reactor-http-nio-2] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.selectCount - <==      Total: 1
2025-05-25 03:05:54.299 [reactor-http-nio-2] DEBUG com.bgpay.bgai.mapper.UsageRecordMapper.insert - ==>  Preparing: INSERT INTO usage_record ( model_type, chat_completion_id, user_id, input_cost, output_cost, price_version, calculated_at, input_tokens, output_tokens, status, created_at ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-05-25 03:05:54.301 [reactor-http-nio-2] DEBUG com.bgpay.bgai.mapper.UsageRecordMapper.insert - ==> Parameters: deepseek-chat(String), chat-9461c381-b596-46f4-9d66-62aed4f11183(String), 689258T(String), 0.030(BigDecimal), 1.656(BigDecimal), 1(Integer), 2025-05-25T03:05:54.072860200(LocalDateTime), 30(Integer), 828(Integer), PENDING(String), 2025-05-25T03:05:54.296192(LocalDateTime)
2025-05-25 03:05:54.365 [reactor-http-nio-2] DEBUG com.bgpay.bgai.mapper.UsageRecordMapper.insert - <==    Updates: 1
2025-05-25 03:05:54.373 [reactor-http-nio-2] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.insert - ==>  Preparing: INSERT INTO usage_info ( chat_completion_id, prompt_tokens, completion_tokens, total_tokens, prompt_tokens_cached, completion_reasoning_tokens, prompt_cache_hit_tokens, prompt_cache_miss_tokens, created_at, model_type ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-05-25 03:05:54.374 [reactor-http-nio-2] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.insert - ==> Parameters: chat-9461c381-b596-46f4-9d66-62aed4f11183(String), 30(Integer), 828(Integer), 858(Integer), 0(Integer), 0(Integer), 0(Integer), 30(Integer), 2025-05-25T03:05:54.368194200(LocalDateTime), deepseek-chat(String)
2025-05-25 03:05:54.512 [reactor-http-nio-2] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.insert - <==    Updates: 1
2025-05-25 03:05:54.527 [reactor-http-nio-2] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:153776404394049614, branchId:153776404394049617, lockKeys:usage_record:172;usage_info:261
2025-05-25 03:05:54.606 [reactor-http-nio-2] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:153776404394049614, branchId:153776404394049618, lockKeys:usage_record:172;usage_info:261;undo_log:185
2025-05-25 03:05:54.749 [reactor-http-nio-2] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - ==>  Preparing: INSERT INTO chat_completions ( object, created, model, system_fingerprint, api_key ) VALUES ( ?, ?, ?, ?, ? )
2025-05-25 03:05:54.758 [reactor-http-nio-2] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - ==> Parameters: chat.completion(String), 1748113554749(Long), deepseek-chat(String), 689258T(String), chat-9461c381-b596-46f4-9d66-62aed4f11183(String)
2025-05-25 03:05:54.967 [reactor-http-nio-2] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - <==    Updates: 1
2025-05-25 03:05:54.972 [reactor-http-nio-2] INFO  com.bgpay.bgai.transaction.TransactionCoordinator - Transaction committed for user 689258T: chatCompletionId=chat-9461c381-b596-46f4-9d66-62aed4f11183
2025-05-25 03:05:54.997 [reactor-http-nio-2] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:153776404394049614, branchId:153776404394049619, lockKeys:chat_completions:337
2025-05-25 03:05:55.046 [reactor-http-nio-2] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:153776404394049614, branchId:153776404394049620, lockKeys:chat_completions:337;undo_log:187
2025-05-25 03:05:55.094 [reactor-http-nio-2] INFO  c.b.bgai.service.mq.BillingTransactionListenerImpl - 本地事务执行成功，提交事务, completionId: chat-9461c381-b596-46f4-9d66-62aed4f11183
2025-05-25 03:05:55.112 [reactor-http-nio-2] INFO  c.b.bgai.service.impl.TransactionLogServiceImpl - 记录分布式事务结束: XID=seata-server:8091:153776404394049614, 状态=COMMITTED
2025-05-25 03:05:55.114 [reactor-http-nio-2] DEBUG c.b.bgai.mapper.TransactionLogMapper.selectList - ==>  Preparing: SELECT id,xid,branch_id,transaction_name,transaction_mode,status,request_path,source_ip,start_time,end_time,user_id,extra_data,create_time,update_time FROM transaction_log WHERE (xid = ?) LIMIT 1
2025-05-25 03:05:55.118 [reactor-http-nio-2] DEBUG c.b.bgai.mapper.TransactionLogMapper.selectList - ==> Parameters: seata-server:8091:153776404394049614(String)
2025-05-25 03:05:55.132 [reactor-http-nio-2] DEBUG c.b.bgai.mapper.TransactionLogMapper.selectList - <==      Total: 1
2025-05-25 03:05:55.133 [reactor-http-nio-2] DEBUG c.b.bgai.mapper.TransactionLogMapper.updateById - ==>  Preparing: UPDATE transaction_log SET xid=?, transaction_name=?, transaction_mode=?, status=?, request_path=?, source_ip=?, start_time=?, end_time=?, user_id=?, extra_data=?, create_time=?, update_time=? WHERE id=?
2025-05-25 03:05:55.134 [reactor-http-nio-2] DEBUG c.b.bgai.mapper.TransactionLogMapper.updateById - ==> Parameters: seata-server:8091:153776404394049614(String), com.bgpay.bgai.service.mq.BillingTransactionListenerImpl.executeLocalTransaction(String), AT(String), COMMITTED(String), (String), (String), 2025-05-25T03:05:54(LocalDateTime), 2025-05-25T03:05:55.132582900(LocalDateTime), system(String), {"duration":867,"result":"success"}(String), 2025-05-25T03:05:54(LocalDateTime), 2025-05-25T03:05:55.132582900(LocalDateTime), 46(Long)
2025-05-25 03:05:55.198 [reactor-http-nio-2] DEBUG c.b.bgai.mapper.TransactionLogMapper.updateById - <==    Updates: 1
2025-05-25 03:05:55.228 [reactor-http-nio-2] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:153776404394049614, branchId:153776404394049621, lockKeys:transaction_log:46
2025-05-25 03:05:55.262 [reactor-http-nio-2] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:153776404394049614, branchId:153776404394049622, lockKeys:transaction_log:46;undo_log:189
2025-05-25 03:05:55.288 [reactor-http-nio-2] INFO  c.b.bgai.interceptor.SeataTransactionInterceptor - 分布式事务成功完成: XID=seata-server:8091:153776404394049614, 耗时=867ms
2025-05-25 03:05:55.288 [reactor-http-nio-2] INFO  io.seata.tm.api.DefaultGlobalTransaction - transaction seata-server:8091:153776404394049614 will be commit
2025-05-25 03:05:55.298 [reactor-http-nio-2] INFO  io.seata.tm.api.DefaultGlobalTransaction - transaction end, xid = seata-server:8091:153776404394049614
2025-05-25 03:05:55.298 [reactor-http-nio-2] INFO  io.seata.tm.api.DefaultGlobalTransaction - [seata-server:8091:153776404394049614] commit status: Committed
2025-05-25 03:05:55.301 [reactor-http-nio-2] INFO  org.reflections.Reflections - 账单消息发送成功，chatCompletionId: chat-9461c381-b596-46f4-9d66-62aed4f11183, userId: 689258T
2025-05-25 03:05:55.306 [reactor-http-nio-2] INFO  com.bgpay.bgai.service.impl.BGAIServiceImpl - 执行第一步操作 - 发送账单消息, businessKey: 689258T:chat-9461c381-b596-46f4-9d66-62aed4f11183
2025-05-25 03:05:55.308 [reactor-http-nio-2] DEBUG c.bgpay.bgai.mapper.UsageRecordMapper.selectCount - ==>  Preparing: SELECT COUNT( * ) AS total FROM usage_record WHERE (chat_completion_id = ?)
2025-05-25 03:05:55.308 [reactor-http-nio-2] DEBUG c.bgpay.bgai.mapper.UsageRecordMapper.selectCount - ==> Parameters: chat-9461c381-b596-46f4-9d66-62aed4f11183(String)
2025-05-25 03:05:55.315 [reactor-http-nio-2] DEBUG c.bgpay.bgai.mapper.UsageRecordMapper.selectCount - <==      Total: 1
2025-05-25 03:05:55.315 [reactor-http-nio-2] INFO  com.bgpay.bgai.service.impl.BGAIServiceImpl - 账单消息已处理，跳过发送, completionId: chat-9461c381-b596-46f4-9d66-62aed4f11183
2025-05-25 03:05:55.329 [ConsumeMessageThread_billing-consumer-group_1] DEBUG c.bgpay.bgai.mapper.UsageRecordMapper.selectCount - ==>  Preparing: SELECT COUNT( * ) AS total FROM usage_record WHERE (chat_completion_id = ?)
2025-05-25 03:05:55.329 [reactor-http-nio-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - Processed response for user 689258T, content length: 2902
2025-05-25 03:05:55.329 [ConsumeMessageThread_billing-consumer-group_1] DEBUG c.bgpay.bgai.mapper.UsageRecordMapper.selectCount - ==> Parameters: chat-9461c381-b596-46f4-9d66-62aed4f11183(String)
2025-05-25 03:05:55.341 [ConsumeMessageThread_billing-consumer-group_1] DEBUG c.bgpay.bgai.mapper.UsageRecordMapper.selectCount - <==      Total: 1
2025-05-25 03:05:55.343 [ConsumeMessageThread_billing-consumer-group_1] DEBUG c.bgpay.bgai.service.mq.RocketMQBillingServiceImpl - 消息已处理 [CompletionId=chat-9461c381-b596-46f4-9d66-62aed4f11183]
2025-05-25 03:05:55.344 [ConsumeMessageThread_billing-consumer-group_1] INFO  c.bgpay.bgai.service.mq.RocketMQBillingServiceImpl - Message consumed: 2408820C7528D042C1858EDCF30D3D91326036BAF30C7C42D2B50000
2025-05-25 03:05:55.758 [rpcDispatch_RMROLE_1_5_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:153776404394049614', branchId=153776404394049615, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false,"skipCheckLock":true}'}
2025-05-25 03:05:55.758 [rpcDispatch_RMROLE_1_5_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:153776404394049614 153776404394049615 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false,"skipCheckLock":true}
2025-05-25 03:05:55.758 [rpcDispatch_RMROLE_1_5_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-25 03:05:55.767 [rpcDispatch_RMROLE_1_6_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:153776404394049614', branchId=153776404394049616, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false,"skipCheckLock":true}'}
2025-05-25 03:05:55.767 [rpcDispatch_RMROLE_1_6_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:153776404394049614 153776404394049616 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false,"skipCheckLock":true}
2025-05-25 03:05:55.767 [rpcDispatch_RMROLE_1_6_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-25 03:05:55.774 [rpcDispatch_RMROLE_1_7_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:153776404394049614', branchId=153776404394049617, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false,"skipCheckLock":true}'}
2025-05-25 03:05:55.774 [rpcDispatch_RMROLE_1_7_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:153776404394049614 153776404394049617 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false,"skipCheckLock":true}
2025-05-25 03:05:55.774 [rpcDispatch_RMROLE_1_7_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-25 03:05:55.781 [rpcDispatch_RMROLE_1_8_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:153776404394049614', branchId=153776404394049618, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false,"skipCheckLock":true}'}
2025-05-25 03:05:55.781 [rpcDispatch_RMROLE_1_8_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:153776404394049614 153776404394049618 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false,"skipCheckLock":true}
2025-05-25 03:05:55.781 [rpcDispatch_RMROLE_1_8_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-25 03:05:55.789 [rpcDispatch_RMROLE_1_9_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:153776404394049614', branchId=153776404394049619, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false,"skipCheckLock":true}'}
2025-05-25 03:05:55.789 [rpcDispatch_RMROLE_1_9_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:153776404394049614 153776404394049619 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false,"skipCheckLock":true}
2025-05-25 03:05:55.789 [rpcDispatch_RMROLE_1_9_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-25 03:05:55.795 [rpcDispatch_RMROLE_1_10_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:153776404394049614', branchId=153776404394049620, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false,"skipCheckLock":true}'}
2025-05-25 03:05:55.795 [rpcDispatch_RMROLE_1_10_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:153776404394049614 153776404394049620 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false,"skipCheckLock":true}
2025-05-25 03:05:55.795 [rpcDispatch_RMROLE_1_10_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-25 03:05:55.802 [rpcDispatch_RMROLE_1_11_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:153776404394049614', branchId=153776404394049621, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false}'}
2025-05-25 03:05:55.802 [rpcDispatch_RMROLE_1_11_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:153776404394049614 153776404394049621 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false}
2025-05-25 03:05:55.802 [rpcDispatch_RMROLE_1_11_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-25 03:05:55.809 [rpcDispatch_RMROLE_1_12_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:153776404394049614', branchId=153776404394049622, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false}'}
2025-05-25 03:05:55.809 [rpcDispatch_RMROLE_1_12_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:153776404394049614 153776404394049622 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false}
2025-05-25 03:05:55.809 [rpcDispatch_RMROLE_1_12_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-25 03:06:36.308 [Thread-7] WARN  com.alibaba.nacos.common.notify.NotifyCenter - [NotifyCenter] Start destroying Publisher
2025-05-25 03:06:36.309 [Thread-1] WARN  c.alibaba.nacos.common.http.HttpClientBeanHolder - [HttpClientBeanHolder] Start destroying common HttpClient
2025-05-25 03:06:36.309 [Thread-7] WARN  com.alibaba.nacos.common.notify.NotifyCenter - [NotifyCenter] Destruction of the end
2025-05-25 03:06:36.309 [Thread-1] WARN  c.alibaba.nacos.common.http.HttpClientBeanHolder - [HttpClientBeanHolder] Destruction of the end
2025-05-25 03:06:36.325 [SpringContextShutdownHook] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - De-registering from Nacos Server now...
2025-05-25 03:06:36.325 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - [DEREGISTER-SERVICE] d750d92e-152f-4055-a641-3bc9dda85a29 deregistering service bgtech-ai with instance: Instance{instanceId='null', ip='192.168.86.8', port=8080, weight=1.0, healthy=true, enabled=true, ephemeral=true, clusterName='DEFAULT', serviceName='null', metadata={}}
2025-05-25 03:06:36.334 [SpringContextShutdownHook] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - De-registration finished.
2025-05-25 03:06:36.335 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.cache.ServiceInfoHolder do shutdown begin
2025-05-25 03:06:36.335 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.backups.FailoverReactor do shutdown begin
2025-05-25 03:06:36.336 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.backups.FailoverReactor do shutdown stop
2025-05-25 03:06:36.336 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.cache.ServiceInfoHolder do shutdown stop
2025-05-25 03:06:36.336 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.NamingClientProxyDelegate do shutdown begin
2025-05-25 03:06:36.336 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServiceInfoUpdateService do shutdown begin
2025-05-25 03:06:36.336 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServiceInfoUpdateService do shutdown stop
2025-05-25 03:06:36.336 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServerListManager do shutdown begin
2025-05-25 03:06:36.336 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Start destroying NacosRestTemplate
2025-05-25 03:06:36.336 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Destruction of the end
2025-05-25 03:06:36.336 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServerListManager do shutdown stop
2025-05-25 03:06:36.336 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.http.NamingHttpClientProxy do shutdown begin
2025-05-25 03:06:36.336 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Start destroying NacosRestTemplate
2025-05-25 03:06:36.336 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Destruction of the end
2025-05-25 03:06:36.336 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.http.NamingHttpClientProxy do shutdown stop
2025-05-25 03:06:36.336 [SpringContextShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Shutdown rpc client, set status to shutdown
2025-05-25 03:06:36.336 [SpringContextShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Shutdown client event executor java.util.concurrent.ScheduledThreadPoolExecutor@70d524d6[Running, pool size = 2, active threads = 2, queued tasks = 0, completed tasks = 0]
2025-05-25 03:06:36.336 [SpringContextShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Close current connection 1748113510491_139.227.195.192_48971
2025-05-25 03:06:36.339 [nacos-grpc-client-executor-8.133.246.113-29] WARN  c.a.nacos.common.remote.client.grpc.GrpcClient - [1748113510491_139.227.195.192_48971]Ignore error event,isRunning:false,isAbandon=false
2025-05-25 03:06:36.340 [SpringContextShutdownHook] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - Shutdown grpc executor java.util.concurrent.ThreadPoolExecutor@692cfa72[Running, pool size = 5, active threads = 0, queued tasks = 0, completed tasks = 30]
2025-05-25 03:06:36.341 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - Shutdown grpc redo service executor java.util.concurrent.ScheduledThreadPoolExecutor@2baa5ccd[Running, pool size = 1, active threads = 0, queued tasks = 1, completed tasks = 28]
2025-05-25 03:06:36.341 [SpringContextShutdownHook] INFO  c.a.n.client.auth.ram.identify.CredentialWatcher - [null] CredentialWatcher is stopped
2025-05-25 03:06:36.341 [SpringContextShutdownHook] INFO  c.a.n.client.auth.ram.identify.CredentialService - [null] CredentialService is freed
2025-05-25 03:06:36.341 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.NamingClientProxyDelegate do shutdown stop
2025-05-25 03:06:36.347 [SpringContextShutdownHook] DEBUG com.bgpay.bgai.config.AsyncConfig$1 - Shutting down ExecutorService 'blockingExecutor'
2025-05-25 03:06:38.460 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:9876] result: true
2025-05-25 03:06:38.460 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:10911] result: true
2025-05-25 03:06:38.482 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:10911] result: true
2025-05-25 03:06:38.482 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:9876] result: true
2025-05-25 03:06:38.595 [SpringContextShutdownHook] INFO  o.s.orm.jpa.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-05-25 03:06:38.598 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-2} closing ...
2025-05-25 03:06:38.606 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-2} closed
2025-05-25 03:06:38.606 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} closing ...
2025-05-25 03:06:38.607 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} closed
2025-05-25 03:06:38.607 [NettyClientSelector_TMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - channel inactive: [id: 0x9705679e, L:/192.168.86.8:49777 ! R:/8.133.246.113:8091]
2025-05-25 03:06:38.607 [NettyClientSelector_TMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - return to pool, rm channel:[id: 0x9705679e, L:/192.168.86.8:49777 ! R:/8.133.246.113:8091]
2025-05-25 03:06:38.607 [NettyClientSelector_TMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - channel valid false,channel:[id: 0x9705679e, L:/192.168.86.8:49777 ! R:/8.133.246.113:8091]
2025-05-25 03:06:38.608 [NettyClientSelector_TMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - will destroy channel:[id: 0x9705679e, L:/192.168.86.8:49777 ! R:/8.133.246.113:8091]
2025-05-25 03:06:38.608 [NettyClientSelector_TMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0x9705679e, L:/192.168.86.8:49777 ! R:/8.133.246.113:8091]) will closed
2025-05-25 03:06:38.608 [NettyClientSelector_TMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0x9705679e, L:/192.168.86.8:49777 ! R:/8.133.246.113:8091]) will closed
2025-05-25 03:06:38.617 [NettyClientSelector_RMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - channel inactive: [id: 0xcdda072f, L:/192.168.86.8:49779 ! R:/8.133.246.113:8091]
2025-05-25 03:06:38.617 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - return to pool, rm channel:[id: 0xcdda072f, L:/192.168.86.8:49779 ! R:/8.133.246.113:8091]
2025-05-25 03:06:38.617 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - channel valid false,channel:[id: 0xcdda072f, L:/192.168.86.8:49779 ! R:/8.133.246.113:8091]
2025-05-25 03:06:38.617 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - will destroy channel:[id: 0xcdda072f, L:/192.168.86.8:49779 ! R:/8.133.246.113:8091]
2025-05-25 03:06:38.617 [NettyClientSelector_RMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0xcdda072f, L:/192.168.86.8:49779 ! R:/8.133.246.113:8091]) will closed
2025-05-25 03:06:38.617 [NettyClientSelector_RMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0xcdda072f, L:/192.168.86.8:49779 ! R:/8.133.246.113:8091]) will closed
2025-05-25 03:19:19.653 [main] WARN  com.alibaba.nacos.client.logging.NacosLogging - Load Logback Configuration of Nacos fail, message: Could not initialize Logback Nacos logging from classpath:nacos-logback.xml
2025-05-25 03:19:19.654 [main] INFO  com.bgpay.bgai.BgaiApplication - The following 1 profile is active: "dev"
2025-05-25 03:19:21.049 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-05-25 03:19:21.051 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-05-25 03:19:21.077 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 19 ms. Found 0 JPA repository interfaces.
2025-05-25 03:19:21.091 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-05-25 03:19:21.092 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-05-25 03:19:21.105 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 5 ms. Found 0 Redis repository interfaces.
2025-05-25 03:19:21.701 [main] INFO  io.seata.config.ConfigurationFactory - load Configuration from :Spring Configuration
2025-05-25 03:19:21.711 [main] INFO  io.seata.config.ConfigurationFactory - load Configuration from :Spring Configuration
2025-05-25 03:19:21.717 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Initializing Global Transaction Clients ... 
2025-05-25 03:19:21.815 [main] INFO  io.seata.core.rpc.netty.NettyClientBootstrap - NettyClientBootstrap has started
2025-05-25 03:19:21.816 [main] INFO  io.seata.discovery.registry.RegistryFactory - use registry center type: file
2025-05-25 03:19:21.825 [main] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - will connect to 8.133.246.113:8091
2025-05-25 03:19:21.829 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - NettyPool create channel to transactionRole:TMROLE,address:8.133.246.113:8091,msg:< RegisterTMRequest{version='1.7.0', applicationId='bgtech-ai', transactionServiceGroup='bgai-tx-group', extraData='ak=null
digest=bgai-tx-group,192.168.86.8,1748114361827
timestamp=1748114361827
authVersion=V4
vgroup=bgai-tx-group
ip=192.168.86.8
'} >
2025-05-25 03:19:21.983 [main] INFO  io.seata.core.rpc.netty.TmNettyRemotingClient - register TM success. client version:1.7.0, server version:1.8.1-SNAPSHOT,channel:[id: 0x0bc4af61, L:/192.168.86.8:60410 - R:/8.133.246.113:8091]
2025-05-25 03:19:21.989 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - register success, cost 79 ms, version:1.8.1-SNAPSHOT,role:TMROLE,channel:[id: 0x0bc4af61, L:/192.168.86.8:60410 - R:/8.133.246.113:8091]
2025-05-25 03:19:21.990 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Transaction Manager Client is initialized. applicationId[bgtech-ai] txServiceGroup[bgai-tx-group]
2025-05-25 03:19:22.004 [main] INFO  io.seata.rm.datasource.AsyncWorker - Async Commit Buffer Limit: 10000
2025-05-25 03:19:22.005 [main] INFO  io.seata.rm.datasource.xa.ResourceManagerXA - ResourceManagerXA init ...
2025-05-25 03:19:22.012 [main] INFO  io.seata.core.rpc.netty.NettyClientBootstrap - NettyClientBootstrap has started
2025-05-25 03:19:22.012 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Resource Manager is initialized. applicationId[bgtech-ai] txServiceGroup[bgai-tx-group]
2025-05-25 03:19:22.012 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Global Transaction Clients are initialized. 
2025-05-25 03:19:23.087 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat initialized with port(s): 8080 (http)
2025-05-25 03:19:23.097 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - The ["http-nio-8080"] connector has been configured to support HTTP upgrade to [h2c]
2025-05-25 03:19:23.097 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - Initializing ProtocolHandler ["http-nio-8080"]
2025-05-25 03:19:23.098 [main] INFO  org.apache.catalina.core.StandardService - Starting service [Tomcat]
2025-05-25 03:19:23.099 [main] INFO  org.apache.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.15]
2025-05-25 03:19:23.518 [main] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} inited
2025-05-25 03:19:23.804 [main] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - will connect to 8.133.246.113:8091
2025-05-25 03:19:23.805 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - RM will register :jdbc:mysql://8.133.246.113:3306/deepseek
2025-05-25 03:19:23.805 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - NettyPool create channel to transactionRole:RMROLE,address:8.133.246.113:8091,msg:< RegisterRMRequest{resourceIds='jdbc:mysql://8.133.246.113:3306/deepseek', version='1.7.0', applicationId='bgtech-ai', transactionServiceGroup='bgai-tx-group', extraData='null'} >
2025-05-25 03:19:23.822 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - register RM success. client version:1.7.0, server version:1.8.1-SNAPSHOT,channel:[id: 0xf1d0f027, L:/192.168.86.8:60415 - R:/8.133.246.113:8091]
2025-05-25 03:19:23.822 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - register success, cost 10 ms, version:1.8.1-SNAPSHOT,role:RMROLE,channel:[id: 0xf1d0f027, L:/192.168.86.8:60415 - R:/8.133.246.113:8091]
2025-05-25 03:19:23.824 [main] INFO  i.s.s.a.datasource.SeataAutoDataSourceProxyCreator - Auto proxy data source 'masterDataSource' by 'AT' mode.
2025-05-25 03:19:23.896 [main] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-2} inited
2025-05-25 03:19:23.983 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - will register resourceId:jdbc:mysql://8.133.246.113:3306/deepseek
2025-05-25 03:19:23.984 [main] INFO  i.s.s.a.datasource.SeataAutoDataSourceProxyCreator - Auto proxy data source 'slaveDataSource' by 'AT' mode.
2025-05-25 03:19:23.999 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.rm.AbstractRMHandler - the rm client received response msg [RegisterRMResponse{version='1.8.1-SNAPSHOT', extraData='null', identified=true, resultCode=null, msg='null'}] from tc server.
2025-05-25 03:19:24.006 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - will register resourceId:jdbc:mysql://8.133.246.113:3306/deepseek
2025-05-25 03:19:24.007 [main] INFO  i.s.s.a.datasource.SeataAutoDataSourceProxyCreator - Auto proxy data source 'dynamicDataSource' by 'AT' mode.
2025-05-25 03:19:24.017 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.rm.AbstractRMHandler - the rm client received response msg [RegisterRMResponse{version='1.8.1-SNAPSHOT', extraData='null', identified=true, resultCode=null, msg='null'}] from tc server.
2025-05-25 03:19:24.118 [main] INFO  org.hibernate.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-05-25 03:19:24.169 [main] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.1.7.Final
2025-05-25 03:19:24.488 [main] INFO  SQL dialect - HHH000400: Using dialect: org.hibernate.dialect.MySQL8Dialect
2025-05-25 03:19:24.491 [main] WARN  org.hibernate.orm.deprecation - HHH90000026: MySQL8Dialect has been deprecated; use org.hibernate.dialect.MySQLDialect instead
2025-05-25 03:19:24.760 [main] INFO  o.h.e.t.jta.platform.internal.JtaPlatformInitiator - HHH000490: Using JtaPlatform implementation: [org.hibernate.engine.transaction.jta.platform.internal.NoJtaPlatform]
2025-05-25 03:19:24.771 [main] INFO  o.s.orm.jpa.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-05-25 03:19:25.159 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-25 03:19:25.171 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-25 03:19:25.198 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-25 03:19:25.200 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-25 03:19:25.200 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-25 03:19:25.212 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-25 03:19:25.938 [main] INFO  com.bgpay.bgai.service.impl.UserServiceImpl - 初始化SSO配置: clientId=bgai-client-id, redirectUri=http://localhost:8080/api/auth/callback
2025-05-25 03:19:26.075 [main] INFO  com.bgpay.bgai.controller.AuthController - 初始化认证控制器: clientId=bgai-client-id, redirectUri=http://localhost:8080/api/auth/callback
2025-05-25 03:19:26.602 [main] INFO  o.a.r.s.autoconfigure.RocketMQAutoConfiguration - a producer (billing-producer-group) init on namesrv 8.133.246.113:9876
2025-05-25 03:19:27.257 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Bean [com.bgpay.bgai.service.deepseek.DeepSeekServiceImp$$SpringCGLIB$$0] with name [deepSeekServiceImp] would use interceptor [io.seata.spring.annotation.GlobalTransactionalInterceptor]
2025-05-25 03:19:27.583 [main] WARN  i.s.s.b.a.provider.SpringBootConfigurationProvider - The get method not found for the field 'SeataProperties#accesskey'.
2025-05-25 03:19:27.584 [main] WARN  i.s.s.b.a.provider.SpringBootConfigurationProvider - The get method not found for the field 'SeataProperties#secretkey'.
2025-05-25 03:19:27.595 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 加载到1个Saga状态机定义文件
2025-05-25 03:19:27.741 [main] INFO  com.bgpay.bgai.saga.CustomSagaJsonParser - 开始解析状态机定义: bgai-saga-transaction
2025-05-25 03:19:27.742 [main] INFO  com.bgpay.bgai.saga.CustomSagaJsonParser - 状态机定义解析成功: bgai-saga-transaction
2025-05-25 03:19:27.742 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 成功加载状态机定义: /E:/project/bgai/target/classes/statelang/bgai-saga-transaction.json
2025-05-25 03:19:28.202 [main] INFO  org.redisson.Version - Redisson 3.24.3
2025-05-25 03:19:28.351 [redisson-netty-4-8] INFO  o.r.connection.pool.MasterPubSubConnectionPool - 1 connections initialized for 8.133.246.113/8.133.246.113:6379
2025-05-25 03:19:28.676 [redisson-netty-4-19] INFO  org.redisson.connection.pool.MasterConnectionPool - 24 connections initialized for 8.133.246.113/8.133.246.113:6379
2025-05-25 03:19:28.845 [main] INFO  com.bgpay.bgai.service.mq.MQConsumerService - MQ consumer startup successful [group=billing-consumer-group, topic=BILLING_TOPIC, tag=USER_BILLING]
2025-05-25 03:19:29.020 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Bean [com.bgpay.bgai.service.mq.BillingTransactionListenerImpl$$SpringCGLIB$$0] with name [billingTransactionListenerImpl] would use interceptor [io.seata.spring.annotation.GlobalTransactionalInterceptor]
2025-05-25 03:19:29.138 [main] DEBUG com.bgpay.bgai.config.AsyncConfig$1 - Initializing ExecutorService 'blockingExecutor'
2025-05-25 03:19:29.162 [main] INFO  c.b.bgai.config.NacosConfig$NacosWarningHandler - Nacos警告处理器已启用，将忽略配置中心连接警告
2025-05-25 03:19:30.318 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [After]
2025-05-25 03:19:30.319 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Before]
2025-05-25 03:19:30.319 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Between]
2025-05-25 03:19:30.319 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Cookie]
2025-05-25 03:19:30.319 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Header]
2025-05-25 03:19:30.319 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Host]
2025-05-25 03:19:30.319 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Method]
2025-05-25 03:19:30.319 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Path]
2025-05-25 03:19:30.319 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Query]
2025-05-25 03:19:30.319 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [ReadBody]
2025-05-25 03:19:30.319 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [RemoteAddr]
2025-05-25 03:19:30.319 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [XForwardedRemoteAddr]
2025-05-25 03:19:30.319 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Weight]
2025-05-25 03:19:30.319 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [CloudFoundryRouteService]
2025-05-25 03:19:31.767 [main] INFO  o.s.b.actuate.endpoint.web.EndpointLinksResolver - Exposing 3 endpoint(s) beneath base path '/actuator'
2025-05-25 03:19:33.225 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - Starting ProtocolHandler ["http-nio-8080"]
2025-05-25 03:19:33.238 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat started on port(s): 8080 (http) with context path ''
2025-05-25 03:19:33.248 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from ans.namespace attribute : null
2025-05-25 03:19:33.248 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from ALIBABA_ALIWARE_NAMESPACE attribute :null
2025-05-25 03:19:33.249 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from namespace attribute :null
2025-05-25 03:19:33.258 [main] INFO  c.a.n.p.auth.spi.client.ClientAuthPluginManager - [ClientAuthPluginManager] Load ClientAuthService com.alibaba.nacos.client.auth.impl.NacosClientAuthServiceImpl success.
2025-05-25 03:19:33.259 [main] INFO  c.a.n.p.auth.spi.client.ClientAuthPluginManager - [ClientAuthPluginManager] Load ClientAuthService com.alibaba.nacos.client.auth.ram.RamClientAuthServiceImpl success.
2025-05-25 03:19:33.262 [main] INFO  com.alibaba.nacos.common.remote.client - [RpcClientFactory] create a new rpc client of 929a2063-61f7-459d-80b5-bbb8d907f36c
2025-05-25 03:19:33.263 [main] INFO  com.alibaba.nacos.common.remote.client - [929a2063-61f7-459d-80b5-bbb8d907f36c] RpcClient init, ServerListFactory = com.alibaba.nacos.client.naming.core.ServerListManager
2025-05-25 03:19:33.264 [main] INFO  com.alibaba.nacos.common.remote.client - [929a2063-61f7-459d-80b5-bbb8d907f36c] Registry connection listener to current client:com.alibaba.nacos.client.naming.remote.gprc.redo.NamingGrpcRedoService
2025-05-25 03:19:33.264 [main] INFO  com.alibaba.nacos.common.remote.client - [929a2063-61f7-459d-80b5-bbb8d907f36c] Register server push request handler:com.alibaba.nacos.client.naming.remote.gprc.NamingPushRequestHandler
2025-05-25 03:19:33.264 [main] INFO  com.alibaba.nacos.common.remote.client - [929a2063-61f7-459d-80b5-bbb8d907f36c] Try to connect to server on start up, server: {serverIp = '8.133.246.113', server main port = 8848}
2025-05-25 03:19:33.265 [main] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - grpc client connection server:8.133.246.113 ip,serverPort:9848,grpcTslConfig:{"sslProvider":"OPENSSL","enableTls":false,"mutualAuthEnable":false,"trustAll":false}
2025-05-25 03:19:33.392 [main] INFO  com.alibaba.nacos.common.remote.client - [929a2063-61f7-459d-80b5-bbb8d907f36c] Success to connect to server [8.133.246.113:8848] on start up, connectionId = 1748114373307_139.227.195.192_48917
2025-05-25 03:19:33.392 [main] INFO  com.alibaba.nacos.common.remote.client - [929a2063-61f7-459d-80b5-bbb8d907f36c] Register server push request handler:com.alibaba.nacos.common.remote.client.RpcClient$ConnectResetRequestHandler
2025-05-25 03:19:33.392 [com.alibaba.nacos.client.remote.worker] INFO  com.alibaba.nacos.common.remote.client - [929a2063-61f7-459d-80b5-bbb8d907f36c] Notify connected event to listeners.
2025-05-25 03:19:33.392 [main] INFO  com.alibaba.nacos.common.remote.client - [929a2063-61f7-459d-80b5-bbb8d907f36c] Register server push request handler:com.alibaba.nacos.common.remote.client.RpcClient$$Lambda/0x000001ec03528870
2025-05-25 03:19:33.392 [com.alibaba.nacos.client.remote.worker] INFO  com.alibaba.nacos.client.naming - Grpc connection connect
2025-05-25 03:19:33.393 [main] INFO  com.alibaba.nacos.client.naming - [REGISTER-SERVICE] d750d92e-152f-4055-a641-3bc9dda85a29 registering service bgtech-ai with instance Instance{instanceId='null', ip='192.168.86.8', port=8080, weight=1.0, healthy=true, enabled=true, ephemeral=true, clusterName='DEFAULT', serviceName='null', metadata={IPv6=[2408:820c:7528:d042:c185:8edc:f30d:3d91], preserved.register.source=SPRING_CLOUD}}
2025-05-25 03:19:33.411 [main] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - nacos registry, DEFAULT_GROUP bgtech-ai 192.168.86.8:8080 register finished
2025-05-25 03:19:33.465 [main] INFO  com.bgpay.bgai.config.NacosConfig - 应用启动完成，当前环境: dev
2025-05-25 03:19:33.466 [main] INFO  com.bgpay.bgai.config.NacosConfig - Nacos配置中心: 8.133.246.113:8848, 命名空间: d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-25 03:19:33.466 [main] INFO  com.bgpay.bgai.config.NacosConfig - 注意: 如果看到Nacos配置加载警告，但应用正常启动，说明应用正在使用本地配置文件
2025-05-25 03:19:33.467 [main] INFO  com.bgpay.bgai.BgaiApplication - Started BgaiApplication in 15.888 seconds (process running for 17.18)
2025-05-25 03:19:33.470 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-25 03:19:33.470 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-25 03:19:33.483 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-25 03:19:33.483 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-25 03:19:33.484 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-25 03:19:33.498 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-25 03:19:33.499 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-25 03:19:33.499 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-25 03:19:33.522 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-25 03:19:33.522 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-25 03:19:33.522 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-25 03:19:33.529 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-25 03:19:33.530 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - ==================== Saga状态机加载报告 ====================
2025-05-25 03:19:33.530 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - Saga状态机配置加载状态: 成功
2025-05-25 03:19:33.530 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 已加载的状态机定义文件数量: 1
2025-05-25 03:19:33.530 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 已加载的状态机定义文件:
2025-05-25 03:19:33.530 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig -  - /E:/project/bgai/target/classes/statelang/bgai-saga-transaction.json
2025-05-25 03:19:33.530 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - Saga解析器状态: CUSTOM_FASTJSON2
2025-05-25 03:19:33.530 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 状态机解析结果: 成功 1 个, 失败 0 个
2025-05-25 03:19:33.530 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - =============================================================
2025-05-25 03:19:33.536 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - nacos.cache.data.init.snapshot = true 
2025-05-25 03:19:33.537 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] common-dev.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-25 03:19:33.548 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=common-dev.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-25 03:19:33.548 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=common-dev.yaml, group=DEFAULT_GROUP
2025-05-25 03:19:33.548 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-25 03:19:33.548 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-25 03:19:33.548 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai.yaml, group=DEFAULT_GROUP
2025-05-25 03:19:33.550 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai-dev.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-25 03:19:33.550 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai-dev.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-25 03:19:33.550 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai-dev.yaml, group=DEFAULT_GROUP
2025-05-25 03:19:33.550 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-25 03:19:33.550 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai, group=DEFAULT_GROUP, cnt=1
2025-05-25 03:19:33.550 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai, group=DEFAULT_GROUP
2025-05-25 03:19:50.858 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - 接收到请求: /api/chatGatWay-internal, 文件=新文件 17.txt, 问题参数=null, 模型参数=null
2025-05-25 03:19:50.860 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - 请求Content-Type: multipart/form-data;boundary=--------------------------362528340624007042403174
2025-05-25 03:19:50.860 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - 收集到的完整参数: question="null", apiUrl="null", modelName="null", multiTurn=false
2025-05-25 03:19:50.862 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - Processing request for user ID: 689258T
2025-05-25 03:19:50.862 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - Processing file with circuit breaker: fileName=新文件 17.txt, question=
2025-05-25 03:19:50.864 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.config.ReactiveFileProcessor - Processing file: 新文件 17.txt, content-type: text/plain
2025-05-25 03:19:50.870 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - PARAM TRACE [689258T]: 尝试查找匹配配置 - 参数: apiUrl=null, modelName=null
2025-05-25 03:19:50.880 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 查询配置 - userId=689258T
2025-05-25 03:19:50.881 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 排序方式 - 按ID降序
2025-05-25 03:19:50.881 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 限制结果数 - LIMIT 1
2025-05-25 03:19:50.948 [http-nio-8080-exec-2] DEBUG com.bgpay.bgai.mapper.ApiConfigMapper.selectList - ==>  Preparing: SELECT id,api_url,api_key,model_name,user_id FROM api_config WHERE (user_id = ?) ORDER BY id DESC LIMIT 1
2025-05-25 03:19:50.949 [http-nio-8080-exec-2] DEBUG com.bgpay.bgai.mapper.ApiConfigMapper.selectList - ==> Parameters: 689258T(String)
2025-05-25 03:19:50.959 [http-nio-8080-exec-2] DEBUG com.bgpay.bgai.mapper.ApiConfigMapper.selectList - <==      Total: 1
2025-05-25 03:19:50.959 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 查询结果 - 找到配置: id=2, modelName=deepseek-chat
2025-05-25 03:19:50.959 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - PARAM TRACE [689258T]: 找到匹配配置 - apiUrl=https://api.deepseek.com/chat/completions, modelName=deepseek-chat (原始请求: null)
2025-05-25 03:19:50.959 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - API config resolved: url=https://api.deepseek.com/chat/completions, model=deepseek-chat
2025-05-25 03:19:50.976 [Thread-51] INFO  com.bgpay.bgai.config.ReactiveFileProcessor - File processed successfully: size=37 bytes
2025-05-25 03:19:50.980 [Thread-51] INFO  com.bgpay.bgai.controller.ReactiveChatController - Content processed, length: 54
2025-05-25 03:19:50.987 [Thread-51] INFO  io.seata.tm.TransactionManagerHolder - TransactionManager Singleton io.seata.tm.DefaultTransactionManager@387856ed
2025-05-25 03:19:51.001 [Thread-51] INFO  io.seata.tm.api.DefaultGlobalTransaction - Begin new global transaction [seata-server:8091:153776404394049623]
2025-05-25 03:19:51.004 [Thread-51] INFO  c.b.bgai.interceptor.SeataTransactionInterceptor - 准备记录分布式事务开始: XID=seata-server:8091:153776404394049623, 业务=com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive, 路径=, IP=, 用户=system
2025-05-25 03:19:51.023 [Thread-51] INFO  c.b.bgai.service.impl.TransactionLogServiceImpl - 记录分布式事务开始: XID=seata-server:8091:153776404394049623, 业务=com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive
2025-05-25 03:19:51.029 [Thread-51] DEBUG com.bgpay.bgai.mapper.TransactionLogMapper.insert - ==>  Preparing: INSERT INTO transaction_log ( xid, transaction_name, transaction_mode, status, request_path, source_ip, start_time, user_id, create_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-05-25 03:19:51.033 [Thread-51] DEBUG com.bgpay.bgai.mapper.TransactionLogMapper.insert - ==> Parameters: seata-server:8091:153776404394049623(String), com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive(String), AT(String), ACTIVE(String), (String), (String), 2025-05-25T03:19:51.023614100(LocalDateTime), system(String), 2025-05-25T03:19:51.023614100(LocalDateTime)
2025-05-25 03:19:51.401 [Thread-51] DEBUG com.bgpay.bgai.mapper.TransactionLogMapper.insert - <==    Updates: 1
2025-05-25 03:19:51.418 [Thread-51] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:153776404394049623, branchId:153776404394049624, lockKeys:transaction_log:47
2025-05-25 03:19:51.428 [Thread-51] WARN  i.s.c.l.EnhancedServiceLoader$InnerEnhancedServiceLoader - Load [io.seata.rm.datasource.undo.parser.ProtostuffUndoLogParser] class fail: io/protostuff/runtime/IdStrategy
2025-05-25 03:19:51.509 [Thread-51] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:153776404394049623, branchId:153776404394049625, lockKeys:transaction_log:47;undo_log:191
2025-05-25 03:19:51.539 [Thread-51] INFO  c.b.bgai.interceptor.SeataTransactionInterceptor - 开始分布式事务: XID=seata-server:8091:153776404394049623, 方法=com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive
2025-05-25 03:19:51.552 [Thread-51] INFO  org.reflections.Reflections - Processing reactive request: content length=54, apiUrl=https://api.deepseek.com/chat/completions, modelName=deepseek-chat, userId=689258T, multiTurn=false
2025-05-25 03:19:51.571 [Thread-51] INFO  c.b.bgai.service.impl.TransactionLogServiceImpl - 记录分布式事务结束: XID=seata-server:8091:153776404394049623, 状态=COMMITTED
2025-05-25 03:19:51.573 [Thread-51] DEBUG c.b.bgai.mapper.TransactionLogMapper.selectList - ==>  Preparing: SELECT id,xid,branch_id,transaction_name,transaction_mode,status,request_path,source_ip,start_time,end_time,user_id,extra_data,create_time,update_time FROM transaction_log WHERE (xid = ?) LIMIT 1
2025-05-25 03:19:51.577 [Thread-51] DEBUG c.b.bgai.mapper.TransactionLogMapper.selectList - ==> Parameters: seata-server:8091:153776404394049623(String)
2025-05-25 03:19:51.592 [Thread-51] DEBUG c.b.bgai.mapper.TransactionLogMapper.selectList - <==      Total: 1
2025-05-25 03:19:51.598 [Thread-51] DEBUG c.b.bgai.mapper.TransactionLogMapper.updateById - ==>  Preparing: UPDATE transaction_log SET xid=?, transaction_name=?, transaction_mode=?, status=?, request_path=?, source_ip=?, start_time=?, end_time=?, user_id=?, extra_data=?, create_time=?, update_time=? WHERE id=?
2025-05-25 03:19:51.607 [Thread-51] DEBUG c.b.bgai.mapper.TransactionLogMapper.updateById - ==> Parameters: seata-server:8091:153776404394049623(String), com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive(String), AT(String), COMMITTED(String), (String), (String), 2025-05-25T03:19:51(LocalDateTime), 2025-05-25T03:19:51.592275(LocalDateTime), system(String), {"duration":15,"result":"success"}(String), 2025-05-25T03:19:51(LocalDateTime), 2025-05-25T03:19:51.592275(LocalDateTime), 47(Long)
2025-05-25 03:19:51.690 [Thread-51] DEBUG c.b.bgai.mapper.TransactionLogMapper.updateById - <==    Updates: 1
2025-05-25 03:19:51.698 [Thread-51] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:153776404394049623, branchId:153776404394049626, lockKeys:transaction_log:47
2025-05-25 03:19:51.732 [Thread-51] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:153776404394049623, branchId:153776404394049627, lockKeys:transaction_log:47;undo_log:193
2025-05-25 03:19:51.766 [Thread-51] INFO  c.b.bgai.interceptor.SeataTransactionInterceptor - 分布式事务成功完成: XID=seata-server:8091:153776404394049623, 耗时=15ms
2025-05-25 03:19:51.766 [Thread-51] INFO  io.seata.tm.api.DefaultGlobalTransaction - transaction seata-server:8091:153776404394049623 will be commit
2025-05-25 03:19:51.777 [Thread-51] INFO  io.seata.tm.api.DefaultGlobalTransaction - transaction end, xid = seata-server:8091:153776404394049623
2025-05-25 03:19:51.777 [Thread-51] INFO  io.seata.tm.api.DefaultGlobalTransaction - [seata-server:8091:153776404394049623] commit status: Committed
2025-05-25 03:19:51.822 [boundedElastic-1] WARN  com.bgpay.bgai.transaction.TransactionCoordinator - Found existing transaction for user 689258T: chat-9461c381-b596-46f4-9d66-62aed4f11183
2025-05-25 03:19:51.822 [boundedElastic-1] INFO  org.reflections.Reflections - Transaction prepared with chatCompletionId: chat-9461c381-b596-46f4-9d66-62aed4f11183
2025-05-25 03:19:52.761 [rpcDispatch_RMROLE_1_1_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:153776404394049623', branchId=153776404394049624, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false,"skipCheckLock":true}'}
2025-05-25 03:19:52.763 [rpcDispatch_RMROLE_1_1_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:153776404394049623 153776404394049624 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false,"skipCheckLock":true}
2025-05-25 03:19:52.764 [rpcDispatch_RMROLE_1_1_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-25 03:19:52.776 [rpcDispatch_RMROLE_1_2_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:153776404394049623', branchId=153776404394049625, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false,"skipCheckLock":true}'}
2025-05-25 03:19:52.776 [rpcDispatch_RMROLE_1_2_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:153776404394049623 153776404394049625 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false,"skipCheckLock":true}
2025-05-25 03:19:52.777 [rpcDispatch_RMROLE_1_2_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-25 03:19:52.786 [rpcDispatch_RMROLE_1_3_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:153776404394049623', branchId=153776404394049626, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false}'}
2025-05-25 03:19:52.786 [rpcDispatch_RMROLE_1_3_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:153776404394049623 153776404394049626 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false}
2025-05-25 03:19:52.786 [rpcDispatch_RMROLE_1_3_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-25 03:19:52.795 [rpcDispatch_RMROLE_1_4_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:153776404394049623', branchId=153776404394049627, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false}'}
2025-05-25 03:19:52.795 [rpcDispatch_RMROLE_1_4_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:153776404394049623 153776404394049627 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false}
2025-05-25 03:19:52.795 [rpcDispatch_RMROLE_1_4_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-25 03:20:51.598 [FileWrite-1] INFO  com.bgpay.bgai.service.deepseek.FileWriterService - Successfully wrote content to: \var\data\ai_responses\74bcf95a-f5d8-41c6-b63b-5571b3f700a2.txt
2025-05-25 03:20:51.615 [reactor-http-nio-2] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - ==>  Preparing: INSERT INTO chat_completions ( object, created, model, system_fingerprint, api_key ) VALUES ( ?, ?, ?, ?, ? )
2025-05-25 03:20:51.615 [reactor-http-nio-2] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - ==> Parameters: chat.completion(String), 1748114451613(Long), deepseek-chat(String), 689258T(String), chat-9461c381-b596-46f4-9d66-62aed4f11183(String)
2025-05-25 03:20:51.650 [reactor-http-nio-2] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - <==    Updates: 1
2025-05-25 03:20:51.651 [reactor-http-nio-2] INFO  com.bgpay.bgai.transaction.TransactionCoordinator - Transaction committed for user 689258T: chatCompletionId=chat-9461c381-b596-46f4-9d66-62aed4f11183
2025-05-25 03:20:51.699 [reactor-http-nio-2] INFO  org.reflections.Reflections - 开始发送账单消息，chatCompletionId: chat-9461c381-b596-46f4-9d66-62aed4f11183, userId: 689258T
2025-05-25 03:20:51.825 [reactor-http-nio-2] INFO  io.seata.tm.api.DefaultGlobalTransaction - Begin new global transaction [seata-server:8091:153776404394049628]
2025-05-25 03:20:51.825 [reactor-http-nio-2] INFO  c.b.bgai.interceptor.SeataTransactionInterceptor - 准备记录分布式事务开始: XID=seata-server:8091:153776404394049628, 业务=com.bgpay.bgai.service.mq.BillingTransactionListenerImpl.executeLocalTransaction, 路径=, IP=, 用户=system
2025-05-25 03:20:51.837 [reactor-http-nio-2] INFO  c.b.bgai.service.impl.TransactionLogServiceImpl - 记录分布式事务开始: XID=seata-server:8091:153776404394049628, 业务=com.bgpay.bgai.service.mq.BillingTransactionListenerImpl.executeLocalTransaction
2025-05-25 03:20:51.838 [reactor-http-nio-2] DEBUG com.bgpay.bgai.mapper.TransactionLogMapper.insert - ==>  Preparing: INSERT INTO transaction_log ( xid, transaction_name, transaction_mode, status, request_path, source_ip, start_time, user_id, create_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-05-25 03:20:51.839 [reactor-http-nio-2] DEBUG com.bgpay.bgai.mapper.TransactionLogMapper.insert - ==> Parameters: seata-server:8091:153776404394049628(String), com.bgpay.bgai.service.mq.BillingTransactionListenerImpl.executeLocalTransaction(String), AT(String), ACTIVE(String), (String), (String), 2025-05-25T03:20:51.837011600(LocalDateTime), system(String), 2025-05-25T03:20:51.837011600(LocalDateTime)
2025-05-25 03:20:51.954 [reactor-http-nio-2] DEBUG com.bgpay.bgai.mapper.TransactionLogMapper.insert - <==    Updates: 1
2025-05-25 03:20:51.962 [parallel-2] ERROR com.bgpay.bgai.controller.ReactiveChatController - Circuit broken for API call: Did not observe any item or terminal signal within 60000ms in 'Mono.transform ⇢ at org.springframework.cloud.circuitbreaker.resilience4j.ReactiveResilience4JCircuitBreaker.run(ReactiveResilience4JCircuitBreaker.java:78)' (and no fallback has been configured)
2025-05-25 03:20:51.977 [reactor-http-nio-2] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:153776404394049628, branchId:153776404394049629, lockKeys:transaction_log:48
2025-05-25 03:20:51.977 [parallel-2] INFO  com.bgpay.bgai.transaction.TransactionCoordinator - Transaction rolled back for user 689258T: chatCompletionId=chat-9461c381-b596-46f4-9d66-62aed4f11183
2025-05-25 03:20:51.977 [parallel-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - Using rolled back chatCompletionId for circuit breaker fallback: chat-9461c381-b596-46f4-9d66-62aed4f11183
2025-05-25 03:20:52.046 [reactor-http-nio-2] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:153776404394049628, branchId:153776404394049630, lockKeys:transaction_log:48;undo_log:195
2025-05-25 03:20:52.086 [reactor-http-nio-2] INFO  c.b.bgai.interceptor.SeataTransactionInterceptor - 开始分布式事务: XID=seata-server:8091:153776404394049628, 方法=com.bgpay.bgai.service.mq.BillingTransactionListenerImpl.executeLocalTransaction
2025-05-25 03:20:52.086 [reactor-http-nio-2] INFO  c.b.bgai.service.mq.BillingTransactionListenerImpl - 开始执行本地事务, xid: seata-server:8091:153776404394049628, userId: 689258T, completionId: chat-9461c381-b596-46f4-9d66-62aed4f11183
2025-05-25 03:20:52.100 [reactor-http-nio-2] INFO  c.b.bgai.service.mq.BillingTransactionListenerImpl - 消息已处理，提交事务, completionId: chat-9461c381-b596-46f4-9d66-62aed4f11183
2025-05-25 03:20:52.111 [reactor-http-nio-2] INFO  c.b.bgai.service.impl.TransactionLogServiceImpl - 记录分布式事务结束: XID=seata-server:8091:153776404394049628, 状态=COMMITTED
2025-05-25 03:20:52.112 [reactor-http-nio-2] DEBUG c.b.bgai.mapper.TransactionLogMapper.selectList - ==>  Preparing: SELECT id,xid,branch_id,transaction_name,transaction_mode,status,request_path,source_ip,start_time,end_time,user_id,extra_data,create_time,update_time FROM transaction_log WHERE (xid = ?) LIMIT 1
2025-05-25 03:20:52.113 [reactor-http-nio-2] DEBUG c.b.bgai.mapper.TransactionLogMapper.selectList - ==> Parameters: seata-server:8091:153776404394049628(String)
2025-05-25 03:20:52.136 [reactor-http-nio-2] DEBUG c.b.bgai.mapper.TransactionLogMapper.selectList - <==      Total: 1
2025-05-25 03:20:52.137 [reactor-http-nio-2] DEBUG c.b.bgai.mapper.TransactionLogMapper.updateById - ==>  Preparing: UPDATE transaction_log SET xid=?, transaction_name=?, transaction_mode=?, status=?, request_path=?, source_ip=?, start_time=?, end_time=?, user_id=?, extra_data=?, create_time=?, update_time=? WHERE id=?
2025-05-25 03:20:52.138 [reactor-http-nio-2] DEBUG c.b.bgai.mapper.TransactionLogMapper.updateById - ==> Parameters: seata-server:8091:153776404394049628(String), com.bgpay.bgai.service.mq.BillingTransactionListenerImpl.executeLocalTransaction(String), AT(String), COMMITTED(String), (String), (String), 2025-05-25T03:20:52(LocalDateTime), 2025-05-25T03:20:52.136599700(LocalDateTime), system(String), {"duration":15,"result":"success"}(String), 2025-05-25T03:20:52(LocalDateTime), 2025-05-25T03:20:52.136599700(LocalDateTime), 48(Long)
2025-05-25 03:20:52.295 [reactor-http-nio-2] DEBUG c.b.bgai.mapper.TransactionLogMapper.updateById - <==    Updates: 1
2025-05-25 03:20:52.328 [reactor-http-nio-2] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:153776404394049628, branchId:153776404394049631, lockKeys:transaction_log:48
2025-05-25 03:20:52.447 [reactor-http-nio-2] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:153776404394049628, branchId:153776404394049632, lockKeys:transaction_log:48;undo_log:197
2025-05-25 03:20:52.524 [reactor-http-nio-2] INFO  c.b.bgai.interceptor.SeataTransactionInterceptor - 分布式事务成功完成: XID=seata-server:8091:153776404394049628, 耗时=15ms
2025-05-25 03:20:52.524 [reactor-http-nio-2] INFO  io.seata.tm.api.DefaultGlobalTransaction - transaction seata-server:8091:153776404394049628 will be commit
2025-05-25 03:20:52.539 [reactor-http-nio-2] INFO  io.seata.tm.api.DefaultGlobalTransaction - transaction end, xid = seata-server:8091:153776404394049628
2025-05-25 03:20:52.539 [reactor-http-nio-2] INFO  io.seata.tm.api.DefaultGlobalTransaction - [seata-server:8091:153776404394049628] commit status: Committed
2025-05-25 03:20:52.543 [reactor-http-nio-2] INFO  org.reflections.Reflections - 账单消息发送成功，chatCompletionId: chat-9461c381-b596-46f4-9d66-62aed4f11183, userId: 689258T
2025-05-25 03:20:52.550 [reactor-http-nio-2] INFO  com.bgpay.bgai.service.impl.BGAIServiceImpl - 执行第一步操作 - 发送账单消息, businessKey: 689258T:chat-9461c381-b596-46f4-9d66-62aed4f11183
2025-05-25 03:20:52.552 [reactor-http-nio-2] DEBUG c.bgpay.bgai.mapper.UsageRecordMapper.selectCount - ==>  Preparing: SELECT COUNT( * ) AS total FROM usage_record WHERE (chat_completion_id = ?)
2025-05-25 03:20:52.553 [reactor-http-nio-2] DEBUG c.bgpay.bgai.mapper.UsageRecordMapper.selectCount - ==> Parameters: chat-9461c381-b596-46f4-9d66-62aed4f11183(String)
2025-05-25 03:20:52.568 [reactor-http-nio-2] DEBUG c.bgpay.bgai.mapper.UsageRecordMapper.selectCount - <==      Total: 1
2025-05-25 03:20:52.569 [reactor-http-nio-2] INFO  com.bgpay.bgai.service.impl.BGAIServiceImpl - 账单消息已处理，跳过发送, completionId: chat-9461c381-b596-46f4-9d66-62aed4f11183
2025-05-25 03:20:52.596 [reactor-http-nio-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - Processed response for user 689258T, content length: 5752
2025-05-25 03:20:52.725 [ConsumeMessageThread_billing-consumer-group_1] DEBUG c.bgpay.bgai.mapper.PriceConfigMapper.selectList - ==>  Preparing: SELECT id,model_type,time_period,cache_status,io_type,price,version,effective_time FROM price_config WHERE (model_type = ? AND time_period = ? AND io_type = ? AND effective_time <= ? AND cache_status = ?) ORDER BY effective_time DESC LIMIT 1
2025-05-25 03:20:52.726 [ConsumeMessageThread_billing-consumer-group_1] DEBUG c.bgpay.bgai.mapper.PriceConfigMapper.selectList - ==> Parameters: deepseek-chat(String), standard(String), input(String), 2025-05-25T03:20:52.724001900(LocalDateTime), miss(String)
2025-05-25 03:20:52.732 [ConsumeMessageThread_billing-consumer-group_1] DEBUG c.bgpay.bgai.mapper.PriceConfigMapper.selectList - <==      Total: 1
2025-05-25 03:20:52.756 [rpcDispatch_RMROLE_1_5_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:153776404394049628', branchId=153776404394049629, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false,"skipCheckLock":true}'}
2025-05-25 03:20:52.756 [rpcDispatch_RMROLE_1_5_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:153776404394049628 153776404394049629 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false,"skipCheckLock":true}
2025-05-25 03:20:52.756 [rpcDispatch_RMROLE_1_5_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-25 03:20:52.762 [rpcDispatch_RMROLE_1_6_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:153776404394049628', branchId=153776404394049630, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false,"skipCheckLock":true}'}
2025-05-25 03:20:52.762 [rpcDispatch_RMROLE_1_6_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:153776404394049628 153776404394049630 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false,"skipCheckLock":true}
2025-05-25 03:20:52.762 [rpcDispatch_RMROLE_1_6_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-25 03:20:52.769 [rpcDispatch_RMROLE_1_7_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:153776404394049628', branchId=153776404394049631, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false}'}
2025-05-25 03:20:52.769 [rpcDispatch_RMROLE_1_7_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:153776404394049628 153776404394049631 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false}
2025-05-25 03:20:52.769 [rpcDispatch_RMROLE_1_7_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-25 03:20:52.776 [rpcDispatch_RMROLE_1_8_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:153776404394049628', branchId=153776404394049632, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false}'}
2025-05-25 03:20:52.777 [rpcDispatch_RMROLE_1_8_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:153776404394049628 153776404394049632 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false}
2025-05-25 03:20:52.777 [rpcDispatch_RMROLE_1_8_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-25 03:20:52.785 [ConsumeMessageThread_billing-consumer-group_1] DEBUG c.bgpay.bgai.mapper.PriceConfigMapper.selectList - ==>  Preparing: SELECT id,model_type,time_period,cache_status,io_type,price,version,effective_time FROM price_config WHERE (model_type = ? AND time_period = ? AND io_type = ? AND effective_time <= ? AND cache_status IS NULL) ORDER BY effective_time DESC LIMIT 1
2025-05-25 03:20:52.786 [ConsumeMessageThread_billing-consumer-group_1] DEBUG c.bgpay.bgai.mapper.PriceConfigMapper.selectList - ==> Parameters: deepseek-chat(String), standard(String), output(String), 2025-05-25T03:20:52.783991500(LocalDateTime)
2025-05-25 03:20:52.791 [ConsumeMessageThread_billing-consumer-group_1] DEBUG c.bgpay.bgai.mapper.PriceConfigMapper.selectList - <==      Total: 1
2025-05-25 03:20:52.844 [ConsumeMessageThread_billing-consumer-group_1] INFO  c.bgpay.bgai.service.mq.RocketMQBillingServiceImpl - Output price config priceVersion: 1
2025-05-25 03:20:52.854 [ConsumeMessageThread_billing-consumer-group_1] DEBUG com.bgpay.bgai.mapper.UsageRecordMapper.insert - ==>  Preparing: INSERT INTO usage_record ( model_type, chat_completion_id, user_id, input_cost, output_cost, price_version, calculated_at, status, created_at ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-05-25 03:20:52.856 [ConsumeMessageThread_billing-consumer-group_1] DEBUG com.bgpay.bgai.mapper.UsageRecordMapper.insert - ==> Parameters: deepseek-chat(String), chat-9461c381-b596-46f4-9d66-62aed4f11183(String), 689258T(String), 0.0001(BigDecimal), 0.0117(BigDecimal), 1(Integer), 2025-05-25T03:20:52.811990600(LocalDateTime), PENDING(String), 2025-05-25T03:20:52.811990600(LocalDateTime)
2025-05-25 03:20:52.868 [ConsumeMessageThread_billing-consumer-group_1] DEBUG com.bgpay.bgai.mapper.UsageRecordMapper.insert - <==    Updates: 1
2025-05-25 03:20:52.894 [ConsumeMessageThread_billing-consumer-group_1] INFO  c.bgpay.bgai.service.mq.RocketMQBillingServiceImpl - Message consumed: 2408820C7528D042C1858EDCF30D3D912F3436BAF30C7C5085220000
2025-05-25 03:22:25.710 [Thread-1] WARN  c.alibaba.nacos.common.http.HttpClientBeanHolder - [HttpClientBeanHolder] Start destroying common HttpClient
2025-05-25 03:22:25.710 [Thread-7] WARN  com.alibaba.nacos.common.notify.NotifyCenter - [NotifyCenter] Start destroying Publisher
2025-05-25 03:22:25.710 [Thread-7] WARN  com.alibaba.nacos.common.notify.NotifyCenter - [NotifyCenter] Destruction of the end
2025-05-25 03:22:25.711 [Thread-1] WARN  c.alibaba.nacos.common.http.HttpClientBeanHolder - [HttpClientBeanHolder] Destruction of the end
2025-05-25 03:22:25.731 [SpringContextShutdownHook] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - De-registering from Nacos Server now...
2025-05-25 03:22:25.732 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - [DEREGISTER-SERVICE] d750d92e-152f-4055-a641-3bc9dda85a29 deregistering service bgtech-ai with instance: Instance{instanceId='null', ip='192.168.86.8', port=8080, weight=1.0, healthy=true, enabled=true, ephemeral=true, clusterName='DEFAULT', serviceName='null', metadata={}}
2025-05-25 03:22:25.739 [SpringContextShutdownHook] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - De-registration finished.
2025-05-25 03:22:25.740 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.cache.ServiceInfoHolder do shutdown begin
2025-05-25 03:22:25.740 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.backups.FailoverReactor do shutdown begin
2025-05-25 03:22:25.740 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.backups.FailoverReactor do shutdown stop
2025-05-25 03:22:25.740 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.cache.ServiceInfoHolder do shutdown stop
2025-05-25 03:22:25.740 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.NamingClientProxyDelegate do shutdown begin
2025-05-25 03:22:25.740 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServiceInfoUpdateService do shutdown begin
2025-05-25 03:22:25.740 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServiceInfoUpdateService do shutdown stop
2025-05-25 03:22:25.740 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServerListManager do shutdown begin
2025-05-25 03:22:25.740 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Start destroying NacosRestTemplate
2025-05-25 03:22:25.740 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Destruction of the end
2025-05-25 03:22:25.740 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServerListManager do shutdown stop
2025-05-25 03:22:25.740 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.http.NamingHttpClientProxy do shutdown begin
2025-05-25 03:22:25.740 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Start destroying NacosRestTemplate
2025-05-25 03:22:25.740 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Destruction of the end
2025-05-25 03:22:25.741 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.http.NamingHttpClientProxy do shutdown stop
2025-05-25 03:22:25.741 [SpringContextShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Shutdown rpc client, set status to shutdown
2025-05-25 03:22:25.741 [SpringContextShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Shutdown client event executor java.util.concurrent.ScheduledThreadPoolExecutor@64ad8c92[Running, pool size = 2, active threads = 2, queued tasks = 0, completed tasks = 0]
2025-05-25 03:22:25.741 [SpringContextShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Close current connection 1748114373307_139.227.195.192_48917
2025-05-25 03:22:25.744 [nacos-grpc-client-executor-8.133.246.113-53] WARN  c.a.nacos.common.remote.client.grpc.GrpcClient - [1748114373307_139.227.195.192_48917]Ignore error event,isRunning:false,isAbandon=false
2025-05-25 03:22:25.745 [SpringContextShutdownHook] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - Shutdown grpc executor java.util.concurrent.ThreadPoolExecutor@70d524d6[Running, pool size = 5, active threads = 0, queued tasks = 0, completed tasks = 54]
2025-05-25 03:22:25.745 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - Shutdown grpc redo service executor java.util.concurrent.ScheduledThreadPoolExecutor@2c7ac668[Running, pool size = 1, active threads = 0, queued tasks = 1, completed tasks = 57]
2025-05-25 03:22:25.746 [SpringContextShutdownHook] INFO  c.a.n.client.auth.ram.identify.CredentialWatcher - [null] CredentialWatcher is stopped
2025-05-25 03:22:25.746 [SpringContextShutdownHook] INFO  c.a.n.client.auth.ram.identify.CredentialService - [null] CredentialService is freed
2025-05-25 03:22:25.746 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.NamingClientProxyDelegate do shutdown stop
2025-05-25 03:22:25.753 [SpringContextShutdownHook] DEBUG com.bgpay.bgai.config.AsyncConfig$1 - Shutting down ExecutorService 'blockingExecutor'
2025-05-25 03:22:27.829 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:10911] result: true
2025-05-25 03:22:27.829 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:9876] result: true
2025-05-25 03:22:27.843 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:10911] result: true
2025-05-25 03:22:27.843 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:9876] result: true
2025-05-25 03:22:27.955 [SpringContextShutdownHook] INFO  o.s.orm.jpa.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-05-25 03:22:27.956 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-2} closing ...
2025-05-25 03:22:27.960 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-2} closed
2025-05-25 03:22:27.960 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} closing ...
2025-05-25 03:22:27.961 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} closed
2025-05-25 03:22:27.961 [NettyClientSelector_TMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - channel inactive: [id: 0x0bc4af61, L:/192.168.86.8:60410 ! R:/8.133.246.113:8091]
2025-05-25 03:22:27.961 [NettyClientSelector_TMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - return to pool, rm channel:[id: 0x0bc4af61, L:/192.168.86.8:60410 ! R:/8.133.246.113:8091]
2025-05-25 03:22:27.961 [NettyClientSelector_TMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - channel valid false,channel:[id: 0x0bc4af61, L:/192.168.86.8:60410 ! R:/8.133.246.113:8091]
2025-05-25 03:22:27.961 [NettyClientSelector_TMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - will destroy channel:[id: 0x0bc4af61, L:/192.168.86.8:60410 ! R:/8.133.246.113:8091]
2025-05-25 03:22:27.961 [NettyClientSelector_TMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0x0bc4af61, L:/192.168.86.8:60410 ! R:/8.133.246.113:8091]) will closed
2025-05-25 03:22:27.961 [NettyClientSelector_TMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0x0bc4af61, L:/192.168.86.8:60410 ! R:/8.133.246.113:8091]) will closed
2025-05-25 03:22:27.962 [NettyClientSelector_RMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - channel inactive: [id: 0xf1d0f027, L:/192.168.86.8:60415 ! R:/8.133.246.113:8091]
2025-05-25 03:22:27.962 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - return to pool, rm channel:[id: 0xf1d0f027, L:/192.168.86.8:60415 ! R:/8.133.246.113:8091]
2025-05-25 03:22:27.962 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - channel valid false,channel:[id: 0xf1d0f027, L:/192.168.86.8:60415 ! R:/8.133.246.113:8091]
2025-05-25 03:22:27.962 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - will destroy channel:[id: 0xf1d0f027, L:/192.168.86.8:60415 ! R:/8.133.246.113:8091]
2025-05-25 03:22:27.962 [NettyClientSelector_RMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0xf1d0f027, L:/192.168.86.8:60415 ! R:/8.133.246.113:8091]) will closed
2025-05-25 03:22:27.962 [NettyClientSelector_RMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0xf1d0f027, L:/192.168.86.8:60415 ! R:/8.133.246.113:8091]) will closed
2025-05-25 03:25:51.633 [main] WARN  com.alibaba.nacos.client.logging.NacosLogging - Load Logback Configuration of Nacos fail, message: Could not initialize Logback Nacos logging from classpath:nacos-logback.xml
2025-05-25 03:25:51.634 [main] INFO  com.bgpay.bgai.BgaiApplication - The following 1 profile is active: "dev"
2025-05-25 03:25:52.950 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-05-25 03:25:52.952 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-05-25 03:25:52.978 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 19 ms. Found 0 JPA repository interfaces.
2025-05-25 03:25:52.989 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-05-25 03:25:52.990 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-05-25 03:25:53.001 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 4 ms. Found 0 Redis repository interfaces.
2025-05-25 03:25:53.539 [main] INFO  io.seata.config.ConfigurationFactory - load Configuration from :Spring Configuration
2025-05-25 03:25:53.547 [main] INFO  io.seata.config.ConfigurationFactory - load Configuration from :Spring Configuration
2025-05-25 03:25:53.553 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Initializing Global Transaction Clients ... 
2025-05-25 03:25:53.650 [main] INFO  io.seata.core.rpc.netty.NettyClientBootstrap - NettyClientBootstrap has started
2025-05-25 03:25:53.651 [main] INFO  io.seata.discovery.registry.RegistryFactory - use registry center type: file
2025-05-25 03:25:53.660 [main] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - will connect to 8.133.246.113:8091
2025-05-25 03:25:53.664 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - NettyPool create channel to transactionRole:TMROLE,address:8.133.246.113:8091,msg:< RegisterTMRequest{version='1.7.0', applicationId='bgtech-ai', transactionServiceGroup='bgai-tx-group', extraData='ak=null
digest=bgai-tx-group,192.168.86.8,1748114753663
timestamp=1748114753663
authVersion=V4
vgroup=bgai-tx-group
ip=192.168.86.8
'} >
2025-05-25 03:25:53.803 [main] INFO  io.seata.core.rpc.netty.TmNettyRemotingClient - register TM success. client version:1.7.0, server version:1.8.1-SNAPSHOT,channel:[id: 0xa35112c7, L:/192.168.86.8:63398 - R:/8.133.246.113:8091]
2025-05-25 03:25:53.810 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - register success, cost 74 ms, version:1.8.1-SNAPSHOT,role:TMROLE,channel:[id: 0xa35112c7, L:/192.168.86.8:63398 - R:/8.133.246.113:8091]
2025-05-25 03:25:53.811 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Transaction Manager Client is initialized. applicationId[bgtech-ai] txServiceGroup[bgai-tx-group]
2025-05-25 03:25:53.826 [main] INFO  io.seata.rm.datasource.AsyncWorker - Async Commit Buffer Limit: 10000
2025-05-25 03:25:53.827 [main] INFO  io.seata.rm.datasource.xa.ResourceManagerXA - ResourceManagerXA init ...
2025-05-25 03:25:53.834 [main] INFO  io.seata.core.rpc.netty.NettyClientBootstrap - NettyClientBootstrap has started
2025-05-25 03:25:53.834 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Resource Manager is initialized. applicationId[bgtech-ai] txServiceGroup[bgai-tx-group]
2025-05-25 03:25:53.834 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Global Transaction Clients are initialized. 
2025-05-25 03:25:54.904 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat initialized with port(s): 8080 (http)
2025-05-25 03:25:54.917 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - The ["http-nio-8080"] connector has been configured to support HTTP upgrade to [h2c]
2025-05-25 03:25:54.917 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - Initializing ProtocolHandler ["http-nio-8080"]
2025-05-25 03:25:54.919 [main] INFO  org.apache.catalina.core.StandardService - Starting service [Tomcat]
2025-05-25 03:25:54.919 [main] INFO  org.apache.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.15]
2025-05-25 03:25:55.385 [main] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} inited
2025-05-25 03:25:55.642 [main] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - will connect to 8.133.246.113:8091
2025-05-25 03:25:55.642 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - RM will register :jdbc:mysql://8.133.246.113:3306/deepseek
2025-05-25 03:25:55.642 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - NettyPool create channel to transactionRole:RMROLE,address:8.133.246.113:8091,msg:< RegisterRMRequest{resourceIds='jdbc:mysql://8.133.246.113:3306/deepseek', version='1.7.0', applicationId='bgtech-ai', transactionServiceGroup='bgai-tx-group', extraData='null'} >
2025-05-25 03:25:55.660 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - register RM success. client version:1.7.0, server version:1.8.1-SNAPSHOT,channel:[id: 0xd055505d, L:/192.168.86.8:63400 - R:/8.133.246.113:8091]
2025-05-25 03:25:55.661 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - register success, cost 11 ms, version:1.8.1-SNAPSHOT,role:RMROLE,channel:[id: 0xd055505d, L:/192.168.86.8:63400 - R:/8.133.246.113:8091]
2025-05-25 03:25:55.663 [main] INFO  i.s.s.a.datasource.SeataAutoDataSourceProxyCreator - Auto proxy data source 'masterDataSource' by 'AT' mode.
2025-05-25 03:25:55.724 [main] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-2} inited
2025-05-25 03:25:55.813 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - will register resourceId:jdbc:mysql://8.133.246.113:3306/deepseek
2025-05-25 03:25:55.814 [main] INFO  i.s.s.a.datasource.SeataAutoDataSourceProxyCreator - Auto proxy data source 'slaveDataSource' by 'AT' mode.
2025-05-25 03:25:55.821 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.rm.AbstractRMHandler - the rm client received response msg [RegisterRMResponse{version='1.8.1-SNAPSHOT', extraData='null', identified=true, resultCode=null, msg='null'}] from tc server.
2025-05-25 03:25:55.839 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - will register resourceId:jdbc:mysql://8.133.246.113:3306/deepseek
2025-05-25 03:25:55.840 [main] INFO  i.s.s.a.datasource.SeataAutoDataSourceProxyCreator - Auto proxy data source 'dynamicDataSource' by 'AT' mode.
2025-05-25 03:25:55.855 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.rm.AbstractRMHandler - the rm client received response msg [RegisterRMResponse{version='1.8.1-SNAPSHOT', extraData='null', identified=true, resultCode=null, msg='null'}] from tc server.
2025-05-25 03:25:55.956 [main] INFO  org.hibernate.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-05-25 03:25:56.004 [main] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.1.7.Final
2025-05-25 03:25:56.332 [main] INFO  SQL dialect - HHH000400: Using dialect: org.hibernate.dialect.MySQL8Dialect
2025-05-25 03:25:56.335 [main] WARN  org.hibernate.orm.deprecation - HHH90000026: MySQL8Dialect has been deprecated; use org.hibernate.dialect.MySQLDialect instead
2025-05-25 03:25:56.641 [main] INFO  o.h.e.t.jta.platform.internal.JtaPlatformInitiator - HHH000490: Using JtaPlatform implementation: [org.hibernate.engine.transaction.jta.platform.internal.NoJtaPlatform]
2025-05-25 03:25:56.652 [main] INFO  o.s.orm.jpa.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-05-25 03:25:57.079 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-25 03:25:57.089 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-25 03:25:57.120 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-25 03:25:57.123 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-25 03:25:57.123 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-25 03:25:57.138 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-25 03:25:57.749 [main] INFO  com.bgpay.bgai.service.impl.UserServiceImpl - 初始化SSO配置: clientId=bgai-client-id, redirectUri=http://localhost:8080/api/auth/callback
2025-05-25 03:25:57.885 [main] INFO  com.bgpay.bgai.controller.AuthController - 初始化认证控制器: clientId=bgai-client-id, redirectUri=http://localhost:8080/api/auth/callback
2025-05-25 03:25:58.428 [main] INFO  o.a.r.s.autoconfigure.RocketMQAutoConfiguration - a producer (billing-producer-group) init on namesrv 8.133.246.113:9876
2025-05-25 03:25:59.064 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Bean [com.bgpay.bgai.service.deepseek.DeepSeekServiceImp$$SpringCGLIB$$0] with name [deepSeekServiceImp] would use interceptor [io.seata.spring.annotation.GlobalTransactionalInterceptor]
2025-05-25 03:25:59.406 [main] WARN  i.s.s.b.a.provider.SpringBootConfigurationProvider - The get method not found for the field 'SeataProperties#accesskey'.
2025-05-25 03:25:59.407 [main] WARN  i.s.s.b.a.provider.SpringBootConfigurationProvider - The get method not found for the field 'SeataProperties#secretkey'.
2025-05-25 03:25:59.417 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 加载到1个Saga状态机定义文件
2025-05-25 03:25:59.578 [main] INFO  com.bgpay.bgai.saga.CustomSagaJsonParser - 开始解析状态机定义: bgai-saga-transaction
2025-05-25 03:25:59.578 [main] INFO  com.bgpay.bgai.saga.CustomSagaJsonParser - 状态机定义解析成功: bgai-saga-transaction
2025-05-25 03:25:59.578 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 成功加载状态机定义: /E:/project/bgai/target/classes/statelang/bgai-saga-transaction.json
2025-05-25 03:26:00.011 [main] INFO  org.redisson.Version - Redisson 3.24.3
2025-05-25 03:26:00.137 [redisson-netty-4-6] INFO  o.r.connection.pool.MasterPubSubConnectionPool - 1 connections initialized for 8.133.246.113/8.133.246.113:6379
2025-05-25 03:26:00.480 [redisson-netty-4-19] INFO  org.redisson.connection.pool.MasterConnectionPool - 24 connections initialized for 8.133.246.113/8.133.246.113:6379
2025-05-25 03:26:00.649 [main] INFO  com.bgpay.bgai.service.mq.MQConsumerService - MQ consumer startup successful [group=billing-consumer-group, topic=BILLING_TOPIC, tag=USER_BILLING]
2025-05-25 03:26:00.814 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Bean [com.bgpay.bgai.service.mq.BillingTransactionListenerImpl$$SpringCGLIB$$0] with name [billingTransactionListenerImpl] would use interceptor [io.seata.spring.annotation.GlobalTransactionalInterceptor]
2025-05-25 03:26:00.940 [main] DEBUG com.bgpay.bgai.config.AsyncConfig$1 - Initializing ExecutorService 'blockingExecutor'
2025-05-25 03:26:00.980 [main] INFO  c.b.bgai.config.NacosConfig$NacosWarningHandler - Nacos警告处理器已启用，将忽略配置中心连接警告
2025-05-25 03:26:02.161 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [After]
2025-05-25 03:26:02.161 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Before]
2025-05-25 03:26:02.161 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Between]
2025-05-25 03:26:02.161 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Cookie]
2025-05-25 03:26:02.161 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Header]
2025-05-25 03:26:02.161 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Host]
2025-05-25 03:26:02.161 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Method]
2025-05-25 03:26:02.161 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Path]
2025-05-25 03:26:02.161 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Query]
2025-05-25 03:26:02.161 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [ReadBody]
2025-05-25 03:26:02.161 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [RemoteAddr]
2025-05-25 03:26:02.162 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [XForwardedRemoteAddr]
2025-05-25 03:26:02.162 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Weight]
2025-05-25 03:26:02.162 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [CloudFoundryRouteService]
2025-05-25 03:26:03.555 [main] INFO  o.s.b.actuate.endpoint.web.EndpointLinksResolver - Exposing 3 endpoint(s) beneath base path '/actuator'
2025-05-25 03:26:05.111 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - Starting ProtocolHandler ["http-nio-8080"]
2025-05-25 03:26:05.125 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat started on port(s): 8080 (http) with context path ''
2025-05-25 03:26:05.136 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from ans.namespace attribute : null
2025-05-25 03:26:05.137 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from ALIBABA_ALIWARE_NAMESPACE attribute :null
2025-05-25 03:26:05.137 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from namespace attribute :null
2025-05-25 03:26:05.147 [main] INFO  c.a.n.p.auth.spi.client.ClientAuthPluginManager - [ClientAuthPluginManager] Load ClientAuthService com.alibaba.nacos.client.auth.impl.NacosClientAuthServiceImpl success.
2025-05-25 03:26:05.148 [main] INFO  c.a.n.p.auth.spi.client.ClientAuthPluginManager - [ClientAuthPluginManager] Load ClientAuthService com.alibaba.nacos.client.auth.ram.RamClientAuthServiceImpl success.
2025-05-25 03:26:05.153 [main] INFO  com.alibaba.nacos.common.remote.client - [RpcClientFactory] create a new rpc client of c657c7eb-935a-492b-9ace-7ff8348cf881
2025-05-25 03:26:05.155 [main] INFO  com.alibaba.nacos.common.remote.client - [c657c7eb-935a-492b-9ace-7ff8348cf881] RpcClient init, ServerListFactory = com.alibaba.nacos.client.naming.core.ServerListManager
2025-05-25 03:26:05.155 [main] INFO  com.alibaba.nacos.common.remote.client - [c657c7eb-935a-492b-9ace-7ff8348cf881] Registry connection listener to current client:com.alibaba.nacos.client.naming.remote.gprc.redo.NamingGrpcRedoService
2025-05-25 03:26:05.155 [main] INFO  com.alibaba.nacos.common.remote.client - [c657c7eb-935a-492b-9ace-7ff8348cf881] Register server push request handler:com.alibaba.nacos.client.naming.remote.gprc.NamingPushRequestHandler
2025-05-25 03:26:05.156 [main] INFO  com.alibaba.nacos.common.remote.client - [c657c7eb-935a-492b-9ace-7ff8348cf881] Try to connect to server on start up, server: {serverIp = '8.133.246.113', server main port = 8848}
2025-05-25 03:26:05.156 [main] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - grpc client connection server:8.133.246.113 ip,serverPort:9848,grpcTslConfig:{"sslProvider":"OPENSSL","enableTls":false,"mutualAuthEnable":false,"trustAll":false}
2025-05-25 03:26:05.401 [main] INFO  com.alibaba.nacos.common.remote.client - [c657c7eb-935a-492b-9ace-7ff8348cf881] Success to connect to server [8.133.246.113:8848] on start up, connectionId = 1748114765293_139.227.195.192_49772
2025-05-25 03:26:05.401 [main] INFO  com.alibaba.nacos.common.remote.client - [c657c7eb-935a-492b-9ace-7ff8348cf881] Register server push request handler:com.alibaba.nacos.common.remote.client.RpcClient$ConnectResetRequestHandler
2025-05-25 03:26:05.401 [com.alibaba.nacos.client.remote.worker] INFO  com.alibaba.nacos.common.remote.client - [c657c7eb-935a-492b-9ace-7ff8348cf881] Notify connected event to listeners.
2025-05-25 03:26:05.401 [main] INFO  com.alibaba.nacos.common.remote.client - [c657c7eb-935a-492b-9ace-7ff8348cf881] Register server push request handler:com.alibaba.nacos.common.remote.client.RpcClient$$Lambda/0x0000021609528f48
2025-05-25 03:26:05.401 [com.alibaba.nacos.client.remote.worker] INFO  com.alibaba.nacos.client.naming - Grpc connection connect
2025-05-25 03:26:05.402 [main] INFO  com.alibaba.nacos.client.naming - [REGISTER-SERVICE] d750d92e-152f-4055-a641-3bc9dda85a29 registering service bgtech-ai with instance Instance{instanceId='null', ip='192.168.86.8', port=8080, weight=1.0, healthy=true, enabled=true, ephemeral=true, clusterName='DEFAULT', serviceName='null', metadata={IPv6=[2408:820c:7528:d042:c185:8edc:f30d:3d91], preserved.register.source=SPRING_CLOUD}}
2025-05-25 03:26:05.423 [main] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - nacos registry, DEFAULT_GROUP bgtech-ai 192.168.86.8:8080 register finished
2025-05-25 03:26:05.469 [main] INFO  com.bgpay.bgai.config.NacosConfig - 应用启动完成，当前环境: dev
2025-05-25 03:26:05.469 [main] INFO  com.bgpay.bgai.config.NacosConfig - Nacos配置中心: 8.133.246.113:8848, 命名空间: d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-25 03:26:05.469 [main] INFO  com.bgpay.bgai.config.NacosConfig - 注意: 如果看到Nacos配置加载警告，但应用正常启动，说明应用正在使用本地配置文件
2025-05-25 03:26:05.471 [main] INFO  com.bgpay.bgai.BgaiApplication - Started BgaiApplication in 16.04 seconds (process running for 17.319)
2025-05-25 03:26:05.474 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-25 03:26:05.474 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-25 03:26:05.485 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-25 03:26:05.485 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-25 03:26:05.485 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-25 03:26:05.494 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-25 03:26:05.494 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-25 03:26:05.495 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-25 03:26:05.503 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-25 03:26:05.504 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-25 03:26:05.504 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-25 03:26:05.511 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-25 03:26:05.512 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - ==================== Saga状态机加载报告 ====================
2025-05-25 03:26:05.512 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - Saga状态机配置加载状态: 成功
2025-05-25 03:26:05.512 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 已加载的状态机定义文件数量: 1
2025-05-25 03:26:05.512 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 已加载的状态机定义文件:
2025-05-25 03:26:05.512 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig -  - /E:/project/bgai/target/classes/statelang/bgai-saga-transaction.json
2025-05-25 03:26:05.512 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - Saga解析器状态: CUSTOM_FASTJSON2
2025-05-25 03:26:05.512 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 状态机解析结果: 成功 1 个, 失败 0 个
2025-05-25 03:26:05.512 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - =============================================================
2025-05-25 03:26:05.516 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - nacos.cache.data.init.snapshot = true 
2025-05-25 03:26:05.516 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] common-dev.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-25 03:26:05.523 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=common-dev.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-25 03:26:05.524 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=common-dev.yaml, group=DEFAULT_GROUP
2025-05-25 03:26:05.524 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-25 03:26:05.524 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-25 03:26:05.524 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai.yaml, group=DEFAULT_GROUP
2025-05-25 03:26:05.526 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai-dev.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-25 03:26:05.526 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai-dev.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-25 03:26:05.526 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai-dev.yaml, group=DEFAULT_GROUP
2025-05-25 03:26:05.526 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-25 03:26:05.526 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai, group=DEFAULT_GROUP, cnt=1
2025-05-25 03:26:05.526 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai, group=DEFAULT_GROUP
2025-05-25 03:26:15.551 [http-nio-8080-exec-3] DEBUG com.bgpay.bgai.filter.ApiKeyAuthenticationFilter - Skipping API Key validation for excluded path: /auth/authorize
2025-05-25 03:26:15.574 [http-nio-8080-exec-3] INFO  com.bgpay.bgai.controller.MockAuthController - Authorization request: client_id=bgai-client-id, redirect_uri=http://localhost:8080/api/auth/callback, response_type=code
2025-05-25 03:26:21.965 [http-nio-8080-exec-4] DEBUG com.bgpay.bgai.filter.ApiKeyAuthenticationFilter - Skipping API Key validation for excluded path: /api/auth/callback
2025-05-25 03:26:22.005 [http-nio-8080-exec-5] DEBUG com.bgpay.bgai.filter.ApiKeyAuthenticationFilter - Skipping API Key validation for excluded path: /auth/token
2025-05-25 03:26:22.008 [http-nio-8080-exec-5] INFO  com.bgpay.bgai.controller.MockAuthController - Token request: grant_type=null, code=null, client_id=null
2025-05-25 03:26:22.023 [http-nio-8080-exec-6] DEBUG com.bgpay.bgai.filter.ApiKeyAuthenticationFilter - Skipping API Key validation for excluded path: /auth/userinfo
2025-05-25 03:26:22.036 [http-nio-8080-exec-4] DEBUG com.bgpay.bgai.mapper.UserMapper.findByUserId - ==>  Preparing: SELECT * FROM t_user WHERE user_id = ?
2025-05-25 03:26:22.038 [http-nio-8080-exec-4] DEBUG com.bgpay.bgai.mapper.UserMapper.findByUserId - ==> Parameters: 689258T(String)
2025-05-25 03:26:22.050 [http-nio-8080-exec-4] DEBUG com.bgpay.bgai.mapper.UserMapper.findByUserId - <==      Total: 1
2025-05-25 03:26:22.135 [http-nio-8080-exec-4] DEBUG com.bgpay.bgai.mapper.UserMapper.updateById - ==>  Preparing: UPDATE t_user SET user_id=?, username=?, email=?, avatar_url=?, last_login_time=?, access_token=?, refresh_token=?, token_expire_time=?, status=?, create_time=?, update_time=? WHERE id=?
2025-05-25 03:26:22.139 [http-nio-8080-exec-4] DEBUG com.bgpay.bgai.mapper.UserMapper.updateById - ==> Parameters: 689258T(String), 测试用户(String), test@example.com(String), https://ui-avatars.com/api/?name=测试用户(String), 2025-05-25T03:26:22.051775500(LocalDateTime), f67070c0-493c-4324-a374-1e8fc065261b(String), 2ae0feef-c5c8-4349-9893-780292a1d9d2(String), 2025-05-25T04:26:22.051775500(LocalDateTime), 1(Integer), 2025-04-26T23:59:16(LocalDateTime), 2025-05-25T03:26:22.051775500(LocalDateTime), 1(Long)
2025-05-25 03:26:22.154 [http-nio-8080-exec-4] DEBUG com.bgpay.bgai.mapper.UserMapper.updateById - <==    Updates: 1
2025-05-25 03:26:35.042 [http-nio-8080-exec-7] INFO  com.bgpay.bgai.controller.ReactiveChatController - 接收到请求: /api/chatGatWay-internal, 文件=新文件 17.txt, 问题参数=null, 模型参数=null
2025-05-25 03:26:35.043 [http-nio-8080-exec-7] INFO  com.bgpay.bgai.controller.ReactiveChatController - 请求Content-Type: multipart/form-data;boundary=--------------------------262829616444078150793633
2025-05-25 03:26:35.044 [http-nio-8080-exec-7] INFO  com.bgpay.bgai.controller.ReactiveChatController - 收集到的完整参数: question="null", apiUrl="null", modelName="null", multiTurn=false
2025-05-25 03:26:35.046 [http-nio-8080-exec-7] INFO  com.bgpay.bgai.controller.ReactiveChatController - Processing request for user ID: 689258T
2025-05-25 03:26:35.046 [http-nio-8080-exec-7] INFO  com.bgpay.bgai.controller.ReactiveChatController - Processing file with circuit breaker: fileName=新文件 17.txt, question=
2025-05-25 03:26:35.048 [http-nio-8080-exec-7] INFO  com.bgpay.bgai.config.ReactiveFileProcessor - Processing file: 新文件 17.txt, content-type: text/plain
2025-05-25 03:26:35.056 [http-nio-8080-exec-7] INFO  com.bgpay.bgai.controller.ReactiveChatController - PARAM TRACE [689258T]: 尝试查找匹配配置 - 参数: apiUrl=null, modelName=null
2025-05-25 03:26:35.068 [http-nio-8080-exec-7] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 查询配置 - userId=689258T
2025-05-25 03:26:35.069 [http-nio-8080-exec-7] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 排序方式 - 按ID降序
2025-05-25 03:26:35.070 [http-nio-8080-exec-7] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 限制结果数 - LIMIT 1
2025-05-25 03:26:35.082 [http-nio-8080-exec-7] DEBUG com.bgpay.bgai.mapper.ApiConfigMapper.selectList - ==>  Preparing: SELECT id,api_url,api_key,model_name,user_id FROM api_config WHERE (user_id = ?) ORDER BY id DESC LIMIT 1
2025-05-25 03:26:35.082 [http-nio-8080-exec-7] DEBUG com.bgpay.bgai.mapper.ApiConfigMapper.selectList - ==> Parameters: 689258T(String)
2025-05-25 03:26:35.091 [http-nio-8080-exec-7] DEBUG com.bgpay.bgai.mapper.ApiConfigMapper.selectList - <==      Total: 1
2025-05-25 03:26:35.091 [http-nio-8080-exec-7] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 查询结果 - 找到配置: id=2, modelName=deepseek-chat
2025-05-25 03:26:35.091 [http-nio-8080-exec-7] INFO  com.bgpay.bgai.controller.ReactiveChatController - PARAM TRACE [689258T]: 找到匹配配置 - apiUrl=https://api.deepseek.com/chat/completions, modelName=deepseek-chat (原始请求: null)
2025-05-25 03:26:35.091 [http-nio-8080-exec-7] INFO  com.bgpay.bgai.controller.ReactiveChatController - API config resolved: url=https://api.deepseek.com/chat/completions, model=deepseek-chat
2025-05-25 03:26:35.112 [Thread-53] INFO  com.bgpay.bgai.config.ReactiveFileProcessor - File processed successfully: size=37 bytes
2025-05-25 03:26:35.117 [Thread-53] INFO  com.bgpay.bgai.controller.ReactiveChatController - Content processed, length: 54
2025-05-25 03:26:35.125 [Thread-53] INFO  io.seata.tm.TransactionManagerHolder - TransactionManager Singleton io.seata.tm.DefaultTransactionManager@4430b91a
2025-05-25 03:26:35.142 [Thread-53] INFO  io.seata.tm.api.DefaultGlobalTransaction - Begin new global transaction [seata-server:8091:153776404394049633]
2025-05-25 03:26:35.146 [Thread-53] INFO  c.b.bgai.interceptor.SeataTransactionInterceptor - 准备记录分布式事务开始: XID=seata-server:8091:153776404394049633, 业务=com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive, 路径=, IP=, 用户=system
2025-05-25 03:26:35.156 [Thread-53] INFO  c.b.bgai.service.impl.TransactionLogServiceImpl - 记录分布式事务开始: XID=seata-server:8091:153776404394049633, 业务=com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive
2025-05-25 03:26:35.160 [Thread-53] DEBUG com.bgpay.bgai.mapper.TransactionLogMapper.insert - ==>  Preparing: INSERT INTO transaction_log ( xid, transaction_name, transaction_mode, status, request_path, source_ip, start_time, user_id, create_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-05-25 03:26:35.164 [Thread-53] DEBUG com.bgpay.bgai.mapper.TransactionLogMapper.insert - ==> Parameters: seata-server:8091:153776404394049633(String), com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive(String), AT(String), ACTIVE(String), (String), (String), 2025-05-25T03:26:35.156089300(LocalDateTime), system(String), 2025-05-25T03:26:35.156089300(LocalDateTime)
2025-05-25 03:26:35.551 [Thread-53] DEBUG com.bgpay.bgai.mapper.TransactionLogMapper.insert - <==    Updates: 1
2025-05-25 03:26:35.569 [Thread-53] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:153776404394049633, branchId:153776404394049634, lockKeys:transaction_log:49
2025-05-25 03:26:35.580 [Thread-53] WARN  i.s.c.l.EnhancedServiceLoader$InnerEnhancedServiceLoader - Load [io.seata.rm.datasource.undo.parser.ProtostuffUndoLogParser] class fail: io/protostuff/runtime/IdStrategy
2025-05-25 03:26:35.647 [Thread-53] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:153776404394049633, branchId:153776404394049635, lockKeys:undo_log:199;transaction_log:49
2025-05-25 03:26:35.685 [Thread-53] INFO  c.b.bgai.interceptor.SeataTransactionInterceptor - 开始分布式事务: XID=seata-server:8091:153776404394049633, 方法=com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive
2025-05-25 03:26:35.697 [Thread-53] INFO  org.reflections.Reflections - Processing reactive request: content length=54, apiUrl=https://api.deepseek.com/chat/completions, modelName=deepseek-chat, userId=689258T, multiTurn=false
2025-05-25 03:26:35.705 [Thread-53] INFO  c.b.bgai.service.impl.TransactionLogServiceImpl - 记录分布式事务结束: XID=seata-server:8091:153776404394049633, 状态=COMMITTED
2025-05-25 03:26:35.706 [Thread-53] DEBUG c.b.bgai.mapper.TransactionLogMapper.selectList - ==>  Preparing: SELECT id,xid,branch_id,transaction_name,transaction_mode,status,request_path,source_ip,start_time,end_time,user_id,extra_data,create_time,update_time FROM transaction_log WHERE (xid = ?) LIMIT 1
2025-05-25 03:26:35.708 [Thread-53] DEBUG c.b.bgai.mapper.TransactionLogMapper.selectList - ==> Parameters: seata-server:8091:153776404394049633(String)
2025-05-25 03:26:35.715 [Thread-53] DEBUG c.b.bgai.mapper.TransactionLogMapper.selectList - <==      Total: 1
2025-05-25 03:26:35.718 [Thread-53] DEBUG c.b.bgai.mapper.TransactionLogMapper.updateById - ==>  Preparing: UPDATE transaction_log SET xid=?, transaction_name=?, transaction_mode=?, status=?, request_path=?, source_ip=?, start_time=?, end_time=?, user_id=?, extra_data=?, create_time=?, update_time=? WHERE id=?
2025-05-25 03:26:35.723 [Thread-53] DEBUG c.b.bgai.mapper.TransactionLogMapper.updateById - ==> Parameters: seata-server:8091:153776404394049633(String), com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive(String), AT(String), COMMITTED(String), (String), (String), 2025-05-25T03:26:35(LocalDateTime), 2025-05-25T03:26:35.715350700(LocalDateTime), system(String), {"duration":14,"result":"success"}(String), 2025-05-25T03:26:35(LocalDateTime), 2025-05-25T03:26:35.715350700(LocalDateTime), 49(Long)
2025-05-25 03:26:35.770 [Thread-53] DEBUG c.b.bgai.mapper.TransactionLogMapper.updateById - <==    Updates: 1
2025-05-25 03:26:35.781 [Thread-53] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:153776404394049633, branchId:153776404394049636, lockKeys:transaction_log:49
2025-05-25 03:26:35.806 [Thread-53] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:153776404394049633, branchId:153776404394049637, lockKeys:undo_log:201;transaction_log:49
2025-05-25 03:26:35.841 [Thread-53] INFO  c.b.bgai.interceptor.SeataTransactionInterceptor - 分布式事务成功完成: XID=seata-server:8091:153776404394049633, 耗时=14ms
2025-05-25 03:26:35.841 [Thread-53] INFO  io.seata.tm.api.DefaultGlobalTransaction - transaction seata-server:8091:153776404394049633 will be commit
2025-05-25 03:26:35.854 [Thread-53] INFO  io.seata.tm.api.DefaultGlobalTransaction - transaction end, xid = seata-server:8091:153776404394049633
2025-05-25 03:26:35.854 [Thread-53] INFO  io.seata.tm.api.DefaultGlobalTransaction - [seata-server:8091:153776404394049633] commit status: Committed
2025-05-25 03:26:35.890 [boundedElastic-1] WARN  com.bgpay.bgai.transaction.TransactionCoordinator - Found existing transaction for user 689258T: chat-9461c381-b596-46f4-9d66-62aed4f11183
2025-05-25 03:26:35.890 [boundedElastic-1] INFO  org.reflections.Reflections - Transaction prepared with chatCompletionId: chat-9461c381-b596-46f4-9d66-62aed4f11183
2025-05-25 03:26:36.758 [rpcDispatch_RMROLE_1_1_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:153776404394049633', branchId=153776404394049634, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false,"skipCheckLock":true}'}
2025-05-25 03:26:36.759 [rpcDispatch_RMROLE_1_1_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:153776404394049633 153776404394049634 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false,"skipCheckLock":true}
2025-05-25 03:26:36.760 [rpcDispatch_RMROLE_1_1_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-25 03:26:36.771 [rpcDispatch_RMROLE_1_2_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:153776404394049633', branchId=153776404394049635, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false,"skipCheckLock":true}'}
2025-05-25 03:26:36.771 [rpcDispatch_RMROLE_1_2_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:153776404394049633 153776404394049635 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false,"skipCheckLock":true}
2025-05-25 03:26:36.771 [rpcDispatch_RMROLE_1_2_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-25 03:26:36.778 [rpcDispatch_RMROLE_1_3_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:153776404394049633', branchId=153776404394049636, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false}'}
2025-05-25 03:26:36.779 [rpcDispatch_RMROLE_1_3_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:153776404394049633 153776404394049636 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false}
2025-05-25 03:26:36.779 [rpcDispatch_RMROLE_1_3_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-25 03:26:36.788 [rpcDispatch_RMROLE_1_4_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:153776404394049633', branchId=153776404394049637, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false}'}
2025-05-25 03:26:36.788 [rpcDispatch_RMROLE_1_4_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:153776404394049633 153776404394049637 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false}
2025-05-25 03:26:36.788 [rpcDispatch_RMROLE_1_4_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-25 03:27:21.324 [FileWrite-1] INFO  com.bgpay.bgai.service.deepseek.FileWriterService - Successfully wrote content to: \var\data\ai_responses\c4ec99be-5a51-43cf-85b5-f99723eebcad.txt
2025-05-25 03:27:21.335 [reactor-http-nio-2] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - ==>  Preparing: INSERT INTO chat_completions ( object, created, model, system_fingerprint, api_key ) VALUES ( ?, ?, ?, ?, ? )
2025-05-25 03:27:21.335 [reactor-http-nio-2] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - ==> Parameters: chat.completion(String), 1748114841333(Long), deepseek-chat(String), 689258T(String), chat-9461c381-b596-46f4-9d66-62aed4f11183(String)
2025-05-25 03:27:21.346 [reactor-http-nio-2] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - <==    Updates: 1
2025-05-25 03:27:21.346 [reactor-http-nio-2] INFO  com.bgpay.bgai.transaction.TransactionCoordinator - Transaction committed for user 689258T: chatCompletionId=chat-9461c381-b596-46f4-9d66-62aed4f11183
2025-05-25 03:27:21.361 [reactor-http-nio-2] INFO  org.reflections.Reflections - 开始发送账单消息，chatCompletionId: chat-9461c381-b596-46f4-9d66-62aed4f11183, userId: 689258T
2025-05-25 03:27:21.409 [reactor-http-nio-2] INFO  io.seata.tm.api.DefaultGlobalTransaction - Begin new global transaction [seata-server:8091:153776404394049638]
2025-05-25 03:27:21.410 [reactor-http-nio-2] INFO  c.b.bgai.interceptor.SeataTransactionInterceptor - 准备记录分布式事务开始: XID=seata-server:8091:153776404394049638, 业务=com.bgpay.bgai.service.mq.BillingTransactionListenerImpl.executeLocalTransaction, 路径=, IP=, 用户=system
2025-05-25 03:27:21.423 [reactor-http-nio-2] INFO  c.b.bgai.service.impl.TransactionLogServiceImpl - 记录分布式事务开始: XID=seata-server:8091:153776404394049638, 业务=com.bgpay.bgai.service.mq.BillingTransactionListenerImpl.executeLocalTransaction
2025-05-25 03:27:21.424 [reactor-http-nio-2] DEBUG com.bgpay.bgai.mapper.TransactionLogMapper.insert - ==>  Preparing: INSERT INTO transaction_log ( xid, transaction_name, transaction_mode, status, request_path, source_ip, start_time, user_id, create_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-05-25 03:27:21.425 [reactor-http-nio-2] DEBUG com.bgpay.bgai.mapper.TransactionLogMapper.insert - ==> Parameters: seata-server:8091:153776404394049638(String), com.bgpay.bgai.service.mq.BillingTransactionListenerImpl.executeLocalTransaction(String), AT(String), ACTIVE(String), (String), (String), 2025-05-25T03:27:21.423237800(LocalDateTime), system(String), 2025-05-25T03:27:21.423237800(LocalDateTime)
2025-05-25 03:27:21.447 [reactor-http-nio-2] DEBUG com.bgpay.bgai.mapper.TransactionLogMapper.insert - <==    Updates: 1
2025-05-25 03:27:21.457 [reactor-http-nio-2] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:153776404394049638, branchId:153776404394049639, lockKeys:transaction_log:50
2025-05-25 03:27:21.474 [reactor-http-nio-2] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:153776404394049638, branchId:153776404394049640, lockKeys:undo_log:203;transaction_log:50
2025-05-25 03:27:21.499 [reactor-http-nio-2] INFO  c.b.bgai.interceptor.SeataTransactionInterceptor - 开始分布式事务: XID=seata-server:8091:153776404394049638, 方法=com.bgpay.bgai.service.mq.BillingTransactionListenerImpl.executeLocalTransaction
2025-05-25 03:27:21.499 [reactor-http-nio-2] INFO  c.b.bgai.service.mq.BillingTransactionListenerImpl - 开始执行本地事务, xid: seata-server:8091:153776404394049638, userId: 689258T, completionId: chat-9461c381-b596-46f4-9d66-62aed4f11183
2025-05-25 03:27:21.511 [reactor-http-nio-2] INFO  c.b.bgai.service.mq.BillingTransactionListenerImpl - 消息已处理，提交事务, completionId: chat-9461c381-b596-46f4-9d66-62aed4f11183
2025-05-25 03:27:21.515 [reactor-http-nio-2] INFO  c.b.bgai.service.impl.TransactionLogServiceImpl - 记录分布式事务结束: XID=seata-server:8091:153776404394049638, 状态=COMMITTED
2025-05-25 03:27:21.516 [reactor-http-nio-2] DEBUG c.b.bgai.mapper.TransactionLogMapper.selectList - ==>  Preparing: SELECT id,xid,branch_id,transaction_name,transaction_mode,status,request_path,source_ip,start_time,end_time,user_id,extra_data,create_time,update_time FROM transaction_log WHERE (xid = ?) LIMIT 1
2025-05-25 03:27:21.516 [reactor-http-nio-2] DEBUG c.b.bgai.mapper.TransactionLogMapper.selectList - ==> Parameters: seata-server:8091:153776404394049638(String)
2025-05-25 03:27:21.524 [reactor-http-nio-2] DEBUG c.b.bgai.mapper.TransactionLogMapper.selectList - <==      Total: 1
2025-05-25 03:27:21.526 [reactor-http-nio-2] DEBUG c.b.bgai.mapper.TransactionLogMapper.updateById - ==>  Preparing: UPDATE transaction_log SET xid=?, transaction_name=?, transaction_mode=?, status=?, request_path=?, source_ip=?, start_time=?, end_time=?, user_id=?, extra_data=?, create_time=?, update_time=? WHERE id=?
2025-05-25 03:27:21.526 [reactor-http-nio-2] DEBUG c.b.bgai.mapper.TransactionLogMapper.updateById - ==> Parameters: seata-server:8091:153776404394049638(String), com.bgpay.bgai.service.mq.BillingTransactionListenerImpl.executeLocalTransaction(String), AT(String), COMMITTED(String), (String), (String), 2025-05-25T03:27:21(LocalDateTime), 2025-05-25T03:27:21.524998400(LocalDateTime), system(String), {"duration":12,"result":"success"}(String), 2025-05-25T03:27:21(LocalDateTime), 2025-05-25T03:27:21.524998400(LocalDateTime), 50(Long)
2025-05-25 03:27:21.583 [reactor-http-nio-2] DEBUG c.b.bgai.mapper.TransactionLogMapper.updateById - <==    Updates: 1
2025-05-25 03:27:21.594 [reactor-http-nio-2] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:153776404394049638, branchId:153776404394049641, lockKeys:transaction_log:50
2025-05-25 03:27:21.616 [reactor-http-nio-2] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:153776404394049638, branchId:153776404394049642, lockKeys:undo_log:205;transaction_log:50
2025-05-25 03:27:21.638 [reactor-http-nio-2] INFO  c.b.bgai.interceptor.SeataTransactionInterceptor - 分布式事务成功完成: XID=seata-server:8091:153776404394049638, 耗时=12ms
2025-05-25 03:27:21.638 [reactor-http-nio-2] INFO  io.seata.tm.api.DefaultGlobalTransaction - transaction seata-server:8091:153776404394049638 will be commit
2025-05-25 03:27:21.648 [reactor-http-nio-2] INFO  io.seata.tm.api.DefaultGlobalTransaction - transaction end, xid = seata-server:8091:153776404394049638
2025-05-25 03:27:21.648 [reactor-http-nio-2] INFO  io.seata.tm.api.DefaultGlobalTransaction - [seata-server:8091:153776404394049638] commit status: Committed
2025-05-25 03:27:21.650 [reactor-http-nio-2] INFO  org.reflections.Reflections - 账单消息发送成功，chatCompletionId: chat-9461c381-b596-46f4-9d66-62aed4f11183, userId: 689258T
2025-05-25 03:27:21.656 [reactor-http-nio-2] INFO  com.bgpay.bgai.service.impl.BGAIServiceImpl - 执行第一步操作 - 发送账单消息, businessKey: 689258T:chat-9461c381-b596-46f4-9d66-62aed4f11183
2025-05-25 03:27:21.657 [reactor-http-nio-2] DEBUG c.bgpay.bgai.mapper.UsageRecordMapper.selectCount - ==>  Preparing: SELECT COUNT( * ) AS total FROM usage_record WHERE (chat_completion_id = ?)
2025-05-25 03:27:21.658 [reactor-http-nio-2] DEBUG c.bgpay.bgai.mapper.UsageRecordMapper.selectCount - ==> Parameters: chat-9461c381-b596-46f4-9d66-62aed4f11183(String)
2025-05-25 03:27:21.664 [reactor-http-nio-2] DEBUG c.bgpay.bgai.mapper.UsageRecordMapper.selectCount - <==      Total: 1
2025-05-25 03:27:21.664 [reactor-http-nio-2] INFO  com.bgpay.bgai.service.impl.BGAIServiceImpl - 账单消息已处理，跳过发送, completionId: chat-9461c381-b596-46f4-9d66-62aed4f11183
2025-05-25 03:27:21.673 [reactor-http-nio-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - Processed response for user 689258T, content length: 4637
2025-05-25 03:27:21.755 [rpcDispatch_RMROLE_1_5_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:153776404394049638', branchId=153776404394049639, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false,"skipCheckLock":true}'}
2025-05-25 03:27:21.755 [rpcDispatch_RMROLE_1_5_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:153776404394049638 153776404394049639 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false,"skipCheckLock":true}
2025-05-25 03:27:21.755 [rpcDispatch_RMROLE_1_5_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-25 03:27:21.763 [rpcDispatch_RMROLE_1_6_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:153776404394049638', branchId=153776404394049640, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false,"skipCheckLock":true}'}
2025-05-25 03:27:21.763 [rpcDispatch_RMROLE_1_6_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:153776404394049638 153776404394049640 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false,"skipCheckLock":true}
2025-05-25 03:27:21.764 [rpcDispatch_RMROLE_1_6_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-25 03:27:21.778 [rpcDispatch_RMROLE_1_7_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:153776404394049638', branchId=153776404394049641, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false}'}
2025-05-25 03:27:21.779 [rpcDispatch_RMROLE_1_7_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:153776404394049638 153776404394049641 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false}
2025-05-25 03:27:21.779 [rpcDispatch_RMROLE_1_7_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-25 03:27:21.786 [rpcDispatch_RMROLE_1_8_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:153776404394049638', branchId=153776404394049642, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false}'}
2025-05-25 03:27:21.786 [rpcDispatch_RMROLE_1_8_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:153776404394049638 153776404394049642 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false}
2025-05-25 03:27:21.786 [rpcDispatch_RMROLE_1_8_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-25 03:27:21.855 [ConsumeMessageThread_billing-consumer-group_1] INFO  c.bgpay.bgai.service.mq.RocketMQBillingServiceImpl - Output price config priceVersion: 1
2025-05-25 03:27:21.867 [ConsumeMessageThread_billing-consumer-group_1] DEBUG com.bgpay.bgai.mapper.UsageRecordMapper.insert - ==>  Preparing: INSERT INTO usage_record ( model_type, chat_completion_id, user_id, input_cost, output_cost, price_version, calculated_at, status, created_at ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-05-25 03:27:21.867 [ConsumeMessageThread_billing-consumer-group_1] DEBUG com.bgpay.bgai.mapper.UsageRecordMapper.insert - ==> Parameters: deepseek-chat(String), chat-9461c381-b596-46f4-9d66-62aed4f11183(String), 689258T(String), 0.0001(BigDecimal), 0.0087(BigDecimal), 1(Integer), 2025-05-25T03:27:21.808630500(LocalDateTime), PENDING(String), 2025-05-25T03:27:21.808630500(LocalDateTime)
2025-05-25 03:27:21.882 [ConsumeMessageThread_billing-consumer-group_1] DEBUG com.bgpay.bgai.mapper.UsageRecordMapper.insert - <==    Updates: 1
2025-05-25 03:27:21.915 [ConsumeMessageThread_billing-consumer-group_1] INFO  c.bgpay.bgai.service.mq.RocketMQBillingServiceImpl - Message consumed: 2408820C7528D042C1858EDCF30D3D91321436BAF30C7C56772B0000
2025-05-25 03:29:07.396 [Thread-7] WARN  com.alibaba.nacos.common.notify.NotifyCenter - [NotifyCenter] Start destroying Publisher
2025-05-25 03:29:07.396 [Thread-1] WARN  c.alibaba.nacos.common.http.HttpClientBeanHolder - [HttpClientBeanHolder] Start destroying common HttpClient
2025-05-25 03:29:07.396 [Thread-7] WARN  com.alibaba.nacos.common.notify.NotifyCenter - [NotifyCenter] Destruction of the end
2025-05-25 03:29:07.396 [Thread-1] WARN  c.alibaba.nacos.common.http.HttpClientBeanHolder - [HttpClientBeanHolder] Destruction of the end
2025-05-25 03:29:07.413 [SpringContextShutdownHook] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - De-registering from Nacos Server now...
2025-05-25 03:29:07.413 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - [DEREGISTER-SERVICE] d750d92e-152f-4055-a641-3bc9dda85a29 deregistering service bgtech-ai with instance: Instance{instanceId='null', ip='192.168.86.8', port=8080, weight=1.0, healthy=true, enabled=true, ephemeral=true, clusterName='DEFAULT', serviceName='null', metadata={}}
2025-05-25 03:29:07.420 [SpringContextShutdownHook] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - De-registration finished.
2025-05-25 03:29:07.421 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.cache.ServiceInfoHolder do shutdown begin
2025-05-25 03:29:07.421 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.backups.FailoverReactor do shutdown begin
2025-05-25 03:29:07.421 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.backups.FailoverReactor do shutdown stop
2025-05-25 03:29:07.421 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.cache.ServiceInfoHolder do shutdown stop
2025-05-25 03:29:07.422 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.NamingClientProxyDelegate do shutdown begin
2025-05-25 03:29:07.422 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServiceInfoUpdateService do shutdown begin
2025-05-25 03:29:07.422 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServiceInfoUpdateService do shutdown stop
2025-05-25 03:29:07.422 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServerListManager do shutdown begin
2025-05-25 03:29:07.422 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Start destroying NacosRestTemplate
2025-05-25 03:29:07.422 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Destruction of the end
2025-05-25 03:29:07.422 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServerListManager do shutdown stop
2025-05-25 03:29:07.422 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.http.NamingHttpClientProxy do shutdown begin
2025-05-25 03:29:07.422 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Start destroying NacosRestTemplate
2025-05-25 03:29:07.422 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Destruction of the end
2025-05-25 03:29:07.422 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.http.NamingHttpClientProxy do shutdown stop
2025-05-25 03:29:07.422 [SpringContextShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Shutdown rpc client, set status to shutdown
2025-05-25 03:29:07.422 [SpringContextShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Shutdown client event executor java.util.concurrent.ScheduledThreadPoolExecutor@19afa273[Running, pool size = 2, active threads = 2, queued tasks = 0, completed tasks = 0]
2025-05-25 03:29:07.422 [SpringContextShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Close current connection 1748114765293_139.227.195.192_49772
2025-05-25 03:29:07.425 [nacos-grpc-client-executor-8.133.246.113-46] WARN  c.a.nacos.common.remote.client.grpc.GrpcClient - [1748114765293_139.227.195.192_49772]Ignore error event,isRunning:false,isAbandon=false
2025-05-25 03:29:07.426 [SpringContextShutdownHook] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - Shutdown grpc executor java.util.concurrent.ThreadPoolExecutor@690b300[Running, pool size = 4, active threads = 0, queued tasks = 0, completed tasks = 47]
2025-05-25 03:29:07.426 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - Shutdown grpc redo service executor java.util.concurrent.ScheduledThreadPoolExecutor@757ba3dc[Running, pool size = 1, active threads = 0, queued tasks = 1, completed tasks = 60]
2025-05-25 03:29:07.426 [SpringContextShutdownHook] INFO  c.a.n.client.auth.ram.identify.CredentialWatcher - [null] CredentialWatcher is stopped
2025-05-25 03:29:07.426 [SpringContextShutdownHook] INFO  c.a.n.client.auth.ram.identify.CredentialService - [null] CredentialService is freed
2025-05-25 03:29:07.427 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.NamingClientProxyDelegate do shutdown stop
2025-05-25 03:29:07.433 [SpringContextShutdownHook] DEBUG com.bgpay.bgai.config.AsyncConfig$1 - Shutting down ExecutorService 'blockingExecutor'
2025-05-25 03:29:09.503 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:10911] result: true
2025-05-25 03:29:09.504 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:9876] result: true
2025-05-25 03:29:09.517 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:10911] result: true
2025-05-25 03:29:09.517 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:9876] result: true
2025-05-25 03:29:09.629 [SpringContextShutdownHook] INFO  o.s.orm.jpa.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-05-25 03:29:09.630 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-2} closing ...
2025-05-25 03:29:09.635 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-2} closed
2025-05-25 03:29:09.635 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} closing ...
2025-05-25 03:29:09.635 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} closed
2025-05-25 03:29:09.636 [NettyClientSelector_TMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - channel inactive: [id: 0xa35112c7, L:/192.168.86.8:63398 ! R:/8.133.246.113:8091]
2025-05-25 03:29:09.636 [NettyClientSelector_TMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - return to pool, rm channel:[id: 0xa35112c7, L:/192.168.86.8:63398 ! R:/8.133.246.113:8091]
2025-05-25 03:29:09.636 [NettyClientSelector_TMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - channel valid false,channel:[id: 0xa35112c7, L:/192.168.86.8:63398 ! R:/8.133.246.113:8091]
2025-05-25 03:29:09.636 [NettyClientSelector_TMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - will destroy channel:[id: 0xa35112c7, L:/192.168.86.8:63398 ! R:/8.133.246.113:8091]
2025-05-25 03:29:09.636 [NettyClientSelector_TMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0xa35112c7, L:/192.168.86.8:63398 ! R:/8.133.246.113:8091]) will closed
2025-05-25 03:29:09.636 [NettyClientSelector_TMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0xa35112c7, L:/192.168.86.8:63398 ! R:/8.133.246.113:8091]) will closed
2025-05-25 03:29:09.637 [NettyClientSelector_RMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - channel inactive: [id: 0xd055505d, L:/192.168.86.8:63400 ! R:/8.133.246.113:8091]
2025-05-25 03:29:09.637 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - return to pool, rm channel:[id: 0xd055505d, L:/192.168.86.8:63400 ! R:/8.133.246.113:8091]
2025-05-25 03:29:09.637 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - channel valid false,channel:[id: 0xd055505d, L:/192.168.86.8:63400 ! R:/8.133.246.113:8091]
2025-05-25 03:29:09.637 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - will destroy channel:[id: 0xd055505d, L:/192.168.86.8:63400 ! R:/8.133.246.113:8091]
2025-05-25 03:29:09.637 [NettyClientSelector_RMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0xd055505d, L:/192.168.86.8:63400 ! R:/8.133.246.113:8091]) will closed
2025-05-25 03:29:09.637 [NettyClientSelector_RMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0xd055505d, L:/192.168.86.8:63400 ! R:/8.133.246.113:8091]) will closed
2025-05-25 03:46:08.163 [main] WARN  com.alibaba.nacos.client.logging.NacosLogging - Load Logback Configuration of Nacos fail, message: Could not initialize Logback Nacos logging from classpath:nacos-logback.xml
2025-05-25 03:46:08.164 [main] INFO  com.bgpay.bgai.BgaiApplication - The following 1 profile is active: "dev"
2025-05-25 03:46:09.554 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-05-25 03:46:09.556 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-05-25 03:46:09.581 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 18 ms. Found 0 JPA repository interfaces.
2025-05-25 03:46:09.593 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-05-25 03:46:09.594 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-05-25 03:46:09.609 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 6 ms. Found 0 Redis repository interfaces.
2025-05-25 03:46:10.224 [main] INFO  io.seata.config.ConfigurationFactory - load Configuration from :Spring Configuration
2025-05-25 03:46:10.232 [main] INFO  io.seata.config.ConfigurationFactory - load Configuration from :Spring Configuration
2025-05-25 03:46:10.238 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Initializing Global Transaction Clients ... 
2025-05-25 03:46:10.338 [main] INFO  io.seata.core.rpc.netty.NettyClientBootstrap - NettyClientBootstrap has started
2025-05-25 03:46:10.339 [main] INFO  io.seata.discovery.registry.RegistryFactory - use registry center type: file
2025-05-25 03:46:10.348 [main] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - will connect to 8.133.246.113:8091
2025-05-25 03:46:10.352 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - NettyPool create channel to transactionRole:TMROLE,address:8.133.246.113:8091,msg:< RegisterTMRequest{version='1.7.0', applicationId='bgtech-ai', transactionServiceGroup='bgai-tx-group', extraData='ak=null
digest=bgai-tx-group,192.168.86.8,1748115970351
timestamp=1748115970351
authVersion=V4
vgroup=bgai-tx-group
ip=192.168.86.8
'} >
2025-05-25 03:46:10.477 [main] INFO  io.seata.core.rpc.netty.TmNettyRemotingClient - register TM success. client version:1.7.0, server version:1.8.1-SNAPSHOT,channel:[id: 0x45b01bdf, L:/192.168.86.8:62944 - R:/8.133.246.113:8091]
2025-05-25 03:46:10.484 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - register success, cost 63 ms, version:1.8.1-SNAPSHOT,role:TMROLE,channel:[id: 0x45b01bdf, L:/192.168.86.8:62944 - R:/8.133.246.113:8091]
2025-05-25 03:46:10.484 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Transaction Manager Client is initialized. applicationId[bgtech-ai] txServiceGroup[bgai-tx-group]
2025-05-25 03:46:10.495 [main] INFO  io.seata.rm.datasource.AsyncWorker - Async Commit Buffer Limit: 10000
2025-05-25 03:46:10.496 [main] INFO  io.seata.rm.datasource.xa.ResourceManagerXA - ResourceManagerXA init ...
2025-05-25 03:46:10.504 [main] INFO  io.seata.core.rpc.netty.NettyClientBootstrap - NettyClientBootstrap has started
2025-05-25 03:46:10.504 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Resource Manager is initialized. applicationId[bgtech-ai] txServiceGroup[bgai-tx-group]
2025-05-25 03:46:10.504 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Global Transaction Clients are initialized. 
2025-05-25 03:46:11.698 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat initialized with port(s): 8080 (http)
2025-05-25 03:46:11.708 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - The ["http-nio-8080"] connector has been configured to support HTTP upgrade to [h2c]
2025-05-25 03:46:11.708 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - Initializing ProtocolHandler ["http-nio-8080"]
2025-05-25 03:46:11.709 [main] INFO  org.apache.catalina.core.StandardService - Starting service [Tomcat]
2025-05-25 03:46:11.710 [main] INFO  org.apache.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.15]
2025-05-25 03:46:12.098 [main] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} inited
2025-05-25 03:46:12.342 [main] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - will connect to 8.133.246.113:8091
2025-05-25 03:46:12.342 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - RM will register :jdbc:mysql://8.133.246.113:3306/deepseek
2025-05-25 03:46:12.343 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - NettyPool create channel to transactionRole:RMROLE,address:8.133.246.113:8091,msg:< RegisterRMRequest{resourceIds='jdbc:mysql://8.133.246.113:3306/deepseek', version='1.7.0', applicationId='bgtech-ai', transactionServiceGroup='bgai-tx-group', extraData='null'} >
2025-05-25 03:46:12.360 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - register RM success. client version:1.7.0, server version:1.8.1-SNAPSHOT,channel:[id: 0xe47b6d67, L:/192.168.86.8:62950 - R:/8.133.246.113:8091]
2025-05-25 03:46:12.360 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - register success, cost 9 ms, version:1.8.1-SNAPSHOT,role:RMROLE,channel:[id: 0xe47b6d67, L:/192.168.86.8:62950 - R:/8.133.246.113:8091]
2025-05-25 03:46:12.363 [main] INFO  i.s.s.a.datasource.SeataAutoDataSourceProxyCreator - Auto proxy data source 'masterDataSource' by 'AT' mode.
2025-05-25 03:46:12.424 [main] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-2} inited
2025-05-25 03:46:12.507 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - will register resourceId:jdbc:mysql://8.133.246.113:3306/deepseek
2025-05-25 03:46:12.508 [main] INFO  i.s.s.a.datasource.SeataAutoDataSourceProxyCreator - Auto proxy data source 'slaveDataSource' by 'AT' mode.
2025-05-25 03:46:12.517 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.rm.AbstractRMHandler - the rm client received response msg [RegisterRMResponse{version='1.8.1-SNAPSHOT', extraData='null', identified=true, resultCode=null, msg='null'}] from tc server.
2025-05-25 03:46:12.531 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - will register resourceId:jdbc:mysql://8.133.246.113:3306/deepseek
2025-05-25 03:46:12.531 [main] INFO  i.s.s.a.datasource.SeataAutoDataSourceProxyCreator - Auto proxy data source 'dynamicDataSource' by 'AT' mode.
2025-05-25 03:46:12.540 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.rm.AbstractRMHandler - the rm client received response msg [RegisterRMResponse{version='1.8.1-SNAPSHOT', extraData='null', identified=true, resultCode=null, msg='null'}] from tc server.
2025-05-25 03:46:12.649 [main] INFO  org.hibernate.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-05-25 03:46:12.719 [main] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.1.7.Final
2025-05-25 03:46:13.081 [main] INFO  SQL dialect - HHH000400: Using dialect: org.hibernate.dialect.MySQL8Dialect
2025-05-25 03:46:13.084 [main] WARN  org.hibernate.orm.deprecation - HHH90000026: MySQL8Dialect has been deprecated; use org.hibernate.dialect.MySQLDialect instead
2025-05-25 03:46:13.453 [main] INFO  o.h.e.t.jta.platform.internal.JtaPlatformInitiator - HHH000490: Using JtaPlatform implementation: [org.hibernate.engine.transaction.jta.platform.internal.NoJtaPlatform]
2025-05-25 03:46:13.463 [main] INFO  o.s.orm.jpa.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-05-25 03:46:13.875 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-25 03:46:13.886 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-25 03:46:13.913 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-25 03:46:13.915 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-25 03:46:13.915 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-25 03:46:13.927 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-25 03:46:14.587 [main] INFO  com.bgpay.bgai.service.impl.UserServiceImpl - 初始化SSO配置: clientId=bgai-client-id, redirectUri=http://localhost:8080/api/auth/callback
2025-05-25 03:46:14.713 [main] INFO  com.bgpay.bgai.controller.AuthController - 初始化认证控制器: clientId=bgai-client-id, redirectUri=http://localhost:8080/api/auth/callback
2025-05-25 03:46:15.639 [main] INFO  org.redisson.Version - Redisson 3.24.3
2025-05-25 03:46:15.806 [redisson-netty-4-6] INFO  o.r.connection.pool.MasterPubSubConnectionPool - 1 connections initialized for 8.133.246.113/8.133.246.113:6379
2025-05-25 03:46:16.193 [redisson-netty-4-19] INFO  org.redisson.connection.pool.MasterConnectionPool - 24 connections initialized for 8.133.246.113/8.133.246.113:6379
2025-05-25 03:46:16.376 [main] INFO  o.a.r.s.autoconfigure.RocketMQAutoConfiguration - a producer (billing-producer-group) init on namesrv 8.133.246.113:9876
2025-05-25 03:46:16.905 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Bean [com.bgpay.bgai.service.deepseek.DeepSeekServiceImp$$SpringCGLIB$$0] with name [deepSeekServiceImp] would use interceptor [io.seata.spring.annotation.GlobalTransactionalInterceptor]
2025-05-25 03:46:17.224 [main] WARN  i.s.s.b.a.provider.SpringBootConfigurationProvider - The get method not found for the field 'SeataProperties#accesskey'.
2025-05-25 03:46:17.225 [main] WARN  i.s.s.b.a.provider.SpringBootConfigurationProvider - The get method not found for the field 'SeataProperties#secretkey'.
2025-05-25 03:46:17.241 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 加载到1个Saga状态机定义文件
2025-05-25 03:46:17.490 [main] INFO  com.bgpay.bgai.saga.CustomSagaJsonParser - 开始解析状态机定义: bgai-saga-transaction
2025-05-25 03:46:17.490 [main] INFO  com.bgpay.bgai.saga.CustomSagaJsonParser - 状态机定义解析成功: bgai-saga-transaction
2025-05-25 03:46:17.490 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 成功加载状态机定义: /E:/project/bgai/target/classes/statelang/bgai-saga-transaction.json
2025-05-25 03:46:17.636 [main] INFO  com.bgpay.bgai.service.mq.MQConsumerService - MQ consumer startup successful [group=billing-consumer-group, topic=BILLING_TOPIC, tag=USER_BILLING]
2025-05-25 03:46:17.801 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Bean [com.bgpay.bgai.service.mq.BillingTransactionListenerImpl$$SpringCGLIB$$0] with name [billingTransactionListenerImpl] would use interceptor [io.seata.spring.annotation.GlobalTransactionalInterceptor]
2025-05-25 03:46:17.923 [main] DEBUG com.bgpay.bgai.config.AsyncConfig$1 - Initializing ExecutorService 'blockingExecutor'
2025-05-25 03:46:17.947 [main] INFO  c.b.bgai.config.NacosConfig$NacosWarningHandler - Nacos警告处理器已启用，将忽略配置中心连接警告
2025-05-25 03:46:19.079 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [After]
2025-05-25 03:46:19.080 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Before]
2025-05-25 03:46:19.080 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Between]
2025-05-25 03:46:19.080 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Cookie]
2025-05-25 03:46:19.080 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Header]
2025-05-25 03:46:19.080 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Host]
2025-05-25 03:46:19.080 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Method]
2025-05-25 03:46:19.080 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Path]
2025-05-25 03:46:19.080 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Query]
2025-05-25 03:46:19.080 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [ReadBody]
2025-05-25 03:46:19.080 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [RemoteAddr]
2025-05-25 03:46:19.080 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [XForwardedRemoteAddr]
2025-05-25 03:46:19.080 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Weight]
2025-05-25 03:46:19.080 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [CloudFoundryRouteService]
2025-05-25 03:46:20.484 [main] INFO  o.s.b.actuate.endpoint.web.EndpointLinksResolver - Exposing 3 endpoint(s) beneath base path '/actuator'
2025-05-25 03:46:22.085 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - Starting ProtocolHandler ["http-nio-8080"]
2025-05-25 03:46:22.099 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat started on port(s): 8080 (http) with context path ''
2025-05-25 03:46:22.110 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from ans.namespace attribute : null
2025-05-25 03:46:22.110 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from ALIBABA_ALIWARE_NAMESPACE attribute :null
2025-05-25 03:46:22.111 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from namespace attribute :null
2025-05-25 03:46:22.119 [main] INFO  c.a.n.p.auth.spi.client.ClientAuthPluginManager - [ClientAuthPluginManager] Load ClientAuthService com.alibaba.nacos.client.auth.impl.NacosClientAuthServiceImpl success.
2025-05-25 03:46:22.120 [main] INFO  c.a.n.p.auth.spi.client.ClientAuthPluginManager - [ClientAuthPluginManager] Load ClientAuthService com.alibaba.nacos.client.auth.ram.RamClientAuthServiceImpl success.
2025-05-25 03:46:22.123 [main] INFO  com.alibaba.nacos.common.remote.client - [RpcClientFactory] create a new rpc client of 9615a191-a5fb-4596-8700-b7ace2f92e08
2025-05-25 03:46:22.124 [main] INFO  com.alibaba.nacos.common.remote.client - [9615a191-a5fb-4596-8700-b7ace2f92e08] RpcClient init, ServerListFactory = com.alibaba.nacos.client.naming.core.ServerListManager
2025-05-25 03:46:22.124 [main] INFO  com.alibaba.nacos.common.remote.client - [9615a191-a5fb-4596-8700-b7ace2f92e08] Registry connection listener to current client:com.alibaba.nacos.client.naming.remote.gprc.redo.NamingGrpcRedoService
2025-05-25 03:46:22.125 [main] INFO  com.alibaba.nacos.common.remote.client - [9615a191-a5fb-4596-8700-b7ace2f92e08] Register server push request handler:com.alibaba.nacos.client.naming.remote.gprc.NamingPushRequestHandler
2025-05-25 03:46:22.125 [main] INFO  com.alibaba.nacos.common.remote.client - [9615a191-a5fb-4596-8700-b7ace2f92e08] Try to connect to server on start up, server: {serverIp = '8.133.246.113', server main port = 8848}
2025-05-25 03:46:22.125 [main] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - grpc client connection server:8.133.246.113 ip,serverPort:9848,grpcTslConfig:{"sslProvider":"OPENSSL","enableTls":false,"mutualAuthEnable":false,"trustAll":false}
2025-05-25 03:46:22.253 [main] INFO  com.alibaba.nacos.common.remote.client - [9615a191-a5fb-4596-8700-b7ace2f92e08] Success to connect to server [8.133.246.113:8848] on start up, connectionId = 1748115982170_139.227.195.192_49688
2025-05-25 03:46:22.253 [main] INFO  com.alibaba.nacos.common.remote.client - [9615a191-a5fb-4596-8700-b7ace2f92e08] Register server push request handler:com.alibaba.nacos.common.remote.client.RpcClient$ConnectResetRequestHandler
2025-05-25 03:46:22.253 [main] INFO  com.alibaba.nacos.common.remote.client - [9615a191-a5fb-4596-8700-b7ace2f92e08] Register server push request handler:com.alibaba.nacos.common.remote.client.RpcClient$$Lambda/0x0000028aa9528f48
2025-05-25 03:46:22.253 [com.alibaba.nacos.client.remote.worker] INFO  com.alibaba.nacos.common.remote.client - [9615a191-a5fb-4596-8700-b7ace2f92e08] Notify connected event to listeners.
2025-05-25 03:46:22.253 [com.alibaba.nacos.client.remote.worker] INFO  com.alibaba.nacos.client.naming - Grpc connection connect
2025-05-25 03:46:22.254 [main] INFO  com.alibaba.nacos.client.naming - [REGISTER-SERVICE] d750d92e-152f-4055-a641-3bc9dda85a29 registering service bgtech-ai with instance Instance{instanceId='null', ip='192.168.86.8', port=8080, weight=1.0, healthy=true, enabled=true, ephemeral=true, clusterName='DEFAULT', serviceName='null', metadata={IPv6=[2408:820c:7528:d042:c185:8edc:f30d:3d91], preserved.register.source=SPRING_CLOUD}}
2025-05-25 03:46:22.271 [main] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - nacos registry, DEFAULT_GROUP bgtech-ai 192.168.86.8:8080 register finished
2025-05-25 03:46:22.318 [main] INFO  com.bgpay.bgai.config.NacosConfig - 应用启动完成，当前环境: dev
2025-05-25 03:46:22.318 [main] INFO  com.bgpay.bgai.config.NacosConfig - Nacos配置中心: 8.133.246.113:8848, 命名空间: d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-25 03:46:22.318 [main] INFO  com.bgpay.bgai.config.NacosConfig - 注意: 如果看到Nacos配置加载警告，但应用正常启动，说明应用正在使用本地配置文件
2025-05-25 03:46:22.319 [main] INFO  com.bgpay.bgai.BgaiApplication - Started BgaiApplication in 16.387 seconds (process running for 17.749)
2025-05-25 03:46:22.321 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-25 03:46:22.321 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-25 03:46:22.333 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-25 03:46:22.334 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-25 03:46:22.334 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-25 03:46:22.344 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-25 03:46:22.345 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-25 03:46:22.345 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-25 03:46:22.353 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-25 03:46:22.354 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-25 03:46:22.354 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-25 03:46:22.360 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-25 03:46:22.360 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - ==================== Saga状态机加载报告 ====================
2025-05-25 03:46:22.360 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - Saga状态机配置加载状态: 成功
2025-05-25 03:46:22.360 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 已加载的状态机定义文件数量: 1
2025-05-25 03:46:22.360 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 已加载的状态机定义文件:
2025-05-25 03:46:22.360 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig -  - /E:/project/bgai/target/classes/statelang/bgai-saga-transaction.json
2025-05-25 03:46:22.361 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - Saga解析器状态: CUSTOM_FASTJSON2
2025-05-25 03:46:22.361 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 状态机解析结果: 成功 1 个, 失败 0 个
2025-05-25 03:46:22.361 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - =============================================================
2025-05-25 03:46:22.365 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - nacos.cache.data.init.snapshot = true 
2025-05-25 03:46:22.366 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] common-dev.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-25 03:46:22.374 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=common-dev.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-25 03:46:22.374 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=common-dev.yaml, group=DEFAULT_GROUP
2025-05-25 03:46:22.375 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-25 03:46:22.375 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-25 03:46:22.375 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai.yaml, group=DEFAULT_GROUP
2025-05-25 03:46:22.376 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai-dev.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-25 03:46:22.377 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai-dev.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-25 03:46:22.377 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai-dev.yaml, group=DEFAULT_GROUP
2025-05-25 03:46:22.377 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-25 03:46:22.377 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai, group=DEFAULT_GROUP, cnt=1
2025-05-25 03:46:22.377 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai, group=DEFAULT_GROUP
2025-05-25 03:46:33.145 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - 接收到请求: /api/chatGatWay-internal, 文件=新文件 17.txt, 问题参数=null, 模型参数=null
2025-05-25 03:46:33.146 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - 请求Content-Type: multipart/form-data;boundary=--------------------------917976374883734043678886
2025-05-25 03:46:33.147 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - 收集到的完整参数: question="null", apiUrl="null", modelName="null", multiTurn=false
2025-05-25 03:46:33.149 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - Processing request for user ID: 689258T
2025-05-25 03:46:33.150 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - Processing file with circuit breaker: fileName=新文件 17.txt, question=
2025-05-25 03:46:33.152 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.config.ReactiveFileProcessor - Processing file: 新文件 17.txt, content-type: text/plain
2025-05-25 03:46:33.158 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - PARAM TRACE [689258T]: 尝试查找匹配配置 - 参数: apiUrl=null, modelName=null
2025-05-25 03:46:33.177 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 查询配置 - userId=689258T
2025-05-25 03:46:33.178 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 排序方式 - 按ID降序
2025-05-25 03:46:33.178 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 限制结果数 - LIMIT 1
2025-05-25 03:46:33.239 [http-nio-8080-exec-2] DEBUG com.bgpay.bgai.mapper.ApiConfigMapper.selectList - ==>  Preparing: SELECT id,api_url,api_key,model_name,user_id FROM api_config WHERE (user_id = ?) ORDER BY id DESC LIMIT 1
2025-05-25 03:46:33.240 [http-nio-8080-exec-2] DEBUG com.bgpay.bgai.mapper.ApiConfigMapper.selectList - ==> Parameters: 689258T(String)
2025-05-25 03:46:33.249 [http-nio-8080-exec-2] DEBUG com.bgpay.bgai.mapper.ApiConfigMapper.selectList - <==      Total: 1
2025-05-25 03:46:33.249 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 查询结果 - 找到配置: id=2, modelName=deepseek-chat
2025-05-25 03:46:33.249 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - PARAM TRACE [689258T]: 找到匹配配置 - apiUrl=https://api.deepseek.com/chat/completions, modelName=deepseek-chat (原始请求: null)
2025-05-25 03:46:33.250 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - API config resolved: url=https://api.deepseek.com/chat/completions, model=deepseek-chat
2025-05-25 03:46:33.265 [Thread-50] INFO  com.bgpay.bgai.config.ReactiveFileProcessor - File processed successfully: size=37 bytes
2025-05-25 03:46:33.270 [Thread-50] INFO  com.bgpay.bgai.controller.ReactiveChatController - Content processed, length: 54
2025-05-25 03:46:33.276 [Thread-50] INFO  io.seata.tm.TransactionManagerHolder - TransactionManager Singleton io.seata.tm.DefaultTransactionManager@43b67341
2025-05-25 03:46:33.289 [Thread-50] INFO  io.seata.tm.api.DefaultGlobalTransaction - Begin new global transaction [seata-server:8091:153776404394049643]
2025-05-25 03:46:33.291 [Thread-50] INFO  c.b.bgai.interceptor.SeataTransactionInterceptor - 准备记录分布式事务开始: XID=seata-server:8091:153776404394049643, 业务=com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive, 路径=, IP=, 用户=system
2025-05-25 03:46:33.306 [Thread-50] INFO  c.b.bgai.service.impl.TransactionLogServiceImpl - 记录分布式事务开始: XID=seata-server:8091:153776404394049643, 业务=com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive
2025-05-25 03:46:33.313 [Thread-50] DEBUG com.bgpay.bgai.mapper.TransactionLogMapper.insert - ==>  Preparing: INSERT INTO transaction_log ( xid, transaction_name, transaction_mode, status, request_path, source_ip, start_time, user_id, create_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-05-25 03:46:33.317 [Thread-50] DEBUG com.bgpay.bgai.mapper.TransactionLogMapper.insert - ==> Parameters: seata-server:8091:153776404394049643(String), com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive(String), AT(String), ACTIVE(String), (String), (String), 2025-05-25T03:46:33.306673300(LocalDateTime), system(String), 2025-05-25T03:46:33.306673300(LocalDateTime)
2025-05-25 03:46:33.822 [Thread-50] DEBUG com.bgpay.bgai.mapper.TransactionLogMapper.insert - <==    Updates: 1
2025-05-25 03:46:33.844 [Thread-50] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:153776404394049643, branchId:153776404394049644, lockKeys:transaction_log:51
2025-05-25 03:46:33.866 [Thread-50] WARN  i.s.c.l.EnhancedServiceLoader$InnerEnhancedServiceLoader - Load [io.seata.rm.datasource.undo.parser.ProtostuffUndoLogParser] class fail: io/protostuff/runtime/IdStrategy
2025-05-25 03:46:33.949 [Thread-50] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:153776404394049643, branchId:153776404394049645, lockKeys:transaction_log:51;undo_log:207
2025-05-25 03:46:33.979 [Thread-50] INFO  c.b.bgai.interceptor.SeataTransactionInterceptor - 开始分布式事务: XID=seata-server:8091:153776404394049643, 方法=com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive
2025-05-25 03:46:33.994 [Thread-50] INFO  org.reflections.Reflections - Processing reactive request: content length=54, apiUrl=https://api.deepseek.com/chat/completions, modelName=deepseek-chat, userId=689258T, multiTurn=false
2025-05-25 03:46:34.002 [Thread-50] INFO  c.b.bgai.service.impl.TransactionLogServiceImpl - 记录分布式事务结束: XID=seata-server:8091:153776404394049643, 状态=COMMITTED
2025-05-25 03:46:34.004 [Thread-50] DEBUG c.b.bgai.mapper.TransactionLogMapper.selectList - ==>  Preparing: SELECT id,xid,branch_id,transaction_name,transaction_mode,status,request_path,source_ip,start_time,end_time,user_id,extra_data,create_time,update_time FROM transaction_log WHERE (xid = ?) LIMIT 1
2025-05-25 03:46:34.006 [Thread-50] DEBUG c.b.bgai.mapper.TransactionLogMapper.selectList - ==> Parameters: seata-server:8091:153776404394049643(String)
2025-05-25 03:46:34.014 [Thread-50] DEBUG c.b.bgai.mapper.TransactionLogMapper.selectList - <==      Total: 1
2025-05-25 03:46:34.020 [Thread-50] DEBUG c.b.bgai.mapper.TransactionLogMapper.updateById - ==>  Preparing: UPDATE transaction_log SET xid=?, transaction_name=?, transaction_mode=?, status=?, request_path=?, source_ip=?, start_time=?, end_time=?, user_id=?, extra_data=?, create_time=?, update_time=? WHERE id=?
2025-05-25 03:46:34.027 [Thread-50] DEBUG c.b.bgai.mapper.TransactionLogMapper.updateById - ==> Parameters: seata-server:8091:153776404394049643(String), com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive(String), AT(String), COMMITTED(String), (String), (String), 2025-05-25T03:46:33(LocalDateTime), 2025-05-25T03:46:34.014364100(LocalDateTime), system(String), {"duration":17,"result":"success"}(String), 2025-05-25T03:46:33(LocalDateTime), 2025-05-25T03:46:34.014364100(LocalDateTime), 51(Long)
2025-05-25 03:46:34.081 [Thread-50] DEBUG c.b.bgai.mapper.TransactionLogMapper.updateById - <==    Updates: 1
2025-05-25 03:46:34.091 [Thread-50] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:153776404394049643, branchId:153776404394049646, lockKeys:transaction_log:51
2025-05-25 03:46:34.114 [Thread-50] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:153776404394049643, branchId:153776404394049647, lockKeys:transaction_log:51;undo_log:209
2025-05-25 03:46:34.137 [Thread-50] INFO  c.b.bgai.interceptor.SeataTransactionInterceptor - 分布式事务成功完成: XID=seata-server:8091:153776404394049643, 耗时=17ms
2025-05-25 03:46:34.137 [Thread-50] INFO  io.seata.tm.api.DefaultGlobalTransaction - transaction seata-server:8091:153776404394049643 will be commit
2025-05-25 03:46:34.148 [Thread-50] INFO  io.seata.tm.api.DefaultGlobalTransaction - transaction end, xid = seata-server:8091:153776404394049643
2025-05-25 03:46:34.148 [Thread-50] INFO  io.seata.tm.api.DefaultGlobalTransaction - [seata-server:8091:153776404394049643] commit status: Committed
2025-05-25 03:46:34.208 [boundedElastic-1] INFO  com.bgpay.bgai.transaction.TransactionCoordinator - Transaction prepared for user 689258T: chatCompletionId=chat-d25aba81-3422-4521-9e4e-2bf181f7bab0
2025-05-25 03:46:34.208 [boundedElastic-1] INFO  org.reflections.Reflections - Transaction prepared with chatCompletionId: chat-d25aba81-3422-4521-9e4e-2bf181f7bab0
2025-05-25 03:46:34.757 [rpcDispatch_RMROLE_1_1_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:153776404394049643', branchId=153776404394049644, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false,"skipCheckLock":true}'}
2025-05-25 03:46:34.757 [rpcDispatch_RMROLE_1_1_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:153776404394049643 153776404394049644 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false,"skipCheckLock":true}
2025-05-25 03:46:34.758 [rpcDispatch_RMROLE_1_1_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-25 03:46:34.768 [rpcDispatch_RMROLE_1_2_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:153776404394049643', branchId=153776404394049645, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false,"skipCheckLock":true}'}
2025-05-25 03:46:34.769 [rpcDispatch_RMROLE_1_2_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:153776404394049643 153776404394049645 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false,"skipCheckLock":true}
2025-05-25 03:46:34.769 [rpcDispatch_RMROLE_1_2_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-25 03:46:34.777 [rpcDispatch_RMROLE_1_3_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:153776404394049643', branchId=153776404394049646, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false}'}
2025-05-25 03:46:34.777 [rpcDispatch_RMROLE_1_3_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:153776404394049643 153776404394049646 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false}
2025-05-25 03:46:34.777 [rpcDispatch_RMROLE_1_3_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-25 03:46:34.786 [rpcDispatch_RMROLE_1_4_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:153776404394049643', branchId=153776404394049647, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false}'}
2025-05-25 03:46:34.786 [rpcDispatch_RMROLE_1_4_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:153776404394049643 153776404394049647 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false}
2025-05-25 03:46:34.786 [rpcDispatch_RMROLE_1_4_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-25 03:47:08.568 [FileWrite-1] INFO  com.bgpay.bgai.service.deepseek.FileWriterService - Successfully wrote content to: \var\data\ai_responses\85ec9d84-1c4f-47c7-ae98-370fe4afb492.txt
2025-05-25 03:47:08.581 [reactor-http-nio-2] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - ==>  Preparing: INSERT INTO chat_completions ( object, created, model, system_fingerprint, api_key ) VALUES ( ?, ?, ?, ?, ? )
2025-05-25 03:47:08.581 [reactor-http-nio-2] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - ==> Parameters: chat.completion(String), 1748116028579(Long), deepseek-chat(String), 689258T(String), chat-d25aba81-3422-4521-9e4e-2bf181f7bab0(String)
2025-05-25 03:47:08.594 [reactor-http-nio-2] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - <==    Updates: 1
2025-05-25 03:47:08.594 [reactor-http-nio-2] INFO  com.bgpay.bgai.transaction.TransactionCoordinator - Transaction committed for user 689258T: chatCompletionId=chat-d25aba81-3422-4521-9e4e-2bf181f7bab0
2025-05-25 03:47:08.612 [reactor-http-nio-2] INFO  org.reflections.Reflections - 开始发送账单消息，chatCompletionId: chat-d25aba81-3422-4521-9e4e-2bf181f7bab0, userId: 689258T
2025-05-25 03:47:08.661 [reactor-http-nio-2] INFO  io.seata.tm.api.DefaultGlobalTransaction - Begin new global transaction [seata-server:8091:153776404394049648]
2025-05-25 03:47:08.661 [reactor-http-nio-2] INFO  c.b.bgai.interceptor.SeataTransactionInterceptor - 准备记录分布式事务开始: XID=seata-server:8091:153776404394049648, 业务=com.bgpay.bgai.service.mq.BillingTransactionListenerImpl.executeLocalTransaction, 路径=, IP=, 用户=system
2025-05-25 03:47:08.668 [reactor-http-nio-2] INFO  c.b.bgai.service.impl.TransactionLogServiceImpl - 记录分布式事务开始: XID=seata-server:8091:153776404394049648, 业务=com.bgpay.bgai.service.mq.BillingTransactionListenerImpl.executeLocalTransaction
2025-05-25 03:47:08.668 [reactor-http-nio-2] DEBUG com.bgpay.bgai.mapper.TransactionLogMapper.insert - ==>  Preparing: INSERT INTO transaction_log ( xid, transaction_name, transaction_mode, status, request_path, source_ip, start_time, user_id, create_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-05-25 03:47:08.669 [reactor-http-nio-2] DEBUG com.bgpay.bgai.mapper.TransactionLogMapper.insert - ==> Parameters: seata-server:8091:153776404394049648(String), com.bgpay.bgai.service.mq.BillingTransactionListenerImpl.executeLocalTransaction(String), AT(String), ACTIVE(String), (String), (String), 2025-05-25T03:47:08.668482700(LocalDateTime), system(String), 2025-05-25T03:47:08.668482700(LocalDateTime)
2025-05-25 03:47:08.693 [reactor-http-nio-2] DEBUG com.bgpay.bgai.mapper.TransactionLogMapper.insert - <==    Updates: 1
2025-05-25 03:47:08.704 [reactor-http-nio-2] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:153776404394049648, branchId:153776404394049649, lockKeys:transaction_log:52
2025-05-25 03:47:08.724 [reactor-http-nio-2] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:153776404394049648, branchId:153776404394049650, lockKeys:undo_log:211;transaction_log:52
2025-05-25 03:47:08.747 [reactor-http-nio-2] INFO  c.b.bgai.interceptor.SeataTransactionInterceptor - 开始分布式事务: XID=seata-server:8091:153776404394049648, 方法=com.bgpay.bgai.service.mq.BillingTransactionListenerImpl.executeLocalTransaction
2025-05-25 03:47:08.747 [reactor-http-nio-2] INFO  c.b.bgai.service.mq.BillingTransactionListenerImpl - 开始执行本地事务, xid: seata-server:8091:153776404394049648, userId: 689258T, completionId: chat-d25aba81-3422-4521-9e4e-2bf181f7bab0
2025-05-25 03:47:08.758 [reactor-http-nio-2] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.selectCount - ==>  Preparing: SELECT COUNT( * ) AS total FROM usage_info WHERE (chat_completion_id = ?)
2025-05-25 03:47:08.759 [reactor-http-nio-2] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.selectCount - ==> Parameters: chat-d25aba81-3422-4521-9e4e-2bf181f7bab0(String)
2025-05-25 03:47:08.766 [reactor-http-nio-2] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.selectCount - <==      Total: 1
2025-05-25 03:47:08.816 [reactor-http-nio-2] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.selectCount - ==>  Preparing: SELECT COUNT( * ) AS total FROM usage_info WHERE (chat_completion_id = ?)
2025-05-25 03:47:08.816 [reactor-http-nio-2] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.selectCount - ==> Parameters: chat-d25aba81-3422-4521-9e4e-2bf181f7bab0(String)
2025-05-25 03:47:08.823 [reactor-http-nio-2] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.selectCount - <==      Total: 1
2025-05-25 03:47:08.884 [reactor-http-nio-2] INFO  com.bgpay.bgai.service.impl.UsageInfoServiceImpl - Output price config priceVersion: 1
2025-05-25 03:47:08.888 [reactor-http-nio-2] DEBUG com.bgpay.bgai.mapper.UsageRecordMapper.insert - ==>  Preparing: INSERT INTO usage_record ( model_type, chat_completion_id, user_id, input_cost, output_cost, price_version, calculated_at, input_tokens, output_tokens, status, created_at ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-05-25 03:47:08.889 [reactor-http-nio-2] DEBUG com.bgpay.bgai.mapper.UsageRecordMapper.insert - ==> Parameters: deepseek-chat(String), chat-d25aba81-3422-4521-9e4e-2bf181f7bab0(String), 689258T(String), 0.030(BigDecimal), 1.582(BigDecimal), 1(Integer), 2025-05-25T03:47:08.612480700(LocalDateTime), 30(Integer), 791(Integer), PENDING(String), 2025-05-25T03:47:08.824674300(LocalDateTime)
2025-05-25 03:47:08.944 [reactor-http-nio-2] DEBUG com.bgpay.bgai.mapper.UsageRecordMapper.insert - <==    Updates: 1
2025-05-25 03:47:08.947 [reactor-http-nio-2] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.insert - ==>  Preparing: INSERT INTO usage_info ( chat_completion_id, prompt_tokens, completion_tokens, total_tokens, prompt_tokens_cached, completion_reasoning_tokens, prompt_cache_hit_tokens, prompt_cache_miss_tokens, created_at, model_type ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-05-25 03:47:08.948 [reactor-http-nio-2] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.insert - ==> Parameters: chat-d25aba81-3422-4521-9e4e-2bf181f7bab0(String), 30(Integer), 791(Integer), 821(Integer), 0(Integer), 791(Integer), 0(Integer), 30(Integer), 2025-05-25T03:47:08.946716800(LocalDateTime), deepseek-chat(String)
2025-05-25 03:47:09.005 [reactor-http-nio-2] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.insert - <==    Updates: 1
2025-05-25 03:47:09.015 [reactor-http-nio-2] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:153776404394049648, branchId:153776404394049651, lockKeys:usage_record:175;usage_info:262
2025-05-25 03:47:09.038 [reactor-http-nio-2] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:153776404394049648, branchId:153776404394049652, lockKeys:undo_log:213;usage_record:175;usage_info:262
2025-05-25 03:47:09.077 [reactor-http-nio-2] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - ==>  Preparing: INSERT INTO chat_completions ( object, created, model, system_fingerprint, api_key ) VALUES ( ?, ?, ?, ?, ? )
2025-05-25 03:47:09.078 [reactor-http-nio-2] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - ==> Parameters: chat.completion(String), 1748116029077(Long), deepseek-chat(String), 689258T(String), chat-d25aba81-3422-4521-9e4e-2bf181f7bab0(String)
2025-05-25 03:47:09.140 [reactor-http-nio-2] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - <==    Updates: 1
2025-05-25 03:47:09.141 [reactor-http-nio-2] INFO  com.bgpay.bgai.transaction.TransactionCoordinator - Transaction committed for user 689258T: chatCompletionId=chat-d25aba81-3422-4521-9e4e-2bf181f7bab0
2025-05-25 03:47:09.150 [reactor-http-nio-2] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:153776404394049648, branchId:153776404394049653, lockKeys:chat_completions:341
2025-05-25 03:47:09.172 [reactor-http-nio-2] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:153776404394049648, branchId:153776404394049654, lockKeys:chat_completions:341;undo_log:215
2025-05-25 03:47:09.194 [reactor-http-nio-2] INFO  c.b.bgai.service.mq.BillingTransactionListenerImpl - 本地事务执行成功，提交事务, completionId: chat-d25aba81-3422-4521-9e4e-2bf181f7bab0
2025-05-25 03:47:09.200 [reactor-http-nio-2] INFO  c.b.bgai.service.impl.TransactionLogServiceImpl - 记录分布式事务结束: XID=seata-server:8091:153776404394049648, 状态=COMMITTED
2025-05-25 03:47:09.201 [reactor-http-nio-2] DEBUG c.b.bgai.mapper.TransactionLogMapper.selectList - ==>  Preparing: SELECT id,xid,branch_id,transaction_name,transaction_mode,status,request_path,source_ip,start_time,end_time,user_id,extra_data,create_time,update_time FROM transaction_log WHERE (xid = ?) LIMIT 1
2025-05-25 03:47:09.202 [reactor-http-nio-2] DEBUG c.b.bgai.mapper.TransactionLogMapper.selectList - ==> Parameters: seata-server:8091:153776404394049648(String)
2025-05-25 03:47:09.215 [reactor-http-nio-2] DEBUG c.b.bgai.mapper.TransactionLogMapper.selectList - <==      Total: 1
2025-05-25 03:47:09.216 [reactor-http-nio-2] DEBUG c.b.bgai.mapper.TransactionLogMapper.updateById - ==>  Preparing: UPDATE transaction_log SET xid=?, transaction_name=?, transaction_mode=?, status=?, request_path=?, source_ip=?, start_time=?, end_time=?, user_id=?, extra_data=?, create_time=?, update_time=? WHERE id=?
2025-05-25 03:47:09.217 [reactor-http-nio-2] DEBUG c.b.bgai.mapper.TransactionLogMapper.updateById - ==> Parameters: seata-server:8091:153776404394049648(String), com.bgpay.bgai.service.mq.BillingTransactionListenerImpl.executeLocalTransaction(String), AT(String), COMMITTED(String), (String), (String), 2025-05-25T03:47:09(LocalDateTime), 2025-05-25T03:47:09.215162500(LocalDateTime), system(String), {"duration":447,"result":"success"}(String), 2025-05-25T03:47:09(LocalDateTime), 2025-05-25T03:47:09.215162500(LocalDateTime), 52(Long)
2025-05-25 03:47:09.259 [reactor-http-nio-2] DEBUG c.b.bgai.mapper.TransactionLogMapper.updateById - <==    Updates: 1
2025-05-25 03:47:09.267 [reactor-http-nio-2] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:153776404394049648, branchId:153776404394049655, lockKeys:transaction_log:52
2025-05-25 03:47:09.303 [reactor-http-nio-2] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:153776404394049648, branchId:153776404394049656, lockKeys:undo_log:217;transaction_log:52
2025-05-25 03:47:09.327 [reactor-http-nio-2] INFO  c.b.bgai.interceptor.SeataTransactionInterceptor - 分布式事务成功完成: XID=seata-server:8091:153776404394049648, 耗时=447ms
2025-05-25 03:47:09.327 [reactor-http-nio-2] INFO  io.seata.tm.api.DefaultGlobalTransaction - transaction seata-server:8091:153776404394049648 will be commit
2025-05-25 03:47:09.337 [reactor-http-nio-2] INFO  io.seata.tm.api.DefaultGlobalTransaction - transaction end, xid = seata-server:8091:153776404394049648
2025-05-25 03:47:09.337 [reactor-http-nio-2] INFO  io.seata.tm.api.DefaultGlobalTransaction - [seata-server:8091:153776404394049648] commit status: Committed
2025-05-25 03:47:09.339 [reactor-http-nio-2] INFO  org.reflections.Reflections - 账单消息发送成功，chatCompletionId: chat-d25aba81-3422-4521-9e4e-2bf181f7bab0, userId: 689258T
2025-05-25 03:47:09.345 [reactor-http-nio-2] INFO  com.bgpay.bgai.service.impl.BGAIServiceImpl - 执行第一步操作 - 发送账单消息, businessKey: 689258T:chat-d25aba81-3422-4521-9e4e-2bf181f7bab0
2025-05-25 03:47:09.346 [reactor-http-nio-2] DEBUG c.bgpay.bgai.mapper.UsageRecordMapper.selectCount - ==>  Preparing: SELECT COUNT( * ) AS total FROM usage_record WHERE (chat_completion_id = ?)
2025-05-25 03:47:09.346 [reactor-http-nio-2] DEBUG c.bgpay.bgai.mapper.UsageRecordMapper.selectCount - ==> Parameters: chat-d25aba81-3422-4521-9e4e-2bf181f7bab0(String)
2025-05-25 03:47:09.353 [reactor-http-nio-2] DEBUG c.bgpay.bgai.mapper.UsageRecordMapper.selectCount - <==      Total: 1
2025-05-25 03:47:09.353 [reactor-http-nio-2] INFO  com.bgpay.bgai.service.impl.BGAIServiceImpl - 账单消息已处理，跳过发送, completionId: chat-d25aba81-3422-4521-9e4e-2bf181f7bab0
2025-05-25 03:47:09.359 [ConsumeMessageThread_billing-consumer-group_1] DEBUG c.bgpay.bgai.mapper.UsageRecordMapper.selectCount - ==>  Preparing: SELECT COUNT( * ) AS total FROM usage_record WHERE (chat_completion_id = ?)
2025-05-25 03:47:09.359 [ConsumeMessageThread_billing-consumer-group_1] DEBUG c.bgpay.bgai.mapper.UsageRecordMapper.selectCount - ==> Parameters: chat-d25aba81-3422-4521-9e4e-2bf181f7bab0(String)
2025-05-25 03:47:09.364 [reactor-http-nio-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - Processed response for user 689258T, content length: 2764
2025-05-25 03:47:09.367 [ConsumeMessageThread_billing-consumer-group_1] DEBUG c.bgpay.bgai.mapper.UsageRecordMapper.selectCount - <==      Total: 1
2025-05-25 03:47:09.368 [ConsumeMessageThread_billing-consumer-group_1] DEBUG c.bgpay.bgai.service.mq.RocketMQBillingServiceImpl - 消息已处理 [CompletionId=chat-d25aba81-3422-4521-9e4e-2bf181f7bab0]
2025-05-25 03:47:09.369 [ConsumeMessageThread_billing-consumer-group_1] INFO  c.bgpay.bgai.service.mq.RocketMQBillingServiceImpl - Message consumed: 2408820C7528D042C1858EDCF30D3D914CDC36BAF30C7C6894DE0000
2025-05-25 03:47:09.762 [rpcDispatch_RMROLE_1_5_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:153776404394049648', branchId=153776404394049649, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false,"skipCheckLock":true}'}
2025-05-25 03:47:09.762 [rpcDispatch_RMROLE_1_5_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:153776404394049648 153776404394049649 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false,"skipCheckLock":true}
2025-05-25 03:47:09.762 [rpcDispatch_RMROLE_1_5_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-25 03:47:09.778 [rpcDispatch_RMROLE_1_6_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:153776404394049648', branchId=153776404394049650, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false,"skipCheckLock":true}'}
2025-05-25 03:47:09.778 [rpcDispatch_RMROLE_1_6_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:153776404394049648 153776404394049650 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false,"skipCheckLock":true}
2025-05-25 03:47:09.778 [rpcDispatch_RMROLE_1_6_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-25 03:47:09.789 [rpcDispatch_RMROLE_1_7_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:153776404394049648', branchId=153776404394049651, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false,"skipCheckLock":true}'}
2025-05-25 03:47:09.789 [rpcDispatch_RMROLE_1_7_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:153776404394049648 153776404394049651 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false,"skipCheckLock":true}
2025-05-25 03:47:09.789 [rpcDispatch_RMROLE_1_7_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-25 03:47:09.800 [rpcDispatch_RMROLE_1_8_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:153776404394049648', branchId=153776404394049652, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false,"skipCheckLock":true}'}
2025-05-25 03:47:09.800 [rpcDispatch_RMROLE_1_8_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:153776404394049648 153776404394049652 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false,"skipCheckLock":true}
2025-05-25 03:47:09.800 [rpcDispatch_RMROLE_1_8_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-25 03:47:09.808 [rpcDispatch_RMROLE_1_9_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:153776404394049648', branchId=153776404394049653, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false,"skipCheckLock":true}'}
2025-05-25 03:47:09.808 [rpcDispatch_RMROLE_1_9_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:153776404394049648 153776404394049653 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false,"skipCheckLock":true}
2025-05-25 03:47:09.808 [rpcDispatch_RMROLE_1_9_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-25 03:47:09.816 [rpcDispatch_RMROLE_1_10_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:153776404394049648', branchId=153776404394049654, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false,"skipCheckLock":true}'}
2025-05-25 03:47:09.816 [rpcDispatch_RMROLE_1_10_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:153776404394049648 153776404394049654 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false,"skipCheckLock":true}
2025-05-25 03:47:09.816 [rpcDispatch_RMROLE_1_10_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-25 03:47:09.824 [rpcDispatch_RMROLE_1_11_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:153776404394049648', branchId=153776404394049655, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false}'}
2025-05-25 03:47:09.824 [rpcDispatch_RMROLE_1_11_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:153776404394049648 153776404394049655 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false}
2025-05-25 03:47:09.824 [rpcDispatch_RMROLE_1_11_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-25 03:47:09.833 [rpcDispatch_RMROLE_1_12_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:153776404394049648', branchId=153776404394049656, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false}'}
2025-05-25 03:47:09.833 [rpcDispatch_RMROLE_1_12_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:153776404394049648 153776404394049656 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false}
2025-05-25 03:47:09.833 [rpcDispatch_RMROLE_1_12_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-25 03:48:12.133 [Thread-7] WARN  com.alibaba.nacos.common.notify.NotifyCenter - [NotifyCenter] Start destroying Publisher
2025-05-25 03:48:12.133 [Thread-7] WARN  com.alibaba.nacos.common.notify.NotifyCenter - [NotifyCenter] Destruction of the end
2025-05-25 03:48:12.134 [Thread-1] WARN  c.alibaba.nacos.common.http.HttpClientBeanHolder - [HttpClientBeanHolder] Start destroying common HttpClient
2025-05-25 03:48:12.134 [Thread-1] WARN  c.alibaba.nacos.common.http.HttpClientBeanHolder - [HttpClientBeanHolder] Destruction of the end
2025-05-25 03:48:12.153 [SpringContextShutdownHook] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - De-registering from Nacos Server now...
2025-05-25 03:48:12.153 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - [DEREGISTER-SERVICE] d750d92e-152f-4055-a641-3bc9dda85a29 deregistering service bgtech-ai with instance: Instance{instanceId='null', ip='192.168.86.8', port=8080, weight=1.0, healthy=true, enabled=true, ephemeral=true, clusterName='DEFAULT', serviceName='null', metadata={}}
2025-05-25 03:48:12.162 [SpringContextShutdownHook] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - De-registration finished.
2025-05-25 03:48:12.163 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.cache.ServiceInfoHolder do shutdown begin
2025-05-25 03:48:12.163 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.backups.FailoverReactor do shutdown begin
2025-05-25 03:48:12.164 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.backups.FailoverReactor do shutdown stop
2025-05-25 03:48:12.164 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.cache.ServiceInfoHolder do shutdown stop
2025-05-25 03:48:12.164 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.NamingClientProxyDelegate do shutdown begin
2025-05-25 03:48:12.164 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServiceInfoUpdateService do shutdown begin
2025-05-25 03:48:12.165 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServiceInfoUpdateService do shutdown stop
2025-05-25 03:48:12.165 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServerListManager do shutdown begin
2025-05-25 03:48:12.165 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Start destroying NacosRestTemplate
2025-05-25 03:48:12.165 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Destruction of the end
2025-05-25 03:48:12.165 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServerListManager do shutdown stop
2025-05-25 03:48:12.165 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.http.NamingHttpClientProxy do shutdown begin
2025-05-25 03:48:12.165 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Start destroying NacosRestTemplate
2025-05-25 03:48:12.165 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Destruction of the end
2025-05-25 03:48:12.165 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.http.NamingHttpClientProxy do shutdown stop
2025-05-25 03:48:12.165 [SpringContextShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Shutdown rpc client, set status to shutdown
2025-05-25 03:48:12.165 [SpringContextShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Shutdown client event executor java.util.concurrent.ScheduledThreadPoolExecutor@70d524d6[Running, pool size = 2, active threads = 2, queued tasks = 0, completed tasks = 0]
2025-05-25 03:48:12.165 [SpringContextShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Close current connection 1748115982170_139.227.195.192_49688
2025-05-25 03:48:12.172 [nacos-grpc-client-executor-8.133.246.113-34] WARN  c.a.nacos.common.remote.client.grpc.GrpcClient - [1748115982170_139.227.195.192_49688]Ignore error event,isRunning:false,isAbandon=false
2025-05-25 03:48:12.174 [SpringContextShutdownHook] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - Shutdown grpc executor java.util.concurrent.ThreadPoolExecutor@692cfa72[Running, pool size = 4, active threads = 0, queued tasks = 0, completed tasks = 35]
2025-05-25 03:48:12.174 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - Shutdown grpc redo service executor java.util.concurrent.ScheduledThreadPoolExecutor@2baa5ccd[Running, pool size = 1, active threads = 0, queued tasks = 1, completed tasks = 36]
2025-05-25 03:48:12.174 [SpringContextShutdownHook] INFO  c.a.n.client.auth.ram.identify.CredentialWatcher - [null] CredentialWatcher is stopped
2025-05-25 03:48:12.174 [SpringContextShutdownHook] INFO  c.a.n.client.auth.ram.identify.CredentialService - [null] CredentialService is freed
2025-05-25 03:48:12.176 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.NamingClientProxyDelegate do shutdown stop
2025-05-25 03:48:12.191 [SpringContextShutdownHook] DEBUG com.bgpay.bgai.config.AsyncConfig$1 - Shutting down ExecutorService 'blockingExecutor'
2025-05-25 03:48:14.269 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:10911] result: true
2025-05-25 03:48:14.269 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:9876] result: true
2025-05-25 03:48:14.282 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:10911] result: true
2025-05-25 03:48:14.283 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:9876] result: true
2025-05-25 03:48:14.421 [SpringContextShutdownHook] INFO  o.s.orm.jpa.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-05-25 03:48:14.423 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-2} closing ...
2025-05-25 03:48:14.429 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-2} closed
2025-05-25 03:48:14.429 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} closing ...
2025-05-25 03:48:14.429 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} closed
2025-05-25 03:48:14.430 [NettyClientSelector_TMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - channel inactive: [id: 0x45b01bdf, L:/192.168.86.8:62944 ! R:/8.133.246.113:8091]
2025-05-25 03:48:14.430 [NettyClientSelector_TMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - return to pool, rm channel:[id: 0x45b01bdf, L:/192.168.86.8:62944 ! R:/8.133.246.113:8091]
2025-05-25 03:48:14.430 [NettyClientSelector_TMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - channel valid false,channel:[id: 0x45b01bdf, L:/192.168.86.8:62944 ! R:/8.133.246.113:8091]
2025-05-25 03:48:14.430 [NettyClientSelector_TMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - will destroy channel:[id: 0x45b01bdf, L:/192.168.86.8:62944 ! R:/8.133.246.113:8091]
2025-05-25 03:48:14.430 [NettyClientSelector_TMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0x45b01bdf, L:/192.168.86.8:62944 ! R:/8.133.246.113:8091]) will closed
2025-05-25 03:48:14.430 [NettyClientSelector_TMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0x45b01bdf, L:/192.168.86.8:62944 ! R:/8.133.246.113:8091]) will closed
2025-05-25 03:48:14.431 [NettyClientSelector_RMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - channel inactive: [id: 0xe47b6d67, L:/192.168.86.8:62950 ! R:/8.133.246.113:8091]
2025-05-25 03:48:14.431 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - return to pool, rm channel:[id: 0xe47b6d67, L:/192.168.86.8:62950 ! R:/8.133.246.113:8091]
2025-05-25 03:48:14.431 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - channel valid false,channel:[id: 0xe47b6d67, L:/192.168.86.8:62950 ! R:/8.133.246.113:8091]
2025-05-25 03:48:14.431 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - will destroy channel:[id: 0xe47b6d67, L:/192.168.86.8:62950 ! R:/8.133.246.113:8091]
2025-05-25 03:48:14.431 [NettyClientSelector_RMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0xe47b6d67, L:/192.168.86.8:62950 ! R:/8.133.246.113:8091]) will closed
2025-05-25 03:48:14.431 [NettyClientSelector_RMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0xe47b6d67, L:/192.168.86.8:62950 ! R:/8.133.246.113:8091]) will closed
2025-05-25 04:00:05.803 [main] WARN  com.alibaba.nacos.client.logging.NacosLogging - Load Logback Configuration of Nacos fail, message: Could not initialize Logback Nacos logging from classpath:nacos-logback.xml
2025-05-25 04:00:05.804 [main] INFO  com.bgpay.bgai.BgaiApplication - The following 1 profile is active: "dev"
2025-05-25 04:00:07.199 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-05-25 04:00:07.201 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-05-25 04:00:07.228 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 19 ms. Found 0 JPA repository interfaces.
2025-05-25 04:00:07.240 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-05-25 04:00:07.242 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-05-25 04:00:07.255 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 5 ms. Found 0 Redis repository interfaces.
2025-05-25 04:00:07.788 [main] INFO  io.seata.config.ConfigurationFactory - load Configuration from :Spring Configuration
2025-05-25 04:00:07.797 [main] INFO  io.seata.config.ConfigurationFactory - load Configuration from :Spring Configuration
2025-05-25 04:00:07.803 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Initializing Global Transaction Clients ... 
2025-05-25 04:00:07.906 [main] INFO  io.seata.core.rpc.netty.NettyClientBootstrap - NettyClientBootstrap has started
2025-05-25 04:00:07.907 [main] INFO  io.seata.discovery.registry.RegistryFactory - use registry center type: file
2025-05-25 04:00:07.916 [main] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - will connect to 8.133.246.113:8091
2025-05-25 04:00:07.920 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - NettyPool create channel to transactionRole:TMROLE,address:8.133.246.113:8091,msg:< RegisterTMRequest{version='1.7.0', applicationId='bgtech-ai', transactionServiceGroup='bgai-tx-group', extraData='ak=null
digest=bgai-tx-group,192.168.86.8,1748116807919
timestamp=1748116807919
authVersion=V4
vgroup=bgai-tx-group
ip=192.168.86.8
'} >
2025-05-25 04:00:08.146 [main] INFO  io.seata.core.rpc.netty.TmNettyRemotingClient - register TM success. client version:1.7.0, server version:1.8.1-SNAPSHOT,channel:[id: 0xd0d6815a, L:/192.168.86.8:53456 - R:/8.133.246.113:8091]
2025-05-25 04:00:08.152 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - register success, cost 147 ms, version:1.8.1-SNAPSHOT,role:TMROLE,channel:[id: 0xd0d6815a, L:/192.168.86.8:53456 - R:/8.133.246.113:8091]
2025-05-25 04:00:08.152 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Transaction Manager Client is initialized. applicationId[bgtech-ai] txServiceGroup[bgai-tx-group]
2025-05-25 04:00:08.164 [main] INFO  io.seata.rm.datasource.AsyncWorker - Async Commit Buffer Limit: 10000
2025-05-25 04:00:08.164 [main] INFO  io.seata.rm.datasource.xa.ResourceManagerXA - ResourceManagerXA init ...
2025-05-25 04:00:08.169 [main] INFO  io.seata.core.rpc.netty.NettyClientBootstrap - NettyClientBootstrap has started
2025-05-25 04:00:08.169 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Resource Manager is initialized. applicationId[bgtech-ai] txServiceGroup[bgai-tx-group]
2025-05-25 04:00:08.169 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Global Transaction Clients are initialized. 
2025-05-25 04:00:09.292 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat initialized with port(s): 8080 (http)
2025-05-25 04:00:09.303 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - The ["http-nio-8080"] connector has been configured to support HTTP upgrade to [h2c]
2025-05-25 04:00:09.303 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - Initializing ProtocolHandler ["http-nio-8080"]
2025-05-25 04:00:09.305 [main] INFO  org.apache.catalina.core.StandardService - Starting service [Tomcat]
2025-05-25 04:00:09.305 [main] INFO  org.apache.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.15]
2025-05-25 04:00:09.711 [main] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} inited
2025-05-25 04:00:09.965 [main] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - will connect to 8.133.246.113:8091
2025-05-25 04:00:09.965 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - RM will register :jdbc:mysql://8.133.246.113:3306/deepseek
2025-05-25 04:00:09.966 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - NettyPool create channel to transactionRole:RMROLE,address:8.133.246.113:8091,msg:< RegisterRMRequest{resourceIds='jdbc:mysql://8.133.246.113:3306/deepseek', version='1.7.0', applicationId='bgtech-ai', transactionServiceGroup='bgai-tx-group', extraData='null'} >
2025-05-25 04:00:09.994 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - register RM success. client version:1.7.0, server version:1.8.1-SNAPSHOT,channel:[id: 0x7ed9603b, L:/192.168.86.8:53461 - R:/8.133.246.113:8091]
2025-05-25 04:00:09.994 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - register success, cost 19 ms, version:1.8.1-SNAPSHOT,role:RMROLE,channel:[id: 0x7ed9603b, L:/192.168.86.8:53461 - R:/8.133.246.113:8091]
2025-05-25 04:00:09.996 [main] INFO  i.s.s.a.datasource.SeataAutoDataSourceProxyCreator - Auto proxy data source 'masterDataSource' by 'AT' mode.
2025-05-25 04:00:10.063 [main] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-2} inited
2025-05-25 04:00:10.128 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - will register resourceId:jdbc:mysql://8.133.246.113:3306/deepseek
2025-05-25 04:00:10.129 [main] INFO  i.s.s.a.datasource.SeataAutoDataSourceProxyCreator - Auto proxy data source 'slaveDataSource' by 'AT' mode.
2025-05-25 04:00:10.138 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.rm.AbstractRMHandler - the rm client received response msg [RegisterRMResponse{version='1.8.1-SNAPSHOT', extraData='null', identified=true, resultCode=null, msg='null'}] from tc server.
2025-05-25 04:00:10.152 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - will register resourceId:jdbc:mysql://8.133.246.113:3306/deepseek
2025-05-25 04:00:10.152 [main] INFO  i.s.s.a.datasource.SeataAutoDataSourceProxyCreator - Auto proxy data source 'dynamicDataSource' by 'AT' mode.
2025-05-25 04:00:10.163 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.rm.AbstractRMHandler - the rm client received response msg [RegisterRMResponse{version='1.8.1-SNAPSHOT', extraData='null', identified=true, resultCode=null, msg='null'}] from tc server.
2025-05-25 04:00:10.278 [main] INFO  org.hibernate.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-05-25 04:00:10.339 [main] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.1.7.Final
2025-05-25 04:00:10.633 [main] INFO  SQL dialect - HHH000400: Using dialect: org.hibernate.dialect.MySQL8Dialect
2025-05-25 04:00:10.636 [main] WARN  org.hibernate.orm.deprecation - HHH90000026: MySQL8Dialect has been deprecated; use org.hibernate.dialect.MySQLDialect instead
2025-05-25 04:00:10.952 [main] INFO  o.h.e.t.jta.platform.internal.JtaPlatformInitiator - HHH000490: Using JtaPlatform implementation: [org.hibernate.engine.transaction.jta.platform.internal.NoJtaPlatform]
2025-05-25 04:00:10.962 [main] INFO  o.s.orm.jpa.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-05-25 04:00:11.340 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-25 04:00:11.352 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-25 04:00:11.389 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-25 04:00:11.392 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-25 04:00:11.393 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-25 04:00:11.405 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-25 04:00:12.061 [main] INFO  com.bgpay.bgai.service.impl.UserServiceImpl - 初始化SSO配置: clientId=bgai-client-id, redirectUri=http://localhost:8080/api/auth/callback
2025-05-25 04:00:12.191 [main] INFO  com.bgpay.bgai.controller.AuthController - 初始化认证控制器: clientId=bgai-client-id, redirectUri=http://localhost:8080/api/auth/callback
2025-05-25 04:00:13.190 [main] INFO  org.redisson.Version - Redisson 3.24.3
2025-05-25 04:00:13.316 [redisson-netty-4-6] INFO  o.r.connection.pool.MasterPubSubConnectionPool - 1 connections initialized for 8.133.246.113/8.133.246.113:6379
2025-05-25 04:00:13.630 [redisson-netty-4-19] INFO  org.redisson.connection.pool.MasterConnectionPool - 24 connections initialized for 8.133.246.113/8.133.246.113:6379
2025-05-25 04:00:13.814 [main] INFO  o.a.r.s.autoconfigure.RocketMQAutoConfiguration - a producer (billing-producer-group) init on namesrv 8.133.246.113:9876
2025-05-25 04:00:14.423 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Bean [com.bgpay.bgai.service.deepseek.DeepSeekServiceImp$$SpringCGLIB$$0] with name [deepSeekServiceImp] would use interceptor [io.seata.spring.annotation.GlobalTransactionalInterceptor]
2025-05-25 04:00:14.729 [main] WARN  i.s.s.b.a.provider.SpringBootConfigurationProvider - The get method not found for the field 'SeataProperties#accesskey'.
2025-05-25 04:00:14.730 [main] WARN  i.s.s.b.a.provider.SpringBootConfigurationProvider - The get method not found for the field 'SeataProperties#secretkey'.
2025-05-25 04:00:14.744 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 加载到1个Saga状态机定义文件
2025-05-25 04:00:14.905 [main] INFO  com.bgpay.bgai.saga.CustomSagaJsonParser - 开始解析状态机定义: bgai-saga-transaction
2025-05-25 04:00:14.905 [main] INFO  com.bgpay.bgai.saga.CustomSagaJsonParser - 状态机定义解析成功: bgai-saga-transaction
2025-05-25 04:00:14.905 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 成功加载状态机定义: /E:/project/bgai/target/classes/statelang/bgai-saga-transaction.json
2025-05-25 04:00:15.061 [main] INFO  com.bgpay.bgai.service.mq.MQConsumerService - MQ consumer startup successful [group=billing-consumer-group, topic=BILLING_TOPIC, tag=USER_BILLING]
2025-05-25 04:00:15.220 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Bean [com.bgpay.bgai.service.mq.BillingTransactionListenerImpl$$SpringCGLIB$$0] with name [billingTransactionListenerImpl] would use interceptor [io.seata.spring.annotation.GlobalTransactionalInterceptor]
2025-05-25 04:00:15.354 [main] DEBUG com.bgpay.bgai.config.AsyncConfig$1 - Initializing ExecutorService 'blockingExecutor'
2025-05-25 04:00:15.378 [main] INFO  c.b.bgai.config.NacosConfig$NacosWarningHandler - Nacos警告处理器已启用，将忽略配置中心连接警告
2025-05-25 04:00:16.474 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [After]
2025-05-25 04:00:16.474 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Before]
2025-05-25 04:00:16.474 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Between]
2025-05-25 04:00:16.474 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Cookie]
2025-05-25 04:00:16.474 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Header]
2025-05-25 04:00:16.474 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Host]
2025-05-25 04:00:16.474 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Method]
2025-05-25 04:00:16.474 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Path]
2025-05-25 04:00:16.475 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Query]
2025-05-25 04:00:16.475 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [ReadBody]
2025-05-25 04:00:16.475 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [RemoteAddr]
2025-05-25 04:00:16.475 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [XForwardedRemoteAddr]
2025-05-25 04:00:16.475 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Weight]
2025-05-25 04:00:16.475 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [CloudFoundryRouteService]
2025-05-25 04:00:17.956 [main] INFO  o.s.b.actuate.endpoint.web.EndpointLinksResolver - Exposing 3 endpoint(s) beneath base path '/actuator'
2025-05-25 04:00:19.558 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - Starting ProtocolHandler ["http-nio-8080"]
2025-05-25 04:00:19.572 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat started on port(s): 8080 (http) with context path ''
2025-05-25 04:00:19.583 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from ans.namespace attribute : null
2025-05-25 04:00:19.583 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from ALIBABA_ALIWARE_NAMESPACE attribute :null
2025-05-25 04:00:19.584 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from namespace attribute :null
2025-05-25 04:00:19.592 [main] INFO  c.a.n.p.auth.spi.client.ClientAuthPluginManager - [ClientAuthPluginManager] Load ClientAuthService com.alibaba.nacos.client.auth.impl.NacosClientAuthServiceImpl success.
2025-05-25 04:00:19.592 [main] INFO  c.a.n.p.auth.spi.client.ClientAuthPluginManager - [ClientAuthPluginManager] Load ClientAuthService com.alibaba.nacos.client.auth.ram.RamClientAuthServiceImpl success.
2025-05-25 04:00:19.596 [main] INFO  com.alibaba.nacos.common.remote.client - [RpcClientFactory] create a new rpc client of f0a15414-c809-4edd-b0ea-a099c66b8163
2025-05-25 04:00:19.598 [main] INFO  com.alibaba.nacos.common.remote.client - [f0a15414-c809-4edd-b0ea-a099c66b8163] RpcClient init, ServerListFactory = com.alibaba.nacos.client.naming.core.ServerListManager
2025-05-25 04:00:19.598 [main] INFO  com.alibaba.nacos.common.remote.client - [f0a15414-c809-4edd-b0ea-a099c66b8163] Registry connection listener to current client:com.alibaba.nacos.client.naming.remote.gprc.redo.NamingGrpcRedoService
2025-05-25 04:00:19.598 [main] INFO  com.alibaba.nacos.common.remote.client - [f0a15414-c809-4edd-b0ea-a099c66b8163] Register server push request handler:com.alibaba.nacos.client.naming.remote.gprc.NamingPushRequestHandler
2025-05-25 04:00:19.599 [main] INFO  com.alibaba.nacos.common.remote.client - [f0a15414-c809-4edd-b0ea-a099c66b8163] Try to connect to server on start up, server: {serverIp = '8.133.246.113', server main port = 8848}
2025-05-25 04:00:19.599 [main] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - grpc client connection server:8.133.246.113 ip,serverPort:9848,grpcTslConfig:{"sslProvider":"OPENSSL","enableTls":false,"mutualAuthEnable":false,"trustAll":false}
2025-05-25 04:00:19.730 [main] INFO  com.alibaba.nacos.common.remote.client - [f0a15414-c809-4edd-b0ea-a099c66b8163] Success to connect to server [8.133.246.113:8848] on start up, connectionId = 1748116819649_139.227.195.192_48354
2025-05-25 04:00:19.730 [main] INFO  com.alibaba.nacos.common.remote.client - [f0a15414-c809-4edd-b0ea-a099c66b8163] Register server push request handler:com.alibaba.nacos.common.remote.client.RpcClient$ConnectResetRequestHandler
2025-05-25 04:00:19.730 [com.alibaba.nacos.client.remote.worker] INFO  com.alibaba.nacos.common.remote.client - [f0a15414-c809-4edd-b0ea-a099c66b8163] Notify connected event to listeners.
2025-05-25 04:00:19.730 [main] INFO  com.alibaba.nacos.common.remote.client - [f0a15414-c809-4edd-b0ea-a099c66b8163] Register server push request handler:com.alibaba.nacos.common.remote.client.RpcClient$$Lambda/0x000001dc81529c60
2025-05-25 04:00:19.730 [com.alibaba.nacos.client.remote.worker] INFO  com.alibaba.nacos.client.naming - Grpc connection connect
2025-05-25 04:00:19.731 [main] INFO  com.alibaba.nacos.client.naming - [REGISTER-SERVICE] d750d92e-152f-4055-a641-3bc9dda85a29 registering service bgtech-ai with instance Instance{instanceId='null', ip='192.168.86.8', port=8080, weight=1.0, healthy=true, enabled=true, ephemeral=true, clusterName='DEFAULT', serviceName='null', metadata={IPv6=[2408:820c:7528:d042:c185:8edc:f30d:3d91], preserved.register.source=SPRING_CLOUD}}
2025-05-25 04:00:19.756 [main] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - nacos registry, DEFAULT_GROUP bgtech-ai 192.168.86.8:8080 register finished
2025-05-25 04:00:19.813 [main] INFO  com.bgpay.bgai.config.NacosConfig - 应用启动完成，当前环境: dev
2025-05-25 04:00:19.813 [main] INFO  com.bgpay.bgai.config.NacosConfig - Nacos配置中心: 8.133.246.113:8848, 命名空间: d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-25 04:00:19.813 [main] INFO  com.bgpay.bgai.config.NacosConfig - 注意: 如果看到Nacos配置加载警告，但应用正常启动，说明应用正在使用本地配置文件
2025-05-25 04:00:19.815 [main] INFO  com.bgpay.bgai.BgaiApplication - Started BgaiApplication in 16.125 seconds (process running for 17.527)
2025-05-25 04:00:19.819 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-25 04:00:19.819 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-25 04:00:19.831 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-25 04:00:19.831 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-25 04:00:19.832 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-25 04:00:19.843 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-25 04:00:19.843 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-25 04:00:19.844 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-25 04:00:19.852 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-25 04:00:19.853 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-25 04:00:19.853 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-25 04:00:19.860 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-25 04:00:19.860 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - ==================== Saga状态机加载报告 ====================
2025-05-25 04:00:19.861 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - Saga状态机配置加载状态: 成功
2025-05-25 04:00:19.861 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 已加载的状态机定义文件数量: 1
2025-05-25 04:00:19.861 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 已加载的状态机定义文件:
2025-05-25 04:00:19.861 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig -  - /E:/project/bgai/target/classes/statelang/bgai-saga-transaction.json
2025-05-25 04:00:19.861 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - Saga解析器状态: CUSTOM_FASTJSON2
2025-05-25 04:00:19.861 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 状态机解析结果: 成功 1 个, 失败 0 个
2025-05-25 04:00:19.861 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - =============================================================
2025-05-25 04:00:19.866 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - nacos.cache.data.init.snapshot = true 
2025-05-25 04:00:19.866 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] common-dev.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-25 04:00:19.876 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=common-dev.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-25 04:00:19.876 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=common-dev.yaml, group=DEFAULT_GROUP
2025-05-25 04:00:19.876 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-25 04:00:19.876 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-25 04:00:19.877 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai.yaml, group=DEFAULT_GROUP
2025-05-25 04:00:19.878 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai-dev.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-25 04:00:19.878 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai-dev.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-25 04:00:19.878 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai-dev.yaml, group=DEFAULT_GROUP
2025-05-25 04:00:19.879 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-25 04:00:19.879 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai, group=DEFAULT_GROUP, cnt=1
2025-05-25 04:00:19.879 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai, group=DEFAULT_GROUP
2025-05-25 04:01:23.900 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - 接收到请求: /api/chatGatWay-internal, 文件=新文件 17.txt, 问题参数=null, 模型参数=null
2025-05-25 04:01:23.902 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - 请求Content-Type: multipart/form-data;boundary=--------------------------508467147460782499920282
2025-05-25 04:01:23.902 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - 收集到的完整参数: question="null", apiUrl="null", modelName="null", multiTurn=false
2025-05-25 04:01:23.904 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - Processing request for user ID: 689258T
2025-05-25 04:01:23.904 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - Processing file with circuit breaker: fileName=新文件 17.txt, question=
2025-05-25 04:01:23.906 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.config.ReactiveFileProcessor - Processing file: 新文件 17.txt, content-type: text/plain
2025-05-25 04:01:23.912 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - PARAM TRACE [689258T]: 尝试查找匹配配置 - 参数: apiUrl=null, modelName=null
2025-05-25 04:01:23.921 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 查询配置 - userId=689258T
2025-05-25 04:01:23.922 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 排序方式 - 按ID降序
2025-05-25 04:01:23.922 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 限制结果数 - LIMIT 1
2025-05-25 04:01:24.002 [http-nio-8080-exec-2] WARN  com.alibaba.druid.pool.DruidAbstractDataSource - discard long time none received connection. , jdbcUrl : jdbc:mysql://8.133.246.113:3306/deepseek?autoReconnect=false&useUnicode=true&characterEncoding=UTF-8&characterSetResults=UTF-8&zeroDateTimeBehavior=convertToNull&useSSL=false&allowPublicKeyRetrieval=true&useSSL=false, version : 1.2.8, lastPacketReceivedIdleMillis : 64113
2025-05-25 04:01:24.006 [http-nio-8080-exec-2] WARN  com.alibaba.druid.pool.DruidAbstractDataSource - discard long time none received connection. , jdbcUrl : jdbc:mysql://8.133.246.113:3306/deepseek?autoReconnect=false&useUnicode=true&characterEncoding=UTF-8&characterSetResults=UTF-8&zeroDateTimeBehavior=convertToNull&useSSL=false&allowPublicKeyRetrieval=true&useSSL=false, version : 1.2.8, lastPacketReceivedIdleMillis : 64147
2025-05-25 04:01:24.080 [http-nio-8080-exec-2] DEBUG com.bgpay.bgai.mapper.ApiConfigMapper.selectList - ==>  Preparing: SELECT id,api_url,api_key,model_name,user_id FROM api_config WHERE (user_id = ?) ORDER BY id DESC LIMIT 1
2025-05-25 04:01:24.082 [http-nio-8080-exec-2] DEBUG com.bgpay.bgai.mapper.ApiConfigMapper.selectList - ==> Parameters: 689258T(String)
2025-05-25 04:01:24.097 [http-nio-8080-exec-2] DEBUG com.bgpay.bgai.mapper.ApiConfigMapper.selectList - <==      Total: 1
2025-05-25 04:01:24.098 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 查询结果 - 找到配置: id=2, modelName=deepseek-chat
2025-05-25 04:01:24.098 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - PARAM TRACE [689258T]: 找到匹配配置 - apiUrl=https://api.deepseek.com/chat/completions, modelName=deepseek-chat (原始请求: null)
2025-05-25 04:01:24.098 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - API config resolved: url=https://api.deepseek.com/chat/completions, model=deepseek-chat
2025-05-25 04:01:24.117 [Thread-58] INFO  com.bgpay.bgai.config.ReactiveFileProcessor - File processed successfully: size=37 bytes
2025-05-25 04:01:24.121 [Thread-58] INFO  com.bgpay.bgai.controller.ReactiveChatController - Content processed, length: 54
2025-05-25 04:01:24.129 [Thread-58] INFO  io.seata.tm.TransactionManagerHolder - TransactionManager Singleton io.seata.tm.DefaultTransactionManager@28c81d4
2025-05-25 04:01:24.155 [Thread-58] INFO  io.seata.tm.api.DefaultGlobalTransaction - Begin new global transaction [seata-server:8091:117747646027194369]
2025-05-25 04:01:24.157 [Thread-58] INFO  c.b.bgai.interceptor.SeataTransactionInterceptor - 准备记录分布式事务开始: XID=seata-server:8091:117747646027194369, 业务=com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive, 路径=, IP=, 用户=system
2025-05-25 04:01:24.179 [Thread-58] INFO  c.b.bgai.service.impl.TransactionLogServiceImpl - 记录分布式事务开始: XID=seata-server:8091:117747646027194369, 业务=com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive
2025-05-25 04:01:24.186 [Thread-58] DEBUG com.bgpay.bgai.mapper.TransactionLogMapper.insert - ==>  Preparing: INSERT INTO transaction_log ( xid, transaction_name, transaction_mode, status, request_path, source_ip, start_time, user_id, create_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-05-25 04:01:24.191 [Thread-58] DEBUG com.bgpay.bgai.mapper.TransactionLogMapper.insert - ==> Parameters: seata-server:8091:117747646027194369(String), com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive(String), AT(String), ACTIVE(String), (String), (String), 2025-05-25T04:01:24.179637500(LocalDateTime), system(String), 2025-05-25T04:01:24.179637500(LocalDateTime)
2025-05-25 04:01:24.761 [Thread-58] DEBUG com.bgpay.bgai.mapper.TransactionLogMapper.insert - <==    Updates: 1
2025-05-25 04:01:24.836 [Thread-58] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:117747646027194369, branchId:117747646027194370, lockKeys:transaction_log:53
2025-05-25 04:01:24.859 [Thread-58] WARN  i.s.c.l.EnhancedServiceLoader$InnerEnhancedServiceLoader - Load [io.seata.rm.datasource.undo.parser.ProtostuffUndoLogParser] class fail: io/protostuff/runtime/IdStrategy
2025-05-25 04:01:25.051 [Thread-58] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:117747646027194369, branchId:117747646027194371, lockKeys:undo_log:219;transaction_log:53
2025-05-25 04:01:25.111 [Thread-58] INFO  c.b.bgai.interceptor.SeataTransactionInterceptor - 开始分布式事务: XID=seata-server:8091:117747646027194369, 方法=com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive
2025-05-25 04:01:25.260 [Thread-58] INFO  org.reflections.Reflections - Processing reactive request: content length=54, apiUrl=https://api.deepseek.com/chat/completions, modelName=deepseek-chat, userId=689258T, multiTurn=false
2025-05-25 04:01:25.303 [Thread-58] INFO  c.b.bgai.service.impl.TransactionLogServiceImpl - 记录分布式事务结束: XID=seata-server:8091:117747646027194369, 状态=COMMITTED
2025-05-25 04:01:25.305 [Thread-58] DEBUG c.b.bgai.mapper.TransactionLogMapper.selectList - ==>  Preparing: SELECT id,xid,branch_id,transaction_name,transaction_mode,status,request_path,source_ip,start_time,end_time,user_id,extra_data,create_time,update_time FROM transaction_log WHERE (xid = ?) LIMIT 1
2025-05-25 04:01:25.308 [Thread-58] DEBUG c.b.bgai.mapper.TransactionLogMapper.selectList - ==> Parameters: seata-server:8091:117747646027194369(String)
2025-05-25 04:01:25.320 [Thread-58] DEBUG c.b.bgai.mapper.TransactionLogMapper.selectList - <==      Total: 1
2025-05-25 04:01:25.334 [Thread-58] DEBUG c.b.bgai.mapper.TransactionLogMapper.updateById - ==>  Preparing: UPDATE transaction_log SET xid=?, transaction_name=?, transaction_mode=?, status=?, request_path=?, source_ip=?, start_time=?, end_time=?, user_id=?, extra_data=?, create_time=?, update_time=? WHERE id=?
2025-05-25 04:01:25.349 [Thread-58] DEBUG c.b.bgai.mapper.TransactionLogMapper.updateById - ==> Parameters: seata-server:8091:117747646027194369(String), com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive(String), AT(String), COMMITTED(String), (String), (String), 2025-05-25T04:01:24(LocalDateTime), 2025-05-25T04:01:25.321077200(LocalDateTime), system(String), {"duration":175,"result":"success"}(String), 2025-05-25T04:01:24(LocalDateTime), 2025-05-25T04:01:25.321077200(LocalDateTime), 53(Long)
2025-05-25 04:01:25.523 [Thread-58] DEBUG c.b.bgai.mapper.TransactionLogMapper.updateById - <==    Updates: 1
2025-05-25 04:01:25.538 [Thread-58] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:117747646027194369, branchId:117747646027194372, lockKeys:transaction_log:53
2025-05-25 04:01:25.570 [Thread-58] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:117747646027194369, branchId:117747646027194373, lockKeys:undo_log:221;transaction_log:53
2025-05-25 04:01:25.608 [Thread-58] INFO  c.b.bgai.interceptor.SeataTransactionInterceptor - 分布式事务成功完成: XID=seata-server:8091:117747646027194369, 耗时=175ms
2025-05-25 04:01:25.608 [Thread-58] INFO  io.seata.tm.api.DefaultGlobalTransaction - transaction seata-server:8091:117747646027194369 will be commit
2025-05-25 04:01:25.623 [Thread-58] INFO  io.seata.tm.api.DefaultGlobalTransaction - transaction end, xid = seata-server:8091:117747646027194369
2025-05-25 04:01:25.624 [Thread-58] INFO  io.seata.tm.api.DefaultGlobalTransaction - [seata-server:8091:117747646027194369] commit status: Committed
2025-05-25 04:01:25.683 [boundedElastic-1] WARN  com.bgpay.bgai.transaction.TransactionCoordinator - Found existing transaction for user 689258T: chat-d25aba81-3422-4521-9e4e-2bf181f7bab0
2025-05-25 04:01:25.684 [boundedElastic-1] INFO  org.reflections.Reflections - Transaction prepared with chatCompletionId: chat-d25aba81-3422-4521-9e4e-2bf181f7bab0
2025-05-25 04:01:26.344 [rpcDispatch_RMROLE_1_1_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:117747646027194369', branchId=117747646027194370, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false,"skipCheckLock":true}'}
2025-05-25 04:01:26.345 [rpcDispatch_RMROLE_1_1_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:117747646027194369 117747646027194370 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false,"skipCheckLock":true}
2025-05-25 04:01:26.346 [rpcDispatch_RMROLE_1_1_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-25 04:01:26.359 [rpcDispatch_RMROLE_1_2_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:117747646027194369', branchId=117747646027194371, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false,"skipCheckLock":true}'}
2025-05-25 04:01:26.360 [rpcDispatch_RMROLE_1_2_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:117747646027194369 117747646027194371 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false,"skipCheckLock":true}
2025-05-25 04:01:26.360 [rpcDispatch_RMROLE_1_2_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-25 04:01:26.369 [rpcDispatch_RMROLE_1_3_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:117747646027194369', branchId=117747646027194372, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false}'}
2025-05-25 04:01:26.369 [rpcDispatch_RMROLE_1_3_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:117747646027194369 117747646027194372 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false}
2025-05-25 04:01:26.369 [rpcDispatch_RMROLE_1_3_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-25 04:01:26.378 [rpcDispatch_RMROLE_1_4_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:117747646027194369', branchId=117747646027194373, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false}'}
2025-05-25 04:01:26.378 [rpcDispatch_RMROLE_1_4_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:117747646027194369 117747646027194373 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false}
2025-05-25 04:01:26.378 [rpcDispatch_RMROLE_1_4_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-25 04:01:52.581 [FileWrite-1] INFO  com.bgpay.bgai.service.deepseek.FileWriterService - Successfully wrote content to: \var\data\ai_responses\4622db90-721d-43a1-8641-c8b4f7fe8866.txt
2025-05-25 04:01:52.593 [reactor-http-nio-2] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - ==>  Preparing: INSERT INTO chat_completions ( object, created, model, system_fingerprint, api_key ) VALUES ( ?, ?, ?, ?, ? )
2025-05-25 04:01:52.594 [reactor-http-nio-2] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - ==> Parameters: chat.completion(String), 1748116912591(Long), deepseek-chat(String), 689258T(String), chat-d25aba81-3422-4521-9e4e-2bf181f7bab0(String)
2025-05-25 04:01:52.616 [reactor-http-nio-2] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - <==    Updates: 1
2025-05-25 04:01:52.616 [reactor-http-nio-2] INFO  com.bgpay.bgai.transaction.TransactionCoordinator - Transaction committed for user 689258T: chatCompletionId=chat-d25aba81-3422-4521-9e4e-2bf181f7bab0
2025-05-25 04:01:52.636 [reactor-http-nio-2] INFO  org.reflections.Reflections - 开始发送账单消息，chatCompletionId: chat-d25aba81-3422-4521-9e4e-2bf181f7bab0, userId: 689258T
2025-05-25 04:01:52.711 [reactor-http-nio-2] INFO  io.seata.tm.api.DefaultGlobalTransaction - Begin new global transaction [seata-server:8091:117747646027194374]
2025-05-25 04:01:52.712 [reactor-http-nio-2] INFO  c.b.bgai.interceptor.SeataTransactionInterceptor - 准备记录分布式事务开始: XID=seata-server:8091:117747646027194374, 业务=com.bgpay.bgai.service.mq.BillingTransactionListenerImpl.executeLocalTransaction, 路径=, IP=, 用户=system
2025-05-25 04:01:52.719 [reactor-http-nio-2] INFO  c.b.bgai.service.impl.TransactionLogServiceImpl - 记录分布式事务开始: XID=seata-server:8091:117747646027194374, 业务=com.bgpay.bgai.service.mq.BillingTransactionListenerImpl.executeLocalTransaction
2025-05-25 04:01:52.719 [reactor-http-nio-2] DEBUG com.bgpay.bgai.mapper.TransactionLogMapper.insert - ==>  Preparing: INSERT INTO transaction_log ( xid, transaction_name, transaction_mode, status, request_path, source_ip, start_time, user_id, create_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-05-25 04:01:52.720 [reactor-http-nio-2] DEBUG com.bgpay.bgai.mapper.TransactionLogMapper.insert - ==> Parameters: seata-server:8091:117747646027194374(String), com.bgpay.bgai.service.mq.BillingTransactionListenerImpl.executeLocalTransaction(String), AT(String), ACTIVE(String), (String), (String), 2025-05-25T04:01:52.719836200(LocalDateTime), system(String), 2025-05-25T04:01:52.719836200(LocalDateTime)
2025-05-25 04:01:52.757 [reactor-http-nio-2] DEBUG com.bgpay.bgai.mapper.TransactionLogMapper.insert - <==    Updates: 1
2025-05-25 04:01:52.767 [reactor-http-nio-2] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:117747646027194374, branchId:117747646027194375, lockKeys:transaction_log:54
2025-05-25 04:01:52.793 [reactor-http-nio-2] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:117747646027194374, branchId:117747646027194376, lockKeys:undo_log:223;transaction_log:54
2025-05-25 04:01:52.820 [reactor-http-nio-2] INFO  c.b.bgai.interceptor.SeataTransactionInterceptor - 开始分布式事务: XID=seata-server:8091:117747646027194374, 方法=com.bgpay.bgai.service.mq.BillingTransactionListenerImpl.executeLocalTransaction
2025-05-25 04:01:52.820 [reactor-http-nio-2] INFO  c.b.bgai.service.mq.BillingTransactionListenerImpl - 开始执行本地事务, xid: seata-server:8091:117747646027194374, userId: 689258T, completionId: chat-d25aba81-3422-4521-9e4e-2bf181f7bab0
2025-05-25 04:01:52.833 [reactor-http-nio-2] INFO  c.b.bgai.service.mq.BillingTransactionListenerImpl - 消息已处理，提交事务, completionId: chat-d25aba81-3422-4521-9e4e-2bf181f7bab0
2025-05-25 04:01:52.840 [reactor-http-nio-2] INFO  c.b.bgai.service.impl.TransactionLogServiceImpl - 记录分布式事务结束: XID=seata-server:8091:117747646027194374, 状态=COMMITTED
2025-05-25 04:01:52.841 [reactor-http-nio-2] DEBUG c.b.bgai.mapper.TransactionLogMapper.selectList - ==>  Preparing: SELECT id,xid,branch_id,transaction_name,transaction_mode,status,request_path,source_ip,start_time,end_time,user_id,extra_data,create_time,update_time FROM transaction_log WHERE (xid = ?) LIMIT 1
2025-05-25 04:01:52.842 [reactor-http-nio-2] DEBUG c.b.bgai.mapper.TransactionLogMapper.selectList - ==> Parameters: seata-server:8091:117747646027194374(String)
2025-05-25 04:01:52.850 [reactor-http-nio-2] DEBUG c.b.bgai.mapper.TransactionLogMapper.selectList - <==      Total: 1
2025-05-25 04:01:52.851 [reactor-http-nio-2] DEBUG c.b.bgai.mapper.TransactionLogMapper.updateById - ==>  Preparing: UPDATE transaction_log SET xid=?, transaction_name=?, transaction_mode=?, status=?, request_path=?, source_ip=?, start_time=?, end_time=?, user_id=?, extra_data=?, create_time=?, update_time=? WHERE id=?
2025-05-25 04:01:52.852 [reactor-http-nio-2] DEBUG c.b.bgai.mapper.TransactionLogMapper.updateById - ==> Parameters: seata-server:8091:117747646027194374(String), com.bgpay.bgai.service.mq.BillingTransactionListenerImpl.executeLocalTransaction(String), AT(String), COMMITTED(String), (String), (String), 2025-05-25T04:01:53(LocalDateTime), 2025-05-25T04:01:52.850840500(LocalDateTime), system(String), {"duration":14,"result":"success"}(String), 2025-05-25T04:01:53(LocalDateTime), 2025-05-25T04:01:52.850840500(LocalDateTime), 54(Long)
2025-05-25 04:01:52.903 [reactor-http-nio-2] DEBUG c.b.bgai.mapper.TransactionLogMapper.updateById - <==    Updates: 1
2025-05-25 04:01:52.915 [reactor-http-nio-2] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:117747646027194374, branchId:117747646027194377, lockKeys:transaction_log:54
2025-05-25 04:01:52.956 [reactor-http-nio-2] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:117747646027194374, branchId:117747646027194378, lockKeys:undo_log:225;transaction_log:54
2025-05-25 04:01:52.988 [reactor-http-nio-2] INFO  c.b.bgai.interceptor.SeataTransactionInterceptor - 分布式事务成功完成: XID=seata-server:8091:117747646027194374, 耗时=14ms
2025-05-25 04:01:52.988 [reactor-http-nio-2] INFO  io.seata.tm.api.DefaultGlobalTransaction - transaction seata-server:8091:117747646027194374 will be commit
2025-05-25 04:01:53.002 [reactor-http-nio-2] INFO  io.seata.tm.api.DefaultGlobalTransaction - transaction end, xid = seata-server:8091:117747646027194374
2025-05-25 04:01:53.002 [reactor-http-nio-2] INFO  io.seata.tm.api.DefaultGlobalTransaction - [seata-server:8091:117747646027194374] commit status: Committed
2025-05-25 04:01:53.004 [reactor-http-nio-2] INFO  org.reflections.Reflections - 账单消息发送成功，chatCompletionId: chat-d25aba81-3422-4521-9e4e-2bf181f7bab0, userId: 689258T
2025-05-25 04:01:53.010 [reactor-http-nio-2] INFO  com.bgpay.bgai.service.impl.BGAIServiceImpl - 执行第一步操作 - 发送账单消息, businessKey: 689258T:chat-d25aba81-3422-4521-9e4e-2bf181f7bab0
2025-05-25 04:01:53.013 [reactor-http-nio-2] DEBUG c.bgpay.bgai.mapper.UsageRecordMapper.selectCount - ==>  Preparing: SELECT COUNT( * ) AS total FROM usage_record WHERE (chat_completion_id = ?)
2025-05-25 04:01:53.014 [reactor-http-nio-2] DEBUG c.bgpay.bgai.mapper.UsageRecordMapper.selectCount - ==> Parameters: chat-d25aba81-3422-4521-9e4e-2bf181f7bab0(String)
2025-05-25 04:01:53.028 [reactor-http-nio-2] DEBUG c.bgpay.bgai.mapper.UsageRecordMapper.selectCount - <==      Total: 1
2025-05-25 04:01:53.028 [reactor-http-nio-2] INFO  com.bgpay.bgai.service.impl.BGAIServiceImpl - 账单消息已处理，跳过发送, completionId: chat-d25aba81-3422-4521-9e4e-2bf181f7bab0
2025-05-25 04:01:53.040 [reactor-http-nio-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - Processed response for user 689258T, content length: 2026
2025-05-25 04:01:53.337 [ConsumeMessageThread_billing-consumer-group_1] INFO  c.bgpay.bgai.service.mq.RocketMQBillingServiceImpl - Output price config priceVersion: 1
2025-05-25 04:01:53.344 [rpcDispatch_RMROLE_1_5_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:117747646027194374', branchId=117747646027194375, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false,"skipCheckLock":true}'}
2025-05-25 04:01:53.345 [rpcDispatch_RMROLE_1_5_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:117747646027194374 117747646027194375 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false,"skipCheckLock":true}
2025-05-25 04:01:53.345 [rpcDispatch_RMROLE_1_5_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-25 04:01:53.347 [ConsumeMessageThread_billing-consumer-group_1] DEBUG com.bgpay.bgai.mapper.UsageRecordMapper.insert - ==>  Preparing: INSERT INTO usage_record ( model_type, chat_completion_id, user_id, input_cost, output_cost, price_version, calculated_at, status, created_at ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-05-25 04:01:53.348 [ConsumeMessageThread_billing-consumer-group_1] DEBUG com.bgpay.bgai.mapper.UsageRecordMapper.insert - ==> Parameters: deepseek-chat(String), chat-d25aba81-3422-4521-9e4e-2bf181f7bab0(String), 689258T(String), 0.0001(BigDecimal), 0.0000(BigDecimal), 1(Integer), 2025-05-25T04:01:53.260477900(LocalDateTime), PENDING(String), 2025-05-25T04:01:53.260477900(LocalDateTime)
2025-05-25 04:01:53.354 [rpcDispatch_RMROLE_1_6_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:117747646027194374', branchId=117747646027194376, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false,"skipCheckLock":true}'}
2025-05-25 04:01:53.354 [rpcDispatch_RMROLE_1_6_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:117747646027194374 117747646027194376 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false,"skipCheckLock":true}
2025-05-25 04:01:53.354 [rpcDispatch_RMROLE_1_6_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-25 04:01:53.361 [ConsumeMessageThread_billing-consumer-group_1] DEBUG com.bgpay.bgai.mapper.UsageRecordMapper.insert - <==    Updates: 1
2025-05-25 04:01:53.363 [rpcDispatch_RMROLE_1_7_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:117747646027194374', branchId=117747646027194377, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false}'}
2025-05-25 04:01:53.363 [rpcDispatch_RMROLE_1_7_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:117747646027194374 117747646027194377 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false}
2025-05-25 04:01:53.363 [rpcDispatch_RMROLE_1_7_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-25 04:01:53.371 [rpcDispatch_RMROLE_1_8_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:117747646027194374', branchId=117747646027194378, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false}'}
2025-05-25 04:01:53.371 [rpcDispatch_RMROLE_1_8_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:117747646027194374 117747646027194378 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false}
2025-05-25 04:01:53.371 [rpcDispatch_RMROLE_1_8_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-25 04:01:53.386 [ConsumeMessageThread_billing-consumer-group_1] INFO  c.bgpay.bgai.service.mq.RocketMQBillingServiceImpl - Message consumed: 2408820C7528D042C1858EDCF30D3D912E1436BAF30C7C76121E0000
2025-05-25 04:02:02.927 [Thread-1] WARN  c.alibaba.nacos.common.http.HttpClientBeanHolder - [HttpClientBeanHolder] Start destroying common HttpClient
2025-05-25 04:02:02.927 [Thread-7] WARN  com.alibaba.nacos.common.notify.NotifyCenter - [NotifyCenter] Start destroying Publisher
2025-05-25 04:02:02.927 [Thread-7] WARN  com.alibaba.nacos.common.notify.NotifyCenter - [NotifyCenter] Destruction of the end
2025-05-25 04:02:02.927 [Thread-1] WARN  c.alibaba.nacos.common.http.HttpClientBeanHolder - [HttpClientBeanHolder] Destruction of the end
2025-05-25 04:02:02.945 [SpringContextShutdownHook] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - De-registering from Nacos Server now...
2025-05-25 04:02:02.945 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - [DEREGISTER-SERVICE] d750d92e-152f-4055-a641-3bc9dda85a29 deregistering service bgtech-ai with instance: Instance{instanceId='null', ip='192.168.86.8', port=8080, weight=1.0, healthy=true, enabled=true, ephemeral=true, clusterName='DEFAULT', serviceName='null', metadata={}}
2025-05-25 04:02:02.956 [SpringContextShutdownHook] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - De-registration finished.
2025-05-25 04:02:02.957 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.cache.ServiceInfoHolder do shutdown begin
2025-05-25 04:02:02.957 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.backups.FailoverReactor do shutdown begin
2025-05-25 04:02:02.957 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.backups.FailoverReactor do shutdown stop
2025-05-25 04:02:02.957 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.cache.ServiceInfoHolder do shutdown stop
2025-05-25 04:02:02.957 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.NamingClientProxyDelegate do shutdown begin
2025-05-25 04:02:02.957 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServiceInfoUpdateService do shutdown begin
2025-05-25 04:02:02.957 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServiceInfoUpdateService do shutdown stop
2025-05-25 04:02:02.957 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServerListManager do shutdown begin
2025-05-25 04:02:02.957 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Start destroying NacosRestTemplate
2025-05-25 04:02:02.957 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Destruction of the end
2025-05-25 04:02:02.957 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServerListManager do shutdown stop
2025-05-25 04:02:02.957 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.http.NamingHttpClientProxy do shutdown begin
2025-05-25 04:02:02.957 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Start destroying NacosRestTemplate
2025-05-25 04:02:02.957 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Destruction of the end
2025-05-25 04:02:02.957 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.http.NamingHttpClientProxy do shutdown stop
2025-05-25 04:02:02.957 [SpringContextShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Shutdown rpc client, set status to shutdown
2025-05-25 04:02:02.957 [SpringContextShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Shutdown client event executor java.util.concurrent.ScheduledThreadPoolExecutor@3b6d0859[Running, pool size = 2, active threads = 2, queued tasks = 0, completed tasks = 0]
2025-05-25 04:02:02.957 [SpringContextShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Close current connection 1748116819649_139.227.195.192_48354
2025-05-25 04:02:02.961 [nacos-grpc-client-executor-8.133.246.113-42] WARN  c.a.nacos.common.remote.client.grpc.GrpcClient - [1748116819649_139.227.195.192_48354]Ignore error event,isRunning:false,isAbandon=false
2025-05-25 04:02:02.963 [SpringContextShutdownHook] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - Shutdown grpc executor java.util.concurrent.ThreadPoolExecutor@70663424[Running, pool size = 7, active threads = 0, queued tasks = 0, completed tasks = 43]
2025-05-25 04:02:02.963 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - Shutdown grpc redo service executor java.util.concurrent.ScheduledThreadPoolExecutor@4bf17184[Running, pool size = 1, active threads = 0, queued tasks = 1, completed tasks = 34]
2025-05-25 04:02:02.963 [SpringContextShutdownHook] INFO  c.a.n.client.auth.ram.identify.CredentialWatcher - [null] CredentialWatcher is stopped
2025-05-25 04:02:02.963 [SpringContextShutdownHook] INFO  c.a.n.client.auth.ram.identify.CredentialService - [null] CredentialService is freed
2025-05-25 04:02:02.963 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.NamingClientProxyDelegate do shutdown stop
2025-05-25 04:02:02.969 [SpringContextShutdownHook] DEBUG com.bgpay.bgai.config.AsyncConfig$1 - Shutting down ExecutorService 'blockingExecutor'
2025-05-25 04:02:04.621 [com.alibaba.nacos.client.Worker] INFO  c.a.n.client.auth.ram.identify.CredentialWatcher - null No credential found
2025-05-25 04:02:05.020 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:10911] result: true
2025-05-25 04:02:05.020 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:9876] result: true
2025-05-25 04:02:05.036 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:10911] result: true
2025-05-25 04:02:05.036 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:9876] result: true
2025-05-25 04:02:05.181 [SpringContextShutdownHook] INFO  o.s.orm.jpa.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-05-25 04:02:05.183 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-2} closing ...
2025-05-25 04:02:05.185 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-2} closed
2025-05-25 04:02:05.185 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} closing ...
2025-05-25 04:02:05.186 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} closed
2025-05-25 04:02:05.186 [NettyClientSelector_TMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - channel inactive: [id: 0xd0d6815a, L:/192.168.86.8:53456 ! R:/8.133.246.113:8091]
2025-05-25 04:02:05.186 [NettyClientSelector_TMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - return to pool, rm channel:[id: 0xd0d6815a, L:/192.168.86.8:53456 ! R:/8.133.246.113:8091]
2025-05-25 04:02:05.186 [NettyClientSelector_TMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - channel valid false,channel:[id: 0xd0d6815a, L:/192.168.86.8:53456 ! R:/8.133.246.113:8091]
2025-05-25 04:02:05.186 [NettyClientSelector_TMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - will destroy channel:[id: 0xd0d6815a, L:/192.168.86.8:53456 ! R:/8.133.246.113:8091]
2025-05-25 04:02:05.186 [NettyClientSelector_TMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0xd0d6815a, L:/192.168.86.8:53456 ! R:/8.133.246.113:8091]) will closed
2025-05-25 04:02:05.186 [NettyClientSelector_TMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0xd0d6815a, L:/192.168.86.8:53456 ! R:/8.133.246.113:8091]) will closed
2025-05-25 04:02:05.187 [NettyClientSelector_RMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - channel inactive: [id: 0x7ed9603b, L:/192.168.86.8:53461 ! R:/8.133.246.113:8091]
2025-05-25 04:02:05.187 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - return to pool, rm channel:[id: 0x7ed9603b, L:/192.168.86.8:53461 ! R:/8.133.246.113:8091]
2025-05-25 04:02:05.187 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - channel valid false,channel:[id: 0x7ed9603b, L:/192.168.86.8:53461 ! R:/8.133.246.113:8091]
2025-05-25 04:02:05.187 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - will destroy channel:[id: 0x7ed9603b, L:/192.168.86.8:53461 ! R:/8.133.246.113:8091]
2025-05-25 04:02:05.187 [NettyClientSelector_RMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0x7ed9603b, L:/192.168.86.8:53461 ! R:/8.133.246.113:8091]) will closed
2025-05-25 04:02:05.187 [NettyClientSelector_RMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0x7ed9603b, L:/192.168.86.8:53461 ! R:/8.133.246.113:8091]) will closed
2025-05-25 04:11:10.986 [main] WARN  com.alibaba.nacos.client.logging.NacosLogging - Load Logback Configuration of Nacos fail, message: Could not initialize Logback Nacos logging from classpath:nacos-logback.xml
2025-05-25 04:11:10.988 [main] INFO  com.bgpay.bgai.BgaiApplication - The following 1 profile is active: "dev"
2025-05-25 04:11:12.337 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-05-25 04:11:12.338 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-05-25 04:11:12.361 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 16 ms. Found 0 JPA repository interfaces.
2025-05-25 04:11:12.371 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-05-25 04:11:12.372 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-05-25 04:11:12.384 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 4 ms. Found 0 Redis repository interfaces.
2025-05-25 04:11:12.903 [main] INFO  io.seata.config.ConfigurationFactory - load Configuration from :Spring Configuration
2025-05-25 04:11:12.911 [main] INFO  io.seata.config.ConfigurationFactory - load Configuration from :Spring Configuration
2025-05-25 04:11:12.918 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Initializing Global Transaction Clients ... 
2025-05-25 04:11:13.017 [main] INFO  io.seata.core.rpc.netty.NettyClientBootstrap - NettyClientBootstrap has started
2025-05-25 04:11:13.018 [main] INFO  io.seata.discovery.registry.RegistryFactory - use registry center type: file
2025-05-25 04:11:13.027 [main] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - will connect to 8.133.246.113:8091
2025-05-25 04:11:13.030 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - NettyPool create channel to transactionRole:TMROLE,address:8.133.246.113:8091,msg:< RegisterTMRequest{version='1.7.0', applicationId='bgtech-ai', transactionServiceGroup='bgai-tx-group', extraData='ak=null
digest=bgai-tx-group,192.168.86.8,1748117473029
timestamp=1748117473029
authVersion=V4
vgroup=bgai-tx-group
ip=192.168.86.8
'} >
2025-05-25 04:11:13.157 [main] INFO  io.seata.core.rpc.netty.TmNettyRemotingClient - register TM success. client version:1.7.0, server version:1.8.1-SNAPSHOT,channel:[id: 0xafc653f1, L:/192.168.86.8:55560 - R:/8.133.246.113:8091]
2025-05-25 04:11:13.163 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - register success, cost 63 ms, version:1.8.1-SNAPSHOT,role:TMROLE,channel:[id: 0xafc653f1, L:/192.168.86.8:55560 - R:/8.133.246.113:8091]
2025-05-25 04:11:13.165 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Transaction Manager Client is initialized. applicationId[bgtech-ai] txServiceGroup[bgai-tx-group]
2025-05-25 04:11:13.176 [main] INFO  io.seata.rm.datasource.AsyncWorker - Async Commit Buffer Limit: 10000
2025-05-25 04:11:13.177 [main] INFO  io.seata.rm.datasource.xa.ResourceManagerXA - ResourceManagerXA init ...
2025-05-25 04:11:13.185 [main] INFO  io.seata.core.rpc.netty.NettyClientBootstrap - NettyClientBootstrap has started
2025-05-25 04:11:13.185 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Resource Manager is initialized. applicationId[bgtech-ai] txServiceGroup[bgai-tx-group]
2025-05-25 04:11:13.185 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Global Transaction Clients are initialized. 
2025-05-25 04:11:14.337 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat initialized with port(s): 8080 (http)
2025-05-25 04:11:14.349 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - The ["http-nio-8080"] connector has been configured to support HTTP upgrade to [h2c]
2025-05-25 04:11:14.349 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - Initializing ProtocolHandler ["http-nio-8080"]
2025-05-25 04:11:14.351 [main] INFO  org.apache.catalina.core.StandardService - Starting service [Tomcat]
2025-05-25 04:11:14.352 [main] INFO  org.apache.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.15]
2025-05-25 04:11:14.778 [main] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} inited
2025-05-25 04:11:15.077 [main] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - will connect to 8.133.246.113:8091
2025-05-25 04:11:15.077 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - RM will register :jdbc:mysql://8.133.246.113:3306/deepseek
2025-05-25 04:11:15.077 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - NettyPool create channel to transactionRole:RMROLE,address:8.133.246.113:8091,msg:< RegisterRMRequest{resourceIds='jdbc:mysql://8.133.246.113:3306/deepseek', version='1.7.0', applicationId='bgtech-ai', transactionServiceGroup='bgai-tx-group', extraData='null'} >
2025-05-25 04:11:15.098 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - register RM success. client version:1.7.0, server version:1.8.1-SNAPSHOT,channel:[id: 0xd1a55c37, L:/192.168.86.8:55563 - R:/8.133.246.113:8091]
2025-05-25 04:11:15.098 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - register success, cost 12 ms, version:1.8.1-SNAPSHOT,role:RMROLE,channel:[id: 0xd1a55c37, L:/192.168.86.8:55563 - R:/8.133.246.113:8091]
2025-05-25 04:11:15.100 [main] INFO  i.s.s.a.datasource.SeataAutoDataSourceProxyCreator - Auto proxy data source 'masterDataSource' by 'AT' mode.
2025-05-25 04:11:15.177 [main] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-2} inited
2025-05-25 04:11:15.246 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - will register resourceId:jdbc:mysql://8.133.246.113:3306/deepseek
2025-05-25 04:11:15.247 [main] INFO  i.s.s.a.datasource.SeataAutoDataSourceProxyCreator - Auto proxy data source 'slaveDataSource' by 'AT' mode.
2025-05-25 04:11:15.264 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.rm.AbstractRMHandler - the rm client received response msg [RegisterRMResponse{version='1.8.1-SNAPSHOT', extraData='null', identified=true, resultCode=null, msg='null'}] from tc server.
2025-05-25 04:11:15.276 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - will register resourceId:jdbc:mysql://8.133.246.113:3306/deepseek
2025-05-25 04:11:15.276 [main] INFO  i.s.s.a.datasource.SeataAutoDataSourceProxyCreator - Auto proxy data source 'dynamicDataSource' by 'AT' mode.
2025-05-25 04:11:15.294 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.rm.AbstractRMHandler - the rm client received response msg [RegisterRMResponse{version='1.8.1-SNAPSHOT', extraData='null', identified=true, resultCode=null, msg='null'}] from tc server.
2025-05-25 04:11:15.395 [main] INFO  org.hibernate.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-05-25 04:11:15.440 [main] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.1.7.Final
2025-05-25 04:11:15.731 [main] INFO  SQL dialect - HHH000400: Using dialect: org.hibernate.dialect.MySQL8Dialect
2025-05-25 04:11:15.733 [main] WARN  org.hibernate.orm.deprecation - HHH90000026: MySQL8Dialect has been deprecated; use org.hibernate.dialect.MySQLDialect instead
2025-05-25 04:11:16.030 [main] INFO  o.h.e.t.jta.platform.internal.JtaPlatformInitiator - HHH000490: Using JtaPlatform implementation: [org.hibernate.engine.transaction.jta.platform.internal.NoJtaPlatform]
2025-05-25 04:11:16.041 [main] INFO  o.s.orm.jpa.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-05-25 04:11:16.454 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-25 04:11:16.466 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-25 04:11:16.498 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-25 04:11:16.501 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-25 04:11:16.501 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-25 04:11:16.512 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-25 04:11:17.109 [main] INFO  com.bgpay.bgai.service.impl.UserServiceImpl - 初始化SSO配置: clientId=bgai-client-id, redirectUri=http://localhost:8080/api/auth/callback
2025-05-25 04:11:17.240 [main] INFO  com.bgpay.bgai.controller.AuthController - 初始化认证控制器: clientId=bgai-client-id, redirectUri=http://localhost:8080/api/auth/callback
2025-05-25 04:11:18.188 [main] INFO  org.redisson.Version - Redisson 3.24.3
2025-05-25 04:11:18.322 [redisson-netty-4-6] INFO  o.r.connection.pool.MasterPubSubConnectionPool - 1 connections initialized for 8.133.246.113/8.133.246.113:6379
2025-05-25 04:11:18.673 [redisson-netty-4-19] INFO  org.redisson.connection.pool.MasterConnectionPool - 24 connections initialized for 8.133.246.113/8.133.246.113:6379
2025-05-25 04:11:18.846 [main] INFO  o.a.r.s.autoconfigure.RocketMQAutoConfiguration - a producer (billing-producer-group) init on namesrv 8.133.246.113:9876
2025-05-25 04:11:19.475 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Bean [com.bgpay.bgai.service.deepseek.DeepSeekServiceImp$$SpringCGLIB$$0] with name [deepSeekServiceImp] would use interceptor [io.seata.spring.annotation.GlobalTransactionalInterceptor]
2025-05-25 04:11:19.795 [main] WARN  i.s.s.b.a.provider.SpringBootConfigurationProvider - The get method not found for the field 'SeataProperties#accesskey'.
2025-05-25 04:11:19.796 [main] WARN  i.s.s.b.a.provider.SpringBootConfigurationProvider - The get method not found for the field 'SeataProperties#secretkey'.
2025-05-25 04:11:19.807 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 加载到1个Saga状态机定义文件
2025-05-25 04:11:19.950 [main] INFO  com.bgpay.bgai.saga.CustomSagaJsonParser - 开始解析状态机定义: bgai-saga-transaction
2025-05-25 04:11:19.950 [main] INFO  com.bgpay.bgai.saga.CustomSagaJsonParser - 状态机定义解析成功: bgai-saga-transaction
2025-05-25 04:11:19.950 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 成功加载状态机定义: /E:/project/bgai/target/classes/statelang/bgai-saga-transaction.json
2025-05-25 04:11:20.089 [main] INFO  com.bgpay.bgai.service.mq.MQConsumerService - MQ consumer startup successful [group=billing-consumer-group, topic=BILLING_TOPIC, tag=USER_BILLING]
2025-05-25 04:11:20.235 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Bean [com.bgpay.bgai.service.mq.BillingTransactionListenerImpl$$SpringCGLIB$$0] with name [billingTransactionListenerImpl] would use interceptor [io.seata.spring.annotation.GlobalTransactionalInterceptor]
2025-05-25 04:11:20.377 [main] DEBUG com.bgpay.bgai.config.AsyncConfig$1 - Initializing ExecutorService 'blockingExecutor'
2025-05-25 04:11:20.402 [main] INFO  c.b.bgai.config.NacosConfig$NacosWarningHandler - Nacos警告处理器已启用，将忽略配置中心连接警告
2025-05-25 04:11:21.549 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [After]
2025-05-25 04:11:21.549 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Before]
2025-05-25 04:11:21.549 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Between]
2025-05-25 04:11:21.550 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Cookie]
2025-05-25 04:11:21.550 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Header]
2025-05-25 04:11:21.550 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Host]
2025-05-25 04:11:21.550 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Method]
2025-05-25 04:11:21.550 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Path]
2025-05-25 04:11:21.550 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Query]
2025-05-25 04:11:21.550 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [ReadBody]
2025-05-25 04:11:21.550 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [RemoteAddr]
2025-05-25 04:11:21.550 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [XForwardedRemoteAddr]
2025-05-25 04:11:21.550 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Weight]
2025-05-25 04:11:21.550 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [CloudFoundryRouteService]
2025-05-25 04:11:22.960 [main] INFO  o.s.b.actuate.endpoint.web.EndpointLinksResolver - Exposing 3 endpoint(s) beneath base path '/actuator'
2025-05-25 04:11:24.500 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - Starting ProtocolHandler ["http-nio-8080"]
2025-05-25 04:11:24.513 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat started on port(s): 8080 (http) with context path ''
2025-05-25 04:11:24.523 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from ans.namespace attribute : null
2025-05-25 04:11:24.524 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from ALIBABA_ALIWARE_NAMESPACE attribute :null
2025-05-25 04:11:24.524 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from namespace attribute :null
2025-05-25 04:11:24.533 [main] INFO  c.a.n.p.auth.spi.client.ClientAuthPluginManager - [ClientAuthPluginManager] Load ClientAuthService com.alibaba.nacos.client.auth.impl.NacosClientAuthServiceImpl success.
2025-05-25 04:11:24.534 [main] INFO  c.a.n.p.auth.spi.client.ClientAuthPluginManager - [ClientAuthPluginManager] Load ClientAuthService com.alibaba.nacos.client.auth.ram.RamClientAuthServiceImpl success.
2025-05-25 04:11:24.537 [main] INFO  com.alibaba.nacos.common.remote.client - [RpcClientFactory] create a new rpc client of 76b2efa5-f54b-4a28-b365-1cf4070f8c8b
2025-05-25 04:11:24.539 [main] INFO  com.alibaba.nacos.common.remote.client - [76b2efa5-f54b-4a28-b365-1cf4070f8c8b] RpcClient init, ServerListFactory = com.alibaba.nacos.client.naming.core.ServerListManager
2025-05-25 04:11:24.539 [main] INFO  com.alibaba.nacos.common.remote.client - [76b2efa5-f54b-4a28-b365-1cf4070f8c8b] Registry connection listener to current client:com.alibaba.nacos.client.naming.remote.gprc.redo.NamingGrpcRedoService
2025-05-25 04:11:24.540 [main] INFO  com.alibaba.nacos.common.remote.client - [76b2efa5-f54b-4a28-b365-1cf4070f8c8b] Register server push request handler:com.alibaba.nacos.client.naming.remote.gprc.NamingPushRequestHandler
2025-05-25 04:11:24.541 [main] INFO  com.alibaba.nacos.common.remote.client - [76b2efa5-f54b-4a28-b365-1cf4070f8c8b] Try to connect to server on start up, server: {serverIp = '8.133.246.113', server main port = 8848}
2025-05-25 04:11:24.542 [main] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - grpc client connection server:8.133.246.113 ip,serverPort:9848,grpcTslConfig:{"sslProvider":"OPENSSL","enableTls":false,"mutualAuthEnable":false,"trustAll":false}
2025-05-25 04:11:24.686 [main] INFO  com.alibaba.nacos.common.remote.client - [76b2efa5-f54b-4a28-b365-1cf4070f8c8b] Success to connect to server [8.133.246.113:8848] on start up, connectionId = 1748117484602_139.227.195.192_49904
2025-05-25 04:11:24.686 [main] INFO  com.alibaba.nacos.common.remote.client - [76b2efa5-f54b-4a28-b365-1cf4070f8c8b] Register server push request handler:com.alibaba.nacos.common.remote.client.RpcClient$ConnectResetRequestHandler
2025-05-25 04:11:24.686 [com.alibaba.nacos.client.remote.worker] INFO  com.alibaba.nacos.common.remote.client - [76b2efa5-f54b-4a28-b365-1cf4070f8c8b] Notify connected event to listeners.
2025-05-25 04:11:24.686 [main] INFO  com.alibaba.nacos.common.remote.client - [76b2efa5-f54b-4a28-b365-1cf4070f8c8b] Register server push request handler:com.alibaba.nacos.common.remote.client.RpcClient$$Lambda/0x000002c1b352a508
2025-05-25 04:11:24.686 [com.alibaba.nacos.client.remote.worker] INFO  com.alibaba.nacos.client.naming - Grpc connection connect
2025-05-25 04:11:24.687 [main] INFO  com.alibaba.nacos.client.naming - [REGISTER-SERVICE] d750d92e-152f-4055-a641-3bc9dda85a29 registering service bgtech-ai with instance Instance{instanceId='null', ip='192.168.86.8', port=8080, weight=1.0, healthy=true, enabled=true, ephemeral=true, clusterName='DEFAULT', serviceName='null', metadata={IPv6=[2408:820c:7528:d042:c185:8edc:f30d:3d91], preserved.register.source=SPRING_CLOUD}}
2025-05-25 04:11:24.704 [main] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - nacos registry, DEFAULT_GROUP bgtech-ai 192.168.86.8:8080 register finished
2025-05-25 04:11:24.760 [main] INFO  com.bgpay.bgai.config.NacosConfig - 应用启动完成，当前环境: dev
2025-05-25 04:11:24.760 [main] INFO  com.bgpay.bgai.config.NacosConfig - Nacos配置中心: 8.133.246.113:8848, 命名空间: d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-25 04:11:24.760 [main] INFO  com.bgpay.bgai.config.NacosConfig - 注意: 如果看到Nacos配置加载警告，但应用正常启动，说明应用正在使用本地配置文件
2025-05-25 04:11:24.762 [main] INFO  com.bgpay.bgai.BgaiApplication - Started BgaiApplication in 15.959 seconds (process running for 17.268)
2025-05-25 04:11:24.764 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-25 04:11:24.765 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-25 04:11:24.784 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-25 04:11:24.785 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-25 04:11:24.785 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-25 04:11:24.796 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-25 04:11:24.797 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-25 04:11:24.797 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-25 04:11:24.819 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-25 04:11:24.819 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-25 04:11:24.820 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-25 04:11:24.828 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-25 04:11:24.828 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - ==================== Saga状态机加载报告 ====================
2025-05-25 04:11:24.828 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - Saga状态机配置加载状态: 成功
2025-05-25 04:11:24.829 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 已加载的状态机定义文件数量: 1
2025-05-25 04:11:24.829 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 已加载的状态机定义文件:
2025-05-25 04:11:24.829 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig -  - /E:/project/bgai/target/classes/statelang/bgai-saga-transaction.json
2025-05-25 04:11:24.829 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - Saga解析器状态: CUSTOM_FASTJSON2
2025-05-25 04:11:24.829 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 状态机解析结果: 成功 1 个, 失败 0 个
2025-05-25 04:11:24.829 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - =============================================================
2025-05-25 04:11:24.833 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - nacos.cache.data.init.snapshot = true 
2025-05-25 04:11:24.834 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] common-dev.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-25 04:11:24.842 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=common-dev.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-25 04:11:24.842 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=common-dev.yaml, group=DEFAULT_GROUP
2025-05-25 04:11:24.842 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-25 04:11:24.842 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-25 04:11:24.842 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai.yaml, group=DEFAULT_GROUP
2025-05-25 04:11:24.843 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai-dev.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-25 04:11:24.844 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai-dev.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-25 04:11:24.844 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai-dev.yaml, group=DEFAULT_GROUP
2025-05-25 04:11:24.844 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-25 04:11:24.844 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai, group=DEFAULT_GROUP, cnt=1
2025-05-25 04:11:24.844 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai, group=DEFAULT_GROUP
2025-05-25 04:11:29.380 [http-nio-8080-exec-5] INFO  com.bgpay.bgai.controller.ReactiveChatController - 接收到请求: /api/chatGatWay-internal, 文件=新文件 17.txt, 问题参数=null, 模型参数=null
2025-05-25 04:11:29.382 [http-nio-8080-exec-5] INFO  com.bgpay.bgai.controller.ReactiveChatController - 请求Content-Type: multipart/form-data;boundary=--------------------------215351272810879920300482
2025-05-25 04:11:29.384 [http-nio-8080-exec-5] INFO  com.bgpay.bgai.controller.ReactiveChatController - 收集到的完整参数: question="null", apiUrl="null", modelName="null", multiTurn=false
2025-05-25 04:11:29.385 [http-nio-8080-exec-5] INFO  com.bgpay.bgai.controller.ReactiveChatController - Processing request for user ID: 689258T
2025-05-25 04:11:29.386 [http-nio-8080-exec-5] INFO  com.bgpay.bgai.controller.ReactiveChatController - Processing file with circuit breaker: fileName=新文件 17.txt, question=
2025-05-25 04:11:29.388 [http-nio-8080-exec-5] INFO  com.bgpay.bgai.config.ReactiveFileProcessor - Processing file: 新文件 17.txt, content-type: text/plain
2025-05-25 04:11:29.397 [http-nio-8080-exec-5] INFO  com.bgpay.bgai.controller.ReactiveChatController - PARAM TRACE [689258T]: 尝试查找匹配配置 - 参数: apiUrl=null, modelName=null
2025-05-25 04:11:29.409 [http-nio-8080-exec-5] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 查询配置 - userId=689258T
2025-05-25 04:11:29.410 [http-nio-8080-exec-5] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 排序方式 - 按ID降序
2025-05-25 04:11:29.410 [http-nio-8080-exec-5] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 限制结果数 - LIMIT 1
2025-05-25 04:11:29.476 [http-nio-8080-exec-5] DEBUG com.bgpay.bgai.mapper.ApiConfigMapper.selectList - ==>  Preparing: SELECT id,api_url,api_key,model_name,user_id FROM api_config WHERE (user_id = ?) ORDER BY id DESC LIMIT 1
2025-05-25 04:11:29.478 [http-nio-8080-exec-5] DEBUG com.bgpay.bgai.mapper.ApiConfigMapper.selectList - ==> Parameters: 689258T(String)
2025-05-25 04:11:29.489 [http-nio-8080-exec-5] DEBUG com.bgpay.bgai.mapper.ApiConfigMapper.selectList - <==      Total: 1
2025-05-25 04:11:29.489 [http-nio-8080-exec-5] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 查询结果 - 找到配置: id=2, modelName=deepseek-chat
2025-05-25 04:11:29.489 [http-nio-8080-exec-5] INFO  com.bgpay.bgai.controller.ReactiveChatController - PARAM TRACE [689258T]: 找到匹配配置 - apiUrl=https://api.deepseek.com/chat/completions, modelName=deepseek-chat (原始请求: null)
2025-05-25 04:11:29.489 [http-nio-8080-exec-5] INFO  com.bgpay.bgai.controller.ReactiveChatController - API config resolved: url=https://api.deepseek.com/chat/completions, model=deepseek-chat
2025-05-25 04:11:29.509 [Thread-48] INFO  com.bgpay.bgai.config.ReactiveFileProcessor - File processed successfully: size=37 bytes
2025-05-25 04:11:29.516 [Thread-48] INFO  com.bgpay.bgai.controller.ReactiveChatController - Content processed, length: 54
2025-05-25 04:11:29.524 [Thread-48] INFO  io.seata.tm.TransactionManagerHolder - TransactionManager Singleton io.seata.tm.DefaultTransactionManager@1fd3bd02
2025-05-25 04:11:29.541 [Thread-48] INFO  io.seata.tm.api.DefaultGlobalTransaction - Begin new global transaction [seata-server:8091:117747646027194379]
2025-05-25 04:11:29.544 [Thread-48] INFO  c.b.bgai.interceptor.SeataTransactionInterceptor - 准备记录分布式事务开始: XID=seata-server:8091:117747646027194379, 业务=com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive, 路径=, IP=, 用户=system
2025-05-25 04:11:29.569 [Thread-48] INFO  c.b.bgai.service.impl.TransactionLogServiceImpl - 记录分布式事务开始: XID=seata-server:8091:117747646027194379, 业务=com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive
2025-05-25 04:11:29.576 [Thread-48] DEBUG com.bgpay.bgai.mapper.TransactionLogMapper.insert - ==>  Preparing: INSERT INTO transaction_log ( xid, transaction_name, transaction_mode, status, request_path, source_ip, start_time, user_id, create_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-05-25 04:11:29.581 [Thread-48] DEBUG com.bgpay.bgai.mapper.TransactionLogMapper.insert - ==> Parameters: seata-server:8091:117747646027194379(String), com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive(String), AT(String), ACTIVE(String), (String), (String), 2025-05-25T04:11:29.570832400(LocalDateTime), system(String), 2025-05-25T04:11:29.570832400(LocalDateTime)
2025-05-25 04:11:30.007 [Thread-48] DEBUG com.bgpay.bgai.mapper.TransactionLogMapper.insert - <==    Updates: 1
2025-05-25 04:11:30.026 [Thread-48] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:117747646027194379, branchId:117747646027194380, lockKeys:transaction_log:55
2025-05-25 04:11:30.037 [Thread-48] WARN  i.s.c.l.EnhancedServiceLoader$InnerEnhancedServiceLoader - Load [io.seata.rm.datasource.undo.parser.ProtostuffUndoLogParser] class fail: io/protostuff/runtime/IdStrategy
2025-05-25 04:11:30.111 [Thread-48] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:117747646027194379, branchId:117747646027194381, lockKeys:undo_log:227;transaction_log:55
2025-05-25 04:11:30.143 [Thread-48] INFO  c.b.bgai.interceptor.SeataTransactionInterceptor - 开始分布式事务: XID=seata-server:8091:117747646027194379, 方法=com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive
2025-05-25 04:11:30.153 [Thread-48] INFO  org.reflections.Reflections - Processing reactive request: content length=54, apiUrl=https://api.deepseek.com/chat/completions, modelName=deepseek-chat, userId=689258T, multiTurn=false
2025-05-25 04:11:30.161 [Thread-48] INFO  c.b.bgai.service.impl.TransactionLogServiceImpl - 记录分布式事务结束: XID=seata-server:8091:117747646027194379, 状态=COMMITTED
2025-05-25 04:11:30.162 [Thread-48] DEBUG c.b.bgai.mapper.TransactionLogMapper.selectList - ==>  Preparing: SELECT id,xid,branch_id,transaction_name,transaction_mode,status,request_path,source_ip,start_time,end_time,user_id,extra_data,create_time,update_time FROM transaction_log WHERE (xid = ?) LIMIT 1
2025-05-25 04:11:30.164 [Thread-48] DEBUG c.b.bgai.mapper.TransactionLogMapper.selectList - ==> Parameters: seata-server:8091:117747646027194379(String)
2025-05-25 04:11:30.173 [Thread-48] DEBUG c.b.bgai.mapper.TransactionLogMapper.selectList - <==      Total: 1
2025-05-25 04:11:30.177 [Thread-48] DEBUG c.b.bgai.mapper.TransactionLogMapper.updateById - ==>  Preparing: UPDATE transaction_log SET xid=?, transaction_name=?, transaction_mode=?, status=?, request_path=?, source_ip=?, start_time=?, end_time=?, user_id=?, extra_data=?, create_time=?, update_time=? WHERE id=?
2025-05-25 04:11:30.183 [Thread-48] DEBUG c.b.bgai.mapper.TransactionLogMapper.updateById - ==> Parameters: seata-server:8091:117747646027194379(String), com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive(String), AT(String), COMMITTED(String), (String), (String), 2025-05-25T04:11:30(LocalDateTime), 2025-05-25T04:11:30.173739100(LocalDateTime), system(String), {"duration":12,"result":"success"}(String), 2025-05-25T04:11:30(LocalDateTime), 2025-05-25T04:11:30.173739100(LocalDateTime), 55(Long)
2025-05-25 04:11:30.244 [Thread-48] DEBUG c.b.bgai.mapper.TransactionLogMapper.updateById - <==    Updates: 1
2025-05-25 04:11:30.255 [Thread-48] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:117747646027194379, branchId:117747646027194382, lockKeys:transaction_log:55
2025-05-25 04:11:30.286 [Thread-48] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:117747646027194379, branchId:117747646027194383, lockKeys:undo_log:229;transaction_log:55
2025-05-25 04:11:30.314 [Thread-48] INFO  c.b.bgai.interceptor.SeataTransactionInterceptor - 分布式事务成功完成: XID=seata-server:8091:117747646027194379, 耗时=12ms
2025-05-25 04:11:30.315 [Thread-48] INFO  io.seata.tm.api.DefaultGlobalTransaction - transaction seata-server:8091:117747646027194379 will be commit
2025-05-25 04:11:30.332 [Thread-48] INFO  io.seata.tm.api.DefaultGlobalTransaction - transaction end, xid = seata-server:8091:117747646027194379
2025-05-25 04:11:30.332 [Thread-48] INFO  io.seata.tm.api.DefaultGlobalTransaction - [seata-server:8091:117747646027194379] commit status: Committed
2025-05-25 04:11:30.339 [rpcDispatch_RMROLE_1_1_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:117747646027194379', branchId=117747646027194380, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false,"skipCheckLock":true}'}
2025-05-25 04:11:30.340 [rpcDispatch_RMROLE_1_1_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:117747646027194379 117747646027194380 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false,"skipCheckLock":true}
2025-05-25 04:11:30.341 [rpcDispatch_RMROLE_1_1_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-25 04:11:30.354 [rpcDispatch_RMROLE_1_2_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:117747646027194379', branchId=117747646027194381, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false,"skipCheckLock":true}'}
2025-05-25 04:11:30.354 [rpcDispatch_RMROLE_1_2_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:117747646027194379 117747646027194381 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false,"skipCheckLock":true}
2025-05-25 04:11:30.354 [rpcDispatch_RMROLE_1_2_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-25 04:11:30.363 [rpcDispatch_RMROLE_1_3_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:117747646027194379', branchId=117747646027194382, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false}'}
2025-05-25 04:11:30.363 [rpcDispatch_RMROLE_1_3_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:117747646027194379 117747646027194382 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false}
2025-05-25 04:11:30.363 [rpcDispatch_RMROLE_1_3_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-25 04:11:30.373 [rpcDispatch_RMROLE_1_4_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:117747646027194379', branchId=117747646027194383, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false}'}
2025-05-25 04:11:30.373 [rpcDispatch_RMROLE_1_4_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:117747646027194379 117747646027194383 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false}
2025-05-25 04:11:30.374 [rpcDispatch_RMROLE_1_4_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-25 04:11:30.382 [boundedElastic-1] WARN  com.bgpay.bgai.transaction.TransactionCoordinator - Found existing transaction for user 689258T: chat-d25aba81-3422-4521-9e4e-2bf181f7bab0
2025-05-25 04:11:30.382 [boundedElastic-1] INFO  org.reflections.Reflections - Transaction prepared with chatCompletionId: chat-d25aba81-3422-4521-9e4e-2bf181f7bab0
2025-05-25 04:12:05.050 [FileWrite-1] INFO  com.bgpay.bgai.service.deepseek.FileWriterService - Successfully wrote content to: \var\data\ai_responses\92c4ad39-afb2-4c8a-b10b-823f8993bb01.txt
2025-05-25 04:12:05.066 [reactor-http-nio-2] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - ==>  Preparing: INSERT INTO chat_completions ( object, created, model, system_fingerprint, api_key ) VALUES ( ?, ?, ?, ?, ? )
2025-05-25 04:12:05.066 [reactor-http-nio-2] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - ==> Parameters: chat.completion(String), 1748117525064(Long), deepseek-chat(String), 689258T(String), chat-d25aba81-3422-4521-9e4e-2bf181f7bab0(String)
2025-05-25 04:12:05.082 [reactor-http-nio-2] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - <==    Updates: 1
2025-05-25 04:12:05.083 [reactor-http-nio-2] INFO  com.bgpay.bgai.transaction.TransactionCoordinator - Transaction committed for user 689258T: chatCompletionId=chat-d25aba81-3422-4521-9e4e-2bf181f7bab0
2025-05-25 04:12:05.100 [reactor-http-nio-2] INFO  org.reflections.Reflections - 开始发送账单消息，chatCompletionId: chat-d25aba81-3422-4521-9e4e-2bf181f7bab0, userId: 689258T
2025-05-25 04:12:05.157 [reactor-http-nio-2] INFO  io.seata.tm.api.DefaultGlobalTransaction - Begin new global transaction [seata-server:8091:117747646027194384]
2025-05-25 04:12:05.158 [reactor-http-nio-2] INFO  c.b.bgai.interceptor.SeataTransactionInterceptor - 准备记录分布式事务开始: XID=seata-server:8091:117747646027194384, 业务=com.bgpay.bgai.service.mq.BillingTransactionListenerImpl.executeLocalTransaction, 路径=, IP=, 用户=system
2025-05-25 04:12:05.165 [reactor-http-nio-2] INFO  c.b.bgai.service.impl.TransactionLogServiceImpl - 记录分布式事务开始: XID=seata-server:8091:117747646027194384, 业务=com.bgpay.bgai.service.mq.BillingTransactionListenerImpl.executeLocalTransaction
2025-05-25 04:12:05.166 [reactor-http-nio-2] DEBUG com.bgpay.bgai.mapper.TransactionLogMapper.insert - ==>  Preparing: INSERT INTO transaction_log ( xid, transaction_name, transaction_mode, status, request_path, source_ip, start_time, user_id, create_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-05-25 04:12:05.167 [reactor-http-nio-2] DEBUG com.bgpay.bgai.mapper.TransactionLogMapper.insert - ==> Parameters: seata-server:8091:117747646027194384(String), com.bgpay.bgai.service.mq.BillingTransactionListenerImpl.executeLocalTransaction(String), AT(String), ACTIVE(String), (String), (String), 2025-05-25T04:12:05.165203(LocalDateTime), system(String), 2025-05-25T04:12:05.165203(LocalDateTime)
2025-05-25 04:12:05.201 [reactor-http-nio-2] DEBUG com.bgpay.bgai.mapper.TransactionLogMapper.insert - <==    Updates: 1
2025-05-25 04:12:05.213 [reactor-http-nio-2] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:117747646027194384, branchId:117747646027194385, lockKeys:transaction_log:56
2025-05-25 04:12:05.248 [reactor-http-nio-2] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:117747646027194384, branchId:117747646027194386, lockKeys:transaction_log:56;undo_log:231
2025-05-25 04:12:05.282 [reactor-http-nio-2] INFO  c.b.bgai.interceptor.SeataTransactionInterceptor - 开始分布式事务: XID=seata-server:8091:117747646027194384, 方法=com.bgpay.bgai.service.mq.BillingTransactionListenerImpl.executeLocalTransaction
2025-05-25 04:12:05.283 [reactor-http-nio-2] INFO  c.b.bgai.service.mq.BillingTransactionListenerImpl - 开始执行本地事务, xid: seata-server:8091:117747646027194384, userId: 689258T, completionId: chat-d25aba81-3422-4521-9e4e-2bf181f7bab0
2025-05-25 04:12:05.303 [reactor-http-nio-2] INFO  c.b.bgai.service.mq.BillingTransactionListenerImpl - 消息已处理，提交事务, completionId: chat-d25aba81-3422-4521-9e4e-2bf181f7bab0
2025-05-25 04:12:05.317 [reactor-http-nio-2] INFO  c.b.bgai.service.impl.TransactionLogServiceImpl - 记录分布式事务结束: XID=seata-server:8091:117747646027194384, 状态=COMMITTED
2025-05-25 04:12:05.318 [reactor-http-nio-2] DEBUG c.b.bgai.mapper.TransactionLogMapper.selectList - ==>  Preparing: SELECT id,xid,branch_id,transaction_name,transaction_mode,status,request_path,source_ip,start_time,end_time,user_id,extra_data,create_time,update_time FROM transaction_log WHERE (xid = ?) LIMIT 1
2025-05-25 04:12:05.319 [reactor-http-nio-2] DEBUG c.b.bgai.mapper.TransactionLogMapper.selectList - ==> Parameters: seata-server:8091:117747646027194384(String)
2025-05-25 04:12:05.325 [reactor-http-nio-2] DEBUG c.b.bgai.mapper.TransactionLogMapper.selectList - <==      Total: 1
2025-05-25 04:12:05.326 [reactor-http-nio-2] DEBUG c.b.bgai.mapper.TransactionLogMapper.updateById - ==>  Preparing: UPDATE transaction_log SET xid=?, transaction_name=?, transaction_mode=?, status=?, request_path=?, source_ip=?, start_time=?, end_time=?, user_id=?, extra_data=?, create_time=?, update_time=? WHERE id=?
2025-05-25 04:12:05.326 [reactor-http-nio-2] DEBUG c.b.bgai.mapper.TransactionLogMapper.updateById - ==> Parameters: seata-server:8091:117747646027194384(String), com.bgpay.bgai.service.mq.BillingTransactionListenerImpl.executeLocalTransaction(String), AT(String), COMMITTED(String), (String), (String), 2025-05-25T04:12:05(LocalDateTime), 2025-05-25T04:12:05.325202800(LocalDateTime), system(String), {"duration":21,"result":"success"}(String), 2025-05-25T04:12:05(LocalDateTime), 2025-05-25T04:12:05.325202800(LocalDateTime), 56(Long)
2025-05-25 04:12:05.390 [reactor-http-nio-2] DEBUG c.b.bgai.mapper.TransactionLogMapper.updateById - <==    Updates: 1
2025-05-25 04:12:05.401 [reactor-http-nio-2] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:117747646027194384, branchId:117747646027194387, lockKeys:transaction_log:56
2025-05-25 04:12:05.439 [reactor-http-nio-2] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:117747646027194384, branchId:117747646027194388, lockKeys:transaction_log:56;undo_log:233
2025-05-25 04:12:05.502 [reactor-http-nio-2] INFO  c.b.bgai.interceptor.SeataTransactionInterceptor - 分布式事务成功完成: XID=seata-server:8091:117747646027194384, 耗时=21ms
2025-05-25 04:12:05.502 [reactor-http-nio-2] INFO  io.seata.tm.api.DefaultGlobalTransaction - transaction seata-server:8091:117747646027194384 will be commit
2025-05-25 04:12:05.517 [reactor-http-nio-2] INFO  io.seata.tm.api.DefaultGlobalTransaction - transaction end, xid = seata-server:8091:117747646027194384
2025-05-25 04:12:05.517 [reactor-http-nio-2] INFO  io.seata.tm.api.DefaultGlobalTransaction - [seata-server:8091:117747646027194384] commit status: Committed
2025-05-25 04:12:05.520 [reactor-http-nio-2] INFO  org.reflections.Reflections - 账单消息发送成功，chatCompletionId: chat-d25aba81-3422-4521-9e4e-2bf181f7bab0, userId: 689258T
2025-05-25 04:12:05.528 [reactor-http-nio-2] INFO  com.bgpay.bgai.service.impl.BGAIServiceImpl - 执行第一步操作 - 发送账单消息, businessKey: 689258T:chat-d25aba81-3422-4521-9e4e-2bf181f7bab0
2025-05-25 04:12:05.530 [reactor-http-nio-2] DEBUG c.bgpay.bgai.mapper.UsageRecordMapper.selectCount - ==>  Preparing: SELECT COUNT( * ) AS total FROM usage_record WHERE (chat_completion_id = ?)
2025-05-25 04:12:05.531 [reactor-http-nio-2] DEBUG c.bgpay.bgai.mapper.UsageRecordMapper.selectCount - ==> Parameters: chat-d25aba81-3422-4521-9e4e-2bf181f7bab0(String)
2025-05-25 04:12:05.547 [reactor-http-nio-2] DEBUG c.bgpay.bgai.mapper.UsageRecordMapper.selectCount - <==      Total: 1
2025-05-25 04:12:05.547 [reactor-http-nio-2] INFO  com.bgpay.bgai.service.impl.BGAIServiceImpl - 账单消息已处理，跳过发送, completionId: chat-d25aba81-3422-4521-9e4e-2bf181f7bab0
2025-05-25 04:12:05.570 [reactor-http-nio-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - Processed response for user 689258T, content length: 2888
2025-05-25 04:12:05.796 [ConsumeMessageThread_billing-consumer-group_1] INFO  c.bgpay.bgai.service.mq.RocketMQBillingServiceImpl - Output price config priceVersion: 1
2025-05-25 04:12:05.810 [ConsumeMessageThread_billing-consumer-group_1] DEBUG com.bgpay.bgai.mapper.UsageRecordMapper.insert - ==>  Preparing: INSERT INTO usage_record ( model_type, chat_completion_id, user_id, input_cost, output_cost, price_version, calculated_at, status, created_at ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-05-25 04:12:05.812 [ConsumeMessageThread_billing-consumer-group_1] DEBUG com.bgpay.bgai.mapper.UsageRecordMapper.insert - ==> Parameters: deepseek-chat(String), chat-d25aba81-3422-4521-9e4e-2bf181f7bab0(String), 689258T(String), 0.0001(BigDecimal), 0.0066(BigDecimal), 1(Integer), 2025-05-25T04:12:05.758376300(LocalDateTime), PENDING(String), 2025-05-25T04:12:05.758376300(LocalDateTime)
2025-05-25 04:12:05.836 [ConsumeMessageThread_billing-consumer-group_1] DEBUG com.bgpay.bgai.mapper.UsageRecordMapper.insert - <==    Updates: 1
2025-05-25 04:12:05.879 [ConsumeMessageThread_billing-consumer-group_1] INFO  c.bgpay.bgai.service.mq.RocketMQBillingServiceImpl - Message consumed: 2408820C7528D042C1858EDCF30D3D91133C36BAF30C7C7F6A860000
2025-05-25 04:12:06.338 [rpcDispatch_RMROLE_1_5_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:117747646027194384', branchId=117747646027194385, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false,"skipCheckLock":true}'}
2025-05-25 04:12:06.338 [rpcDispatch_RMROLE_1_5_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:117747646027194384 117747646027194385 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false,"skipCheckLock":true}
2025-05-25 04:12:06.338 [rpcDispatch_RMROLE_1_5_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-25 04:12:06.348 [rpcDispatch_RMROLE_1_6_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:117747646027194384', branchId=117747646027194386, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false,"skipCheckLock":true}'}
2025-05-25 04:12:06.348 [rpcDispatch_RMROLE_1_6_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:117747646027194384 117747646027194386 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false,"skipCheckLock":true}
2025-05-25 04:12:06.348 [rpcDispatch_RMROLE_1_6_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-25 04:12:06.357 [rpcDispatch_RMROLE_1_7_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:117747646027194384', branchId=117747646027194387, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false}'}
2025-05-25 04:12:06.357 [rpcDispatch_RMROLE_1_7_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:117747646027194384 117747646027194387 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false}
2025-05-25 04:12:06.357 [rpcDispatch_RMROLE_1_7_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-25 04:12:06.366 [rpcDispatch_RMROLE_1_8_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:117747646027194384', branchId=117747646027194388, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false}'}
2025-05-25 04:12:06.366 [rpcDispatch_RMROLE_1_8_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:117747646027194384 117747646027194388 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false}
2025-05-25 04:12:06.366 [rpcDispatch_RMROLE_1_8_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-25 04:12:55.127 [Thread-7] WARN  com.alibaba.nacos.common.notify.NotifyCenter - [NotifyCenter] Start destroying Publisher
2025-05-25 04:12:55.127 [Thread-1] WARN  c.alibaba.nacos.common.http.HttpClientBeanHolder - [HttpClientBeanHolder] Start destroying common HttpClient
2025-05-25 04:12:55.127 [Thread-7] WARN  com.alibaba.nacos.common.notify.NotifyCenter - [NotifyCenter] Destruction of the end
2025-05-25 04:12:55.128 [Thread-1] WARN  c.alibaba.nacos.common.http.HttpClientBeanHolder - [HttpClientBeanHolder] Destruction of the end
2025-05-25 04:12:55.147 [SpringContextShutdownHook] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - De-registering from Nacos Server now...
2025-05-25 04:12:55.147 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - [DEREGISTER-SERVICE] d750d92e-152f-4055-a641-3bc9dda85a29 deregistering service bgtech-ai with instance: Instance{instanceId='null', ip='192.168.86.8', port=8080, weight=1.0, healthy=true, enabled=true, ephemeral=true, clusterName='DEFAULT', serviceName='null', metadata={}}
2025-05-25 04:12:55.157 [SpringContextShutdownHook] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - De-registration finished.
2025-05-25 04:12:55.158 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.cache.ServiceInfoHolder do shutdown begin
2025-05-25 04:12:55.158 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.backups.FailoverReactor do shutdown begin
2025-05-25 04:12:55.158 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.backups.FailoverReactor do shutdown stop
2025-05-25 04:12:55.158 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.cache.ServiceInfoHolder do shutdown stop
2025-05-25 04:12:55.158 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.NamingClientProxyDelegate do shutdown begin
2025-05-25 04:12:55.158 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServiceInfoUpdateService do shutdown begin
2025-05-25 04:12:55.158 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServiceInfoUpdateService do shutdown stop
2025-05-25 04:12:55.158 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServerListManager do shutdown begin
2025-05-25 04:12:55.158 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Start destroying NacosRestTemplate
2025-05-25 04:12:55.158 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Destruction of the end
2025-05-25 04:12:55.158 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServerListManager do shutdown stop
2025-05-25 04:12:55.158 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.http.NamingHttpClientProxy do shutdown begin
2025-05-25 04:12:55.158 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Start destroying NacosRestTemplate
2025-05-25 04:12:55.158 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Destruction of the end
2025-05-25 04:12:55.158 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.http.NamingHttpClientProxy do shutdown stop
2025-05-25 04:12:55.158 [SpringContextShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Shutdown rpc client, set status to shutdown
2025-05-25 04:12:55.158 [SpringContextShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Shutdown client event executor java.util.concurrent.ScheduledThreadPoolExecutor@50a3ccfa[Running, pool size = 2, active threads = 2, queued tasks = 0, completed tasks = 0]
2025-05-25 04:12:55.159 [SpringContextShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Close current connection 1748117484602_139.227.195.192_49904
2025-05-25 04:12:55.161 [nacos-grpc-client-executor-8.133.246.113-26] WARN  c.a.nacos.common.remote.client.grpc.GrpcClient - [1748117484602_139.227.195.192_49904]Ignore error event,isRunning:false,isAbandon=false
2025-05-25 04:12:55.163 [SpringContextShutdownHook] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - Shutdown grpc executor java.util.concurrent.ThreadPoolExecutor@1e79c8b9[Running, pool size = 4, active threads = 0, queued tasks = 0, completed tasks = 27]
2025-05-25 04:12:55.163 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - Shutdown grpc redo service executor java.util.concurrent.ScheduledThreadPoolExecutor@45761ad8[Running, pool size = 1, active threads = 0, queued tasks = 1, completed tasks = 30]
2025-05-25 04:12:55.163 [SpringContextShutdownHook] INFO  c.a.n.client.auth.ram.identify.CredentialWatcher - [null] CredentialWatcher is stopped
2025-05-25 04:12:55.163 [SpringContextShutdownHook] INFO  c.a.n.client.auth.ram.identify.CredentialService - [null] CredentialService is freed
2025-05-25 04:12:55.163 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.NamingClientProxyDelegate do shutdown stop
2025-05-25 04:12:55.169 [SpringContextShutdownHook] DEBUG com.bgpay.bgai.config.AsyncConfig$1 - Shutting down ExecutorService 'blockingExecutor'
2025-05-25 04:12:57.215 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:10911] result: true
2025-05-25 04:12:57.216 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:9876] result: true
2025-05-25 04:12:57.231 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:10911] result: true
2025-05-25 04:12:57.231 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:9876] result: true
2025-05-25 04:12:57.360 [SpringContextShutdownHook] INFO  o.s.orm.jpa.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-05-25 04:12:57.362 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-2} closing ...
2025-05-25 04:12:57.367 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-2} closed
2025-05-25 04:12:57.367 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} closing ...
2025-05-25 04:12:57.368 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} closed
2025-05-25 04:12:57.368 [NettyClientSelector_TMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - channel inactive: [id: 0xafc653f1, L:/192.168.86.8:55560 ! R:/8.133.246.113:8091]
2025-05-25 04:12:57.368 [NettyClientSelector_TMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - return to pool, rm channel:[id: 0xafc653f1, L:/192.168.86.8:55560 ! R:/8.133.246.113:8091]
2025-05-25 04:12:57.368 [NettyClientSelector_TMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - channel valid false,channel:[id: 0xafc653f1, L:/192.168.86.8:55560 ! R:/8.133.246.113:8091]
2025-05-25 04:12:57.368 [NettyClientSelector_TMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - will destroy channel:[id: 0xafc653f1, L:/192.168.86.8:55560 ! R:/8.133.246.113:8091]
2025-05-25 04:12:57.368 [NettyClientSelector_TMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0xafc653f1, L:/192.168.86.8:55560 ! R:/8.133.246.113:8091]) will closed
2025-05-25 04:12:57.368 [NettyClientSelector_TMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0xafc653f1, L:/192.168.86.8:55560 ! R:/8.133.246.113:8091]) will closed
2025-05-25 04:12:57.369 [NettyClientSelector_RMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - channel inactive: [id: 0xd1a55c37, L:/192.168.86.8:55563 ! R:/8.133.246.113:8091]
2025-05-25 04:12:57.369 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - return to pool, rm channel:[id: 0xd1a55c37, L:/192.168.86.8:55563 ! R:/8.133.246.113:8091]
2025-05-25 04:12:57.369 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - channel valid false,channel:[id: 0xd1a55c37, L:/192.168.86.8:55563 ! R:/8.133.246.113:8091]
2025-05-25 04:12:57.369 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - will destroy channel:[id: 0xd1a55c37, L:/192.168.86.8:55563 ! R:/8.133.246.113:8091]
2025-05-25 04:12:57.369 [NettyClientSelector_RMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0xd1a55c37, L:/192.168.86.8:55563 ! R:/8.133.246.113:8091]) will closed
2025-05-25 04:12:57.369 [NettyClientSelector_RMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0xd1a55c37, L:/192.168.86.8:55563 ! R:/8.133.246.113:8091]) will closed
2025-05-25 04:13:48.288 [main] WARN  com.alibaba.nacos.client.logging.NacosLogging - Load Logback Configuration of Nacos fail, message: Could not initialize Logback Nacos logging from classpath:nacos-logback.xml
2025-05-25 04:13:48.289 [main] INFO  com.bgpay.bgai.BgaiApplication - The following 1 profile is active: "dev"
2025-05-25 04:13:49.672 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-05-25 04:13:49.674 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-05-25 04:13:49.697 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 17 ms. Found 0 JPA repository interfaces.
2025-05-25 04:13:49.709 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-05-25 04:13:49.710 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-05-25 04:13:49.721 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 4 ms. Found 0 Redis repository interfaces.
2025-05-25 04:13:50.408 [main] INFO  io.seata.config.ConfigurationFactory - load Configuration from :Spring Configuration
2025-05-25 04:13:50.416 [main] INFO  io.seata.config.ConfigurationFactory - load Configuration from :Spring Configuration
2025-05-25 04:13:50.423 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Initializing Global Transaction Clients ... 
2025-05-25 04:13:50.528 [main] INFO  io.seata.core.rpc.netty.NettyClientBootstrap - NettyClientBootstrap has started
2025-05-25 04:13:50.529 [main] INFO  io.seata.discovery.registry.RegistryFactory - use registry center type: file
2025-05-25 04:13:50.538 [main] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - will connect to 8.133.246.113:8091
2025-05-25 04:13:50.542 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - NettyPool create channel to transactionRole:TMROLE,address:8.133.246.113:8091,msg:< RegisterTMRequest{version='1.7.0', applicationId='bgtech-ai', transactionServiceGroup='bgai-tx-group', extraData='ak=null
digest=bgai-tx-group,192.168.86.8,1748117630541
timestamp=1748117630541
authVersion=V4
vgroup=bgai-tx-group
ip=192.168.86.8
'} >
2025-05-25 04:13:50.682 [main] INFO  io.seata.core.rpc.netty.TmNettyRemotingClient - register TM success. client version:1.7.0, server version:1.8.1-SNAPSHOT,channel:[id: 0x0a24d461, L:/192.168.86.8:55728 - R:/8.133.246.113:8091]
2025-05-25 04:13:50.688 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - register success, cost 70 ms, version:1.8.1-SNAPSHOT,role:TMROLE,channel:[id: 0x0a24d461, L:/192.168.86.8:55728 - R:/8.133.246.113:8091]
2025-05-25 04:13:50.689 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Transaction Manager Client is initialized. applicationId[bgtech-ai] txServiceGroup[bgai-tx-group]
2025-05-25 04:13:50.700 [main] INFO  io.seata.rm.datasource.AsyncWorker - Async Commit Buffer Limit: 10000
2025-05-25 04:13:50.700 [main] INFO  io.seata.rm.datasource.xa.ResourceManagerXA - ResourceManagerXA init ...
2025-05-25 04:13:50.707 [main] INFO  io.seata.core.rpc.netty.NettyClientBootstrap - NettyClientBootstrap has started
2025-05-25 04:13:50.707 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Resource Manager is initialized. applicationId[bgtech-ai] txServiceGroup[bgai-tx-group]
2025-05-25 04:13:50.707 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Global Transaction Clients are initialized. 
2025-05-25 04:13:51.815 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat initialized with port(s): 8080 (http)
2025-05-25 04:13:51.835 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - The ["http-nio-8080"] connector has been configured to support HTTP upgrade to [h2c]
2025-05-25 04:13:51.835 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - Initializing ProtocolHandler ["http-nio-8080"]
2025-05-25 04:13:51.838 [main] INFO  org.apache.catalina.core.StandardService - Starting service [Tomcat]
2025-05-25 04:13:51.838 [main] INFO  org.apache.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.15]
2025-05-25 04:13:52.284 [main] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} inited
2025-05-25 04:13:52.523 [main] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - will connect to 8.133.246.113:8091
2025-05-25 04:13:52.524 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - RM will register :jdbc:mysql://8.133.246.113:3306/deepseek
2025-05-25 04:13:52.524 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - NettyPool create channel to transactionRole:RMROLE,address:8.133.246.113:8091,msg:< RegisterRMRequest{resourceIds='jdbc:mysql://8.133.246.113:3306/deepseek', version='1.7.0', applicationId='bgtech-ai', transactionServiceGroup='bgai-tx-group', extraData='null'} >
2025-05-25 04:13:52.545 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - register RM success. client version:1.7.0, server version:1.8.1-SNAPSHOT,channel:[id: 0x4339b0ec, L:/192.168.86.8:55730 - R:/8.133.246.113:8091]
2025-05-25 04:13:52.545 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - register success, cost 12 ms, version:1.8.1-SNAPSHOT,role:RMROLE,channel:[id: 0x4339b0ec, L:/192.168.86.8:55730 - R:/8.133.246.113:8091]
2025-05-25 04:13:52.547 [main] INFO  i.s.s.a.datasource.SeataAutoDataSourceProxyCreator - Auto proxy data source 'masterDataSource' by 'AT' mode.
2025-05-25 04:13:52.618 [main] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-2} inited
2025-05-25 04:13:52.704 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - will register resourceId:jdbc:mysql://8.133.246.113:3306/deepseek
2025-05-25 04:13:52.705 [main] INFO  i.s.s.a.datasource.SeataAutoDataSourceProxyCreator - Auto proxy data source 'slaveDataSource' by 'AT' mode.
2025-05-25 04:13:52.714 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.rm.AbstractRMHandler - the rm client received response msg [RegisterRMResponse{version='1.8.1-SNAPSHOT', extraData='null', identified=true, resultCode=null, msg='null'}] from tc server.
2025-05-25 04:13:52.729 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - will register resourceId:jdbc:mysql://8.133.246.113:3306/deepseek
2025-05-25 04:13:52.730 [main] INFO  i.s.s.a.datasource.SeataAutoDataSourceProxyCreator - Auto proxy data source 'dynamicDataSource' by 'AT' mode.
2025-05-25 04:13:52.748 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.rm.AbstractRMHandler - the rm client received response msg [RegisterRMResponse{version='1.8.1-SNAPSHOT', extraData='null', identified=true, resultCode=null, msg='null'}] from tc server.
2025-05-25 04:13:52.838 [main] INFO  org.hibernate.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-05-25 04:13:52.890 [main] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.1.7.Final
2025-05-25 04:13:53.244 [main] INFO  SQL dialect - HHH000400: Using dialect: org.hibernate.dialect.MySQL8Dialect
2025-05-25 04:13:53.247 [main] WARN  org.hibernate.orm.deprecation - HHH90000026: MySQL8Dialect has been deprecated; use org.hibernate.dialect.MySQLDialect instead
2025-05-25 04:13:53.525 [main] INFO  o.h.e.t.jta.platform.internal.JtaPlatformInitiator - HHH000490: Using JtaPlatform implementation: [org.hibernate.engine.transaction.jta.platform.internal.NoJtaPlatform]
2025-05-25 04:13:53.536 [main] INFO  o.s.orm.jpa.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-05-25 04:13:53.917 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-25 04:13:53.928 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-25 04:13:53.955 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-25 04:13:53.957 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-25 04:13:53.957 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-25 04:13:53.968 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-25 04:13:54.594 [main] INFO  com.bgpay.bgai.service.impl.UserServiceImpl - 初始化SSO配置: clientId=bgai-client-id, redirectUri=http://localhost:8080/api/auth/callback
2025-05-25 04:13:54.739 [main] INFO  com.bgpay.bgai.controller.AuthController - 初始化认证控制器: clientId=bgai-client-id, redirectUri=http://localhost:8080/api/auth/callback
2025-05-25 04:13:55.690 [main] INFO  org.redisson.Version - Redisson 3.24.3
2025-05-25 04:13:55.840 [redisson-netty-4-6] INFO  o.r.connection.pool.MasterPubSubConnectionPool - 1 connections initialized for 8.133.246.113/8.133.246.113:6379
2025-05-25 04:13:56.224 [redisson-netty-4-19] INFO  org.redisson.connection.pool.MasterConnectionPool - 24 connections initialized for 8.133.246.113/8.133.246.113:6379
2025-05-25 04:13:56.396 [main] INFO  o.a.r.s.autoconfigure.RocketMQAutoConfiguration - a producer (billing-producer-group) init on namesrv 8.133.246.113:9876
2025-05-25 04:13:56.939 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Bean [com.bgpay.bgai.service.deepseek.DeepSeekServiceImp$$SpringCGLIB$$0] with name [deepSeekServiceImp] would use interceptor [io.seata.spring.annotation.GlobalTransactionalInterceptor]
2025-05-25 04:13:57.261 [main] WARN  i.s.s.b.a.provider.SpringBootConfigurationProvider - The get method not found for the field 'SeataProperties#accesskey'.
2025-05-25 04:13:57.261 [main] WARN  i.s.s.b.a.provider.SpringBootConfigurationProvider - The get method not found for the field 'SeataProperties#secretkey'.
2025-05-25 04:13:57.272 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 加载到1个Saga状态机定义文件
2025-05-25 04:13:57.415 [main] INFO  com.bgpay.bgai.saga.CustomSagaJsonParser - 开始解析状态机定义: bgai-saga-transaction
2025-05-25 04:13:57.415 [main] INFO  com.bgpay.bgai.saga.CustomSagaJsonParser - 状态机定义解析成功: bgai-saga-transaction
2025-05-25 04:13:57.415 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 成功加载状态机定义: /E:/project/bgai/target/classes/statelang/bgai-saga-transaction.json
2025-05-25 04:13:57.561 [main] INFO  com.bgpay.bgai.service.mq.MQConsumerService - MQ consumer startup successful [group=billing-consumer-group, topic=BILLING_TOPIC, tag=USER_BILLING]
2025-05-25 04:13:57.724 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Bean [com.bgpay.bgai.service.mq.BillingTransactionListenerImpl$$SpringCGLIB$$0] with name [billingTransactionListenerImpl] would use interceptor [io.seata.spring.annotation.GlobalTransactionalInterceptor]
2025-05-25 04:13:57.844 [main] DEBUG com.bgpay.bgai.config.AsyncConfig$1 - Initializing ExecutorService 'blockingExecutor'
2025-05-25 04:13:57.880 [main] INFO  c.b.bgai.config.NacosConfig$NacosWarningHandler - Nacos警告处理器已启用，将忽略配置中心连接警告
2025-05-25 04:13:59.015 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [After]
2025-05-25 04:13:59.016 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Before]
2025-05-25 04:13:59.016 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Between]
2025-05-25 04:13:59.016 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Cookie]
2025-05-25 04:13:59.016 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Header]
2025-05-25 04:13:59.016 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Host]
2025-05-25 04:13:59.016 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Method]
2025-05-25 04:13:59.016 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Path]
2025-05-25 04:13:59.016 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Query]
2025-05-25 04:13:59.016 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [ReadBody]
2025-05-25 04:13:59.016 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [RemoteAddr]
2025-05-25 04:13:59.016 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [XForwardedRemoteAddr]
2025-05-25 04:13:59.016 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Weight]
2025-05-25 04:13:59.016 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [CloudFoundryRouteService]
2025-05-25 04:14:00.489 [main] INFO  o.s.b.actuate.endpoint.web.EndpointLinksResolver - Exposing 3 endpoint(s) beneath base path '/actuator'
2025-05-25 04:14:01.962 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - Starting ProtocolHandler ["http-nio-8080"]
2025-05-25 04:14:01.976 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat started on port(s): 8080 (http) with context path ''
2025-05-25 04:14:01.986 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from ans.namespace attribute : null
2025-05-25 04:14:01.986 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from ALIBABA_ALIWARE_NAMESPACE attribute :null
2025-05-25 04:14:01.986 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from namespace attribute :null
2025-05-25 04:14:01.995 [main] INFO  c.a.n.p.auth.spi.client.ClientAuthPluginManager - [ClientAuthPluginManager] Load ClientAuthService com.alibaba.nacos.client.auth.impl.NacosClientAuthServiceImpl success.
2025-05-25 04:14:01.996 [main] INFO  c.a.n.p.auth.spi.client.ClientAuthPluginManager - [ClientAuthPluginManager] Load ClientAuthService com.alibaba.nacos.client.auth.ram.RamClientAuthServiceImpl success.
2025-05-25 04:14:01.999 [main] INFO  com.alibaba.nacos.common.remote.client - [RpcClientFactory] create a new rpc client of 02cb3cd8-31a2-4b28-bdf6-87d268468b71
2025-05-25 04:14:02.001 [main] INFO  com.alibaba.nacos.common.remote.client - [02cb3cd8-31a2-4b28-bdf6-87d268468b71] RpcClient init, ServerListFactory = com.alibaba.nacos.client.naming.core.ServerListManager
2025-05-25 04:14:02.001 [main] INFO  com.alibaba.nacos.common.remote.client - [02cb3cd8-31a2-4b28-bdf6-87d268468b71] Registry connection listener to current client:com.alibaba.nacos.client.naming.remote.gprc.redo.NamingGrpcRedoService
2025-05-25 04:14:02.001 [main] INFO  com.alibaba.nacos.common.remote.client - [02cb3cd8-31a2-4b28-bdf6-87d268468b71] Register server push request handler:com.alibaba.nacos.client.naming.remote.gprc.NamingPushRequestHandler
2025-05-25 04:14:02.001 [main] INFO  com.alibaba.nacos.common.remote.client - [02cb3cd8-31a2-4b28-bdf6-87d268468b71] Try to connect to server on start up, server: {serverIp = '8.133.246.113', server main port = 8848}
2025-05-25 04:14:02.001 [main] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - grpc client connection server:8.133.246.113 ip,serverPort:9848,grpcTslConfig:{"sslProvider":"OPENSSL","enableTls":false,"mutualAuthEnable":false,"trustAll":false}
2025-05-25 04:14:02.126 [main] INFO  com.alibaba.nacos.common.remote.client - [02cb3cd8-31a2-4b28-bdf6-87d268468b71] Success to connect to server [8.133.246.113:8848] on start up, connectionId = 1748117642048_139.227.195.192_48298
2025-05-25 04:14:02.126 [main] INFO  com.alibaba.nacos.common.remote.client - [02cb3cd8-31a2-4b28-bdf6-87d268468b71] Register server push request handler:com.alibaba.nacos.common.remote.client.RpcClient$ConnectResetRequestHandler
2025-05-25 04:14:02.126 [main] INFO  com.alibaba.nacos.common.remote.client - [02cb3cd8-31a2-4b28-bdf6-87d268468b71] Register server push request handler:com.alibaba.nacos.common.remote.client.RpcClient$$Lambda/0x000001a1af528cd8
2025-05-25 04:14:02.128 [main] INFO  com.alibaba.nacos.client.naming - [REGISTER-SERVICE] d750d92e-152f-4055-a641-3bc9dda85a29 registering service bgtech-ai with instance Instance{instanceId='null', ip='192.168.86.8', port=8080, weight=1.0, healthy=true, enabled=true, ephemeral=true, clusterName='DEFAULT', serviceName='null', metadata={IPv6=[2408:820c:7528:d042:c185:8edc:f30d:3d91], preserved.register.source=SPRING_CLOUD}}
2025-05-25 04:14:02.131 [com.alibaba.nacos.client.remote.worker] INFO  com.alibaba.nacos.common.remote.client - [02cb3cd8-31a2-4b28-bdf6-87d268468b71] Notify connected event to listeners.
2025-05-25 04:14:02.132 [com.alibaba.nacos.client.remote.worker] INFO  com.alibaba.nacos.client.naming - Grpc connection connect
2025-05-25 04:14:02.144 [main] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - nacos registry, DEFAULT_GROUP bgtech-ai 192.168.86.8:8080 register finished
2025-05-25 04:14:02.190 [main] INFO  com.bgpay.bgai.config.NacosConfig - 应用启动完成，当前环境: dev
2025-05-25 04:14:02.190 [main] INFO  com.bgpay.bgai.config.NacosConfig - Nacos配置中心: 8.133.246.113:8848, 命名空间: d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-25 04:14:02.190 [main] INFO  com.bgpay.bgai.config.NacosConfig - 注意: 如果看到Nacos配置加载警告，但应用正常启动，说明应用正在使用本地配置文件
2025-05-25 04:14:02.192 [main] INFO  com.bgpay.bgai.BgaiApplication - Started BgaiApplication in 15.939 seconds (process running for 17.303)
2025-05-25 04:14:02.196 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-25 04:14:02.196 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-25 04:14:02.207 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-25 04:14:02.207 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-25 04:14:02.207 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-25 04:14:02.218 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-25 04:14:02.218 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-25 04:14:02.218 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-25 04:14:02.226 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-25 04:14:02.227 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-25 04:14:02.228 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-25 04:14:02.233 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-25 04:14:02.233 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - ==================== Saga状态机加载报告 ====================
2025-05-25 04:14:02.234 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - Saga状态机配置加载状态: 成功
2025-05-25 04:14:02.234 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 已加载的状态机定义文件数量: 1
2025-05-25 04:14:02.234 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 已加载的状态机定义文件:
2025-05-25 04:14:02.234 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig -  - /E:/project/bgai/target/classes/statelang/bgai-saga-transaction.json
2025-05-25 04:14:02.234 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - Saga解析器状态: CUSTOM_FASTJSON2
2025-05-25 04:14:02.234 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 状态机解析结果: 成功 1 个, 失败 0 个
2025-05-25 04:14:02.234 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - =============================================================
2025-05-25 04:14:02.238 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - nacos.cache.data.init.snapshot = true 
2025-05-25 04:14:02.239 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] common-dev.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-25 04:14:02.248 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=common-dev.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-25 04:14:02.248 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=common-dev.yaml, group=DEFAULT_GROUP
2025-05-25 04:14:02.248 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-25 04:14:02.248 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-25 04:14:02.248 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai.yaml, group=DEFAULT_GROUP
2025-05-25 04:14:02.250 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai-dev.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-25 04:14:02.250 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai-dev.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-25 04:14:02.250 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai-dev.yaml, group=DEFAULT_GROUP
2025-05-25 04:14:02.250 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-25 04:14:02.250 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai, group=DEFAULT_GROUP, cnt=1
2025-05-25 04:14:02.250 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai, group=DEFAULT_GROUP
2025-05-25 04:14:07.412 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - 接收到请求: /api/chatGatWay-internal, 文件=新文件 17.txt, 问题参数=null, 模型参数=null
2025-05-25 04:14:07.414 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - 请求Content-Type: multipart/form-data;boundary=--------------------------911924883014180197619471
2025-05-25 04:14:07.416 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - 收集到的完整参数: question="null", apiUrl="null", modelName="null", multiTurn=false
2025-05-25 04:14:07.418 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - Processing request for user ID: 689258T
2025-05-25 04:14:07.419 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - Processing file with circuit breaker: fileName=新文件 17.txt, question=
2025-05-25 04:14:07.421 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.config.ReactiveFileProcessor - Processing file: 新文件 17.txt, content-type: text/plain
2025-05-25 04:14:07.431 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - PARAM TRACE [689258T]: 尝试查找匹配配置 - 参数: apiUrl=null, modelName=null
2025-05-25 04:14:07.442 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 查询配置 - userId=689258T
2025-05-25 04:14:07.443 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 排序方式 - 按ID降序
2025-05-25 04:14:07.443 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 限制结果数 - LIMIT 1
2025-05-25 04:14:07.518 [http-nio-8080-exec-2] DEBUG com.bgpay.bgai.mapper.ApiConfigMapper.selectList - ==>  Preparing: SELECT id,api_url,api_key,model_name,user_id FROM api_config WHERE (user_id = ?) ORDER BY id DESC LIMIT 1
2025-05-25 04:14:07.520 [http-nio-8080-exec-2] DEBUG com.bgpay.bgai.mapper.ApiConfigMapper.selectList - ==> Parameters: 689258T(String)
2025-05-25 04:14:07.529 [http-nio-8080-exec-2] DEBUG com.bgpay.bgai.mapper.ApiConfigMapper.selectList - <==      Total: 1
2025-05-25 04:14:07.529 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 查询结果 - 找到配置: id=2, modelName=deepseek-chat
2025-05-25 04:14:07.529 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - PARAM TRACE [689258T]: 找到匹配配置 - apiUrl=https://api.deepseek.com/chat/completions, modelName=deepseek-chat (原始请求: null)
2025-05-25 04:14:07.529 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - API config resolved: url=https://api.deepseek.com/chat/completions, model=deepseek-chat
2025-05-25 04:14:07.547 [Thread-49] INFO  com.bgpay.bgai.config.ReactiveFileProcessor - File processed successfully: size=37 bytes
2025-05-25 04:14:07.552 [Thread-49] INFO  com.bgpay.bgai.controller.ReactiveChatController - Content processed, length: 54
2025-05-25 04:14:07.558 [Thread-49] INFO  io.seata.tm.TransactionManagerHolder - TransactionManager Singleton io.seata.tm.DefaultTransactionManager@174b4890
2025-05-25 04:14:07.571 [Thread-49] INFO  io.seata.tm.api.DefaultGlobalTransaction - Begin new global transaction [seata-server:8091:117747646027194389]
2025-05-25 04:14:07.574 [Thread-49] INFO  c.b.bgai.interceptor.SeataTransactionInterceptor - 准备记录分布式事务开始: XID=seata-server:8091:117747646027194389, 业务=com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive, 路径=, IP=, 用户=system
2025-05-25 04:14:07.589 [Thread-49] INFO  c.b.bgai.service.impl.TransactionLogServiceImpl - 记录分布式事务开始: XID=seata-server:8091:117747646027194389, 业务=com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive
2025-05-25 04:14:07.596 [Thread-49] DEBUG com.bgpay.bgai.mapper.TransactionLogMapper.insert - ==>  Preparing: INSERT INTO transaction_log ( xid, transaction_name, transaction_mode, status, request_path, source_ip, start_time, user_id, create_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-05-25 04:14:07.600 [Thread-49] DEBUG com.bgpay.bgai.mapper.TransactionLogMapper.insert - ==> Parameters: seata-server:8091:117747646027194389(String), com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive(String), AT(String), ACTIVE(String), (String), (String), 2025-05-25T04:14:07.589506400(LocalDateTime), system(String), 2025-05-25T04:14:07.589506400(LocalDateTime)
2025-05-25 04:14:08.015 [Thread-49] DEBUG com.bgpay.bgai.mapper.TransactionLogMapper.insert - <==    Updates: 1
2025-05-25 04:14:08.034 [Thread-49] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:117747646027194389, branchId:117747646027194390, lockKeys:transaction_log:57
2025-05-25 04:14:08.044 [Thread-49] WARN  i.s.c.l.EnhancedServiceLoader$InnerEnhancedServiceLoader - Load [io.seata.rm.datasource.undo.parser.ProtostuffUndoLogParser] class fail: io/protostuff/runtime/IdStrategy
2025-05-25 04:14:08.128 [Thread-49] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:117747646027194389, branchId:117747646027194391, lockKeys:undo_log:235;transaction_log:57
2025-05-25 04:14:08.156 [Thread-49] INFO  c.b.bgai.interceptor.SeataTransactionInterceptor - 开始分布式事务: XID=seata-server:8091:117747646027194389, 方法=com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive
2025-05-25 04:14:08.169 [Thread-49] INFO  org.reflections.Reflections - Processing reactive request: content length=54, apiUrl=https://api.deepseek.com/chat/completions, modelName=deepseek-chat, userId=689258T, multiTurn=false
2025-05-25 04:14:08.176 [Thread-49] INFO  c.b.bgai.service.impl.TransactionLogServiceImpl - 记录分布式事务结束: XID=seata-server:8091:117747646027194389, 状态=COMMITTED
2025-05-25 04:14:08.178 [Thread-49] DEBUG c.b.bgai.mapper.TransactionLogMapper.selectList - ==>  Preparing: SELECT id,xid,branch_id,transaction_name,transaction_mode,status,request_path,source_ip,start_time,end_time,user_id,extra_data,create_time,update_time FROM transaction_log WHERE (xid = ?) LIMIT 1
2025-05-25 04:14:08.181 [Thread-49] DEBUG c.b.bgai.mapper.TransactionLogMapper.selectList - ==> Parameters: seata-server:8091:117747646027194389(String)
2025-05-25 04:14:08.190 [Thread-49] DEBUG c.b.bgai.mapper.TransactionLogMapper.selectList - <==      Total: 1
2025-05-25 04:14:08.194 [Thread-49] DEBUG c.b.bgai.mapper.TransactionLogMapper.updateById - ==>  Preparing: UPDATE transaction_log SET xid=?, transaction_name=?, transaction_mode=?, status=?, request_path=?, source_ip=?, start_time=?, end_time=?, user_id=?, extra_data=?, create_time=?, update_time=? WHERE id=?
2025-05-25 04:14:08.202 [Thread-49] DEBUG c.b.bgai.mapper.TransactionLogMapper.updateById - ==> Parameters: seata-server:8091:117747646027194389(String), com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive(String), AT(String), COMMITTED(String), (String), (String), 2025-05-25T04:14:08(LocalDateTime), 2025-05-25T04:14:08.190528600(LocalDateTime), system(String), {"duration":15,"result":"success"}(String), 2025-05-25T04:14:08(LocalDateTime), 2025-05-25T04:14:08.190528600(LocalDateTime), 57(Long)
2025-05-25 04:14:08.255 [Thread-49] DEBUG c.b.bgai.mapper.TransactionLogMapper.updateById - <==    Updates: 1
2025-05-25 04:14:08.271 [Thread-49] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:117747646027194389, branchId:117747646027194392, lockKeys:transaction_log:57
2025-05-25 04:14:08.297 [Thread-49] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:117747646027194389, branchId:117747646027194393, lockKeys:transaction_log:57;undo_log:237
2025-05-25 04:14:08.319 [Thread-49] INFO  c.b.bgai.interceptor.SeataTransactionInterceptor - 分布式事务成功完成: XID=seata-server:8091:117747646027194389, 耗时=15ms
2025-05-25 04:14:08.319 [Thread-49] INFO  io.seata.tm.api.DefaultGlobalTransaction - transaction seata-server:8091:117747646027194389 will be commit
2025-05-25 04:14:08.336 [Thread-49] INFO  io.seata.tm.api.DefaultGlobalTransaction - transaction end, xid = seata-server:8091:117747646027194389
2025-05-25 04:14:08.336 [Thread-49] INFO  io.seata.tm.api.DefaultGlobalTransaction - [seata-server:8091:117747646027194389] commit status: Committed
2025-05-25 04:14:08.337 [rpcDispatch_RMROLE_1_1_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:117747646027194389', branchId=117747646027194390, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false,"skipCheckLock":true}'}
2025-05-25 04:14:08.338 [rpcDispatch_RMROLE_1_1_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:117747646027194389 117747646027194390 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false,"skipCheckLock":true}
2025-05-25 04:14:08.339 [rpcDispatch_RMROLE_1_1_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-25 04:14:08.347 [rpcDispatch_RMROLE_1_2_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:117747646027194389', branchId=117747646027194391, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false,"skipCheckLock":true}'}
2025-05-25 04:14:08.347 [rpcDispatch_RMROLE_1_2_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:117747646027194389 117747646027194391 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false,"skipCheckLock":true}
2025-05-25 04:14:08.347 [rpcDispatch_RMROLE_1_2_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-25 04:14:08.356 [rpcDispatch_RMROLE_1_3_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:117747646027194389', branchId=117747646027194392, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false}'}
2025-05-25 04:14:08.356 [rpcDispatch_RMROLE_1_3_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:117747646027194389 117747646027194392 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false}
2025-05-25 04:14:08.356 [rpcDispatch_RMROLE_1_3_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-25 04:14:08.365 [rpcDispatch_RMROLE_1_4_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:117747646027194389', branchId=117747646027194393, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false}'}
2025-05-25 04:14:08.365 [rpcDispatch_RMROLE_1_4_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:117747646027194389 117747646027194393 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false}
2025-05-25 04:14:08.365 [rpcDispatch_RMROLE_1_4_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-25 04:14:08.376 [boundedElastic-1] WARN  com.bgpay.bgai.transaction.TransactionCoordinator - Found existing transaction for user 689258T: chat-d25aba81-3422-4521-9e4e-2bf181f7bab0
2025-05-25 04:14:08.376 [boundedElastic-1] INFO  org.reflections.Reflections - Transaction prepared with chatCompletionId: chat-d25aba81-3422-4521-9e4e-2bf181f7bab0
2025-05-25 04:15:05.375 [FileWrite-1] INFO  com.bgpay.bgai.service.deepseek.FileWriterService - Successfully wrote content to: \var\data\ai_responses\3197f989-a363-40f4-a502-3759c5b04d46.txt
2025-05-25 04:15:05.390 [reactor-http-nio-2] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - ==>  Preparing: INSERT INTO chat_completions ( object, created, model, system_fingerprint, api_key ) VALUES ( ?, ?, ?, ?, ? )
2025-05-25 04:15:05.390 [reactor-http-nio-2] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - ==> Parameters: chat.completion(String), 1748117705387(Long), deepseek-chat(String), 689258T(String), chat-d25aba81-3422-4521-9e4e-2bf181f7bab0(String)
2025-05-25 04:15:05.415 [reactor-http-nio-2] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - <==    Updates: 1
2025-05-25 04:15:05.415 [reactor-http-nio-2] INFO  com.bgpay.bgai.transaction.TransactionCoordinator - Transaction committed for user 689258T: chatCompletionId=chat-d25aba81-3422-4521-9e4e-2bf181f7bab0
2025-05-25 04:15:27.764 [NettyClientSelector_RMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - channel [id: 0x4339b0ec, L:/192.168.86.8:55730 - R:/8.133.246.113:8091] read idle.
2025-05-25 04:15:27.765 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - will destroy channel:[id: 0x4339b0ec, L:/192.168.86.8:55730 - R:/8.133.246.113:8091]
2025-05-25 04:15:27.765 [NettyClientSelector_RMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0x4339b0ec, L:/192.168.86.8:55730 - R:/8.133.246.113:8091]) will closed
2025-05-25 04:15:27.765 [NettyClientSelector_RMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0x4339b0ec, L:/192.168.86.8:55730 ! R:/8.133.246.113:8091]) will closed
2025-05-25 04:15:27.765 [NettyClientSelector_TMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - channel [id: 0x0a24d461, L:/192.168.86.8:55728 - R:/8.133.246.113:8091] read idle.
2025-05-25 04:15:27.765 [NettyClientSelector_TMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - will destroy channel:[id: 0x0a24d461, L:/192.168.86.8:55728 - R:/8.133.246.113:8091]
2025-05-25 04:15:27.765 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - return to pool, rm channel:[id: 0x4339b0ec, L:/192.168.86.8:55730 ! R:/8.133.246.113:8091]
2025-05-25 04:15:27.765 [NettyClientSelector_TMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0x0a24d461, L:/192.168.86.8:55728 - R:/8.133.246.113:8091]) will closed
2025-05-25 04:15:27.765 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - channel valid false,channel:[id: 0x4339b0ec, L:/192.168.86.8:55730 ! R:/8.133.246.113:8091]
2025-05-25 04:15:27.765 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - will destroy channel:[id: 0x4339b0ec, L:/192.168.86.8:55730 ! R:/8.133.246.113:8091]
2025-05-25 04:15:27.765 [NettyClientSelector_RMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0x4339b0ec, L:/192.168.86.8:55730 ! R:/8.133.246.113:8091]) will closed
2025-05-25 04:15:27.765 [NettyClientSelector_TMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0x0a24d461, L:/192.168.86.8:55728 ! R:/8.133.246.113:8091]) will closed
2025-05-25 04:15:27.765 [NettyClientSelector_RMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0x4339b0ec, L:/192.168.86.8:55730 ! R:/8.133.246.113:8091]) will closed
2025-05-25 04:15:27.766 [NettyClientSelector_TMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - return to pool, rm channel:[id: 0x0a24d461, L:/192.168.86.8:55728 ! R:/8.133.246.113:8091]
2025-05-25 04:15:27.766 [NettyClientSelector_TMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - channel valid false,channel:[id: 0x0a24d461, L:/192.168.86.8:55728 ! R:/8.133.246.113:8091]
2025-05-25 04:15:27.766 [NettyClientSelector_RMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - channel inactive: [id: 0x4339b0ec, L:/192.168.86.8:55730 ! R:/8.133.246.113:8091]
2025-05-25 04:15:27.766 [NettyClientSelector_TMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - will destroy channel:[id: 0x0a24d461, L:/192.168.86.8:55728 ! R:/8.133.246.113:8091]
2025-05-25 04:15:27.766 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - channel valid false,channel:[id: 0x4339b0ec, L:/192.168.86.8:55730 ! R:/8.133.246.113:8091]
2025-05-25 04:15:27.766 [NettyClientSelector_TMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0x0a24d461, L:/192.168.86.8:55728 ! R:/8.133.246.113:8091]) will closed
2025-05-25 04:15:27.766 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - will destroy channel:[id: 0x4339b0ec, L:/192.168.86.8:55730 ! R:/8.133.246.113:8091]
2025-05-25 04:15:27.766 [NettyClientSelector_TMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0x0a24d461, L:/192.168.86.8:55728 ! R:/8.133.246.113:8091]) will closed
2025-05-25 04:15:27.766 [NettyClientSelector_TMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - channel inactive: [id: 0x0a24d461, L:/192.168.86.8:55728 ! R:/8.133.246.113:8091]
2025-05-25 04:15:27.766 [NettyClientSelector_RMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0x4339b0ec, L:/192.168.86.8:55730 ! R:/8.133.246.113:8091]) will closed
2025-05-25 04:15:27.766 [NettyClientSelector_TMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - channel valid false,channel:[id: 0x0a24d461, L:/192.168.86.8:55728 ! R:/8.133.246.113:8091]
2025-05-25 04:15:27.766 [NettyClientSelector_RMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0x4339b0ec, L:/192.168.86.8:55730 ! R:/8.133.246.113:8091]) will closed
2025-05-25 04:15:27.766 [NettyClientSelector_TMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - will destroy channel:[id: 0x0a24d461, L:/192.168.86.8:55728 ! R:/8.133.246.113:8091]
2025-05-25 04:15:27.766 [NettyClientSelector_TMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0x0a24d461, L:/192.168.86.8:55728 ! R:/8.133.246.113:8091]) will closed
2025-05-25 04:15:27.766 [NettyClientSelector_TMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0x0a24d461, L:/192.168.86.8:55728 ! R:/8.133.246.113:8091]) will closed
2025-05-25 04:15:27.770 [reactor-http-nio-2] INFO  org.reflections.Reflections - 开始发送账单消息，chatCompletionId: chat-d25aba81-3422-4521-9e4e-2bf181f7bab0, userId: 689258T
2025-05-25 04:15:27.780 [parallel-2] ERROR com.bgpay.bgai.controller.ReactiveChatController - Circuit broken for API call: Did not observe any item or terminal signal within 60000ms in 'Mono.transform ⇢ at org.springframework.cloud.circuitbreaker.resilience4j.ReactiveResilience4JCircuitBreaker.run(ReactiveResilience4JCircuitBreaker.java:78)' (and no fallback has been configured)
2025-05-25 04:15:27.788 [nacos-grpc-client-executor-8.133.246.113-24] INFO  com.alibaba.nacos.common.remote.client - [02cb3cd8-31a2-4b28-bdf6-87d268468b71] Receive server push request, request = ClientDetectionRequest, requestId = 2
2025-05-25 04:15:27.788 [nacos-grpc-client-executor-8.133.246.113-38] INFO  com.alibaba.nacos.common.remote.client - [681b9b76-b3a0-4929-82f8-e23ddf409983_config-0] Receive server push request, request = ClientDetectionRequest, requestId = 1
2025-05-25 04:15:27.788 [nacos-grpc-client-executor-8.133.246.113-24] INFO  com.alibaba.nacos.common.remote.client - [02cb3cd8-31a2-4b28-bdf6-87d268468b71] Ack server push request, request = ClientDetectionRequest, requestId = 2
2025-05-25 04:15:27.788 [nacos-grpc-client-executor-8.133.246.113-38] INFO  com.alibaba.nacos.common.remote.client - [681b9b76-b3a0-4929-82f8-e23ddf409983_config-0] Ack server push request, request = ClientDetectionRequest, requestId = 1
2025-05-25 04:15:27.790 [parallel-2] INFO  com.bgpay.bgai.transaction.TransactionCoordinator - Transaction rolled back for user 689258T: chatCompletionId=chat-d25aba81-3422-4521-9e4e-2bf181f7bab0
2025-05-25 04:15:27.790 [parallel-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - Using rolled back chatCompletionId for circuit breaker fallback: chat-d25aba81-3422-4521-9e4e-2bf181f7bab0
2025-05-25 04:15:27.833 [reactor-http-nio-2] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - will connect to 8.133.246.113:8091
2025-05-25 04:15:27.833 [reactor-http-nio-2] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - NettyPool create channel to transactionRole:TMROLE,address:8.133.246.113:8091,msg:< RegisterTMRequest{version='1.7.0', applicationId='bgtech-ai', transactionServiceGroup='bgai-tx-group', extraData='ak=null
digest=bgai-tx-group,192.168.86.8,1748117727833
timestamp=1748117727833
authVersion=V4
vgroup=bgai-tx-group
ip=192.168.86.8
'} >
2025-05-25 04:15:27.848 [reactor-http-nio-2] INFO  io.seata.core.rpc.netty.TmNettyRemotingClient - register TM success. client version:1.7.0, server version:1.8.1-SNAPSHOT,channel:[id: 0xcabeab52, L:/192.168.86.8:62933 - R:/8.133.246.113:8091]
2025-05-25 04:15:27.848 [reactor-http-nio-2] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - register success, cost 8 ms, version:1.8.1-SNAPSHOT,role:TMROLE,channel:[id: 0xcabeab52, L:/192.168.86.8:62933 - R:/8.133.246.113:8091]
2025-05-25 04:15:27.858 [reactor-http-nio-2] INFO  io.seata.tm.api.DefaultGlobalTransaction - Begin new global transaction [seata-server:8091:117747646027194394]
2025-05-25 04:15:27.858 [reactor-http-nio-2] INFO  c.b.bgai.interceptor.SeataTransactionInterceptor - 准备记录分布式事务开始: XID=seata-server:8091:117747646027194394, 业务=com.bgpay.bgai.service.mq.BillingTransactionListenerImpl.executeLocalTransaction, 路径=, IP=, 用户=system
2025-05-25 04:15:27.863 [reactor-http-nio-2] INFO  c.b.bgai.service.impl.TransactionLogServiceImpl - 记录分布式事务开始: XID=seata-server:8091:117747646027194394, 业务=com.bgpay.bgai.service.mq.BillingTransactionListenerImpl.executeLocalTransaction
2025-05-25 04:15:27.864 [reactor-http-nio-2] DEBUG com.bgpay.bgai.mapper.TransactionLogMapper.insert - ==>  Preparing: INSERT INTO transaction_log ( xid, transaction_name, transaction_mode, status, request_path, source_ip, start_time, user_id, create_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-05-25 04:15:27.864 [reactor-http-nio-2] DEBUG com.bgpay.bgai.mapper.TransactionLogMapper.insert - ==> Parameters: seata-server:8091:117747646027194394(String), com.bgpay.bgai.service.mq.BillingTransactionListenerImpl.executeLocalTransaction(String), AT(String), ACTIVE(String), (String), (String), 2025-05-25T04:15:27.863467(LocalDateTime), system(String), 2025-05-25T04:15:27.863467(LocalDateTime)
2025-05-25 04:15:27.898 [reactor-http-nio-2] DEBUG com.bgpay.bgai.mapper.TransactionLogMapper.insert - <==    Updates: 1
2025-05-25 04:15:27.901 [rpcMergeMessageSend_RMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - will connect to 8.133.246.113:8091
2025-05-25 04:15:27.901 [rpcMergeMessageSend_RMROLE_1_1] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - RM will register :jdbc:mysql://8.133.246.113:3306/deepseek
2025-05-25 04:15:27.901 [rpcMergeMessageSend_RMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - NettyPool create channel to transactionRole:RMROLE,address:8.133.246.113:8091,msg:< RegisterRMRequest{resourceIds='jdbc:mysql://8.133.246.113:3306/deepseek', version='1.7.0', applicationId='bgtech-ai', transactionServiceGroup='bgai-tx-group', extraData='null'} >
2025-05-25 04:15:27.919 [rpcMergeMessageSend_RMROLE_1_1] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - register RM success. client version:1.7.0, server version:1.8.1-SNAPSHOT,channel:[id: 0x1c970b3a, L:/192.168.86.8:62935 - R:/8.133.246.113:8091]
2025-05-25 04:15:27.919 [rpcMergeMessageSend_RMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - register success, cost 10 ms, version:1.8.1-SNAPSHOT,role:RMROLE,channel:[id: 0x1c970b3a, L:/192.168.86.8:62935 - R:/8.133.246.113:8091]
2025-05-25 04:15:27.929 [reactor-http-nio-2] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:117747646027194394, branchId:117747646027194395, lockKeys:transaction_log:58
2025-05-25 04:15:27.960 [reactor-http-nio-2] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:117747646027194394, branchId:117747646027194396, lockKeys:transaction_log:58;undo_log:239
2025-05-25 04:15:27.981 [reactor-http-nio-2] INFO  c.b.bgai.interceptor.SeataTransactionInterceptor - 开始分布式事务: XID=seata-server:8091:117747646027194394, 方法=com.bgpay.bgai.service.mq.BillingTransactionListenerImpl.executeLocalTransaction
2025-05-25 04:15:27.982 [reactor-http-nio-2] INFO  c.b.bgai.service.mq.BillingTransactionListenerImpl - 开始执行本地事务, xid: seata-server:8091:117747646027194394, userId: 689258T, completionId: chat-d25aba81-3422-4521-9e4e-2bf181f7bab0
2025-05-25 04:15:27.995 [reactor-http-nio-2] INFO  c.b.bgai.service.mq.BillingTransactionListenerImpl - 消息已处理，提交事务, completionId: chat-d25aba81-3422-4521-9e4e-2bf181f7bab0
2025-05-25 04:15:28.000 [reactor-http-nio-2] INFO  c.b.bgai.service.impl.TransactionLogServiceImpl - 记录分布式事务结束: XID=seata-server:8091:117747646027194394, 状态=COMMITTED
2025-05-25 04:15:28.001 [reactor-http-nio-2] DEBUG c.b.bgai.mapper.TransactionLogMapper.selectList - ==>  Preparing: SELECT id,xid,branch_id,transaction_name,transaction_mode,status,request_path,source_ip,start_time,end_time,user_id,extra_data,create_time,update_time FROM transaction_log WHERE (xid = ?) LIMIT 1
2025-05-25 04:15:28.002 [reactor-http-nio-2] DEBUG c.b.bgai.mapper.TransactionLogMapper.selectList - ==> Parameters: seata-server:8091:117747646027194394(String)
2025-05-25 04:15:28.008 [reactor-http-nio-2] DEBUG c.b.bgai.mapper.TransactionLogMapper.selectList - <==      Total: 1
2025-05-25 04:15:28.010 [reactor-http-nio-2] DEBUG c.b.bgai.mapper.TransactionLogMapper.updateById - ==>  Preparing: UPDATE transaction_log SET xid=?, transaction_name=?, transaction_mode=?, status=?, request_path=?, source_ip=?, start_time=?, end_time=?, user_id=?, extra_data=?, create_time=?, update_time=? WHERE id=?
2025-05-25 04:15:28.011 [reactor-http-nio-2] DEBUG c.b.bgai.mapper.TransactionLogMapper.updateById - ==> Parameters: seata-server:8091:117747646027194394(String), com.bgpay.bgai.service.mq.BillingTransactionListenerImpl.executeLocalTransaction(String), AT(String), COMMITTED(String), (String), (String), 2025-05-25T04:15:28(LocalDateTime), 2025-05-25T04:15:28.009074300(LocalDateTime), system(String), {"duration":14,"result":"success"}(String), 2025-05-25T04:15:28(LocalDateTime), 2025-05-25T04:15:28.009074300(LocalDateTime), 58(Long)
2025-05-25 04:15:28.064 [reactor-http-nio-2] DEBUG c.b.bgai.mapper.TransactionLogMapper.updateById - <==    Updates: 1
2025-05-25 04:15:28.082 [reactor-http-nio-2] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:117747646027194394, branchId:117747646027194397, lockKeys:transaction_log:58
2025-05-25 04:15:28.121 [reactor-http-nio-2] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:117747646027194394, branchId:117747646027194398, lockKeys:transaction_log:58;undo_log:241
2025-05-25 04:15:28.148 [reactor-http-nio-2] INFO  c.b.bgai.interceptor.SeataTransactionInterceptor - 分布式事务成功完成: XID=seata-server:8091:117747646027194394, 耗时=14ms
2025-05-25 04:15:28.148 [reactor-http-nio-2] INFO  io.seata.tm.api.DefaultGlobalTransaction - transaction seata-server:8091:117747646027194394 will be commit
2025-05-25 04:15:28.158 [reactor-http-nio-2] INFO  io.seata.tm.api.DefaultGlobalTransaction - transaction end, xid = seata-server:8091:117747646027194394
2025-05-25 04:15:28.158 [reactor-http-nio-2] INFO  io.seata.tm.api.DefaultGlobalTransaction - [seata-server:8091:117747646027194394] commit status: Committed
2025-05-25 04:15:28.161 [reactor-http-nio-2] INFO  org.reflections.Reflections - 账单消息发送成功，chatCompletionId: chat-d25aba81-3422-4521-9e4e-2bf181f7bab0, userId: 689258T
2025-05-25 04:15:28.172 [reactor-http-nio-2] INFO  com.bgpay.bgai.service.impl.BGAIServiceImpl - 执行第一步操作 - 发送账单消息, businessKey: 689258T:chat-d25aba81-3422-4521-9e4e-2bf181f7bab0
2025-05-25 04:15:28.173 [reactor-http-nio-2] DEBUG c.bgpay.bgai.mapper.UsageRecordMapper.selectCount - ==>  Preparing: SELECT COUNT( * ) AS total FROM usage_record WHERE (chat_completion_id = ?)
2025-05-25 04:15:28.174 [reactor-http-nio-2] DEBUG c.bgpay.bgai.mapper.UsageRecordMapper.selectCount - ==> Parameters: chat-d25aba81-3422-4521-9e4e-2bf181f7bab0(String)
2025-05-25 04:15:28.178 [reactor-http-nio-2] DEBUG c.bgpay.bgai.mapper.UsageRecordMapper.selectCount - <==      Total: 1
2025-05-25 04:15:28.179 [reactor-http-nio-2] INFO  com.bgpay.bgai.service.impl.BGAIServiceImpl - 账单消息已处理，跳过发送, completionId: chat-d25aba81-3422-4521-9e4e-2bf181f7bab0
2025-05-25 04:15:28.189 [reactor-http-nio-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - Processed response for user 689258T, content length: 5399
2025-05-25 04:15:28.339 [rpcDispatch_RMROLE_1_5_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:117747646027194394', branchId=117747646027194395, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false,"skipCheckLock":true}'}
2025-05-25 04:15:28.339 [rpcDispatch_RMROLE_1_5_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:117747646027194394 117747646027194395 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false,"skipCheckLock":true}
2025-05-25 04:15:28.339 [rpcDispatch_RMROLE_1_5_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-25 04:15:28.355 [rpcDispatch_RMROLE_1_6_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:117747646027194394', branchId=117747646027194396, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false,"skipCheckLock":true}'}
2025-05-25 04:15:28.355 [rpcDispatch_RMROLE_1_6_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:117747646027194394 117747646027194396 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false,"skipCheckLock":true}
2025-05-25 04:15:28.355 [rpcDispatch_RMROLE_1_6_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-25 04:15:28.367 [rpcDispatch_RMROLE_1_7_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:117747646027194394', branchId=117747646027194397, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false}'}
2025-05-25 04:15:28.367 [rpcDispatch_RMROLE_1_7_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:117747646027194394 117747646027194397 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false}
2025-05-25 04:15:28.367 [rpcDispatch_RMROLE_1_7_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-25 04:15:28.377 [rpcDispatch_RMROLE_1_8_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:117747646027194394', branchId=117747646027194398, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false}'}
2025-05-25 04:15:28.377 [rpcDispatch_RMROLE_1_8_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:117747646027194394 117747646027194398 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false}
2025-05-25 04:15:28.377 [rpcDispatch_RMROLE_1_8_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-25 04:15:28.945 [ConsumeMessageThread_billing-consumer-group_1] INFO  c.bgpay.bgai.service.mq.RocketMQBillingServiceImpl - Output price config priceVersion: 1
2025-05-25 04:15:28.951 [ConsumeMessageThread_billing-consumer-group_1] DEBUG com.bgpay.bgai.mapper.UsageRecordMapper.insert - ==>  Preparing: INSERT INTO usage_record ( model_type, chat_completion_id, user_id, input_cost, output_cost, price_version, calculated_at, status, created_at ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-05-25 04:15:28.952 [ConsumeMessageThread_billing-consumer-group_1] DEBUG com.bgpay.bgai.mapper.UsageRecordMapper.insert - ==> Parameters: deepseek-chat(String), chat-d25aba81-3422-4521-9e4e-2bf181f7bab0(String), 689258T(String), 0.0001(BigDecimal), 0.0111(BigDecimal), 1(Integer), 2025-05-25T04:15:28.917799(LocalDateTime), PENDING(String), 2025-05-25T04:15:28.917799(LocalDateTime)
2025-05-25 04:15:28.963 [ConsumeMessageThread_billing-consumer-group_1] DEBUG com.bgpay.bgai.mapper.UsageRecordMapper.insert - <==    Updates: 1
2025-05-25 04:15:28.987 [ConsumeMessageThread_billing-consumer-group_1] INFO  c.bgpay.bgai.service.mq.RocketMQBillingServiceImpl - Message consumed: 2408820C7528D042C1858EDCF30D3D91145036BAF30C7C8282420000
2025-05-25 04:17:02.135 [Thread-1] WARN  c.alibaba.nacos.common.http.HttpClientBeanHolder - [HttpClientBeanHolder] Start destroying common HttpClient
2025-05-25 04:17:02.135 [Thread-7] WARN  com.alibaba.nacos.common.notify.NotifyCenter - [NotifyCenter] Start destroying Publisher
2025-05-25 04:17:02.135 [Thread-7] WARN  com.alibaba.nacos.common.notify.NotifyCenter - [NotifyCenter] Destruction of the end
2025-05-25 04:17:02.136 [Thread-1] WARN  c.alibaba.nacos.common.http.HttpClientBeanHolder - [HttpClientBeanHolder] Destruction of the end
2025-05-25 04:17:02.151 [SpringContextShutdownHook] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - De-registering from Nacos Server now...
2025-05-25 04:17:02.151 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - [DEREGISTER-SERVICE] d750d92e-152f-4055-a641-3bc9dda85a29 deregistering service bgtech-ai with instance: Instance{instanceId='null', ip='192.168.86.8', port=8080, weight=1.0, healthy=true, enabled=true, ephemeral=true, clusterName='DEFAULT', serviceName='null', metadata={}}
2025-05-25 04:17:02.159 [SpringContextShutdownHook] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - De-registration finished.
2025-05-25 04:17:02.161 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.cache.ServiceInfoHolder do shutdown begin
2025-05-25 04:17:02.161 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.backups.FailoverReactor do shutdown begin
2025-05-25 04:17:02.161 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.backups.FailoverReactor do shutdown stop
2025-05-25 04:17:02.161 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.cache.ServiceInfoHolder do shutdown stop
2025-05-25 04:17:02.161 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.NamingClientProxyDelegate do shutdown begin
2025-05-25 04:17:02.161 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServiceInfoUpdateService do shutdown begin
2025-05-25 04:17:02.161 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServiceInfoUpdateService do shutdown stop
2025-05-25 04:17:02.161 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServerListManager do shutdown begin
2025-05-25 04:17:02.161 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Start destroying NacosRestTemplate
2025-05-25 04:17:02.161 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Destruction of the end
2025-05-25 04:17:02.161 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServerListManager do shutdown stop
2025-05-25 04:17:02.161 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.http.NamingHttpClientProxy do shutdown begin
2025-05-25 04:17:02.161 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Start destroying NacosRestTemplate
2025-05-25 04:17:02.161 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Destruction of the end
2025-05-25 04:17:02.161 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.http.NamingHttpClientProxy do shutdown stop
2025-05-25 04:17:02.161 [SpringContextShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Shutdown rpc client, set status to shutdown
2025-05-25 04:17:02.161 [SpringContextShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Shutdown client event executor java.util.concurrent.ScheduledThreadPoolExecutor@7c018b33[Running, pool size = 2, active threads = 2, queued tasks = 0, completed tasks = 0]
2025-05-25 04:17:02.161 [SpringContextShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Close current connection 1748117642048_139.227.195.192_48298
2025-05-25 04:17:02.164 [SpringContextShutdownHook] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - Shutdown grpc executor java.util.concurrent.ThreadPoolExecutor@2a97559f[Running, pool size = 4, active threads = 0, queued tasks = 0, completed tasks = 53]
2025-05-25 04:17:02.164 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - Shutdown grpc redo service executor java.util.concurrent.ScheduledThreadPoolExecutor@356e71a4[Running, pool size = 1, active threads = 0, queued tasks = 1, completed tasks = 53]
2025-05-25 04:17:02.164 [SpringContextShutdownHook] INFO  c.a.n.client.auth.ram.identify.CredentialWatcher - [null] CredentialWatcher is stopped
2025-05-25 04:17:02.165 [SpringContextShutdownHook] INFO  c.a.n.client.auth.ram.identify.CredentialService - [null] CredentialService is freed
2025-05-25 04:17:02.165 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.NamingClientProxyDelegate do shutdown stop
2025-05-25 04:17:02.171 [SpringContextShutdownHook] DEBUG com.bgpay.bgai.config.AsyncConfig$1 - Shutting down ExecutorService 'blockingExecutor'
2025-05-25 04:17:02.798 [com.alibaba.nacos.client.Worker] INFO  c.a.n.client.auth.ram.identify.CredentialWatcher - null No credential found
2025-05-25 04:17:04.295 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:10911] result: true
2025-05-25 04:17:04.295 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:9876] result: true
2025-05-25 04:17:04.310 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:10911] result: true
2025-05-25 04:17:04.310 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:9876] result: true
2025-05-25 04:17:04.454 [SpringContextShutdownHook] INFO  o.s.orm.jpa.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-05-25 04:17:04.455 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-2} closing ...
2025-05-25 04:17:04.461 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-2} closed
2025-05-25 04:17:04.461 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} closing ...
2025-05-25 04:17:04.461 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} closed
2025-05-25 04:17:04.462 [NettyClientSelector_TMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - channel inactive: [id: 0xcabeab52, L:/192.168.86.8:62933 ! R:/8.133.246.113:8091]
2025-05-25 04:17:04.462 [NettyClientSelector_TMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - return to pool, rm channel:[id: 0xcabeab52, L:/192.168.86.8:62933 ! R:/8.133.246.113:8091]
2025-05-25 04:17:04.462 [NettyClientSelector_TMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - channel valid false,channel:[id: 0xcabeab52, L:/192.168.86.8:62933 ! R:/8.133.246.113:8091]
2025-05-25 04:17:04.462 [NettyClientSelector_TMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - will destroy channel:[id: 0xcabeab52, L:/192.168.86.8:62933 ! R:/8.133.246.113:8091]
2025-05-25 04:17:04.462 [NettyClientSelector_TMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0xcabeab52, L:/192.168.86.8:62933 ! R:/8.133.246.113:8091]) will closed
2025-05-25 04:17:04.462 [NettyClientSelector_TMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0xcabeab52, L:/192.168.86.8:62933 ! R:/8.133.246.113:8091]) will closed
2025-05-25 04:17:04.463 [NettyClientSelector_RMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - channel inactive: [id: 0x1c970b3a, L:/192.168.86.8:62935 ! R:/8.133.246.113:8091]
2025-05-25 04:17:04.463 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - return to pool, rm channel:[id: 0x1c970b3a, L:/192.168.86.8:62935 ! R:/8.133.246.113:8091]
2025-05-25 04:17:04.463 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - channel valid false,channel:[id: 0x1c970b3a, L:/192.168.86.8:62935 ! R:/8.133.246.113:8091]
2025-05-25 04:17:04.463 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - will destroy channel:[id: 0x1c970b3a, L:/192.168.86.8:62935 ! R:/8.133.246.113:8091]
2025-05-25 04:17:04.463 [NettyClientSelector_RMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0x1c970b3a, L:/192.168.86.8:62935 ! R:/8.133.246.113:8091]) will closed
2025-05-25 04:17:04.464 [NettyClientSelector_RMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0x1c970b3a, L:/192.168.86.8:62935 ! R:/8.133.246.113:8091]) will closed
2025-05-25 04:17:10.379 [main] WARN  com.alibaba.nacos.client.logging.NacosLogging - Load Logback Configuration of Nacos fail, message: Could not initialize Logback Nacos logging from classpath:nacos-logback.xml
2025-05-25 04:17:10.379 [main] INFO  com.bgpay.bgai.BgaiApplication - The following 1 profile is active: "dev"
2025-05-25 04:17:11.700 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-05-25 04:17:11.702 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-05-25 04:17:11.728 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 19 ms. Found 0 JPA repository interfaces.
2025-05-25 04:17:11.742 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-05-25 04:17:11.743 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-05-25 04:17:11.757 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 5 ms. Found 0 Redis repository interfaces.
2025-05-25 04:17:12.281 [main] INFO  io.seata.config.ConfigurationFactory - load Configuration from :Spring Configuration
2025-05-25 04:17:12.289 [main] INFO  io.seata.config.ConfigurationFactory - load Configuration from :Spring Configuration
2025-05-25 04:17:12.295 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Initializing Global Transaction Clients ... 
2025-05-25 04:17:12.390 [main] INFO  io.seata.core.rpc.netty.NettyClientBootstrap - NettyClientBootstrap has started
2025-05-25 04:17:12.391 [main] INFO  io.seata.discovery.registry.RegistryFactory - use registry center type: file
2025-05-25 04:17:12.400 [main] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - will connect to 8.133.246.113:8091
2025-05-25 04:17:12.405 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - NettyPool create channel to transactionRole:TMROLE,address:8.133.246.113:8091,msg:< RegisterTMRequest{version='1.7.0', applicationId='bgtech-ai', transactionServiceGroup='bgai-tx-group', extraData='ak=null
digest=bgai-tx-group,192.168.86.8,1748117832403
timestamp=1748117832403
authVersion=V4
vgroup=bgai-tx-group
ip=192.168.86.8
'} >
2025-05-25 04:17:12.578 [main] INFO  io.seata.core.rpc.netty.TmNettyRemotingClient - register TM success. client version:1.7.0, server version:1.8.1-SNAPSHOT,channel:[id: 0x13c7ad89, L:/192.168.86.8:63040 - R:/8.133.246.113:8091]
2025-05-25 04:17:12.588 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - register success, cost 96 ms, version:1.8.1-SNAPSHOT,role:TMROLE,channel:[id: 0x13c7ad89, L:/192.168.86.8:63040 - R:/8.133.246.113:8091]
2025-05-25 04:17:12.589 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Transaction Manager Client is initialized. applicationId[bgtech-ai] txServiceGroup[bgai-tx-group]
2025-05-25 04:17:12.606 [main] INFO  io.seata.rm.datasource.AsyncWorker - Async Commit Buffer Limit: 10000
2025-05-25 04:17:12.607 [main] INFO  io.seata.rm.datasource.xa.ResourceManagerXA - ResourceManagerXA init ...
2025-05-25 04:17:12.615 [main] INFO  io.seata.core.rpc.netty.NettyClientBootstrap - NettyClientBootstrap has started
2025-05-25 04:17:12.615 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Resource Manager is initialized. applicationId[bgtech-ai] txServiceGroup[bgai-tx-group]
2025-05-25 04:17:12.615 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Global Transaction Clients are initialized. 
2025-05-25 04:17:13.740 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat initialized with port(s): 8080 (http)
2025-05-25 04:17:13.752 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - The ["http-nio-8080"] connector has been configured to support HTTP upgrade to [h2c]
2025-05-25 04:17:13.752 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - Initializing ProtocolHandler ["http-nio-8080"]
2025-05-25 04:17:13.755 [main] INFO  org.apache.catalina.core.StandardService - Starting service [Tomcat]
2025-05-25 04:17:13.755 [main] INFO  org.apache.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.15]
2025-05-25 04:17:14.161 [main] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} inited
2025-05-25 04:17:14.419 [main] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - will connect to 8.133.246.113:8091
2025-05-25 04:17:14.419 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - RM will register :jdbc:mysql://8.133.246.113:3306/deepseek
2025-05-25 04:17:14.420 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - NettyPool create channel to transactionRole:RMROLE,address:8.133.246.113:8091,msg:< RegisterRMRequest{resourceIds='jdbc:mysql://8.133.246.113:3306/deepseek', version='1.7.0', applicationId='bgtech-ai', transactionServiceGroup='bgai-tx-group', extraData='null'} >
2025-05-25 04:17:14.438 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - register RM success. client version:1.7.0, server version:1.8.1-SNAPSHOT,channel:[id: 0x341387e9, L:/192.168.86.8:63043 - R:/8.133.246.113:8091]
2025-05-25 04:17:14.438 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - register success, cost 11 ms, version:1.8.1-SNAPSHOT,role:RMROLE,channel:[id: 0x341387e9, L:/192.168.86.8:63043 - R:/8.133.246.113:8091]
2025-05-25 04:17:14.440 [main] INFO  i.s.s.a.datasource.SeataAutoDataSourceProxyCreator - Auto proxy data source 'masterDataSource' by 'AT' mode.
2025-05-25 04:17:14.516 [main] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-2} inited
2025-05-25 04:17:14.588 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - will register resourceId:jdbc:mysql://8.133.246.113:3306/deepseek
2025-05-25 04:17:14.589 [main] INFO  i.s.s.a.datasource.SeataAutoDataSourceProxyCreator - Auto proxy data source 'slaveDataSource' by 'AT' mode.
2025-05-25 04:17:14.602 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.rm.AbstractRMHandler - the rm client received response msg [RegisterRMResponse{version='1.8.1-SNAPSHOT', extraData='null', identified=true, resultCode=null, msg='null'}] from tc server.
2025-05-25 04:17:14.616 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - will register resourceId:jdbc:mysql://8.133.246.113:3306/deepseek
2025-05-25 04:17:14.617 [main] INFO  i.s.s.a.datasource.SeataAutoDataSourceProxyCreator - Auto proxy data source 'dynamicDataSource' by 'AT' mode.
2025-05-25 04:17:14.629 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.rm.AbstractRMHandler - the rm client received response msg [RegisterRMResponse{version='1.8.1-SNAPSHOT', extraData='null', identified=true, resultCode=null, msg='null'}] from tc server.
2025-05-25 04:17:14.744 [main] INFO  org.hibernate.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-05-25 04:17:14.804 [main] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.1.7.Final
2025-05-25 04:17:15.142 [main] INFO  SQL dialect - HHH000400: Using dialect: org.hibernate.dialect.MySQL8Dialect
2025-05-25 04:17:15.144 [main] WARN  org.hibernate.orm.deprecation - HHH90000026: MySQL8Dialect has been deprecated; use org.hibernate.dialect.MySQLDialect instead
2025-05-25 04:17:15.416 [main] INFO  o.h.e.t.jta.platform.internal.JtaPlatformInitiator - HHH000490: Using JtaPlatform implementation: [org.hibernate.engine.transaction.jta.platform.internal.NoJtaPlatform]
2025-05-25 04:17:15.427 [main] INFO  o.s.orm.jpa.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-05-25 04:17:15.874 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-25 04:17:15.885 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-25 04:17:15.913 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-25 04:17:15.915 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-25 04:17:15.915 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-25 04:17:15.926 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-25 04:17:16.516 [main] INFO  com.bgpay.bgai.service.impl.UserServiceImpl - 初始化SSO配置: clientId=bgai-client-id, redirectUri=http://localhost:8080/api/auth/callback
2025-05-25 04:17:16.661 [main] INFO  com.bgpay.bgai.controller.AuthController - 初始化认证控制器: clientId=bgai-client-id, redirectUri=http://localhost:8080/api/auth/callback
2025-05-25 04:17:17.574 [main] INFO  org.redisson.Version - Redisson 3.24.3
2025-05-25 04:17:17.735 [redisson-netty-4-6] INFO  o.r.connection.pool.MasterPubSubConnectionPool - 1 connections initialized for 8.133.246.113/8.133.246.113:6379
2025-05-25 04:17:18.068 [redisson-netty-4-19] INFO  org.redisson.connection.pool.MasterConnectionPool - 24 connections initialized for 8.133.246.113/8.133.246.113:6379
2025-05-25 04:17:18.244 [main] INFO  o.a.r.s.autoconfigure.RocketMQAutoConfiguration - a producer (billing-producer-group) init on namesrv 8.133.246.113:9876
2025-05-25 04:17:18.913 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Bean [com.bgpay.bgai.service.deepseek.DeepSeekServiceImp$$SpringCGLIB$$0] with name [deepSeekServiceImp] would use interceptor [io.seata.spring.annotation.GlobalTransactionalInterceptor]
2025-05-25 04:17:19.206 [main] WARN  i.s.s.b.a.provider.SpringBootConfigurationProvider - The get method not found for the field 'SeataProperties#accesskey'.
2025-05-25 04:17:19.207 [main] WARN  i.s.s.b.a.provider.SpringBootConfigurationProvider - The get method not found for the field 'SeataProperties#secretkey'.
2025-05-25 04:17:19.218 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 加载到1个Saga状态机定义文件
2025-05-25 04:17:19.347 [main] INFO  com.bgpay.bgai.saga.CustomSagaJsonParser - 开始解析状态机定义: bgai-saga-transaction
2025-05-25 04:17:19.347 [main] INFO  com.bgpay.bgai.saga.CustomSagaJsonParser - 状态机定义解析成功: bgai-saga-transaction
2025-05-25 04:17:19.347 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 成功加载状态机定义: /E:/project/bgai/target/classes/statelang/bgai-saga-transaction.json
2025-05-25 04:17:19.484 [main] INFO  com.bgpay.bgai.service.mq.MQConsumerService - MQ consumer startup successful [group=billing-consumer-group, topic=BILLING_TOPIC, tag=USER_BILLING]
2025-05-25 04:17:19.640 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Bean [com.bgpay.bgai.service.mq.BillingTransactionListenerImpl$$SpringCGLIB$$0] with name [billingTransactionListenerImpl] would use interceptor [io.seata.spring.annotation.GlobalTransactionalInterceptor]
2025-05-25 04:17:19.776 [main] DEBUG com.bgpay.bgai.config.AsyncConfig$1 - Initializing ExecutorService 'blockingExecutor'
2025-05-25 04:17:19.805 [main] INFO  c.b.bgai.config.NacosConfig$NacosWarningHandler - Nacos警告处理器已启用，将忽略配置中心连接警告
2025-05-25 04:17:21.826 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [After]
2025-05-25 04:17:21.826 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Before]
2025-05-25 04:17:21.826 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Between]
2025-05-25 04:17:21.826 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Cookie]
2025-05-25 04:17:21.826 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Header]
2025-05-25 04:17:21.826 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Host]
2025-05-25 04:17:21.826 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Method]
2025-05-25 04:17:21.826 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Path]
2025-05-25 04:17:21.826 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Query]
2025-05-25 04:17:21.826 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [ReadBody]
2025-05-25 04:17:21.826 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [RemoteAddr]
2025-05-25 04:17:21.826 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [XForwardedRemoteAddr]
2025-05-25 04:17:21.826 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Weight]
2025-05-25 04:17:21.826 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [CloudFoundryRouteService]
2025-05-25 04:17:23.150 [main] INFO  o.s.b.actuate.endpoint.web.EndpointLinksResolver - Exposing 3 endpoint(s) beneath base path '/actuator'
2025-05-25 04:17:24.909 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - Starting ProtocolHandler ["http-nio-8080"]
2025-05-25 04:17:24.927 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat started on port(s): 8080 (http) with context path ''
2025-05-25 04:17:24.938 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from ans.namespace attribute : null
2025-05-25 04:17:24.939 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from ALIBABA_ALIWARE_NAMESPACE attribute :null
2025-05-25 04:17:24.940 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from namespace attribute :null
2025-05-25 04:17:24.949 [main] INFO  c.a.n.p.auth.spi.client.ClientAuthPluginManager - [ClientAuthPluginManager] Load ClientAuthService com.alibaba.nacos.client.auth.impl.NacosClientAuthServiceImpl success.
2025-05-25 04:17:24.949 [main] INFO  c.a.n.p.auth.spi.client.ClientAuthPluginManager - [ClientAuthPluginManager] Load ClientAuthService com.alibaba.nacos.client.auth.ram.RamClientAuthServiceImpl success.
2025-05-25 04:17:24.953 [main] INFO  com.alibaba.nacos.common.remote.client - [RpcClientFactory] create a new rpc client of 2368775a-3573-4741-86ff-ba0eb7ed0319
2025-05-25 04:17:24.956 [main] INFO  com.alibaba.nacos.common.remote.client - [2368775a-3573-4741-86ff-ba0eb7ed0319] RpcClient init, ServerListFactory = com.alibaba.nacos.client.naming.core.ServerListManager
2025-05-25 04:17:24.956 [main] INFO  com.alibaba.nacos.common.remote.client - [2368775a-3573-4741-86ff-ba0eb7ed0319] Registry connection listener to current client:com.alibaba.nacos.client.naming.remote.gprc.redo.NamingGrpcRedoService
2025-05-25 04:17:24.957 [main] INFO  com.alibaba.nacos.common.remote.client - [2368775a-3573-4741-86ff-ba0eb7ed0319] Register server push request handler:com.alibaba.nacos.client.naming.remote.gprc.NamingPushRequestHandler
2025-05-25 04:17:24.958 [main] INFO  com.alibaba.nacos.common.remote.client - [2368775a-3573-4741-86ff-ba0eb7ed0319] Try to connect to server on start up, server: {serverIp = '8.133.246.113', server main port = 8848}
2025-05-25 04:17:24.958 [main] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - grpc client connection server:8.133.246.113 ip,serverPort:9848,grpcTslConfig:{"sslProvider":"OPENSSL","enableTls":false,"mutualAuthEnable":false,"trustAll":false}
2025-05-25 04:17:25.084 [main] INFO  com.alibaba.nacos.common.remote.client - [2368775a-3573-4741-86ff-ba0eb7ed0319] Success to connect to server [8.133.246.113:8848] on start up, connectionId = 1748117845006_139.227.195.192_48812
2025-05-25 04:17:25.084 [main] INFO  com.alibaba.nacos.common.remote.client - [2368775a-3573-4741-86ff-ba0eb7ed0319] Register server push request handler:com.alibaba.nacos.common.remote.client.RpcClient$ConnectResetRequestHandler
2025-05-25 04:17:25.084 [com.alibaba.nacos.client.remote.worker] INFO  com.alibaba.nacos.common.remote.client - [2368775a-3573-4741-86ff-ba0eb7ed0319] Notify connected event to listeners.
2025-05-25 04:17:25.084 [main] INFO  com.alibaba.nacos.common.remote.client - [2368775a-3573-4741-86ff-ba0eb7ed0319] Register server push request handler:com.alibaba.nacos.common.remote.client.RpcClient$$Lambda/0x000001ce04528000
2025-05-25 04:17:25.084 [com.alibaba.nacos.client.remote.worker] INFO  com.alibaba.nacos.client.naming - Grpc connection connect
2025-05-25 04:17:25.086 [main] INFO  com.alibaba.nacos.client.naming - [REGISTER-SERVICE] d750d92e-152f-4055-a641-3bc9dda85a29 registering service bgtech-ai with instance Instance{instanceId='null', ip='192.168.86.8', port=8080, weight=1.0, healthy=true, enabled=true, ephemeral=true, clusterName='DEFAULT', serviceName='null', metadata={IPv6=[2408:820c:7528:d042:c185:8edc:f30d:3d91], preserved.register.source=SPRING_CLOUD}}
2025-05-25 04:17:25.106 [main] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - nacos registry, DEFAULT_GROUP bgtech-ai 192.168.86.8:8080 register finished
2025-05-25 04:17:25.171 [main] INFO  com.bgpay.bgai.config.NacosConfig - 应用启动完成，当前环境: dev
2025-05-25 04:17:25.171 [main] INFO  com.bgpay.bgai.config.NacosConfig - Nacos配置中心: 8.133.246.113:8848, 命名空间: d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-25 04:17:25.172 [main] INFO  com.bgpay.bgai.config.NacosConfig - 注意: 如果看到Nacos配置加载警告，但应用正常启动，说明应用正在使用本地配置文件
2025-05-25 04:17:25.175 [main] INFO  com.bgpay.bgai.BgaiApplication - Started BgaiApplication in 16.83 seconds (process running for 18.313)
2025-05-25 04:17:25.179 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-25 04:17:25.179 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-25 04:17:25.192 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-25 04:17:25.192 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-25 04:17:25.193 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-25 04:17:25.202 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-25 04:17:25.202 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-25 04:17:25.203 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-25 04:17:25.211 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-25 04:17:25.212 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-25 04:17:25.212 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-25 04:17:25.218 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-25 04:17:25.218 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - ==================== Saga状态机加载报告 ====================
2025-05-25 04:17:25.218 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - Saga状态机配置加载状态: 成功
2025-05-25 04:17:25.219 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 已加载的状态机定义文件数量: 1
2025-05-25 04:17:25.219 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 已加载的状态机定义文件:
2025-05-25 04:17:25.219 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig -  - /E:/project/bgai/target/classes/statelang/bgai-saga-transaction.json
2025-05-25 04:17:25.219 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - Saga解析器状态: CUSTOM_FASTJSON2
2025-05-25 04:17:25.219 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 状态机解析结果: 成功 1 个, 失败 0 个
2025-05-25 04:17:25.219 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - =============================================================
2025-05-25 04:17:25.225 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - nacos.cache.data.init.snapshot = true 
2025-05-25 04:17:25.226 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] common-dev.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-25 04:17:25.236 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=common-dev.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-25 04:17:25.236 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=common-dev.yaml, group=DEFAULT_GROUP
2025-05-25 04:17:25.236 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-25 04:17:25.236 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-25 04:17:25.236 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai.yaml, group=DEFAULT_GROUP
2025-05-25 04:17:25.238 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai-dev.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-25 04:17:25.238 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai-dev.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-25 04:17:25.238 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai-dev.yaml, group=DEFAULT_GROUP
2025-05-25 04:17:25.239 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-25 04:17:25.239 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai, group=DEFAULT_GROUP, cnt=1
2025-05-25 04:17:25.239 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai, group=DEFAULT_GROUP
2025-05-25 04:17:56.993 [http-nio-8080-exec-3] INFO  com.bgpay.bgai.controller.ReactiveChatController - 接收到请求: /api/chatGatWay-internal, 文件=新文件 17.txt, 问题参数=null, 模型参数=null
2025-05-25 04:17:56.995 [http-nio-8080-exec-3] INFO  com.bgpay.bgai.controller.ReactiveChatController - 请求Content-Type: multipart/form-data;boundary=--------------------------498763554322479711667618
2025-05-25 04:17:56.996 [http-nio-8080-exec-3] INFO  com.bgpay.bgai.controller.ReactiveChatController - 收集到的完整参数: question="null", apiUrl="null", modelName="null", multiTurn=false
2025-05-25 04:17:56.997 [http-nio-8080-exec-3] INFO  com.bgpay.bgai.controller.ReactiveChatController - Processing request for user ID: 689258T
2025-05-25 04:17:56.997 [http-nio-8080-exec-3] INFO  com.bgpay.bgai.controller.ReactiveChatController - Processing file with circuit breaker: fileName=新文件 17.txt, question=
2025-05-25 04:17:56.999 [http-nio-8080-exec-3] INFO  com.bgpay.bgai.config.ReactiveFileProcessor - Processing file: 新文件 17.txt, content-type: text/plain
2025-05-25 04:17:57.005 [http-nio-8080-exec-3] INFO  com.bgpay.bgai.controller.ReactiveChatController - PARAM TRACE [689258T]: 尝试查找匹配配置 - 参数: apiUrl=null, modelName=null
2025-05-25 04:17:57.016 [http-nio-8080-exec-3] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 查询配置 - userId=689258T
2025-05-25 04:17:57.017 [http-nio-8080-exec-3] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 排序方式 - 按ID降序
2025-05-25 04:17:57.017 [http-nio-8080-exec-3] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 限制结果数 - LIMIT 1
2025-05-25 04:17:57.092 [http-nio-8080-exec-3] DEBUG com.bgpay.bgai.mapper.ApiConfigMapper.selectList - ==>  Preparing: SELECT id,api_url,api_key,model_name,user_id FROM api_config WHERE (user_id = ?) ORDER BY id DESC LIMIT 1
2025-05-25 04:17:57.094 [http-nio-8080-exec-3] DEBUG com.bgpay.bgai.mapper.ApiConfigMapper.selectList - ==> Parameters: 689258T(String)
2025-05-25 04:17:57.109 [http-nio-8080-exec-3] DEBUG com.bgpay.bgai.mapper.ApiConfigMapper.selectList - <==      Total: 1
2025-05-25 04:17:57.110 [http-nio-8080-exec-3] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 查询结果 - 找到配置: id=2, modelName=deepseek-chat
2025-05-25 04:17:57.110 [http-nio-8080-exec-3] INFO  com.bgpay.bgai.controller.ReactiveChatController - PARAM TRACE [689258T]: 找到匹配配置 - apiUrl=https://api.deepseek.com/chat/completions, modelName=deepseek-chat (原始请求: null)
2025-05-25 04:17:57.110 [http-nio-8080-exec-3] INFO  com.bgpay.bgai.controller.ReactiveChatController - API config resolved: url=https://api.deepseek.com/chat/completions, model=deepseek-chat
2025-05-25 04:17:57.129 [Thread-54] INFO  com.bgpay.bgai.config.ReactiveFileProcessor - File processed successfully: size=37 bytes
2025-05-25 04:17:57.134 [Thread-54] INFO  com.bgpay.bgai.controller.ReactiveChatController - Content processed, length: 54
2025-05-25 04:17:57.143 [Thread-54] INFO  io.seata.tm.TransactionManagerHolder - TransactionManager Singleton io.seata.tm.DefaultTransactionManager@1f52ed2c
2025-05-25 04:17:57.158 [Thread-54] INFO  io.seata.tm.api.DefaultGlobalTransaction - Begin new global transaction [seata-server:8091:117747646027194399]
2025-05-25 04:17:57.160 [Thread-54] INFO  c.b.bgai.interceptor.SeataTransactionInterceptor - 准备记录分布式事务开始: XID=seata-server:8091:117747646027194399, 业务=com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive, 路径=, IP=, 用户=system
2025-05-25 04:17:57.176 [Thread-54] INFO  c.b.bgai.service.impl.TransactionLogServiceImpl - 记录分布式事务开始: XID=seata-server:8091:117747646027194399, 业务=com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive
2025-05-25 04:17:57.182 [Thread-54] DEBUG com.bgpay.bgai.mapper.TransactionLogMapper.insert - ==>  Preparing: INSERT INTO transaction_log ( xid, transaction_name, transaction_mode, status, request_path, source_ip, start_time, user_id, create_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-05-25 04:17:57.186 [Thread-54] DEBUG com.bgpay.bgai.mapper.TransactionLogMapper.insert - ==> Parameters: seata-server:8091:117747646027194399(String), com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive(String), AT(String), ACTIVE(String), (String), (String), 2025-05-25T04:17:57.176899500(LocalDateTime), system(String), 2025-05-25T04:17:57.176899500(LocalDateTime)
2025-05-25 04:17:57.553 [Thread-54] DEBUG com.bgpay.bgai.mapper.TransactionLogMapper.insert - <==    Updates: 1
2025-05-25 04:17:57.580 [Thread-54] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:117747646027194399, branchId:117747646027194400, lockKeys:transaction_log:59
2025-05-25 04:17:57.590 [Thread-54] WARN  i.s.c.l.EnhancedServiceLoader$InnerEnhancedServiceLoader - Load [io.seata.rm.datasource.undo.parser.ProtostuffUndoLogParser] class fail: io/protostuff/runtime/IdStrategy
2025-05-25 04:17:57.655 [Thread-54] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:117747646027194399, branchId:117747646027194401, lockKeys:transaction_log:59;undo_log:243
2025-05-25 04:17:57.682 [Thread-54] INFO  c.b.bgai.interceptor.SeataTransactionInterceptor - 开始分布式事务: XID=seata-server:8091:117747646027194399, 方法=com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive
2025-05-25 04:17:57.693 [Thread-54] INFO  org.reflections.Reflections - Processing reactive request: content length=54, apiUrl=https://api.deepseek.com/chat/completions, modelName=deepseek-chat, userId=689258T, multiTurn=false
2025-05-25 04:17:57.699 [Thread-54] INFO  c.b.bgai.service.impl.TransactionLogServiceImpl - 记录分布式事务结束: XID=seata-server:8091:117747646027194399, 状态=COMMITTED
2025-05-25 04:17:57.701 [Thread-54] DEBUG c.b.bgai.mapper.TransactionLogMapper.selectList - ==>  Preparing: SELECT id,xid,branch_id,transaction_name,transaction_mode,status,request_path,source_ip,start_time,end_time,user_id,extra_data,create_time,update_time FROM transaction_log WHERE (xid = ?) LIMIT 1
2025-05-25 04:17:57.703 [Thread-54] DEBUG c.b.bgai.mapper.TransactionLogMapper.selectList - ==> Parameters: seata-server:8091:117747646027194399(String)
2025-05-25 04:17:57.709 [Thread-54] DEBUG c.b.bgai.mapper.TransactionLogMapper.selectList - <==      Total: 1
2025-05-25 04:17:57.713 [Thread-54] DEBUG c.b.bgai.mapper.TransactionLogMapper.updateById - ==>  Preparing: UPDATE transaction_log SET xid=?, transaction_name=?, transaction_mode=?, status=?, request_path=?, source_ip=?, start_time=?, end_time=?, user_id=?, extra_data=?, create_time=?, update_time=? WHERE id=?
2025-05-25 04:17:57.719 [Thread-54] DEBUG c.b.bgai.mapper.TransactionLogMapper.updateById - ==> Parameters: seata-server:8091:117747646027194399(String), com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive(String), AT(String), COMMITTED(String), (String), (String), 2025-05-25T04:17:57(LocalDateTime), 2025-05-25T04:17:57.709525800(LocalDateTime), system(String), {"duration":12,"result":"success"}(String), 2025-05-25T04:17:57(LocalDateTime), 2025-05-25T04:17:57.709525800(LocalDateTime), 59(Long)
2025-05-25 04:17:57.768 [Thread-54] DEBUG c.b.bgai.mapper.TransactionLogMapper.updateById - <==    Updates: 1
2025-05-25 04:17:57.777 [Thread-54] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:117747646027194399, branchId:117747646027194402, lockKeys:transaction_log:59
2025-05-25 04:17:57.805 [Thread-54] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:117747646027194399, branchId:117747646027194403, lockKeys:transaction_log:59;undo_log:245
2025-05-25 04:17:57.830 [Thread-54] INFO  c.b.bgai.interceptor.SeataTransactionInterceptor - 分布式事务成功完成: XID=seata-server:8091:117747646027194399, 耗时=12ms
2025-05-25 04:17:57.830 [Thread-54] INFO  io.seata.tm.api.DefaultGlobalTransaction - transaction seata-server:8091:117747646027194399 will be commit
2025-05-25 04:17:57.840 [Thread-54] INFO  io.seata.tm.api.DefaultGlobalTransaction - transaction end, xid = seata-server:8091:117747646027194399
2025-05-25 04:17:57.841 [Thread-54] INFO  io.seata.tm.api.DefaultGlobalTransaction - [seata-server:8091:117747646027194399] commit status: Committed
2025-05-25 04:17:57.926 [boundedElastic-1] INFO  com.bgpay.bgai.transaction.TransactionCoordinator - Transaction prepared for user 689258T: chatCompletionId=chat-e3ee0d27-b31d-42b3-a856-b4b3b7b3eeae
2025-05-25 04:17:57.926 [boundedElastic-1] INFO  org.reflections.Reflections - Transaction prepared with chatCompletionId: chat-e3ee0d27-b31d-42b3-a856-b4b3b7b3eeae
2025-05-25 04:17:58.340 [rpcDispatch_RMROLE_1_1_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:117747646027194399', branchId=117747646027194400, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false,"skipCheckLock":true}'}
2025-05-25 04:17:58.341 [rpcDispatch_RMROLE_1_1_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:117747646027194399 117747646027194400 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false,"skipCheckLock":true}
2025-05-25 04:17:58.342 [rpcDispatch_RMROLE_1_1_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-25 04:17:58.359 [rpcDispatch_RMROLE_1_2_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:117747646027194399', branchId=117747646027194401, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false,"skipCheckLock":true}'}
2025-05-25 04:17:58.359 [rpcDispatch_RMROLE_1_2_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:117747646027194399 117747646027194401 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false,"skipCheckLock":true}
2025-05-25 04:17:58.359 [rpcDispatch_RMROLE_1_2_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-25 04:17:58.370 [rpcDispatch_RMROLE_1_3_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:117747646027194399', branchId=117747646027194402, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false}'}
2025-05-25 04:17:58.370 [rpcDispatch_RMROLE_1_3_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:117747646027194399 117747646027194402 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false}
2025-05-25 04:17:58.370 [rpcDispatch_RMROLE_1_3_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-25 04:17:58.385 [rpcDispatch_RMROLE_1_4_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:117747646027194399', branchId=117747646027194403, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false}'}
2025-05-25 04:17:58.386 [rpcDispatch_RMROLE_1_4_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:117747646027194399 117747646027194403 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false}
2025-05-25 04:17:58.386 [rpcDispatch_RMROLE_1_4_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-25 04:18:33.049 [FileWrite-1] INFO  com.bgpay.bgai.service.deepseek.FileWriterService - Successfully wrote content to: \var\data\ai_responses\4abe5536-91eb-46db-bf0c-79da869101ac.txt
2025-05-25 04:18:33.062 [reactor-http-nio-2] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - ==>  Preparing: INSERT INTO chat_completions ( object, created, model, system_fingerprint, api_key ) VALUES ( ?, ?, ?, ?, ? )
2025-05-25 04:18:33.062 [reactor-http-nio-2] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - ==> Parameters: chat.completion(String), 1748117913060(Long), deepseek-chat(String), 689258T(String), chat-e3ee0d27-b31d-42b3-a856-b4b3b7b3eeae(String)
2025-05-25 04:18:33.075 [reactor-http-nio-2] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - <==    Updates: 1
2025-05-25 04:18:33.075 [reactor-http-nio-2] INFO  com.bgpay.bgai.transaction.TransactionCoordinator - Transaction committed for user 689258T: chatCompletionId=chat-e3ee0d27-b31d-42b3-a856-b4b3b7b3eeae
2025-05-25 04:18:33.100 [reactor-http-nio-2] INFO  org.reflections.Reflections - 开始发送账单消息，chatCompletionId: chat-e3ee0d27-b31d-42b3-a856-b4b3b7b3eeae, userId: 689258T
2025-05-25 04:18:33.153 [reactor-http-nio-2] INFO  io.seata.tm.api.DefaultGlobalTransaction - Begin new global transaction [seata-server:8091:117747646027194404]
2025-05-25 04:18:33.153 [reactor-http-nio-2] INFO  c.b.bgai.interceptor.SeataTransactionInterceptor - 准备记录分布式事务开始: XID=seata-server:8091:117747646027194404, 业务=com.bgpay.bgai.service.mq.BillingTransactionListenerImpl.executeLocalTransaction, 路径=, IP=, 用户=system
2025-05-25 04:18:33.160 [reactor-http-nio-2] INFO  c.b.bgai.service.impl.TransactionLogServiceImpl - 记录分布式事务开始: XID=seata-server:8091:117747646027194404, 业务=com.bgpay.bgai.service.mq.BillingTransactionListenerImpl.executeLocalTransaction
2025-05-25 04:18:33.161 [reactor-http-nio-2] DEBUG com.bgpay.bgai.mapper.TransactionLogMapper.insert - ==>  Preparing: INSERT INTO transaction_log ( xid, transaction_name, transaction_mode, status, request_path, source_ip, start_time, user_id, create_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-05-25 04:18:33.161 [reactor-http-nio-2] DEBUG com.bgpay.bgai.mapper.TransactionLogMapper.insert - ==> Parameters: seata-server:8091:117747646027194404(String), com.bgpay.bgai.service.mq.BillingTransactionListenerImpl.executeLocalTransaction(String), AT(String), ACTIVE(String), (String), (String), 2025-05-25T04:18:33.160131500(LocalDateTime), system(String), 2025-05-25T04:18:33.160131500(LocalDateTime)
2025-05-25 04:18:33.187 [reactor-http-nio-2] DEBUG com.bgpay.bgai.mapper.TransactionLogMapper.insert - <==    Updates: 1
2025-05-25 04:18:33.197 [reactor-http-nio-2] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:117747646027194404, branchId:117747646027194405, lockKeys:transaction_log:60
2025-05-25 04:18:33.217 [reactor-http-nio-2] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:117747646027194404, branchId:117747646027194406, lockKeys:undo_log:247;transaction_log:60
2025-05-25 04:18:33.242 [reactor-http-nio-2] INFO  c.b.bgai.interceptor.SeataTransactionInterceptor - 开始分布式事务: XID=seata-server:8091:117747646027194404, 方法=com.bgpay.bgai.service.mq.BillingTransactionListenerImpl.executeLocalTransaction
2025-05-25 04:18:33.242 [reactor-http-nio-2] INFO  c.b.bgai.service.mq.BillingTransactionListenerImpl - 开始执行本地事务, xid: seata-server:8091:117747646027194404, userId: 689258T, completionId: chat-e3ee0d27-b31d-42b3-a856-b4b3b7b3eeae
2025-05-25 04:18:33.253 [reactor-http-nio-2] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.selectCount - ==>  Preparing: SELECT COUNT( * ) AS total FROM usage_info WHERE (chat_completion_id = ?)
2025-05-25 04:18:33.254 [reactor-http-nio-2] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.selectCount - ==> Parameters: chat-e3ee0d27-b31d-42b3-a856-b4b3b7b3eeae(String)
2025-05-25 04:18:33.262 [reactor-http-nio-2] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.selectCount - <==      Total: 1
2025-05-25 04:18:33.323 [reactor-http-nio-2] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.selectCount - ==>  Preparing: SELECT COUNT( * ) AS total FROM usage_info WHERE (chat_completion_id = ?)
2025-05-25 04:18:33.324 [reactor-http-nio-2] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.selectCount - ==> Parameters: chat-e3ee0d27-b31d-42b3-a856-b4b3b7b3eeae(String)
2025-05-25 04:18:33.329 [reactor-http-nio-2] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.selectCount - <==      Total: 1
2025-05-25 04:18:33.394 [reactor-http-nio-2] INFO  com.bgpay.bgai.service.impl.UsageInfoServiceImpl - Output price config priceVersion: 1
2025-05-25 04:18:33.397 [reactor-http-nio-2] DEBUG com.bgpay.bgai.mapper.UsageRecordMapper.insert - ==>  Preparing: INSERT INTO usage_record ( model_type, chat_completion_id, user_id, input_cost, output_cost, price_version, calculated_at, input_tokens, output_tokens, status, created_at ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-05-25 04:18:33.399 [reactor-http-nio-2] DEBUG com.bgpay.bgai.mapper.UsageRecordMapper.insert - ==> Parameters: deepseek-chat(String), chat-e3ee0d27-b31d-42b3-a856-b4b3b7b3eeae(String), 689258T(String), 0.030(BigDecimal), 1.636(BigDecimal), 1(Integer), 2025-05-25T04:18:33.099130600(LocalDateTime), 30(Integer), 818(Integer), PENDING(String), 2025-05-25T04:18:33.329132(LocalDateTime)
2025-05-25 04:18:33.456 [reactor-http-nio-2] DEBUG com.bgpay.bgai.mapper.UsageRecordMapper.insert - <==    Updates: 1
2025-05-25 04:18:33.460 [reactor-http-nio-2] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.insert - ==>  Preparing: INSERT INTO usage_info ( chat_completion_id, prompt_tokens, completion_tokens, total_tokens, prompt_tokens_cached, completion_reasoning_tokens, prompt_cache_hit_tokens, prompt_cache_miss_tokens, created_at, model_type ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-05-25 04:18:33.460 [reactor-http-nio-2] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.insert - ==> Parameters: chat-e3ee0d27-b31d-42b3-a856-b4b3b7b3eeae(String), 30(Integer), 818(Integer), 848(Integer), 0(Integer), 0(Integer), 0(Integer), 30(Integer), 2025-05-25T04:18:33.457131900(LocalDateTime), deepseek-chat(String)
2025-05-25 04:18:33.514 [reactor-http-nio-2] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.insert - <==    Updates: 1
2025-05-25 04:18:33.524 [reactor-http-nio-2] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:117747646027194404, branchId:117747646027194407, lockKeys:usage_info:263;usage_record:179
2025-05-25 04:18:33.549 [reactor-http-nio-2] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:117747646027194404, branchId:117747646027194408, lockKeys:undo_log:249;usage_info:263;usage_record:179
2025-05-25 04:18:33.586 [reactor-http-nio-2] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - ==>  Preparing: INSERT INTO chat_completions ( object, created, model, system_fingerprint, api_key ) VALUES ( ?, ?, ?, ?, ? )
2025-05-25 04:18:33.586 [reactor-http-nio-2] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - ==> Parameters: chat.completion(String), 1748117913585(Long), deepseek-chat(String), 689258T(String), chat-e3ee0d27-b31d-42b3-a856-b4b3b7b3eeae(String)
2025-05-25 04:18:33.640 [reactor-http-nio-2] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - <==    Updates: 1
2025-05-25 04:18:33.641 [reactor-http-nio-2] INFO  com.bgpay.bgai.transaction.TransactionCoordinator - Transaction committed for user 689258T: chatCompletionId=chat-e3ee0d27-b31d-42b3-a856-b4b3b7b3eeae
2025-05-25 04:18:33.650 [reactor-http-nio-2] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:117747646027194404, branchId:117747646027194409, lockKeys:chat_completions:346
2025-05-25 04:18:33.669 [reactor-http-nio-2] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:117747646027194404, branchId:117747646027194410, lockKeys:chat_completions:346;undo_log:251
2025-05-25 04:18:33.691 [reactor-http-nio-2] INFO  c.b.bgai.service.mq.BillingTransactionListenerImpl - 本地事务执行成功，提交事务, completionId: chat-e3ee0d27-b31d-42b3-a856-b4b3b7b3eeae
2025-05-25 04:18:33.696 [reactor-http-nio-2] INFO  c.b.bgai.service.impl.TransactionLogServiceImpl - 记录分布式事务结束: XID=seata-server:8091:117747646027194404, 状态=COMMITTED
2025-05-25 04:18:33.697 [reactor-http-nio-2] DEBUG c.b.bgai.mapper.TransactionLogMapper.selectList - ==>  Preparing: SELECT id,xid,branch_id,transaction_name,transaction_mode,status,request_path,source_ip,start_time,end_time,user_id,extra_data,create_time,update_time FROM transaction_log WHERE (xid = ?) LIMIT 1
2025-05-25 04:18:33.697 [reactor-http-nio-2] DEBUG c.b.bgai.mapper.TransactionLogMapper.selectList - ==> Parameters: seata-server:8091:117747646027194404(String)
2025-05-25 04:18:33.703 [reactor-http-nio-2] DEBUG c.b.bgai.mapper.TransactionLogMapper.selectList - <==      Total: 1
2025-05-25 04:18:33.704 [reactor-http-nio-2] DEBUG c.b.bgai.mapper.TransactionLogMapper.updateById - ==>  Preparing: UPDATE transaction_log SET xid=?, transaction_name=?, transaction_mode=?, status=?, request_path=?, source_ip=?, start_time=?, end_time=?, user_id=?, extra_data=?, create_time=?, update_time=? WHERE id=?
2025-05-25 04:18:33.705 [reactor-http-nio-2] DEBUG c.b.bgai.mapper.TransactionLogMapper.updateById - ==> Parameters: seata-server:8091:117747646027194404(String), com.bgpay.bgai.service.mq.BillingTransactionListenerImpl.executeLocalTransaction(String), AT(String), COMMITTED(String), (String), (String), 2025-05-25T04:18:33(LocalDateTime), 2025-05-25T04:18:33.703734600(LocalDateTime), system(String), {"duration":449,"result":"success"}(String), 2025-05-25T04:18:33(LocalDateTime), 2025-05-25T04:18:33.703734600(LocalDateTime), 60(Long)
2025-05-25 04:18:33.739 [reactor-http-nio-2] DEBUG c.b.bgai.mapper.TransactionLogMapper.updateById - <==    Updates: 1
2025-05-25 04:18:33.748 [reactor-http-nio-2] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:117747646027194404, branchId:117747646027194411, lockKeys:transaction_log:60
2025-05-25 04:18:33.769 [reactor-http-nio-2] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:117747646027194404, branchId:117747646027194412, lockKeys:transaction_log:60;undo_log:253
2025-05-25 04:18:33.794 [reactor-http-nio-2] INFO  c.b.bgai.interceptor.SeataTransactionInterceptor - 分布式事务成功完成: XID=seata-server:8091:117747646027194404, 耗时=449ms
2025-05-25 04:18:33.794 [reactor-http-nio-2] INFO  io.seata.tm.api.DefaultGlobalTransaction - transaction seata-server:8091:117747646027194404 will be commit
2025-05-25 04:18:33.803 [reactor-http-nio-2] INFO  io.seata.tm.api.DefaultGlobalTransaction - transaction end, xid = seata-server:8091:117747646027194404
2025-05-25 04:18:33.803 [reactor-http-nio-2] INFO  io.seata.tm.api.DefaultGlobalTransaction - [seata-server:8091:117747646027194404] commit status: Committed
2025-05-25 04:18:33.806 [reactor-http-nio-2] INFO  org.reflections.Reflections - 账单消息发送成功，chatCompletionId: chat-e3ee0d27-b31d-42b3-a856-b4b3b7b3eeae, userId: 689258T
2025-05-25 04:18:33.811 [reactor-http-nio-2] INFO  com.bgpay.bgai.service.impl.BGAIServiceImpl - 执行第一步操作 - 发送账单消息, businessKey: 689258T:chat-e3ee0d27-b31d-42b3-a856-b4b3b7b3eeae
2025-05-25 04:18:33.812 [reactor-http-nio-2] DEBUG c.bgpay.bgai.mapper.UsageRecordMapper.selectCount - ==>  Preparing: SELECT COUNT( * ) AS total FROM usage_record WHERE (chat_completion_id = ?)
2025-05-25 04:18:33.812 [reactor-http-nio-2] DEBUG c.bgpay.bgai.mapper.UsageRecordMapper.selectCount - ==> Parameters: chat-e3ee0d27-b31d-42b3-a856-b4b3b7b3eeae(String)
2025-05-25 04:18:33.817 [reactor-http-nio-2] DEBUG c.bgpay.bgai.mapper.UsageRecordMapper.selectCount - <==      Total: 1
2025-05-25 04:18:33.817 [reactor-http-nio-2] INFO  com.bgpay.bgai.service.impl.BGAIServiceImpl - 账单消息已处理，跳过发送, completionId: chat-e3ee0d27-b31d-42b3-a856-b4b3b7b3eeae
2025-05-25 04:18:33.827 [reactor-http-nio-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - Processed response for user 689258T, content length: 2871
2025-05-25 04:18:33.840 [ConsumeMessageThread_billing-consumer-group_1] WARN  com.alibaba.druid.pool.DruidAbstractDataSource - discard long time none received connection. , jdbcUrl : jdbc:mysql://8.133.246.113:3306/deepseek?autoReconnect=false&useUnicode=true&characterEncoding=UTF-8&characterSetResults=UTF-8&zeroDateTimeBehavior=convertToNull&useSSL=false&allowPublicKeyRetrieval=true&useSSL=false, version : 1.2.8, lastPacketReceivedIdleMillis : 68613
2025-05-25 04:18:33.840 [ConsumeMessageThread_billing-consumer-group_1] DEBUG c.bgpay.bgai.mapper.UsageRecordMapper.selectCount - ==>  Preparing: SELECT COUNT( * ) AS total FROM usage_record WHERE (chat_completion_id = ?)
2025-05-25 04:18:33.840 [ConsumeMessageThread_billing-consumer-group_1] DEBUG c.bgpay.bgai.mapper.UsageRecordMapper.selectCount - ==> Parameters: chat-e3ee0d27-b31d-42b3-a856-b4b3b7b3eeae(String)
2025-05-25 04:18:33.851 [ConsumeMessageThread_billing-consumer-group_1] DEBUG c.bgpay.bgai.mapper.UsageRecordMapper.selectCount - <==      Total: 1
2025-05-25 04:18:33.852 [ConsumeMessageThread_billing-consumer-group_1] DEBUG c.bgpay.bgai.service.mq.RocketMQBillingServiceImpl - 消息已处理 [CompletionId=chat-e3ee0d27-b31d-42b3-a856-b4b3b7b3eeae]
2025-05-25 04:18:33.853 [ConsumeMessageThread_billing-consumer-group_1] INFO  c.bgpay.bgai.service.mq.RocketMQBillingServiceImpl - Message consumed: 2408820C7528D042C1858EDCF30D3D91344036BAF30C7C8556250000
2025-05-25 04:18:34.336 [rpcDispatch_RMROLE_1_5_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:117747646027194404', branchId=117747646027194405, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false,"skipCheckLock":true}'}
2025-05-25 04:18:34.337 [rpcDispatch_RMROLE_1_5_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:117747646027194404 117747646027194405 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false,"skipCheckLock":true}
2025-05-25 04:18:34.337 [rpcDispatch_RMROLE_1_5_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-25 04:18:34.344 [rpcDispatch_RMROLE_1_6_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:117747646027194404', branchId=117747646027194406, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false,"skipCheckLock":true}'}
2025-05-25 04:18:34.345 [rpcDispatch_RMROLE_1_6_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:117747646027194404 117747646027194406 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false,"skipCheckLock":true}
2025-05-25 04:18:34.345 [rpcDispatch_RMROLE_1_6_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-25 04:18:34.353 [rpcDispatch_RMROLE_1_7_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:117747646027194404', branchId=117747646027194407, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false,"skipCheckLock":true}'}
2025-05-25 04:18:34.353 [rpcDispatch_RMROLE_1_7_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:117747646027194404 117747646027194407 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false,"skipCheckLock":true}
2025-05-25 04:18:34.353 [rpcDispatch_RMROLE_1_7_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-25 04:18:34.361 [rpcDispatch_RMROLE_1_8_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:117747646027194404', branchId=117747646027194408, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false,"skipCheckLock":true}'}
2025-05-25 04:18:34.361 [rpcDispatch_RMROLE_1_8_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:117747646027194404 117747646027194408 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false,"skipCheckLock":true}
2025-05-25 04:18:34.361 [rpcDispatch_RMROLE_1_8_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-25 04:18:34.368 [rpcDispatch_RMROLE_1_9_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:117747646027194404', branchId=117747646027194409, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false,"skipCheckLock":true}'}
2025-05-25 04:18:34.368 [rpcDispatch_RMROLE_1_9_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:117747646027194404 117747646027194409 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false,"skipCheckLock":true}
2025-05-25 04:18:34.368 [rpcDispatch_RMROLE_1_9_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-25 04:18:34.379 [rpcDispatch_RMROLE_1_10_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:117747646027194404', branchId=117747646027194410, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false,"skipCheckLock":true}'}
2025-05-25 04:18:34.379 [rpcDispatch_RMROLE_1_10_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:117747646027194404 117747646027194410 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false,"skipCheckLock":true}
2025-05-25 04:18:34.379 [rpcDispatch_RMROLE_1_10_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-25 04:18:34.385 [rpcDispatch_RMROLE_1_11_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:117747646027194404', branchId=117747646027194411, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false}'}
2025-05-25 04:18:34.385 [rpcDispatch_RMROLE_1_11_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:117747646027194404 117747646027194411 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false}
2025-05-25 04:18:34.385 [rpcDispatch_RMROLE_1_11_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-25 04:18:34.391 [rpcDispatch_RMROLE_1_12_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:117747646027194404', branchId=117747646027194412, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false}'}
2025-05-25 04:18:34.391 [rpcDispatch_RMROLE_1_12_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:117747646027194404 117747646027194412 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false}
2025-05-25 04:18:34.391 [rpcDispatch_RMROLE_1_12_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-25 04:19:13.882 [http-nio-8080-exec-6] INFO  com.bgpay.bgai.controller.ReactiveChatController - 接收到请求: /api/chatGatWay-internal, 文件=张陇阳的简历.pdf, 问题参数=null, 模型参数=null
2025-05-25 04:19:13.883 [http-nio-8080-exec-6] INFO  com.bgpay.bgai.controller.ReactiveChatController - 请求Content-Type: multipart/form-data;boundary=--------------------------637376540071966790160961
2025-05-25 04:19:13.883 [http-nio-8080-exec-6] INFO  com.bgpay.bgai.controller.ReactiveChatController - 收集到的完整参数: question="null", apiUrl="null", modelName="null", multiTurn=false
2025-05-25 04:19:13.883 [http-nio-8080-exec-6] INFO  com.bgpay.bgai.controller.ReactiveChatController - Processing request for user ID: 689258T
2025-05-25 04:19:13.883 [http-nio-8080-exec-6] INFO  com.bgpay.bgai.controller.ReactiveChatController - Processing file with circuit breaker: fileName=张陇阳的简历.pdf, question=
2025-05-25 04:19:13.883 [http-nio-8080-exec-6] INFO  com.bgpay.bgai.config.ReactiveFileProcessor - Processing file: 张陇阳的简历.pdf, content-type: application/pdf
2025-05-25 04:19:13.884 [http-nio-8080-exec-6] INFO  com.bgpay.bgai.controller.ReactiveChatController - PARAM TRACE [689258T]: 尝试查找匹配配置 - 参数: apiUrl=null, modelName=null
2025-05-25 04:19:13.884 [http-nio-8080-exec-6] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 查询配置 - userId=689258T
2025-05-25 04:19:13.884 [http-nio-8080-exec-6] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 排序方式 - 按ID降序
2025-05-25 04:19:13.884 [http-nio-8080-exec-6] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 限制结果数 - LIMIT 1
2025-05-25 04:19:13.885 [http-nio-8080-exec-6] DEBUG com.bgpay.bgai.mapper.ApiConfigMapper.selectList - ==>  Preparing: SELECT id,api_url,api_key,model_name,user_id FROM api_config WHERE (user_id = ?) ORDER BY id DESC LIMIT 1
2025-05-25 04:19:13.885 [http-nio-8080-exec-6] DEBUG com.bgpay.bgai.mapper.ApiConfigMapper.selectList - ==> Parameters: 689258T(String)
2025-05-25 04:19:13.892 [http-nio-8080-exec-6] DEBUG com.bgpay.bgai.mapper.ApiConfigMapper.selectList - <==      Total: 1
2025-05-25 04:19:13.893 [http-nio-8080-exec-6] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 查询结果 - 找到配置: id=2, modelName=deepseek-chat
2025-05-25 04:19:13.893 [http-nio-8080-exec-6] INFO  com.bgpay.bgai.controller.ReactiveChatController - PARAM TRACE [689258T]: 找到匹配配置 - apiUrl=https://api.deepseek.com/chat/completions, modelName=deepseek-chat (原始请求: null)
2025-05-25 04:19:13.893 [http-nio-8080-exec-6] INFO  com.bgpay.bgai.controller.ReactiveChatController - API config resolved: url=https://api.deepseek.com/chat/completions, model=deepseek-chat
2025-05-25 04:19:13.894 [Thread-54] INFO  com.bgpay.bgai.config.ReactiveFileProcessor - File processed successfully: size=146595 bytes
2025-05-25 04:19:14.156 [Thread-54] INFO  com.bgpay.bgai.controller.ReactiveChatController - Content processed, length: 6507
2025-05-25 04:19:14.172 [Thread-54] INFO  io.seata.tm.api.DefaultGlobalTransaction - Begin new global transaction [seata-server:8091:117747646027194413]
2025-05-25 04:19:14.172 [Thread-54] INFO  c.b.bgai.interceptor.SeataTransactionInterceptor - 准备记录分布式事务开始: XID=seata-server:8091:117747646027194413, 业务=com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive, 路径=, IP=, 用户=system
2025-05-25 04:19:14.179 [Thread-54] INFO  c.b.bgai.service.impl.TransactionLogServiceImpl - 记录分布式事务开始: XID=seata-server:8091:117747646027194413, 业务=com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive
2025-05-25 04:19:14.180 [Thread-54] DEBUG com.bgpay.bgai.mapper.TransactionLogMapper.insert - ==>  Preparing: INSERT INTO transaction_log ( xid, transaction_name, transaction_mode, status, request_path, source_ip, start_time, user_id, create_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-05-25 04:19:14.181 [Thread-54] DEBUG com.bgpay.bgai.mapper.TransactionLogMapper.insert - ==> Parameters: seata-server:8091:117747646027194413(String), com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive(String), AT(String), ACTIVE(String), (String), (String), 2025-05-25T04:19:14.179783600(LocalDateTime), system(String), 2025-05-25T04:19:14.179783600(LocalDateTime)
2025-05-25 04:19:14.210 [Thread-54] DEBUG com.bgpay.bgai.mapper.TransactionLogMapper.insert - <==    Updates: 1
2025-05-25 04:19:14.219 [Thread-54] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:117747646027194413, branchId:117747646027194414, lockKeys:transaction_log:61
2025-05-25 04:19:14.240 [Thread-54] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:117747646027194413, branchId:117747646027194415, lockKeys:undo_log:255;transaction_log:61
2025-05-25 04:19:14.270 [Thread-54] INFO  c.b.bgai.interceptor.SeataTransactionInterceptor - 开始分布式事务: XID=seata-server:8091:117747646027194413, 方法=com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive
2025-05-25 04:19:14.271 [Thread-54] INFO  org.reflections.Reflections - Processing reactive request: content length=6507, apiUrl=https://api.deepseek.com/chat/completions, modelName=deepseek-chat, userId=689258T, multiTurn=false
2025-05-25 04:19:14.275 [Thread-54] INFO  c.b.bgai.service.impl.TransactionLogServiceImpl - 记录分布式事务结束: XID=seata-server:8091:117747646027194413, 状态=COMMITTED
2025-05-25 04:19:14.276 [Thread-54] DEBUG c.b.bgai.mapper.TransactionLogMapper.selectList - ==>  Preparing: SELECT id,xid,branch_id,transaction_name,transaction_mode,status,request_path,source_ip,start_time,end_time,user_id,extra_data,create_time,update_time FROM transaction_log WHERE (xid = ?) LIMIT 1
2025-05-25 04:19:14.277 [Thread-54] DEBUG c.b.bgai.mapper.TransactionLogMapper.selectList - ==> Parameters: seata-server:8091:117747646027194413(String)
2025-05-25 04:19:14.282 [Thread-54] DEBUG c.b.bgai.mapper.TransactionLogMapper.selectList - <==      Total: 1
2025-05-25 04:19:14.282 [Thread-54] DEBUG c.b.bgai.mapper.TransactionLogMapper.updateById - ==>  Preparing: UPDATE transaction_log SET xid=?, transaction_name=?, transaction_mode=?, status=?, request_path=?, source_ip=?, start_time=?, end_time=?, user_id=?, extra_data=?, create_time=?, update_time=? WHERE id=?
2025-05-25 04:19:14.283 [Thread-54] DEBUG c.b.bgai.mapper.TransactionLogMapper.updateById - ==> Parameters: seata-server:8091:117747646027194413(String), com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive(String), AT(String), COMMITTED(String), (String), (String), 2025-05-25T04:19:14(LocalDateTime), 2025-05-25T04:19:14.282782400(LocalDateTime), system(String), {"duration":1,"result":"success"}(String), 2025-05-25T04:19:14(LocalDateTime), 2025-05-25T04:19:14.282782400(LocalDateTime), 61(Long)
2025-05-25 04:19:14.315 [Thread-54] DEBUG c.b.bgai.mapper.TransactionLogMapper.updateById - <==    Updates: 1
2025-05-25 04:19:14.322 [Thread-54] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:117747646027194413, branchId:117747646027194416, lockKeys:transaction_log:61
2025-05-25 04:19:14.340 [Thread-54] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:117747646027194413, branchId:117747646027194417, lockKeys:undo_log:257;transaction_log:61
2025-05-25 04:19:14.362 [Thread-54] INFO  c.b.bgai.interceptor.SeataTransactionInterceptor - 分布式事务成功完成: XID=seata-server:8091:117747646027194413, 耗时=1ms
2025-05-25 04:19:14.362 [Thread-54] INFO  io.seata.tm.api.DefaultGlobalTransaction - transaction seata-server:8091:117747646027194413 will be commit
2025-05-25 04:19:14.372 [Thread-54] INFO  io.seata.tm.api.DefaultGlobalTransaction - transaction end, xid = seata-server:8091:117747646027194413
2025-05-25 04:19:14.372 [Thread-54] INFO  io.seata.tm.api.DefaultGlobalTransaction - [seata-server:8091:117747646027194413] commit status: Committed
2025-05-25 04:19:14.380 [boundedElastic-1] WARN  com.bgpay.bgai.transaction.TransactionCoordinator - Found existing transaction for user 689258T: chat-e3ee0d27-b31d-42b3-a856-b4b3b7b3eeae
2025-05-25 04:19:14.380 [boundedElastic-1] INFO  org.reflections.Reflections - Transaction prepared with chatCompletionId: chat-e3ee0d27-b31d-42b3-a856-b4b3b7b3eeae
2025-05-25 04:19:15.335 [rpcDispatch_RMROLE_1_13_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:117747646027194413', branchId=117747646027194414, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false,"skipCheckLock":true}'}
2025-05-25 04:19:15.335 [rpcDispatch_RMROLE_1_13_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:117747646027194413 117747646027194414 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false,"skipCheckLock":true}
2025-05-25 04:19:15.335 [rpcDispatch_RMROLE_1_13_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-25 04:19:15.342 [rpcDispatch_RMROLE_1_14_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:117747646027194413', branchId=117747646027194415, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false,"skipCheckLock":true}'}
2025-05-25 04:19:15.342 [rpcDispatch_RMROLE_1_14_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:117747646027194413 117747646027194415 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false,"skipCheckLock":true}
2025-05-25 04:19:15.342 [rpcDispatch_RMROLE_1_14_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-25 04:19:15.350 [rpcDispatch_RMROLE_1_15_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:117747646027194413', branchId=117747646027194416, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false}'}
2025-05-25 04:19:15.350 [rpcDispatch_RMROLE_1_15_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:117747646027194413 117747646027194416 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false}
2025-05-25 04:19:15.350 [rpcDispatch_RMROLE_1_15_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-25 04:19:15.361 [rpcDispatch_RMROLE_1_16_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:117747646027194413', branchId=117747646027194417, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false}'}
2025-05-25 04:19:15.361 [rpcDispatch_RMROLE_1_16_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:117747646027194413 117747646027194417 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false}
2025-05-25 04:19:15.361 [rpcDispatch_RMROLE_1_16_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-25 04:19:54.226 [FileWrite-2] INFO  com.bgpay.bgai.service.deepseek.FileWriterService - Successfully wrote content to: \var\data\ai_responses\4f2f404a-1bfb-4eba-a6bc-7b8347ad84df.txt
2025-05-25 04:19:54.255 [reactor-http-nio-2] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - ==>  Preparing: INSERT INTO chat_completions ( object, created, model, system_fingerprint, api_key ) VALUES ( ?, ?, ?, ?, ? )
2025-05-25 04:19:54.256 [reactor-http-nio-2] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - ==> Parameters: chat.completion(String), 1748117994255(Long), deepseek-chat(String), 689258T(String), chat-e3ee0d27-b31d-42b3-a856-b4b3b7b3eeae(String)
2025-05-25 04:19:54.271 [reactor-http-nio-2] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - <==    Updates: 1
2025-05-25 04:19:54.272 [reactor-http-nio-2] INFO  com.bgpay.bgai.transaction.TransactionCoordinator - Transaction committed for user 689258T: chatCompletionId=chat-e3ee0d27-b31d-42b3-a856-b4b3b7b3eeae
2025-05-25 04:19:54.299 [reactor-http-nio-2] INFO  org.reflections.Reflections - 开始发送账单消息，chatCompletionId: chat-e3ee0d27-b31d-42b3-a856-b4b3b7b3eeae, userId: 689258T
2025-05-25 04:19:54.325 [reactor-http-nio-2] INFO  io.seata.tm.api.DefaultGlobalTransaction - Begin new global transaction [seata-server:8091:117747646027194418]
2025-05-25 04:19:54.325 [reactor-http-nio-2] INFO  c.b.bgai.interceptor.SeataTransactionInterceptor - 准备记录分布式事务开始: XID=seata-server:8091:117747646027194418, 业务=com.bgpay.bgai.service.mq.BillingTransactionListenerImpl.executeLocalTransaction, 路径=, IP=, 用户=system
2025-05-25 04:19:54.332 [reactor-http-nio-2] INFO  c.b.bgai.service.impl.TransactionLogServiceImpl - 记录分布式事务开始: XID=seata-server:8091:117747646027194418, 业务=com.bgpay.bgai.service.mq.BillingTransactionListenerImpl.executeLocalTransaction
2025-05-25 04:19:54.333 [reactor-http-nio-2] DEBUG com.bgpay.bgai.mapper.TransactionLogMapper.insert - ==>  Preparing: INSERT INTO transaction_log ( xid, transaction_name, transaction_mode, status, request_path, source_ip, start_time, user_id, create_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-05-25 04:19:54.334 [reactor-http-nio-2] DEBUG com.bgpay.bgai.mapper.TransactionLogMapper.insert - ==> Parameters: seata-server:8091:117747646027194418(String), com.bgpay.bgai.service.mq.BillingTransactionListenerImpl.executeLocalTransaction(String), AT(String), ACTIVE(String), (String), (String), 2025-05-25T04:19:54.333029400(LocalDateTime), system(String), 2025-05-25T04:19:54.333029400(LocalDateTime)
2025-05-25 04:19:54.359 [reactor-http-nio-2] DEBUG com.bgpay.bgai.mapper.TransactionLogMapper.insert - <==    Updates: 1
2025-05-25 04:19:54.369 [reactor-http-nio-2] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:117747646027194418, branchId:117747646027194419, lockKeys:transaction_log:62
2025-05-25 04:19:54.387 [reactor-http-nio-2] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:117747646027194418, branchId:117747646027194420, lockKeys:undo_log:259;transaction_log:62
2025-05-25 04:19:54.406 [reactor-http-nio-2] INFO  c.b.bgai.interceptor.SeataTransactionInterceptor - 开始分布式事务: XID=seata-server:8091:117747646027194418, 方法=com.bgpay.bgai.service.mq.BillingTransactionListenerImpl.executeLocalTransaction
2025-05-25 04:19:54.406 [reactor-http-nio-2] INFO  c.b.bgai.service.mq.BillingTransactionListenerImpl - 开始执行本地事务, xid: seata-server:8091:117747646027194418, userId: 689258T, completionId: chat-e3ee0d27-b31d-42b3-a856-b4b3b7b3eeae
2025-05-25 04:19:54.413 [reactor-http-nio-2] INFO  c.b.bgai.service.mq.BillingTransactionListenerImpl - 消息已处理，提交事务, completionId: chat-e3ee0d27-b31d-42b3-a856-b4b3b7b3eeae
2025-05-25 04:19:54.418 [reactor-http-nio-2] INFO  c.b.bgai.service.impl.TransactionLogServiceImpl - 记录分布式事务结束: XID=seata-server:8091:117747646027194418, 状态=COMMITTED
2025-05-25 04:19:54.418 [reactor-http-nio-2] DEBUG c.b.bgai.mapper.TransactionLogMapper.selectList - ==>  Preparing: SELECT id,xid,branch_id,transaction_name,transaction_mode,status,request_path,source_ip,start_time,end_time,user_id,extra_data,create_time,update_time FROM transaction_log WHERE (xid = ?) LIMIT 1
2025-05-25 04:19:54.419 [reactor-http-nio-2] DEBUG c.b.bgai.mapper.TransactionLogMapper.selectList - ==> Parameters: seata-server:8091:117747646027194418(String)
2025-05-25 04:19:54.423 [reactor-http-nio-2] DEBUG c.b.bgai.mapper.TransactionLogMapper.selectList - <==      Total: 1
2025-05-25 04:19:54.423 [reactor-http-nio-2] DEBUG c.b.bgai.mapper.TransactionLogMapper.updateById - ==>  Preparing: UPDATE transaction_log SET xid=?, transaction_name=?, transaction_mode=?, status=?, request_path=?, source_ip=?, start_time=?, end_time=?, user_id=?, extra_data=?, create_time=?, update_time=? WHERE id=?
2025-05-25 04:19:54.424 [reactor-http-nio-2] DEBUG c.b.bgai.mapper.TransactionLogMapper.updateById - ==> Parameters: seata-server:8091:117747646027194418(String), com.bgpay.bgai.service.mq.BillingTransactionListenerImpl.executeLocalTransaction(String), AT(String), COMMITTED(String), (String), (String), 2025-05-25T04:19:54(LocalDateTime), 2025-05-25T04:19:54.423046300(LocalDateTime), system(String), {"duration":7,"result":"success"}(String), 2025-05-25T04:19:54(LocalDateTime), 2025-05-25T04:19:54.423046300(LocalDateTime), 62(Long)
2025-05-25 04:19:54.462 [reactor-http-nio-2] DEBUG c.b.bgai.mapper.TransactionLogMapper.updateById - <==    Updates: 1
2025-05-25 04:19:54.477 [reactor-http-nio-2] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:117747646027194418, branchId:117747646027194421, lockKeys:transaction_log:62
2025-05-25 04:19:54.495 [reactor-http-nio-2] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:117747646027194418, branchId:117747646027194422, lockKeys:transaction_log:62;undo_log:261
2025-05-25 04:19:54.514 [reactor-http-nio-2] INFO  c.b.bgai.interceptor.SeataTransactionInterceptor - 分布式事务成功完成: XID=seata-server:8091:117747646027194418, 耗时=7ms
2025-05-25 04:19:54.515 [reactor-http-nio-2] INFO  io.seata.tm.api.DefaultGlobalTransaction - transaction seata-server:8091:117747646027194418 will be commit
2025-05-25 04:19:54.523 [reactor-http-nio-2] INFO  io.seata.tm.api.DefaultGlobalTransaction - transaction end, xid = seata-server:8091:117747646027194418
2025-05-25 04:19:54.523 [reactor-http-nio-2] INFO  io.seata.tm.api.DefaultGlobalTransaction - [seata-server:8091:117747646027194418] commit status: Committed
2025-05-25 04:19:54.523 [reactor-http-nio-2] INFO  org.reflections.Reflections - 账单消息发送成功，chatCompletionId: chat-e3ee0d27-b31d-42b3-a856-b4b3b7b3eeae, userId: 689258T
2025-05-25 04:19:54.528 [reactor-http-nio-2] INFO  com.bgpay.bgai.service.impl.BGAIServiceImpl - 执行第一步操作 - 发送账单消息, businessKey: 689258T:chat-e3ee0d27-b31d-42b3-a856-b4b3b7b3eeae
2025-05-25 04:19:54.529 [reactor-http-nio-2] DEBUG c.bgpay.bgai.mapper.UsageRecordMapper.selectCount - ==>  Preparing: SELECT COUNT( * ) AS total FROM usage_record WHERE (chat_completion_id = ?)
2025-05-25 04:19:54.529 [reactor-http-nio-2] DEBUG c.bgpay.bgai.mapper.UsageRecordMapper.selectCount - ==> Parameters: chat-e3ee0d27-b31d-42b3-a856-b4b3b7b3eeae(String)
2025-05-25 04:19:54.533 [reactor-http-nio-2] DEBUG c.bgpay.bgai.mapper.UsageRecordMapper.selectCount - <==      Total: 1
2025-05-25 04:19:54.533 [reactor-http-nio-2] INFO  com.bgpay.bgai.service.impl.BGAIServiceImpl - 账单消息已处理，跳过发送, completionId: chat-e3ee0d27-b31d-42b3-a856-b4b3b7b3eeae
2025-05-25 04:19:54.542 [reactor-http-nio-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - Processed response for user 689258T, content length: 3720
2025-05-25 04:19:54.617 [ConsumeMessageThread_billing-consumer-group_2] INFO  c.bgpay.bgai.service.mq.RocketMQBillingServiceImpl - Output price config priceVersion: 1
2025-05-25 04:19:54.623 [ConsumeMessageThread_billing-consumer-group_2] DEBUG com.bgpay.bgai.mapper.UsageRecordMapper.insert - ==>  Preparing: INSERT INTO usage_record ( model_type, chat_completion_id, user_id, input_cost, output_cost, price_version, calculated_at, status, created_at ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-05-25 04:19:54.624 [ConsumeMessageThread_billing-consumer-group_2] DEBUG com.bgpay.bgai.mapper.UsageRecordMapper.insert - ==> Parameters: deepseek-chat(String), chat-e3ee0d27-b31d-42b3-a856-b4b3b7b3eeae(String), 689258T(String), 0.0076(BigDecimal), 0.0072(BigDecimal), 1(Integer), 2025-05-25T04:19:54.589259800(LocalDateTime), PENDING(String), 2025-05-25T04:19:54.589259800(LocalDateTime)
2025-05-25 04:19:54.633 [ConsumeMessageThread_billing-consumer-group_2] DEBUG com.bgpay.bgai.mapper.UsageRecordMapper.insert - <==    Updates: 1
2025-05-25 04:19:54.654 [ConsumeMessageThread_billing-consumer-group_2] INFO  c.bgpay.bgai.service.mq.RocketMQBillingServiceImpl - Message consumed: 2408820C7528D042C1858EDCF30D3D91344036BAF30C7C86933C0001
2025-05-25 04:19:55.337 [rpcDispatch_RMROLE_1_17_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:117747646027194418', branchId=117747646027194419, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false,"skipCheckLock":true}'}
2025-05-25 04:19:55.337 [rpcDispatch_RMROLE_1_17_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:117747646027194418 117747646027194419 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false,"skipCheckLock":true}
2025-05-25 04:19:55.337 [rpcDispatch_RMROLE_1_17_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-25 04:19:55.350 [rpcDispatch_RMROLE_1_18_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:117747646027194418', branchId=117747646027194420, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false,"skipCheckLock":true}'}
2025-05-25 04:19:55.350 [rpcDispatch_RMROLE_1_18_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:117747646027194418 117747646027194420 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false,"skipCheckLock":true}
2025-05-25 04:19:55.350 [rpcDispatch_RMROLE_1_18_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-25 04:19:55.359 [rpcDispatch_RMROLE_1_19_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:117747646027194418', branchId=117747646027194421, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false}'}
2025-05-25 04:19:55.359 [rpcDispatch_RMROLE_1_19_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:117747646027194418 117747646027194421 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false}
2025-05-25 04:19:55.359 [rpcDispatch_RMROLE_1_19_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-25 04:19:55.367 [rpcDispatch_RMROLE_1_20_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:117747646027194418', branchId=117747646027194422, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false}'}
2025-05-25 04:19:55.367 [rpcDispatch_RMROLE_1_20_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:117747646027194418 117747646027194422 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false}
2025-05-25 04:19:55.368 [rpcDispatch_RMROLE_1_20_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-25 04:20:16.112 [Thread-7] WARN  com.alibaba.nacos.common.notify.NotifyCenter - [NotifyCenter] Start destroying Publisher
2025-05-25 04:20:16.112 [Thread-7] WARN  com.alibaba.nacos.common.notify.NotifyCenter - [NotifyCenter] Destruction of the end
2025-05-25 04:20:16.112 [Thread-1] WARN  c.alibaba.nacos.common.http.HttpClientBeanHolder - [HttpClientBeanHolder] Start destroying common HttpClient
2025-05-25 04:20:16.113 [Thread-1] WARN  c.alibaba.nacos.common.http.HttpClientBeanHolder - [HttpClientBeanHolder] Destruction of the end
2025-05-25 04:20:16.130 [SpringContextShutdownHook] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - De-registering from Nacos Server now...
2025-05-25 04:20:16.130 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - [DEREGISTER-SERVICE] d750d92e-152f-4055-a641-3bc9dda85a29 deregistering service bgtech-ai with instance: Instance{instanceId='null', ip='192.168.86.8', port=8080, weight=1.0, healthy=true, enabled=true, ephemeral=true, clusterName='DEFAULT', serviceName='null', metadata={}}
2025-05-25 04:20:16.137 [SpringContextShutdownHook] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - De-registration finished.
2025-05-25 04:20:16.138 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.cache.ServiceInfoHolder do shutdown begin
2025-05-25 04:20:16.138 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.backups.FailoverReactor do shutdown begin
2025-05-25 04:20:16.138 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.backups.FailoverReactor do shutdown stop
2025-05-25 04:20:16.138 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.cache.ServiceInfoHolder do shutdown stop
2025-05-25 04:20:16.138 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.NamingClientProxyDelegate do shutdown begin
2025-05-25 04:20:16.138 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServiceInfoUpdateService do shutdown begin
2025-05-25 04:20:16.139 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServiceInfoUpdateService do shutdown stop
2025-05-25 04:20:16.139 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServerListManager do shutdown begin
2025-05-25 04:20:16.139 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Start destroying NacosRestTemplate
2025-05-25 04:20:16.139 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Destruction of the end
2025-05-25 04:20:16.139 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServerListManager do shutdown stop
2025-05-25 04:20:16.139 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.http.NamingHttpClientProxy do shutdown begin
2025-05-25 04:20:16.139 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Start destroying NacosRestTemplate
2025-05-25 04:20:16.139 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Destruction of the end
2025-05-25 04:20:16.139 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.http.NamingHttpClientProxy do shutdown stop
2025-05-25 04:20:16.139 [SpringContextShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Shutdown rpc client, set status to shutdown
2025-05-25 04:20:16.139 [SpringContextShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Shutdown client event executor java.util.concurrent.ScheduledThreadPoolExecutor@6bb35b0e[Running, pool size = 2, active threads = 2, queued tasks = 0, completed tasks = 0]
2025-05-25 04:20:16.139 [SpringContextShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Close current connection 1748117845006_139.227.195.192_48812
2025-05-25 04:20:16.141 [nacos-grpc-client-executor-8.133.246.113-45] WARN  c.a.nacos.common.remote.client.grpc.GrpcClient - [1748117845006_139.227.195.192_48812]Ignore error event,isRunning:false,isAbandon=false
2025-05-25 04:20:16.143 [SpringContextShutdownHook] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - Shutdown grpc executor java.util.concurrent.ThreadPoolExecutor@121c7f9c[Running, pool size = 4, active threads = 0, queued tasks = 0, completed tasks = 46]
2025-05-25 04:20:16.143 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - Shutdown grpc redo service executor java.util.concurrent.ScheduledThreadPoolExecutor@2aa2a6e6[Running, pool size = 1, active threads = 0, queued tasks = 1, completed tasks = 57]
2025-05-25 04:20:16.143 [SpringContextShutdownHook] INFO  c.a.n.client.auth.ram.identify.CredentialWatcher - [null] CredentialWatcher is stopped
2025-05-25 04:20:16.143 [SpringContextShutdownHook] INFO  c.a.n.client.auth.ram.identify.CredentialService - [null] CredentialService is freed
2025-05-25 04:20:16.143 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.NamingClientProxyDelegate do shutdown stop
2025-05-25 04:20:16.149 [SpringContextShutdownHook] DEBUG com.bgpay.bgai.config.AsyncConfig$1 - Shutting down ExecutorService 'blockingExecutor'
2025-05-25 04:20:18.235 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:9876] result: true
2025-05-25 04:20:18.235 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:10911] result: true
2025-05-25 04:20:18.250 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:10911] result: true
2025-05-25 04:20:18.250 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:9876] result: true
2025-05-25 04:20:18.379 [SpringContextShutdownHook] INFO  o.s.orm.jpa.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-05-25 04:20:18.381 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-2} closing ...
2025-05-25 04:20:18.384 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-2} closed
2025-05-25 04:20:18.384 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} closing ...
2025-05-25 04:20:18.384 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} closed
2025-05-25 04:20:18.385 [NettyClientSelector_TMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - channel inactive: [id: 0x13c7ad89, L:/192.168.86.8:63040 ! R:/8.133.246.113:8091]
2025-05-25 04:20:18.385 [NettyClientSelector_TMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - return to pool, rm channel:[id: 0x13c7ad89, L:/192.168.86.8:63040 ! R:/8.133.246.113:8091]
2025-05-25 04:20:18.385 [NettyClientSelector_TMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - channel valid false,channel:[id: 0x13c7ad89, L:/192.168.86.8:63040 ! R:/8.133.246.113:8091]
2025-05-25 04:20:18.385 [NettyClientSelector_TMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - will destroy channel:[id: 0x13c7ad89, L:/192.168.86.8:63040 ! R:/8.133.246.113:8091]
2025-05-25 04:20:18.385 [NettyClientSelector_TMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0x13c7ad89, L:/192.168.86.8:63040 ! R:/8.133.246.113:8091]) will closed
2025-05-25 04:20:18.385 [NettyClientSelector_TMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0x13c7ad89, L:/192.168.86.8:63040 ! R:/8.133.246.113:8091]) will closed
2025-05-25 04:20:18.386 [NettyClientSelector_RMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - channel inactive: [id: 0x341387e9, L:/192.168.86.8:63043 ! R:/8.133.246.113:8091]
2025-05-25 04:20:18.386 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - return to pool, rm channel:[id: 0x341387e9, L:/192.168.86.8:63043 ! R:/8.133.246.113:8091]
2025-05-25 04:20:18.386 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - channel valid false,channel:[id: 0x341387e9, L:/192.168.86.8:63043 ! R:/8.133.246.113:8091]
2025-05-25 04:20:18.386 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - will destroy channel:[id: 0x341387e9, L:/192.168.86.8:63043 ! R:/8.133.246.113:8091]
2025-05-25 04:20:18.386 [NettyClientSelector_RMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0x341387e9, L:/192.168.86.8:63043 ! R:/8.133.246.113:8091]) will closed
2025-05-25 04:20:18.386 [NettyClientSelector_RMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0x341387e9, L:/192.168.86.8:63043 ! R:/8.133.246.113:8091]) will closed
