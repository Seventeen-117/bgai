2025-05-19 13:20:13.027 [main] WARN  com.alibaba.nacos.client.logging.NacosLogging - Load Logback Configuration of Nacos fail, message: Could not initialize Logback Nacos logging from classpath:nacos-logback.xml
2025-05-19 13:20:13.029 [main] INFO  com.bgpay.bgai.BgaiApplication - The following 1 profile is active: "dev"
2025-05-19 13:20:14.958 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-05-19 13:20:14.959 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-05-19 13:20:14.995 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 25 ms. Found 0 JPA repository interfaces.
2025-05-19 13:20:15.012 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-05-19 13:20:15.014 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-05-19 13:20:15.032 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 7 ms. Found 0 Redis repository interfaces.
2025-05-19 13:20:15.742 [main] INFO  io.seata.config.ConfigurationFactory - load Configuration from :Spring Configuration
2025-05-19 13:20:15.752 [main] INFO  io.seata.config.ConfigurationFactory - load Configuration from :Spring Configuration
2025-05-19 13:20:15.760 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Initializing Global Transaction Clients ... 
2025-05-19 13:20:15.894 [main] INFO  io.seata.core.rpc.netty.NettyClientBootstrap - NettyClientBootstrap has started
2025-05-19 13:20:15.895 [main] INFO  io.seata.discovery.registry.RegistryFactory - use registry center type: file
2025-05-19 13:20:15.906 [main] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - will connect to 8.133.246.113:8091
2025-05-19 13:20:15.911 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - NettyPool create channel to transactionRole:TMROLE,address:8.133.246.113:8091,msg:< RegisterTMRequest{version='1.7.0', applicationId='bgtech-ai', transactionServiceGroup='bgai-tx-group', extraData='ak=null
digest=bgai-tx-group,192.168.86.8,1747632015909
timestamp=1747632015909
authVersion=V4
vgroup=bgai-tx-group
ip=192.168.86.8
'} >
2025-05-19 13:20:16.278 [main] INFO  io.seata.core.rpc.netty.TmNettyRemotingClient - register TM success. client version:1.7.0, server version:1.8.1-SNAPSHOT,channel:[id: 0x7b076161, L:/192.168.86.8:59200 - R:/8.133.246.113:8091]
2025-05-19 13:20:16.288 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - register success, cost 213 ms, version:1.8.1-SNAPSHOT,role:TMROLE,channel:[id: 0x7b076161, L:/192.168.86.8:59200 - R:/8.133.246.113:8091]
2025-05-19 13:20:16.289 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Transaction Manager Client is initialized. applicationId[bgtech-ai] txServiceGroup[bgai-tx-group]
2025-05-19 13:20:16.307 [main] INFO  io.seata.rm.datasource.AsyncWorker - Async Commit Buffer Limit: 10000
2025-05-19 13:20:16.308 [main] INFO  io.seata.rm.datasource.xa.ResourceManagerXA - ResourceManagerXA init ...
2025-05-19 13:20:16.322 [main] INFO  io.seata.core.rpc.netty.NettyClientBootstrap - NettyClientBootstrap has started
2025-05-19 13:20:16.322 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Resource Manager is initialized. applicationId[bgtech-ai] txServiceGroup[bgai-tx-group]
2025-05-19 13:20:16.322 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Global Transaction Clients are initialized. 
2025-05-19 13:20:17.879 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat initialized with port(s): 8080 (http)
2025-05-19 13:20:17.893 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - The ["http-nio-8080"] connector has been configured to support HTTP upgrade to [h2c]
2025-05-19 13:20:17.893 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - Initializing ProtocolHandler ["http-nio-8080"]
2025-05-19 13:20:17.896 [main] INFO  org.apache.catalina.core.StandardService - Starting service [Tomcat]
2025-05-19 13:20:17.896 [main] INFO  org.apache.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.15]
2025-05-19 13:20:18.465 [main] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} inited
2025-05-19 13:20:18.742 [main] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - will connect to 8.133.246.113:8091
2025-05-19 13:20:18.742 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - RM will register :jdbc:mysql://8.133.246.113:3306/deepseek
2025-05-19 13:20:18.742 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - NettyPool create channel to transactionRole:RMROLE,address:8.133.246.113:8091,msg:< RegisterRMRequest{resourceIds='jdbc:mysql://8.133.246.113:3306/deepseek', version='1.7.0', applicationId='bgtech-ai', transactionServiceGroup='bgai-tx-group', extraData='null'} >
2025-05-19 13:20:18.767 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - register RM success. client version:1.7.0, server version:1.8.1-SNAPSHOT,channel:[id: 0x9d3b05c8, L:/192.168.86.8:59214 - R:/8.133.246.113:8091]
2025-05-19 13:20:18.767 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - register success, cost 16 ms, version:1.8.1-SNAPSHOT,role:RMROLE,channel:[id: 0x9d3b05c8, L:/192.168.86.8:59214 - R:/8.133.246.113:8091]
2025-05-19 13:20:18.770 [main] INFO  i.s.s.a.datasource.SeataAutoDataSourceProxyCreator - Auto proxy data source 'masterDataSource' by 'AT' mode.
2025-05-19 13:20:18.846 [main] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-2} inited
2025-05-19 13:20:18.923 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - will register resourceId:jdbc:mysql://8.133.246.113:3306/deepseek
2025-05-19 13:20:18.924 [main] INFO  i.s.s.a.datasource.SeataAutoDataSourceProxyCreator - Auto proxy data source 'slaveDataSource' by 'AT' mode.
2025-05-19 13:20:18.932 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.rm.AbstractRMHandler - the rm client received response msg [RegisterRMResponse{version='1.8.1-SNAPSHOT', extraData='null', identified=true, resultCode=null, msg='null'}] from tc server.
2025-05-19 13:20:18.947 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - will register resourceId:jdbc:mysql://8.133.246.113:3306/deepseek
2025-05-19 13:20:18.947 [main] INFO  i.s.s.a.datasource.SeataAutoDataSourceProxyCreator - Auto proxy data source 'dynamicDataSource' by 'AT' mode.
2025-05-19 13:20:18.963 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.rm.AbstractRMHandler - the rm client received response msg [RegisterRMResponse{version='1.8.1-SNAPSHOT', extraData='null', identified=true, resultCode=null, msg='null'}] from tc server.
2025-05-19 13:20:19.099 [main] INFO  org.hibernate.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-05-19 13:20:19.180 [main] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.1.7.Final
2025-05-19 13:20:19.581 [main] INFO  SQL dialect - HHH000400: Using dialect: org.hibernate.dialect.MySQL8Dialect
2025-05-19 13:20:19.583 [main] WARN  org.hibernate.orm.deprecation - HHH90000026: MySQL8Dialect has been deprecated; use org.hibernate.dialect.MySQLDialect instead
2025-05-19 13:20:19.958 [main] INFO  o.h.e.t.jta.platform.internal.JtaPlatformInitiator - HHH000490: Using JtaPlatform implementation: [org.hibernate.engine.transaction.jta.platform.internal.NoJtaPlatform]
2025-05-19 13:20:19.973 [main] INFO  o.s.orm.jpa.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-05-19 13:20:20.592 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-19 13:20:20.612 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-19 13:20:20.657 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-19 13:20:20.660 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-19 13:20:20.661 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-19 13:20:20.679 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-19 13:20:21.495 [main] INFO  com.bgpay.bgai.service.impl.UserServiceImpl - 初始化SSO配置: clientId=bgai-client-id, redirectUri=http://localhost:8080/api/auth/callback
2025-05-19 13:20:21.636 [main] INFO  com.bgpay.bgai.controller.AuthController - 初始化认证控制器: clientId=bgai-client-id, redirectUri=http://localhost:8080/api/auth/callback
2025-05-19 13:20:22.446 [main] INFO  o.a.r.s.autoconfigure.RocketMQAutoConfiguration - a producer (billing-producer-group) init on namesrv 8.133.246.113:9876
2025-05-19 13:20:23.034 [main] WARN  i.s.s.b.a.provider.SpringBootConfigurationProvider - The get method not found for the field 'SeataProperties#accesskey'.
2025-05-19 13:20:23.035 [main] WARN  i.s.s.b.a.provider.SpringBootConfigurationProvider - The get method not found for the field 'SeataProperties#secretkey'.
2025-05-19 13:20:23.047 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 加载到1个Saga状态机定义文件
2025-05-19 13:20:23.298 [main] INFO  com.bgpay.bgai.saga.CustomSagaJsonParser - 开始解析状态机定义: bgai-saga-transaction
2025-05-19 13:20:23.299 [main] INFO  com.bgpay.bgai.saga.CustomSagaJsonParser - 状态机定义解析成功: bgai-saga-transaction
2025-05-19 13:20:23.299 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 成功加载状态机定义: /E:/project/bgai/target/classes/statelang/bgai-saga-transaction.json
2025-05-19 13:20:23.942 [main] INFO  org.redisson.Version - Redisson 3.24.3
2025-05-19 13:20:24.113 [redisson-netty-4-6] INFO  o.r.connection.pool.MasterPubSubConnectionPool - 1 connections initialized for 8.133.246.113/8.133.246.113:6379
2025-05-19 13:20:24.574 [redisson-netty-4-19] INFO  org.redisson.connection.pool.MasterConnectionPool - 24 connections initialized for 8.133.246.113/8.133.246.113:6379
2025-05-19 13:20:24.873 [main] INFO  com.bgpay.bgai.service.mq.MQConsumerService - MQ consumer startup successful [group=billing-consumer-group, topic=BILLING_TOPIC, tag=USER_BILLING]
2025-05-19 13:20:25.231 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Bean [com.bgpay.bgai.service.impl.SeataTransactionService$$SpringCGLIB$$0] with name [seataTransactionService] would use interceptor [io.seata.spring.annotation.GlobalTransactionalInterceptor]
2025-05-19 13:20:25.364 [main] DEBUG com.bgpay.bgai.config.AsyncConfig$1 - Initializing ExecutorService 'blockingExecutor'
2025-05-19 13:20:26.798 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [After]
2025-05-19 13:20:26.798 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Before]
2025-05-19 13:20:26.798 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Between]
2025-05-19 13:20:26.798 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Cookie]
2025-05-19 13:20:26.798 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Header]
2025-05-19 13:20:26.798 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Host]
2025-05-19 13:20:26.798 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Method]
2025-05-19 13:20:26.798 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Path]
2025-05-19 13:20:26.798 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Query]
2025-05-19 13:20:26.798 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [ReadBody]
2025-05-19 13:20:26.798 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [RemoteAddr]
2025-05-19 13:20:26.798 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [XForwardedRemoteAddr]
2025-05-19 13:20:26.798 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Weight]
2025-05-19 13:20:26.798 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [CloudFoundryRouteService]
2025-05-19 13:20:28.168 [main] INFO  o.s.b.actuate.endpoint.web.EndpointLinksResolver - Exposing 1 endpoint(s) beneath base path '/actuator'
2025-05-19 13:20:28.631 [main] WARN  i.s.s.b.a.provider.SpringBootConfigurationProvider - The get method not found for the field 'SeataProperties#accesskey'.
2025-05-19 13:20:28.631 [main] WARN  i.s.s.b.a.provider.SpringBootConfigurationProvider - The get method not found for the field 'SeataProperties#secretkey'.
2025-05-19 13:20:28.658 [main] INFO  io.seata.saga.tm.DefaultSagaTransactionalTemplate - Initializing Global Transaction Clients ... 
2025-05-19 13:20:28.658 [main] INFO  io.seata.saga.tm.DefaultSagaTransactionalTemplate - Transaction Manager Client is initialized. applicationId[bgtech-ai] txServiceGroup[bgai-tx-group]
2025-05-19 13:20:28.658 [main] INFO  io.seata.saga.tm.DefaultSagaTransactionalTemplate - Resource Manager is initialized. applicationId[bgtech-ai] txServiceGroup[bgai-tx-group]
2025-05-19 13:20:28.659 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - will register resourceId:bgtech-ai#bgai-tx-group
2025-05-19 13:20:28.659 [main] INFO  io.seata.saga.tm.DefaultSagaTransactionalTemplate - Global Transaction Clients are initialized. 
2025-05-19 13:20:28.676 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.rm.AbstractRMHandler - the rm client received response msg [RegisterRMResponse{version='1.8.1-SNAPSHOT', extraData='null', identified=true, resultCode=null, msg='null'}] from tc server.
2025-05-19 13:20:30.202 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - Starting ProtocolHandler ["http-nio-8080"]
2025-05-19 13:20:30.223 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat started on port(s): 8080 (http) with context path ''
2025-05-19 13:20:30.234 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from ans.namespace attribute : null
2025-05-19 13:20:30.234 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from ALIBABA_ALIWARE_NAMESPACE attribute :null
2025-05-19 13:20:30.235 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from namespace attribute :null
2025-05-19 13:20:30.246 [main] INFO  c.a.n.p.auth.spi.client.ClientAuthPluginManager - [ClientAuthPluginManager] Load ClientAuthService com.alibaba.nacos.client.auth.impl.NacosClientAuthServiceImpl success.
2025-05-19 13:20:30.246 [main] INFO  c.a.n.p.auth.spi.client.ClientAuthPluginManager - [ClientAuthPluginManager] Load ClientAuthService com.alibaba.nacos.client.auth.ram.RamClientAuthServiceImpl success.
2025-05-19 13:20:30.250 [main] INFO  com.alibaba.nacos.common.remote.client - [RpcClientFactory] create a new rpc client of ec952600-515e-4d5f-afa6-54002273d17e
2025-05-19 13:20:30.252 [main] INFO  com.alibaba.nacos.common.remote.client - [ec952600-515e-4d5f-afa6-54002273d17e] RpcClient init, ServerListFactory = com.alibaba.nacos.client.naming.core.ServerListManager
2025-05-19 13:20:30.252 [main] INFO  com.alibaba.nacos.common.remote.client - [ec952600-515e-4d5f-afa6-54002273d17e] Registry connection listener to current client:com.alibaba.nacos.client.naming.remote.gprc.redo.NamingGrpcRedoService
2025-05-19 13:20:30.252 [main] INFO  com.alibaba.nacos.common.remote.client - [ec952600-515e-4d5f-afa6-54002273d17e] Register server push request handler:com.alibaba.nacos.client.naming.remote.gprc.NamingPushRequestHandler
2025-05-19 13:20:30.253 [main] INFO  com.alibaba.nacos.common.remote.client - [ec952600-515e-4d5f-afa6-54002273d17e] Try to connect to server on start up, server: {serverIp = '8.133.246.113', server main port = 8848}
2025-05-19 13:20:30.253 [main] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - grpc client connection server:8.133.246.113 ip,serverPort:9848,grpcTslConfig:{"sslProvider":"OPENSSL","enableTls":false,"mutualAuthEnable":false,"trustAll":false}
2025-05-19 13:20:30.383 [main] INFO  com.alibaba.nacos.common.remote.client - [ec952600-515e-4d5f-afa6-54002273d17e] Success to connect to server [8.133.246.113:8848] on start up, connectionId = 1747632030269_139.227.195.203_43957
2025-05-19 13:20:30.383 [com.alibaba.nacos.client.remote.worker] INFO  com.alibaba.nacos.common.remote.client - [ec952600-515e-4d5f-afa6-54002273d17e] Notify connected event to listeners.
2025-05-19 13:20:30.383 [main] INFO  com.alibaba.nacos.common.remote.client - [ec952600-515e-4d5f-afa6-54002273d17e] Register server push request handler:com.alibaba.nacos.common.remote.client.RpcClient$ConnectResetRequestHandler
2025-05-19 13:20:30.383 [com.alibaba.nacos.client.remote.worker] INFO  com.alibaba.nacos.client.naming - Grpc connection connect
2025-05-19 13:20:30.383 [main] INFO  com.alibaba.nacos.common.remote.client - [ec952600-515e-4d5f-afa6-54002273d17e] Register server push request handler:com.alibaba.nacos.common.remote.client.RpcClient$$Lambda/0x0000020135532900
2025-05-19 13:20:30.385 [main] INFO  com.alibaba.nacos.client.naming - [REGISTER-SERVICE] d750d92e-152f-4055-a641-3bc9dda85a29 registering service bgtech-ai with instance Instance{instanceId='null', ip='192.168.86.8', port=8080, weight=1.0, healthy=true, enabled=true, ephemeral=true, clusterName='DEFAULT', serviceName='null', metadata={IPv6=[2408:820c:7528:8342:b486:9b72:4b72:4bf0], preserved.register.source=SPRING_CLOUD}}
2025-05-19 13:20:30.416 [main] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - nacos registry, DEFAULT_GROUP bgtech-ai 192.168.86.8:8080 register finished
2025-05-19 13:20:30.483 [main] INFO  com.bgpay.bgai.BgaiApplication - Started BgaiApplication in 20.327 seconds (process running for 22.837)
2025-05-19 13:20:30.487 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-19 13:20:30.488 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-19 13:20:30.500 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-19 13:20:30.501 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-19 13:20:30.501 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-19 13:20:30.511 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-19 13:20:30.511 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-19 13:20:30.511 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-19 13:20:30.519 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-19 13:20:30.519 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-19 13:20:30.520 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-19 13:20:30.526 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-19 13:20:30.526 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - ==================== Saga状态机加载报告 ====================
2025-05-19 13:20:30.526 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - Saga状态机配置加载状态: 成功
2025-05-19 13:20:30.527 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 已加载的状态机定义文件数量: 1
2025-05-19 13:20:30.527 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 已加载的状态机定义文件:
2025-05-19 13:20:30.527 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig -  - /E:/project/bgai/target/classes/statelang/bgai-saga-transaction.json
2025-05-19 13:20:30.527 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - Saga解析器状态: CUSTOM_FASTJSON2
2025-05-19 13:20:30.527 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 状态机解析结果: 成功 1 个, 失败 0 个
2025-05-19 13:20:30.527 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - =============================================================
2025-05-19 13:20:30.531 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - nacos.cache.data.init.snapshot = true 
2025-05-19 13:20:30.531 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] common-dev.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-19 13:20:30.539 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=common-dev.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-19 13:20:30.539 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=common-dev.yaml, group=DEFAULT_GROUP
2025-05-19 13:20:30.539 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-19 13:20:30.540 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-19 13:20:30.540 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai.yaml, group=DEFAULT_GROUP
2025-05-19 13:20:30.541 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai-dev.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-19 13:20:30.541 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai-dev.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-19 13:20:30.541 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai-dev.yaml, group=DEFAULT_GROUP
2025-05-19 13:20:30.541 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-19 13:20:30.542 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai, group=DEFAULT_GROUP, cnt=1
2025-05-19 13:20:30.542 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai, group=DEFAULT_GROUP
2025-05-19 13:20:36.685 [http-nio-8080-exec-2] DEBUG com.bgpay.bgai.filter.ApiKeyAuthenticationFilter - Skipping API Key validation for excluded path: /auth/authorize
2025-05-19 13:20:36.705 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.MockAuthController - Authorization request: client_id=bgai-client-id, redirect_uri=http://localhost:8080/api/auth/callback, response_type=code
2025-05-19 13:20:48.217 [http-nio-8080-exec-3] DEBUG com.bgpay.bgai.filter.ApiKeyAuthenticationFilter - Skipping API Key validation for excluded path: /api/auth/callback
2025-05-19 13:20:48.308 [http-nio-8080-exec-4] DEBUG com.bgpay.bgai.filter.ApiKeyAuthenticationFilter - Skipping API Key validation for excluded path: /auth/token
2025-05-19 13:20:48.318 [http-nio-8080-exec-4] INFO  com.bgpay.bgai.controller.MockAuthController - Token request: grant_type=null, code=null, client_id=null
2025-05-19 13:20:48.383 [http-nio-8080-exec-6] DEBUG com.bgpay.bgai.filter.ApiKeyAuthenticationFilter - Skipping API Key validation for excluded path: /auth/userinfo
2025-05-19 13:20:48.395 [http-nio-8080-exec-3] DEBUG com.bgpay.bgai.mapper.UserMapper.findByUserId - ==>  Preparing: SELECT * FROM t_user WHERE user_id = ?
2025-05-19 13:20:48.397 [http-nio-8080-exec-3] DEBUG com.bgpay.bgai.mapper.UserMapper.findByUserId - ==> Parameters: 689258T(String)
2025-05-19 13:20:48.436 [http-nio-8080-exec-3] DEBUG com.bgpay.bgai.mapper.UserMapper.findByUserId - <==      Total: 1
2025-05-19 13:20:48.690 [http-nio-8080-exec-3] DEBUG com.bgpay.bgai.mapper.UserMapper.updateById - ==>  Preparing: UPDATE t_user SET user_id=?, username=?, email=?, avatar_url=?, last_login_time=?, access_token=?, refresh_token=?, token_expire_time=?, status=?, create_time=?, update_time=? WHERE id=?
2025-05-19 13:20:48.701 [http-nio-8080-exec-3] DEBUG com.bgpay.bgai.mapper.UserMapper.updateById - ==> Parameters: 689258T(String), 测试用户(String), test@example.com(String), https://ui-avatars.com/api/?name=测试用户(String), 2025-05-19T13:20:48.437144800(LocalDateTime), 1361d019-fde9-46db-b05d-2254356f1a42(String), 149913d0-cefe-4b0d-8f14-c33fda0b6e07(String), 2025-05-19T14:20:48.437144800(LocalDateTime), 1(Integer), 2025-04-26T23:59:16(LocalDateTime), 2025-05-19T13:20:48.437144800(LocalDateTime), 1(Long)
2025-05-19 13:20:48.742 [http-nio-8080-exec-3] DEBUG com.bgpay.bgai.mapper.UserMapper.updateById - <==    Updates: 1
2025-05-19 13:23:38.935 [Thread-7] WARN  com.alibaba.nacos.common.notify.NotifyCenter - [NotifyCenter] Start destroying Publisher
2025-05-19 13:23:38.935 [Thread-7] WARN  com.alibaba.nacos.common.notify.NotifyCenter - [NotifyCenter] Destruction of the end
2025-05-19 13:23:38.936 [Thread-1] WARN  c.alibaba.nacos.common.http.HttpClientBeanHolder - [HttpClientBeanHolder] Start destroying common HttpClient
2025-05-19 13:23:38.937 [Thread-1] WARN  c.alibaba.nacos.common.http.HttpClientBeanHolder - [HttpClientBeanHolder] Destruction of the end
2025-05-19 13:23:38.968 [NettyClientSelector_TMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - channel inactive: [id: 0x7b076161, L:/192.168.86.8:59200 ! R:/8.133.246.113:8091]
2025-05-19 13:23:38.968 [NettyClientSelector_TMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - return to pool, rm channel:[id: 0x7b076161, L:/192.168.86.8:59200 ! R:/8.133.246.113:8091]
2025-05-19 13:23:38.968 [NettyClientSelector_TMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - channel valid false,channel:[id: 0x7b076161, L:/192.168.86.8:59200 ! R:/8.133.246.113:8091]
2025-05-19 13:23:38.968 [NettyClientSelector_TMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - will destroy channel:[id: 0x7b076161, L:/192.168.86.8:59200 ! R:/8.133.246.113:8091]
2025-05-19 13:23:38.968 [NettyClientSelector_TMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0x7b076161, L:/192.168.86.8:59200 ! R:/8.133.246.113:8091]) will closed
2025-05-19 13:23:38.969 [NettyClientSelector_TMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0x7b076161, L:/192.168.86.8:59200 ! R:/8.133.246.113:8091]) will closed
2025-05-19 13:23:38.969 [NettyClientSelector_RMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - channel inactive: [id: 0x9d3b05c8, L:/192.168.86.8:59214 ! R:/8.133.246.113:8091]
2025-05-19 13:23:38.969 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - return to pool, rm channel:[id: 0x9d3b05c8, L:/192.168.86.8:59214 ! R:/8.133.246.113:8091]
2025-05-19 13:23:38.969 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - channel valid false,channel:[id: 0x9d3b05c8, L:/192.168.86.8:59214 ! R:/8.133.246.113:8091]
2025-05-19 13:23:38.969 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - will destroy channel:[id: 0x9d3b05c8, L:/192.168.86.8:59214 ! R:/8.133.246.113:8091]
2025-05-19 13:23:38.969 [NettyClientSelector_RMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0x9d3b05c8, L:/192.168.86.8:59214 ! R:/8.133.246.113:8091]) will closed
2025-05-19 13:23:38.969 [NettyClientSelector_RMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0x9d3b05c8, L:/192.168.86.8:59214 ! R:/8.133.246.113:8091]) will closed
2025-05-19 13:23:38.983 [SpringContextShutdownHook] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - De-registering from Nacos Server now...
2025-05-19 13:23:38.987 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - [DEREGISTER-SERVICE] d750d92e-152f-4055-a641-3bc9dda85a29 deregistering service bgtech-ai with instance: Instance{instanceId='null', ip='192.168.86.8', port=8080, weight=1.0, healthy=true, enabled=true, ephemeral=true, clusterName='DEFAULT', serviceName='null', metadata={}}
2025-05-19 13:23:39.017 [SpringContextShutdownHook] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - De-registration finished.
2025-05-19 13:23:39.020 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.cache.ServiceInfoHolder do shutdown begin
2025-05-19 13:23:39.020 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.backups.FailoverReactor do shutdown begin
2025-05-19 13:23:39.021 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.backups.FailoverReactor do shutdown stop
2025-05-19 13:23:39.021 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.cache.ServiceInfoHolder do shutdown stop
2025-05-19 13:23:39.021 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.NamingClientProxyDelegate do shutdown begin
2025-05-19 13:23:39.021 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServiceInfoUpdateService do shutdown begin
2025-05-19 13:23:39.021 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServiceInfoUpdateService do shutdown stop
2025-05-19 13:23:39.021 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServerListManager do shutdown begin
2025-05-19 13:23:39.021 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Start destroying NacosRestTemplate
2025-05-19 13:23:39.021 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Destruction of the end
2025-05-19 13:23:39.021 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServerListManager do shutdown stop
2025-05-19 13:23:39.021 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.http.NamingHttpClientProxy do shutdown begin
2025-05-19 13:23:39.021 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Start destroying NacosRestTemplate
2025-05-19 13:23:39.021 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Destruction of the end
2025-05-19 13:23:39.021 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.http.NamingHttpClientProxy do shutdown stop
2025-05-19 13:23:39.021 [SpringContextShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Shutdown rpc client, set status to shutdown
2025-05-19 13:23:39.021 [SpringContextShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Shutdown client event executor java.util.concurrent.ScheduledThreadPoolExecutor@4c77eb54[Running, pool size = 2, active threads = 2, queued tasks = 0, completed tasks = 0]
2025-05-19 13:23:39.022 [SpringContextShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Close current connection 1747632030269_139.227.195.203_43957
2025-05-19 13:23:39.031 [nacos-grpc-client-executor-8.133.246.113-52] WARN  c.a.nacos.common.remote.client.grpc.GrpcClient - [1747632030269_139.227.195.203_43957]Ignore error event,isRunning:false,isAbandon=false
2025-05-19 13:23:39.032 [SpringContextShutdownHook] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - Shutdown grpc executor java.util.concurrent.ThreadPoolExecutor@6716eb44[Running, pool size = 5, active threads = 0, queued tasks = 0, completed tasks = 53]
2025-05-19 13:23:39.032 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - Shutdown grpc redo service executor java.util.concurrent.ScheduledThreadPoolExecutor@7d1a7bd8[Running, pool size = 1, active threads = 0, queued tasks = 1, completed tasks = 62]
2025-05-19 13:23:39.032 [SpringContextShutdownHook] INFO  c.a.n.client.auth.ram.identify.CredentialWatcher - [null] CredentialWatcher is stopped
2025-05-19 13:23:39.032 [SpringContextShutdownHook] INFO  c.a.n.client.auth.ram.identify.CredentialService - [null] CredentialService is freed
2025-05-19 13:23:39.033 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.NamingClientProxyDelegate do shutdown stop
2025-05-19 13:23:41.081 [SpringContextShutdownHook] DEBUG com.bgpay.bgai.config.AsyncConfig$1 - Shutting down ExecutorService 'blockingExecutor'
2025-05-19 13:23:41.131 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:10911] result: true
2025-05-19 13:23:41.131 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:9876] result: true
2025-05-19 13:23:41.152 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:10911] result: true
2025-05-19 13:23:41.152 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:9876] result: true
2025-05-19 13:23:41.268 [SpringContextShutdownHook] INFO  o.s.orm.jpa.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-05-19 13:23:41.269 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-2} closing ...
2025-05-19 13:23:41.276 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-2} closed
2025-05-19 13:23:41.276 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} closing ...
2025-05-19 13:23:41.277 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} closed
2025-05-19 13:33:55.631 [main] WARN  com.alibaba.nacos.client.logging.NacosLogging - Load Logback Configuration of Nacos fail, message: Could not initialize Logback Nacos logging from classpath:nacos-logback.xml
2025-05-19 13:33:55.633 [main] INFO  com.bgpay.bgai.BgaiApplication - The following 1 profile is active: "dev"
2025-05-19 13:33:57.461 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-05-19 13:33:57.463 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-05-19 13:33:57.486 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 16 ms. Found 0 JPA repository interfaces.
2025-05-19 13:33:57.498 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-05-19 13:33:57.499 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-05-19 13:33:57.515 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 6 ms. Found 0 Redis repository interfaces.
2025-05-19 13:33:58.069 [main] INFO  io.seata.config.ConfigurationFactory - load Configuration from :Spring Configuration
2025-05-19 13:33:58.077 [main] INFO  io.seata.config.ConfigurationFactory - load Configuration from :Spring Configuration
2025-05-19 13:33:58.083 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Initializing Global Transaction Clients ... 
2025-05-19 13:33:58.184 [main] INFO  io.seata.core.rpc.netty.NettyClientBootstrap - NettyClientBootstrap has started
2025-05-19 13:33:58.185 [main] INFO  io.seata.discovery.registry.RegistryFactory - use registry center type: file
2025-05-19 13:33:58.195 [main] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - will connect to 8.133.246.113:8091
2025-05-19 13:33:58.199 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - NettyPool create channel to transactionRole:TMROLE,address:8.133.246.113:8091,msg:< RegisterTMRequest{version='1.7.0', applicationId='bgtech-ai', transactionServiceGroup='bgai-tx-group', extraData='ak=null
digest=bgai-tx-group,192.168.86.8,1747632838198
timestamp=1747632838198
authVersion=V4
vgroup=bgai-tx-group
ip=192.168.86.8
'} >
2025-05-19 13:33:58.330 [main] INFO  io.seata.core.rpc.netty.TmNettyRemotingClient - register TM success. client version:1.7.0, server version:1.8.1-SNAPSHOT,channel:[id: 0xfc74db87, L:/192.168.86.8:59406 - R:/8.133.246.113:8091]
2025-05-19 13:33:58.336 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - register success, cost 68 ms, version:1.8.1-SNAPSHOT,role:TMROLE,channel:[id: 0xfc74db87, L:/192.168.86.8:59406 - R:/8.133.246.113:8091]
2025-05-19 13:33:58.337 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Transaction Manager Client is initialized. applicationId[bgtech-ai] txServiceGroup[bgai-tx-group]
2025-05-19 13:33:58.350 [main] INFO  io.seata.rm.datasource.AsyncWorker - Async Commit Buffer Limit: 10000
2025-05-19 13:33:58.351 [main] INFO  io.seata.rm.datasource.xa.ResourceManagerXA - ResourceManagerXA init ...
2025-05-19 13:33:58.358 [main] INFO  io.seata.core.rpc.netty.NettyClientBootstrap - NettyClientBootstrap has started
2025-05-19 13:33:58.358 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Resource Manager is initialized. applicationId[bgtech-ai] txServiceGroup[bgai-tx-group]
2025-05-19 13:33:58.358 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Global Transaction Clients are initialized. 
2025-05-19 13:33:59.471 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat initialized with port(s): 8080 (http)
2025-05-19 13:33:59.480 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - The ["http-nio-8080"] connector has been configured to support HTTP upgrade to [h2c]
2025-05-19 13:33:59.481 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - Initializing ProtocolHandler ["http-nio-8080"]
2025-05-19 13:33:59.482 [main] INFO  org.apache.catalina.core.StandardService - Starting service [Tomcat]
2025-05-19 13:33:59.482 [main] INFO  org.apache.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.15]
2025-05-19 13:33:59.901 [main] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} inited
2025-05-19 13:34:00.153 [main] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - will connect to 8.133.246.113:8091
2025-05-19 13:34:00.153 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - RM will register :jdbc:mysql://8.133.246.113:3306/deepseek
2025-05-19 13:34:00.153 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - NettyPool create channel to transactionRole:RMROLE,address:8.133.246.113:8091,msg:< RegisterRMRequest{resourceIds='jdbc:mysql://8.133.246.113:3306/deepseek', version='1.7.0', applicationId='bgtech-ai', transactionServiceGroup='bgai-tx-group', extraData='null'} >
2025-05-19 13:34:00.170 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - register RM success. client version:1.7.0, server version:1.8.1-SNAPSHOT,channel:[id: 0x4050435c, L:/192.168.86.8:59410 - R:/8.133.246.113:8091]
2025-05-19 13:34:00.171 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - register success, cost 11 ms, version:1.8.1-SNAPSHOT,role:RMROLE,channel:[id: 0x4050435c, L:/192.168.86.8:59410 - R:/8.133.246.113:8091]
2025-05-19 13:34:00.172 [main] INFO  i.s.s.a.datasource.SeataAutoDataSourceProxyCreator - Auto proxy data source 'masterDataSource' by 'AT' mode.
2025-05-19 13:34:00.244 [main] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-2} inited
2025-05-19 13:34:00.313 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - will register resourceId:jdbc:mysql://8.133.246.113:3306/deepseek
2025-05-19 13:34:00.314 [main] INFO  i.s.s.a.datasource.SeataAutoDataSourceProxyCreator - Auto proxy data source 'slaveDataSource' by 'AT' mode.
2025-05-19 13:34:00.322 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.rm.AbstractRMHandler - the rm client received response msg [RegisterRMResponse{version='1.8.1-SNAPSHOT', extraData='null', identified=true, resultCode=null, msg='null'}] from tc server.
2025-05-19 13:34:00.338 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - will register resourceId:jdbc:mysql://8.133.246.113:3306/deepseek
2025-05-19 13:34:00.338 [main] INFO  i.s.s.a.datasource.SeataAutoDataSourceProxyCreator - Auto proxy data source 'dynamicDataSource' by 'AT' mode.
2025-05-19 13:34:00.350 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.rm.AbstractRMHandler - the rm client received response msg [RegisterRMResponse{version='1.8.1-SNAPSHOT', extraData='null', identified=true, resultCode=null, msg='null'}] from tc server.
2025-05-19 13:34:00.462 [main] INFO  org.hibernate.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-05-19 13:34:00.517 [main] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.1.7.Final
2025-05-19 13:34:00.850 [main] INFO  SQL dialect - HHH000400: Using dialect: org.hibernate.dialect.MySQL8Dialect
2025-05-19 13:34:00.852 [main] WARN  org.hibernate.orm.deprecation - HHH90000026: MySQL8Dialect has been deprecated; use org.hibernate.dialect.MySQLDialect instead
2025-05-19 13:34:01.199 [main] INFO  o.h.e.t.jta.platform.internal.JtaPlatformInitiator - HHH000490: Using JtaPlatform implementation: [org.hibernate.engine.transaction.jta.platform.internal.NoJtaPlatform]
2025-05-19 13:34:01.214 [main] INFO  o.s.orm.jpa.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-05-19 13:34:01.606 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-19 13:34:01.617 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-19 13:34:01.646 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-19 13:34:01.648 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-19 13:34:01.648 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-19 13:34:01.659 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-19 13:34:02.297 [main] INFO  com.bgpay.bgai.service.impl.UserServiceImpl - 初始化SSO配置: clientId=bgai-client-id, redirectUri=http://localhost:8080/api/auth/callback
2025-05-19 13:34:02.439 [main] INFO  com.bgpay.bgai.controller.AuthController - 初始化认证控制器: clientId=bgai-client-id, redirectUri=http://localhost:8080/api/auth/callback
2025-05-19 13:34:03.003 [main] INFO  o.a.r.s.autoconfigure.RocketMQAutoConfiguration - a producer (billing-producer-group) init on namesrv 8.133.246.113:9876
2025-05-19 13:34:03.261 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Bean [com.bgpay.bgai.service.deepseek.DeepSeekServiceImp$$SpringCGLIB$$0] with name [deepSeekServiceImp] would use interceptor [io.seata.spring.annotation.GlobalTransactionalInterceptor]
2025-05-19 13:34:03.539 [main] WARN  i.s.s.b.a.provider.SpringBootConfigurationProvider - The get method not found for the field 'SeataProperties#accesskey'.
2025-05-19 13:34:03.540 [main] WARN  i.s.s.b.a.provider.SpringBootConfigurationProvider - The get method not found for the field 'SeataProperties#secretkey'.
2025-05-19 13:34:03.552 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 加载到1个Saga状态机定义文件
2025-05-19 13:34:03.726 [main] INFO  com.bgpay.bgai.saga.CustomSagaJsonParser - 开始解析状态机定义: bgai-saga-transaction
2025-05-19 13:34:03.726 [main] INFO  com.bgpay.bgai.saga.CustomSagaJsonParser - 状态机定义解析成功: bgai-saga-transaction
2025-05-19 13:34:03.726 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 成功加载状态机定义: /E:/project/bgai/target/classes/statelang/bgai-saga-transaction.json
2025-05-19 13:34:04.224 [main] INFO  org.redisson.Version - Redisson 3.24.3
2025-05-19 13:34:04.355 [redisson-netty-4-6] INFO  o.r.connection.pool.MasterPubSubConnectionPool - 1 connections initialized for 8.133.246.113/8.133.246.113:6379
2025-05-19 13:34:04.673 [redisson-netty-4-19] INFO  org.redisson.connection.pool.MasterConnectionPool - 24 connections initialized for 8.133.246.113/8.133.246.113:6379
2025-05-19 13:34:04.930 [main] INFO  com.bgpay.bgai.service.mq.MQConsumerService - MQ consumer startup successful [group=billing-consumer-group, topic=BILLING_TOPIC, tag=USER_BILLING]
2025-05-19 13:34:05.225 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Bean [com.bgpay.bgai.service.impl.SeataTransactionService$$SpringCGLIB$$0] with name [seataTransactionService] would use interceptor [io.seata.spring.annotation.GlobalTransactionalInterceptor]
2025-05-19 13:34:05.350 [main] DEBUG com.bgpay.bgai.config.AsyncConfig$1 - Initializing ExecutorService 'blockingExecutor'
2025-05-19 13:34:06.635 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [After]
2025-05-19 13:34:06.635 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Before]
2025-05-19 13:34:06.635 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Between]
2025-05-19 13:34:06.635 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Cookie]
2025-05-19 13:34:06.635 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Header]
2025-05-19 13:34:06.635 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Host]
2025-05-19 13:34:06.635 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Method]
2025-05-19 13:34:06.635 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Path]
2025-05-19 13:34:06.635 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Query]
2025-05-19 13:34:06.635 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [ReadBody]
2025-05-19 13:34:06.635 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [RemoteAddr]
2025-05-19 13:34:06.636 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [XForwardedRemoteAddr]
2025-05-19 13:34:06.636 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Weight]
2025-05-19 13:34:06.636 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [CloudFoundryRouteService]
2025-05-19 13:34:08.037 [main] INFO  o.s.b.actuate.endpoint.web.EndpointLinksResolver - Exposing 1 endpoint(s) beneath base path '/actuator'
2025-05-19 13:34:08.356 [main] WARN  i.s.s.b.a.provider.SpringBootConfigurationProvider - The get method not found for the field 'SeataProperties#accesskey'.
2025-05-19 13:34:08.357 [main] WARN  i.s.s.b.a.provider.SpringBootConfigurationProvider - The get method not found for the field 'SeataProperties#secretkey'.
2025-05-19 13:34:08.370 [main] INFO  io.seata.saga.tm.DefaultSagaTransactionalTemplate - Initializing Global Transaction Clients ... 
2025-05-19 13:34:08.371 [main] INFO  io.seata.saga.tm.DefaultSagaTransactionalTemplate - Transaction Manager Client is initialized. applicationId[bgtech-ai] txServiceGroup[bgai-tx-group]
2025-05-19 13:34:08.371 [main] INFO  io.seata.saga.tm.DefaultSagaTransactionalTemplate - Resource Manager is initialized. applicationId[bgtech-ai] txServiceGroup[bgai-tx-group]
2025-05-19 13:34:08.371 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - will register resourceId:bgtech-ai#bgai-tx-group
2025-05-19 13:34:08.371 [main] INFO  io.seata.saga.tm.DefaultSagaTransactionalTemplate - Global Transaction Clients are initialized. 
2025-05-19 13:34:08.379 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.rm.AbstractRMHandler - the rm client received response msg [RegisterRMResponse{version='1.8.1-SNAPSHOT', extraData='null', identified=true, resultCode=null, msg='null'}] from tc server.
2025-05-19 13:34:09.680 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - Starting ProtocolHandler ["http-nio-8080"]
2025-05-19 13:34:09.694 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat started on port(s): 8080 (http) with context path ''
2025-05-19 13:34:09.704 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from ans.namespace attribute : null
2025-05-19 13:34:09.704 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from ALIBABA_ALIWARE_NAMESPACE attribute :null
2025-05-19 13:34:09.705 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from namespace attribute :null
2025-05-19 13:34:09.714 [main] INFO  c.a.n.p.auth.spi.client.ClientAuthPluginManager - [ClientAuthPluginManager] Load ClientAuthService com.alibaba.nacos.client.auth.impl.NacosClientAuthServiceImpl success.
2025-05-19 13:34:09.714 [main] INFO  c.a.n.p.auth.spi.client.ClientAuthPluginManager - [ClientAuthPluginManager] Load ClientAuthService com.alibaba.nacos.client.auth.ram.RamClientAuthServiceImpl success.
2025-05-19 13:34:09.718 [main] INFO  com.alibaba.nacos.common.remote.client - [RpcClientFactory] create a new rpc client of f0b62547-e3b4-458c-8686-c237d94c64ce
2025-05-19 13:34:09.720 [main] INFO  com.alibaba.nacos.common.remote.client - [f0b62547-e3b4-458c-8686-c237d94c64ce] RpcClient init, ServerListFactory = com.alibaba.nacos.client.naming.core.ServerListManager
2025-05-19 13:34:09.720 [main] INFO  com.alibaba.nacos.common.remote.client - [f0b62547-e3b4-458c-8686-c237d94c64ce] Registry connection listener to current client:com.alibaba.nacos.client.naming.remote.gprc.redo.NamingGrpcRedoService
2025-05-19 13:34:09.720 [main] INFO  com.alibaba.nacos.common.remote.client - [f0b62547-e3b4-458c-8686-c237d94c64ce] Register server push request handler:com.alibaba.nacos.client.naming.remote.gprc.NamingPushRequestHandler
2025-05-19 13:34:09.720 [main] INFO  com.alibaba.nacos.common.remote.client - [f0b62547-e3b4-458c-8686-c237d94c64ce] Try to connect to server on start up, server: {serverIp = '8.133.246.113', server main port = 8848}
2025-05-19 13:34:09.720 [main] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - grpc client connection server:8.133.246.113 ip,serverPort:9848,grpcTslConfig:{"sslProvider":"OPENSSL","enableTls":false,"mutualAuthEnable":false,"trustAll":false}
2025-05-19 13:34:09.848 [main] INFO  com.alibaba.nacos.common.remote.client - [f0b62547-e3b4-458c-8686-c237d94c64ce] Success to connect to server [8.133.246.113:8848] on start up, connectionId = 1747632849737_139.227.195.203_43256
2025-05-19 13:34:09.848 [main] INFO  com.alibaba.nacos.common.remote.client - [f0b62547-e3b4-458c-8686-c237d94c64ce] Register server push request handler:com.alibaba.nacos.common.remote.client.RpcClient$ConnectResetRequestHandler
2025-05-19 13:34:09.848 [com.alibaba.nacos.client.remote.worker] INFO  com.alibaba.nacos.common.remote.client - [f0b62547-e3b4-458c-8686-c237d94c64ce] Notify connected event to listeners.
2025-05-19 13:34:09.848 [main] INFO  com.alibaba.nacos.common.remote.client - [f0b62547-e3b4-458c-8686-c237d94c64ce] Register server push request handler:com.alibaba.nacos.common.remote.client.RpcClient$$Lambda/0x00000165875262d8
2025-05-19 13:34:09.848 [com.alibaba.nacos.client.remote.worker] INFO  com.alibaba.nacos.client.naming - Grpc connection connect
2025-05-19 13:34:09.849 [main] INFO  com.alibaba.nacos.client.naming - [REGISTER-SERVICE] d750d92e-152f-4055-a641-3bc9dda85a29 registering service bgtech-ai with instance Instance{instanceId='null', ip='192.168.86.8', port=8080, weight=1.0, healthy=true, enabled=true, ephemeral=true, clusterName='DEFAULT', serviceName='null', metadata={IPv6=[2408:820c:7528:8342:b486:9b72:4b72:4bf0], preserved.register.source=SPRING_CLOUD}}
2025-05-19 13:34:09.867 [main] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - nacos registry, DEFAULT_GROUP bgtech-ai 192.168.86.8:8080 register finished
2025-05-19 13:34:09.921 [main] INFO  com.bgpay.bgai.BgaiApplication - Started BgaiApplication in 16.677 seconds (process running for 18.18)
2025-05-19 13:34:09.925 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-19 13:34:09.926 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-19 13:34:09.938 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-19 13:34:09.938 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-19 13:34:09.939 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-19 13:34:09.949 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-19 13:34:09.949 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-19 13:34:09.950 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-19 13:34:09.958 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-19 13:34:09.959 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-19 13:34:09.959 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-19 13:34:09.975 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-19 13:34:09.976 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - ==================== Saga状态机加载报告 ====================
2025-05-19 13:34:09.976 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - Saga状态机配置加载状态: 成功
2025-05-19 13:34:09.976 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 已加载的状态机定义文件数量: 1
2025-05-19 13:34:09.976 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 已加载的状态机定义文件:
2025-05-19 13:34:09.976 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig -  - /E:/project/bgai/target/classes/statelang/bgai-saga-transaction.json
2025-05-19 13:34:09.976 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - Saga解析器状态: CUSTOM_FASTJSON2
2025-05-19 13:34:09.976 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 状态机解析结果: 成功 1 个, 失败 0 个
2025-05-19 13:34:09.976 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - =============================================================
2025-05-19 13:34:09.981 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - nacos.cache.data.init.snapshot = true 
2025-05-19 13:34:09.981 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] common-dev.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-19 13:34:09.990 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=common-dev.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-19 13:34:09.990 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=common-dev.yaml, group=DEFAULT_GROUP
2025-05-19 13:34:09.990 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-19 13:34:09.990 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-19 13:34:09.990 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai.yaml, group=DEFAULT_GROUP
2025-05-19 13:34:09.992 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai-dev.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-19 13:34:09.992 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai-dev.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-19 13:34:09.992 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai-dev.yaml, group=DEFAULT_GROUP
2025-05-19 13:34:09.992 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-19 13:34:09.992 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai, group=DEFAULT_GROUP, cnt=1
2025-05-19 13:34:09.992 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai, group=DEFAULT_GROUP
2025-05-19 13:34:18.333 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - 接收到请求: /api/chatGatWay-internal, 文件=张陇阳的简历.pdf, 问题参数=null, 模型参数=null
2025-05-19 13:34:18.335 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - 请求Content-Type: multipart/form-data;boundary=--------------------------355990493990566844824296
2025-05-19 13:34:18.335 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - 收集到的完整参数: question="null", apiUrl="null", modelName="null", multiTurn=false
2025-05-19 13:34:18.337 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - Processing request for user ID: 689258T
2025-05-19 13:34:18.337 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - Processing file with circuit breaker: fileName=张陇阳的简历.pdf, question=
2025-05-19 13:34:18.339 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.config.ReactiveFileProcessor - Processing file: 张陇阳的简历.pdf, content-type: application/pdf
2025-05-19 13:34:18.346 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - PARAM TRACE [689258T]: 尝试查找匹配配置 - 参数: apiUrl=null, modelName=null
2025-05-19 13:34:18.356 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 查询配置 - userId=689258T
2025-05-19 13:34:18.358 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 排序方式 - 按ID降序
2025-05-19 13:34:18.358 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 限制结果数 - LIMIT 1
2025-05-19 13:34:18.424 [http-nio-8080-exec-2] DEBUG com.bgpay.bgai.mapper.ApiConfigMapper.selectList - ==>  Preparing: SELECT id,api_url,api_key,model_name,user_id FROM api_config WHERE (user_id = ?) ORDER BY id DESC LIMIT 1
2025-05-19 13:34:18.426 [http-nio-8080-exec-2] DEBUG com.bgpay.bgai.mapper.ApiConfigMapper.selectList - ==> Parameters: 689258T(String)
2025-05-19 13:34:18.440 [http-nio-8080-exec-2] DEBUG com.bgpay.bgai.mapper.ApiConfigMapper.selectList - <==      Total: 1
2025-05-19 13:34:18.440 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 查询结果 - 找到配置: id=2, modelName=deepseek-chat
2025-05-19 13:34:18.440 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - PARAM TRACE [689258T]: 找到匹配配置 - apiUrl=https://api.deepseek.com/chat/completions, modelName=deepseek-chat (原始请求: null)
2025-05-19 13:34:18.440 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - API config resolved: url=https://api.deepseek.com/chat/completions, model=deepseek-chat
2025-05-19 13:34:18.465 [Thread-47] INFO  com.bgpay.bgai.config.ReactiveFileProcessor - File processed successfully: size=146595 bytes
2025-05-19 13:34:18.807 [Thread-47] INFO  com.bgpay.bgai.controller.ReactiveChatController - Content processed, length: 6507
2025-05-19 13:34:18.814 [Thread-47] INFO  io.seata.tm.TransactionManagerHolder - TransactionManager Singleton io.seata.tm.DefaultTransactionManager@60611af1
2025-05-19 13:34:18.853 [Thread-47] INFO  io.seata.tm.api.DefaultGlobalTransaction - Begin new global transaction [seata-server:8091:27673667088527361]
2025-05-19 13:34:18.871 [Thread-47] INFO  c.b.bgai.service.impl.TransactionLogServiceImpl - 记录分布式事务开始: XID=seata-server:8091:27673667088527361, 业务=com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive
2025-05-19 13:34:18.878 [Thread-47] DEBUG com.bgpay.bgai.mapper.TransactionLogMapper.insert - ==>  Preparing: INSERT INTO transaction_log ( xid, transaction_name, transaction_mode, status, request_path, source_ip, start_time, user_id, create_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-05-19 13:34:18.882 [Thread-47] DEBUG com.bgpay.bgai.mapper.TransactionLogMapper.insert - ==> Parameters: seata-server:8091:27673667088527361(String), com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive(String), AT(String), ACTIVE(String), (String), (String), 2025-05-19T13:34:18.871718300(LocalDateTime), (String), 2025-05-19T13:34:18.871718300(LocalDateTime)
2025-05-19 13:34:19.327 [Thread-47] DEBUG com.bgpay.bgai.mapper.TransactionLogMapper.insert - <==    Updates: 1
2025-05-19 13:34:19.368 [Thread-47] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:27673667088527361, branchId:27673667088527362, lockKeys:transaction_log:1
2025-05-19 13:34:19.387 [Thread-47] WARN  i.s.c.l.EnhancedServiceLoader$InnerEnhancedServiceLoader - Load [io.seata.rm.datasource.undo.parser.ProtostuffUndoLogParser] class fail: io/protostuff/runtime/IdStrategy
2025-05-19 13:34:19.465 [Thread-47] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:27673667088527361, branchId:27673667088527363, lockKeys:undo_log:1;transaction_log:1
2025-05-19 13:34:19.495 [Thread-47] INFO  c.b.bgai.interceptor.SeataTransactionInterceptor - 开始分布式事务: XID=seata-server:8091:27673667088527361, 方法=com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive
2025-05-19 13:34:19.506 [Thread-47] INFO  org.reflections.Reflections - Processing reactive request: content length=6507, apiUrl=https://api.deepseek.com/chat/completions, modelName=deepseek-chat, userId=689258T, multiTurn=false
2025-05-19 13:34:19.536 [Thread-47] INFO  com.bgpay.bgai.transaction.TransactionCoordinator - Transaction prepared for user 689258T: chatCompletionId=chat-dfb9ca2d-5910-4282-9554-29474caec418
2025-05-19 13:34:19.539 [Thread-47] INFO  org.reflections.Reflections - Generated request JSON with 2PC transaction: {"stream":false,"max_tokens":2000,"temperature":1.0,"messages":[{"role":"system","content":"You are ...
2025-05-19 13:34:19.575 [Thread-47] INFO  c.b.bgai.service.impl.TransactionLogServiceImpl - 记录分布式事务结束: XID=seata-server:8091:27673667088527361, 状态=COMMITTED
2025-05-19 13:34:19.577 [Thread-47] DEBUG c.b.bgai.mapper.TransactionLogMapper.selectList - ==>  Preparing: SELECT id,xid,branch_id,transaction_name,transaction_mode,status,request_path,source_ip,start_time,end_time,user_id,extra_data,create_time,update_time FROM transaction_log WHERE (xid = ?) LIMIT 1
2025-05-19 13:34:19.580 [Thread-47] DEBUG c.b.bgai.mapper.TransactionLogMapper.selectList - ==> Parameters: seata-server:8091:27673667088527361(String)
2025-05-19 13:34:19.589 [Thread-47] DEBUG c.b.bgai.mapper.TransactionLogMapper.selectList - <==      Total: 1
2025-05-19 13:34:19.597 [Thread-47] DEBUG c.b.bgai.mapper.TransactionLogMapper.updateById - ==>  Preparing: UPDATE transaction_log SET xid=?, transaction_name=?, transaction_mode=?, status=?, request_path=?, source_ip=?, start_time=?, end_time=?, user_id=?, extra_data=?, create_time=?, update_time=? WHERE id=?
2025-05-19 13:34:19.606 [Thread-47] DEBUG c.b.bgai.mapper.TransactionLogMapper.updateById - ==> Parameters: seata-server:8091:27673667088527361(String), com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive(String), AT(String), COMMITTED(String), (String), (String), 2025-05-19T13:34:19(LocalDateTime), 2025-05-19T13:34:19.589553200(LocalDateTime), (String), {"duration":73,"result":"success"}(String), 2025-05-19T13:34:19(LocalDateTime), 2025-05-19T13:34:19.589553200(LocalDateTime), 1(Long)
2025-05-19 13:34:19.660 [Thread-47] DEBUG c.b.bgai.mapper.TransactionLogMapper.updateById - <==    Updates: 1
2025-05-19 13:34:19.670 [Thread-47] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:27673667088527361, branchId:27673667088527364, lockKeys:transaction_log:1
2025-05-19 13:34:19.691 [Thread-47] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:27673667088527361, branchId:27673667088527365, lockKeys:undo_log:3;transaction_log:1
2025-05-19 13:34:19.726 [Thread-47] INFO  c.b.bgai.interceptor.SeataTransactionInterceptor - 分布式事务成功完成: XID=seata-server:8091:27673667088527361, 耗时=73ms
2025-05-19 13:34:19.726 [Thread-47] INFO  io.seata.tm.api.DefaultGlobalTransaction - transaction seata-server:8091:27673667088527361 will be commit
2025-05-19 13:34:19.740 [Thread-47] INFO  io.seata.tm.api.DefaultGlobalTransaction - transaction end, xid = seata-server:8091:27673667088527361
2025-05-19 13:34:19.740 [Thread-47] INFO  io.seata.tm.api.DefaultGlobalTransaction - [seata-server:8091:27673667088527361] commit status: Committed
2025-05-19 13:34:20.663 [rpcDispatch_RMROLE_1_1_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:27673667088527361', branchId=27673667088527362, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false,"skipCheckLock":true}'}
2025-05-19 13:34:20.666 [rpcDispatch_RMROLE_1_1_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:27673667088527361 27673667088527362 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false,"skipCheckLock":true}
2025-05-19 13:34:20.672 [rpcDispatch_RMROLE_1_1_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-19 13:34:20.761 [rpcDispatch_RMROLE_1_2_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:27673667088527361', branchId=27673667088527363, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false,"skipCheckLock":true}'}
2025-05-19 13:34:20.762 [rpcDispatch_RMROLE_1_2_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:27673667088527361 27673667088527363 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false,"skipCheckLock":true}
2025-05-19 13:34:20.762 [rpcDispatch_RMROLE_1_2_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-19 13:34:20.773 [rpcDispatch_RMROLE_1_3_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:27673667088527361', branchId=27673667088527364, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false}'}
2025-05-19 13:34:20.773 [rpcDispatch_RMROLE_1_3_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:27673667088527361 27673667088527364 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false}
2025-05-19 13:34:20.773 [rpcDispatch_RMROLE_1_3_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-19 13:34:20.854 [rpcDispatch_RMROLE_1_4_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:27673667088527361', branchId=27673667088527365, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false}'}
2025-05-19 13:34:20.854 [rpcDispatch_RMROLE_1_4_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:27673667088527361 27673667088527365 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false}
2025-05-19 13:34:20.854 [rpcDispatch_RMROLE_1_4_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-19 13:35:05.457 [reactor-http-nio-3] INFO  org.reflections.Reflections - Raw response received, length: 2226
2025-05-19 13:35:05.465 [reactor-http-nio-3] WARN  org.reflections.Reflections - Received different chatCompletionId from response: 2bce6bb9-560a-4230-acc5-e8817b897461 vs prepared: chat-dfb9ca2d-5910-4282-9554-29474caec418
2025-05-19 13:35:05.479 [reactor-http-nio-3] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - ==>  Preparing: INSERT INTO chat_completions ( object, created, model, system_fingerprint, api_key ) VALUES ( ?, ?, ?, ?, ? )
2025-05-19 13:35:05.480 [reactor-http-nio-3] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - ==> Parameters: chat.completion(String), 1747632905478(Long), deepseek-chat(String), 689258T(String), chat-dfb9ca2d-5910-4282-9554-29474caec418(String)
2025-05-19 13:35:05.494 [reactor-http-nio-3] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - <==    Updates: 1
2025-05-19 13:35:05.495 [reactor-http-nio-3] INFO  com.bgpay.bgai.transaction.TransactionCoordinator - Transaction committed for user 689258T: chatCompletionId=chat-dfb9ca2d-5910-4282-9554-29474caec418
2025-05-19 13:35:05.513 [FileWrite-1] INFO  com.bgpay.bgai.service.deepseek.FileWriterService - Successfully wrote content to: \var\data\ai_responses\b724a2c8-3e35-4c89-a2e5-0458734df962.txt
2025-05-19 13:35:05.520 [boundedElastic-1] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - ==>  Preparing: INSERT INTO chat_completions ( object, created, model, system_fingerprint, api_key ) VALUES ( ?, ?, ?, ?, ? )
2025-05-19 13:35:05.520 [boundedElastic-1] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - ==> Parameters: chat.completion(String), 1747632860(Long), deepseek-chat(String), fp_8802369eaa_prod0425fp8(String), chat-dfb9ca2d-5910-4282-9554-29474caec418(String)
2025-05-19 13:35:05.530 [boundedElastic-1] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - <==    Updates: 1
2025-05-19 13:35:05.552 [boundedElastic-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.insert - ==>  Preparing: INSERT INTO usage_info ( chat_completion_id, prompt_tokens, completion_tokens, total_tokens, prompt_tokens_cached, completion_reasoning_tokens, prompt_cache_hit_tokens, prompt_cache_miss_tokens, created_at, model_type ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-05-19 13:35:05.552 [boundedElastic-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.insert - ==> Parameters: chat-dfb9ca2d-5910-4282-9554-29474caec418(String), 3796(Integer), 870(Integer), 4666(Integer), 3776(Integer), 0(Integer), 0(Integer), 20(Integer), 2025-05-19T13:35:05.543865900(LocalDateTime), deepseek-chat(String)
2025-05-19 13:35:05.569 [boundedElastic-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.insert - <==    Updates: 1
2025-05-19 13:35:05.583 [boundedElastic-1] INFO  org.reflections.Reflections - Completion data saved synchronously for chatCompletionId: chat-dfb9ca2d-5910-4282-9554-29474caec418
2025-05-19 13:35:05.588 [boundedElastic-2] INFO  org.reflections.Reflections - 开始发送账单消息，chatCompletionId: chat-dfb9ca2d-5910-4282-9554-29474caec418, userId: 689258T
2025-05-19 13:35:05.658 [boundedElastic-2] INFO  org.reflections.Reflections - 账单消息发送成功，chatCompletionId: chat-dfb9ca2d-5910-4282-9554-29474caec418, userId: 689258T
2025-05-19 13:35:05.662 [boundedElastic-1] INFO  org.reflections.Reflections - Complete processing chain completed: 以下是张陇阳简历的优化建议及分点总结，旨在提升专业性、清晰度和竞争力：

---

### **一、格式与结构优化**
1. **统一排版**  
   - 中英文混排时增加空格（如"Personal resume"后）。  
   - 使用项目符号（•）替代“-”或“·”，保持列表一致性。  
   - 日期格式统一为“YYYY.MM - YYYY.MM”（如2023.04 - 2025.02）。  

2. **模块顺序调整**  
   建议按以下顺序排列：  
   - 基本信息 → 教育背景 → 工作经历（按时间倒序）→ 项目经验（合并到对应公司下）→ 技能特长 → 自我评价。  

3. **精简冗余内容**  
   - 删除重复描述（如“订单&支付系统”在工作经验和项目经验中重复出现）。  
   - 合并相似职责（如“自动化测试框架构建”可整合到技能特长中）。

---

### **二、内容强化建议**
#### **1. 工作经历**  
- **量化成果**  
  - 原句：*“重复扣款发生率降低”*  
    → 修改为：*“通过Redis分布式锁+RocketMQ消息去重，重复扣款率从2%降至0.1%”*  
  - 原句：*“支付接口响应时间缩短”*  
    → 修改为：*“优化数据库连接池与缓存策略，支付接口平均响应时间从1.2s缩短至0.5s”*  

- **技术关键词前置**  
  例：  
  > *“基于K8s+Docker构建弹性测试环境，部署效率提升50%”*  

#### **2. 项目经验**  
- **STAR法则优化**  
  - **Situation**：明确项目背景（如业务规模、痛点）。  
  - **Task**：突出个人角色（如“主导”“独立负责”）。  
  - **Action**：技术细节+工具链（如“使用Spark实时监控支付流水”）。  
  - **Result**：量化影响（如“退款成功率从85%提升至99%”）。  

#### **3. 技能特长**  
- **分层展示**：  
  ```markdown
  - **编程语言**: Java (Spring Boot), Python  
  - **中间件**: RocketMQ/Kafka, Redis, Elasticsearch  
  - **测试工具**: MeterSphere (二次开发), Selenium, Jira  
  - **云原生**: Docker/K8s, AWS EC2  
  ```  

---

### **三、语言表达优化**
1. **避免口语化**  
   - 原句：*“细心从每一个小细节开始”*  
     → 修改为：*“注重细节，追求系统稳定性与用户体验的极致优化”*  

2. **强化动作动词**  
   - 使用“构建”“设计”“优化”“主导”替代“负责”“参与”。  

3. **删除无效信息**  
   - 如“婚姻状况”“身高体重”等与岗位无关内容。

---

### **四、竞争力提升点**
1. **突出金融+新能源复合背景**  
   - 在摘要中强调：*“6年测试开发经验，覆盖金融支付、证券交易及新能源车联网系统，擅长高并发场景质量保障”*  

2. **补充证书/学习**（如有）  
   - 例如：*“ISTQB认证，持续学习云原生架构与性能测试”*  

3. **GitHub/技术博客**  
   - 若开源贡献或技术文章，可添加到联系方式中。

---

### **修改后简历优势**
- **更清晰的职业定位**：聚焦测试开发工程师角色，突出技术深度。  
- **数据驱动说服力**：量化成果提升HR和技术面试官的关注度。  
- **技术前瞻性**：云原生、实时计算等关键词贴合行业趋势。  

建议使用LaTeX或专业模板（如“超级简历”）进一步优化视觉呈现。
2025-05-19 13:35:05.663 [boundedElastic-1] INFO  com.bgpay.bgai.controller.ReactiveChatController - Processed response for user 689258T, content length: 1688
2025-05-19 13:35:46.549 [pool-7-thread-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.selectCount - ==>  Preparing: SELECT COUNT( * ) AS total FROM usage_info WHERE (chat_completion_id = ?)
2025-05-19 13:35:46.550 [pool-7-thread-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.selectCount - ==> Parameters: chat-dfb9ca2d-5910-4282-9554-29474caec418(String)
2025-05-19 13:35:46.557 [pool-7-thread-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.selectCount - <==      Total: 1
2025-05-19 13:35:46.666 [ConsumeMessageThread_billing-consumer-group_1] DEBUG c.bgpay.bgai.mapper.PriceConfigMapper.selectList - ==>  Preparing: SELECT id,model_type,time_period,cache_status,io_type,price,version,effective_time FROM price_config WHERE (model_type = ? AND time_period = ? AND io_type = ? AND effective_time <= ? AND cache_status = ?) ORDER BY effective_time DESC LIMIT 1
2025-05-19 13:35:46.666 [ConsumeMessageThread_billing-consumer-group_1] DEBUG c.bgpay.bgai.mapper.PriceConfigMapper.selectList - ==> Parameters: deepseek-chat(String), standard(String), input(String), 2025-05-19T13:35:46.664620(LocalDateTime), miss(String)
2025-05-19 13:35:46.683 [ConsumeMessageThread_billing-consumer-group_1] DEBUG c.bgpay.bgai.mapper.PriceConfigMapper.selectList - <==      Total: 1
2025-05-19 13:35:46.751 [ConsumeMessageThread_billing-consumer-group_1] DEBUG c.bgpay.bgai.mapper.PriceConfigMapper.selectList - ==>  Preparing: SELECT id,model_type,time_period,cache_status,io_type,price,version,effective_time FROM price_config WHERE (model_type = ? AND time_period = ? AND io_type = ? AND effective_time <= ? AND cache_status IS NULL) ORDER BY effective_time DESC LIMIT 1
2025-05-19 13:35:46.752 [ConsumeMessageThread_billing-consumer-group_1] DEBUG c.bgpay.bgai.mapper.PriceConfigMapper.selectList - ==> Parameters: deepseek-chat(String), standard(String), output(String), 2025-05-19T13:35:46.749991300(LocalDateTime)
2025-05-19 13:35:46.760 [ConsumeMessageThread_billing-consumer-group_1] DEBUG c.bgpay.bgai.mapper.PriceConfigMapper.selectList - <==      Total: 1
2025-05-19 13:35:46.826 [ConsumeMessageThread_billing-consumer-group_1] INFO  c.bgpay.bgai.service.mq.RocketMQBillingServiceImpl - Output price config priceVersion: 1
2025-05-19 13:35:46.829 [ConsumeMessageThread_billing-consumer-group_1] DEBUG com.bgpay.bgai.mapper.UsageRecordMapper.insert - ==>  Preparing: INSERT INTO usage_record ( model_type, chat_completion_id, user_id, input_cost, output_cost, price_version, calculated_at ) VALUES ( ?, ?, ?, ?, ?, ?, ? )
2025-05-19 13:35:46.829 [ConsumeMessageThread_billing-consumer-group_1] DEBUG com.bgpay.bgai.mapper.UsageRecordMapper.insert - ==> Parameters: deepseek-chat(String), chat-dfb9ca2d-5910-4282-9554-29474caec418(String), 689258T(String), 0.0000(BigDecimal), 0.0070(BigDecimal), 1(Integer), 2025-05-19T13:35:46.826510100(LocalDateTime)
2025-05-19 13:35:46.850 [ConsumeMessageThread_billing-consumer-group_1] DEBUG com.bgpay.bgai.mapper.UsageRecordMapper.insert - <==    Updates: 1
2025-05-19 13:35:46.859 [ConsumeMessageThread_billing-consumer-group_1] INFO  c.bgpay.bgai.service.mq.RocketMQBillingServiceImpl - Message consumed: 2408820C75288342B4869B724B724BF0861C36BAF30C5F9CB5940000
2025-05-19 13:39:09.939 [scheduling-1] WARN  com.alibaba.druid.pool.DruidAbstractDataSource - discard long time none received connection. , jdbcUrl : jdbc:mysql://8.133.246.113:3306/deepseek?autoReconnect=false&useUnicode=true&characterEncoding=UTF-8&characterSetResults=UTF-8&zeroDateTimeBehavior=convertToNull&useSSL=false&allowPublicKeyRetrieval=true&useSSL=false, version : 1.2.8, lastPacketReceivedIdleMillis : 203076
2025-05-19 13:39:10.945 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-19 13:39:10.945 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-19 13:39:10.956 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-19 13:39:10.956 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-19 13:39:10.956 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-19 13:39:10.964 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-19 13:42:01.018 [http-nio-8080-exec-6] ERROR o.s.b.a.w.r.error.AbstractErrorWebExceptionHandler - [430191f3]  500 Server Error for HTTP POST "/api/chatGatWay-internal"
org.springframework.data.redis.RedisSystemException: Redis exception
	at org.springframework.data.redis.connection.lettuce.LettuceExceptionConverter.convert(LettuceExceptionConverter.java:72)
	Suppressed: reactor.core.publisher.FluxOnAssembly$OnAssemblyException: 
Assembly trace from producer [reactor.core.publisher.MonoDefer] :
	reactor.core.publisher.Mono.defer(Mono.java:218)
	org.springframework.web.server.handler.DefaultWebFilterChain.filter(DefaultWebFilterChain.java:106)
Error has been observed at the following site(s):
	*______________Mono.defer ⇢ at org.springframework.web.server.handler.DefaultWebFilterChain.filter(DefaultWebFilterChain.java:106)
	|_             checkpoint ⇢ org.springframework.cloud.gateway.filter.WeightCalculatorWebFilter [DefaultWebFilterChain]
	*______________Mono.defer ⇢ at org.springframework.web.server.handler.DefaultWebFilterChain.filter(DefaultWebFilterChain.java:106)
	|_          Mono.doOnEach ⇢ at org.springframework.web.filter.reactive.ServerHttpObservationFilter.filter(ServerHttpObservationFilter.java:109)
	|_        Mono.doOnCancel ⇢ at org.springframework.web.filter.reactive.ServerHttpObservationFilter.filter(ServerHttpObservationFilter.java:119)
	|_      Mono.contextWrite ⇢ at org.springframework.web.filter.reactive.ServerHttpObservationFilter.filter(ServerHttpObservationFilter.java:123)
	*__Mono.transformDeferred ⇢ at org.springframework.web.filter.reactive.ServerHttpObservationFilter.filter(ServerHttpObservationFilter.java:102)
	|_             checkpoint ⇢ org.springframework.web.filter.reactive.ServerHttpObservationFilter [DefaultWebFilterChain]
	*______________Mono.defer ⇢ at org.springframework.web.server.handler.DefaultWebFilterChain.filter(DefaultWebFilterChain.java:106)
	|_     Mono.onErrorResume ⇢ at org.springframework.web.server.handler.ExceptionHandlingWebHandler.handle(ExceptionHandlingWebHandler.java:77)
	|_     Mono.onErrorResume ⇢ at org.springframework.web.server.handler.ExceptionHandlingWebHandler.handle(ExceptionHandlingWebHandler.java:77)
	*______________Mono.error ⇢ at org.springframework.web.server.handler.ExceptionHandlingWebHandler$CheckpointInsertingHandler.handle(ExceptionHandlingWebHandler.java:98)
	|_             checkpoint ⇢ HTTP POST "/api/chatGatWay-internal" [ExceptionHandlingWebHandler]
	*______________Mono.error ⇢ at org.springframework.cloud.gateway.filter.headers.observation.ObservationClosingWebExceptionHandler.handle(ObservationClosingWebExceptionHandler.java:53)
Original Stack Trace:
		at org.springframework.data.redis.connection.lettuce.LettuceExceptionConverter.convert(LettuceExceptionConverter.java:72)
		at org.springframework.data.redis.connection.lettuce.LettuceExceptionConverter.convert(LettuceExceptionConverter.java:41)
		at org.springframework.data.redis.PassThroughExceptionTranslationStrategy.translate(PassThroughExceptionTranslationStrategy.java:40)
		at org.springframework.data.redis.FallbackExceptionTranslationStrategy.translate(FallbackExceptionTranslationStrategy.java:38)
		at org.springframework.data.redis.connection.lettuce.LettuceConnection.convertLettuceAccessException(LettuceConnection.java:256)
		at org.springframework.data.redis.connection.lettuce.LettuceConnection.await(LettuceConnection.java:969)
		at org.springframework.data.redis.connection.lettuce.LettuceConnection.lambda$doInvoke$4(LettuceConnection.java:826)
		at org.springframework.data.redis.connection.lettuce.LettuceInvoker$Synchronizer.invoke(LettuceInvoker.java:665)
		at org.springframework.data.redis.connection.lettuce.LettuceInvoker.just(LettuceInvoker.java:94)
		at org.springframework.data.redis.connection.lettuce.LettuceStringCommands.get(LettuceStringCommands.java:54)
		at org.springframework.data.redis.connection.DefaultedRedisConnection.get(DefaultedRedisConnection.java:284)
		at org.springframework.data.redis.core.DefaultValueOperations$1.inRedis(DefaultValueOperations.java:54)
		at org.springframework.data.redis.core.AbstractOperations$ValueDeserializingRedisCallback.doInRedis(AbstractOperations.java:61)
		at org.springframework.data.redis.core.RedisTemplate.execute(RedisTemplate.java:406)
		at org.springframework.data.redis.core.RedisTemplate.execute(RedisTemplate.java:373)
		at org.springframework.data.redis.core.AbstractOperations.execute(AbstractOperations.java:97)
		at org.springframework.data.redis.core.DefaultValueOperations.get(DefaultValueOperations.java:50)
		at com.bgpay.bgai.service.impl.UserServiceImpl.validateToken(UserServiceImpl.java:210)
		at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
		at java.base/java.lang.reflect.Method.invoke(Method.java:580)
		at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:343)
		at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
		at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
		at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:751)
		at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)
		at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
		at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:751)
		at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:703)
		at com.bgpay.bgai.service.impl.UserServiceImpl$$SpringCGLIB$$0.validateToken(<generated>)
		at com.bgpay.bgai.config.AuthenticationFilter.filter(AuthenticationFilter.java:70)
		at org.springframework.web.server.handler.DefaultWebFilterChain.invokeFilter(DefaultWebFilterChain.java:114)
		at org.springframework.web.server.handler.DefaultWebFilterChain.lambda$filter$0(DefaultWebFilterChain.java:108)
		at reactor.core.publisher.MonoDefer.subscribe(MonoDefer.java:45)
		at reactor.core.publisher.InternalMonoOperator.subscribe(InternalMonoOperator.java:64)
		at reactor.core.publisher.MonoDefer.subscribe(MonoDefer.java:53)
		at reactor.core.publisher.InternalMonoOperator.subscribe(InternalMonoOperator.java:64)
		at reactor.core.publisher.MonoDefer.subscribe(MonoDefer.java:53)
		at reactor.core.publisher.InternalMonoOperator.subscribe(InternalMonoOperator.java:64)
		at reactor.core.publisher.MonoDefer.subscribe(MonoDefer.java:53)
		at reactor.core.publisher.Mono.subscribe(Mono.java:4495)
		at reactor.core.publisher.MonoIgnoreThen$ThenIgnoreMain.subscribeNext(MonoIgnoreThen.java:263)
		at reactor.core.publisher.MonoIgnoreThen.subscribe(MonoIgnoreThen.java:51)
		at reactor.core.publisher.Mono.subscribe(Mono.java:4495)
		at reactor.core.publisher.MonoIgnoreThen$ThenIgnoreMain.subscribeNext(MonoIgnoreThen.java:263)
		at reactor.core.publisher.MonoIgnoreThen.subscribe(MonoIgnoreThen.java:51)
		at reactor.core.publisher.Mono.subscribe(Mono.java:4495)
		at org.springframework.http.server.reactive.ServletHttpHandlerAdapter.service(ServletHttpHandlerAdapter.java:199)
		at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205)
		at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
		at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
		at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
		at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
		at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
		at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
		at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
		at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
		at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
		at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
		at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:340)
		at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
		at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
		at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
		at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744)
		at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
		at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
		at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
		at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
		at java.base/java.lang.Thread.run(Thread.java:1583)
Caused by: io.lettuce.core.RedisException: java.net.SocketException: Connection reset
	at io.lettuce.core.internal.Exceptions.bubble(Exceptions.java:83)
	at io.lettuce.core.internal.Futures.awaitOrCancel(Futures.java:250)
	at io.lettuce.core.LettuceFutures.awaitOrCancel(LettuceFutures.java:74)
	at org.springframework.data.redis.connection.lettuce.LettuceConnection.await(LettuceConnection.java:967)
	at org.springframework.data.redis.connection.lettuce.LettuceConnection.lambda$doInvoke$4(LettuceConnection.java:826)
	at org.springframework.data.redis.connection.lettuce.LettuceInvoker$Synchronizer.invoke(LettuceInvoker.java:665)
	at org.springframework.data.redis.connection.lettuce.LettuceInvoker.just(LettuceInvoker.java:94)
	at org.springframework.data.redis.connection.lettuce.LettuceStringCommands.get(LettuceStringCommands.java:54)
	at org.springframework.data.redis.connection.DefaultedRedisConnection.get(DefaultedRedisConnection.java:284)
	at org.springframework.data.redis.core.DefaultValueOperations$1.inRedis(DefaultValueOperations.java:54)
	at org.springframework.data.redis.core.AbstractOperations$ValueDeserializingRedisCallback.doInRedis(AbstractOperations.java:61)
	at org.springframework.data.redis.core.RedisTemplate.execute(RedisTemplate.java:406)
	at org.springframework.data.redis.core.RedisTemplate.execute(RedisTemplate.java:373)
	at org.springframework.data.redis.core.AbstractOperations.execute(AbstractOperations.java:97)
	at org.springframework.data.redis.core.DefaultValueOperations.get(DefaultValueOperations.java:50)
	at com.bgpay.bgai.service.impl.UserServiceImpl.validateToken(UserServiceImpl.java:210)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:343)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:751)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:751)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:703)
	at com.bgpay.bgai.service.impl.UserServiceImpl$$SpringCGLIB$$0.validateToken(<generated>)
	at com.bgpay.bgai.config.AuthenticationFilter.filter(AuthenticationFilter.java:70)
	at org.springframework.web.server.handler.DefaultWebFilterChain.invokeFilter(DefaultWebFilterChain.java:114)
	at org.springframework.web.server.handler.DefaultWebFilterChain.lambda$filter$0(DefaultWebFilterChain.java:108)
	at reactor.core.publisher.MonoDefer.subscribe(MonoDefer.java:45)
	at reactor.core.publisher.InternalMonoOperator.subscribe(InternalMonoOperator.java:64)
	at reactor.core.publisher.MonoDefer.subscribe(MonoDefer.java:53)
	at reactor.core.publisher.InternalMonoOperator.subscribe(InternalMonoOperator.java:64)
	at reactor.core.publisher.MonoDefer.subscribe(MonoDefer.java:53)
	at reactor.core.publisher.InternalMonoOperator.subscribe(InternalMonoOperator.java:64)
	at reactor.core.publisher.MonoDefer.subscribe(MonoDefer.java:53)
	at reactor.core.publisher.Mono.subscribe(Mono.java:4495)
	at reactor.core.publisher.MonoIgnoreThen$ThenIgnoreMain.subscribeNext(MonoIgnoreThen.java:263)
	at reactor.core.publisher.MonoIgnoreThen.subscribe(MonoIgnoreThen.java:51)
	at reactor.core.publisher.Mono.subscribe(Mono.java:4495)
	at reactor.core.publisher.MonoIgnoreThen$ThenIgnoreMain.subscribeNext(MonoIgnoreThen.java:263)
	at reactor.core.publisher.MonoIgnoreThen.subscribe(MonoIgnoreThen.java:51)
	at reactor.core.publisher.Mono.subscribe(Mono.java:4495)
	at org.springframework.http.server.reactive.ServletHttpHandlerAdapter.service(ServletHttpHandlerAdapter.java:199)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:340)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.base/java.lang.Thread.run(Thread.java:1583)
Caused by: java.net.SocketException: Connection reset
	at java.base/sun.nio.ch.SocketChannelImpl.throwConnectionReset(SocketChannelImpl.java:401)
	at java.base/sun.nio.ch.SocketChannelImpl.read(SocketChannelImpl.java:434)
	at io.netty.buffer.PooledByteBuf.setBytes(PooledByteBuf.java:254)
	at io.netty.buffer.AbstractByteBuf.writeBytes(AbstractByteBuf.java:1132)
	at io.netty.channel.socket.nio.NioSocketChannel.doReadBytes(NioSocketChannel.java:357)
	at io.netty.channel.nio.AbstractNioByteChannel$NioByteUnsafe.read(AbstractNioByteChannel.java:151)
	at io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:788)
	at io.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:724)
	at io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:650)
	at io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:562)
	at io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:997)
	at io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	... 1 common frames omitted
2025-05-19 13:42:23.734 [Thread-1] WARN  c.alibaba.nacos.common.http.HttpClientBeanHolder - [HttpClientBeanHolder] Start destroying common HttpClient
2025-05-19 13:42:23.734 [Thread-7] WARN  com.alibaba.nacos.common.notify.NotifyCenter - [NotifyCenter] Start destroying Publisher
2025-05-19 13:42:23.734 [Thread-7] WARN  com.alibaba.nacos.common.notify.NotifyCenter - [NotifyCenter] Destruction of the end
2025-05-19 13:42:23.735 [Thread-1] WARN  c.alibaba.nacos.common.http.HttpClientBeanHolder - [HttpClientBeanHolder] Destruction of the end
2025-05-19 13:42:23.750 [NettyClientSelector_TMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - channel inactive: [id: 0xfc74db87, L:/192.168.86.8:59406 ! R:/8.133.246.113:8091]
2025-05-19 13:42:23.750 [NettyClientSelector_TMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - return to pool, rm channel:[id: 0xfc74db87, L:/192.168.86.8:59406 ! R:/8.133.246.113:8091]
2025-05-19 13:42:23.750 [NettyClientSelector_TMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - channel valid false,channel:[id: 0xfc74db87, L:/192.168.86.8:59406 ! R:/8.133.246.113:8091]
2025-05-19 13:42:23.750 [NettyClientSelector_TMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - will destroy channel:[id: 0xfc74db87, L:/192.168.86.8:59406 ! R:/8.133.246.113:8091]
2025-05-19 13:42:23.750 [NettyClientSelector_TMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0xfc74db87, L:/192.168.86.8:59406 ! R:/8.133.246.113:8091]) will closed
2025-05-19 13:42:23.750 [NettyClientSelector_TMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0xfc74db87, L:/192.168.86.8:59406 ! R:/8.133.246.113:8091]) will closed
2025-05-19 13:42:23.751 [NettyClientSelector_RMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - channel inactive: [id: 0x4050435c, L:/192.168.86.8:59410 ! R:/8.133.246.113:8091]
2025-05-19 13:42:23.751 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - return to pool, rm channel:[id: 0x4050435c, L:/192.168.86.8:59410 ! R:/8.133.246.113:8091]
2025-05-19 13:42:23.751 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - channel valid false,channel:[id: 0x4050435c, L:/192.168.86.8:59410 ! R:/8.133.246.113:8091]
2025-05-19 13:42:23.751 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - will destroy channel:[id: 0x4050435c, L:/192.168.86.8:59410 ! R:/8.133.246.113:8091]
2025-05-19 13:42:23.751 [NettyClientSelector_RMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0x4050435c, L:/192.168.86.8:59410 ! R:/8.133.246.113:8091]) will closed
2025-05-19 13:42:23.751 [NettyClientSelector_RMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0x4050435c, L:/192.168.86.8:59410 ! R:/8.133.246.113:8091]) will closed
2025-05-19 13:42:23.753 [SpringContextShutdownHook] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - De-registering from Nacos Server now...
2025-05-19 13:42:23.753 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - [DEREGISTER-SERVICE] d750d92e-152f-4055-a641-3bc9dda85a29 deregistering service bgtech-ai with instance: Instance{instanceId='null', ip='192.168.86.8', port=8080, weight=1.0, healthy=true, enabled=true, ephemeral=true, clusterName='DEFAULT', serviceName='null', metadata={}}
2025-05-19 13:42:23.759 [SpringContextShutdownHook] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - De-registration finished.
2025-05-19 13:42:23.760 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.cache.ServiceInfoHolder do shutdown begin
2025-05-19 13:42:23.760 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.backups.FailoverReactor do shutdown begin
2025-05-19 13:42:23.761 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.backups.FailoverReactor do shutdown stop
2025-05-19 13:42:23.761 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.cache.ServiceInfoHolder do shutdown stop
2025-05-19 13:42:23.761 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.NamingClientProxyDelegate do shutdown begin
2025-05-19 13:42:23.761 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServiceInfoUpdateService do shutdown begin
2025-05-19 13:42:23.761 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServiceInfoUpdateService do shutdown stop
2025-05-19 13:42:23.761 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServerListManager do shutdown begin
2025-05-19 13:42:23.761 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Start destroying NacosRestTemplate
2025-05-19 13:42:23.761 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Destruction of the end
2025-05-19 13:42:23.761 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServerListManager do shutdown stop
2025-05-19 13:42:23.761 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.http.NamingHttpClientProxy do shutdown begin
2025-05-19 13:42:23.761 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Start destroying NacosRestTemplate
2025-05-19 13:42:23.761 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Destruction of the end
2025-05-19 13:42:23.761 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.http.NamingHttpClientProxy do shutdown stop
2025-05-19 13:42:23.761 [SpringContextShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Shutdown rpc client, set status to shutdown
2025-05-19 13:42:23.761 [SpringContextShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Shutdown client event executor java.util.concurrent.ScheduledThreadPoolExecutor@682c81b3[Running, pool size = 2, active threads = 2, queued tasks = 0, completed tasks = 0]
2025-05-19 13:42:23.761 [SpringContextShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Close current connection 1747632849737_139.227.195.203_43256
2025-05-19 13:42:23.764 [nacos-grpc-client-executor-8.133.246.113-110] WARN  c.a.nacos.common.remote.client.grpc.GrpcClient - [1747632849737_139.227.195.203_43256]Ignore error event,isRunning:false,isAbandon=false
2025-05-19 13:42:23.766 [SpringContextShutdownHook] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - Shutdown grpc executor java.util.concurrent.ThreadPoolExecutor@182a8bf8[Running, pool size = 4, active threads = 0, queued tasks = 0, completed tasks = 111]
2025-05-19 13:42:23.766 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - Shutdown grpc redo service executor java.util.concurrent.ScheduledThreadPoolExecutor@5a19393[Running, pool size = 1, active threads = 0, queued tasks = 1, completed tasks = 164]
2025-05-19 13:42:23.766 [SpringContextShutdownHook] INFO  c.a.n.client.auth.ram.identify.CredentialWatcher - [null] CredentialWatcher is stopped
2025-05-19 13:42:23.766 [SpringContextShutdownHook] INFO  c.a.n.client.auth.ram.identify.CredentialService - [null] CredentialService is freed
2025-05-19 13:42:23.766 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.NamingClientProxyDelegate do shutdown stop
2025-05-19 13:42:24.348 [com.alibaba.nacos.client.Worker] INFO  c.a.n.client.auth.ram.identify.CredentialWatcher - null No credential found
2025-05-19 13:42:25.804 [SpringContextShutdownHook] DEBUG com.bgpay.bgai.config.AsyncConfig$1 - Shutting down ExecutorService 'blockingExecutor'
2025-05-19 13:42:25.838 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:10909] result: true
2025-05-19 13:42:25.838 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:10911] result: true
2025-05-19 13:42:25.838 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:9876] result: true
2025-05-19 13:42:25.853 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:10911] result: true
2025-05-19 13:42:25.853 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:9876] result: true
2025-05-19 13:42:25.962 [SpringContextShutdownHook] INFO  o.s.orm.jpa.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-05-19 13:42:25.963 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-2} closing ...
2025-05-19 13:42:25.965 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-2} closed
2025-05-19 13:42:25.965 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} closing ...
2025-05-19 13:42:25.966 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} closed
2025-05-19 13:42:32.648 [main] WARN  com.alibaba.nacos.client.logging.NacosLogging - Load Logback Configuration of Nacos fail, message: Could not initialize Logback Nacos logging from classpath:nacos-logback.xml
2025-05-19 13:42:32.649 [main] INFO  com.bgpay.bgai.BgaiApplication - The following 1 profile is active: "dev"
2025-05-19 13:42:33.968 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-05-19 13:42:33.970 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-05-19 13:42:33.993 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 17 ms. Found 0 JPA repository interfaces.
2025-05-19 13:42:34.004 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-05-19 13:42:34.005 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-05-19 13:42:34.016 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 4 ms. Found 0 Redis repository interfaces.
2025-05-19 13:42:34.594 [main] INFO  io.seata.config.ConfigurationFactory - load Configuration from :Spring Configuration
2025-05-19 13:42:34.603 [main] INFO  io.seata.config.ConfigurationFactory - load Configuration from :Spring Configuration
2025-05-19 13:42:34.609 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Initializing Global Transaction Clients ... 
2025-05-19 13:42:34.710 [main] INFO  io.seata.core.rpc.netty.NettyClientBootstrap - NettyClientBootstrap has started
2025-05-19 13:42:34.711 [main] INFO  io.seata.discovery.registry.RegistryFactory - use registry center type: file
2025-05-19 13:42:34.722 [main] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - will connect to 8.133.246.113:8091
2025-05-19 13:42:34.726 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - NettyPool create channel to transactionRole:TMROLE,address:8.133.246.113:8091,msg:< RegisterTMRequest{version='1.7.0', applicationId='bgtech-ai', transactionServiceGroup='bgai-tx-group', extraData='ak=null
digest=bgai-tx-group,192.168.86.8,1747633354724
timestamp=1747633354724
authVersion=V4
vgroup=bgai-tx-group
ip=192.168.86.8
'} >
2025-05-19 13:42:34.879 [main] INFO  io.seata.core.rpc.netty.TmNettyRemotingClient - register TM success. client version:1.7.0, server version:1.8.1-SNAPSHOT,channel:[id: 0xaccabbe3, L:/192.168.86.8:57594 - R:/8.133.246.113:8091]
2025-05-19 13:42:34.889 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - register success, cost 78 ms, version:1.8.1-SNAPSHOT,role:TMROLE,channel:[id: 0xaccabbe3, L:/192.168.86.8:57594 - R:/8.133.246.113:8091]
2025-05-19 13:42:34.890 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Transaction Manager Client is initialized. applicationId[bgtech-ai] txServiceGroup[bgai-tx-group]
2025-05-19 13:42:34.906 [main] INFO  io.seata.rm.datasource.AsyncWorker - Async Commit Buffer Limit: 10000
2025-05-19 13:42:34.907 [main] INFO  io.seata.rm.datasource.xa.ResourceManagerXA - ResourceManagerXA init ...
2025-05-19 13:42:34.914 [main] INFO  io.seata.core.rpc.netty.NettyClientBootstrap - NettyClientBootstrap has started
2025-05-19 13:42:34.914 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Resource Manager is initialized. applicationId[bgtech-ai] txServiceGroup[bgai-tx-group]
2025-05-19 13:42:34.914 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Global Transaction Clients are initialized. 
2025-05-19 13:42:36.043 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat initialized with port(s): 8080 (http)
2025-05-19 13:42:36.055 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - The ["http-nio-8080"] connector has been configured to support HTTP upgrade to [h2c]
2025-05-19 13:42:36.055 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - Initializing ProtocolHandler ["http-nio-8080"]
2025-05-19 13:42:36.057 [main] INFO  org.apache.catalina.core.StandardService - Starting service [Tomcat]
2025-05-19 13:42:36.057 [main] INFO  org.apache.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.15]
2025-05-19 13:42:36.451 [main] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} inited
2025-05-19 13:42:36.708 [main] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - will connect to 8.133.246.113:8091
2025-05-19 13:42:36.708 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - RM will register :jdbc:mysql://8.133.246.113:3306/deepseek
2025-05-19 13:42:36.708 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - NettyPool create channel to transactionRole:RMROLE,address:8.133.246.113:8091,msg:< RegisterRMRequest{resourceIds='jdbc:mysql://8.133.246.113:3306/deepseek', version='1.7.0', applicationId='bgtech-ai', transactionServiceGroup='bgai-tx-group', extraData='null'} >
2025-05-19 13:42:36.741 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - register RM success. client version:1.7.0, server version:1.8.1-SNAPSHOT,channel:[id: 0x0e68029e, L:/192.168.86.8:57615 - R:/8.133.246.113:8091]
2025-05-19 13:42:36.741 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - register success, cost 11 ms, version:1.8.1-SNAPSHOT,role:RMROLE,channel:[id: 0x0e68029e, L:/192.168.86.8:57615 - R:/8.133.246.113:8091]
2025-05-19 13:42:36.743 [main] INFO  i.s.s.a.datasource.SeataAutoDataSourceProxyCreator - Auto proxy data source 'masterDataSource' by 'AT' mode.
2025-05-19 13:42:36.814 [main] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-2} inited
2025-05-19 13:42:36.882 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - will register resourceId:jdbc:mysql://8.133.246.113:3306/deepseek
2025-05-19 13:42:36.884 [main] INFO  i.s.s.a.datasource.SeataAutoDataSourceProxyCreator - Auto proxy data source 'slaveDataSource' by 'AT' mode.
2025-05-19 13:42:36.896 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.rm.AbstractRMHandler - the rm client received response msg [RegisterRMResponse{version='1.8.1-SNAPSHOT', extraData='null', identified=true, resultCode=null, msg='null'}] from tc server.
2025-05-19 13:42:36.908 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - will register resourceId:jdbc:mysql://8.133.246.113:3306/deepseek
2025-05-19 13:42:36.909 [main] INFO  i.s.s.a.datasource.SeataAutoDataSourceProxyCreator - Auto proxy data source 'dynamicDataSource' by 'AT' mode.
2025-05-19 13:42:36.920 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.rm.AbstractRMHandler - the rm client received response msg [RegisterRMResponse{version='1.8.1-SNAPSHOT', extraData='null', identified=true, resultCode=null, msg='null'}] from tc server.
2025-05-19 13:42:37.040 [main] INFO  org.hibernate.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-05-19 13:42:37.089 [main] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.1.7.Final
2025-05-19 13:42:37.402 [main] INFO  SQL dialect - HHH000400: Using dialect: org.hibernate.dialect.MySQL8Dialect
2025-05-19 13:42:37.404 [main] WARN  org.hibernate.orm.deprecation - HHH90000026: MySQL8Dialect has been deprecated; use org.hibernate.dialect.MySQLDialect instead
2025-05-19 13:42:37.678 [main] INFO  o.h.e.t.jta.platform.internal.JtaPlatformInitiator - HHH000490: Using JtaPlatform implementation: [org.hibernate.engine.transaction.jta.platform.internal.NoJtaPlatform]
2025-05-19 13:42:37.689 [main] INFO  o.s.orm.jpa.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-05-19 13:42:38.088 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-19 13:42:38.099 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-19 13:42:38.124 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-19 13:42:38.126 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-19 13:42:38.126 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-19 13:42:38.136 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-19 13:42:38.739 [main] INFO  com.bgpay.bgai.service.impl.UserServiceImpl - 初始化SSO配置: clientId=bgai-client-id, redirectUri=http://localhost:8080/api/auth/callback
2025-05-19 13:42:38.865 [main] INFO  com.bgpay.bgai.controller.AuthController - 初始化认证控制器: clientId=bgai-client-id, redirectUri=http://localhost:8080/api/auth/callback
2025-05-19 13:42:39.467 [main] INFO  o.a.r.s.autoconfigure.RocketMQAutoConfiguration - a producer (billing-producer-group) init on namesrv 8.133.246.113:9876
2025-05-19 13:42:39.728 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Bean [com.bgpay.bgai.service.deepseek.DeepSeekServiceImp$$SpringCGLIB$$0] with name [deepSeekServiceImp] would use interceptor [io.seata.spring.annotation.GlobalTransactionalInterceptor]
2025-05-19 13:42:39.987 [main] WARN  i.s.s.b.a.provider.SpringBootConfigurationProvider - The get method not found for the field 'SeataProperties#accesskey'.
2025-05-19 13:42:39.987 [main] WARN  i.s.s.b.a.provider.SpringBootConfigurationProvider - The get method not found for the field 'SeataProperties#secretkey'.
2025-05-19 13:42:40.006 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 加载到1个Saga状态机定义文件
2025-05-19 13:42:40.140 [main] INFO  com.bgpay.bgai.saga.CustomSagaJsonParser - 开始解析状态机定义: bgai-saga-transaction
2025-05-19 13:42:40.140 [main] INFO  com.bgpay.bgai.saga.CustomSagaJsonParser - 状态机定义解析成功: bgai-saga-transaction
2025-05-19 13:42:40.140 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 成功加载状态机定义: /E:/project/bgai/target/classes/statelang/bgai-saga-transaction.json
2025-05-19 13:42:40.642 [main] INFO  org.redisson.Version - Redisson 3.24.3
2025-05-19 13:42:40.770 [redisson-netty-4-6] INFO  o.r.connection.pool.MasterPubSubConnectionPool - 1 connections initialized for 8.133.246.113/8.133.246.113:6379
2025-05-19 13:42:41.107 [redisson-netty-4-19] INFO  org.redisson.connection.pool.MasterConnectionPool - 24 connections initialized for 8.133.246.113/8.133.246.113:6379
2025-05-19 13:42:41.358 [main] INFO  com.bgpay.bgai.service.mq.MQConsumerService - MQ consumer startup successful [group=billing-consumer-group, topic=BILLING_TOPIC, tag=USER_BILLING]
2025-05-19 13:42:41.596 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Bean [com.bgpay.bgai.service.impl.SeataTransactionService$$SpringCGLIB$$0] with name [seataTransactionService] would use interceptor [io.seata.spring.annotation.GlobalTransactionalInterceptor]
2025-05-19 13:42:41.721 [main] DEBUG com.bgpay.bgai.config.AsyncConfig$1 - Initializing ExecutorService 'blockingExecutor'
2025-05-19 13:42:43.057 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [After]
2025-05-19 13:42:43.058 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Before]
2025-05-19 13:42:43.058 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Between]
2025-05-19 13:42:43.058 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Cookie]
2025-05-19 13:42:43.058 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Header]
2025-05-19 13:42:43.058 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Host]
2025-05-19 13:42:43.058 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Method]
2025-05-19 13:42:43.058 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Path]
2025-05-19 13:42:43.058 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Query]
2025-05-19 13:42:43.058 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [ReadBody]
2025-05-19 13:42:43.058 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [RemoteAddr]
2025-05-19 13:42:43.058 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [XForwardedRemoteAddr]
2025-05-19 13:42:43.058 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Weight]
2025-05-19 13:42:43.058 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [CloudFoundryRouteService]
2025-05-19 13:42:44.388 [main] INFO  o.s.b.actuate.endpoint.web.EndpointLinksResolver - Exposing 1 endpoint(s) beneath base path '/actuator'
2025-05-19 13:42:44.732 [main] WARN  i.s.s.b.a.provider.SpringBootConfigurationProvider - The get method not found for the field 'SeataProperties#accesskey'.
2025-05-19 13:42:44.733 [main] WARN  i.s.s.b.a.provider.SpringBootConfigurationProvider - The get method not found for the field 'SeataProperties#secretkey'.
2025-05-19 13:42:44.747 [main] INFO  io.seata.saga.tm.DefaultSagaTransactionalTemplate - Initializing Global Transaction Clients ... 
2025-05-19 13:42:44.747 [main] INFO  io.seata.saga.tm.DefaultSagaTransactionalTemplate - Transaction Manager Client is initialized. applicationId[bgtech-ai] txServiceGroup[bgai-tx-group]
2025-05-19 13:42:44.747 [main] INFO  io.seata.saga.tm.DefaultSagaTransactionalTemplate - Resource Manager is initialized. applicationId[bgtech-ai] txServiceGroup[bgai-tx-group]
2025-05-19 13:42:44.747 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - will register resourceId:bgtech-ai#bgai-tx-group
2025-05-19 13:42:44.748 [main] INFO  io.seata.saga.tm.DefaultSagaTransactionalTemplate - Global Transaction Clients are initialized. 
2025-05-19 13:42:44.758 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.rm.AbstractRMHandler - the rm client received response msg [RegisterRMResponse{version='1.8.1-SNAPSHOT', extraData='null', identified=true, resultCode=null, msg='null'}] from tc server.
2025-05-19 13:42:46.025 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - Starting ProtocolHandler ["http-nio-8080"]
2025-05-19 13:42:46.039 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat started on port(s): 8080 (http) with context path ''
2025-05-19 13:42:46.050 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from ans.namespace attribute : null
2025-05-19 13:42:46.050 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from ALIBABA_ALIWARE_NAMESPACE attribute :null
2025-05-19 13:42:46.051 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from namespace attribute :null
2025-05-19 13:42:46.060 [main] INFO  c.a.n.p.auth.spi.client.ClientAuthPluginManager - [ClientAuthPluginManager] Load ClientAuthService com.alibaba.nacos.client.auth.impl.NacosClientAuthServiceImpl success.
2025-05-19 13:42:46.060 [main] INFO  c.a.n.p.auth.spi.client.ClientAuthPluginManager - [ClientAuthPluginManager] Load ClientAuthService com.alibaba.nacos.client.auth.ram.RamClientAuthServiceImpl success.
2025-05-19 13:42:46.066 [main] INFO  com.alibaba.nacos.common.remote.client - [RpcClientFactory] create a new rpc client of 1f28af58-1bc8-4cc1-915c-daf56e47d9be
2025-05-19 13:42:46.068 [main] INFO  com.alibaba.nacos.common.remote.client - [1f28af58-1bc8-4cc1-915c-daf56e47d9be] RpcClient init, ServerListFactory = com.alibaba.nacos.client.naming.core.ServerListManager
2025-05-19 13:42:46.068 [main] INFO  com.alibaba.nacos.common.remote.client - [1f28af58-1bc8-4cc1-915c-daf56e47d9be] Registry connection listener to current client:com.alibaba.nacos.client.naming.remote.gprc.redo.NamingGrpcRedoService
2025-05-19 13:42:46.068 [main] INFO  com.alibaba.nacos.common.remote.client - [1f28af58-1bc8-4cc1-915c-daf56e47d9be] Register server push request handler:com.alibaba.nacos.client.naming.remote.gprc.NamingPushRequestHandler
2025-05-19 13:42:46.068 [main] INFO  com.alibaba.nacos.common.remote.client - [1f28af58-1bc8-4cc1-915c-daf56e47d9be] Try to connect to server on start up, server: {serverIp = '8.133.246.113', server main port = 8848}
2025-05-19 13:42:46.069 [main] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - grpc client connection server:8.133.246.113 ip,serverPort:9848,grpcTslConfig:{"sslProvider":"OPENSSL","enableTls":false,"mutualAuthEnable":false,"trustAll":false}
2025-05-19 13:42:46.200 [main] INFO  com.alibaba.nacos.common.remote.client - [1f28af58-1bc8-4cc1-915c-daf56e47d9be] Success to connect to server [8.133.246.113:8848] on start up, connectionId = 1747633366087_139.227.195.203_42199
2025-05-19 13:42:46.200 [main] INFO  com.alibaba.nacos.common.remote.client - [1f28af58-1bc8-4cc1-915c-daf56e47d9be] Register server push request handler:com.alibaba.nacos.common.remote.client.RpcClient$ConnectResetRequestHandler
2025-05-19 13:42:46.200 [main] INFO  com.alibaba.nacos.common.remote.client - [1f28af58-1bc8-4cc1-915c-daf56e47d9be] Register server push request handler:com.alibaba.nacos.common.remote.client.RpcClient$$Lambda/0x000001ffa85255c8
2025-05-19 13:42:46.200 [com.alibaba.nacos.client.remote.worker] INFO  com.alibaba.nacos.common.remote.client - [1f28af58-1bc8-4cc1-915c-daf56e47d9be] Notify connected event to listeners.
2025-05-19 13:42:46.200 [com.alibaba.nacos.client.remote.worker] INFO  com.alibaba.nacos.client.naming - Grpc connection connect
2025-05-19 13:42:46.200 [main] INFO  com.alibaba.nacos.client.naming - [REGISTER-SERVICE] d750d92e-152f-4055-a641-3bc9dda85a29 registering service bgtech-ai with instance Instance{instanceId='null', ip='192.168.86.8', port=8080, weight=1.0, healthy=true, enabled=true, ephemeral=true, clusterName='DEFAULT', serviceName='null', metadata={IPv6=[2408:820c:7528:8342:b486:9b72:4b72:4bf0], preserved.register.source=SPRING_CLOUD}}
2025-05-19 13:42:46.219 [main] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - nacos registry, DEFAULT_GROUP bgtech-ai 192.168.86.8:8080 register finished
2025-05-19 13:42:46.279 [main] INFO  com.bgpay.bgai.BgaiApplication - Started BgaiApplication in 15.652 seconds (process running for 17.196)
2025-05-19 13:42:46.283 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-19 13:42:46.283 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-19 13:42:46.297 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-19 13:42:46.297 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-19 13:42:46.298 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-19 13:42:46.308 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-19 13:42:46.309 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-19 13:42:46.309 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-19 13:42:46.317 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-19 13:42:46.317 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-19 13:42:46.317 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-19 13:42:46.324 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-19 13:42:46.324 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - ==================== Saga状态机加载报告 ====================
2025-05-19 13:42:46.324 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - Saga状态机配置加载状态: 成功
2025-05-19 13:42:46.325 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 已加载的状态机定义文件数量: 1
2025-05-19 13:42:46.325 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 已加载的状态机定义文件:
2025-05-19 13:42:46.325 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig -  - /E:/project/bgai/target/classes/statelang/bgai-saga-transaction.json
2025-05-19 13:42:46.325 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - Saga解析器状态: CUSTOM_FASTJSON2
2025-05-19 13:42:46.325 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 状态机解析结果: 成功 1 个, 失败 0 个
2025-05-19 13:42:46.325 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - =============================================================
2025-05-19 13:42:46.330 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - nacos.cache.data.init.snapshot = true 
2025-05-19 13:42:46.331 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] common-dev.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-19 13:42:46.342 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=common-dev.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-19 13:42:46.342 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=common-dev.yaml, group=DEFAULT_GROUP
2025-05-19 13:42:46.343 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-19 13:42:46.343 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-19 13:42:46.343 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai.yaml, group=DEFAULT_GROUP
2025-05-19 13:42:46.344 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai-dev.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-19 13:42:46.344 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai-dev.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-19 13:42:46.344 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai-dev.yaml, group=DEFAULT_GROUP
2025-05-19 13:42:46.344 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-19 13:42:46.345 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai, group=DEFAULT_GROUP, cnt=1
2025-05-19 13:42:46.345 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai, group=DEFAULT_GROUP
2025-05-19 13:42:58.102 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - 接收到请求: /api/chatGatWay-internal, 文件=新文件 17.txt, 问题参数=null, 模型参数=null
2025-05-19 13:42:58.104 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - 请求Content-Type: multipart/form-data;boundary=--------------------------482915283580857674954948
2025-05-19 13:42:58.104 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - 收集到的完整参数: question="null", apiUrl="null", modelName="null", multiTurn=false
2025-05-19 13:42:58.106 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - Processing request for user ID: 689258T
2025-05-19 13:42:58.106 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - Processing file with circuit breaker: fileName=新文件 17.txt, question=
2025-05-19 13:42:58.108 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.config.ReactiveFileProcessor - Processing file: 新文件 17.txt, content-type: text/plain
2025-05-19 13:42:58.116 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - PARAM TRACE [689258T]: 尝试查找匹配配置 - 参数: apiUrl=null, modelName=null
2025-05-19 13:42:58.126 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 查询配置 - userId=689258T
2025-05-19 13:42:58.127 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 排序方式 - 按ID降序
2025-05-19 13:42:58.127 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 限制结果数 - LIMIT 1
2025-05-19 13:42:58.194 [http-nio-8080-exec-2] DEBUG com.bgpay.bgai.mapper.ApiConfigMapper.selectList - ==>  Preparing: SELECT id,api_url,api_key,model_name,user_id FROM api_config WHERE (user_id = ?) ORDER BY id DESC LIMIT 1
2025-05-19 13:42:58.196 [http-nio-8080-exec-2] DEBUG com.bgpay.bgai.mapper.ApiConfigMapper.selectList - ==> Parameters: 689258T(String)
2025-05-19 13:42:58.204 [http-nio-8080-exec-2] DEBUG com.bgpay.bgai.mapper.ApiConfigMapper.selectList - <==      Total: 1
2025-05-19 13:42:58.204 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 查询结果 - 找到配置: id=2, modelName=deepseek-chat
2025-05-19 13:42:58.204 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - PARAM TRACE [689258T]: 找到匹配配置 - apiUrl=https://api.deepseek.com/chat/completions, modelName=deepseek-chat (原始请求: null)
2025-05-19 13:42:58.204 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - API config resolved: url=https://api.deepseek.com/chat/completions, model=deepseek-chat
2025-05-19 13:42:58.221 [Thread-50] INFO  com.bgpay.bgai.config.ReactiveFileProcessor - File processed successfully: size=6680 bytes
2025-05-19 13:42:58.226 [Thread-50] INFO  com.bgpay.bgai.controller.ReactiveChatController - Content processed, length: 6603
2025-05-19 13:42:58.232 [Thread-50] INFO  io.seata.tm.TransactionManagerHolder - TransactionManager Singleton io.seata.tm.DefaultTransactionManager@2356503e
2025-05-19 13:42:58.246 [Thread-50] INFO  io.seata.tm.api.DefaultGlobalTransaction - Begin new global transaction [seata-server:8091:27673667088527366]
2025-05-19 13:42:58.264 [Thread-50] INFO  c.b.bgai.service.impl.TransactionLogServiceImpl - 记录分布式事务开始: XID=seata-server:8091:27673667088527366, 业务=com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive
2025-05-19 13:42:58.272 [Thread-50] DEBUG com.bgpay.bgai.mapper.TransactionLogMapper.insert - ==>  Preparing: INSERT INTO transaction_log ( xid, transaction_name, transaction_mode, status, request_path, source_ip, start_time, user_id, create_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-05-19 13:42:58.275 [Thread-50] DEBUG com.bgpay.bgai.mapper.TransactionLogMapper.insert - ==> Parameters: seata-server:8091:27673667088527366(String), com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive(String), AT(String), ACTIVE(String), (String), (String), 2025-05-19T13:42:58.265169100(LocalDateTime), (String), 2025-05-19T13:42:58.265169100(LocalDateTime)
2025-05-19 13:42:58.650 [Thread-50] DEBUG com.bgpay.bgai.mapper.TransactionLogMapper.insert - <==    Updates: 1
2025-05-19 13:42:58.667 [Thread-50] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:27673667088527366, branchId:27673667088527367, lockKeys:transaction_log:2
2025-05-19 13:42:58.676 [Thread-50] WARN  i.s.c.l.EnhancedServiceLoader$InnerEnhancedServiceLoader - Load [io.seata.rm.datasource.undo.parser.ProtostuffUndoLogParser] class fail: io/protostuff/runtime/IdStrategy
2025-05-19 13:42:58.758 [Thread-50] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:27673667088527366, branchId:27673667088527368, lockKeys:undo_log:5;transaction_log:2
2025-05-19 13:42:58.792 [Thread-50] INFO  c.b.bgai.interceptor.SeataTransactionInterceptor - 开始分布式事务: XID=seata-server:8091:27673667088527366, 方法=com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive
2025-05-19 13:42:58.803 [Thread-50] INFO  org.reflections.Reflections - Processing reactive request: content length=6603, apiUrl=https://api.deepseek.com/chat/completions, modelName=deepseek-chat, userId=689258T, multiTurn=false
2025-05-19 13:42:58.826 [Thread-50] INFO  com.bgpay.bgai.transaction.TransactionCoordinator - Transaction prepared for user 689258T: chatCompletionId=chat-acd973c0-9b9f-4b46-88fb-fbc8dea4e500
2025-05-19 13:42:58.829 [Thread-50] INFO  org.reflections.Reflections - Generated request JSON with 2PC transaction: {"stream":false,"max_tokens":2000,"temperature":1.0,"messages":[{"role":"system","content":"You are ...
2025-05-19 13:42:58.854 [Thread-50] INFO  c.b.bgai.service.impl.TransactionLogServiceImpl - 记录分布式事务结束: XID=seata-server:8091:27673667088527366, 状态=COMMITTED
2025-05-19 13:42:58.856 [Thread-50] DEBUG c.b.bgai.mapper.TransactionLogMapper.selectList - ==>  Preparing: SELECT id,xid,branch_id,transaction_name,transaction_mode,status,request_path,source_ip,start_time,end_time,user_id,extra_data,create_time,update_time FROM transaction_log WHERE (xid = ?) LIMIT 1
2025-05-19 13:42:58.858 [Thread-50] DEBUG c.b.bgai.mapper.TransactionLogMapper.selectList - ==> Parameters: seata-server:8091:27673667088527366(String)
2025-05-19 13:42:58.866 [Thread-50] DEBUG c.b.bgai.mapper.TransactionLogMapper.selectList - <==      Total: 1
2025-05-19 13:42:58.870 [Thread-50] DEBUG c.b.bgai.mapper.TransactionLogMapper.updateById - ==>  Preparing: UPDATE transaction_log SET xid=?, transaction_name=?, transaction_mode=?, status=?, request_path=?, source_ip=?, start_time=?, end_time=?, user_id=?, extra_data=?, create_time=?, update_time=? WHERE id=?
2025-05-19 13:42:58.877 [Thread-50] DEBUG c.b.bgai.mapper.TransactionLogMapper.updateById - ==> Parameters: seata-server:8091:27673667088527366(String), com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive(String), AT(String), COMMITTED(String), (String), (String), 2025-05-19T13:42:58(LocalDateTime), 2025-05-19T13:42:58.867757900(LocalDateTime), (String), {"duration":56,"result":"success"}(String), 2025-05-19T13:42:58(LocalDateTime), 2025-05-19T13:42:58.867757900(LocalDateTime), 2(Long)
2025-05-19 13:42:58.924 [Thread-50] DEBUG c.b.bgai.mapper.TransactionLogMapper.updateById - <==    Updates: 1
2025-05-19 13:42:58.934 [Thread-50] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:27673667088527366, branchId:27673667088527369, lockKeys:transaction_log:2
2025-05-19 13:42:58.963 [Thread-50] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:27673667088527366, branchId:27673667088527370, lockKeys:undo_log:7;transaction_log:2
2025-05-19 13:42:59.014 [Thread-50] INFO  c.b.bgai.interceptor.SeataTransactionInterceptor - 分布式事务成功完成: XID=seata-server:8091:27673667088527366, 耗时=56ms
2025-05-19 13:42:59.014 [Thread-50] INFO  io.seata.tm.api.DefaultGlobalTransaction - transaction seata-server:8091:27673667088527366 will be commit
2025-05-19 13:42:59.030 [Thread-50] INFO  io.seata.tm.api.DefaultGlobalTransaction - transaction end, xid = seata-server:8091:27673667088527366
2025-05-19 13:42:59.030 [Thread-50] INFO  io.seata.tm.api.DefaultGlobalTransaction - [seata-server:8091:27673667088527366] commit status: Committed
2025-05-19 13:42:59.629 [rpcDispatch_RMROLE_1_1_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:27673667088527366', branchId=27673667088527367, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false,"skipCheckLock":true}'}
2025-05-19 13:42:59.632 [rpcDispatch_RMROLE_1_1_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:27673667088527366 27673667088527367 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false,"skipCheckLock":true}
2025-05-19 13:42:59.634 [rpcDispatch_RMROLE_1_1_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-19 13:42:59.644 [rpcDispatch_RMROLE_1_2_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:27673667088527366', branchId=27673667088527368, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false,"skipCheckLock":true}'}
2025-05-19 13:42:59.644 [rpcDispatch_RMROLE_1_2_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:27673667088527366 27673667088527368 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false,"skipCheckLock":true}
2025-05-19 13:42:59.644 [rpcDispatch_RMROLE_1_2_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-19 13:42:59.653 [rpcDispatch_RMROLE_1_3_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:27673667088527366', branchId=27673667088527369, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false}'}
2025-05-19 13:42:59.654 [rpcDispatch_RMROLE_1_3_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:27673667088527366 27673667088527369 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false}
2025-05-19 13:42:59.654 [rpcDispatch_RMROLE_1_3_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-19 13:42:59.666 [rpcDispatch_RMROLE_1_4_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:27673667088527366', branchId=27673667088527370, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false}'}
2025-05-19 13:42:59.667 [rpcDispatch_RMROLE_1_4_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:27673667088527366 27673667088527370 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false}
2025-05-19 13:42:59.667 [rpcDispatch_RMROLE_1_4_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-19 13:43:43.487 [reactor-http-nio-3] INFO  org.reflections.Reflections - Raw response received, length: 2402
2025-05-19 13:43:43.492 [reactor-http-nio-3] WARN  org.reflections.Reflections - Received different chatCompletionId from response: 1d26d365-8c0d-49a0-81f5-d8f437d37011 vs prepared: chat-acd973c0-9b9f-4b46-88fb-fbc8dea4e500
2025-05-19 13:43:43.506 [reactor-http-nio-3] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - ==>  Preparing: INSERT INTO chat_completions ( object, created, model, system_fingerprint, api_key ) VALUES ( ?, ?, ?, ?, ? )
2025-05-19 13:43:43.507 [reactor-http-nio-3] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - ==> Parameters: chat.completion(String), 1747633423505(Long), deepseek-chat(String), 689258T(String), chat-acd973c0-9b9f-4b46-88fb-fbc8dea4e500(String)
2025-05-19 13:43:43.519 [reactor-http-nio-3] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - <==    Updates: 1
2025-05-19 13:43:43.519 [reactor-http-nio-3] INFO  com.bgpay.bgai.transaction.TransactionCoordinator - Transaction committed for user 689258T: chatCompletionId=chat-acd973c0-9b9f-4b46-88fb-fbc8dea4e500
2025-05-19 13:43:43.539 [FileWrite-1] INFO  com.bgpay.bgai.service.deepseek.FileWriterService - Successfully wrote content to: \var\data\ai_responses\37d2cb5c-0b98-48e1-8e93-af37fac770bd.txt
2025-05-19 13:43:43.549 [boundedElastic-1] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - ==>  Preparing: INSERT INTO chat_completions ( object, created, model, system_fingerprint, api_key ) VALUES ( ?, ?, ?, ?, ? )
2025-05-19 13:43:43.550 [boundedElastic-1] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - ==> Parameters: chat.completion(String), 1747633379(Long), deepseek-chat(String), fp_8802369eaa_prod0425fp8(String), chat-acd973c0-9b9f-4b46-88fb-fbc8dea4e500(String)
2025-05-19 13:43:43.560 [boundedElastic-1] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - <==    Updates: 1
2025-05-19 13:43:43.583 [boundedElastic-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.insert - ==>  Preparing: INSERT INTO usage_info ( chat_completion_id, prompt_tokens, completion_tokens, total_tokens, prompt_tokens_cached, completion_reasoning_tokens, prompt_cache_hit_tokens, prompt_cache_miss_tokens, created_at, model_type ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-05-19 13:43:43.584 [boundedElastic-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.insert - ==> Parameters: chat-acd973c0-9b9f-4b46-88fb-fbc8dea4e500(String), 2209(Integer), 871(Integer), 3080(Integer), 0(Integer), 0(Integer), 0(Integer), 2209(Integer), 2025-05-19T13:43:43.576437800(LocalDateTime), deepseek-chat(String)
2025-05-19 13:43:43.597 [boundedElastic-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.insert - <==    Updates: 1
2025-05-19 13:43:43.618 [boundedElastic-1] INFO  org.reflections.Reflections - Completion data saved synchronously for chatCompletionId: chat-acd973c0-9b9f-4b46-88fb-fbc8dea4e500
2025-05-19 13:43:43.622 [boundedElastic-2] INFO  org.reflections.Reflections - 开始发送账单消息，chatCompletionId: chat-acd973c0-9b9f-4b46-88fb-fbc8dea4e500, userId: 689258T
2025-05-19 13:43:43.665 [boundedElastic-2] INFO  org.reflections.Reflections - 账单消息发送成功，chatCompletionId: chat-acd973c0-9b9f-4b46-88fb-fbc8dea4e500, userId: 689258T
2025-05-19 13:43:43.667 [boundedElastic-1] INFO  org.reflections.Reflections - Complete processing chain completed: 这个配置文件看起来是一个Spring Boot应用的YAML配置文件，包含了许多重要的配置信息。以下是一些关键点的分析：

### 1. **基本配置**
- **应用名称**: `bgai`
- **激活的Profile**: `dev`
- **允许Bean定义覆盖**: `true`
- **会话存储**: 禁用 (`store-type: none`)

### 2. **数据库配置**
- **Redis**:
  - 主机: `8.133.246.113`
  - 端口: `6379`
  - 密码: `5z25u2sk`
  - 数据库: `0`
  
- **MySQL (动态数据源)**:
  - 主从配置 (`master` 和 `slave`)，使用相同的连接信息:
    - URL: `jdbc:mysql://8.133.246.113:3306/deepseek`
    - 用户名: `bgtech`
    - 密码: `Zly689258..`
    - 连接池使用Druid，配置了初始连接数、最小空闲连接、最大连接数等。

### 3. **JPA/Hibernate配置**
- 数据库平台: `MySQL8Dialect`
- DDL策略: `update`
- 显示SQL: `true`
- 关闭Open-in-View: `false`

### 4. **文件上传配置**
- 最大文件大小: `200MB`
- 最大请求大小: `200MB`

### 5. **任务执行配置**
- 线程池:
  - 核心大小: `50`
  - 最大大小: `200`
  - 队列容量: `1000`
  - 线程名前缀: `async-task-`

### 6. **RocketMQ配置**
- Name Server: `8.133.246.113:9876`
- 生产者和消费者组配置，以及超时和重试设置。

### 7. **Resilience4j配置**
- 熔断器 (`circuitbreaker`)、限时器 (`timelimiter`) 和重试 (`retry`) 的详细配置，用于处理服务调用的容错。

### 8. **其他配置**
- **Tesseract OCR**: 数据路径 `/usr/share/tesseract-ocr`
- **MyBatis-Plus**: 开启下划线转驼峰，日志实现为StdOutImpl。
- **Flink Job Manager**: 主机 `8.133.246.113`，端口 `8081`
- **文件输出路径**: `/var/data/ai_responses`
- **日志配置**: JSON格式，路径 `/var/data/ai_responses/application.log`

### 9. **安全配置**
- **SSO OAuth2**:
  - Client ID: `bgai-client-id`
  - Client Secret: `bgai-client-secret`
  - 各种URL配置（授权、令牌、用户信息、登出）
- **API密钥**:
  - 两个客户端密钥配置。

### 潜在的安全风险
1. **敏感信息暴露**:
   - Redis密码 (`5z25u2sk`) 和MySQL密码 (`Zly689258..`) 直接写在配置文件中，建议使用环境变量或配置中心加密存储。
   - RocketMQ、MySQL、Redis等服务的IP地址和端口暴露，如果是生产环境，建议使用内网地址或VPN。

2. **数据库连接**:
   - 主从配置使用了相同的连接信息，可能是笔误或配置错误，通常主从数据库应该有不同的连接信息。

3. **SSL配置**:
   - MySQL连接URL中 `useSSL=false`，建议在生产环境中启用SSL加密连接。

### 建议
1. **使用配置加密**:
   - 使用Spring Cloud Config或Vault等工具加密敏感信息。
   
2. **环境隔离**:
   - 将开发、测试、生产环境的配置分开，避免敏感信息泄露。

3. **日志安全**:
   - 确保日志文件不会记录敏感信息（如密码、密钥等）。

如果需要进一步优化或调整某些配置，可以提供更具体的需求或问题。
2025-05-19 13:43:43.667 [boundedElastic-1] INFO  com.bgpay.bgai.controller.ReactiveChatController - Processed response for user 689258T, content length: 1868
2025-05-19 13:44:16.567 [pool-7-thread-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.selectCount - ==>  Preparing: SELECT COUNT( * ) AS total FROM usage_info WHERE (chat_completion_id = ?)
2025-05-19 13:44:16.567 [pool-7-thread-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.selectCount - ==> Parameters: chat-acd973c0-9b9f-4b46-88fb-fbc8dea4e500(String)
2025-05-19 13:44:16.572 [pool-7-thread-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.selectCount - <==      Total: 1
2025-05-19 13:44:16.744 [ConsumeMessageThread_billing-consumer-group_1] INFO  c.bgpay.bgai.service.mq.RocketMQBillingServiceImpl - Output price config priceVersion: 1
2025-05-19 13:44:16.756 [ConsumeMessageThread_billing-consumer-group_1] DEBUG com.bgpay.bgai.mapper.UsageRecordMapper.insert - ==>  Preparing: INSERT INTO usage_record ( model_type, chat_completion_id, user_id, input_cost, output_cost, price_version, calculated_at ) VALUES ( ?, ?, ?, ?, ?, ?, ? )
2025-05-19 13:44:16.757 [ConsumeMessageThread_billing-consumer-group_1] DEBUG com.bgpay.bgai.mapper.UsageRecordMapper.insert - ==> Parameters: deepseek-chat(String), chat-acd973c0-9b9f-4b46-88fb-fbc8dea4e500(String), 689258T(String), 0.0044(BigDecimal), 0.0070(BigDecimal), 1(Integer), 2025-05-19T13:44:16.744294300(LocalDateTime)
2025-05-19 13:44:16.783 [ConsumeMessageThread_billing-consumer-group_1] DEBUG com.bgpay.bgai.mapper.UsageRecordMapper.insert - <==    Updates: 1
2025-05-19 13:44:16.796 [ConsumeMessageThread_billing-consumer-group_1] INFO  c.bgpay.bgai.service.mq.RocketMQBillingServiceImpl - Message consumed: 2408820C75288342B4869B724B724BF0740436BAF30C5FA49D210000
2025-05-19 13:44:53.790 [Thread-7] WARN  com.alibaba.nacos.common.notify.NotifyCenter - [NotifyCenter] Start destroying Publisher
2025-05-19 13:44:53.790 [Thread-1] WARN  c.alibaba.nacos.common.http.HttpClientBeanHolder - [HttpClientBeanHolder] Start destroying common HttpClient
2025-05-19 13:44:53.790 [Thread-7] WARN  com.alibaba.nacos.common.notify.NotifyCenter - [NotifyCenter] Destruction of the end
2025-05-19 13:44:53.790 [Thread-1] WARN  c.alibaba.nacos.common.http.HttpClientBeanHolder - [HttpClientBeanHolder] Destruction of the end
2025-05-19 13:44:53.806 [NettyClientSelector_TMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - channel inactive: [id: 0xaccabbe3, L:/192.168.86.8:57594 ! R:/8.133.246.113:8091]
2025-05-19 13:44:53.806 [NettyClientSelector_TMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - return to pool, rm channel:[id: 0xaccabbe3, L:/192.168.86.8:57594 ! R:/8.133.246.113:8091]
2025-05-19 13:44:53.807 [NettyClientSelector_TMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - channel valid false,channel:[id: 0xaccabbe3, L:/192.168.86.8:57594 ! R:/8.133.246.113:8091]
2025-05-19 13:44:53.807 [NettyClientSelector_TMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - will destroy channel:[id: 0xaccabbe3, L:/192.168.86.8:57594 ! R:/8.133.246.113:8091]
2025-05-19 13:44:53.807 [NettyClientSelector_TMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0xaccabbe3, L:/192.168.86.8:57594 ! R:/8.133.246.113:8091]) will closed
2025-05-19 13:44:53.807 [NettyClientSelector_TMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0xaccabbe3, L:/192.168.86.8:57594 ! R:/8.133.246.113:8091]) will closed
2025-05-19 13:44:53.807 [NettyClientSelector_RMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - channel inactive: [id: 0x0e68029e, L:/192.168.86.8:57615 ! R:/8.133.246.113:8091]
2025-05-19 13:44:53.807 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - return to pool, rm channel:[id: 0x0e68029e, L:/192.168.86.8:57615 ! R:/8.133.246.113:8091]
2025-05-19 13:44:53.808 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - channel valid false,channel:[id: 0x0e68029e, L:/192.168.86.8:57615 ! R:/8.133.246.113:8091]
2025-05-19 13:44:53.808 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - will destroy channel:[id: 0x0e68029e, L:/192.168.86.8:57615 ! R:/8.133.246.113:8091]
2025-05-19 13:44:53.808 [NettyClientSelector_RMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0x0e68029e, L:/192.168.86.8:57615 ! R:/8.133.246.113:8091]) will closed
2025-05-19 13:44:53.808 [NettyClientSelector_RMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0x0e68029e, L:/192.168.86.8:57615 ! R:/8.133.246.113:8091]) will closed
2025-05-19 13:44:53.809 [SpringContextShutdownHook] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - De-registering from Nacos Server now...
2025-05-19 13:44:53.810 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - [DEREGISTER-SERVICE] d750d92e-152f-4055-a641-3bc9dda85a29 deregistering service bgtech-ai with instance: Instance{instanceId='null', ip='192.168.86.8', port=8080, weight=1.0, healthy=true, enabled=true, ephemeral=true, clusterName='DEFAULT', serviceName='null', metadata={}}
2025-05-19 13:44:53.819 [SpringContextShutdownHook] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - De-registration finished.
2025-05-19 13:44:53.820 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.cache.ServiceInfoHolder do shutdown begin
2025-05-19 13:44:53.820 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.backups.FailoverReactor do shutdown begin
2025-05-19 13:44:53.820 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.backups.FailoverReactor do shutdown stop
2025-05-19 13:44:53.820 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.cache.ServiceInfoHolder do shutdown stop
2025-05-19 13:44:53.820 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.NamingClientProxyDelegate do shutdown begin
2025-05-19 13:44:53.820 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServiceInfoUpdateService do shutdown begin
2025-05-19 13:44:53.821 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServiceInfoUpdateService do shutdown stop
2025-05-19 13:44:53.821 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServerListManager do shutdown begin
2025-05-19 13:44:53.821 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Start destroying NacosRestTemplate
2025-05-19 13:44:53.821 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Destruction of the end
2025-05-19 13:44:53.821 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServerListManager do shutdown stop
2025-05-19 13:44:53.821 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.http.NamingHttpClientProxy do shutdown begin
2025-05-19 13:44:53.821 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Start destroying NacosRestTemplate
2025-05-19 13:44:53.821 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Destruction of the end
2025-05-19 13:44:53.821 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.http.NamingHttpClientProxy do shutdown stop
2025-05-19 13:44:53.821 [SpringContextShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Shutdown rpc client, set status to shutdown
2025-05-19 13:44:53.821 [SpringContextShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Shutdown client event executor java.util.concurrent.ScheduledThreadPoolExecutor@3a4a86a9[Running, pool size = 2, active threads = 2, queued tasks = 0, completed tasks = 0]
2025-05-19 13:44:53.821 [SpringContextShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Close current connection 1747633366087_139.227.195.203_42199
2025-05-19 13:44:53.824 [nacos-grpc-client-executor-8.133.246.113-37] WARN  c.a.nacos.common.remote.client.grpc.GrpcClient - [1747633366087_139.227.195.203_42199]Ignore error event,isRunning:false,isAbandon=false
2025-05-19 13:44:53.826 [SpringContextShutdownHook] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - Shutdown grpc executor java.util.concurrent.ThreadPoolExecutor@68af530a[Running, pool size = 5, active threads = 0, queued tasks = 0, completed tasks = 38]
2025-05-19 13:44:53.826 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - Shutdown grpc redo service executor java.util.concurrent.ScheduledThreadPoolExecutor@41c9d35f[Running, pool size = 1, active threads = 0, queued tasks = 1, completed tasks = 42]
2025-05-19 13:44:53.826 [SpringContextShutdownHook] INFO  c.a.n.client.auth.ram.identify.CredentialWatcher - [null] CredentialWatcher is stopped
2025-05-19 13:44:53.826 [SpringContextShutdownHook] INFO  c.a.n.client.auth.ram.identify.CredentialService - [null] CredentialService is freed
2025-05-19 13:44:53.826 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.NamingClientProxyDelegate do shutdown stop
2025-05-19 13:44:55.856 [SpringContextShutdownHook] DEBUG com.bgpay.bgai.config.AsyncConfig$1 - Shutting down ExecutorService 'blockingExecutor'
2025-05-19 13:44:55.890 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:10909] result: true
2025-05-19 13:44:55.890 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:9876] result: true
2025-05-19 13:44:55.890 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:10911] result: true
2025-05-19 13:44:55.903 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:10911] result: true
2025-05-19 13:44:55.903 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:9876] result: true
2025-05-19 13:44:56.018 [SpringContextShutdownHook] INFO  o.s.orm.jpa.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-05-19 13:44:56.019 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-2} closing ...
2025-05-19 13:44:56.025 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-2} closed
2025-05-19 13:44:56.025 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} closing ...
2025-05-19 13:44:56.025 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} closed
2025-05-19 13:55:33.351 [main] WARN  com.alibaba.nacos.client.logging.NacosLogging - Load Logback Configuration of Nacos fail, message: Could not initialize Logback Nacos logging from classpath:nacos-logback.xml
2025-05-19 13:55:33.352 [main] INFO  com.bgpay.bgai.BgaiApplication - The following 1 profile is active: "dev"
2025-05-19 13:55:34.677 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-05-19 13:55:34.679 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-05-19 13:55:34.703 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 17 ms. Found 0 JPA repository interfaces.
2025-05-19 13:55:34.715 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-05-19 13:55:34.716 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-05-19 13:55:34.727 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 4 ms. Found 0 Redis repository interfaces.
2025-05-19 13:55:35.348 [main] INFO  io.seata.config.ConfigurationFactory - load Configuration from :Spring Configuration
2025-05-19 13:55:35.356 [main] INFO  io.seata.config.ConfigurationFactory - load Configuration from :Spring Configuration
2025-05-19 13:55:35.363 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Initializing Global Transaction Clients ... 
2025-05-19 13:55:35.466 [main] INFO  io.seata.core.rpc.netty.NettyClientBootstrap - NettyClientBootstrap has started
2025-05-19 13:55:35.466 [main] INFO  io.seata.discovery.registry.RegistryFactory - use registry center type: file
2025-05-19 13:55:35.476 [main] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - will connect to 8.133.246.113:8091
2025-05-19 13:55:35.480 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - NettyPool create channel to transactionRole:TMROLE,address:8.133.246.113:8091,msg:< RegisterTMRequest{version='1.7.0', applicationId='bgtech-ai', transactionServiceGroup='bgai-tx-group', extraData='ak=null
digest=bgai-tx-group,192.168.86.8,1747634135479
timestamp=1747634135479
authVersion=V4
vgroup=bgai-tx-group
ip=192.168.86.8
'} >
2025-05-19 13:55:35.629 [main] INFO  io.seata.core.rpc.netty.TmNettyRemotingClient - register TM success. client version:1.7.0, server version:1.8.1-SNAPSHOT,channel:[id: 0x191ab4bf, L:/192.168.86.8:51367 - R:/8.133.246.113:8091]
2025-05-19 13:55:35.636 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - register success, cost 82 ms, version:1.8.1-SNAPSHOT,role:TMROLE,channel:[id: 0x191ab4bf, L:/192.168.86.8:51367 - R:/8.133.246.113:8091]
2025-05-19 13:55:35.637 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Transaction Manager Client is initialized. applicationId[bgtech-ai] txServiceGroup[bgai-tx-group]
2025-05-19 13:55:35.654 [main] INFO  io.seata.rm.datasource.AsyncWorker - Async Commit Buffer Limit: 10000
2025-05-19 13:55:35.655 [main] INFO  io.seata.rm.datasource.xa.ResourceManagerXA - ResourceManagerXA init ...
2025-05-19 13:55:35.663 [main] INFO  io.seata.core.rpc.netty.NettyClientBootstrap - NettyClientBootstrap has started
2025-05-19 13:55:35.663 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Resource Manager is initialized. applicationId[bgtech-ai] txServiceGroup[bgai-tx-group]
2025-05-19 13:55:35.663 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Global Transaction Clients are initialized. 
2025-05-19 13:55:36.739 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat initialized with port(s): 8080 (http)
2025-05-19 13:55:36.749 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - The ["http-nio-8080"] connector has been configured to support HTTP upgrade to [h2c]
2025-05-19 13:55:36.749 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - Initializing ProtocolHandler ["http-nio-8080"]
2025-05-19 13:55:36.751 [main] INFO  org.apache.catalina.core.StandardService - Starting service [Tomcat]
2025-05-19 13:55:36.751 [main] INFO  org.apache.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.15]
2025-05-19 13:55:37.131 [main] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} inited
2025-05-19 13:55:37.370 [main] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - will connect to 8.133.246.113:8091
2025-05-19 13:55:37.370 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - RM will register :jdbc:mysql://8.133.246.113:3306/deepseek
2025-05-19 13:55:37.370 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - NettyPool create channel to transactionRole:RMROLE,address:8.133.246.113:8091,msg:< RegisterRMRequest{resourceIds='jdbc:mysql://8.133.246.113:3306/deepseek', version='1.7.0', applicationId='bgtech-ai', transactionServiceGroup='bgai-tx-group', extraData='null'} >
2025-05-19 13:55:37.387 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - register RM success. client version:1.7.0, server version:1.8.1-SNAPSHOT,channel:[id: 0x100060c9, L:/192.168.86.8:51372 - R:/8.133.246.113:8091]
2025-05-19 13:55:37.387 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - register success, cost 10 ms, version:1.8.1-SNAPSHOT,role:RMROLE,channel:[id: 0x100060c9, L:/192.168.86.8:51372 - R:/8.133.246.113:8091]
2025-05-19 13:55:37.389 [main] INFO  i.s.s.a.datasource.SeataAutoDataSourceProxyCreator - Auto proxy data source 'masterDataSource' by 'AT' mode.
2025-05-19 13:55:37.453 [main] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-2} inited
2025-05-19 13:55:37.522 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - will register resourceId:jdbc:mysql://8.133.246.113:3306/deepseek
2025-05-19 13:55:37.523 [main] INFO  i.s.s.a.datasource.SeataAutoDataSourceProxyCreator - Auto proxy data source 'slaveDataSource' by 'AT' mode.
2025-05-19 13:55:37.531 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.rm.AbstractRMHandler - the rm client received response msg [RegisterRMResponse{version='1.8.1-SNAPSHOT', extraData='null', identified=true, resultCode=null, msg='null'}] from tc server.
2025-05-19 13:55:37.549 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - will register resourceId:jdbc:mysql://8.133.246.113:3306/deepseek
2025-05-19 13:55:37.550 [main] INFO  i.s.s.a.datasource.SeataAutoDataSourceProxyCreator - Auto proxy data source 'dynamicDataSource' by 'AT' mode.
2025-05-19 13:55:37.572 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.rm.AbstractRMHandler - the rm client received response msg [RegisterRMResponse{version='1.8.1-SNAPSHOT', extraData='null', identified=true, resultCode=null, msg='null'}] from tc server.
2025-05-19 13:55:37.709 [main] INFO  org.hibernate.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-05-19 13:55:37.792 [main] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.1.7.Final
2025-05-19 13:55:38.120 [main] INFO  SQL dialect - HHH000400: Using dialect: org.hibernate.dialect.MySQL8Dialect
2025-05-19 13:55:38.122 [main] WARN  org.hibernate.orm.deprecation - HHH90000026: MySQL8Dialect has been deprecated; use org.hibernate.dialect.MySQLDialect instead
2025-05-19 13:55:38.392 [main] INFO  o.h.e.t.jta.platform.internal.JtaPlatformInitiator - HHH000490: Using JtaPlatform implementation: [org.hibernate.engine.transaction.jta.platform.internal.NoJtaPlatform]
2025-05-19 13:55:38.402 [main] INFO  o.s.orm.jpa.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-05-19 13:55:38.763 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-19 13:55:38.774 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-19 13:55:38.800 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-19 13:55:38.802 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-19 13:55:38.802 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-19 13:55:38.813 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-19 13:55:39.434 [main] INFO  com.bgpay.bgai.service.impl.UserServiceImpl - 初始化SSO配置: clientId=bgai-client-id, redirectUri=http://localhost:8080/api/auth/callback
2025-05-19 13:55:39.557 [main] INFO  com.bgpay.bgai.controller.AuthController - 初始化认证控制器: clientId=bgai-client-id, redirectUri=http://localhost:8080/api/auth/callback
2025-05-19 13:55:40.134 [main] INFO  o.a.r.s.autoconfigure.RocketMQAutoConfiguration - a producer (billing-producer-group) init on namesrv 8.133.246.113:9876
2025-05-19 13:55:40.426 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Bean [com.bgpay.bgai.service.deepseek.DeepSeekServiceImp$$SpringCGLIB$$0] with name [deepSeekServiceImp] would use interceptor [io.seata.spring.annotation.GlobalTransactionalInterceptor]
2025-05-19 13:55:40.736 [main] WARN  i.s.s.b.a.provider.SpringBootConfigurationProvider - The get method not found for the field 'SeataProperties#accesskey'.
2025-05-19 13:55:40.736 [main] WARN  i.s.s.b.a.provider.SpringBootConfigurationProvider - The get method not found for the field 'SeataProperties#secretkey'.
2025-05-19 13:55:40.747 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 加载到1个Saga状态机定义文件
2025-05-19 13:55:40.881 [main] INFO  com.bgpay.bgai.saga.CustomSagaJsonParser - 开始解析状态机定义: bgai-saga-transaction
2025-05-19 13:55:40.881 [main] INFO  com.bgpay.bgai.saga.CustomSagaJsonParser - 状态机定义解析成功: bgai-saga-transaction
2025-05-19 13:55:40.881 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 成功加载状态机定义: /E:/project/bgai/target/classes/statelang/bgai-saga-transaction.json
2025-05-19 13:55:41.362 [main] INFO  org.redisson.Version - Redisson 3.24.3
2025-05-19 13:55:41.490 [redisson-netty-4-6] INFO  o.r.connection.pool.MasterPubSubConnectionPool - 1 connections initialized for 8.133.246.113/8.133.246.113:6379
2025-05-19 13:55:41.936 [redisson-netty-4-19] INFO  org.redisson.connection.pool.MasterConnectionPool - 24 connections initialized for 8.133.246.113/8.133.246.113:6379
2025-05-19 13:55:42.185 [main] INFO  com.bgpay.bgai.service.mq.MQConsumerService - MQ consumer startup successful [group=billing-consumer-group, topic=BILLING_TOPIC, tag=USER_BILLING]
2025-05-19 13:55:42.360 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Bean [com.bgpay.bgai.service.impl.SeataTransactionService$$SpringCGLIB$$0] with name [seataTransactionService] would use interceptor [io.seata.spring.annotation.GlobalTransactionalInterceptor]
2025-05-19 13:55:42.502 [main] DEBUG com.bgpay.bgai.config.AsyncConfig$1 - Initializing ExecutorService 'blockingExecutor'
2025-05-19 13:55:43.806 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [After]
2025-05-19 13:55:43.807 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Before]
2025-05-19 13:55:43.807 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Between]
2025-05-19 13:55:43.807 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Cookie]
2025-05-19 13:55:43.807 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Header]
2025-05-19 13:55:43.807 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Host]
2025-05-19 13:55:43.807 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Method]
2025-05-19 13:55:43.807 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Path]
2025-05-19 13:55:43.807 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Query]
2025-05-19 13:55:43.807 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [ReadBody]
2025-05-19 13:55:43.807 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [RemoteAddr]
2025-05-19 13:55:43.807 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [XForwardedRemoteAddr]
2025-05-19 13:55:43.807 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Weight]
2025-05-19 13:55:43.807 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [CloudFoundryRouteService]
2025-05-19 13:55:45.136 [main] INFO  o.s.b.actuate.endpoint.web.EndpointLinksResolver - Exposing 1 endpoint(s) beneath base path '/actuator'
2025-05-19 13:55:45.461 [main] WARN  i.s.s.b.a.provider.SpringBootConfigurationProvider - The get method not found for the field 'SeataProperties#accesskey'.
2025-05-19 13:55:45.461 [main] WARN  i.s.s.b.a.provider.SpringBootConfigurationProvider - The get method not found for the field 'SeataProperties#secretkey'.
2025-05-19 13:55:45.486 [main] INFO  io.seata.saga.tm.DefaultSagaTransactionalTemplate - Initializing Global Transaction Clients ... 
2025-05-19 13:55:45.486 [main] INFO  io.seata.saga.tm.DefaultSagaTransactionalTemplate - Transaction Manager Client is initialized. applicationId[bgtech-ai] txServiceGroup[bgai-tx-group]
2025-05-19 13:55:45.486 [main] INFO  io.seata.saga.tm.DefaultSagaTransactionalTemplate - Resource Manager is initialized. applicationId[bgtech-ai] txServiceGroup[bgai-tx-group]
2025-05-19 13:55:45.487 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - will register resourceId:bgtech-ai#bgai-tx-group
2025-05-19 13:55:45.487 [main] INFO  io.seata.saga.tm.DefaultSagaTransactionalTemplate - Global Transaction Clients are initialized. 
2025-05-19 13:55:45.496 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.rm.AbstractRMHandler - the rm client received response msg [RegisterRMResponse{version='1.8.1-SNAPSHOT', extraData='null', identified=true, resultCode=null, msg='null'}] from tc server.
2025-05-19 13:55:46.725 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - Starting ProtocolHandler ["http-nio-8080"]
2025-05-19 13:55:46.741 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat started on port(s): 8080 (http) with context path ''
2025-05-19 13:55:46.753 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from ans.namespace attribute : null
2025-05-19 13:55:46.753 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from ALIBABA_ALIWARE_NAMESPACE attribute :null
2025-05-19 13:55:46.754 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from namespace attribute :null
2025-05-19 13:55:46.763 [main] INFO  c.a.n.p.auth.spi.client.ClientAuthPluginManager - [ClientAuthPluginManager] Load ClientAuthService com.alibaba.nacos.client.auth.impl.NacosClientAuthServiceImpl success.
2025-05-19 13:55:46.763 [main] INFO  c.a.n.p.auth.spi.client.ClientAuthPluginManager - [ClientAuthPluginManager] Load ClientAuthService com.alibaba.nacos.client.auth.ram.RamClientAuthServiceImpl success.
2025-05-19 13:55:46.768 [main] INFO  com.alibaba.nacos.common.remote.client - [RpcClientFactory] create a new rpc client of 635c48bc-c4ec-4f06-a76c-06177b81ab60
2025-05-19 13:55:46.770 [main] INFO  com.alibaba.nacos.common.remote.client - [635c48bc-c4ec-4f06-a76c-06177b81ab60] RpcClient init, ServerListFactory = com.alibaba.nacos.client.naming.core.ServerListManager
2025-05-19 13:55:46.770 [main] INFO  com.alibaba.nacos.common.remote.client - [635c48bc-c4ec-4f06-a76c-06177b81ab60] Registry connection listener to current client:com.alibaba.nacos.client.naming.remote.gprc.redo.NamingGrpcRedoService
2025-05-19 13:55:46.771 [main] INFO  com.alibaba.nacos.common.remote.client - [635c48bc-c4ec-4f06-a76c-06177b81ab60] Register server push request handler:com.alibaba.nacos.client.naming.remote.gprc.NamingPushRequestHandler
2025-05-19 13:55:46.771 [main] INFO  com.alibaba.nacos.common.remote.client - [635c48bc-c4ec-4f06-a76c-06177b81ab60] Try to connect to server on start up, server: {serverIp = '8.133.246.113', server main port = 8848}
2025-05-19 13:55:46.771 [main] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - grpc client connection server:8.133.246.113 ip,serverPort:9848,grpcTslConfig:{"sslProvider":"OPENSSL","enableTls":false,"mutualAuthEnable":false,"trustAll":false}
2025-05-19 13:55:46.901 [main] INFO  com.alibaba.nacos.common.remote.client - [635c48bc-c4ec-4f06-a76c-06177b81ab60] Success to connect to server [8.133.246.113:8848] on start up, connectionId = 1747634146790_139.227.195.203_43808
2025-05-19 13:55:46.901 [main] INFO  com.alibaba.nacos.common.remote.client - [635c48bc-c4ec-4f06-a76c-06177b81ab60] Register server push request handler:com.alibaba.nacos.common.remote.client.RpcClient$ConnectResetRequestHandler
2025-05-19 13:55:46.901 [com.alibaba.nacos.client.remote.worker] INFO  com.alibaba.nacos.common.remote.client - [635c48bc-c4ec-4f06-a76c-06177b81ab60] Notify connected event to listeners.
2025-05-19 13:55:46.901 [main] INFO  com.alibaba.nacos.common.remote.client - [635c48bc-c4ec-4f06-a76c-06177b81ab60] Register server push request handler:com.alibaba.nacos.common.remote.client.RpcClient$$Lambda/0x0000026ebe526b60
2025-05-19 13:55:46.901 [com.alibaba.nacos.client.remote.worker] INFO  com.alibaba.nacos.client.naming - Grpc connection connect
2025-05-19 13:55:46.902 [main] INFO  com.alibaba.nacos.client.naming - [REGISTER-SERVICE] d750d92e-152f-4055-a641-3bc9dda85a29 registering service bgtech-ai with instance Instance{instanceId='null', ip='192.168.86.8', port=8080, weight=1.0, healthy=true, enabled=true, ephemeral=true, clusterName='DEFAULT', serviceName='null', metadata={IPv6=[2408:820c:7528:8342:b486:9b72:4b72:4bf0], preserved.register.source=SPRING_CLOUD}}
2025-05-19 13:55:46.918 [main] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - nacos registry, DEFAULT_GROUP bgtech-ai 192.168.86.8:8080 register finished
2025-05-19 13:55:46.972 [main] INFO  com.bgpay.bgai.BgaiApplication - Started BgaiApplication in 15.865 seconds (process running for 17.278)
2025-05-19 13:55:46.976 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-19 13:55:46.976 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-19 13:55:46.986 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-19 13:55:46.986 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-19 13:55:46.987 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-19 13:55:46.997 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-19 13:55:46.997 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-19 13:55:46.998 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-19 13:55:47.005 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-19 13:55:47.005 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-19 13:55:47.005 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-19 13:55:47.012 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-19 13:55:47.013 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - ==================== Saga状态机加载报告 ====================
2025-05-19 13:55:47.013 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - Saga状态机配置加载状态: 成功
2025-05-19 13:55:47.013 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 已加载的状态机定义文件数量: 1
2025-05-19 13:55:47.013 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 已加载的状态机定义文件:
2025-05-19 13:55:47.013 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig -  - /E:/project/bgai/target/classes/statelang/bgai-saga-transaction.json
2025-05-19 13:55:47.013 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - Saga解析器状态: CUSTOM_FASTJSON2
2025-05-19 13:55:47.013 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 状态机解析结果: 成功 1 个, 失败 0 个
2025-05-19 13:55:47.014 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - =============================================================
2025-05-19 13:55:47.018 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - nacos.cache.data.init.snapshot = true 
2025-05-19 13:55:47.018 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] common-dev.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-19 13:55:47.029 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=common-dev.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-19 13:55:47.030 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=common-dev.yaml, group=DEFAULT_GROUP
2025-05-19 13:55:47.030 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-19 13:55:47.030 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-19 13:55:47.030 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai.yaml, group=DEFAULT_GROUP
2025-05-19 13:55:47.032 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai-dev.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-19 13:55:47.032 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai-dev.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-19 13:55:47.032 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai-dev.yaml, group=DEFAULT_GROUP
2025-05-19 13:55:47.033 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-19 13:55:47.033 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai, group=DEFAULT_GROUP, cnt=1
2025-05-19 13:55:47.033 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai, group=DEFAULT_GROUP
2025-05-19 13:55:53.701 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - 接收到请求: /api/chatGatWay-internal, 文件=新文件 17.txt, 问题参数=null, 模型参数=null
2025-05-19 13:55:53.705 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - 请求Content-Type: multipart/form-data;boundary=--------------------------521378675217219197327308
2025-05-19 13:55:53.706 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - 收集到的完整参数: question="null", apiUrl="null", modelName="null", multiTurn=false
2025-05-19 13:55:53.708 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - Processing request for user ID: 689258T
2025-05-19 13:55:53.708 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - Processing file with circuit breaker: fileName=新文件 17.txt, question=
2025-05-19 13:55:53.711 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.config.ReactiveFileProcessor - Processing file: 新文件 17.txt, content-type: text/plain
2025-05-19 13:55:53.722 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - PARAM TRACE [689258T]: 尝试查找匹配配置 - 参数: apiUrl=null, modelName=null
2025-05-19 13:55:53.739 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 查询配置 - userId=689258T
2025-05-19 13:55:53.740 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 排序方式 - 按ID降序
2025-05-19 13:55:53.740 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 限制结果数 - LIMIT 1
2025-05-19 13:55:53.812 [http-nio-8080-exec-2] DEBUG com.bgpay.bgai.mapper.ApiConfigMapper.selectList - ==>  Preparing: SELECT id,api_url,api_key,model_name,user_id FROM api_config WHERE (user_id = ?) ORDER BY id DESC LIMIT 1
2025-05-19 13:55:53.813 [http-nio-8080-exec-2] DEBUG com.bgpay.bgai.mapper.ApiConfigMapper.selectList - ==> Parameters: 689258T(String)
2025-05-19 13:55:53.820 [http-nio-8080-exec-2] DEBUG com.bgpay.bgai.mapper.ApiConfigMapper.selectList - <==      Total: 1
2025-05-19 13:55:53.821 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 查询结果 - 找到配置: id=2, modelName=deepseek-chat
2025-05-19 13:55:53.821 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - PARAM TRACE [689258T]: 找到匹配配置 - apiUrl=https://api.deepseek.com/chat/completions, modelName=deepseek-chat (原始请求: null)
2025-05-19 13:55:53.821 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - API config resolved: url=https://api.deepseek.com/chat/completions, model=deepseek-chat
2025-05-19 13:55:53.840 [Thread-49] INFO  com.bgpay.bgai.config.ReactiveFileProcessor - File processed successfully: size=6680 bytes
2025-05-19 13:55:53.845 [Thread-49] INFO  com.bgpay.bgai.controller.ReactiveChatController - Content processed, length: 6603
2025-05-19 13:55:53.852 [Thread-49] INFO  io.seata.tm.TransactionManagerHolder - TransactionManager Singleton io.seata.tm.DefaultTransactionManager@20bf83be
2025-05-19 13:55:53.874 [Thread-49] INFO  io.seata.tm.api.DefaultGlobalTransaction - Begin new global transaction [seata-server:8091:27673667088527371]
2025-05-19 13:55:53.876 [Thread-49] INFO  c.b.bgai.interceptor.SeataTransactionInterceptor - 准备记录分布式事务开始: XID=seata-server:8091:27673667088527371, 业务=com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive, 路径=, IP=, 用户=system
2025-05-19 13:55:53.893 [Thread-49] INFO  c.b.bgai.service.impl.TransactionLogServiceImpl - 记录分布式事务开始: XID=seata-server:8091:27673667088527371, 业务=com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive
2025-05-19 13:55:53.900 [Thread-49] DEBUG com.bgpay.bgai.mapper.TransactionLogMapper.insert - ==>  Preparing: INSERT INTO transaction_log ( xid, transaction_name, transaction_mode, status, request_path, source_ip, start_time, user_id, create_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-05-19 13:55:53.904 [Thread-49] DEBUG com.bgpay.bgai.mapper.TransactionLogMapper.insert - ==> Parameters: seata-server:8091:27673667088527371(String), com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive(String), AT(String), ACTIVE(String), (String), (String), 2025-05-19T13:55:53.893208400(LocalDateTime), system(String), 2025-05-19T13:55:53.893208400(LocalDateTime)
2025-05-19 13:55:54.273 [Thread-49] DEBUG com.bgpay.bgai.mapper.TransactionLogMapper.insert - <==    Updates: 1
2025-05-19 13:55:54.290 [Thread-49] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:27673667088527371, branchId:27673667088527372, lockKeys:transaction_log:3
2025-05-19 13:55:54.301 [Thread-49] WARN  i.s.c.l.EnhancedServiceLoader$InnerEnhancedServiceLoader - Load [io.seata.rm.datasource.undo.parser.ProtostuffUndoLogParser] class fail: io/protostuff/runtime/IdStrategy
2025-05-19 13:55:54.368 [Thread-49] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:27673667088527371, branchId:27673667088527373, lockKeys:transaction_log:3;undo_log:9
2025-05-19 13:55:54.398 [Thread-49] INFO  c.b.bgai.interceptor.SeataTransactionInterceptor - 开始分布式事务: XID=seata-server:8091:27673667088527371, 方法=com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive
2025-05-19 13:55:54.408 [Thread-49] INFO  org.reflections.Reflections - Processing reactive request: content length=6603, apiUrl=https://api.deepseek.com/chat/completions, modelName=deepseek-chat, userId=689258T, multiTurn=false
2025-05-19 13:55:54.431 [Thread-49] INFO  com.bgpay.bgai.transaction.TransactionCoordinator - Transaction prepared for user 689258T: chatCompletionId=chat-7ea11837-3cd7-4b5c-a466-dc3bc18fe899
2025-05-19 13:55:54.432 [Thread-49] INFO  org.reflections.Reflections - Generated request JSON with 2PC transaction: {"stream":false,"max_tokens":2000,"temperature":1.0,"messages":[{"role":"system","content":"You are ...
2025-05-19 13:55:54.454 [Thread-49] INFO  c.b.bgai.service.impl.TransactionLogServiceImpl - 记录分布式事务结束: XID=seata-server:8091:27673667088527371, 状态=COMMITTED
2025-05-19 13:55:54.455 [Thread-49] DEBUG c.b.bgai.mapper.TransactionLogMapper.selectList - ==>  Preparing: SELECT id,xid,branch_id,transaction_name,transaction_mode,status,request_path,source_ip,start_time,end_time,user_id,extra_data,create_time,update_time FROM transaction_log WHERE (xid = ?) LIMIT 1
2025-05-19 13:55:54.457 [Thread-49] DEBUG c.b.bgai.mapper.TransactionLogMapper.selectList - ==> Parameters: seata-server:8091:27673667088527371(String)
2025-05-19 13:55:54.465 [Thread-49] DEBUG c.b.bgai.mapper.TransactionLogMapper.selectList - <==      Total: 1
2025-05-19 13:55:54.468 [Thread-49] DEBUG c.b.bgai.mapper.TransactionLogMapper.updateById - ==>  Preparing: UPDATE transaction_log SET xid=?, transaction_name=?, transaction_mode=?, status=?, request_path=?, source_ip=?, start_time=?, end_time=?, user_id=?, extra_data=?, create_time=?, update_time=? WHERE id=?
2025-05-19 13:55:54.475 [Thread-49] DEBUG c.b.bgai.mapper.TransactionLogMapper.updateById - ==> Parameters: seata-server:8091:27673667088527371(String), com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive(String), AT(String), COMMITTED(String), (String), (String), 2025-05-19T13:55:54(LocalDateTime), 2025-05-19T13:55:54.465847200(LocalDateTime), system(String), {"duration":50,"result":"success"}(String), 2025-05-19T13:55:54(LocalDateTime), 2025-05-19T13:55:54.465847200(LocalDateTime), 3(Long)
2025-05-19 13:55:54.526 [Thread-49] DEBUG c.b.bgai.mapper.TransactionLogMapper.updateById - <==    Updates: 1
2025-05-19 13:55:54.536 [Thread-49] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:27673667088527371, branchId:27673667088527374, lockKeys:transaction_log:3
2025-05-19 13:55:54.561 [Thread-49] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:27673667088527371, branchId:27673667088527375, lockKeys:undo_log:11;transaction_log:3
2025-05-19 13:55:54.584 [Thread-49] INFO  c.b.bgai.interceptor.SeataTransactionInterceptor - 分布式事务成功完成: XID=seata-server:8091:27673667088527371, 耗时=50ms
2025-05-19 13:55:54.585 [Thread-49] INFO  io.seata.tm.api.DefaultGlobalTransaction - transaction seata-server:8091:27673667088527371 will be commit
2025-05-19 13:55:54.597 [Thread-49] INFO  io.seata.tm.api.DefaultGlobalTransaction - transaction end, xid = seata-server:8091:27673667088527371
2025-05-19 13:55:54.597 [Thread-49] INFO  io.seata.tm.api.DefaultGlobalTransaction - [seata-server:8091:27673667088527371] commit status: Committed
2025-05-19 13:55:54.641 [rpcDispatch_RMROLE_1_1_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:27673667088527371', branchId=27673667088527372, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false,"skipCheckLock":true}'}
2025-05-19 13:55:54.642 [rpcDispatch_RMROLE_1_1_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:27673667088527371 27673667088527372 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false,"skipCheckLock":true}
2025-05-19 13:55:54.643 [rpcDispatch_RMROLE_1_1_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-19 13:55:54.652 [rpcDispatch_RMROLE_1_2_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:27673667088527371', branchId=27673667088527373, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false,"skipCheckLock":true}'}
2025-05-19 13:55:54.652 [rpcDispatch_RMROLE_1_2_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:27673667088527371 27673667088527373 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false,"skipCheckLock":true}
2025-05-19 13:55:54.653 [rpcDispatch_RMROLE_1_2_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-19 13:55:54.661 [rpcDispatch_RMROLE_1_3_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:27673667088527371', branchId=27673667088527374, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false}'}
2025-05-19 13:55:54.661 [rpcDispatch_RMROLE_1_3_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:27673667088527371 27673667088527374 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false}
2025-05-19 13:55:54.661 [rpcDispatch_RMROLE_1_3_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-19 13:55:54.670 [rpcDispatch_RMROLE_1_4_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:27673667088527371', branchId=27673667088527375, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false}'}
2025-05-19 13:55:54.670 [rpcDispatch_RMROLE_1_4_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:27673667088527371 27673667088527375 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false}
2025-05-19 13:55:54.670 [rpcDispatch_RMROLE_1_4_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-19 13:56:17.368 [reactor-http-nio-3] INFO  org.reflections.Reflections - Raw response received, length: 2009
2025-05-19 13:56:17.374 [reactor-http-nio-3] WARN  org.reflections.Reflections - Received different chatCompletionId from response: ff991df4-69d8-4b02-8e71-36e9947e09f9 vs prepared: chat-7ea11837-3cd7-4b5c-a466-dc3bc18fe899
2025-05-19 13:56:17.391 [reactor-http-nio-3] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - ==>  Preparing: INSERT INTO chat_completions ( object, created, model, system_fingerprint, api_key ) VALUES ( ?, ?, ?, ?, ? )
2025-05-19 13:56:17.392 [reactor-http-nio-3] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - ==> Parameters: chat.completion(String), 1747634177390(Long), deepseek-chat(String), 689258T(String), chat-7ea11837-3cd7-4b5c-a466-dc3bc18fe899(String)
2025-05-19 13:56:17.403 [reactor-http-nio-3] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - <==    Updates: 1
2025-05-19 13:56:17.403 [reactor-http-nio-3] INFO  com.bgpay.bgai.transaction.TransactionCoordinator - Transaction committed for user 689258T: chatCompletionId=chat-7ea11837-3cd7-4b5c-a466-dc3bc18fe899
2025-05-19 13:56:17.422 [FileWrite-1] INFO  com.bgpay.bgai.service.deepseek.FileWriterService - Successfully wrote content to: \var\data\ai_responses\d2c2eb0b-023b-44a0-ad7d-9f56953705e3.txt
2025-05-19 13:56:17.431 [boundedElastic-1] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - ==>  Preparing: INSERT INTO chat_completions ( object, created, model, system_fingerprint, api_key ) VALUES ( ?, ?, ?, ?, ? )
2025-05-19 13:56:17.432 [boundedElastic-1] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - ==> Parameters: chat.completion(String), 1747634155(Long), deepseek-chat(String), fp_8802369eaa_prod0425fp8(String), chat-7ea11837-3cd7-4b5c-a466-dc3bc18fe899(String)
2025-05-19 13:56:17.443 [boundedElastic-1] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - <==    Updates: 1
2025-05-19 13:56:17.466 [boundedElastic-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.insert - ==>  Preparing: INSERT INTO usage_info ( chat_completion_id, prompt_tokens, completion_tokens, total_tokens, prompt_tokens_cached, completion_reasoning_tokens, prompt_cache_hit_tokens, prompt_cache_miss_tokens, created_at, model_type ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-05-19 13:56:17.468 [boundedElastic-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.insert - ==> Parameters: chat-7ea11837-3cd7-4b5c-a466-dc3bc18fe899(String), 2209(Integer), 394(Integer), 2603(Integer), 2176(Integer), 0(Integer), 0(Integer), 33(Integer), 2025-05-19T13:56:17.458043800(LocalDateTime), deepseek-chat(String)
2025-05-19 13:56:17.480 [boundedElastic-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.insert - <==    Updates: 1
2025-05-19 13:56:17.508 [boundedElastic-1] INFO  org.reflections.Reflections - Completion data saved synchronously for chatCompletionId: chat-7ea11837-3cd7-4b5c-a466-dc3bc18fe899
2025-05-19 13:56:17.514 [boundedElastic-2] INFO  org.reflections.Reflections - 开始发送账单消息，chatCompletionId: chat-7ea11837-3cd7-4b5c-a466-dc3bc18fe899, userId: 689258T
2025-05-19 13:56:17.566 [boundedElastic-2] INFO  org.reflections.Reflections - 账单消息发送成功，chatCompletionId: chat-7ea11837-3cd7-4b5c-a466-dc3bc18fe899, userId: 689258T
2025-05-19 13:56:17.569 [boundedElastic-1] INFO  org.reflections.Reflections - Complete processing chain completed: This appears to be a Spring Boot application configuration file (likely `application.yml`). Here are the key components I can see:

1. **Basic Application Config**:
   - App name: `bgai`
   - Active profile: `dev`
   - Allows bean definition overriding

2. **Database Config**:
   - MySQL master/slave setup using Druid connection pool
   - Both pointing to `8.133.246.113:3306/deepseek`
   - Username: `bgtech`, Password: `Zly689258..`
   - Hibernate/JPA configured for MySQL8 with auto-update

3. **Redis Config**:
   - Single Redis instance at `8.133.246.113:6379`
   - Password: `5z25u2sk`
   - Used for both Spring Session and application cache

4. **Other Services**:
   - RocketMQ at `8.133.246.113:9876`
   - Flink Job Manager at `8.133.246.113:8081`
   - Tesseract OCR data path configured

5. **Resilience Config**:
   - Circuit breakers for API calls (deepseekApiBreaker)
   - Time limiters and retry configurations

6. **Security**:
   - SSO OAuth2 configuration
   - API key authentication with 2 sample keys

7. **Performance**:
   - Async task thread pool configuration
   - HTTP connection limits
   - File upload size limits (200MB)

8. **Logging**:
   - JSON format logs written to `/var/data/ai_responses/application.log`

The configuration shows this is likely an AI service application with conversation capabilities (max 5 rounds retained), file processing, and integration with various backend services.

Would you like me to analyze any specific part of this configuration in more detail?
2025-05-19 13:56:17.569 [boundedElastic-1] INFO  com.bgpay.bgai.controller.ReactiveChatController - Processed response for user 689258T, content length: 1512
2025-05-19 13:56:46.578 [pool-7-thread-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.selectCount - ==>  Preparing: SELECT COUNT( * ) AS total FROM usage_info WHERE (chat_completion_id = ?)
2025-05-19 13:56:46.579 [pool-7-thread-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.selectCount - ==> Parameters: chat-7ea11837-3cd7-4b5c-a466-dc3bc18fe899(String)
2025-05-19 13:56:46.585 [pool-7-thread-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.selectCount - <==      Total: 1
2025-05-19 13:56:46.730 [ConsumeMessageThread_billing-consumer-group_1] INFO  c.bgpay.bgai.service.mq.RocketMQBillingServiceImpl - Output price config priceVersion: 1
2025-05-19 13:56:46.732 [ConsumeMessageThread_billing-consumer-group_1] DEBUG com.bgpay.bgai.mapper.UsageRecordMapper.insert - ==>  Preparing: INSERT INTO usage_record ( model_type, chat_completion_id, user_id, input_cost, output_cost, price_version, calculated_at ) VALUES ( ?, ?, ?, ?, ?, ?, ? )
2025-05-19 13:56:46.733 [ConsumeMessageThread_billing-consumer-group_1] DEBUG com.bgpay.bgai.mapper.UsageRecordMapper.insert - ==> Parameters: deepseek-chat(String), chat-7ea11837-3cd7-4b5c-a466-dc3bc18fe899(String), 689258T(String), 0.0001(BigDecimal), 0.0032(BigDecimal), 1(Integer), 2025-05-19T13:56:46.730583300(LocalDateTime)
2025-05-19 13:56:46.750 [ConsumeMessageThread_billing-consumer-group_1] DEBUG com.bgpay.bgai.mapper.UsageRecordMapper.insert - <==    Updates: 1
2025-05-19 13:56:46.759 [ConsumeMessageThread_billing-consumer-group_1] INFO  c.bgpay.bgai.service.mq.RocketMQBillingServiceImpl - Message consumed: 2408820C75288342B4869B724B724BF08C0C36BAF30C5FB01E0A0000
2025-05-19 13:58:43.461 [Thread-1] WARN  c.alibaba.nacos.common.http.HttpClientBeanHolder - [HttpClientBeanHolder] Start destroying common HttpClient
2025-05-19 13:58:43.461 [Thread-7] WARN  com.alibaba.nacos.common.notify.NotifyCenter - [NotifyCenter] Start destroying Publisher
2025-05-19 13:58:43.461 [Thread-7] WARN  com.alibaba.nacos.common.notify.NotifyCenter - [NotifyCenter] Destruction of the end
2025-05-19 13:58:43.462 [Thread-1] WARN  c.alibaba.nacos.common.http.HttpClientBeanHolder - [HttpClientBeanHolder] Destruction of the end
2025-05-19 13:58:43.480 [NettyClientSelector_TMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - channel inactive: [id: 0x191ab4bf, L:/192.168.86.8:51367 ! R:/8.133.246.113:8091]
2025-05-19 13:58:43.480 [NettyClientSelector_TMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - return to pool, rm channel:[id: 0x191ab4bf, L:/192.168.86.8:51367 ! R:/8.133.246.113:8091]
2025-05-19 13:58:43.480 [NettyClientSelector_TMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - channel valid false,channel:[id: 0x191ab4bf, L:/192.168.86.8:51367 ! R:/8.133.246.113:8091]
2025-05-19 13:58:43.480 [NettyClientSelector_TMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - will destroy channel:[id: 0x191ab4bf, L:/192.168.86.8:51367 ! R:/8.133.246.113:8091]
2025-05-19 13:58:43.480 [NettyClientSelector_TMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0x191ab4bf, L:/192.168.86.8:51367 ! R:/8.133.246.113:8091]) will closed
2025-05-19 13:58:43.480 [NettyClientSelector_TMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0x191ab4bf, L:/192.168.86.8:51367 ! R:/8.133.246.113:8091]) will closed
2025-05-19 13:58:43.481 [NettyClientSelector_RMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - channel inactive: [id: 0x100060c9, L:/192.168.86.8:51372 ! R:/8.133.246.113:8091]
2025-05-19 13:58:43.481 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - return to pool, rm channel:[id: 0x100060c9, L:/192.168.86.8:51372 ! R:/8.133.246.113:8091]
2025-05-19 13:58:43.481 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - channel valid false,channel:[id: 0x100060c9, L:/192.168.86.8:51372 ! R:/8.133.246.113:8091]
2025-05-19 13:58:43.481 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - will destroy channel:[id: 0x100060c9, L:/192.168.86.8:51372 ! R:/8.133.246.113:8091]
2025-05-19 13:58:43.481 [NettyClientSelector_RMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0x100060c9, L:/192.168.86.8:51372 ! R:/8.133.246.113:8091]) will closed
2025-05-19 13:58:43.481 [NettyClientSelector_RMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0x100060c9, L:/192.168.86.8:51372 ! R:/8.133.246.113:8091]) will closed
2025-05-19 13:58:43.483 [SpringContextShutdownHook] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - De-registering from Nacos Server now...
2025-05-19 13:58:43.483 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - [DEREGISTER-SERVICE] d750d92e-152f-4055-a641-3bc9dda85a29 deregistering service bgtech-ai with instance: Instance{instanceId='null', ip='192.168.86.8', port=8080, weight=1.0, healthy=true, enabled=true, ephemeral=true, clusterName='DEFAULT', serviceName='null', metadata={}}
2025-05-19 13:58:43.496 [SpringContextShutdownHook] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - De-registration finished.
2025-05-19 13:58:43.497 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.cache.ServiceInfoHolder do shutdown begin
2025-05-19 13:58:43.497 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.backups.FailoverReactor do shutdown begin
2025-05-19 13:58:43.497 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.backups.FailoverReactor do shutdown stop
2025-05-19 13:58:43.497 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.cache.ServiceInfoHolder do shutdown stop
2025-05-19 13:58:43.497 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.NamingClientProxyDelegate do shutdown begin
2025-05-19 13:58:43.497 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServiceInfoUpdateService do shutdown begin
2025-05-19 13:58:43.497 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServiceInfoUpdateService do shutdown stop
2025-05-19 13:58:43.497 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServerListManager do shutdown begin
2025-05-19 13:58:43.497 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Start destroying NacosRestTemplate
2025-05-19 13:58:43.498 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Destruction of the end
2025-05-19 13:58:43.498 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServerListManager do shutdown stop
2025-05-19 13:58:43.498 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.http.NamingHttpClientProxy do shutdown begin
2025-05-19 13:58:43.498 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Start destroying NacosRestTemplate
2025-05-19 13:58:43.498 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Destruction of the end
2025-05-19 13:58:43.498 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.http.NamingHttpClientProxy do shutdown stop
2025-05-19 13:58:43.498 [SpringContextShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Shutdown rpc client, set status to shutdown
2025-05-19 13:58:43.498 [SpringContextShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Shutdown client event executor java.util.concurrent.ScheduledThreadPoolExecutor@3aae6d53[Running, pool size = 2, active threads = 2, queued tasks = 0, completed tasks = 0]
2025-05-19 13:58:43.498 [SpringContextShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Close current connection 1747634146790_139.227.195.203_43808
2025-05-19 13:58:43.501 [nacos-grpc-client-executor-8.133.246.113-55] WARN  c.a.nacos.common.remote.client.grpc.GrpcClient - [1747634146790_139.227.195.203_43808]Ignore error event,isRunning:false,isAbandon=false
2025-05-19 13:58:43.502 [SpringContextShutdownHook] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - Shutdown grpc executor java.util.concurrent.ThreadPoolExecutor@56625ce9[Running, pool size = 4, active threads = 0, queued tasks = 0, completed tasks = 56]
2025-05-19 13:58:43.502 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - Shutdown grpc redo service executor java.util.concurrent.ScheduledThreadPoolExecutor@3a02d567[Running, pool size = 1, active threads = 0, queued tasks = 1, completed tasks = 58]
2025-05-19 13:58:43.502 [SpringContextShutdownHook] INFO  c.a.n.client.auth.ram.identify.CredentialWatcher - [null] CredentialWatcher is stopped
2025-05-19 13:58:43.503 [SpringContextShutdownHook] INFO  c.a.n.client.auth.ram.identify.CredentialService - [null] CredentialService is freed
2025-05-19 13:58:43.503 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.NamingClientProxyDelegate do shutdown stop
2025-05-19 13:58:45.545 [SpringContextShutdownHook] DEBUG com.bgpay.bgai.config.AsyncConfig$1 - Shutting down ExecutorService 'blockingExecutor'
2025-05-19 13:58:45.587 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:10909] result: true
2025-05-19 13:58:45.588 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:10911] result: true
2025-05-19 13:58:45.588 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:9876] result: true
2025-05-19 13:58:45.612 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:10911] result: true
2025-05-19 13:58:45.612 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:9876] result: true
2025-05-19 13:58:45.723 [SpringContextShutdownHook] INFO  o.s.orm.jpa.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-05-19 13:58:45.726 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-2} closing ...
2025-05-19 13:58:45.731 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-2} closed
2025-05-19 13:58:45.731 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} closing ...
2025-05-19 13:58:45.732 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} closed
2025-05-19 14:04:34.592 [main] WARN  com.alibaba.nacos.client.logging.NacosLogging - Load Logback Configuration of Nacos fail, message: Could not initialize Logback Nacos logging from classpath:nacos-logback.xml
2025-05-19 14:04:34.593 [main] INFO  com.bgpay.bgai.BgaiApplication - The following 1 profile is active: "dev"
2025-05-19 14:04:35.895 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-05-19 14:04:35.897 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-05-19 14:04:35.921 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 17 ms. Found 0 JPA repository interfaces.
2025-05-19 14:04:35.931 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-05-19 14:04:35.932 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-05-19 14:04:35.944 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 4 ms. Found 0 Redis repository interfaces.
2025-05-19 14:04:36.525 [main] INFO  io.seata.config.ConfigurationFactory - load Configuration from :Spring Configuration
2025-05-19 14:04:36.534 [main] INFO  io.seata.config.ConfigurationFactory - load Configuration from :Spring Configuration
2025-05-19 14:04:36.542 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Initializing Global Transaction Clients ... 
2025-05-19 14:04:36.646 [main] INFO  io.seata.core.rpc.netty.NettyClientBootstrap - NettyClientBootstrap has started
2025-05-19 14:04:36.647 [main] INFO  io.seata.discovery.registry.RegistryFactory - use registry center type: file
2025-05-19 14:04:36.657 [main] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - will connect to 8.133.246.113:8091
2025-05-19 14:04:36.661 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - NettyPool create channel to transactionRole:TMROLE,address:8.133.246.113:8091,msg:< RegisterTMRequest{version='1.7.0', applicationId='bgtech-ai', transactionServiceGroup='bgai-tx-group', extraData='ak=null
digest=bgai-tx-group,192.168.86.8,1747634676659
timestamp=1747634676659
authVersion=V4
vgroup=bgai-tx-group
ip=192.168.86.8
'} >
2025-05-19 14:04:36.792 [main] INFO  io.seata.core.rpc.netty.TmNettyRemotingClient - register TM success. client version:1.7.0, server version:1.8.1-SNAPSHOT,channel:[id: 0x1c4d51a7, L:/192.168.86.8:61022 - R:/8.133.246.113:8091]
2025-05-19 14:04:36.799 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - register success, cost 66 ms, version:1.8.1-SNAPSHOT,role:TMROLE,channel:[id: 0x1c4d51a7, L:/192.168.86.8:61022 - R:/8.133.246.113:8091]
2025-05-19 14:04:36.799 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Transaction Manager Client is initialized. applicationId[bgtech-ai] txServiceGroup[bgai-tx-group]
2025-05-19 14:04:36.812 [main] INFO  io.seata.rm.datasource.AsyncWorker - Async Commit Buffer Limit: 10000
2025-05-19 14:04:36.813 [main] INFO  io.seata.rm.datasource.xa.ResourceManagerXA - ResourceManagerXA init ...
2025-05-19 14:04:36.821 [main] INFO  io.seata.core.rpc.netty.NettyClientBootstrap - NettyClientBootstrap has started
2025-05-19 14:04:36.821 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Resource Manager is initialized. applicationId[bgtech-ai] txServiceGroup[bgai-tx-group]
2025-05-19 14:04:36.821 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Global Transaction Clients are initialized. 
2025-05-19 14:04:37.919 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat initialized with port(s): 8080 (http)
2025-05-19 14:04:37.929 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - The ["http-nio-8080"] connector has been configured to support HTTP upgrade to [h2c]
2025-05-19 14:04:37.929 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - Initializing ProtocolHandler ["http-nio-8080"]
2025-05-19 14:04:37.930 [main] INFO  org.apache.catalina.core.StandardService - Starting service [Tomcat]
2025-05-19 14:04:37.931 [main] INFO  org.apache.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.15]
2025-05-19 14:04:38.313 [main] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} inited
2025-05-19 14:04:38.585 [main] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - will connect to 8.133.246.113:8091
2025-05-19 14:04:38.585 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - RM will register :jdbc:mysql://8.133.246.113:3306/deepseek
2025-05-19 14:04:38.585 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - NettyPool create channel to transactionRole:RMROLE,address:8.133.246.113:8091,msg:< RegisterRMRequest{resourceIds='jdbc:mysql://8.133.246.113:3306/deepseek', version='1.7.0', applicationId='bgtech-ai', transactionServiceGroup='bgai-tx-group', extraData='null'} >
2025-05-19 14:04:38.607 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - register RM success. client version:1.7.0, server version:1.8.1-SNAPSHOT,channel:[id: 0x553d6c22, L:/192.168.86.8:61026 - R:/8.133.246.113:8091]
2025-05-19 14:04:38.607 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - register success, cost 12 ms, version:1.8.1-SNAPSHOT,role:RMROLE,channel:[id: 0x553d6c22, L:/192.168.86.8:61026 - R:/8.133.246.113:8091]
2025-05-19 14:04:38.609 [main] INFO  i.s.s.a.datasource.SeataAutoDataSourceProxyCreator - Auto proxy data source 'masterDataSource' by 'AT' mode.
2025-05-19 14:04:38.686 [main] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-2} inited
2025-05-19 14:04:38.766 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - will register resourceId:jdbc:mysql://8.133.246.113:3306/deepseek
2025-05-19 14:04:38.767 [main] INFO  i.s.s.a.datasource.SeataAutoDataSourceProxyCreator - Auto proxy data source 'slaveDataSource' by 'AT' mode.
2025-05-19 14:04:38.785 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.rm.AbstractRMHandler - the rm client received response msg [RegisterRMResponse{version='1.8.1-SNAPSHOT', extraData='null', identified=true, resultCode=null, msg='null'}] from tc server.
2025-05-19 14:04:38.789 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - will register resourceId:jdbc:mysql://8.133.246.113:3306/deepseek
2025-05-19 14:04:38.790 [main] INFO  i.s.s.a.datasource.SeataAutoDataSourceProxyCreator - Auto proxy data source 'dynamicDataSource' by 'AT' mode.
2025-05-19 14:04:38.803 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.rm.AbstractRMHandler - the rm client received response msg [RegisterRMResponse{version='1.8.1-SNAPSHOT', extraData='null', identified=true, resultCode=null, msg='null'}] from tc server.
2025-05-19 14:04:38.896 [main] INFO  org.hibernate.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-05-19 14:04:38.942 [main] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.1.7.Final
2025-05-19 14:04:39.279 [main] INFO  SQL dialect - HHH000400: Using dialect: org.hibernate.dialect.MySQL8Dialect
2025-05-19 14:04:39.281 [main] WARN  org.hibernate.orm.deprecation - HHH90000026: MySQL8Dialect has been deprecated; use org.hibernate.dialect.MySQLDialect instead
2025-05-19 14:04:39.537 [main] INFO  o.h.e.t.jta.platform.internal.JtaPlatformInitiator - HHH000490: Using JtaPlatform implementation: [org.hibernate.engine.transaction.jta.platform.internal.NoJtaPlatform]
2025-05-19 14:04:39.551 [main] INFO  o.s.orm.jpa.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-05-19 14:04:39.952 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-19 14:04:39.963 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-19 14:04:39.989 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-19 14:04:39.991 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-19 14:04:39.991 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-19 14:04:40.003 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-19 14:04:40.621 [main] INFO  com.bgpay.bgai.service.impl.UserServiceImpl - 初始化SSO配置: clientId=bgai-client-id, redirectUri=http://localhost:8080/api/auth/callback
2025-05-19 14:04:40.748 [main] INFO  com.bgpay.bgai.controller.AuthController - 初始化认证控制器: clientId=bgai-client-id, redirectUri=http://localhost:8080/api/auth/callback
2025-05-19 14:04:41.321 [main] INFO  o.a.r.s.autoconfigure.RocketMQAutoConfiguration - a producer (billing-producer-group) init on namesrv 8.133.246.113:9876
2025-05-19 14:04:41.586 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Bean [com.bgpay.bgai.service.deepseek.DeepSeekServiceImp$$SpringCGLIB$$0] with name [deepSeekServiceImp] would use interceptor [io.seata.spring.annotation.GlobalTransactionalInterceptor]
2025-05-19 14:04:41.955 [main] WARN  i.s.s.b.a.provider.SpringBootConfigurationProvider - The get method not found for the field 'SeataProperties#accesskey'.
2025-05-19 14:04:41.955 [main] WARN  i.s.s.b.a.provider.SpringBootConfigurationProvider - The get method not found for the field 'SeataProperties#secretkey'.
2025-05-19 14:04:41.966 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 加载到1个Saga状态机定义文件
2025-05-19 14:04:42.110 [main] INFO  com.bgpay.bgai.saga.CustomSagaJsonParser - 开始解析状态机定义: bgai-saga-transaction
2025-05-19 14:04:42.111 [main] INFO  com.bgpay.bgai.saga.CustomSagaJsonParser - 状态机定义解析成功: bgai-saga-transaction
2025-05-19 14:04:42.111 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 成功加载状态机定义: /E:/project/bgai/target/classes/statelang/bgai-saga-transaction.json
2025-05-19 14:04:42.795 [main] INFO  org.redisson.Version - Redisson 3.24.3
2025-05-19 14:04:43.076 [redisson-netty-4-6] INFO  o.r.connection.pool.MasterPubSubConnectionPool - 1 connections initialized for 8.133.246.113/8.133.246.113:6379
2025-05-19 14:04:43.420 [redisson-netty-4-19] INFO  org.redisson.connection.pool.MasterConnectionPool - 24 connections initialized for 8.133.246.113/8.133.246.113:6379
2025-05-19 14:04:43.763 [main] INFO  com.bgpay.bgai.service.mq.MQConsumerService - MQ consumer startup successful [group=billing-consumer-group, topic=BILLING_TOPIC, tag=USER_BILLING]
2025-05-19 14:04:43.931 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Bean [com.bgpay.bgai.service.impl.SeataTransactionService$$SpringCGLIB$$0] with name [seataTransactionService] would use interceptor [io.seata.spring.annotation.GlobalTransactionalInterceptor]
2025-05-19 14:04:44.067 [main] DEBUG com.bgpay.bgai.config.AsyncConfig$1 - Initializing ExecutorService 'blockingExecutor'
2025-05-19 14:04:45.490 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [After]
2025-05-19 14:04:45.490 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Before]
2025-05-19 14:04:45.490 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Between]
2025-05-19 14:04:45.490 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Cookie]
2025-05-19 14:04:45.490 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Header]
2025-05-19 14:04:45.491 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Host]
2025-05-19 14:04:45.491 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Method]
2025-05-19 14:04:45.491 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Path]
2025-05-19 14:04:45.491 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Query]
2025-05-19 14:04:45.491 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [ReadBody]
2025-05-19 14:04:45.491 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [RemoteAddr]
2025-05-19 14:04:45.491 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [XForwardedRemoteAddr]
2025-05-19 14:04:45.491 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Weight]
2025-05-19 14:04:45.491 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [CloudFoundryRouteService]
2025-05-19 14:04:47.042 [main] INFO  o.s.b.actuate.endpoint.web.EndpointLinksResolver - Exposing 1 endpoint(s) beneath base path '/actuator'
2025-05-19 14:04:47.395 [main] WARN  i.s.s.b.a.provider.SpringBootConfigurationProvider - The get method not found for the field 'SeataProperties#accesskey'.
2025-05-19 14:04:47.396 [main] WARN  i.s.s.b.a.provider.SpringBootConfigurationProvider - The get method not found for the field 'SeataProperties#secretkey'.
2025-05-19 14:04:47.417 [main] INFO  io.seata.saga.tm.DefaultSagaTransactionalTemplate - Initializing Global Transaction Clients ... 
2025-05-19 14:04:47.417 [main] INFO  io.seata.saga.tm.DefaultSagaTransactionalTemplate - Transaction Manager Client is initialized. applicationId[bgtech-ai] txServiceGroup[bgai-tx-group]
2025-05-19 14:04:47.417 [main] INFO  io.seata.saga.tm.DefaultSagaTransactionalTemplate - Resource Manager is initialized. applicationId[bgtech-ai] txServiceGroup[bgai-tx-group]
2025-05-19 14:04:47.418 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - will register resourceId:bgtech-ai#bgai-tx-group
2025-05-19 14:04:47.418 [main] INFO  io.seata.saga.tm.DefaultSagaTransactionalTemplate - Global Transaction Clients are initialized. 
2025-05-19 14:04:47.426 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.rm.AbstractRMHandler - the rm client received response msg [RegisterRMResponse{version='1.8.1-SNAPSHOT', extraData='null', identified=true, resultCode=null, msg='null'}] from tc server.
2025-05-19 14:04:48.742 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - Starting ProtocolHandler ["http-nio-8080"]
2025-05-19 14:04:48.756 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat started on port(s): 8080 (http) with context path ''
2025-05-19 14:04:48.766 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from ans.namespace attribute : null
2025-05-19 14:04:48.766 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from ALIBABA_ALIWARE_NAMESPACE attribute :null
2025-05-19 14:04:48.767 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from namespace attribute :null
2025-05-19 14:04:48.777 [main] INFO  c.a.n.p.auth.spi.client.ClientAuthPluginManager - [ClientAuthPluginManager] Load ClientAuthService com.alibaba.nacos.client.auth.impl.NacosClientAuthServiceImpl success.
2025-05-19 14:04:48.777 [main] INFO  c.a.n.p.auth.spi.client.ClientAuthPluginManager - [ClientAuthPluginManager] Load ClientAuthService com.alibaba.nacos.client.auth.ram.RamClientAuthServiceImpl success.
2025-05-19 14:04:48.781 [main] INFO  com.alibaba.nacos.common.remote.client - [RpcClientFactory] create a new rpc client of 0f1ec11a-cb7b-4a91-bb71-b16ca1977a1c
2025-05-19 14:04:48.782 [main] INFO  com.alibaba.nacos.common.remote.client - [0f1ec11a-cb7b-4a91-bb71-b16ca1977a1c] RpcClient init, ServerListFactory = com.alibaba.nacos.client.naming.core.ServerListManager
2025-05-19 14:04:48.782 [main] INFO  com.alibaba.nacos.common.remote.client - [0f1ec11a-cb7b-4a91-bb71-b16ca1977a1c] Registry connection listener to current client:com.alibaba.nacos.client.naming.remote.gprc.redo.NamingGrpcRedoService
2025-05-19 14:04:48.783 [main] INFO  com.alibaba.nacos.common.remote.client - [0f1ec11a-cb7b-4a91-bb71-b16ca1977a1c] Register server push request handler:com.alibaba.nacos.client.naming.remote.gprc.NamingPushRequestHandler
2025-05-19 14:04:48.783 [main] INFO  com.alibaba.nacos.common.remote.client - [0f1ec11a-cb7b-4a91-bb71-b16ca1977a1c] Try to connect to server on start up, server: {serverIp = '8.133.246.113', server main port = 8848}
2025-05-19 14:04:48.783 [main] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - grpc client connection server:8.133.246.113 ip,serverPort:9848,grpcTslConfig:{"sslProvider":"OPENSSL","enableTls":false,"mutualAuthEnable":false,"trustAll":false}
2025-05-19 14:04:48.912 [main] INFO  com.alibaba.nacos.common.remote.client - [0f1ec11a-cb7b-4a91-bb71-b16ca1977a1c] Success to connect to server [8.133.246.113:8848] on start up, connectionId = 1747634688803_139.227.195.203_42522
2025-05-19 14:04:48.912 [main] INFO  com.alibaba.nacos.common.remote.client - [0f1ec11a-cb7b-4a91-bb71-b16ca1977a1c] Register server push request handler:com.alibaba.nacos.common.remote.client.RpcClient$ConnectResetRequestHandler
2025-05-19 14:04:48.912 [main] INFO  com.alibaba.nacos.common.remote.client - [0f1ec11a-cb7b-4a91-bb71-b16ca1977a1c] Register server push request handler:com.alibaba.nacos.common.remote.client.RpcClient$$Lambda/0x0000023c5152a060
2025-05-19 14:04:48.912 [com.alibaba.nacos.client.remote.worker] INFO  com.alibaba.nacos.common.remote.client - [0f1ec11a-cb7b-4a91-bb71-b16ca1977a1c] Notify connected event to listeners.
2025-05-19 14:04:48.912 [com.alibaba.nacos.client.remote.worker] INFO  com.alibaba.nacos.client.naming - Grpc connection connect
2025-05-19 14:04:48.913 [main] INFO  com.alibaba.nacos.client.naming - [REGISTER-SERVICE] d750d92e-152f-4055-a641-3bc9dda85a29 registering service bgtech-ai with instance Instance{instanceId='null', ip='192.168.86.8', port=8080, weight=1.0, healthy=true, enabled=true, ephemeral=true, clusterName='DEFAULT', serviceName='null', metadata={IPv6=[2408:820c:7528:8342:b486:9b72:4b72:4bf0], preserved.register.source=SPRING_CLOUD}}
2025-05-19 14:04:48.932 [main] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - nacos registry, DEFAULT_GROUP bgtech-ai 192.168.86.8:8080 register finished
2025-05-19 14:04:48.994 [main] INFO  com.bgpay.bgai.BgaiApplication - Started BgaiApplication in 16.727 seconds (process running for 18.172)
2025-05-19 14:04:48.997 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-19 14:04:48.998 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-19 14:04:49.011 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-19 14:04:49.012 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-19 14:04:49.013 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-19 14:04:49.022 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-19 14:04:49.023 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-19 14:04:49.024 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-19 14:04:49.032 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-19 14:04:49.032 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-19 14:04:49.033 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-19 14:04:49.039 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-19 14:04:49.040 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - ==================== Saga状态机加载报告 ====================
2025-05-19 14:04:49.040 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - Saga状态机配置加载状态: 成功
2025-05-19 14:04:49.040 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 已加载的状态机定义文件数量: 1
2025-05-19 14:04:49.040 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 已加载的状态机定义文件:
2025-05-19 14:04:49.040 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig -  - /E:/project/bgai/target/classes/statelang/bgai-saga-transaction.json
2025-05-19 14:04:49.040 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - Saga解析器状态: CUSTOM_FASTJSON2
2025-05-19 14:04:49.040 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 状态机解析结果: 成功 1 个, 失败 0 个
2025-05-19 14:04:49.040 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - =============================================================
2025-05-19 14:04:49.046 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - nacos.cache.data.init.snapshot = true 
2025-05-19 14:04:49.047 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] common-dev.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-19 14:04:49.057 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=common-dev.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-19 14:04:49.057 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=common-dev.yaml, group=DEFAULT_GROUP
2025-05-19 14:04:49.058 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-19 14:04:49.058 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-19 14:04:49.058 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai.yaml, group=DEFAULT_GROUP
2025-05-19 14:04:49.059 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai-dev.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-19 14:04:49.059 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai-dev.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-19 14:04:49.059 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai-dev.yaml, group=DEFAULT_GROUP
2025-05-19 14:04:49.060 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-19 14:04:49.060 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai, group=DEFAULT_GROUP, cnt=1
2025-05-19 14:04:49.060 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai, group=DEFAULT_GROUP
2025-05-19 14:05:01.362 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - 接收到请求: /api/chatGatWay-internal, 文件=新文件 17.txt, 问题参数=null, 模型参数=null
2025-05-19 14:05:01.363 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - 请求Content-Type: multipart/form-data;boundary=--------------------------758616327741094174574926
2025-05-19 14:05:01.364 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - 收集到的完整参数: question="null", apiUrl="null", modelName="null", multiTurn=false
2025-05-19 14:05:01.365 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - Processing request for user ID: 689258T
2025-05-19 14:05:01.365 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - Processing file with circuit breaker: fileName=新文件 17.txt, question=
2025-05-19 14:05:01.367 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.config.ReactiveFileProcessor - Processing file: 新文件 17.txt, content-type: text/plain
2025-05-19 14:05:01.374 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - PARAM TRACE [689258T]: 尝试查找匹配配置 - 参数: apiUrl=null, modelName=null
2025-05-19 14:05:01.383 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 查询配置 - userId=689258T
2025-05-19 14:05:01.385 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 排序方式 - 按ID降序
2025-05-19 14:05:01.385 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 限制结果数 - LIMIT 1
2025-05-19 14:05:01.449 [http-nio-8080-exec-2] DEBUG com.bgpay.bgai.mapper.ApiConfigMapper.selectList - ==>  Preparing: SELECT id,api_url,api_key,model_name,user_id FROM api_config WHERE (user_id = ?) ORDER BY id DESC LIMIT 1
2025-05-19 14:05:01.450 [http-nio-8080-exec-2] DEBUG com.bgpay.bgai.mapper.ApiConfigMapper.selectList - ==> Parameters: 689258T(String)
2025-05-19 14:05:01.460 [http-nio-8080-exec-2] DEBUG com.bgpay.bgai.mapper.ApiConfigMapper.selectList - <==      Total: 1
2025-05-19 14:05:01.460 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 查询结果 - 找到配置: id=2, modelName=deepseek-chat
2025-05-19 14:05:01.460 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - PARAM TRACE [689258T]: 找到匹配配置 - apiUrl=https://api.deepseek.com/chat/completions, modelName=deepseek-chat (原始请求: null)
2025-05-19 14:05:01.460 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - API config resolved: url=https://api.deepseek.com/chat/completions, model=deepseek-chat
2025-05-19 14:05:01.477 [Thread-50] INFO  com.bgpay.bgai.config.ReactiveFileProcessor - File processed successfully: size=6680 bytes
2025-05-19 14:05:01.481 [Thread-50] INFO  com.bgpay.bgai.controller.ReactiveChatController - Content processed, length: 6603
2025-05-19 14:05:01.489 [Thread-50] INFO  io.seata.tm.TransactionManagerHolder - TransactionManager Singleton io.seata.tm.DefaultTransactionManager@3c5e0d04
2025-05-19 14:05:01.508 [Thread-50] INFO  io.seata.tm.api.DefaultGlobalTransaction - Begin new global transaction [seata-server:8091:27673667088527376]
2025-05-19 14:05:01.511 [Thread-50] INFO  c.b.bgai.interceptor.SeataTransactionInterceptor - 准备记录分布式事务开始: XID=seata-server:8091:27673667088527376, 业务=com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive, 路径=, IP=, 用户=system
2025-05-19 14:05:01.529 [Thread-50] INFO  c.b.bgai.service.impl.TransactionLogServiceImpl - 记录分布式事务开始: XID=seata-server:8091:27673667088527376, 业务=com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive
2025-05-19 14:05:01.536 [Thread-50] DEBUG com.bgpay.bgai.mapper.TransactionLogMapper.insert - ==>  Preparing: INSERT INTO transaction_log ( xid, transaction_name, transaction_mode, status, request_path, source_ip, start_time, user_id, create_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-05-19 14:05:01.540 [Thread-50] DEBUG com.bgpay.bgai.mapper.TransactionLogMapper.insert - ==> Parameters: seata-server:8091:27673667088527376(String), com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive(String), AT(String), ACTIVE(String), (String), (String), 2025-05-19T14:05:01.529115400(LocalDateTime), system(String), 2025-05-19T14:05:01.529115400(LocalDateTime)
2025-05-19 14:05:01.961 [Thread-50] DEBUG com.bgpay.bgai.mapper.TransactionLogMapper.insert - <==    Updates: 1
2025-05-19 14:05:01.981 [Thread-50] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:27673667088527376, branchId:27673667088527377, lockKeys:transaction_log:4
2025-05-19 14:05:01.993 [Thread-50] WARN  i.s.c.l.EnhancedServiceLoader$InnerEnhancedServiceLoader - Load [io.seata.rm.datasource.undo.parser.ProtostuffUndoLogParser] class fail: io/protostuff/runtime/IdStrategy
2025-05-19 14:05:02.060 [Thread-50] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:27673667088527376, branchId:27673667088527378, lockKeys:transaction_log:4;undo_log:13
2025-05-19 14:05:02.090 [Thread-50] INFO  c.b.bgai.interceptor.SeataTransactionInterceptor - 开始分布式事务: XID=seata-server:8091:27673667088527376, 方法=com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive
2025-05-19 14:05:02.100 [Thread-50] INFO  org.reflections.Reflections - Processing reactive request: content length=6603, apiUrl=https://api.deepseek.com/chat/completions, modelName=deepseek-chat, userId=689258T, multiTurn=false
2025-05-19 14:05:02.122 [Thread-50] INFO  com.bgpay.bgai.transaction.TransactionCoordinator - Transaction prepared for user 689258T: chatCompletionId=chat-baa5e142-b24d-4c36-8304-2b9664522f2c
2025-05-19 14:05:02.124 [Thread-50] INFO  org.reflections.Reflections - Generated request JSON with 2PC transaction: {"stream":false,"max_tokens":2000,"temperature":1.0,"messages":[{"role":"system","content":"You are ...
2025-05-19 14:05:02.148 [Thread-50] INFO  c.b.bgai.service.impl.TransactionLogServiceImpl - 记录分布式事务结束: XID=seata-server:8091:27673667088527376, 状态=COMMITTED
2025-05-19 14:05:02.150 [Thread-50] DEBUG c.b.bgai.mapper.TransactionLogMapper.selectList - ==>  Preparing: SELECT id,xid,branch_id,transaction_name,transaction_mode,status,request_path,source_ip,start_time,end_time,user_id,extra_data,create_time,update_time FROM transaction_log WHERE (xid = ?) LIMIT 1
2025-05-19 14:05:02.153 [Thread-50] DEBUG c.b.bgai.mapper.TransactionLogMapper.selectList - ==> Parameters: seata-server:8091:27673667088527376(String)
2025-05-19 14:05:02.160 [Thread-50] DEBUG c.b.bgai.mapper.TransactionLogMapper.selectList - <==      Total: 1
2025-05-19 14:05:02.164 [Thread-50] DEBUG c.b.bgai.mapper.TransactionLogMapper.updateById - ==>  Preparing: UPDATE transaction_log SET xid=?, transaction_name=?, transaction_mode=?, status=?, request_path=?, source_ip=?, start_time=?, end_time=?, user_id=?, extra_data=?, create_time=?, update_time=? WHERE id=?
2025-05-19 14:05:02.174 [Thread-50] DEBUG c.b.bgai.mapper.TransactionLogMapper.updateById - ==> Parameters: seata-server:8091:27673667088527376(String), com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive(String), AT(String), COMMITTED(String), (String), (String), 2025-05-19T14:05:02(LocalDateTime), 2025-05-19T14:05:02.161365100(LocalDateTime), system(String), {"duration":51,"result":"success"}(String), 2025-05-19T14:05:02(LocalDateTime), 2025-05-19T14:05:02.161365100(LocalDateTime), 4(Long)
2025-05-19 14:05:02.229 [Thread-50] DEBUG c.b.bgai.mapper.TransactionLogMapper.updateById - <==    Updates: 1
2025-05-19 14:05:02.239 [Thread-50] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:27673667088527376, branchId:27673667088527379, lockKeys:transaction_log:4
2025-05-19 14:05:02.267 [Thread-50] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:27673667088527376, branchId:27673667088527380, lockKeys:transaction_log:4;undo_log:15
2025-05-19 14:05:02.291 [Thread-50] INFO  c.b.bgai.interceptor.SeataTransactionInterceptor - 分布式事务成功完成: XID=seata-server:8091:27673667088527376, 耗时=51ms
2025-05-19 14:05:02.291 [Thread-50] INFO  io.seata.tm.api.DefaultGlobalTransaction - transaction seata-server:8091:27673667088527376 will be commit
2025-05-19 14:05:02.304 [Thread-50] INFO  io.seata.tm.api.DefaultGlobalTransaction - transaction end, xid = seata-server:8091:27673667088527376
2025-05-19 14:05:02.304 [Thread-50] INFO  io.seata.tm.api.DefaultGlobalTransaction - [seata-server:8091:27673667088527376] commit status: Committed
2025-05-19 14:05:02.625 [rpcDispatch_RMROLE_1_1_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:27673667088527376', branchId=27673667088527377, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false,"skipCheckLock":true}'}
2025-05-19 14:05:02.626 [rpcDispatch_RMROLE_1_1_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:27673667088527376 27673667088527377 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false,"skipCheckLock":true}
2025-05-19 14:05:02.626 [rpcDispatch_RMROLE_1_1_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-19 14:05:02.636 [rpcDispatch_RMROLE_1_2_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:27673667088527376', branchId=27673667088527378, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false,"skipCheckLock":true}'}
2025-05-19 14:05:02.636 [rpcDispatch_RMROLE_1_2_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:27673667088527376 27673667088527378 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false,"skipCheckLock":true}
2025-05-19 14:05:02.636 [rpcDispatch_RMROLE_1_2_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-19 14:05:02.644 [rpcDispatch_RMROLE_1_3_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:27673667088527376', branchId=27673667088527379, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false}'}
2025-05-19 14:05:02.644 [rpcDispatch_RMROLE_1_3_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:27673667088527376 27673667088527379 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false}
2025-05-19 14:05:02.644 [rpcDispatch_RMROLE_1_3_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-19 14:05:02.653 [rpcDispatch_RMROLE_1_4_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:27673667088527376', branchId=27673667088527380, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false}'}
2025-05-19 14:05:02.653 [rpcDispatch_RMROLE_1_4_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:27673667088527376 27673667088527380 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false}
2025-05-19 14:05:02.653 [rpcDispatch_RMROLE_1_4_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-19 14:05:33.527 [reactor-http-nio-3] INFO  org.reflections.Reflections - Raw response received, length: 2976
2025-05-19 14:05:33.534 [reactor-http-nio-3] WARN  org.reflections.Reflections - Received different chatCompletionId from response: 66bbf2d7-730a-4a21-8fee-a0ef2f76b090 vs prepared: chat-baa5e142-b24d-4c36-8304-2b9664522f2c
2025-05-19 14:05:33.550 [reactor-http-nio-3] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - ==>  Preparing: INSERT INTO chat_completions ( object, created, model, system_fingerprint, api_key ) VALUES ( ?, ?, ?, ?, ? )
2025-05-19 14:05:33.550 [reactor-http-nio-3] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - ==> Parameters: chat.completion(String), 1747634733548(Long), deepseek-chat(String), 689258T(String), chat-baa5e142-b24d-4c36-8304-2b9664522f2c(String)
2025-05-19 14:05:33.563 [reactor-http-nio-3] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - <==    Updates: 1
2025-05-19 14:05:33.563 [reactor-http-nio-3] INFO  com.bgpay.bgai.transaction.TransactionCoordinator - Transaction committed for user 689258T: chatCompletionId=chat-baa5e142-b24d-4c36-8304-2b9664522f2c
2025-05-19 14:05:33.599 [FileWrite-1] INFO  com.bgpay.bgai.service.deepseek.FileWriterService - Successfully wrote content to: \var\data\ai_responses\a67d49ec-757f-4f7b-8e32-6d070b56b713.txt
2025-05-19 14:05:33.608 [boundedElastic-1] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - ==>  Preparing: INSERT INTO chat_completions ( object, created, model, system_fingerprint, api_key ) VALUES ( ?, ?, ?, ?, ? )
2025-05-19 14:05:33.609 [boundedElastic-1] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - ==> Parameters: chat.completion(String), 1747634702(Long), deepseek-chat(String), fp_8802369eaa_prod0425fp8(String), chat-baa5e142-b24d-4c36-8304-2b9664522f2c(String)
2025-05-19 14:05:33.623 [boundedElastic-1] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - <==    Updates: 1
2025-05-19 14:05:33.651 [boundedElastic-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.insert - ==>  Preparing: INSERT INTO usage_info ( chat_completion_id, prompt_tokens, completion_tokens, total_tokens, prompt_tokens_cached, completion_reasoning_tokens, prompt_cache_hit_tokens, prompt_cache_miss_tokens, created_at, model_type ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-05-19 14:05:33.653 [boundedElastic-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.insert - ==> Parameters: chat-baa5e142-b24d-4c36-8304-2b9664522f2c(String), 2209(Integer), 585(Integer), 2794(Integer), 2176(Integer), 0(Integer), 0(Integer), 33(Integer), 2025-05-19T14:05:33.641346600(LocalDateTime), deepseek-chat(String)
2025-05-19 14:05:33.663 [boundedElastic-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.insert - <==    Updates: 1
2025-05-19 14:05:33.679 [boundedElastic-1] INFO  org.reflections.Reflections - Completion data saved synchronously for chatCompletionId: chat-baa5e142-b24d-4c36-8304-2b9664522f2c
2025-05-19 14:05:33.684 [boundedElastic-2] INFO  org.reflections.Reflections - 开始发送账单消息，chatCompletionId: chat-baa5e142-b24d-4c36-8304-2b9664522f2c, userId: 689258T
2025-05-19 14:05:33.732 [boundedElastic-2] INFO  org.reflections.Reflections - 账单消息发送成功，chatCompletionId: chat-baa5e142-b24d-4c36-8304-2b9664522f2c, userId: 689258T
2025-05-19 14:05:33.736 [boundedElastic-1] INFO  org.reflections.Reflections - Complete processing chain completed: The provided file appears to be a Spring Boot application configuration file (likely `application.yml`) with multiple configurations for different components. Here's a summary of the key configurations:

### Core Spring Configurations
1. **Application Basics**
   - Application name: `bgai`
   - Active profile: `dev`
   - Allows bean definition overriding

2. **Database**
   - MySQL master/slave configuration using Druid connection pool
   - Connection details for `8.133.246.113:3306/deepseek`
   - JPA/Hibernate configured with MySQL8 dialect and `ddl-auto: update`

3. **Redis**
   - Single Redis instance at `8.133.246.113:6379`
   - Used for both Spring Session and application cache
   - Password protected

4. **Performance**
   - Async task pool with 50-200 threads
   - HTTP connection limits (max 200 total, 50 per route)
   - File upload limits (200MB)

### External Services
1. **RocketMQ**
   - Name server at `8.133.246.113:9876`
   - Producer/consumer groups for billing
   - Dedicated topic for chat logs

2. **Flink**
   - Job manager at `8.133.246.113:8081`

### Resilience & Reliability
1. **Resilience4j Circuit Breakers**
   - Three configured instances with different thresholds
   - Time limiters for API calls (60s timeout for deepseek API)
   - Retry configurations with exponential backoff

2. **Logging**
   - JSON formatted logs output to `/var/data/ai_responses/application.log`
   - Using Nacos logback configuration

### Security
1. **SSO OAuth2**
   - Client credentials and endpoint URLs
   - All endpoints point to localhost:8080

2. **API Security**
   - Two API keys configured for client authentication

### Special Features
1. **Conversation**
   - Maintains 5 rounds of conversation history (10 messages)

2. **File Processing**
   - Output path for AI responses at `/var/data/ai_responses`
   - Tesseract OCR data path configured

### Notable Security Observations
- All database/Redis/MQ services use the same IP (`8.133.246.113`)
- Passwords are visible in plaintext (MySQL, Redis)
- SSL is disabled for MySQL connections (`useSSL=false`)
- SSO endpoints point to localhost (may need adjustment for production)

This appears to be a backend service handling conversations, possibly with AI capabilities, using Redis for session management, MySQL for persistence, and RocketMQ for asynchronous processing. The resilience configurations suggest it makes external API calls (to Deepseek) that need fault tolerance.
2025-05-19 14:05:33.737 [boundedElastic-1] INFO  com.bgpay.bgai.controller.ReactiveChatController - Processed response for user 689258T, content length: 2456
2025-05-19 14:05:46.581 [pool-7-thread-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.selectCount - ==>  Preparing: SELECT COUNT( * ) AS total FROM usage_info WHERE (chat_completion_id = ?)
2025-05-19 14:05:46.582 [pool-7-thread-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.selectCount - ==> Parameters: chat-baa5e142-b24d-4c36-8304-2b9664522f2c(String)
2025-05-19 14:05:46.588 [pool-7-thread-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.selectCount - <==      Total: 1
2025-05-19 14:05:46.732 [ConsumeMessageThread_billing-consumer-group_1] INFO  c.bgpay.bgai.service.mq.RocketMQBillingServiceImpl - Output price config priceVersion: 1
2025-05-19 14:05:46.734 [ConsumeMessageThread_billing-consumer-group_1] DEBUG com.bgpay.bgai.mapper.UsageRecordMapper.insert - ==>  Preparing: INSERT INTO usage_record ( model_type, chat_completion_id, user_id, input_cost, output_cost, price_version, calculated_at ) VALUES ( ?, ?, ?, ?, ?, ?, ? )
2025-05-19 14:05:46.735 [ConsumeMessageThread_billing-consumer-group_1] DEBUG com.bgpay.bgai.mapper.UsageRecordMapper.insert - ==> Parameters: deepseek-chat(String), chat-baa5e142-b24d-4c36-8304-2b9664522f2c(String), 689258T(String), 0.0001(BigDecimal), 0.0047(BigDecimal), 1(Integer), 2025-05-19T14:05:46.733914400(LocalDateTime)
2025-05-19 14:05:46.761 [ConsumeMessageThread_billing-consumer-group_1] DEBUG com.bgpay.bgai.mapper.UsageRecordMapper.insert - <==    Updates: 1
2025-05-19 14:05:46.772 [ConsumeMessageThread_billing-consumer-group_1] INFO  c.bgpay.bgai.service.mq.RocketMQBillingServiceImpl - Message consumed: 2408820C75288342B4869B724B724BF077F036BAF30C5FB89A8E0000
2025-05-19 14:07:29.684 [Thread-1] WARN  c.alibaba.nacos.common.http.HttpClientBeanHolder - [HttpClientBeanHolder] Start destroying common HttpClient
2025-05-19 14:07:29.685 [Thread-7] WARN  com.alibaba.nacos.common.notify.NotifyCenter - [NotifyCenter] Start destroying Publisher
2025-05-19 14:07:29.685 [Thread-7] WARN  com.alibaba.nacos.common.notify.NotifyCenter - [NotifyCenter] Destruction of the end
2025-05-19 14:07:29.685 [Thread-1] WARN  c.alibaba.nacos.common.http.HttpClientBeanHolder - [HttpClientBeanHolder] Destruction of the end
2025-05-19 14:07:29.702 [NettyClientSelector_TMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - channel inactive: [id: 0x1c4d51a7, L:/192.168.86.8:61022 ! R:/8.133.246.113:8091]
2025-05-19 14:07:29.702 [NettyClientSelector_TMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - return to pool, rm channel:[id: 0x1c4d51a7, L:/192.168.86.8:61022 ! R:/8.133.246.113:8091]
2025-05-19 14:07:29.702 [NettyClientSelector_TMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - channel valid false,channel:[id: 0x1c4d51a7, L:/192.168.86.8:61022 ! R:/8.133.246.113:8091]
2025-05-19 14:07:29.702 [NettyClientSelector_TMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - will destroy channel:[id: 0x1c4d51a7, L:/192.168.86.8:61022 ! R:/8.133.246.113:8091]
2025-05-19 14:07:29.702 [NettyClientSelector_TMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0x1c4d51a7, L:/192.168.86.8:61022 ! R:/8.133.246.113:8091]) will closed
2025-05-19 14:07:29.702 [NettyClientSelector_TMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0x1c4d51a7, L:/192.168.86.8:61022 ! R:/8.133.246.113:8091]) will closed
2025-05-19 14:07:29.703 [NettyClientSelector_RMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - channel inactive: [id: 0x553d6c22, L:/192.168.86.8:61026 ! R:/8.133.246.113:8091]
2025-05-19 14:07:29.703 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - return to pool, rm channel:[id: 0x553d6c22, L:/192.168.86.8:61026 ! R:/8.133.246.113:8091]
2025-05-19 14:07:29.703 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - channel valid false,channel:[id: 0x553d6c22, L:/192.168.86.8:61026 ! R:/8.133.246.113:8091]
2025-05-19 14:07:29.703 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - will destroy channel:[id: 0x553d6c22, L:/192.168.86.8:61026 ! R:/8.133.246.113:8091]
2025-05-19 14:07:29.703 [NettyClientSelector_RMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0x553d6c22, L:/192.168.86.8:61026 ! R:/8.133.246.113:8091]) will closed
2025-05-19 14:07:29.703 [NettyClientSelector_RMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0x553d6c22, L:/192.168.86.8:61026 ! R:/8.133.246.113:8091]) will closed
2025-05-19 14:07:29.705 [SpringContextShutdownHook] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - De-registering from Nacos Server now...
2025-05-19 14:07:29.705 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - [DEREGISTER-SERVICE] d750d92e-152f-4055-a641-3bc9dda85a29 deregistering service bgtech-ai with instance: Instance{instanceId='null', ip='192.168.86.8', port=8080, weight=1.0, healthy=true, enabled=true, ephemeral=true, clusterName='DEFAULT', serviceName='null', metadata={}}
2025-05-19 14:07:29.714 [SpringContextShutdownHook] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - De-registration finished.
2025-05-19 14:07:29.715 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.cache.ServiceInfoHolder do shutdown begin
2025-05-19 14:07:29.715 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.backups.FailoverReactor do shutdown begin
2025-05-19 14:07:29.715 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.backups.FailoverReactor do shutdown stop
2025-05-19 14:07:29.715 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.cache.ServiceInfoHolder do shutdown stop
2025-05-19 14:07:29.715 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.NamingClientProxyDelegate do shutdown begin
2025-05-19 14:07:29.715 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServiceInfoUpdateService do shutdown begin
2025-05-19 14:07:29.715 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServiceInfoUpdateService do shutdown stop
2025-05-19 14:07:29.715 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServerListManager do shutdown begin
2025-05-19 14:07:29.715 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Start destroying NacosRestTemplate
2025-05-19 14:07:29.715 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Destruction of the end
2025-05-19 14:07:29.715 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServerListManager do shutdown stop
2025-05-19 14:07:29.715 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.http.NamingHttpClientProxy do shutdown begin
2025-05-19 14:07:29.715 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Start destroying NacosRestTemplate
2025-05-19 14:07:29.715 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Destruction of the end
2025-05-19 14:07:29.715 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.http.NamingHttpClientProxy do shutdown stop
2025-05-19 14:07:29.715 [SpringContextShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Shutdown rpc client, set status to shutdown
2025-05-19 14:07:29.715 [SpringContextShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Shutdown client event executor java.util.concurrent.ScheduledThreadPoolExecutor@21bac1a8[Running, pool size = 2, active threads = 2, queued tasks = 0, completed tasks = 0]
2025-05-19 14:07:29.715 [SpringContextShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Close current connection 1747634688803_139.227.195.203_42522
2025-05-19 14:07:29.719 [nacos-grpc-client-executor-8.133.246.113-49] WARN  c.a.nacos.common.remote.client.grpc.GrpcClient - [1747634688803_139.227.195.203_42522]Ignore error event,isRunning:false,isAbandon=false
2025-05-19 14:07:29.721 [SpringContextShutdownHook] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - Shutdown grpc executor java.util.concurrent.ThreadPoolExecutor@6c1315c3[Running, pool size = 4, active threads = 0, queued tasks = 0, completed tasks = 50]
2025-05-19 14:07:29.721 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - Shutdown grpc redo service executor java.util.concurrent.ScheduledThreadPoolExecutor@1690283c[Running, pool size = 1, active threads = 0, queued tasks = 1, completed tasks = 53]
2025-05-19 14:07:29.721 [SpringContextShutdownHook] INFO  c.a.n.client.auth.ram.identify.CredentialWatcher - [null] CredentialWatcher is stopped
2025-05-19 14:07:29.721 [SpringContextShutdownHook] INFO  c.a.n.client.auth.ram.identify.CredentialService - [null] CredentialService is freed
2025-05-19 14:07:29.721 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.NamingClientProxyDelegate do shutdown stop
2025-05-19 14:07:31.746 [SpringContextShutdownHook] DEBUG com.bgpay.bgai.config.AsyncConfig$1 - Shutting down ExecutorService 'blockingExecutor'
2025-05-19 14:07:31.792 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:10909] result: true
2025-05-19 14:07:31.792 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:10911] result: true
2025-05-19 14:07:31.792 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:9876] result: true
2025-05-19 14:07:31.807 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:10911] result: true
2025-05-19 14:07:31.807 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:9876] result: true
2025-05-19 14:07:31.916 [SpringContextShutdownHook] INFO  o.s.orm.jpa.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-05-19 14:07:31.918 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-2} closing ...
2025-05-19 14:07:31.925 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-2} closed
2025-05-19 14:07:31.925 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} closing ...
2025-05-19 14:07:31.926 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} closed
2025-05-19 14:54:55.488 [main] WARN  com.alibaba.nacos.client.logging.NacosLogging - Load Logback Configuration of Nacos fail, message: Could not initialize Logback Nacos logging from classpath:nacos-logback.xml
2025-05-19 14:54:55.489 [main] INFO  com.bgpay.bgai.BgaiApplication - The following 1 profile is active: "dev"
2025-05-19 14:54:56.954 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-05-19 14:54:56.955 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-05-19 14:54:56.982 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 20 ms. Found 0 JPA repository interfaces.
2025-05-19 14:54:56.995 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-05-19 14:54:56.996 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-05-19 14:54:57.012 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 6 ms. Found 0 Redis repository interfaces.
2025-05-19 14:54:57.594 [main] INFO  io.seata.config.ConfigurationFactory - load Configuration from :Spring Configuration
2025-05-19 14:54:57.603 [main] INFO  io.seata.config.ConfigurationFactory - load Configuration from :Spring Configuration
2025-05-19 14:54:57.609 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Initializing Global Transaction Clients ... 
2025-05-19 14:54:57.713 [main] INFO  io.seata.core.rpc.netty.NettyClientBootstrap - NettyClientBootstrap has started
2025-05-19 14:54:57.715 [main] INFO  io.seata.discovery.registry.RegistryFactory - use registry center type: file
2025-05-19 14:54:57.731 [main] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - will connect to 8.133.246.113:8091
2025-05-19 14:54:57.739 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - NettyPool create channel to transactionRole:TMROLE,address:8.133.246.113:8091,msg:< RegisterTMRequest{version='1.7.0', applicationId='bgtech-ai', transactionServiceGroup='bgai-tx-group', extraData='ak=null
digest=bgai-tx-group,192.168.86.8,1747637697735
timestamp=1747637697735
authVersion=V4
vgroup=bgai-tx-group
ip=192.168.86.8
'} >
2025-05-19 14:54:57.951 [main] INFO  io.seata.core.rpc.netty.TmNettyRemotingClient - register TM success. client version:1.7.0, server version:1.8.1-SNAPSHOT,channel:[id: 0x86801d26, L:/192.168.86.8:49290 - R:/8.133.246.113:8091]
2025-05-19 14:54:57.957 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - register success, cost 138 ms, version:1.8.1-SNAPSHOT,role:TMROLE,channel:[id: 0x86801d26, L:/192.168.86.8:49290 - R:/8.133.246.113:8091]
2025-05-19 14:54:57.958 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Transaction Manager Client is initialized. applicationId[bgtech-ai] txServiceGroup[bgai-tx-group]
2025-05-19 14:54:57.968 [main] INFO  io.seata.rm.datasource.AsyncWorker - Async Commit Buffer Limit: 10000
2025-05-19 14:54:57.968 [main] INFO  io.seata.rm.datasource.xa.ResourceManagerXA - ResourceManagerXA init ...
2025-05-19 14:54:57.973 [main] INFO  io.seata.core.rpc.netty.NettyClientBootstrap - NettyClientBootstrap has started
2025-05-19 14:54:57.974 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Resource Manager is initialized. applicationId[bgtech-ai] txServiceGroup[bgai-tx-group]
2025-05-19 14:54:57.974 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Global Transaction Clients are initialized. 
2025-05-19 14:54:59.094 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat initialized with port(s): 8080 (http)
2025-05-19 14:54:59.104 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - The ["http-nio-8080"] connector has been configured to support HTTP upgrade to [h2c]
2025-05-19 14:54:59.104 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - Initializing ProtocolHandler ["http-nio-8080"]
2025-05-19 14:54:59.105 [main] INFO  org.apache.catalina.core.StandardService - Starting service [Tomcat]
2025-05-19 14:54:59.105 [main] INFO  org.apache.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.15]
2025-05-19 14:54:59.504 [main] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} inited
2025-05-19 14:54:59.752 [main] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - will connect to 8.133.246.113:8091
2025-05-19 14:54:59.752 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - RM will register :jdbc:mysql://8.133.246.113:3306/deepseek
2025-05-19 14:54:59.752 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - NettyPool create channel to transactionRole:RMROLE,address:8.133.246.113:8091,msg:< RegisterRMRequest{resourceIds='jdbc:mysql://8.133.246.113:3306/deepseek', version='1.7.0', applicationId='bgtech-ai', transactionServiceGroup='bgai-tx-group', extraData='null'} >
2025-05-19 14:54:59.808 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - register RM success. client version:1.7.0, server version:1.8.1-SNAPSHOT,channel:[id: 0xcc5a1de7, L:/192.168.86.8:49292 - R:/8.133.246.113:8091]
2025-05-19 14:54:59.809 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - register success, cost 48 ms, version:1.8.1-SNAPSHOT,role:RMROLE,channel:[id: 0xcc5a1de7, L:/192.168.86.8:49292 - R:/8.133.246.113:8091]
2025-05-19 14:54:59.810 [main] INFO  i.s.s.a.datasource.SeataAutoDataSourceProxyCreator - Auto proxy data source 'masterDataSource' by 'AT' mode.
2025-05-19 14:54:59.877 [main] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-2} inited
2025-05-19 14:54:59.946 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - will register resourceId:jdbc:mysql://8.133.246.113:3306/deepseek
2025-05-19 14:54:59.947 [main] INFO  i.s.s.a.datasource.SeataAutoDataSourceProxyCreator - Auto proxy data source 'slaveDataSource' by 'AT' mode.
2025-05-19 14:54:59.957 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.rm.AbstractRMHandler - the rm client received response msg [RegisterRMResponse{version='1.8.1-SNAPSHOT', extraData='null', identified=true, resultCode=null, msg='null'}] from tc server.
2025-05-19 14:54:59.980 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - will register resourceId:jdbc:mysql://8.133.246.113:3306/deepseek
2025-05-19 14:54:59.981 [main] INFO  i.s.s.a.datasource.SeataAutoDataSourceProxyCreator - Auto proxy data source 'dynamicDataSource' by 'AT' mode.
2025-05-19 14:54:59.991 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.rm.AbstractRMHandler - the rm client received response msg [RegisterRMResponse{version='1.8.1-SNAPSHOT', extraData='null', identified=true, resultCode=null, msg='null'}] from tc server.
2025-05-19 14:55:00.108 [main] INFO  org.hibernate.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-05-19 14:55:00.173 [main] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.1.7.Final
2025-05-19 14:55:00.505 [main] INFO  SQL dialect - HHH000400: Using dialect: org.hibernate.dialect.MySQL8Dialect
2025-05-19 14:55:00.507 [main] WARN  org.hibernate.orm.deprecation - HHH90000026: MySQL8Dialect has been deprecated; use org.hibernate.dialect.MySQLDialect instead
2025-05-19 14:55:00.916 [main] INFO  o.h.e.t.jta.platform.internal.JtaPlatformInitiator - HHH000490: Using JtaPlatform implementation: [org.hibernate.engine.transaction.jta.platform.internal.NoJtaPlatform]
2025-05-19 14:55:00.927 [main] INFO  o.s.orm.jpa.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-05-19 14:55:01.297 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-19 14:55:01.313 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-19 14:55:01.354 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-19 14:55:01.357 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-19 14:55:01.357 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-19 14:55:01.381 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-19 14:55:01.990 [main] INFO  com.bgpay.bgai.service.impl.UserServiceImpl - 初始化SSO配置: clientId=bgai-client-id, redirectUri=http://localhost:8080/api/auth/callback
2025-05-19 14:55:02.121 [main] INFO  com.bgpay.bgai.controller.AuthController - 初始化认证控制器: clientId=bgai-client-id, redirectUri=http://localhost:8080/api/auth/callback
2025-05-19 14:55:02.705 [main] INFO  o.a.r.s.autoconfigure.RocketMQAutoConfiguration - a producer (billing-producer-group) init on namesrv 8.133.246.113:9876
2025-05-19 14:55:02.991 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Bean [com.bgpay.bgai.service.deepseek.DeepSeekServiceImp$$SpringCGLIB$$0] with name [deepSeekServiceImp] would use interceptor [io.seata.spring.annotation.GlobalTransactionalInterceptor]
2025-05-19 14:55:03.317 [main] WARN  i.s.s.b.a.provider.SpringBootConfigurationProvider - The get method not found for the field 'SeataProperties#accesskey'.
2025-05-19 14:55:03.317 [main] WARN  i.s.s.b.a.provider.SpringBootConfigurationProvider - The get method not found for the field 'SeataProperties#secretkey'.
2025-05-19 14:55:03.328 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 加载到1个Saga状态机定义文件
2025-05-19 14:55:03.468 [main] INFO  com.bgpay.bgai.saga.CustomSagaJsonParser - 开始解析状态机定义: bgai-saga-transaction
2025-05-19 14:55:03.469 [main] INFO  com.bgpay.bgai.saga.CustomSagaJsonParser - 状态机定义解析成功: bgai-saga-transaction
2025-05-19 14:55:03.469 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 成功加载状态机定义: /E:/project/bgai/target/classes/statelang/bgai-saga-transaction.json
2025-05-19 14:55:04.072 [main] INFO  org.redisson.Version - Redisson 3.24.3
2025-05-19 14:55:04.214 [redisson-netty-4-6] INFO  o.r.connection.pool.MasterPubSubConnectionPool - 1 connections initialized for 8.133.246.113/8.133.246.113:6379
2025-05-19 14:55:04.563 [redisson-netty-4-19] INFO  org.redisson.connection.pool.MasterConnectionPool - 24 connections initialized for 8.133.246.113/8.133.246.113:6379
2025-05-19 14:55:04.846 [main] INFO  com.bgpay.bgai.service.mq.MQConsumerService - MQ consumer startup successful [group=billing-consumer-group, topic=BILLING_TOPIC, tag=USER_BILLING]
2025-05-19 14:55:04.995 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Bean [com.bgpay.bgai.service.impl.SeataTransactionService$$SpringCGLIB$$0] with name [seataTransactionService] would use interceptor [io.seata.spring.annotation.GlobalTransactionalInterceptor]
2025-05-19 14:55:05.118 [main] DEBUG com.bgpay.bgai.config.AsyncConfig$1 - Initializing ExecutorService 'blockingExecutor'
2025-05-19 14:55:06.510 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [After]
2025-05-19 14:55:06.511 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Before]
2025-05-19 14:55:06.511 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Between]
2025-05-19 14:55:06.511 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Cookie]
2025-05-19 14:55:06.511 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Header]
2025-05-19 14:55:06.511 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Host]
2025-05-19 14:55:06.511 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Method]
2025-05-19 14:55:06.511 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Path]
2025-05-19 14:55:06.511 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Query]
2025-05-19 14:55:06.511 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [ReadBody]
2025-05-19 14:55:06.511 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [RemoteAddr]
2025-05-19 14:55:06.511 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [XForwardedRemoteAddr]
2025-05-19 14:55:06.511 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Weight]
2025-05-19 14:55:06.511 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [CloudFoundryRouteService]
2025-05-19 14:55:07.926 [main] INFO  o.s.b.actuate.endpoint.web.EndpointLinksResolver - Exposing 1 endpoint(s) beneath base path '/actuator'
2025-05-19 14:55:08.279 [main] WARN  i.s.s.b.a.provider.SpringBootConfigurationProvider - The get method not found for the field 'SeataProperties#accesskey'.
2025-05-19 14:55:08.279 [main] WARN  i.s.s.b.a.provider.SpringBootConfigurationProvider - The get method not found for the field 'SeataProperties#secretkey'.
2025-05-19 14:55:08.292 [main] INFO  io.seata.saga.tm.DefaultSagaTransactionalTemplate - Initializing Global Transaction Clients ... 
2025-05-19 14:55:08.293 [main] INFO  io.seata.saga.tm.DefaultSagaTransactionalTemplate - Transaction Manager Client is initialized. applicationId[bgtech-ai] txServiceGroup[bgai-tx-group]
2025-05-19 14:55:08.293 [main] INFO  io.seata.saga.tm.DefaultSagaTransactionalTemplate - Resource Manager is initialized. applicationId[bgtech-ai] txServiceGroup[bgai-tx-group]
2025-05-19 14:55:08.293 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - will register resourceId:bgtech-ai#bgai-tx-group
2025-05-19 14:55:08.293 [main] INFO  io.seata.saga.tm.DefaultSagaTransactionalTemplate - Global Transaction Clients are initialized. 
2025-05-19 14:55:08.303 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.rm.AbstractRMHandler - the rm client received response msg [RegisterRMResponse{version='1.8.1-SNAPSHOT', extraData='null', identified=true, resultCode=null, msg='null'}] from tc server.
2025-05-19 14:55:09.558 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - Starting ProtocolHandler ["http-nio-8080"]
2025-05-19 14:55:09.573 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat started on port(s): 8080 (http) with context path ''
2025-05-19 14:55:09.583 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from ans.namespace attribute : null
2025-05-19 14:55:09.583 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from ALIBABA_ALIWARE_NAMESPACE attribute :null
2025-05-19 14:55:09.584 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from namespace attribute :null
2025-05-19 14:55:09.592 [main] INFO  c.a.n.p.auth.spi.client.ClientAuthPluginManager - [ClientAuthPluginManager] Load ClientAuthService com.alibaba.nacos.client.auth.impl.NacosClientAuthServiceImpl success.
2025-05-19 14:55:09.593 [main] INFO  c.a.n.p.auth.spi.client.ClientAuthPluginManager - [ClientAuthPluginManager] Load ClientAuthService com.alibaba.nacos.client.auth.ram.RamClientAuthServiceImpl success.
2025-05-19 14:55:09.596 [main] INFO  com.alibaba.nacos.common.remote.client - [RpcClientFactory] create a new rpc client of 6452717d-acea-45f2-94bf-522b70fd7580
2025-05-19 14:55:09.598 [main] INFO  com.alibaba.nacos.common.remote.client - [6452717d-acea-45f2-94bf-522b70fd7580] RpcClient init, ServerListFactory = com.alibaba.nacos.client.naming.core.ServerListManager
2025-05-19 14:55:09.598 [main] INFO  com.alibaba.nacos.common.remote.client - [6452717d-acea-45f2-94bf-522b70fd7580] Registry connection listener to current client:com.alibaba.nacos.client.naming.remote.gprc.redo.NamingGrpcRedoService
2025-05-19 14:55:09.598 [main] INFO  com.alibaba.nacos.common.remote.client - [6452717d-acea-45f2-94bf-522b70fd7580] Register server push request handler:com.alibaba.nacos.client.naming.remote.gprc.NamingPushRequestHandler
2025-05-19 14:55:09.598 [main] INFO  com.alibaba.nacos.common.remote.client - [6452717d-acea-45f2-94bf-522b70fd7580] Try to connect to server on start up, server: {serverIp = '8.133.246.113', server main port = 8848}
2025-05-19 14:55:09.599 [main] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - grpc client connection server:8.133.246.113 ip,serverPort:9848,grpcTslConfig:{"sslProvider":"OPENSSL","enableTls":false,"mutualAuthEnable":false,"trustAll":false}
2025-05-19 14:55:09.731 [main] INFO  com.alibaba.nacos.common.remote.client - [6452717d-acea-45f2-94bf-522b70fd7580] Success to connect to server [8.133.246.113:8848] on start up, connectionId = 1747637709623_139.227.195.203_43005
2025-05-19 14:55:09.731 [main] INFO  com.alibaba.nacos.common.remote.client - [6452717d-acea-45f2-94bf-522b70fd7580] Register server push request handler:com.alibaba.nacos.common.remote.client.RpcClient$ConnectResetRequestHandler
2025-05-19 14:55:09.731 [main] INFO  com.alibaba.nacos.common.remote.client - [6452717d-acea-45f2-94bf-522b70fd7580] Register server push request handler:com.alibaba.nacos.common.remote.client.RpcClient$$Lambda/0x00000218da56dc70
2025-05-19 14:55:09.731 [com.alibaba.nacos.client.remote.worker] INFO  com.alibaba.nacos.common.remote.client - [6452717d-acea-45f2-94bf-522b70fd7580] Notify connected event to listeners.
2025-05-19 14:55:09.731 [com.alibaba.nacos.client.remote.worker] INFO  com.alibaba.nacos.client.naming - Grpc connection connect
2025-05-19 14:55:09.732 [main] INFO  com.alibaba.nacos.client.naming - [REGISTER-SERVICE] d750d92e-152f-4055-a641-3bc9dda85a29 registering service bgtech-ai with instance Instance{instanceId='null', ip='192.168.86.8', port=8080, weight=1.0, healthy=true, enabled=true, ephemeral=true, clusterName='DEFAULT', serviceName='null', metadata={IPv6=[2408:820c:7528:8342:b486:9b72:4b72:4bf0], preserved.register.source=SPRING_CLOUD}}
2025-05-19 14:55:09.761 [main] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - nacos registry, DEFAULT_GROUP bgtech-ai 192.168.86.8:8080 register finished
2025-05-19 14:55:09.819 [main] INFO  com.bgpay.bgai.BgaiApplication - Started BgaiApplication in 16.512 seconds (process running for 17.915)
2025-05-19 14:55:09.823 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-19 14:55:09.823 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-19 14:55:09.837 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-19 14:55:09.837 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-19 14:55:09.838 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-19 14:55:09.854 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-19 14:55:09.855 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-19 14:55:09.855 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-19 14:55:09.863 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-19 14:55:09.864 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-19 14:55:09.865 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-19 14:55:09.873 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-19 14:55:09.874 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - ==================== Saga状态机加载报告 ====================
2025-05-19 14:55:09.874 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - Saga状态机配置加载状态: 成功
2025-05-19 14:55:09.874 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 已加载的状态机定义文件数量: 1
2025-05-19 14:55:09.874 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 已加载的状态机定义文件:
2025-05-19 14:55:09.874 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig -  - /E:/project/bgai/target/classes/statelang/bgai-saga-transaction.json
2025-05-19 14:55:09.874 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - Saga解析器状态: CUSTOM_FASTJSON2
2025-05-19 14:55:09.874 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 状态机解析结果: 成功 1 个, 失败 0 个
2025-05-19 14:55:09.874 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - =============================================================
2025-05-19 14:55:09.878 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - nacos.cache.data.init.snapshot = true 
2025-05-19 14:55:09.878 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] common-dev.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-19 14:55:09.886 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=common-dev.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-19 14:55:09.887 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=common-dev.yaml, group=DEFAULT_GROUP
2025-05-19 14:55:09.887 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-19 14:55:09.887 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-19 14:55:09.887 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai.yaml, group=DEFAULT_GROUP
2025-05-19 14:55:09.888 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai-dev.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-19 14:55:09.888 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai-dev.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-19 14:55:09.888 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai-dev.yaml, group=DEFAULT_GROUP
2025-05-19 14:55:09.888 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-19 14:55:09.888 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai, group=DEFAULT_GROUP, cnt=1
2025-05-19 14:55:09.888 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai, group=DEFAULT_GROUP
2025-05-19 14:55:29.953 [http-nio-8080-exec-2] DEBUG com.bgpay.bgai.filter.ApiKeyAuthenticationFilter - Skipping API Key validation for excluded path: /auth/authorize
2025-05-19 14:55:29.976 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.MockAuthController - Authorization request: client_id=bgai-client-id, redirect_uri=http://localhost:8080/api/auth/callback, response_type=code
2025-05-19 14:55:40.453 [http-nio-8080-exec-4] DEBUG com.bgpay.bgai.filter.ApiKeyAuthenticationFilter - Skipping API Key validation for excluded path: /api/auth/callback
2025-05-19 14:55:40.490 [http-nio-8080-exec-5] DEBUG com.bgpay.bgai.filter.ApiKeyAuthenticationFilter - Skipping API Key validation for excluded path: /auth/token
2025-05-19 14:55:40.493 [http-nio-8080-exec-5] INFO  com.bgpay.bgai.controller.MockAuthController - Token request: grant_type=null, code=null, client_id=null
2025-05-19 14:55:40.519 [http-nio-8080-exec-6] DEBUG com.bgpay.bgai.filter.ApiKeyAuthenticationFilter - Skipping API Key validation for excluded path: /auth/userinfo
2025-05-19 14:55:40.528 [http-nio-8080-exec-4] DEBUG com.bgpay.bgai.mapper.UserMapper.findByUserId - ==>  Preparing: SELECT * FROM t_user WHERE user_id = ?
2025-05-19 14:55:40.530 [http-nio-8080-exec-4] DEBUG com.bgpay.bgai.mapper.UserMapper.findByUserId - ==> Parameters: 689258T(String)
2025-05-19 14:55:40.549 [http-nio-8080-exec-4] DEBUG com.bgpay.bgai.mapper.UserMapper.findByUserId - <==      Total: 1
2025-05-19 14:55:40.623 [http-nio-8080-exec-4] DEBUG com.bgpay.bgai.mapper.UserMapper.updateById - ==>  Preparing: UPDATE t_user SET user_id=?, username=?, email=?, avatar_url=?, last_login_time=?, access_token=?, refresh_token=?, token_expire_time=?, status=?, create_time=?, update_time=? WHERE id=?
2025-05-19 14:55:40.627 [http-nio-8080-exec-4] DEBUG com.bgpay.bgai.mapper.UserMapper.updateById - ==> Parameters: 689258T(String), 测试用户(String), test@example.com(String), https://ui-avatars.com/api/?name=测试用户(String), 2025-05-19T14:55:40.549714100(LocalDateTime), d6edc3ea-cdaf-47d8-952d-4704c668a5a0(String), 7cdd742f-8ceb-480f-bae6-4c59826a1e80(String), 2025-05-19T15:55:40.549714100(LocalDateTime), 1(Integer), 2025-04-26T23:59:16(LocalDateTime), 2025-05-19T14:55:40.549714100(LocalDateTime), 1(Long)
2025-05-19 14:55:40.645 [http-nio-8080-exec-4] DEBUG com.bgpay.bgai.mapper.UserMapper.updateById - <==    Updates: 1
2025-05-19 14:56:10.904 [http-nio-8080-exec-7] INFO  com.bgpay.bgai.controller.ReactiveChatController - 接收到请求: /api/chatGatWay-internal, 文件=新文件 17.txt, 问题参数=null, 模型参数=null
2025-05-19 14:56:10.905 [http-nio-8080-exec-7] INFO  com.bgpay.bgai.controller.ReactiveChatController - 请求Content-Type: multipart/form-data;boundary=--------------------------465532750738859146918548
2025-05-19 14:56:10.905 [http-nio-8080-exec-7] INFO  com.bgpay.bgai.controller.ReactiveChatController - 收集到的完整参数: question="null", apiUrl="null", modelName="null", multiTurn=false
2025-05-19 14:56:10.906 [http-nio-8080-exec-7] INFO  com.bgpay.bgai.controller.ReactiveChatController - Processing request for user ID: 689258T
2025-05-19 14:56:10.907 [http-nio-8080-exec-7] INFO  com.bgpay.bgai.controller.ReactiveChatController - Processing file with circuit breaker: fileName=新文件 17.txt, question=
2025-05-19 14:56:10.909 [http-nio-8080-exec-7] INFO  com.bgpay.bgai.config.ReactiveFileProcessor - Processing file: 新文件 17.txt, content-type: text/plain
2025-05-19 14:56:10.916 [http-nio-8080-exec-7] INFO  com.bgpay.bgai.controller.ReactiveChatController - PARAM TRACE [689258T]: 尝试查找匹配配置 - 参数: apiUrl=null, modelName=null
2025-05-19 14:56:10.928 [http-nio-8080-exec-7] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 查询配置 - userId=689258T
2025-05-19 14:56:10.929 [http-nio-8080-exec-7] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 排序方式 - 按ID降序
2025-05-19 14:56:10.929 [http-nio-8080-exec-7] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 限制结果数 - LIMIT 1
2025-05-19 14:56:10.941 [http-nio-8080-exec-7] DEBUG com.bgpay.bgai.mapper.ApiConfigMapper.selectList - ==>  Preparing: SELECT id,api_url,api_key,model_name,user_id FROM api_config WHERE (user_id = ?) ORDER BY id DESC LIMIT 1
2025-05-19 14:56:10.941 [http-nio-8080-exec-7] DEBUG com.bgpay.bgai.mapper.ApiConfigMapper.selectList - ==> Parameters: 689258T(String)
2025-05-19 14:56:10.958 [http-nio-8080-exec-7] DEBUG com.bgpay.bgai.mapper.ApiConfigMapper.selectList - <==      Total: 1
2025-05-19 14:56:10.958 [http-nio-8080-exec-7] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 查询结果 - 找到配置: id=2, modelName=deepseek-chat
2025-05-19 14:56:10.958 [http-nio-8080-exec-7] INFO  com.bgpay.bgai.controller.ReactiveChatController - PARAM TRACE [689258T]: 找到匹配配置 - apiUrl=https://api.deepseek.com/chat/completions, modelName=deepseek-chat (原始请求: null)
2025-05-19 14:56:10.958 [http-nio-8080-exec-7] INFO  com.bgpay.bgai.controller.ReactiveChatController - API config resolved: url=https://api.deepseek.com/chat/completions, model=deepseek-chat
2025-05-19 14:56:10.976 [Thread-57] INFO  com.bgpay.bgai.config.ReactiveFileProcessor - File processed successfully: size=6680 bytes
2025-05-19 14:56:10.982 [Thread-57] INFO  com.bgpay.bgai.controller.ReactiveChatController - Content processed, length: 6603
2025-05-19 14:56:10.988 [Thread-57] INFO  io.seata.tm.TransactionManagerHolder - TransactionManager Singleton io.seata.tm.DefaultTransactionManager@40a9e3aa
2025-05-19 14:56:11.018 [Thread-57] INFO  io.seata.tm.api.DefaultGlobalTransaction - Begin new global transaction [seata-server:8091:63702487474642945]
2025-05-19 14:56:11.020 [Thread-57] INFO  c.b.bgai.interceptor.SeataTransactionInterceptor - 准备记录分布式事务开始: XID=seata-server:8091:63702487474642945, 业务=com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive, 路径=, IP=, 用户=system
2025-05-19 14:56:11.030 [Thread-57] INFO  c.b.bgai.service.impl.TransactionLogServiceImpl - 记录分布式事务开始: XID=seata-server:8091:63702487474642945, 业务=com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive
2025-05-19 14:56:11.034 [Thread-57] DEBUG com.bgpay.bgai.mapper.TransactionLogMapper.insert - ==>  Preparing: INSERT INTO transaction_log ( xid, transaction_name, transaction_mode, status, request_path, source_ip, start_time, user_id, create_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-05-19 14:56:11.038 [Thread-57] DEBUG com.bgpay.bgai.mapper.TransactionLogMapper.insert - ==> Parameters: seata-server:8091:63702487474642945(String), com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive(String), AT(String), ACTIVE(String), (String), (String), 2025-05-19T14:56:11.030602800(LocalDateTime), system(String), 2025-05-19T14:56:11.030602800(LocalDateTime)
2025-05-19 14:56:11.443 [Thread-57] DEBUG com.bgpay.bgai.mapper.TransactionLogMapper.insert - <==    Updates: 1
2025-05-19 14:56:11.471 [Thread-57] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:63702487474642945, branchId:63702487474642946, lockKeys:transaction_log:5
2025-05-19 14:56:11.482 [Thread-57] WARN  i.s.c.l.EnhancedServiceLoader$InnerEnhancedServiceLoader - Load [io.seata.rm.datasource.undo.parser.ProtostuffUndoLogParser] class fail: io/protostuff/runtime/IdStrategy
2025-05-19 14:56:11.541 [Thread-57] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:63702487474642945, branchId:63702487474642947, lockKeys:transaction_log:5;undo_log:17
2025-05-19 14:56:11.566 [Thread-57] INFO  c.b.bgai.interceptor.SeataTransactionInterceptor - 开始分布式事务: XID=seata-server:8091:63702487474642945, 方法=com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive
2025-05-19 14:56:11.576 [Thread-57] INFO  org.reflections.Reflections - Processing reactive request: content length=6603, apiUrl=https://api.deepseek.com/chat/completions, modelName=deepseek-chat, userId=689258T, multiTurn=false
2025-05-19 14:56:11.596 [Thread-57] INFO  com.bgpay.bgai.transaction.TransactionCoordinator - Transaction prepared for user 689258T: chatCompletionId=chat-851db730-86bc-4219-ba44-8efad1f4512c
2025-05-19 14:56:11.598 [Thread-57] INFO  org.reflections.Reflections - Generated request JSON with 2PC transaction: {"stream":false,"max_tokens":2000,"temperature":1.0,"messages":[{"role":"system","content":"You are ...
2025-05-19 14:56:11.615 [Thread-57] INFO  c.b.bgai.service.impl.TransactionLogServiceImpl - 记录分布式事务结束: XID=seata-server:8091:63702487474642945, 状态=COMMITTED
2025-05-19 14:56:11.616 [Thread-57] DEBUG c.b.bgai.mapper.TransactionLogMapper.selectList - ==>  Preparing: SELECT id,xid,branch_id,transaction_name,transaction_mode,status,request_path,source_ip,start_time,end_time,user_id,extra_data,create_time,update_time FROM transaction_log WHERE (xid = ?) LIMIT 1
2025-05-19 14:56:11.618 [Thread-57] DEBUG c.b.bgai.mapper.TransactionLogMapper.selectList - ==> Parameters: seata-server:8091:63702487474642945(String)
2025-05-19 14:56:11.626 [Thread-57] DEBUG c.b.bgai.mapper.TransactionLogMapper.selectList - <==      Total: 1
2025-05-19 14:56:11.629 [Thread-57] DEBUG c.b.bgai.mapper.TransactionLogMapper.updateById - ==>  Preparing: UPDATE transaction_log SET xid=?, transaction_name=?, transaction_mode=?, status=?, request_path=?, source_ip=?, start_time=?, end_time=?, user_id=?, extra_data=?, create_time=?, update_time=? WHERE id=?
2025-05-19 14:56:11.634 [Thread-57] DEBUG c.b.bgai.mapper.TransactionLogMapper.updateById - ==> Parameters: seata-server:8091:63702487474642945(String), com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive(String), AT(String), COMMITTED(String), (String), (String), 2025-05-19T14:56:11(LocalDateTime), 2025-05-19T14:56:11.626761900(LocalDateTime), system(String), {"duration":42,"result":"success"}(String), 2025-05-19T14:56:11(LocalDateTime), 2025-05-19T14:56:11.626761900(LocalDateTime), 5(Long)
2025-05-19 14:56:11.676 [Thread-57] DEBUG c.b.bgai.mapper.TransactionLogMapper.updateById - <==    Updates: 1
2025-05-19 14:56:11.697 [Thread-57] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:63702487474642945, branchId:63702487474642948, lockKeys:transaction_log:5
2025-05-19 14:56:11.728 [Thread-57] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:63702487474642945, branchId:63702487474642949, lockKeys:undo_log:19;transaction_log:5
2025-05-19 14:56:11.768 [Thread-57] INFO  c.b.bgai.interceptor.SeataTransactionInterceptor - 分布式事务成功完成: XID=seata-server:8091:63702487474642945, 耗时=42ms
2025-05-19 14:56:11.768 [Thread-57] INFO  io.seata.tm.api.DefaultGlobalTransaction - transaction seata-server:8091:63702487474642945 will be commit
2025-05-19 14:56:11.784 [Thread-57] INFO  io.seata.tm.api.DefaultGlobalTransaction - transaction end, xid = seata-server:8091:63702487474642945
2025-05-19 14:56:11.784 [Thread-57] INFO  io.seata.tm.api.DefaultGlobalTransaction - [seata-server:8091:63702487474642945] commit status: Committed
2025-05-19 14:56:12.068 [rpcDispatch_RMROLE_1_1_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:63702487474642945', branchId=63702487474642946, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false,"skipCheckLock":true}'}
2025-05-19 14:56:12.070 [rpcDispatch_RMROLE_1_1_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:63702487474642945 63702487474642946 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false,"skipCheckLock":true}
2025-05-19 14:56:12.071 [rpcDispatch_RMROLE_1_1_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-19 14:56:12.094 [rpcDispatch_RMROLE_1_2_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:63702487474642945', branchId=63702487474642947, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false,"skipCheckLock":true}'}
2025-05-19 14:56:12.094 [rpcDispatch_RMROLE_1_2_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:63702487474642945 63702487474642947 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false,"skipCheckLock":true}
2025-05-19 14:56:12.094 [rpcDispatch_RMROLE_1_2_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-19 14:56:12.119 [rpcDispatch_RMROLE_1_3_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:63702487474642945', branchId=63702487474642948, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false}'}
2025-05-19 14:56:12.119 [rpcDispatch_RMROLE_1_3_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:63702487474642945 63702487474642948 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false}
2025-05-19 14:56:12.119 [rpcDispatch_RMROLE_1_3_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-19 14:56:12.132 [rpcDispatch_RMROLE_1_4_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:63702487474642945', branchId=63702487474642949, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false}'}
2025-05-19 14:56:12.132 [rpcDispatch_RMROLE_1_4_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:63702487474642945 63702487474642949 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false}
2025-05-19 14:56:12.132 [rpcDispatch_RMROLE_1_4_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-19 14:56:37.605 [reactor-http-nio-3] INFO  org.reflections.Reflections - Raw response received, length: 2506
2025-05-19 14:56:37.611 [reactor-http-nio-3] WARN  org.reflections.Reflections - Received different chatCompletionId from response: d011a7bc-fa15-49f2-9eb1-764f6b607182 vs prepared: chat-851db730-86bc-4219-ba44-8efad1f4512c
2025-05-19 14:56:37.628 [reactor-http-nio-3] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - ==>  Preparing: INSERT INTO chat_completions ( object, created, model, system_fingerprint, api_key ) VALUES ( ?, ?, ?, ?, ? )
2025-05-19 14:56:37.628 [reactor-http-nio-3] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - ==> Parameters: chat.completion(String), 1747637797626(Long), deepseek-chat(String), 689258T(String), chat-851db730-86bc-4219-ba44-8efad1f4512c(String)
2025-05-19 14:56:37.644 [reactor-http-nio-3] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - <==    Updates: 1
2025-05-19 14:56:37.644 [reactor-http-nio-3] INFO  com.bgpay.bgai.transaction.TransactionCoordinator - Transaction committed for user 689258T: chatCompletionId=chat-851db730-86bc-4219-ba44-8efad1f4512c
2025-05-19 14:56:37.661 [FileWrite-1] INFO  com.bgpay.bgai.service.deepseek.FileWriterService - Successfully wrote content to: \var\data\ai_responses\152b97a5-9c91-40fb-9bfa-c3e50903a080.txt
2025-05-19 14:56:37.665 [boundedElastic-1] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - ==>  Preparing: INSERT INTO chat_completions ( object, created, model, system_fingerprint, api_key ) VALUES ( ?, ?, ?, ?, ? )
2025-05-19 14:56:37.666 [boundedElastic-1] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - ==> Parameters: chat.completion(String), 1747637772(Long), deepseek-chat(String), fp_8802369eaa_prod0425fp8(String), chat-851db730-86bc-4219-ba44-8efad1f4512c(String)
2025-05-19 14:56:37.674 [boundedElastic-1] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - <==    Updates: 1
2025-05-19 14:56:37.696 [boundedElastic-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.insert - ==>  Preparing: INSERT INTO usage_info ( chat_completion_id, prompt_tokens, completion_tokens, total_tokens, prompt_tokens_cached, completion_reasoning_tokens, prompt_cache_hit_tokens, prompt_cache_miss_tokens, created_at, model_type ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-05-19 14:56:37.697 [boundedElastic-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.insert - ==> Parameters: chat-851db730-86bc-4219-ba44-8efad1f4512c(String), 2209(Integer), 441(Integer), 2650(Integer), 2176(Integer), 0(Integer), 0(Integer), 33(Integer), 2025-05-19T14:56:37.690243500(LocalDateTime), deepseek-chat(String)
2025-05-19 14:56:37.713 [boundedElastic-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.insert - <==    Updates: 1
2025-05-19 14:56:37.726 [boundedElastic-1] INFO  org.reflections.Reflections - Completion data saved synchronously for chatCompletionId: chat-851db730-86bc-4219-ba44-8efad1f4512c
2025-05-19 14:56:37.730 [boundedElastic-2] INFO  org.reflections.Reflections - 开始发送账单消息，chatCompletionId: chat-851db730-86bc-4219-ba44-8efad1f4512c, userId: 689258T
2025-05-19 14:56:37.789 [boundedElastic-2] INFO  org.reflections.Reflections - 账单消息发送成功，chatCompletionId: chat-851db730-86bc-4219-ba44-8efad1f4512c, userId: 689258T
2025-05-19 14:56:37.791 [boundedElastic-1] INFO  org.reflections.Reflections - Complete processing chain completed: # Analysis of the Configuration File

This appears to be a Spring Boot application configuration file (likely `application.yml`) with multiple sections configuring various aspects of the application. Here's a breakdown of the key configurations:

## Core Spring Configurations
- Application name: `bgai`
- Active profile: `dev`
- Bean definition overriding is allowed
- Session management is configured to use none (no session persistence)
- File upload limits set to 200MB

## Database Configurations
- **MySQL**: 
  - Master/slave setup with identical connection details (likely for read/write separation)
  - Using Druid connection pool with detailed pool settings
  - Connection to `8.133.246.113:3306/deepseek`
  
- **Redis**:
  - Single instance at `8.133.246.113:6379`
  - Password protected
  - Used for both Spring Session and application cache

## Framework Integrations
- **JPA/Hibernate**: Configured for MySQL8 with auto-update DDL
- **MyBatis-Plus**: With underscore to camelCase mapping and logging
- **RocketMQ**: Message queue configuration for producer/consumer groups
- **Flink**: Job manager connection details

## Application-Specific Configurations
- Conversation settings (max 5 rounds/10 messages)
- File output path for AI responses at `/var/data/ai_responses`
- DeepSeek API timeout (120s) and retry settings
- SSO/OAuth2 configuration for authentication

## Resilience and Performance
- Circuit breakers (Resilience4j) for API failures
- Thread pool configuration for async tasks
- HTTP connection pooling settings

## Security Notes
- Contains sensitive credentials for:
  - MySQL database (username/password)
  - Redis (password)
  - SSO client (client-id/secret)
  - API keys for client authentication

This configuration suggests a fairly complex application with multiple integration points, database access, message queuing, and resilience patterns implemented. The presence of both JPA and MyBatis-Plus indicates possible mixed persistence approaches in the application.
2025-05-19 14:56:37.791 [boundedElastic-1] INFO  com.bgpay.bgai.controller.ReactiveChatController - Processed response for user 689258T, content length: 2004
2025-05-19 14:56:49.608 [pool-7-thread-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.selectCount - ==>  Preparing: SELECT COUNT( * ) AS total FROM usage_info WHERE (chat_completion_id = ?)
2025-05-19 14:56:49.608 [pool-7-thread-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.selectCount - ==> Parameters: chat-851db730-86bc-4219-ba44-8efad1f4512c(String)
2025-05-19 14:56:49.616 [pool-7-thread-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.selectCount - <==      Total: 1
2025-05-19 14:56:49.703 [ConsumeMessageThread_billing-consumer-group_1] DEBUG c.bgpay.bgai.mapper.PriceConfigMapper.selectList - ==>  Preparing: SELECT id,model_type,time_period,cache_status,io_type,price,version,effective_time FROM price_config WHERE (model_type = ? AND time_period = ? AND io_type = ? AND effective_time <= ? AND cache_status = ?) ORDER BY effective_time DESC LIMIT 1
2025-05-19 14:56:49.704 [ConsumeMessageThread_billing-consumer-group_1] DEBUG c.bgpay.bgai.mapper.PriceConfigMapper.selectList - ==> Parameters: deepseek-chat(String), standard(String), input(String), 2025-05-19T14:56:49.702612900(LocalDateTime), miss(String)
2025-05-19 14:56:49.716 [ConsumeMessageThread_billing-consumer-group_1] DEBUG c.bgpay.bgai.mapper.PriceConfigMapper.selectList - <==      Total: 1
2025-05-19 14:56:49.769 [ConsumeMessageThread_billing-consumer-group_1] DEBUG c.bgpay.bgai.mapper.PriceConfigMapper.selectList - ==>  Preparing: SELECT id,model_type,time_period,cache_status,io_type,price,version,effective_time FROM price_config WHERE (model_type = ? AND time_period = ? AND io_type = ? AND effective_time <= ? AND cache_status IS NULL) ORDER BY effective_time DESC LIMIT 1
2025-05-19 14:56:49.769 [ConsumeMessageThread_billing-consumer-group_1] DEBUG c.bgpay.bgai.mapper.PriceConfigMapper.selectList - ==> Parameters: deepseek-chat(String), standard(String), output(String), 2025-05-19T14:56:49.768614500(LocalDateTime)
2025-05-19 14:56:49.774 [ConsumeMessageThread_billing-consumer-group_1] DEBUG c.bgpay.bgai.mapper.PriceConfigMapper.selectList - <==      Total: 1
2025-05-19 14:56:49.827 [ConsumeMessageThread_billing-consumer-group_1] INFO  c.bgpay.bgai.service.mq.RocketMQBillingServiceImpl - Output price config priceVersion: 1
2025-05-19 14:56:49.828 [ConsumeMessageThread_billing-consumer-group_1] DEBUG com.bgpay.bgai.mapper.UsageRecordMapper.insert - ==>  Preparing: INSERT INTO usage_record ( model_type, chat_completion_id, user_id, input_cost, output_cost, price_version, calculated_at ) VALUES ( ?, ?, ?, ?, ?, ?, ? )
2025-05-19 14:56:49.828 [ConsumeMessageThread_billing-consumer-group_1] DEBUG com.bgpay.bgai.mapper.UsageRecordMapper.insert - ==> Parameters: deepseek-chat(String), chat-851db730-86bc-4219-ba44-8efad1f4512c(String), 689258T(String), 0.0001(BigDecimal), 0.0035(BigDecimal), 1(Integer), 2025-05-19T14:56:49.827798300(LocalDateTime)
2025-05-19 14:56:49.849 [ConsumeMessageThread_billing-consumer-group_1] DEBUG com.bgpay.bgai.mapper.UsageRecordMapper.insert - <==    Updates: 1
2025-05-19 14:56:49.859 [ConsumeMessageThread_billing-consumer-group_1] INFO  c.bgpay.bgai.service.mq.RocketMQBillingServiceImpl - Message consumed: 2408820C75288342B4869B724B724BF07DB436BAF30C5FE75B7A0000
2025-05-19 14:57:21.660 [Thread-1] WARN  c.alibaba.nacos.common.http.HttpClientBeanHolder - [HttpClientBeanHolder] Start destroying common HttpClient
2025-05-19 14:57:21.660 [Thread-7] WARN  com.alibaba.nacos.common.notify.NotifyCenter - [NotifyCenter] Start destroying Publisher
2025-05-19 14:57:21.660 [Thread-7] WARN  com.alibaba.nacos.common.notify.NotifyCenter - [NotifyCenter] Destruction of the end
2025-05-19 14:57:21.661 [Thread-1] WARN  c.alibaba.nacos.common.http.HttpClientBeanHolder - [HttpClientBeanHolder] Destruction of the end
2025-05-19 14:57:21.678 [NettyClientSelector_TMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - channel inactive: [id: 0x86801d26, L:/192.168.86.8:49290 ! R:/8.133.246.113:8091]
2025-05-19 14:57:21.678 [NettyClientSelector_TMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - return to pool, rm channel:[id: 0x86801d26, L:/192.168.86.8:49290 ! R:/8.133.246.113:8091]
2025-05-19 14:57:21.678 [NettyClientSelector_TMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - channel valid false,channel:[id: 0x86801d26, L:/192.168.86.8:49290 ! R:/8.133.246.113:8091]
2025-05-19 14:57:21.678 [NettyClientSelector_TMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - will destroy channel:[id: 0x86801d26, L:/192.168.86.8:49290 ! R:/8.133.246.113:8091]
2025-05-19 14:57:21.678 [NettyClientSelector_TMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0x86801d26, L:/192.168.86.8:49290 ! R:/8.133.246.113:8091]) will closed
2025-05-19 14:57:21.678 [NettyClientSelector_TMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0x86801d26, L:/192.168.86.8:49290 ! R:/8.133.246.113:8091]) will closed
2025-05-19 14:57:21.678 [NettyClientSelector_RMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - channel inactive: [id: 0xcc5a1de7, L:/192.168.86.8:49292 ! R:/8.133.246.113:8091]
2025-05-19 14:57:21.678 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - return to pool, rm channel:[id: 0xcc5a1de7, L:/192.168.86.8:49292 ! R:/8.133.246.113:8091]
2025-05-19 14:57:21.678 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - channel valid false,channel:[id: 0xcc5a1de7, L:/192.168.86.8:49292 ! R:/8.133.246.113:8091]
2025-05-19 14:57:21.678 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - will destroy channel:[id: 0xcc5a1de7, L:/192.168.86.8:49292 ! R:/8.133.246.113:8091]
2025-05-19 14:57:21.678 [NettyClientSelector_RMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0xcc5a1de7, L:/192.168.86.8:49292 ! R:/8.133.246.113:8091]) will closed
2025-05-19 14:57:21.678 [NettyClientSelector_RMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0xcc5a1de7, L:/192.168.86.8:49292 ! R:/8.133.246.113:8091]) will closed
2025-05-19 14:57:21.681 [SpringContextShutdownHook] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - De-registering from Nacos Server now...
2025-05-19 14:57:21.681 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - [DEREGISTER-SERVICE] d750d92e-152f-4055-a641-3bc9dda85a29 deregistering service bgtech-ai with instance: Instance{instanceId='null', ip='192.168.86.8', port=8080, weight=1.0, healthy=true, enabled=true, ephemeral=true, clusterName='DEFAULT', serviceName='null', metadata={}}
2025-05-19 14:57:21.690 [SpringContextShutdownHook] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - De-registration finished.
2025-05-19 14:57:21.691 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.cache.ServiceInfoHolder do shutdown begin
2025-05-19 14:57:21.692 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.backups.FailoverReactor do shutdown begin
2025-05-19 14:57:21.692 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.backups.FailoverReactor do shutdown stop
2025-05-19 14:57:21.692 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.cache.ServiceInfoHolder do shutdown stop
2025-05-19 14:57:21.692 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.NamingClientProxyDelegate do shutdown begin
2025-05-19 14:57:21.692 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServiceInfoUpdateService do shutdown begin
2025-05-19 14:57:21.692 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServiceInfoUpdateService do shutdown stop
2025-05-19 14:57:21.692 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServerListManager do shutdown begin
2025-05-19 14:57:21.692 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Start destroying NacosRestTemplate
2025-05-19 14:57:21.692 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Destruction of the end
2025-05-19 14:57:21.692 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServerListManager do shutdown stop
2025-05-19 14:57:21.692 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.http.NamingHttpClientProxy do shutdown begin
2025-05-19 14:57:21.692 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Start destroying NacosRestTemplate
2025-05-19 14:57:21.692 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Destruction of the end
2025-05-19 14:57:21.692 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.http.NamingHttpClientProxy do shutdown stop
2025-05-19 14:57:21.692 [SpringContextShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Shutdown rpc client, set status to shutdown
2025-05-19 14:57:21.692 [SpringContextShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Shutdown client event executor java.util.concurrent.ScheduledThreadPoolExecutor@40c65f8d[Running, pool size = 2, active threads = 2, queued tasks = 0, completed tasks = 0]
2025-05-19 14:57:21.692 [SpringContextShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Close current connection 1747637709623_139.227.195.203_43005
2025-05-19 14:57:21.696 [nacos-grpc-client-executor-8.133.246.113-42] WARN  c.a.nacos.common.remote.client.grpc.GrpcClient - [1747637709623_139.227.195.203_43005]Ignore error event,isRunning:false,isAbandon=false
2025-05-19 14:57:21.697 [SpringContextShutdownHook] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - Shutdown grpc executor java.util.concurrent.ThreadPoolExecutor@6aaec13[Running, pool size = 5, active threads = 0, queued tasks = 0, completed tasks = 43]
2025-05-19 14:57:21.697 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - Shutdown grpc redo service executor java.util.concurrent.ScheduledThreadPoolExecutor@247dc925[Running, pool size = 1, active threads = 0, queued tasks = 1, completed tasks = 44]
2025-05-19 14:57:21.698 [SpringContextShutdownHook] INFO  c.a.n.client.auth.ram.identify.CredentialWatcher - [null] CredentialWatcher is stopped
2025-05-19 14:57:21.698 [SpringContextShutdownHook] INFO  c.a.n.client.auth.ram.identify.CredentialService - [null] CredentialService is freed
2025-05-19 14:57:21.698 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.NamingClientProxyDelegate do shutdown stop
2025-05-19 14:57:23.726 [SpringContextShutdownHook] DEBUG com.bgpay.bgai.config.AsyncConfig$1 - Shutting down ExecutorService 'blockingExecutor'
2025-05-19 14:57:23.781 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:10909] result: true
2025-05-19 14:57:23.781 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:10911] result: true
2025-05-19 14:57:23.783 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:9876] result: true
2025-05-19 14:57:23.798 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:10911] result: true
2025-05-19 14:57:23.798 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:9876] result: true
2025-05-19 14:57:23.914 [SpringContextShutdownHook] INFO  o.s.orm.jpa.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-05-19 14:57:23.916 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-2} closing ...
2025-05-19 14:57:23.922 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-2} closed
2025-05-19 14:57:23.922 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} closing ...
2025-05-19 14:57:23.922 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} closed
2025-05-19 15:04:22.183 [main] WARN  com.alibaba.nacos.client.logging.NacosLogging - Load Logback Configuration of Nacos fail, message: Could not initialize Logback Nacos logging from classpath:nacos-logback.xml
2025-05-19 15:04:22.184 [main] INFO  com.bgpay.bgai.BgaiApplication - The following 1 profile is active: "dev"
2025-05-19 15:04:23.511 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-05-19 15:04:23.513 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-05-19 15:04:23.536 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 17 ms. Found 0 JPA repository interfaces.
2025-05-19 15:04:23.548 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-05-19 15:04:23.549 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-05-19 15:04:23.563 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 5 ms. Found 0 Redis repository interfaces.
2025-05-19 15:04:24.108 [main] INFO  io.seata.config.ConfigurationFactory - load Configuration from :Spring Configuration
2025-05-19 15:04:24.116 [main] INFO  io.seata.config.ConfigurationFactory - load Configuration from :Spring Configuration
2025-05-19 15:04:24.123 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Initializing Global Transaction Clients ... 
2025-05-19 15:04:24.226 [main] INFO  io.seata.core.rpc.netty.NettyClientBootstrap - NettyClientBootstrap has started
2025-05-19 15:04:24.227 [main] INFO  io.seata.discovery.registry.RegistryFactory - use registry center type: file
2025-05-19 15:04:24.237 [main] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - will connect to 8.133.246.113:8091
2025-05-19 15:04:24.242 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - NettyPool create channel to transactionRole:TMROLE,address:8.133.246.113:8091,msg:< RegisterTMRequest{version='1.7.0', applicationId='bgtech-ai', transactionServiceGroup='bgai-tx-group', extraData='ak=null
digest=bgai-tx-group,192.168.86.8,1747638264240
timestamp=1747638264240
authVersion=V4
vgroup=bgai-tx-group
ip=192.168.86.8
'} >
2025-05-19 15:04:24.449 [main] INFO  io.seata.core.rpc.netty.TmNettyRemotingClient - register TM success. client version:1.7.0, server version:1.8.1-SNAPSHOT,channel:[id: 0x534c6ee5, L:/192.168.86.8:54139 - R:/8.133.246.113:8091]
2025-05-19 15:04:24.455 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - register success, cost 134 ms, version:1.8.1-SNAPSHOT,role:TMROLE,channel:[id: 0x534c6ee5, L:/192.168.86.8:54139 - R:/8.133.246.113:8091]
2025-05-19 15:04:24.456 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Transaction Manager Client is initialized. applicationId[bgtech-ai] txServiceGroup[bgai-tx-group]
2025-05-19 15:04:24.465 [main] INFO  io.seata.rm.datasource.AsyncWorker - Async Commit Buffer Limit: 10000
2025-05-19 15:04:24.466 [main] INFO  io.seata.rm.datasource.xa.ResourceManagerXA - ResourceManagerXA init ...
2025-05-19 15:04:24.472 [main] INFO  io.seata.core.rpc.netty.NettyClientBootstrap - NettyClientBootstrap has started
2025-05-19 15:04:24.472 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Resource Manager is initialized. applicationId[bgtech-ai] txServiceGroup[bgai-tx-group]
2025-05-19 15:04:24.472 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Global Transaction Clients are initialized. 
2025-05-19 15:04:25.663 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat initialized with port(s): 8080 (http)
2025-05-19 15:04:25.677 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - The ["http-nio-8080"] connector has been configured to support HTTP upgrade to [h2c]
2025-05-19 15:04:25.677 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - Initializing ProtocolHandler ["http-nio-8080"]
2025-05-19 15:04:25.679 [main] INFO  org.apache.catalina.core.StandardService - Starting service [Tomcat]
2025-05-19 15:04:25.680 [main] INFO  org.apache.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.15]
2025-05-19 15:04:26.138 [main] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} inited
2025-05-19 15:04:26.389 [main] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - will connect to 8.133.246.113:8091
2025-05-19 15:04:26.389 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - RM will register :jdbc:mysql://8.133.246.113:3306/deepseek
2025-05-19 15:04:26.389 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - NettyPool create channel to transactionRole:RMROLE,address:8.133.246.113:8091,msg:< RegisterRMRequest{resourceIds='jdbc:mysql://8.133.246.113:3306/deepseek', version='1.7.0', applicationId='bgtech-ai', transactionServiceGroup='bgai-tx-group', extraData='null'} >
2025-05-19 15:04:26.413 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - register RM success. client version:1.7.0, server version:1.8.1-SNAPSHOT,channel:[id: 0xb353a1e5, L:/192.168.86.8:54151 - R:/8.133.246.113:8091]
2025-05-19 15:04:26.413 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - register success, cost 17 ms, version:1.8.1-SNAPSHOT,role:RMROLE,channel:[id: 0xb353a1e5, L:/192.168.86.8:54151 - R:/8.133.246.113:8091]
2025-05-19 15:04:26.416 [main] INFO  i.s.s.a.datasource.SeataAutoDataSourceProxyCreator - Auto proxy data source 'masterDataSource' by 'AT' mode.
2025-05-19 15:04:26.491 [main] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-2} inited
2025-05-19 15:04:26.577 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - will register resourceId:jdbc:mysql://8.133.246.113:3306/deepseek
2025-05-19 15:04:26.578 [main] INFO  i.s.s.a.datasource.SeataAutoDataSourceProxyCreator - Auto proxy data source 'slaveDataSource' by 'AT' mode.
2025-05-19 15:04:26.586 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.rm.AbstractRMHandler - the rm client received response msg [RegisterRMResponse{version='1.8.1-SNAPSHOT', extraData='null', identified=true, resultCode=null, msg='null'}] from tc server.
2025-05-19 15:04:26.612 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - will register resourceId:jdbc:mysql://8.133.246.113:3306/deepseek
2025-05-19 15:04:26.613 [main] INFO  i.s.s.a.datasource.SeataAutoDataSourceProxyCreator - Auto proxy data source 'dynamicDataSource' by 'AT' mode.
2025-05-19 15:04:26.636 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.rm.AbstractRMHandler - the rm client received response msg [RegisterRMResponse{version='1.8.1-SNAPSHOT', extraData='null', identified=true, resultCode=null, msg='null'}] from tc server.
2025-05-19 15:04:26.779 [main] INFO  org.hibernate.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-05-19 15:04:26.866 [main] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.1.7.Final
2025-05-19 15:04:27.256 [main] INFO  SQL dialect - HHH000400: Using dialect: org.hibernate.dialect.MySQL8Dialect
2025-05-19 15:04:27.259 [main] WARN  org.hibernate.orm.deprecation - HHH90000026: MySQL8Dialect has been deprecated; use org.hibernate.dialect.MySQLDialect instead
2025-05-19 15:04:27.545 [main] INFO  o.h.e.t.jta.platform.internal.JtaPlatformInitiator - HHH000490: Using JtaPlatform implementation: [org.hibernate.engine.transaction.jta.platform.internal.NoJtaPlatform]
2025-05-19 15:04:27.555 [main] INFO  o.s.orm.jpa.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-05-19 15:04:27.932 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-19 15:04:27.943 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-19 15:04:27.981 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-19 15:04:27.983 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-19 15:04:27.984 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-19 15:04:28.000 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-19 15:04:28.610 [main] INFO  com.bgpay.bgai.service.impl.UserServiceImpl - 初始化SSO配置: clientId=bgai-client-id, redirectUri=http://localhost:8080/api/auth/callback
2025-05-19 15:04:28.766 [main] INFO  com.bgpay.bgai.controller.AuthController - 初始化认证控制器: clientId=bgai-client-id, redirectUri=http://localhost:8080/api/auth/callback
2025-05-19 15:04:29.355 [main] INFO  o.a.r.s.autoconfigure.RocketMQAutoConfiguration - a producer (billing-producer-group) init on namesrv 8.133.246.113:9876
2025-05-19 15:04:29.630 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Bean [com.bgpay.bgai.service.deepseek.DeepSeekServiceImp$$SpringCGLIB$$0] with name [deepSeekServiceImp] would use interceptor [io.seata.spring.annotation.GlobalTransactionalInterceptor]
2025-05-19 15:04:29.976 [main] WARN  i.s.s.b.a.provider.SpringBootConfigurationProvider - The get method not found for the field 'SeataProperties#accesskey'.
2025-05-19 15:04:29.977 [main] WARN  i.s.s.b.a.provider.SpringBootConfigurationProvider - The get method not found for the field 'SeataProperties#secretkey'.
2025-05-19 15:04:29.990 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 加载到1个Saga状态机定义文件
2025-05-19 15:04:30.133 [main] INFO  com.bgpay.bgai.saga.CustomSagaJsonParser - 开始解析状态机定义: bgai-saga-transaction
2025-05-19 15:04:30.134 [main] INFO  com.bgpay.bgai.saga.CustomSagaJsonParser - 状态机定义解析成功: bgai-saga-transaction
2025-05-19 15:04:30.134 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 成功加载状态机定义: /E:/project/bgai/target/classes/statelang/bgai-saga-transaction.json
2025-05-19 15:04:30.619 [main] INFO  org.redisson.Version - Redisson 3.24.3
2025-05-19 15:04:30.799 [redisson-netty-4-6] INFO  o.r.connection.pool.MasterPubSubConnectionPool - 1 connections initialized for 8.133.246.113/8.133.246.113:6379
2025-05-19 15:04:31.121 [redisson-netty-4-19] INFO  org.redisson.connection.pool.MasterConnectionPool - 24 connections initialized for 8.133.246.113/8.133.246.113:6379
2025-05-19 15:04:31.367 [main] INFO  com.bgpay.bgai.service.mq.MQConsumerService - MQ consumer startup successful [group=billing-consumer-group, topic=BILLING_TOPIC, tag=USER_BILLING]
2025-05-19 15:04:31.534 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Bean [com.bgpay.bgai.service.impl.SeataTransactionService$$SpringCGLIB$$0] with name [seataTransactionService] would use interceptor [io.seata.spring.annotation.GlobalTransactionalInterceptor]
2025-05-19 15:04:31.665 [main] DEBUG com.bgpay.bgai.config.AsyncConfig$1 - Initializing ExecutorService 'blockingExecutor'
2025-05-19 15:04:31.694 [main] INFO  c.b.bgai.config.NacosConfig$NacosWarningHandler - Nacos警告处理器已启用，将忽略配置中心连接警告
2025-05-19 15:04:33.072 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [After]
2025-05-19 15:04:33.072 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Before]
2025-05-19 15:04:33.072 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Between]
2025-05-19 15:04:33.073 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Cookie]
2025-05-19 15:04:33.073 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Header]
2025-05-19 15:04:33.073 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Host]
2025-05-19 15:04:33.073 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Method]
2025-05-19 15:04:33.073 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Path]
2025-05-19 15:04:33.073 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Query]
2025-05-19 15:04:33.073 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [ReadBody]
2025-05-19 15:04:33.073 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [RemoteAddr]
2025-05-19 15:04:33.073 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [XForwardedRemoteAddr]
2025-05-19 15:04:33.073 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Weight]
2025-05-19 15:04:33.073 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [CloudFoundryRouteService]
2025-05-19 15:04:34.421 [main] INFO  o.s.b.actuate.endpoint.web.EndpointLinksResolver - Exposing 1 endpoint(s) beneath base path '/actuator'
2025-05-19 15:04:34.803 [main] WARN  i.s.s.b.a.provider.SpringBootConfigurationProvider - The get method not found for the field 'SeataProperties#accesskey'.
2025-05-19 15:04:34.803 [main] WARN  i.s.s.b.a.provider.SpringBootConfigurationProvider - The get method not found for the field 'SeataProperties#secretkey'.
2025-05-19 15:04:34.817 [main] INFO  io.seata.saga.tm.DefaultSagaTransactionalTemplate - Initializing Global Transaction Clients ... 
2025-05-19 15:04:34.817 [main] INFO  io.seata.saga.tm.DefaultSagaTransactionalTemplate - Transaction Manager Client is initialized. applicationId[bgtech-ai] txServiceGroup[bgai-tx-group]
2025-05-19 15:04:34.817 [main] INFO  io.seata.saga.tm.DefaultSagaTransactionalTemplate - Resource Manager is initialized. applicationId[bgtech-ai] txServiceGroup[bgai-tx-group]
2025-05-19 15:04:34.817 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - will register resourceId:bgtech-ai#bgai-tx-group
2025-05-19 15:04:34.817 [main] INFO  io.seata.saga.tm.DefaultSagaTransactionalTemplate - Global Transaction Clients are initialized. 
2025-05-19 15:04:34.825 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.rm.AbstractRMHandler - the rm client received response msg [RegisterRMResponse{version='1.8.1-SNAPSHOT', extraData='null', identified=true, resultCode=null, msg='null'}] from tc server.
2025-05-19 15:04:36.075 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - Starting ProtocolHandler ["http-nio-8080"]
2025-05-19 15:04:36.091 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat started on port(s): 8080 (http) with context path ''
2025-05-19 15:04:36.100 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from ans.namespace attribute : null
2025-05-19 15:04:36.100 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from ALIBABA_ALIWARE_NAMESPACE attribute :null
2025-05-19 15:04:36.101 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from namespace attribute :null
2025-05-19 15:04:36.110 [main] INFO  c.a.n.p.auth.spi.client.ClientAuthPluginManager - [ClientAuthPluginManager] Load ClientAuthService com.alibaba.nacos.client.auth.impl.NacosClientAuthServiceImpl success.
2025-05-19 15:04:36.110 [main] INFO  c.a.n.p.auth.spi.client.ClientAuthPluginManager - [ClientAuthPluginManager] Load ClientAuthService com.alibaba.nacos.client.auth.ram.RamClientAuthServiceImpl success.
2025-05-19 15:04:36.114 [main] INFO  com.alibaba.nacos.common.remote.client - [RpcClientFactory] create a new rpc client of 235717a6-1af3-42d4-8f82-10841bece840
2025-05-19 15:04:36.115 [main] INFO  com.alibaba.nacos.common.remote.client - [235717a6-1af3-42d4-8f82-10841bece840] RpcClient init, ServerListFactory = com.alibaba.nacos.client.naming.core.ServerListManager
2025-05-19 15:04:36.116 [main] INFO  com.alibaba.nacos.common.remote.client - [235717a6-1af3-42d4-8f82-10841bece840] Registry connection listener to current client:com.alibaba.nacos.client.naming.remote.gprc.redo.NamingGrpcRedoService
2025-05-19 15:04:36.116 [main] INFO  com.alibaba.nacos.common.remote.client - [235717a6-1af3-42d4-8f82-10841bece840] Register server push request handler:com.alibaba.nacos.client.naming.remote.gprc.NamingPushRequestHandler
2025-05-19 15:04:36.116 [main] INFO  com.alibaba.nacos.common.remote.client - [235717a6-1af3-42d4-8f82-10841bece840] Try to connect to server on start up, server: {serverIp = '8.133.246.113', server main port = 8848}
2025-05-19 15:04:36.116 [main] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - grpc client connection server:8.133.246.113 ip,serverPort:9848,grpcTslConfig:{"sslProvider":"OPENSSL","enableTls":false,"mutualAuthEnable":false,"trustAll":false}
2025-05-19 15:04:36.248 [main] INFO  com.alibaba.nacos.common.remote.client - [235717a6-1af3-42d4-8f82-10841bece840] Success to connect to server [8.133.246.113:8848] on start up, connectionId = 1747638276142_139.227.195.203_42126
2025-05-19 15:04:36.248 [main] INFO  com.alibaba.nacos.common.remote.client - [235717a6-1af3-42d4-8f82-10841bece840] Register server push request handler:com.alibaba.nacos.common.remote.client.RpcClient$ConnectResetRequestHandler
2025-05-19 15:04:36.248 [main] INFO  com.alibaba.nacos.common.remote.client - [235717a6-1af3-42d4-8f82-10841bece840] Register server push request handler:com.alibaba.nacos.common.remote.client.RpcClient$$Lambda/0x0000025581528f48
2025-05-19 15:04:36.248 [com.alibaba.nacos.client.remote.worker] INFO  com.alibaba.nacos.common.remote.client - [235717a6-1af3-42d4-8f82-10841bece840] Notify connected event to listeners.
2025-05-19 15:04:36.248 [com.alibaba.nacos.client.remote.worker] INFO  com.alibaba.nacos.client.naming - Grpc connection connect
2025-05-19 15:04:36.249 [main] INFO  com.alibaba.nacos.client.naming - [REGISTER-SERVICE] d750d92e-152f-4055-a641-3bc9dda85a29 registering service bgtech-ai with instance Instance{instanceId='null', ip='192.168.86.8', port=8080, weight=1.0, healthy=true, enabled=true, ephemeral=true, clusterName='DEFAULT', serviceName='null', metadata={IPv6=[2408:820c:7528:8342:b486:9b72:4b72:4bf0], preserved.register.source=SPRING_CLOUD}}
2025-05-19 15:04:36.279 [main] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - nacos registry, DEFAULT_GROUP bgtech-ai 192.168.86.8:8080 register finished
2025-05-19 15:04:36.327 [main] INFO  com.bgpay.bgai.config.NacosConfig - 应用启动完成，当前环境: dev
2025-05-19 15:04:36.328 [main] INFO  com.bgpay.bgai.config.NacosConfig - Nacos配置中心: 8.133.246.113:8848, 命名空间: d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-19 15:04:36.328 [main] INFO  com.bgpay.bgai.config.NacosConfig - 注意: 如果看到Nacos配置加载警告，但应用正常启动，说明应用正在使用本地配置文件
2025-05-19 15:04:36.329 [main] INFO  com.bgpay.bgai.BgaiApplication - Started BgaiApplication in 16.21 seconds (process running for 17.588)
2025-05-19 15:04:36.332 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-19 15:04:36.332 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-19 15:04:36.343 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-19 15:04:36.343 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-19 15:04:36.343 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-19 15:04:36.360 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-19 15:04:36.360 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-19 15:04:36.360 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-19 15:04:36.367 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-19 15:04:36.367 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-19 15:04:36.367 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-19 15:04:36.375 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-19 15:04:36.375 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - ==================== Saga状态机加载报告 ====================
2025-05-19 15:04:36.375 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - Saga状态机配置加载状态: 成功
2025-05-19 15:04:36.375 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 已加载的状态机定义文件数量: 1
2025-05-19 15:04:36.375 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 已加载的状态机定义文件:
2025-05-19 15:04:36.375 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig -  - /E:/project/bgai/target/classes/statelang/bgai-saga-transaction.json
2025-05-19 15:04:36.375 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - Saga解析器状态: CUSTOM_FASTJSON2
2025-05-19 15:04:36.375 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 状态机解析结果: 成功 1 个, 失败 0 个
2025-05-19 15:04:36.375 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - =============================================================
2025-05-19 15:04:36.380 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - nacos.cache.data.init.snapshot = true 
2025-05-19 15:04:36.381 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] common-dev.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-19 15:04:36.391 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=common-dev.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-19 15:04:36.391 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=common-dev.yaml, group=DEFAULT_GROUP
2025-05-19 15:04:36.391 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-19 15:04:36.391 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-19 15:04:36.391 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai.yaml, group=DEFAULT_GROUP
2025-05-19 15:04:36.393 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai-dev.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-19 15:04:36.393 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai-dev.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-19 15:04:36.393 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai-dev.yaml, group=DEFAULT_GROUP
2025-05-19 15:04:36.393 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-19 15:04:36.394 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai, group=DEFAULT_GROUP, cnt=1
2025-05-19 15:04:36.394 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai, group=DEFAULT_GROUP
2025-05-19 15:05:21.267 [Thread-1] WARN  c.alibaba.nacos.common.http.HttpClientBeanHolder - [HttpClientBeanHolder] Start destroying common HttpClient
2025-05-19 15:05:21.269 [Thread-1] WARN  c.alibaba.nacos.common.http.HttpClientBeanHolder - [HttpClientBeanHolder] Destruction of the end
2025-05-19 15:05:21.269 [Thread-7] WARN  com.alibaba.nacos.common.notify.NotifyCenter - [NotifyCenter] Start destroying Publisher
2025-05-19 15:05:21.270 [Thread-7] WARN  com.alibaba.nacos.common.notify.NotifyCenter - [NotifyCenter] Destruction of the end
2025-05-19 15:05:21.292 [NettyClientSelector_TMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - channel inactive: [id: 0x534c6ee5, L:/192.168.86.8:54139 ! R:/8.133.246.113:8091]
2025-05-19 15:05:21.292 [NettyClientSelector_TMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - return to pool, rm channel:[id: 0x534c6ee5, L:/192.168.86.8:54139 ! R:/8.133.246.113:8091]
2025-05-19 15:05:21.292 [NettyClientSelector_TMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - channel valid false,channel:[id: 0x534c6ee5, L:/192.168.86.8:54139 ! R:/8.133.246.113:8091]
2025-05-19 15:05:21.292 [NettyClientSelector_TMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - will destroy channel:[id: 0x534c6ee5, L:/192.168.86.8:54139 ! R:/8.133.246.113:8091]
2025-05-19 15:05:21.292 [NettyClientSelector_TMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0x534c6ee5, L:/192.168.86.8:54139 ! R:/8.133.246.113:8091]) will closed
2025-05-19 15:05:21.292 [NettyClientSelector_TMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0x534c6ee5, L:/192.168.86.8:54139 ! R:/8.133.246.113:8091]) will closed
2025-05-19 15:05:21.293 [NettyClientSelector_RMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - channel inactive: [id: 0xb353a1e5, L:/192.168.86.8:54151 ! R:/8.133.246.113:8091]
2025-05-19 15:05:21.293 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - return to pool, rm channel:[id: 0xb353a1e5, L:/192.168.86.8:54151 ! R:/8.133.246.113:8091]
2025-05-19 15:05:21.293 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - channel valid false,channel:[id: 0xb353a1e5, L:/192.168.86.8:54151 ! R:/8.133.246.113:8091]
2025-05-19 15:05:21.293 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - will destroy channel:[id: 0xb353a1e5, L:/192.168.86.8:54151 ! R:/8.133.246.113:8091]
2025-05-19 15:05:21.293 [NettyClientSelector_RMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0xb353a1e5, L:/192.168.86.8:54151 ! R:/8.133.246.113:8091]) will closed
2025-05-19 15:05:21.294 [NettyClientSelector_RMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0xb353a1e5, L:/192.168.86.8:54151 ! R:/8.133.246.113:8091]) will closed
2025-05-19 15:05:21.296 [SpringContextShutdownHook] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - De-registering from Nacos Server now...
2025-05-19 15:05:21.296 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - [DEREGISTER-SERVICE] d750d92e-152f-4055-a641-3bc9dda85a29 deregistering service bgtech-ai with instance: Instance{instanceId='null', ip='192.168.86.8', port=8080, weight=1.0, healthy=true, enabled=true, ephemeral=true, clusterName='DEFAULT', serviceName='null', metadata={}}
2025-05-19 15:05:21.309 [SpringContextShutdownHook] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - De-registration finished.
2025-05-19 15:05:21.310 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.cache.ServiceInfoHolder do shutdown begin
2025-05-19 15:05:21.310 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.backups.FailoverReactor do shutdown begin
2025-05-19 15:05:21.311 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.backups.FailoverReactor do shutdown stop
2025-05-19 15:05:21.311 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.cache.ServiceInfoHolder do shutdown stop
2025-05-19 15:05:21.311 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.NamingClientProxyDelegate do shutdown begin
2025-05-19 15:05:21.311 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServiceInfoUpdateService do shutdown begin
2025-05-19 15:05:21.311 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServiceInfoUpdateService do shutdown stop
2025-05-19 15:05:21.311 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServerListManager do shutdown begin
2025-05-19 15:05:21.311 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Start destroying NacosRestTemplate
2025-05-19 15:05:21.311 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Destruction of the end
2025-05-19 15:05:21.311 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServerListManager do shutdown stop
2025-05-19 15:05:21.311 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.http.NamingHttpClientProxy do shutdown begin
2025-05-19 15:05:21.311 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Start destroying NacosRestTemplate
2025-05-19 15:05:21.311 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Destruction of the end
2025-05-19 15:05:21.311 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.http.NamingHttpClientProxy do shutdown stop
2025-05-19 15:05:21.311 [SpringContextShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Shutdown rpc client, set status to shutdown
2025-05-19 15:05:21.311 [SpringContextShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Shutdown client event executor java.util.concurrent.ScheduledThreadPoolExecutor@67488c90[Running, pool size = 2, active threads = 2, queued tasks = 0, completed tasks = 0]
2025-05-19 15:05:21.311 [SpringContextShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Close current connection 1747638276142_139.227.195.203_42126
2025-05-19 15:05:21.314 [nacos-grpc-client-executor-8.133.246.113-19] WARN  c.a.nacos.common.remote.client.grpc.GrpcClient - [1747638276142_139.227.195.203_42126]Ignore error event,isRunning:false,isAbandon=false
2025-05-19 15:05:21.315 [SpringContextShutdownHook] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - Shutdown grpc executor java.util.concurrent.ThreadPoolExecutor@5e3c33ac[Running, pool size = 5, active threads = 0, queued tasks = 0, completed tasks = 20]
2025-05-19 15:05:21.316 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - Shutdown grpc redo service executor java.util.concurrent.ScheduledThreadPoolExecutor@1f420cc9[Running, pool size = 1, active threads = 0, queued tasks = 1, completed tasks = 15]
2025-05-19 15:05:21.316 [SpringContextShutdownHook] INFO  c.a.n.client.auth.ram.identify.CredentialWatcher - [null] CredentialWatcher is stopped
2025-05-19 15:05:21.316 [SpringContextShutdownHook] INFO  c.a.n.client.auth.ram.identify.CredentialService - [null] CredentialService is freed
2025-05-19 15:05:21.316 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.NamingClientProxyDelegate do shutdown stop
2025-05-19 15:05:23.358 [SpringContextShutdownHook] DEBUG com.bgpay.bgai.config.AsyncConfig$1 - Shutting down ExecutorService 'blockingExecutor'
2025-05-19 15:05:23.402 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:10911] result: true
2025-05-19 15:05:23.402 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:9876] result: true
2025-05-19 15:05:23.420 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:10911] result: true
2025-05-19 15:05:23.420 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:9876] result: true
2025-05-19 15:05:23.432 [SpringContextShutdownHook] INFO  o.s.orm.jpa.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-05-19 15:05:23.433 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-2} closing ...
2025-05-19 15:05:23.441 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-2} closed
2025-05-19 15:05:23.441 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} closing ...
2025-05-19 15:05:23.441 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} closed
2025-05-19 15:06:05.332 [main] WARN  com.alibaba.nacos.client.logging.NacosLogging - Load Logback Configuration of Nacos fail, message: Could not initialize Logback Nacos logging from classpath:nacos-logback.xml
2025-05-19 15:06:05.332 [main] INFO  com.bgpay.bgai.BgaiApplication - The following 1 profile is active: "dev"
2025-05-19 15:06:06.629 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-05-19 15:06:06.630 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-05-19 15:06:06.654 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 17 ms. Found 0 JPA repository interfaces.
2025-05-19 15:06:06.664 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-05-19 15:06:06.665 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-05-19 15:06:06.677 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 4 ms. Found 0 Redis repository interfaces.
2025-05-19 15:06:07.285 [main] INFO  io.seata.config.ConfigurationFactory - load Configuration from :Spring Configuration
2025-05-19 15:06:07.294 [main] INFO  io.seata.config.ConfigurationFactory - load Configuration from :Spring Configuration
2025-05-19 15:06:07.302 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Initializing Global Transaction Clients ... 
2025-05-19 15:06:07.409 [main] INFO  io.seata.core.rpc.netty.NettyClientBootstrap - NettyClientBootstrap has started
2025-05-19 15:06:07.410 [main] INFO  io.seata.discovery.registry.RegistryFactory - use registry center type: file
2025-05-19 15:06:07.420 [main] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - will connect to 8.133.246.113:8091
2025-05-19 15:06:07.425 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - NettyPool create channel to transactionRole:TMROLE,address:8.133.246.113:8091,msg:< RegisterTMRequest{version='1.7.0', applicationId='bgtech-ai', transactionServiceGroup='bgai-tx-group', extraData='ak=null
digest=bgai-tx-group,192.168.86.8,1747638367423
timestamp=1747638367423
authVersion=V4
vgroup=bgai-tx-group
ip=192.168.86.8
'} >
2025-05-19 15:06:07.572 [main] INFO  io.seata.core.rpc.netty.TmNettyRemotingClient - register TM success. client version:1.7.0, server version:1.8.1-SNAPSHOT,channel:[id: 0x9fc5513a, L:/192.168.86.8:54812 - R:/8.133.246.113:8091]
2025-05-19 15:06:07.579 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - register success, cost 68 ms, version:1.8.1-SNAPSHOT,role:TMROLE,channel:[id: 0x9fc5513a, L:/192.168.86.8:54812 - R:/8.133.246.113:8091]
2025-05-19 15:06:07.580 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Transaction Manager Client is initialized. applicationId[bgtech-ai] txServiceGroup[bgai-tx-group]
2025-05-19 15:06:07.591 [main] INFO  io.seata.rm.datasource.AsyncWorker - Async Commit Buffer Limit: 10000
2025-05-19 15:06:07.592 [main] INFO  io.seata.rm.datasource.xa.ResourceManagerXA - ResourceManagerXA init ...
2025-05-19 15:06:07.598 [main] INFO  io.seata.core.rpc.netty.NettyClientBootstrap - NettyClientBootstrap has started
2025-05-19 15:06:07.598 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Resource Manager is initialized. applicationId[bgtech-ai] txServiceGroup[bgai-tx-group]
2025-05-19 15:06:07.598 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Global Transaction Clients are initialized. 
2025-05-19 15:06:08.663 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat initialized with port(s): 8080 (http)
2025-05-19 15:06:08.673 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - The ["http-nio-8080"] connector has been configured to support HTTP upgrade to [h2c]
2025-05-19 15:06:08.674 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - Initializing ProtocolHandler ["http-nio-8080"]
2025-05-19 15:06:08.675 [main] INFO  org.apache.catalina.core.StandardService - Starting service [Tomcat]
2025-05-19 15:06:08.675 [main] INFO  org.apache.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.15]
2025-05-19 15:06:09.089 [main] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} inited
2025-05-19 15:06:09.339 [main] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - will connect to 8.133.246.113:8091
2025-05-19 15:06:09.339 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - RM will register :jdbc:mysql://8.133.246.113:3306/deepseek
2025-05-19 15:06:09.339 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - NettyPool create channel to transactionRole:RMROLE,address:8.133.246.113:8091,msg:< RegisterRMRequest{resourceIds='jdbc:mysql://8.133.246.113:3306/deepseek', version='1.7.0', applicationId='bgtech-ai', transactionServiceGroup='bgai-tx-group', extraData='null'} >
2025-05-19 15:06:09.369 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - register RM success. client version:1.7.0, server version:1.8.1-SNAPSHOT,channel:[id: 0x27eabbf2, L:/192.168.86.8:54815 - R:/8.133.246.113:8091]
2025-05-19 15:06:09.369 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - register success, cost 12 ms, version:1.8.1-SNAPSHOT,role:RMROLE,channel:[id: 0x27eabbf2, L:/192.168.86.8:54815 - R:/8.133.246.113:8091]
2025-05-19 15:06:09.371 [main] INFO  i.s.s.a.datasource.SeataAutoDataSourceProxyCreator - Auto proxy data source 'masterDataSource' by 'AT' mode.
2025-05-19 15:06:09.432 [main] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-2} inited
2025-05-19 15:06:09.501 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - will register resourceId:jdbc:mysql://8.133.246.113:3306/deepseek
2025-05-19 15:06:09.502 [main] INFO  i.s.s.a.datasource.SeataAutoDataSourceProxyCreator - Auto proxy data source 'slaveDataSource' by 'AT' mode.
2025-05-19 15:06:09.510 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.rm.AbstractRMHandler - the rm client received response msg [RegisterRMResponse{version='1.8.1-SNAPSHOT', extraData='null', identified=true, resultCode=null, msg='null'}] from tc server.
2025-05-19 15:06:09.523 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - will register resourceId:jdbc:mysql://8.133.246.113:3306/deepseek
2025-05-19 15:06:09.523 [main] INFO  i.s.s.a.datasource.SeataAutoDataSourceProxyCreator - Auto proxy data source 'dynamicDataSource' by 'AT' mode.
2025-05-19 15:06:09.533 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.rm.AbstractRMHandler - the rm client received response msg [RegisterRMResponse{version='1.8.1-SNAPSHOT', extraData='null', identified=true, resultCode=null, msg='null'}] from tc server.
2025-05-19 15:06:09.634 [main] INFO  org.hibernate.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-05-19 15:06:09.682 [main] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.1.7.Final
2025-05-19 15:06:09.998 [main] INFO  SQL dialect - HHH000400: Using dialect: org.hibernate.dialect.MySQL8Dialect
2025-05-19 15:06:10.001 [main] WARN  org.hibernate.orm.deprecation - HHH90000026: MySQL8Dialect has been deprecated; use org.hibernate.dialect.MySQLDialect instead
2025-05-19 15:06:10.278 [main] INFO  o.h.e.t.jta.platform.internal.JtaPlatformInitiator - HHH000490: Using JtaPlatform implementation: [org.hibernate.engine.transaction.jta.platform.internal.NoJtaPlatform]
2025-05-19 15:06:10.289 [main] INFO  o.s.orm.jpa.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-05-19 15:06:10.650 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-19 15:06:10.661 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-19 15:06:10.687 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-19 15:06:10.689 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-19 15:06:10.689 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-19 15:06:10.701 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-19 15:06:11.472 [main] INFO  com.bgpay.bgai.service.impl.UserServiceImpl - 初始化SSO配置: clientId=bgai-client-id, redirectUri=http://localhost:8080/api/auth/callback
2025-05-19 15:06:11.615 [main] INFO  com.bgpay.bgai.controller.AuthController - 初始化认证控制器: clientId=bgai-client-id, redirectUri=http://localhost:8080/api/auth/callback
2025-05-19 15:06:12.215 [main] INFO  o.a.r.s.autoconfigure.RocketMQAutoConfiguration - a producer (billing-producer-group) init on namesrv 8.133.246.113:9876
2025-05-19 15:06:12.458 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Bean [com.bgpay.bgai.service.deepseek.DeepSeekServiceImp$$SpringCGLIB$$0] with name [deepSeekServiceImp] would use interceptor [io.seata.spring.annotation.GlobalTransactionalInterceptor]
2025-05-19 15:06:12.840 [main] WARN  i.s.s.b.a.provider.SpringBootConfigurationProvider - The get method not found for the field 'SeataProperties#accesskey'.
2025-05-19 15:06:12.841 [main] WARN  i.s.s.b.a.provider.SpringBootConfigurationProvider - The get method not found for the field 'SeataProperties#secretkey'.
2025-05-19 15:06:12.854 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 加载到1个Saga状态机定义文件
2025-05-19 15:06:12.995 [main] INFO  com.bgpay.bgai.saga.CustomSagaJsonParser - 开始解析状态机定义: bgai-saga-transaction
2025-05-19 15:06:12.996 [main] INFO  com.bgpay.bgai.saga.CustomSagaJsonParser - 状态机定义解析成功: bgai-saga-transaction
2025-05-19 15:06:12.996 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 成功加载状态机定义: /E:/project/bgai/target/classes/statelang/bgai-saga-transaction.json
2025-05-19 15:06:13.493 [main] INFO  org.redisson.Version - Redisson 3.24.3
2025-05-19 15:06:13.620 [redisson-netty-4-6] INFO  o.r.connection.pool.MasterPubSubConnectionPool - 1 connections initialized for 8.133.246.113/8.133.246.113:6379
2025-05-19 15:06:13.953 [redisson-netty-4-19] INFO  org.redisson.connection.pool.MasterConnectionPool - 24 connections initialized for 8.133.246.113/8.133.246.113:6379
2025-05-19 15:06:14.193 [main] INFO  com.bgpay.bgai.service.mq.MQConsumerService - MQ consumer startup successful [group=billing-consumer-group, topic=BILLING_TOPIC, tag=USER_BILLING]
2025-05-19 15:06:14.356 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Bean [com.bgpay.bgai.service.impl.SeataTransactionService$$SpringCGLIB$$0] with name [seataTransactionService] would use interceptor [io.seata.spring.annotation.GlobalTransactionalInterceptor]
2025-05-19 15:06:14.474 [main] DEBUG com.bgpay.bgai.config.AsyncConfig$1 - Initializing ExecutorService 'blockingExecutor'
2025-05-19 15:06:14.499 [main] INFO  c.b.bgai.config.NacosConfig$NacosWarningHandler - Nacos警告处理器已启用，将忽略配置中心连接警告
2025-05-19 15:06:15.814 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [After]
2025-05-19 15:06:15.814 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Before]
2025-05-19 15:06:15.814 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Between]
2025-05-19 15:06:15.814 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Cookie]
2025-05-19 15:06:15.814 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Header]
2025-05-19 15:06:15.814 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Host]
2025-05-19 15:06:15.814 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Method]
2025-05-19 15:06:15.814 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Path]
2025-05-19 15:06:15.814 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Query]
2025-05-19 15:06:15.815 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [ReadBody]
2025-05-19 15:06:15.815 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [RemoteAddr]
2025-05-19 15:06:15.815 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [XForwardedRemoteAddr]
2025-05-19 15:06:15.815 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Weight]
2025-05-19 15:06:15.815 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [CloudFoundryRouteService]
2025-05-19 15:06:17.201 [main] INFO  o.s.b.actuate.endpoint.web.EndpointLinksResolver - Exposing 1 endpoint(s) beneath base path '/actuator'
2025-05-19 15:06:17.548 [main] WARN  i.s.s.b.a.provider.SpringBootConfigurationProvider - The get method not found for the field 'SeataProperties#accesskey'.
2025-05-19 15:06:17.548 [main] WARN  i.s.s.b.a.provider.SpringBootConfigurationProvider - The get method not found for the field 'SeataProperties#secretkey'.
2025-05-19 15:06:17.565 [main] INFO  io.seata.saga.tm.DefaultSagaTransactionalTemplate - Initializing Global Transaction Clients ... 
2025-05-19 15:06:17.565 [main] INFO  io.seata.saga.tm.DefaultSagaTransactionalTemplate - Transaction Manager Client is initialized. applicationId[bgtech-ai] txServiceGroup[bgai-tx-group]
2025-05-19 15:06:17.565 [main] INFO  io.seata.saga.tm.DefaultSagaTransactionalTemplate - Resource Manager is initialized. applicationId[bgtech-ai] txServiceGroup[bgai-tx-group]
2025-05-19 15:06:17.565 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - will register resourceId:bgtech-ai#bgai-tx-group
2025-05-19 15:06:17.565 [main] INFO  io.seata.saga.tm.DefaultSagaTransactionalTemplate - Global Transaction Clients are initialized. 
2025-05-19 15:06:17.575 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.rm.AbstractRMHandler - the rm client received response msg [RegisterRMResponse{version='1.8.1-SNAPSHOT', extraData='null', identified=true, resultCode=null, msg='null'}] from tc server.
2025-05-19 15:06:18.776 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - Starting ProtocolHandler ["http-nio-8080"]
2025-05-19 15:06:18.790 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat started on port(s): 8080 (http) with context path ''
2025-05-19 15:06:18.800 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from ans.namespace attribute : null
2025-05-19 15:06:18.800 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from ALIBABA_ALIWARE_NAMESPACE attribute :null
2025-05-19 15:06:18.801 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from namespace attribute :null
2025-05-19 15:06:18.809 [main] INFO  c.a.n.p.auth.spi.client.ClientAuthPluginManager - [ClientAuthPluginManager] Load ClientAuthService com.alibaba.nacos.client.auth.impl.NacosClientAuthServiceImpl success.
2025-05-19 15:06:18.809 [main] INFO  c.a.n.p.auth.spi.client.ClientAuthPluginManager - [ClientAuthPluginManager] Load ClientAuthService com.alibaba.nacos.client.auth.ram.RamClientAuthServiceImpl success.
2025-05-19 15:06:18.813 [main] INFO  com.alibaba.nacos.common.remote.client - [RpcClientFactory] create a new rpc client of 20362799-a397-4d75-95d8-17b89ea240cb
2025-05-19 15:06:18.815 [main] INFO  com.alibaba.nacos.common.remote.client - [20362799-a397-4d75-95d8-17b89ea240cb] RpcClient init, ServerListFactory = com.alibaba.nacos.client.naming.core.ServerListManager
2025-05-19 15:06:18.815 [main] INFO  com.alibaba.nacos.common.remote.client - [20362799-a397-4d75-95d8-17b89ea240cb] Registry connection listener to current client:com.alibaba.nacos.client.naming.remote.gprc.redo.NamingGrpcRedoService
2025-05-19 15:06:18.815 [main] INFO  com.alibaba.nacos.common.remote.client - [20362799-a397-4d75-95d8-17b89ea240cb] Register server push request handler:com.alibaba.nacos.client.naming.remote.gprc.NamingPushRequestHandler
2025-05-19 15:06:18.816 [main] INFO  com.alibaba.nacos.common.remote.client - [20362799-a397-4d75-95d8-17b89ea240cb] Try to connect to server on start up, server: {serverIp = '8.133.246.113', server main port = 8848}
2025-05-19 15:06:18.816 [main] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - grpc client connection server:8.133.246.113 ip,serverPort:9848,grpcTslConfig:{"sslProvider":"OPENSSL","enableTls":false,"mutualAuthEnable":false,"trustAll":false}
2025-05-19 15:06:18.945 [main] INFO  com.alibaba.nacos.common.remote.client - [20362799-a397-4d75-95d8-17b89ea240cb] Success to connect to server [8.133.246.113:8848] on start up, connectionId = 1747638378839_139.227.195.203_42931
2025-05-19 15:06:18.945 [main] INFO  com.alibaba.nacos.common.remote.client - [20362799-a397-4d75-95d8-17b89ea240cb] Register server push request handler:com.alibaba.nacos.common.remote.client.RpcClient$ConnectResetRequestHandler
2025-05-19 15:06:18.945 [main] INFO  com.alibaba.nacos.common.remote.client - [20362799-a397-4d75-95d8-17b89ea240cb] Register server push request handler:com.alibaba.nacos.common.remote.client.RpcClient$$Lambda/0x0000027c81528870
2025-05-19 15:06:18.945 [com.alibaba.nacos.client.remote.worker] INFO  com.alibaba.nacos.common.remote.client - [20362799-a397-4d75-95d8-17b89ea240cb] Notify connected event to listeners.
2025-05-19 15:06:18.945 [com.alibaba.nacos.client.remote.worker] INFO  com.alibaba.nacos.client.naming - Grpc connection connect
2025-05-19 15:06:18.946 [main] INFO  com.alibaba.nacos.client.naming - [REGISTER-SERVICE] d750d92e-152f-4055-a641-3bc9dda85a29 registering service bgtech-ai with instance Instance{instanceId='null', ip='192.168.86.8', port=8080, weight=1.0, healthy=true, enabled=true, ephemeral=true, clusterName='DEFAULT', serviceName='null', metadata={IPv6=[2408:820c:7528:8342:b486:9b72:4b72:4bf0], preserved.register.source=SPRING_CLOUD}}
2025-05-19 15:06:18.966 [main] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - nacos registry, DEFAULT_GROUP bgtech-ai 192.168.86.8:8080 register finished
2025-05-19 15:06:19.017 [main] INFO  com.bgpay.bgai.config.NacosConfig - 应用启动完成，当前环境: dev
2025-05-19 15:06:19.017 [main] INFO  com.bgpay.bgai.config.NacosConfig - Nacos配置中心: 8.133.246.113:8848, 命名空间: d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-19 15:06:19.017 [main] INFO  com.bgpay.bgai.config.NacosConfig - 注意: 如果看到Nacos配置加载警告，但应用正常启动，说明应用正在使用本地配置文件
2025-05-19 15:06:19.019 [main] INFO  com.bgpay.bgai.BgaiApplication - Started BgaiApplication in 15.854 seconds (process running for 17.27)
2025-05-19 15:06:19.022 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-19 15:06:19.022 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-19 15:06:19.037 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-19 15:06:19.037 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-19 15:06:19.037 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-19 15:06:19.050 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-19 15:06:19.051 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-19 15:06:19.051 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-19 15:06:19.061 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-19 15:06:19.062 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-19 15:06:19.062 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-19 15:06:19.076 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-19 15:06:19.077 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - ==================== Saga状态机加载报告 ====================
2025-05-19 15:06:19.077 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - Saga状态机配置加载状态: 成功
2025-05-19 15:06:19.077 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 已加载的状态机定义文件数量: 1
2025-05-19 15:06:19.077 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 已加载的状态机定义文件:
2025-05-19 15:06:19.078 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig -  - /E:/project/bgai/target/classes/statelang/bgai-saga-transaction.json
2025-05-19 15:06:19.078 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - Saga解析器状态: CUSTOM_FASTJSON2
2025-05-19 15:06:19.078 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 状态机解析结果: 成功 1 个, 失败 0 个
2025-05-19 15:06:19.078 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - =============================================================
2025-05-19 15:06:19.083 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - nacos.cache.data.init.snapshot = true 
2025-05-19 15:06:19.084 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] common-dev.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-19 15:06:19.098 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=common-dev.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-19 15:06:19.098 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=common-dev.yaml, group=DEFAULT_GROUP
2025-05-19 15:06:19.098 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-19 15:06:19.099 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-19 15:06:19.099 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai.yaml, group=DEFAULT_GROUP
2025-05-19 15:06:19.101 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai-dev.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-19 15:06:19.101 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai-dev.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-19 15:06:19.101 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai-dev.yaml, group=DEFAULT_GROUP
2025-05-19 15:06:19.101 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-19 15:06:19.101 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai, group=DEFAULT_GROUP, cnt=1
2025-05-19 15:06:19.102 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai, group=DEFAULT_GROUP
2025-05-19 15:06:20.549 [rpcDispatch_RMROLE_1_1_24] INFO  i.s.core.rpc.processor.client.RmUndoLogProcessor - rm handle undo log process:UndoLogDeleteRequest{resourceId='bgtech-ai#bgai-tx-group', saveDays=7, branchType=AT}
2025-05-19 15:06:20.549 [rpcDispatch_RMROLE_1_1_24] WARN  io.seata.rm.RMHandlerAT - Failed to get dataSourceProxy for delete undolog on bgtech-ai#bgai-tx-group
2025-05-19 15:06:20.549 [rpcDispatch_RMROLE_1_2_24] INFO  i.s.core.rpc.processor.client.RmUndoLogProcessor - rm handle undo log process:UndoLogDeleteRequest{resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', saveDays=7, branchType=AT}
2025-05-19 15:06:47.010 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - 接收到请求: /api/chatGatWay-internal, 文件=新文件 17.txt, 问题参数=null, 模型参数=null
2025-05-19 15:06:47.012 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - 请求Content-Type: multipart/form-data;boundary=--------------------------542462833089365210394865
2025-05-19 15:06:47.012 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - 收集到的完整参数: question="null", apiUrl="null", modelName="null", multiTurn=false
2025-05-19 15:06:47.014 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - Processing request for user ID: 689258T
2025-05-19 15:06:47.014 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - Processing file with circuit breaker: fileName=新文件 17.txt, question=
2025-05-19 15:06:47.015 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.config.ReactiveFileProcessor - Processing file: 新文件 17.txt, content-type: text/plain
2025-05-19 15:06:47.022 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - PARAM TRACE [689258T]: 尝试查找匹配配置 - 参数: apiUrl=null, modelName=null
2025-05-19 15:06:47.031 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 查询配置 - userId=689258T
2025-05-19 15:06:47.032 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 排序方式 - 按ID降序
2025-05-19 15:06:47.033 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 限制结果数 - LIMIT 1
2025-05-19 15:06:47.097 [http-nio-8080-exec-2] DEBUG com.bgpay.bgai.mapper.ApiConfigMapper.selectList - ==>  Preparing: SELECT id,api_url,api_key,model_name,user_id FROM api_config WHERE (user_id = ?) ORDER BY id DESC LIMIT 1
2025-05-19 15:06:47.098 [http-nio-8080-exec-2] DEBUG com.bgpay.bgai.mapper.ApiConfigMapper.selectList - ==> Parameters: 689258T(String)
2025-05-19 15:06:47.117 [http-nio-8080-exec-2] DEBUG com.bgpay.bgai.mapper.ApiConfigMapper.selectList - <==      Total: 1
2025-05-19 15:06:47.118 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 查询结果 - 找到配置: id=2, modelName=deepseek-chat
2025-05-19 15:06:47.118 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - PARAM TRACE [689258T]: 找到匹配配置 - apiUrl=https://api.deepseek.com/chat/completions, modelName=deepseek-chat (原始请求: null)
2025-05-19 15:06:47.118 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - API config resolved: url=https://api.deepseek.com/chat/completions, model=deepseek-chat
2025-05-19 15:06:47.172 [Thread-43] INFO  com.bgpay.bgai.config.ReactiveFileProcessor - File processed successfully: size=2153 bytes
2025-05-19 15:06:47.178 [Thread-43] INFO  com.bgpay.bgai.controller.ReactiveChatController - Content processed, length: 2192
2025-05-19 15:06:47.187 [Thread-43] INFO  io.seata.tm.TransactionManagerHolder - TransactionManager Singleton io.seata.tm.DefaultTransactionManager@24f786b8
2025-05-19 15:06:47.216 [Thread-43] INFO  io.seata.tm.api.DefaultGlobalTransaction - Begin new global transaction [seata-server:8091:18666493999071233]
2025-05-19 15:06:47.221 [Thread-43] INFO  c.b.bgai.interceptor.SeataTransactionInterceptor - 准备记录分布式事务开始: XID=seata-server:8091:18666493999071233, 业务=com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive, 路径=, IP=, 用户=system
2025-05-19 15:06:47.246 [Thread-43] INFO  c.b.bgai.service.impl.TransactionLogServiceImpl - 记录分布式事务开始: XID=seata-server:8091:18666493999071233, 业务=com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive
2025-05-19 15:06:47.256 [Thread-43] DEBUG com.bgpay.bgai.mapper.TransactionLogMapper.insert - ==>  Preparing: INSERT INTO transaction_log ( xid, transaction_name, transaction_mode, status, request_path, source_ip, start_time, user_id, create_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-05-19 15:06:47.260 [Thread-43] DEBUG com.bgpay.bgai.mapper.TransactionLogMapper.insert - ==> Parameters: seata-server:8091:18666493999071233(String), com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive(String), AT(String), ACTIVE(String), (String), (String), 2025-05-19T15:06:47.246413700(LocalDateTime), system(String), 2025-05-19T15:06:47.246413700(LocalDateTime)
2025-05-19 15:06:47.665 [Thread-43] DEBUG com.bgpay.bgai.mapper.TransactionLogMapper.insert - <==    Updates: 1
2025-05-19 15:06:47.695 [Thread-43] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:18666493999071233, branchId:18666493999071234, lockKeys:transaction_log:6
2025-05-19 15:06:47.700 [Thread-43] WARN  i.s.c.l.EnhancedServiceLoader$InnerEnhancedServiceLoader - Load [io.seata.rm.datasource.undo.parser.ProtostuffUndoLogParser] class fail: io/protostuff/runtime/IdStrategy
2025-05-19 15:06:47.770 [Thread-43] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:18666493999071233, branchId:18666493999071235, lockKeys:undo_log:21;transaction_log:6
2025-05-19 15:06:47.800 [Thread-43] INFO  c.b.bgai.interceptor.SeataTransactionInterceptor - 开始分布式事务: XID=seata-server:8091:18666493999071233, 方法=com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive
2025-05-19 15:06:47.810 [Thread-43] INFO  org.reflections.Reflections - Processing reactive request: content length=2192, apiUrl=https://api.deepseek.com/chat/completions, modelName=deepseek-chat, userId=689258T, multiTurn=false
2025-05-19 15:06:47.845 [Thread-43] INFO  com.bgpay.bgai.transaction.TransactionCoordinator - Transaction prepared for user 689258T: chatCompletionId=chat-8f82148f-7a52-4c26-b5ae-56c05b3c05bc
2025-05-19 15:06:47.847 [Thread-43] INFO  org.reflections.Reflections - Generated request JSON with 2PC transaction: {"stream":false,"max_tokens":2000,"temperature":1.0,"messages":[{"content":"You are a helpful assist...
2025-05-19 15:06:47.870 [Thread-43] INFO  c.b.bgai.service.impl.TransactionLogServiceImpl - 记录分布式事务结束: XID=seata-server:8091:18666493999071233, 状态=COMMITTED
2025-05-19 15:06:47.872 [Thread-43] DEBUG c.b.bgai.mapper.TransactionLogMapper.selectList - ==>  Preparing: SELECT id,xid,branch_id,transaction_name,transaction_mode,status,request_path,source_ip,start_time,end_time,user_id,extra_data,create_time,update_time FROM transaction_log WHERE (xid = ?) LIMIT 1
2025-05-19 15:06:47.874 [Thread-43] DEBUG c.b.bgai.mapper.TransactionLogMapper.selectList - ==> Parameters: seata-server:8091:18666493999071233(String)
2025-05-19 15:06:47.883 [Thread-43] DEBUG c.b.bgai.mapper.TransactionLogMapper.selectList - <==      Total: 1
2025-05-19 15:06:47.888 [Thread-43] DEBUG c.b.bgai.mapper.TransactionLogMapper.updateById - ==>  Preparing: UPDATE transaction_log SET xid=?, transaction_name=?, transaction_mode=?, status=?, request_path=?, source_ip=?, start_time=?, end_time=?, user_id=?, extra_data=?, create_time=?, update_time=? WHERE id=?
2025-05-19 15:06:47.897 [Thread-43] DEBUG c.b.bgai.mapper.TransactionLogMapper.updateById - ==> Parameters: seata-server:8091:18666493999071233(String), com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive(String), AT(String), COMMITTED(String), (String), (String), 2025-05-19T15:06:47(LocalDateTime), 2025-05-19T15:06:47.883813600(LocalDateTime), system(String), {"duration":64,"result":"success"}(String), 2025-05-19T15:06:47(LocalDateTime), 2025-05-19T15:06:47.883813600(LocalDateTime), 6(Long)
2025-05-19 15:06:47.950 [Thread-43] DEBUG c.b.bgai.mapper.TransactionLogMapper.updateById - <==    Updates: 1
2025-05-19 15:06:47.960 [Thread-43] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:18666493999071233, branchId:18666493999071236, lockKeys:transaction_log:6
2025-05-19 15:06:47.983 [Thread-43] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:18666493999071233, branchId:18666493999071237, lockKeys:transaction_log:6;undo_log:23
2025-05-19 15:06:48.009 [Thread-43] INFO  c.b.bgai.interceptor.SeataTransactionInterceptor - 分布式事务成功完成: XID=seata-server:8091:18666493999071233, 耗时=64ms
2025-05-19 15:06:48.010 [Thread-43] INFO  io.seata.tm.api.DefaultGlobalTransaction - transaction seata-server:8091:18666493999071233 will be commit
2025-05-19 15:06:48.025 [Thread-43] INFO  io.seata.tm.api.DefaultGlobalTransaction - transaction end, xid = seata-server:8091:18666493999071233
2025-05-19 15:06:48.025 [Thread-43] INFO  io.seata.tm.api.DefaultGlobalTransaction - [seata-server:8091:18666493999071233] commit status: Committed
2025-05-19 15:06:48.542 [rpcDispatch_RMROLE_1_3_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:18666493999071233', branchId=18666493999071234, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false,"skipCheckLock":true}'}
2025-05-19 15:06:48.543 [rpcDispatch_RMROLE_1_3_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:18666493999071233 18666493999071234 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false,"skipCheckLock":true}
2025-05-19 15:06:48.544 [rpcDispatch_RMROLE_1_3_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-19 15:06:48.555 [rpcDispatch_RMROLE_1_4_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:18666493999071233', branchId=18666493999071235, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false,"skipCheckLock":true}'}
2025-05-19 15:06:48.556 [rpcDispatch_RMROLE_1_4_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:18666493999071233 18666493999071235 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false,"skipCheckLock":true}
2025-05-19 15:06:48.556 [rpcDispatch_RMROLE_1_4_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-19 15:06:48.563 [rpcDispatch_RMROLE_1_5_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:18666493999071233', branchId=18666493999071236, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false}'}
2025-05-19 15:06:48.563 [rpcDispatch_RMROLE_1_5_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:18666493999071233 18666493999071236 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false}
2025-05-19 15:06:48.563 [rpcDispatch_RMROLE_1_5_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-19 15:06:48.572 [rpcDispatch_RMROLE_1_6_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:18666493999071233', branchId=18666493999071237, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false}'}
2025-05-19 15:06:48.572 [rpcDispatch_RMROLE_1_6_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:18666493999071233 18666493999071237 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false}
2025-05-19 15:06:48.572 [rpcDispatch_RMROLE_1_6_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-19 15:07:11.762 [reactor-http-nio-3] INFO  org.reflections.Reflections - Raw response received, length: 2170
2025-05-19 15:07:11.770 [reactor-http-nio-3] WARN  org.reflections.Reflections - Received different chatCompletionId from response: 17d0c4ee-46ae-4f43-bcc7-678471139eb9 vs prepared: chat-8f82148f-7a52-4c26-b5ae-56c05b3c05bc
2025-05-19 15:07:11.787 [reactor-http-nio-3] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - ==>  Preparing: INSERT INTO chat_completions ( object, created, model, system_fingerprint, api_key ) VALUES ( ?, ?, ?, ?, ? )
2025-05-19 15:07:11.788 [reactor-http-nio-3] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - ==> Parameters: chat.completion(String), 1747638431785(Long), deepseek-chat(String), 689258T(String), chat-8f82148f-7a52-4c26-b5ae-56c05b3c05bc(String)
2025-05-19 15:07:11.808 [reactor-http-nio-3] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - <==    Updates: 1
2025-05-19 15:07:11.808 [reactor-http-nio-3] INFO  com.bgpay.bgai.transaction.TransactionCoordinator - Transaction committed for user 689258T: chatCompletionId=chat-8f82148f-7a52-4c26-b5ae-56c05b3c05bc
2025-05-19 15:07:11.829 [FileWrite-1] INFO  com.bgpay.bgai.service.deepseek.FileWriterService - Successfully wrote content to: \var\data\ai_responses\24148485-8697-4f25-898e-8591310b3139.txt
2025-05-19 15:07:11.838 [boundedElastic-1] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - ==>  Preparing: INSERT INTO chat_completions ( object, created, model, system_fingerprint, api_key ) VALUES ( ?, ?, ?, ?, ? )
2025-05-19 15:07:11.838 [boundedElastic-1] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - ==> Parameters: chat.completion(String), 1747638408(Long), deepseek-chat(String), fp_8802369eaa_prod0425fp8(String), chat-8f82148f-7a52-4c26-b5ae-56c05b3c05bc(String)
2025-05-19 15:07:11.850 [boundedElastic-1] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - <==    Updates: 1
2025-05-19 15:07:11.876 [boundedElastic-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.insert - ==>  Preparing: INSERT INTO usage_info ( chat_completion_id, prompt_tokens, completion_tokens, total_tokens, prompt_tokens_cached, completion_reasoning_tokens, prompt_cache_hit_tokens, prompt_cache_miss_tokens, created_at, model_type ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-05-19 15:07:11.877 [boundedElastic-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.insert - ==> Parameters: chat-8f82148f-7a52-4c26-b5ae-56c05b3c05bc(String), 721(Integer), 405(Integer), 1126(Integer), 0(Integer), 0(Integer), 0(Integer), 721(Integer), 2025-05-19T15:07:11.866853900(LocalDateTime), deepseek-chat(String)
2025-05-19 15:07:11.895 [boundedElastic-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.insert - <==    Updates: 1
2025-05-19 15:07:11.911 [boundedElastic-1] INFO  org.reflections.Reflections - Completion data saved synchronously for chatCompletionId: chat-8f82148f-7a52-4c26-b5ae-56c05b3c05bc
2025-05-19 15:07:11.918 [boundedElastic-2] INFO  org.reflections.Reflections - 开始发送账单消息，chatCompletionId: chat-8f82148f-7a52-4c26-b5ae-56c05b3c05bc, userId: 689258T
2025-05-19 15:07:11.977 [boundedElastic-2] INFO  org.reflections.Reflections - 账单消息发送成功，chatCompletionId: chat-8f82148f-7a52-4c26-b5ae-56c05b3c05bc, userId: 689258T
2025-05-19 15:07:11.979 [boundedElastic-1] INFO  org.reflections.Reflections - Complete processing chain completed: This appears to be a configuration file for Seata, an open-source distributed transaction solution. Here's an explanation of the key configurations:

### Basic Configuration
- `enabled: true` - Enables Seata functionality
- `application-id: bgai` - Application identifier
- `tx-service-group: bgai-tx-group` - Transaction service group name

### Client Configuration
1. **Resource Manager (RM)**
   - Async commit buffer limit, retry counts, and lock settings
   - Saga pattern configurations (JSON parser, retry modes)
   - Lock retry settings (interval: 10ms, times: 30)

2. **Transaction Manager (TM)**
   - Commit/rollback retry counts (5 times)
   - Default global transaction timeout (60000ms = 1 minute)
   - Degrade check settings

3. **Undo Log**
   - Data validation enabled
   - Uses Jackson for log serialization
   - Only tracks updated columns
   - Uses `undo_log` table

### Service Configuration
- Maps transaction group to default TC server
- TC server address: `8.133.246.113:8091`
- Global transaction enabled

### Transport Configuration
- Netty thread settings
- TCP protocol with NIO server
- Heartbeat enabled
- Seata serialization

### Saga Configuration
- Saga mode enabled
- State machine settings:
  - Table prefix: `seata_`
  - Thread pool configuration
  - Timeout settings (transaction: 1min, service invoke: 5min)
  - Auto-registers resources from JSON files

This configuration sets up Seata for distributed transactions with:
- A connection to a TC server at 8.133.246.113:8091
- Saga pattern support
- Undo log tracking in database
- Appropriate timeouts and retry policies

Would you like me to explain any specific part in more detail?
2025-05-19 15:07:11.979 [boundedElastic-1] INFO  com.bgpay.bgai.controller.ReactiveChatController - Processed response for user 689258T, content length: 1671
2025-05-19 15:07:49.679 [pool-7-thread-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.selectCount - ==>  Preparing: SELECT COUNT( * ) AS total FROM usage_info WHERE (chat_completion_id = ?)
2025-05-19 15:07:49.680 [pool-7-thread-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.selectCount - ==> Parameters: chat-8f82148f-7a52-4c26-b5ae-56c05b3c05bc(String)
2025-05-19 15:07:49.688 [pool-7-thread-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.selectCount - <==      Total: 1
2025-05-19 15:07:49.839 [ConsumeMessageThread_billing-consumer-group_1] INFO  c.bgpay.bgai.service.mq.RocketMQBillingServiceImpl - Output price config priceVersion: 1
2025-05-19 15:07:49.841 [ConsumeMessageThread_billing-consumer-group_1] DEBUG com.bgpay.bgai.mapper.UsageRecordMapper.insert - ==>  Preparing: INSERT INTO usage_record ( model_type, chat_completion_id, user_id, input_cost, output_cost, price_version, calculated_at ) VALUES ( ?, ?, ?, ?, ?, ?, ? )
2025-05-19 15:07:49.841 [ConsumeMessageThread_billing-consumer-group_1] DEBUG com.bgpay.bgai.mapper.UsageRecordMapper.insert - ==> Parameters: deepseek-chat(String), chat-8f82148f-7a52-4c26-b5ae-56c05b3c05bc(String), 689258T(String), 0.0014(BigDecimal), 0.0032(BigDecimal), 1(Integer), 2025-05-19T15:07:49.839741300(LocalDateTime)
2025-05-19 15:07:49.864 [ConsumeMessageThread_billing-consumer-group_1] DEBUG com.bgpay.bgai.mapper.UsageRecordMapper.insert - <==    Updates: 1
2025-05-19 15:07:49.874 [ConsumeMessageThread_billing-consumer-group_1] INFO  c.bgpay.bgai.service.mq.RocketMQBillingServiceImpl - Message consumed: 2408820C75288342B4869B724B724BF0D79C36BAF30C5FF108C60000
2025-05-19 15:08:18.453 [Thread-7] WARN  com.alibaba.nacos.common.notify.NotifyCenter - [NotifyCenter] Start destroying Publisher
2025-05-19 15:08:18.453 [Thread-7] WARN  com.alibaba.nacos.common.notify.NotifyCenter - [NotifyCenter] Destruction of the end
2025-05-19 15:08:18.453 [Thread-1] WARN  c.alibaba.nacos.common.http.HttpClientBeanHolder - [HttpClientBeanHolder] Start destroying common HttpClient
2025-05-19 15:08:18.453 [Thread-1] WARN  c.alibaba.nacos.common.http.HttpClientBeanHolder - [HttpClientBeanHolder] Destruction of the end
2025-05-19 15:08:18.471 [NettyClientSelector_TMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - channel inactive: [id: 0x9fc5513a, L:/192.168.86.8:54812 ! R:/8.133.246.113:8091]
2025-05-19 15:08:18.471 [NettyClientSelector_TMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - return to pool, rm channel:[id: 0x9fc5513a, L:/192.168.86.8:54812 ! R:/8.133.246.113:8091]
2025-05-19 15:08:18.471 [NettyClientSelector_TMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - channel valid false,channel:[id: 0x9fc5513a, L:/192.168.86.8:54812 ! R:/8.133.246.113:8091]
2025-05-19 15:08:18.471 [NettyClientSelector_TMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - will destroy channel:[id: 0x9fc5513a, L:/192.168.86.8:54812 ! R:/8.133.246.113:8091]
2025-05-19 15:08:18.471 [NettyClientSelector_TMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0x9fc5513a, L:/192.168.86.8:54812 ! R:/8.133.246.113:8091]) will closed
2025-05-19 15:08:18.471 [NettyClientSelector_TMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0x9fc5513a, L:/192.168.86.8:54812 ! R:/8.133.246.113:8091]) will closed
2025-05-19 15:08:18.472 [NettyClientSelector_RMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - channel inactive: [id: 0x27eabbf2, L:/192.168.86.8:54815 ! R:/8.133.246.113:8091]
2025-05-19 15:08:18.472 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - return to pool, rm channel:[id: 0x27eabbf2, L:/192.168.86.8:54815 ! R:/8.133.246.113:8091]
2025-05-19 15:08:18.472 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - channel valid false,channel:[id: 0x27eabbf2, L:/192.168.86.8:54815 ! R:/8.133.246.113:8091]
2025-05-19 15:08:18.472 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - will destroy channel:[id: 0x27eabbf2, L:/192.168.86.8:54815 ! R:/8.133.246.113:8091]
2025-05-19 15:08:18.472 [NettyClientSelector_RMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0x27eabbf2, L:/192.168.86.8:54815 ! R:/8.133.246.113:8091]) will closed
2025-05-19 15:08:18.472 [NettyClientSelector_RMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0x27eabbf2, L:/192.168.86.8:54815 ! R:/8.133.246.113:8091]) will closed
2025-05-19 15:08:18.474 [SpringContextShutdownHook] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - De-registering from Nacos Server now...
2025-05-19 15:08:18.474 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - [DEREGISTER-SERVICE] d750d92e-152f-4055-a641-3bc9dda85a29 deregistering service bgtech-ai with instance: Instance{instanceId='null', ip='192.168.86.8', port=8080, weight=1.0, healthy=true, enabled=true, ephemeral=true, clusterName='DEFAULT', serviceName='null', metadata={}}
2025-05-19 15:08:18.484 [SpringContextShutdownHook] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - De-registration finished.
2025-05-19 15:08:18.486 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.cache.ServiceInfoHolder do shutdown begin
2025-05-19 15:08:18.486 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.backups.FailoverReactor do shutdown begin
2025-05-19 15:08:18.486 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.backups.FailoverReactor do shutdown stop
2025-05-19 15:08:18.486 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.cache.ServiceInfoHolder do shutdown stop
2025-05-19 15:08:18.486 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.NamingClientProxyDelegate do shutdown begin
2025-05-19 15:08:18.486 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServiceInfoUpdateService do shutdown begin
2025-05-19 15:08:18.486 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServiceInfoUpdateService do shutdown stop
2025-05-19 15:08:18.486 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServerListManager do shutdown begin
2025-05-19 15:08:18.486 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Start destroying NacosRestTemplate
2025-05-19 15:08:18.486 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Destruction of the end
2025-05-19 15:08:18.486 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServerListManager do shutdown stop
2025-05-19 15:08:18.486 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.http.NamingHttpClientProxy do shutdown begin
2025-05-19 15:08:18.486 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Start destroying NacosRestTemplate
2025-05-19 15:08:18.486 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Destruction of the end
2025-05-19 15:08:18.486 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.http.NamingHttpClientProxy do shutdown stop
2025-05-19 15:08:18.486 [SpringContextShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Shutdown rpc client, set status to shutdown
2025-05-19 15:08:18.486 [SpringContextShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Shutdown client event executor java.util.concurrent.ScheduledThreadPoolExecutor@b956207[Running, pool size = 2, active threads = 2, queued tasks = 0, completed tasks = 0]
2025-05-19 15:08:18.486 [SpringContextShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Close current connection 1747638378839_139.227.195.203_42931
2025-05-19 15:08:18.490 [nacos-grpc-client-executor-8.133.246.113-44] WARN  c.a.nacos.common.remote.client.grpc.GrpcClient - [1747638378839_139.227.195.203_42931]Ignore error event,isRunning:false,isAbandon=false
2025-05-19 15:08:18.492 [SpringContextShutdownHook] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - Shutdown grpc executor java.util.concurrent.ThreadPoolExecutor@71e393a2[Running, pool size = 6, active threads = 0, queued tasks = 0, completed tasks = 45]
2025-05-19 15:08:18.492 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - Shutdown grpc redo service executor java.util.concurrent.ScheduledThreadPoolExecutor@62f732e7[Running, pool size = 1, active threads = 0, queued tasks = 1, completed tasks = 39]
2025-05-19 15:08:18.492 [SpringContextShutdownHook] INFO  c.a.n.client.auth.ram.identify.CredentialWatcher - [null] CredentialWatcher is stopped
2025-05-19 15:08:18.492 [SpringContextShutdownHook] INFO  c.a.n.client.auth.ram.identify.CredentialService - [null] CredentialService is freed
2025-05-19 15:08:18.493 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.NamingClientProxyDelegate do shutdown stop
2025-05-19 15:08:19.058 [com.alibaba.nacos.client.Worker] INFO  c.a.n.client.auth.ram.identify.CredentialWatcher - null No credential found
2025-05-19 15:08:20.521 [SpringContextShutdownHook] DEBUG com.bgpay.bgai.config.AsyncConfig$1 - Shutting down ExecutorService 'blockingExecutor'
2025-05-19 15:08:20.572 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:10911] result: true
2025-05-19 15:08:20.573 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:9876] result: true
2025-05-19 15:08:20.573 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:10909] result: true
2025-05-19 15:08:20.588 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:10911] result: true
2025-05-19 15:08:20.588 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:9876] result: true
2025-05-19 15:08:20.697 [SpringContextShutdownHook] INFO  o.s.orm.jpa.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-05-19 15:08:20.699 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-2} closing ...
2025-05-19 15:08:20.704 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-2} closed
2025-05-19 15:08:20.705 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} closing ...
2025-05-19 15:08:20.705 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} closed
2025-05-19 15:09:09.908 [main] WARN  com.alibaba.nacos.client.logging.NacosLogging - Load Logback Configuration of Nacos fail, message: Could not initialize Logback Nacos logging from classpath:nacos-logback.xml
2025-05-19 15:09:09.909 [main] INFO  com.bgpay.bgai.BgaiApplication - The following 1 profile is active: "dev"
2025-05-19 15:09:11.291 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-05-19 15:09:11.292 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-05-19 15:09:11.317 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 18 ms. Found 0 JPA repository interfaces.
2025-05-19 15:09:11.328 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-05-19 15:09:11.329 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-05-19 15:09:11.342 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 5 ms. Found 0 Redis repository interfaces.
2025-05-19 15:09:12.002 [main] INFO  io.seata.config.ConfigurationFactory - load Configuration from :Spring Configuration
2025-05-19 15:09:12.028 [main] INFO  io.seata.config.ConfigurationFactory - load Configuration from :Spring Configuration
2025-05-19 15:09:12.038 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Initializing Global Transaction Clients ... 
2025-05-19 15:09:12.234 [main] INFO  io.seata.core.rpc.netty.NettyClientBootstrap - NettyClientBootstrap has started
2025-05-19 15:09:12.236 [main] INFO  io.seata.discovery.registry.RegistryFactory - use registry center type: file
2025-05-19 15:09:12.249 [main] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - will connect to 8.133.246.113:8091
2025-05-19 15:09:12.254 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - NettyPool create channel to transactionRole:TMROLE,address:8.133.246.113:8091,msg:< RegisterTMRequest{version='1.7.0', applicationId='bgtech-ai', transactionServiceGroup='bgai-tx-group', extraData='ak=null
digest=bgai-tx-group,192.168.86.8,1747638552252
timestamp=1747638552252
authVersion=V4
vgroup=bgai-tx-group
ip=192.168.86.8
'} >
2025-05-19 15:09:12.388 [main] INFO  io.seata.core.rpc.netty.TmNettyRemotingClient - register TM success. client version:1.7.0, server version:1.8.1-SNAPSHOT,channel:[id: 0x12586f91, L:/192.168.86.8:55882 - R:/8.133.246.113:8091]
2025-05-19 15:09:12.394 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - register success, cost 60 ms, version:1.8.1-SNAPSHOT,role:TMROLE,channel:[id: 0x12586f91, L:/192.168.86.8:55882 - R:/8.133.246.113:8091]
2025-05-19 15:09:12.395 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Transaction Manager Client is initialized. applicationId[bgtech-ai] txServiceGroup[bgai-tx-group]
2025-05-19 15:09:12.405 [main] INFO  io.seata.rm.datasource.AsyncWorker - Async Commit Buffer Limit: 10000
2025-05-19 15:09:12.406 [main] INFO  io.seata.rm.datasource.xa.ResourceManagerXA - ResourceManagerXA init ...
2025-05-19 15:09:12.412 [main] INFO  io.seata.core.rpc.netty.NettyClientBootstrap - NettyClientBootstrap has started
2025-05-19 15:09:12.412 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Resource Manager is initialized. applicationId[bgtech-ai] txServiceGroup[bgai-tx-group]
2025-05-19 15:09:12.412 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Global Transaction Clients are initialized. 
2025-05-19 15:09:13.555 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat initialized with port(s): 8080 (http)
2025-05-19 15:09:13.565 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - The ["http-nio-8080"] connector has been configured to support HTTP upgrade to [h2c]
2025-05-19 15:09:13.565 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - Initializing ProtocolHandler ["http-nio-8080"]
2025-05-19 15:09:13.567 [main] INFO  org.apache.catalina.core.StandardService - Starting service [Tomcat]
2025-05-19 15:09:13.568 [main] INFO  org.apache.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.15]
2025-05-19 15:09:14.014 [main] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} inited
2025-05-19 15:09:14.255 [main] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - will connect to 8.133.246.113:8091
2025-05-19 15:09:14.255 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - RM will register :jdbc:mysql://8.133.246.113:3306/deepseek
2025-05-19 15:09:14.255 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - NettyPool create channel to transactionRole:RMROLE,address:8.133.246.113:8091,msg:< RegisterRMRequest{resourceIds='jdbc:mysql://8.133.246.113:3306/deepseek', version='1.7.0', applicationId='bgtech-ai', transactionServiceGroup='bgai-tx-group', extraData='null'} >
2025-05-19 15:09:14.280 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - register RM success. client version:1.7.0, server version:1.8.1-SNAPSHOT,channel:[id: 0xd7e3cea3, L:/192.168.86.8:55889 - R:/8.133.246.113:8091]
2025-05-19 15:09:14.281 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - register success, cost 17 ms, version:1.8.1-SNAPSHOT,role:RMROLE,channel:[id: 0xd7e3cea3, L:/192.168.86.8:55889 - R:/8.133.246.113:8091]
2025-05-19 15:09:14.283 [main] INFO  i.s.s.a.datasource.SeataAutoDataSourceProxyCreator - Auto proxy data source 'masterDataSource' by 'AT' mode.
2025-05-19 15:09:14.355 [main] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-2} inited
2025-05-19 15:09:14.441 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - will register resourceId:jdbc:mysql://8.133.246.113:3306/deepseek
2025-05-19 15:09:14.442 [main] INFO  i.s.s.a.datasource.SeataAutoDataSourceProxyCreator - Auto proxy data source 'slaveDataSource' by 'AT' mode.
2025-05-19 15:09:14.451 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.rm.AbstractRMHandler - the rm client received response msg [RegisterRMResponse{version='1.8.1-SNAPSHOT', extraData='null', identified=true, resultCode=null, msg='null'}] from tc server.
2025-05-19 15:09:14.467 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - will register resourceId:jdbc:mysql://8.133.246.113:3306/deepseek
2025-05-19 15:09:14.467 [main] INFO  i.s.s.a.datasource.SeataAutoDataSourceProxyCreator - Auto proxy data source 'dynamicDataSource' by 'AT' mode.
2025-05-19 15:09:14.478 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.rm.AbstractRMHandler - the rm client received response msg [RegisterRMResponse{version='1.8.1-SNAPSHOT', extraData='null', identified=true, resultCode=null, msg='null'}] from tc server.
2025-05-19 15:09:14.581 [main] INFO  org.hibernate.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-05-19 15:09:14.641 [main] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.1.7.Final
2025-05-19 15:09:15.019 [main] INFO  SQL dialect - HHH000400: Using dialect: org.hibernate.dialect.MySQL8Dialect
2025-05-19 15:09:15.022 [main] WARN  org.hibernate.orm.deprecation - HHH90000026: MySQL8Dialect has been deprecated; use org.hibernate.dialect.MySQLDialect instead
2025-05-19 15:09:15.358 [main] INFO  o.h.e.t.jta.platform.internal.JtaPlatformInitiator - HHH000490: Using JtaPlatform implementation: [org.hibernate.engine.transaction.jta.platform.internal.NoJtaPlatform]
2025-05-19 15:09:15.371 [main] INFO  o.s.orm.jpa.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-05-19 15:09:15.841 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-19 15:09:15.855 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-19 15:09:15.882 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-19 15:09:15.884 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-19 15:09:15.885 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-19 15:09:15.896 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-19 15:09:16.521 [main] INFO  com.bgpay.bgai.service.impl.UserServiceImpl - 初始化SSO配置: clientId=bgai-client-id, redirectUri=http://localhost:8080/api/auth/callback
2025-05-19 15:09:16.653 [main] INFO  com.bgpay.bgai.controller.AuthController - 初始化认证控制器: clientId=bgai-client-id, redirectUri=http://localhost:8080/api/auth/callback
2025-05-19 15:09:17.230 [main] INFO  o.a.r.s.autoconfigure.RocketMQAutoConfiguration - a producer (billing-producer-group) init on namesrv 8.133.246.113:9876
2025-05-19 15:09:17.481 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Bean [com.bgpay.bgai.service.deepseek.DeepSeekServiceImp$$SpringCGLIB$$0] with name [deepSeekServiceImp] would use interceptor [io.seata.spring.annotation.GlobalTransactionalInterceptor]
2025-05-19 15:09:17.813 [main] WARN  i.s.s.b.a.provider.SpringBootConfigurationProvider - The get method not found for the field 'SeataProperties#accesskey'.
2025-05-19 15:09:17.814 [main] WARN  i.s.s.b.a.provider.SpringBootConfigurationProvider - The get method not found for the field 'SeataProperties#secretkey'.
2025-05-19 15:09:17.825 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 加载到1个Saga状态机定义文件
2025-05-19 15:09:17.957 [main] INFO  com.bgpay.bgai.saga.CustomSagaJsonParser - 开始解析状态机定义: bgai-saga-transaction
2025-05-19 15:09:17.957 [main] INFO  com.bgpay.bgai.saga.CustomSagaJsonParser - 状态机定义解析成功: bgai-saga-transaction
2025-05-19 15:09:17.957 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 成功加载状态机定义: /E:/project/bgai/target/classes/statelang/bgai-saga-transaction.json
2025-05-19 15:09:18.464 [main] INFO  org.redisson.Version - Redisson 3.24.3
2025-05-19 15:09:18.599 [redisson-netty-4-6] INFO  o.r.connection.pool.MasterPubSubConnectionPool - 1 connections initialized for 8.133.246.113/8.133.246.113:6379
2025-05-19 15:09:18.930 [redisson-netty-4-19] INFO  org.redisson.connection.pool.MasterConnectionPool - 24 connections initialized for 8.133.246.113/8.133.246.113:6379
2025-05-19 15:09:19.165 [main] INFO  com.bgpay.bgai.service.mq.MQConsumerService - MQ consumer startup successful [group=billing-consumer-group, topic=BILLING_TOPIC, tag=USER_BILLING]
2025-05-19 15:09:19.315 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Bean [com.bgpay.bgai.service.impl.SeataTransactionService$$SpringCGLIB$$0] with name [seataTransactionService] would use interceptor [io.seata.spring.annotation.GlobalTransactionalInterceptor]
2025-05-19 15:09:19.459 [main] DEBUG com.bgpay.bgai.config.AsyncConfig$1 - Initializing ExecutorService 'blockingExecutor'
2025-05-19 15:09:19.484 [main] INFO  c.b.bgai.config.NacosConfig$NacosWarningHandler - Nacos警告处理器已启用，将忽略配置中心连接警告
2025-05-19 15:09:20.823 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [After]
2025-05-19 15:09:20.823 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Before]
2025-05-19 15:09:20.824 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Between]
2025-05-19 15:09:20.824 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Cookie]
2025-05-19 15:09:20.824 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Header]
2025-05-19 15:09:20.824 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Host]
2025-05-19 15:09:20.824 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Method]
2025-05-19 15:09:20.824 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Path]
2025-05-19 15:09:20.824 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Query]
2025-05-19 15:09:20.824 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [ReadBody]
2025-05-19 15:09:20.824 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [RemoteAddr]
2025-05-19 15:09:20.824 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [XForwardedRemoteAddr]
2025-05-19 15:09:20.824 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Weight]
2025-05-19 15:09:20.824 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [CloudFoundryRouteService]
2025-05-19 15:09:22.228 [main] INFO  o.s.b.actuate.endpoint.web.EndpointLinksResolver - Exposing 1 endpoint(s) beneath base path '/actuator'
2025-05-19 15:09:22.556 [main] WARN  i.s.s.b.a.provider.SpringBootConfigurationProvider - The get method not found for the field 'SeataProperties#accesskey'.
2025-05-19 15:09:22.556 [main] WARN  i.s.s.b.a.provider.SpringBootConfigurationProvider - The get method not found for the field 'SeataProperties#secretkey'.
2025-05-19 15:09:22.570 [main] INFO  io.seata.saga.tm.DefaultSagaTransactionalTemplate - Initializing Global Transaction Clients ... 
2025-05-19 15:09:22.570 [main] INFO  io.seata.saga.tm.DefaultSagaTransactionalTemplate - Transaction Manager Client is initialized. applicationId[bgtech-ai] txServiceGroup[bgai-tx-group]
2025-05-19 15:09:22.570 [main] INFO  io.seata.saga.tm.DefaultSagaTransactionalTemplate - Resource Manager is initialized. applicationId[bgtech-ai] txServiceGroup[bgai-tx-group]
2025-05-19 15:09:22.571 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - will register resourceId:bgtech-ai#bgai-tx-group
2025-05-19 15:09:22.571 [main] INFO  io.seata.saga.tm.DefaultSagaTransactionalTemplate - Global Transaction Clients are initialized. 
2025-05-19 15:09:22.581 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.rm.AbstractRMHandler - the rm client received response msg [RegisterRMResponse{version='1.8.1-SNAPSHOT', extraData='null', identified=true, resultCode=null, msg='null'}] from tc server.
2025-05-19 15:09:23.832 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - Starting ProtocolHandler ["http-nio-8080"]
2025-05-19 15:09:23.846 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat started on port(s): 8080 (http) with context path ''
2025-05-19 15:09:23.856 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from ans.namespace attribute : null
2025-05-19 15:09:23.856 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from ALIBABA_ALIWARE_NAMESPACE attribute :null
2025-05-19 15:09:23.857 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from namespace attribute :null
2025-05-19 15:09:23.866 [main] INFO  c.a.n.p.auth.spi.client.ClientAuthPluginManager - [ClientAuthPluginManager] Load ClientAuthService com.alibaba.nacos.client.auth.impl.NacosClientAuthServiceImpl success.
2025-05-19 15:09:23.866 [main] INFO  c.a.n.p.auth.spi.client.ClientAuthPluginManager - [ClientAuthPluginManager] Load ClientAuthService com.alibaba.nacos.client.auth.ram.RamClientAuthServiceImpl success.
2025-05-19 15:09:23.870 [main] INFO  com.alibaba.nacos.common.remote.client - [RpcClientFactory] create a new rpc client of 4bd33f43-6e66-4f09-8d0b-217eba00a719
2025-05-19 15:09:23.871 [main] INFO  com.alibaba.nacos.common.remote.client - [4bd33f43-6e66-4f09-8d0b-217eba00a719] RpcClient init, ServerListFactory = com.alibaba.nacos.client.naming.core.ServerListManager
2025-05-19 15:09:23.871 [main] INFO  com.alibaba.nacos.common.remote.client - [4bd33f43-6e66-4f09-8d0b-217eba00a719] Registry connection listener to current client:com.alibaba.nacos.client.naming.remote.gprc.redo.NamingGrpcRedoService
2025-05-19 15:09:23.872 [main] INFO  com.alibaba.nacos.common.remote.client - [4bd33f43-6e66-4f09-8d0b-217eba00a719] Register server push request handler:com.alibaba.nacos.client.naming.remote.gprc.NamingPushRequestHandler
2025-05-19 15:09:23.872 [main] INFO  com.alibaba.nacos.common.remote.client - [4bd33f43-6e66-4f09-8d0b-217eba00a719] Try to connect to server on start up, server: {serverIp = '8.133.246.113', server main port = 8848}
2025-05-19 15:09:23.872 [main] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - grpc client connection server:8.133.246.113 ip,serverPort:9848,grpcTslConfig:{"sslProvider":"OPENSSL","enableTls":false,"mutualAuthEnable":false,"trustAll":false}
2025-05-19 15:09:24.002 [main] INFO  com.alibaba.nacos.common.remote.client - [4bd33f43-6e66-4f09-8d0b-217eba00a719] Success to connect to server [8.133.246.113:8848] on start up, connectionId = 1747638563897_139.227.195.203_42445
2025-05-19 15:09:24.002 [main] INFO  com.alibaba.nacos.common.remote.client - [4bd33f43-6e66-4f09-8d0b-217eba00a719] Register server push request handler:com.alibaba.nacos.common.remote.client.RpcClient$ConnectResetRequestHandler
2025-05-19 15:09:24.002 [main] INFO  com.alibaba.nacos.common.remote.client - [4bd33f43-6e66-4f09-8d0b-217eba00a719] Register server push request handler:com.alibaba.nacos.common.remote.client.RpcClient$$Lambda/0x00000297d1528cd8
2025-05-19 15:09:24.002 [com.alibaba.nacos.client.remote.worker] INFO  com.alibaba.nacos.common.remote.client - [4bd33f43-6e66-4f09-8d0b-217eba00a719] Notify connected event to listeners.
2025-05-19 15:09:24.002 [com.alibaba.nacos.client.remote.worker] INFO  com.alibaba.nacos.client.naming - Grpc connection connect
2025-05-19 15:09:24.003 [main] INFO  com.alibaba.nacos.client.naming - [REGISTER-SERVICE] d750d92e-152f-4055-a641-3bc9dda85a29 registering service bgtech-ai with instance Instance{instanceId='null', ip='192.168.86.8', port=8080, weight=1.0, healthy=true, enabled=true, ephemeral=true, clusterName='DEFAULT', serviceName='null', metadata={IPv6=[2408:820c:7528:8342:b486:9b72:4b72:4bf0], preserved.register.source=SPRING_CLOUD}}
2025-05-19 15:09:24.022 [main] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - nacos registry, DEFAULT_GROUP bgtech-ai 192.168.86.8:8080 register finished
2025-05-19 15:09:24.081 [main] INFO  com.bgpay.bgai.config.NacosConfig - 应用启动完成，当前环境: dev
2025-05-19 15:09:24.081 [main] INFO  com.bgpay.bgai.config.NacosConfig - Nacos配置中心: 8.133.246.113:8848, 命名空间: d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-19 15:09:24.081 [main] INFO  com.bgpay.bgai.config.NacosConfig - 注意: 如果看到Nacos配置加载警告，但应用正常启动，说明应用正在使用本地配置文件
2025-05-19 15:09:24.083 [main] INFO  com.bgpay.bgai.BgaiApplication - Started BgaiApplication in 16.266 seconds (process running for 17.629)
2025-05-19 15:09:24.087 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-19 15:09:24.087 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-19 15:09:24.097 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-19 15:09:24.098 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-19 15:09:24.098 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-19 15:09:24.107 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-19 15:09:24.108 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-19 15:09:24.108 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-19 15:09:24.116 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-19 15:09:24.116 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-19 15:09:24.117 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-19 15:09:24.123 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-19 15:09:24.123 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - ==================== Saga状态机加载报告 ====================
2025-05-19 15:09:24.123 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - Saga状态机配置加载状态: 成功
2025-05-19 15:09:24.123 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 已加载的状态机定义文件数量: 1
2025-05-19 15:09:24.123 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 已加载的状态机定义文件:
2025-05-19 15:09:24.123 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig -  - /E:/project/bgai/target/classes/statelang/bgai-saga-transaction.json
2025-05-19 15:09:24.123 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - Saga解析器状态: CUSTOM_FASTJSON2
2025-05-19 15:09:24.123 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 状态机解析结果: 成功 1 个, 失败 0 个
2025-05-19 15:09:24.123 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - =============================================================
2025-05-19 15:09:24.127 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - nacos.cache.data.init.snapshot = true 
2025-05-19 15:09:24.128 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] common-dev.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-19 15:09:24.139 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=common-dev.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-19 15:09:24.139 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=common-dev.yaml, group=DEFAULT_GROUP
2025-05-19 15:09:24.139 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-19 15:09:24.139 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-19 15:09:24.139 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai.yaml, group=DEFAULT_GROUP
2025-05-19 15:09:24.141 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai-dev.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-19 15:09:24.141 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai-dev.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-19 15:09:24.141 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai-dev.yaml, group=DEFAULT_GROUP
2025-05-19 15:09:24.141 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-19 15:09:24.141 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai, group=DEFAULT_GROUP, cnt=1
2025-05-19 15:09:24.141 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai, group=DEFAULT_GROUP
2025-05-19 15:09:29.276 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - 接收到请求: /api/chatGatWay-internal, 文件=新文件 17.txt, 问题参数=null, 模型参数=null
2025-05-19 15:09:29.278 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - 请求Content-Type: multipart/form-data;boundary=--------------------------367467232570206071272144
2025-05-19 15:09:29.279 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - 收集到的完整参数: question="null", apiUrl="null", modelName="null", multiTurn=false
2025-05-19 15:09:29.280 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - Processing request for user ID: 689258T
2025-05-19 15:09:29.280 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - Processing file with circuit breaker: fileName=新文件 17.txt, question=
2025-05-19 15:09:29.283 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.config.ReactiveFileProcessor - Processing file: 新文件 17.txt, content-type: text/plain
2025-05-19 15:09:29.289 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - PARAM TRACE [689258T]: 尝试查找匹配配置 - 参数: apiUrl=null, modelName=null
2025-05-19 15:09:29.302 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 查询配置 - userId=689258T
2025-05-19 15:09:29.303 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 排序方式 - 按ID降序
2025-05-19 15:09:29.303 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 限制结果数 - LIMIT 1
2025-05-19 15:09:29.374 [http-nio-8080-exec-2] DEBUG com.bgpay.bgai.mapper.ApiConfigMapper.selectList - ==>  Preparing: SELECT id,api_url,api_key,model_name,user_id FROM api_config WHERE (user_id = ?) ORDER BY id DESC LIMIT 1
2025-05-19 15:09:29.375 [http-nio-8080-exec-2] DEBUG com.bgpay.bgai.mapper.ApiConfigMapper.selectList - ==> Parameters: 689258T(String)
2025-05-19 15:09:29.384 [http-nio-8080-exec-2] DEBUG com.bgpay.bgai.mapper.ApiConfigMapper.selectList - <==      Total: 1
2025-05-19 15:09:29.385 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.service.impl.ApiConfigServiceImpl - 查询结果 - 找到配置: id=2, modelName=deepseek-chat
2025-05-19 15:09:29.385 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - PARAM TRACE [689258T]: 找到匹配配置 - apiUrl=https://api.deepseek.com/chat/completions, modelName=deepseek-chat (原始请求: null)
2025-05-19 15:09:29.385 [http-nio-8080-exec-2] INFO  com.bgpay.bgai.controller.ReactiveChatController - API config resolved: url=https://api.deepseek.com/chat/completions, model=deepseek-chat
2025-05-19 15:09:29.402 [Thread-49] INFO  com.bgpay.bgai.config.ReactiveFileProcessor - File processed successfully: size=2153 bytes
2025-05-19 15:09:29.406 [Thread-49] INFO  com.bgpay.bgai.controller.ReactiveChatController - Content processed, length: 2192
2025-05-19 15:09:29.412 [Thread-49] INFO  io.seata.tm.TransactionManagerHolder - TransactionManager Singleton io.seata.tm.DefaultTransactionManager@341f88e4
2025-05-19 15:09:29.428 [Thread-49] INFO  io.seata.tm.api.DefaultGlobalTransaction - Begin new global transaction [seata-server:8091:18666493999071238]
2025-05-19 15:09:29.430 [Thread-49] INFO  c.b.bgai.interceptor.SeataTransactionInterceptor - 准备记录分布式事务开始: XID=seata-server:8091:18666493999071238, 业务=com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive, 路径=, IP=, 用户=system
2025-05-19 15:09:29.447 [Thread-49] INFO  c.b.bgai.service.impl.TransactionLogServiceImpl - 记录分布式事务开始: XID=seata-server:8091:18666493999071238, 业务=com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive
2025-05-19 15:09:29.454 [Thread-49] DEBUG com.bgpay.bgai.mapper.TransactionLogMapper.insert - ==>  Preparing: INSERT INTO transaction_log ( xid, transaction_name, transaction_mode, status, request_path, source_ip, start_time, user_id, create_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-05-19 15:09:29.459 [Thread-49] DEBUG com.bgpay.bgai.mapper.TransactionLogMapper.insert - ==> Parameters: seata-server:8091:18666493999071238(String), com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive(String), AT(String), ACTIVE(String), (String), (String), 2025-05-19T15:09:29.447850800(LocalDateTime), system(String), 2025-05-19T15:09:29.447850800(LocalDateTime)
2025-05-19 15:09:29.921 [Thread-49] DEBUG com.bgpay.bgai.mapper.TransactionLogMapper.insert - <==    Updates: 1
2025-05-19 15:09:29.941 [Thread-49] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:18666493999071238, branchId:18666493999071239, lockKeys:transaction_log:7
2025-05-19 15:09:29.954 [Thread-49] WARN  i.s.c.l.EnhancedServiceLoader$InnerEnhancedServiceLoader - Load [io.seata.rm.datasource.undo.parser.ProtostuffUndoLogParser] class fail: io/protostuff/runtime/IdStrategy
2025-05-19 15:09:30.031 [Thread-49] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:18666493999071238, branchId:18666493999071240, lockKeys:transaction_log:7;undo_log:25
2025-05-19 15:09:30.059 [Thread-49] INFO  c.b.bgai.interceptor.SeataTransactionInterceptor - 开始分布式事务: XID=seata-server:8091:18666493999071238, 方法=com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive
2025-05-19 15:09:30.073 [Thread-49] INFO  org.reflections.Reflections - Processing reactive request: content length=2192, apiUrl=https://api.deepseek.com/chat/completions, modelName=deepseek-chat, userId=689258T, multiTurn=false
2025-05-19 15:09:30.097 [Thread-49] INFO  com.bgpay.bgai.transaction.TransactionCoordinator - Transaction prepared for user 689258T: chatCompletionId=chat-aaa17498-11a2-47e2-afd6-cae6d8409641
2025-05-19 15:09:30.099 [Thread-49] INFO  org.reflections.Reflections - Generated request JSON with 2PC transaction: {"stream":false,"max_tokens":2000,"temperature":1.0,"messages":[{"content":"You are a helpful assist...
2025-05-19 15:09:30.125 [Thread-49] INFO  c.b.bgai.service.impl.TransactionLogServiceImpl - 记录分布式事务结束: XID=seata-server:8091:18666493999071238, 状态=COMMITTED
2025-05-19 15:09:30.128 [Thread-49] DEBUG c.b.bgai.mapper.TransactionLogMapper.selectList - ==>  Preparing: SELECT id,xid,branch_id,transaction_name,transaction_mode,status,request_path,source_ip,start_time,end_time,user_id,extra_data,create_time,update_time FROM transaction_log WHERE (xid = ?) LIMIT 1
2025-05-19 15:09:30.131 [Thread-49] DEBUG c.b.bgai.mapper.TransactionLogMapper.selectList - ==> Parameters: seata-server:8091:18666493999071238(String)
2025-05-19 15:09:30.139 [Thread-49] DEBUG c.b.bgai.mapper.TransactionLogMapper.selectList - <==      Total: 1
2025-05-19 15:09:30.145 [Thread-49] DEBUG c.b.bgai.mapper.TransactionLogMapper.updateById - ==>  Preparing: UPDATE transaction_log SET xid=?, transaction_name=?, transaction_mode=?, status=?, request_path=?, source_ip=?, start_time=?, end_time=?, user_id=?, extra_data=?, create_time=?, update_time=? WHERE id=?
2025-05-19 15:09:30.153 [Thread-49] DEBUG c.b.bgai.mapper.TransactionLogMapper.updateById - ==> Parameters: seata-server:8091:18666493999071238(String), com.bgpay.bgai.service.deepseek.DeepSeekServiceImp.processRequestReactive(String), AT(String), COMMITTED(String), (String), (String), 2025-05-19T15:09:29(LocalDateTime), 2025-05-19T15:09:30.139831400(LocalDateTime), system(String), {"duration":60,"result":"success"}(String), 2025-05-19T15:09:29(LocalDateTime), 2025-05-19T15:09:30.139831400(LocalDateTime), 7(Long)
2025-05-19 15:09:30.212 [Thread-49] DEBUG c.b.bgai.mapper.TransactionLogMapper.updateById - <==    Updates: 1
2025-05-19 15:09:30.223 [Thread-49] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:18666493999071238, branchId:18666493999071241, lockKeys:transaction_log:7
2025-05-19 15:09:30.246 [Thread-49] INFO  io.seata.rm.AbstractResourceManager - branch register success, xid:seata-server:8091:18666493999071238, branchId:18666493999071242, lockKeys:transaction_log:7;undo_log:27
2025-05-19 15:09:30.269 [Thread-49] INFO  c.b.bgai.interceptor.SeataTransactionInterceptor - 分布式事务成功完成: XID=seata-server:8091:18666493999071238, 耗时=60ms
2025-05-19 15:09:30.269 [Thread-49] INFO  io.seata.tm.api.DefaultGlobalTransaction - transaction seata-server:8091:18666493999071238 will be commit
2025-05-19 15:09:30.282 [Thread-49] INFO  io.seata.tm.api.DefaultGlobalTransaction - transaction end, xid = seata-server:8091:18666493999071238
2025-05-19 15:09:30.282 [Thread-49] INFO  io.seata.tm.api.DefaultGlobalTransaction - [seata-server:8091:18666493999071238] commit status: Committed
2025-05-19 15:09:30.551 [rpcDispatch_RMROLE_1_1_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:18666493999071238', branchId=18666493999071239, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false,"skipCheckLock":true}'}
2025-05-19 15:09:30.553 [rpcDispatch_RMROLE_1_1_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:18666493999071238 18666493999071239 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false,"skipCheckLock":true}
2025-05-19 15:09:30.554 [rpcDispatch_RMROLE_1_1_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-19 15:09:30.566 [rpcDispatch_RMROLE_1_2_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:18666493999071238', branchId=18666493999071240, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false,"skipCheckLock":true}'}
2025-05-19 15:09:30.566 [rpcDispatch_RMROLE_1_2_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:18666493999071238 18666493999071240 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false,"skipCheckLock":true}
2025-05-19 15:09:30.566 [rpcDispatch_RMROLE_1_2_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-19 15:09:30.581 [rpcDispatch_RMROLE_1_3_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:18666493999071238', branchId=18666493999071241, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false}'}
2025-05-19 15:09:30.581 [rpcDispatch_RMROLE_1_3_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:18666493999071238 18666493999071241 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false}
2025-05-19 15:09:30.581 [rpcDispatch_RMROLE_1_3_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-19 15:09:30.590 [rpcDispatch_RMROLE_1_4_24] INFO  i.s.c.rpc.processor.client.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest{xid='seata-server:8091:18666493999071238', branchId=18666493999071242, branchType=AT, resourceId='jdbc:mysql://8.133.246.113:3306/deepseek', applicationData='{"autoCommit":false}'}
2025-05-19 15:09:30.591 [rpcDispatch_RMROLE_1_4_24] INFO  io.seata.rm.AbstractRMHandler - Branch committing: seata-server:8091:18666493999071238 18666493999071242 jdbc:mysql://8.133.246.113:3306/deepseek {"autoCommit":false}
2025-05-19 15:09:30.591 [rpcDispatch_RMROLE_1_4_24] INFO  io.seata.rm.AbstractRMHandler - Branch commit result: PhaseTwo_Committed
2025-05-19 15:09:56.336 [reactor-http-nio-3] INFO  org.reflections.Reflections - Raw response received, length: 2141
2025-05-19 15:09:56.341 [reactor-http-nio-3] WARN  org.reflections.Reflections - Received different chatCompletionId from response: aef1c00b-472b-4812-a35d-8f85d9f6d0ee vs prepared: chat-aaa17498-11a2-47e2-afd6-cae6d8409641
2025-05-19 15:09:56.358 [reactor-http-nio-3] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - ==>  Preparing: INSERT INTO chat_completions ( object, created, model, system_fingerprint, api_key ) VALUES ( ?, ?, ?, ?, ? )
2025-05-19 15:09:56.358 [reactor-http-nio-3] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - ==> Parameters: chat.completion(String), 1747638596356(Long), deepseek-chat(String), 689258T(String), chat-aaa17498-11a2-47e2-afd6-cae6d8409641(String)
2025-05-19 15:09:56.370 [reactor-http-nio-3] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - <==    Updates: 1
2025-05-19 15:09:56.371 [reactor-http-nio-3] INFO  com.bgpay.bgai.transaction.TransactionCoordinator - Transaction committed for user 689258T: chatCompletionId=chat-aaa17498-11a2-47e2-afd6-cae6d8409641
2025-05-19 15:09:56.404 [FileWrite-1] INFO  com.bgpay.bgai.service.deepseek.FileWriterService - Successfully wrote content to: \var\data\ai_responses\9ffa87a8-f833-4c5b-9d81-7160943357d1.txt
2025-05-19 15:09:56.415 [boundedElastic-1] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - ==>  Preparing: INSERT INTO chat_completions ( object, created, model, system_fingerprint, api_key ) VALUES ( ?, ?, ?, ?, ? )
2025-05-19 15:09:56.416 [boundedElastic-1] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - ==> Parameters: chat.completion(String), 1747638570(Long), deepseek-chat(String), fp_8802369eaa_prod0425fp8(String), chat-aaa17498-11a2-47e2-afd6-cae6d8409641(String)
2025-05-19 15:09:56.428 [boundedElastic-1] DEBUG c.bgpay.bgai.mapper.ChatCompletionsMapper.insert - <==    Updates: 1
2025-05-19 15:09:56.467 [boundedElastic-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.insert - ==>  Preparing: INSERT INTO usage_info ( chat_completion_id, prompt_tokens, completion_tokens, total_tokens, prompt_tokens_cached, completion_reasoning_tokens, prompt_cache_hit_tokens, prompt_cache_miss_tokens, created_at, model_type ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-05-19 15:09:56.468 [boundedElastic-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.insert - ==> Parameters: chat-aaa17498-11a2-47e2-afd6-cae6d8409641(String), 721(Integer), 402(Integer), 1123(Integer), 704(Integer), 0(Integer), 0(Integer), 17(Integer), 2025-05-19T15:09:56.457401500(LocalDateTime), deepseek-chat(String)
2025-05-19 15:09:56.481 [boundedElastic-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.insert - <==    Updates: 1
2025-05-19 15:09:56.507 [boundedElastic-1] INFO  org.reflections.Reflections - Completion data saved synchronously for chatCompletionId: chat-aaa17498-11a2-47e2-afd6-cae6d8409641
2025-05-19 15:09:56.511 [boundedElastic-2] INFO  org.reflections.Reflections - 开始发送账单消息，chatCompletionId: chat-aaa17498-11a2-47e2-afd6-cae6d8409641, userId: 689258T
2025-05-19 15:09:56.550 [boundedElastic-2] INFO  org.reflections.Reflections - 账单消息发送成功，chatCompletionId: chat-aaa17498-11a2-47e2-afd6-cae6d8409641, userId: 689258T
2025-05-19 15:09:56.553 [boundedElastic-1] INFO  org.reflections.Reflections - Complete processing chain completed: This appears to be a configuration file for Seata, an open-source distributed transaction solution. Let me break down the key configurations:

### Basic Configuration
- `enabled: true`: Enables Seata functionality
- `application-id: bgai`: Identifies the application
- `tx-service-group: bgai-tx-group`: Transaction service group name
- `enable-auto-data-source-proxy: true`: Enables automatic data source proxying

### Resource Manager (RM) Configuration
- Async commit buffer limit: 10,000
- Report retry count: 5
- Lock settings:
  - Retry interval: 10ms
  - Retry times: 30
  - Rollback on conflict: true

### Transaction Manager (TM) Configuration
- Commit/rollback retry count: 5
- Default global transaction timeout: 60,000ms (1 minute)
- Degrade check settings

### Undo Log Configuration
- Data validation enabled
- Uses Jackson for log serialization
- Undo log table name: `undo_log`

### Service Configuration
- Maps `bgai-tx-group` to default server
- TC server address: `8.133.246.113:8091`
- Global transaction enabled

### Transport Configuration
- Uses TCP/NIO
- Heartbeat enabled
- Thread pool settings for Netty
- Batch sending enabled

### Saga Configuration
- Saga mode enabled
- State machine settings:
  - Table prefix: `seata_`
  - Thread pool configuration
  - Timeout settings
  - Auto-registers resources from JSON files

This configuration sets up Seata for distributed transactions with:
- A connection to TC server at 8.133.246.113:8091
- Saga pattern support
- Reasonable timeout and retry settings
- Undo log tracking for transaction recovery

Would you like me to explain any specific part in more detail?
2025-05-19 15:09:56.553 [boundedElastic-1] INFO  com.bgpay.bgai.controller.ReactiveChatController - Processed response for user 689258T, content length: 1637
2025-05-19 15:10:19.695 [pool-7-thread-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.selectCount - ==>  Preparing: SELECT COUNT( * ) AS total FROM usage_info WHERE (chat_completion_id = ?)
2025-05-19 15:10:19.695 [pool-7-thread-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.selectCount - ==> Parameters: chat-aaa17498-11a2-47e2-afd6-cae6d8409641(String)
2025-05-19 15:10:19.701 [pool-7-thread-1] DEBUG com.bgpay.bgai.mapper.UsageInfoMapper.selectCount - <==      Total: 1
2025-05-19 15:10:19.878 [ConsumeMessageThread_billing-consumer-group_1] INFO  c.bgpay.bgai.service.mq.RocketMQBillingServiceImpl - Output price config priceVersion: 1
2025-05-19 15:10:19.881 [ConsumeMessageThread_billing-consumer-group_1] DEBUG com.bgpay.bgai.mapper.UsageRecordMapper.insert - ==>  Preparing: INSERT INTO usage_record ( model_type, chat_completion_id, user_id, input_cost, output_cost, price_version, calculated_at ) VALUES ( ?, ?, ?, ?, ?, ?, ? )
2025-05-19 15:10:19.882 [ConsumeMessageThread_billing-consumer-group_1] DEBUG com.bgpay.bgai.mapper.UsageRecordMapper.insert - ==> Parameters: deepseek-chat(String), chat-aaa17498-11a2-47e2-afd6-cae6d8409641(String), 689258T(String), 0.0000(BigDecimal), 0.0032(BigDecimal), 1(Integer), 2025-05-19T15:10:19.878639600(LocalDateTime)
2025-05-19 15:10:19.898 [ConsumeMessageThread_billing-consumer-group_1] DEBUG com.bgpay.bgai.mapper.UsageRecordMapper.insert - <==    Updates: 1
2025-05-19 15:10:19.909 [ConsumeMessageThread_billing-consumer-group_1] INFO  c.bgpay.bgai.service.mq.RocketMQBillingServiceImpl - Message consumed: 2408820C75288342B4869B724B724BF0D36036BAF30C5FF38BB60000
2025-05-19 15:10:32.258 [Thread-7] WARN  com.alibaba.nacos.common.notify.NotifyCenter - [NotifyCenter] Start destroying Publisher
2025-05-19 15:10:32.259 [Thread-7] WARN  com.alibaba.nacos.common.notify.NotifyCenter - [NotifyCenter] Destruction of the end
2025-05-19 15:10:32.259 [Thread-1] WARN  c.alibaba.nacos.common.http.HttpClientBeanHolder - [HttpClientBeanHolder] Start destroying common HttpClient
2025-05-19 15:10:32.259 [Thread-1] WARN  c.alibaba.nacos.common.http.HttpClientBeanHolder - [HttpClientBeanHolder] Destruction of the end
2025-05-19 15:10:32.279 [NettyClientSelector_TMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - channel inactive: [id: 0x12586f91, L:/192.168.86.8:55882 ! R:/8.133.246.113:8091]
2025-05-19 15:10:32.279 [NettyClientSelector_TMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - return to pool, rm channel:[id: 0x12586f91, L:/192.168.86.8:55882 ! R:/8.133.246.113:8091]
2025-05-19 15:10:32.279 [NettyClientSelector_TMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - channel valid false,channel:[id: 0x12586f91, L:/192.168.86.8:55882 ! R:/8.133.246.113:8091]
2025-05-19 15:10:32.279 [NettyClientSelector_TMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - will destroy channel:[id: 0x12586f91, L:/192.168.86.8:55882 ! R:/8.133.246.113:8091]
2025-05-19 15:10:32.279 [NettyClientSelector_TMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0x12586f91, L:/192.168.86.8:55882 ! R:/8.133.246.113:8091]) will closed
2025-05-19 15:10:32.279 [NettyClientSelector_TMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0x12586f91, L:/192.168.86.8:55882 ! R:/8.133.246.113:8091]) will closed
2025-05-19 15:10:32.279 [NettyClientSelector_RMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - channel inactive: [id: 0xd7e3cea3, L:/192.168.86.8:55889 ! R:/8.133.246.113:8091]
2025-05-19 15:10:32.279 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - return to pool, rm channel:[id: 0xd7e3cea3, L:/192.168.86.8:55889 ! R:/8.133.246.113:8091]
2025-05-19 15:10:32.279 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - channel valid false,channel:[id: 0xd7e3cea3, L:/192.168.86.8:55889 ! R:/8.133.246.113:8091]
2025-05-19 15:10:32.279 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - will destroy channel:[id: 0xd7e3cea3, L:/192.168.86.8:55889 ! R:/8.133.246.113:8091]
2025-05-19 15:10:32.279 [NettyClientSelector_RMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0xd7e3cea3, L:/192.168.86.8:55889 ! R:/8.133.246.113:8091]) will closed
2025-05-19 15:10:32.279 [NettyClientSelector_RMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0xd7e3cea3, L:/192.168.86.8:55889 ! R:/8.133.246.113:8091]) will closed
2025-05-19 15:10:32.282 [SpringContextShutdownHook] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - De-registering from Nacos Server now...
2025-05-19 15:10:32.282 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - [DEREGISTER-SERVICE] d750d92e-152f-4055-a641-3bc9dda85a29 deregistering service bgtech-ai with instance: Instance{instanceId='null', ip='192.168.86.8', port=8080, weight=1.0, healthy=true, enabled=true, ephemeral=true, clusterName='DEFAULT', serviceName='null', metadata={}}
2025-05-19 15:10:32.291 [SpringContextShutdownHook] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - De-registration finished.
2025-05-19 15:10:32.292 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.cache.ServiceInfoHolder do shutdown begin
2025-05-19 15:10:32.292 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.backups.FailoverReactor do shutdown begin
2025-05-19 15:10:32.292 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.backups.FailoverReactor do shutdown stop
2025-05-19 15:10:32.292 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.cache.ServiceInfoHolder do shutdown stop
2025-05-19 15:10:32.292 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.NamingClientProxyDelegate do shutdown begin
2025-05-19 15:10:32.292 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServiceInfoUpdateService do shutdown begin
2025-05-19 15:10:32.292 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServiceInfoUpdateService do shutdown stop
2025-05-19 15:10:32.293 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServerListManager do shutdown begin
2025-05-19 15:10:32.293 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Start destroying NacosRestTemplate
2025-05-19 15:10:32.293 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Destruction of the end
2025-05-19 15:10:32.293 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServerListManager do shutdown stop
2025-05-19 15:10:32.293 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.http.NamingHttpClientProxy do shutdown begin
2025-05-19 15:10:32.293 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Start destroying NacosRestTemplate
2025-05-19 15:10:32.293 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Destruction of the end
2025-05-19 15:10:32.293 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.http.NamingHttpClientProxy do shutdown stop
2025-05-19 15:10:32.293 [SpringContextShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Shutdown rpc client, set status to shutdown
2025-05-19 15:10:32.293 [SpringContextShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Shutdown client event executor java.util.concurrent.ScheduledThreadPoolExecutor@7166a6f7[Running, pool size = 2, active threads = 2, queued tasks = 0, completed tasks = 0]
2025-05-19 15:10:32.293 [SpringContextShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Close current connection 1747638563897_139.227.195.203_42445
2025-05-19 15:10:32.296 [nacos-grpc-client-executor-8.133.246.113-22] WARN  c.a.nacos.common.remote.client.grpc.GrpcClient - [1747638563897_139.227.195.203_42445]Ignore error event,isRunning:false,isAbandon=false
2025-05-19 15:10:32.298 [SpringContextShutdownHook] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - Shutdown grpc executor java.util.concurrent.ThreadPoolExecutor@50a9fa29[Running, pool size = 6, active threads = 0, queued tasks = 0, completed tasks = 23]
2025-05-19 15:10:32.298 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - Shutdown grpc redo service executor java.util.concurrent.ScheduledThreadPoolExecutor@43dbbaf5[Running, pool size = 1, active threads = 0, queued tasks = 1, completed tasks = 22]
2025-05-19 15:10:32.299 [SpringContextShutdownHook] INFO  c.a.n.client.auth.ram.identify.CredentialWatcher - [null] CredentialWatcher is stopped
2025-05-19 15:10:32.299 [SpringContextShutdownHook] INFO  c.a.n.client.auth.ram.identify.CredentialService - [null] CredentialService is freed
2025-05-19 15:10:32.299 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.NamingClientProxyDelegate do shutdown stop
2025-05-19 15:10:33.709 [com.alibaba.nacos.client.Worker] INFO  c.a.n.client.auth.ram.identify.CredentialWatcher - null No credential found
2025-05-19 15:10:34.331 [SpringContextShutdownHook] DEBUG com.bgpay.bgai.config.AsyncConfig$1 - Shutting down ExecutorService 'blockingExecutor'
2025-05-19 15:10:34.382 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:10909] result: true
2025-05-19 15:10:34.382 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:10911] result: true
2025-05-19 15:10:34.382 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:9876] result: true
2025-05-19 15:10:34.395 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:10911] result: true
2025-05-19 15:10:34.396 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:9876] result: true
2025-05-19 15:10:34.508 [SpringContextShutdownHook] INFO  o.s.orm.jpa.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-05-19 15:10:34.510 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-2} closing ...
2025-05-19 15:10:34.515 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-2} closed
2025-05-19 15:10:34.515 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} closing ...
2025-05-19 15:10:34.515 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} closed
2025-05-19 15:17:00.999 [main] WARN  com.alibaba.nacos.client.logging.NacosLogging - Load Logback Configuration of Nacos fail, message: Could not initialize Logback Nacos logging from classpath:nacos-logback.xml
2025-05-19 15:17:01.000 [main] INFO  com.bgpay.bgai.BgaiApplication - The following 1 profile is active: "dev"
2025-05-19 15:17:02.306 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-05-19 15:17:02.307 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-05-19 15:17:02.329 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 16 ms. Found 0 JPA repository interfaces.
2025-05-19 15:17:02.340 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-05-19 15:17:02.341 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-05-19 15:17:02.352 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 4 ms. Found 0 Redis repository interfaces.
2025-05-19 15:17:02.933 [main] INFO  io.seata.config.ConfigurationFactory - load Configuration from :Spring Configuration
2025-05-19 15:17:02.942 [main] INFO  io.seata.config.ConfigurationFactory - load Configuration from :Spring Configuration
2025-05-19 15:17:02.948 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Initializing Global Transaction Clients ... 
2025-05-19 15:17:03.049 [main] INFO  io.seata.core.rpc.netty.NettyClientBootstrap - NettyClientBootstrap has started
2025-05-19 15:17:03.050 [main] INFO  io.seata.discovery.registry.RegistryFactory - use registry center type: file
2025-05-19 15:17:03.060 [main] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - will connect to 8.133.246.113:8091
2025-05-19 15:17:03.064 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - NettyPool create channel to transactionRole:TMROLE,address:8.133.246.113:8091,msg:< RegisterTMRequest{version='1.7.0', applicationId='bgtech-ai', transactionServiceGroup='bgai-tx-group', extraData='ak=null
digest=bgai-tx-group,192.168.86.8,1747639023063
timestamp=1747639023063
authVersion=V4
vgroup=bgai-tx-group
ip=192.168.86.8
'} >
2025-05-19 15:17:03.197 [main] INFO  io.seata.core.rpc.netty.TmNettyRemotingClient - register TM success. client version:1.7.0, server version:1.8.1-SNAPSHOT,channel:[id: 0x6c761f46, L:/192.168.86.8:55793 - R:/8.133.246.113:8091]
2025-05-19 15:17:03.205 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - register success, cost 65 ms, version:1.8.1-SNAPSHOT,role:TMROLE,channel:[id: 0x6c761f46, L:/192.168.86.8:55793 - R:/8.133.246.113:8091]
2025-05-19 15:17:03.205 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Transaction Manager Client is initialized. applicationId[bgtech-ai] txServiceGroup[bgai-tx-group]
2025-05-19 15:17:03.217 [main] INFO  io.seata.rm.datasource.AsyncWorker - Async Commit Buffer Limit: 10000
2025-05-19 15:17:03.218 [main] INFO  io.seata.rm.datasource.xa.ResourceManagerXA - ResourceManagerXA init ...
2025-05-19 15:17:03.225 [main] INFO  io.seata.core.rpc.netty.NettyClientBootstrap - NettyClientBootstrap has started
2025-05-19 15:17:03.225 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Resource Manager is initialized. applicationId[bgtech-ai] txServiceGroup[bgai-tx-group]
2025-05-19 15:17:03.225 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Global Transaction Clients are initialized. 
2025-05-19 15:17:04.369 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat initialized with port(s): 8080 (http)
2025-05-19 15:17:04.379 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - The ["http-nio-8080"] connector has been configured to support HTTP upgrade to [h2c]
2025-05-19 15:17:04.379 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - Initializing ProtocolHandler ["http-nio-8080"]
2025-05-19 15:17:04.380 [main] INFO  org.apache.catalina.core.StandardService - Starting service [Tomcat]
2025-05-19 15:17:04.380 [main] INFO  org.apache.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.15]
2025-05-19 15:17:04.744 [main] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} inited
2025-05-19 15:17:04.985 [main] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - will connect to 8.133.246.113:8091
2025-05-19 15:17:04.985 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - RM will register :jdbc:mysql://8.133.246.113:3306/deepseek
2025-05-19 15:17:04.985 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - NettyPool create channel to transactionRole:RMROLE,address:8.133.246.113:8091,msg:< RegisterRMRequest{resourceIds='jdbc:mysql://8.133.246.113:3306/deepseek', version='1.7.0', applicationId='bgtech-ai', transactionServiceGroup='bgai-tx-group', extraData='null'} >
2025-05-19 15:17:05.006 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - register RM success. client version:1.7.0, server version:1.8.1-SNAPSHOT,channel:[id: 0x7085cdd6, L:/192.168.86.8:55800 - R:/8.133.246.113:8091]
2025-05-19 15:17:05.006 [main] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - register success, cost 13 ms, version:1.8.1-SNAPSHOT,role:RMROLE,channel:[id: 0x7085cdd6, L:/192.168.86.8:55800 - R:/8.133.246.113:8091]
2025-05-19 15:17:05.008 [main] INFO  i.s.s.a.datasource.SeataAutoDataSourceProxyCreator - Auto proxy data source 'masterDataSource' by 'AT' mode.
2025-05-19 15:17:05.081 [main] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-2} inited
2025-05-19 15:17:05.143 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - will register resourceId:jdbc:mysql://8.133.246.113:3306/deepseek
2025-05-19 15:17:05.144 [main] INFO  i.s.s.a.datasource.SeataAutoDataSourceProxyCreator - Auto proxy data source 'slaveDataSource' by 'AT' mode.
2025-05-19 15:17:05.152 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.rm.AbstractRMHandler - the rm client received response msg [RegisterRMResponse{version='1.8.1-SNAPSHOT', extraData='null', identified=true, resultCode=null, msg='null'}] from tc server.
2025-05-19 15:17:05.165 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - will register resourceId:jdbc:mysql://8.133.246.113:3306/deepseek
2025-05-19 15:17:05.165 [main] INFO  i.s.s.a.datasource.SeataAutoDataSourceProxyCreator - Auto proxy data source 'dynamicDataSource' by 'AT' mode.
2025-05-19 15:17:05.174 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.rm.AbstractRMHandler - the rm client received response msg [RegisterRMResponse{version='1.8.1-SNAPSHOT', extraData='null', identified=true, resultCode=null, msg='null'}] from tc server.
2025-05-19 15:17:05.276 [main] INFO  org.hibernate.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-05-19 15:17:05.345 [main] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.1.7.Final
2025-05-19 15:17:05.687 [main] INFO  SQL dialect - HHH000400: Using dialect: org.hibernate.dialect.MySQL8Dialect
2025-05-19 15:17:05.689 [main] WARN  org.hibernate.orm.deprecation - HHH90000026: MySQL8Dialect has been deprecated; use org.hibernate.dialect.MySQLDialect instead
2025-05-19 15:17:05.941 [main] INFO  o.h.e.t.jta.platform.internal.JtaPlatformInitiator - HHH000490: Using JtaPlatform implementation: [org.hibernate.engine.transaction.jta.platform.internal.NoJtaPlatform]
2025-05-19 15:17:05.951 [main] INFO  o.s.orm.jpa.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-05-19 15:17:06.305 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-19 15:17:06.315 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-19 15:17:06.341 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-19 15:17:06.343 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-19 15:17:06.343 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-19 15:17:06.354 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-19 15:17:06.965 [main] INFO  com.bgpay.bgai.service.impl.UserServiceImpl - 初始化SSO配置: clientId=bgai-client-id, redirectUri=http://localhost:8080/api/auth/callback
2025-05-19 15:17:07.094 [main] INFO  com.bgpay.bgai.controller.AuthController - 初始化认证控制器: clientId=bgai-client-id, redirectUri=http://localhost:8080/api/auth/callback
2025-05-19 15:17:07.672 [main] INFO  o.a.r.s.autoconfigure.RocketMQAutoConfiguration - a producer (billing-producer-group) init on namesrv 8.133.246.113:9876
2025-05-19 15:17:07.921 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Bean [com.bgpay.bgai.service.deepseek.DeepSeekServiceImp$$SpringCGLIB$$0] with name [deepSeekServiceImp] would use interceptor [io.seata.spring.annotation.GlobalTransactionalInterceptor]
2025-05-19 15:17:08.241 [main] WARN  i.s.s.b.a.provider.SpringBootConfigurationProvider - The get method not found for the field 'SeataProperties#accesskey'.
2025-05-19 15:17:08.241 [main] WARN  i.s.s.b.a.provider.SpringBootConfigurationProvider - The get method not found for the field 'SeataProperties#secretkey'.
2025-05-19 15:17:08.252 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 加载到1个Saga状态机定义文件
2025-05-19 15:17:08.398 [main] INFO  com.bgpay.bgai.saga.CustomSagaJsonParser - 开始解析状态机定义: bgai-saga-transaction
2025-05-19 15:17:08.399 [main] INFO  com.bgpay.bgai.saga.CustomSagaJsonParser - 状态机定义解析成功: bgai-saga-transaction
2025-05-19 15:17:08.399 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 成功加载状态机定义: /E:/project/bgai/target/classes/statelang/bgai-saga-transaction.json
2025-05-19 15:17:08.869 [main] INFO  org.redisson.Version - Redisson 3.24.3
2025-05-19 15:17:08.995 [redisson-netty-4-6] INFO  o.r.connection.pool.MasterPubSubConnectionPool - 1 connections initialized for 8.133.246.113/8.133.246.113:6379
2025-05-19 15:17:09.389 [redisson-netty-4-19] INFO  org.redisson.connection.pool.MasterConnectionPool - 24 connections initialized for 8.133.246.113/8.133.246.113:6379
2025-05-19 15:17:09.644 [main] INFO  com.bgpay.bgai.service.mq.MQConsumerService - MQ consumer startup successful [group=billing-consumer-group, topic=BILLING_TOPIC, tag=USER_BILLING]
2025-05-19 15:17:09.799 [main] INFO  i.seata.spring.annotation.GlobalTransactionScanner - Bean [com.bgpay.bgai.service.impl.SeataTransactionService$$SpringCGLIB$$0] with name [seataTransactionService] would use interceptor [io.seata.spring.annotation.GlobalTransactionalInterceptor]
2025-05-19 15:17:09.925 [main] DEBUG com.bgpay.bgai.config.AsyncConfig$1 - Initializing ExecutorService 'blockingExecutor'
2025-05-19 15:17:09.949 [main] INFO  c.b.bgai.config.NacosConfig$NacosWarningHandler - Nacos警告处理器已启用，将忽略配置中心连接警告
2025-05-19 15:17:11.212 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [After]
2025-05-19 15:17:11.213 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Before]
2025-05-19 15:17:11.213 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Between]
2025-05-19 15:17:11.213 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Cookie]
2025-05-19 15:17:11.213 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Header]
2025-05-19 15:17:11.213 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Host]
2025-05-19 15:17:11.213 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Method]
2025-05-19 15:17:11.213 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Path]
2025-05-19 15:17:11.213 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Query]
2025-05-19 15:17:11.213 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [ReadBody]
2025-05-19 15:17:11.213 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [RemoteAddr]
2025-05-19 15:17:11.213 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [XForwardedRemoteAddr]
2025-05-19 15:17:11.213 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [Weight]
2025-05-19 15:17:11.213 [main] INFO  o.s.c.gateway.route.RouteDefinitionRouteLocator - Loaded RoutePredicateFactory [CloudFoundryRouteService]
2025-05-19 15:17:12.718 [main] INFO  o.s.b.actuate.endpoint.web.EndpointLinksResolver - Exposing 1 endpoint(s) beneath base path '/actuator'
2025-05-19 15:17:13.080 [main] WARN  i.s.s.b.a.provider.SpringBootConfigurationProvider - The get method not found for the field 'SeataProperties#accesskey'.
2025-05-19 15:17:13.080 [main] WARN  i.s.s.b.a.provider.SpringBootConfigurationProvider - The get method not found for the field 'SeataProperties#secretkey'.
2025-05-19 15:17:13.094 [main] INFO  io.seata.saga.tm.DefaultSagaTransactionalTemplate - Initializing Global Transaction Clients ... 
2025-05-19 15:17:13.094 [main] INFO  io.seata.saga.tm.DefaultSagaTransactionalTemplate - Transaction Manager Client is initialized. applicationId[bgtech-ai] txServiceGroup[bgai-tx-group]
2025-05-19 15:17:13.094 [main] INFO  io.seata.saga.tm.DefaultSagaTransactionalTemplate - Resource Manager is initialized. applicationId[bgtech-ai] txServiceGroup[bgai-tx-group]
2025-05-19 15:17:13.095 [main] INFO  io.seata.core.rpc.netty.RmNettyRemotingClient - will register resourceId:bgtech-ai#bgai-tx-group
2025-05-19 15:17:13.095 [main] INFO  io.seata.saga.tm.DefaultSagaTransactionalTemplate - Global Transaction Clients are initialized. 
2025-05-19 15:17:13.104 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.rm.AbstractRMHandler - the rm client received response msg [RegisterRMResponse{version='1.8.1-SNAPSHOT', extraData='null', identified=true, resultCode=null, msg='null'}] from tc server.
2025-05-19 15:17:14.379 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - Starting ProtocolHandler ["http-nio-8080"]
2025-05-19 15:17:14.393 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat started on port(s): 8080 (http) with context path ''
2025-05-19 15:17:14.404 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from ans.namespace attribute : null
2025-05-19 15:17:14.404 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from ALIBABA_ALIWARE_NAMESPACE attribute :null
2025-05-19 15:17:14.405 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from namespace attribute :null
2025-05-19 15:17:14.413 [main] INFO  c.a.n.p.auth.spi.client.ClientAuthPluginManager - [ClientAuthPluginManager] Load ClientAuthService com.alibaba.nacos.client.auth.impl.NacosClientAuthServiceImpl success.
2025-05-19 15:17:14.414 [main] INFO  c.a.n.p.auth.spi.client.ClientAuthPluginManager - [ClientAuthPluginManager] Load ClientAuthService com.alibaba.nacos.client.auth.ram.RamClientAuthServiceImpl success.
2025-05-19 15:17:14.417 [main] INFO  com.alibaba.nacos.common.remote.client - [RpcClientFactory] create a new rpc client of e32d6cd2-bf8d-4563-8a19-b3b52baa292c
2025-05-19 15:17:14.419 [main] INFO  com.alibaba.nacos.common.remote.client - [e32d6cd2-bf8d-4563-8a19-b3b52baa292c] RpcClient init, ServerListFactory = com.alibaba.nacos.client.naming.core.ServerListManager
2025-05-19 15:17:14.419 [main] INFO  com.alibaba.nacos.common.remote.client - [e32d6cd2-bf8d-4563-8a19-b3b52baa292c] Registry connection listener to current client:com.alibaba.nacos.client.naming.remote.gprc.redo.NamingGrpcRedoService
2025-05-19 15:17:14.419 [main] INFO  com.alibaba.nacos.common.remote.client - [e32d6cd2-bf8d-4563-8a19-b3b52baa292c] Register server push request handler:com.alibaba.nacos.client.naming.remote.gprc.NamingPushRequestHandler
2025-05-19 15:17:14.420 [main] INFO  com.alibaba.nacos.common.remote.client - [e32d6cd2-bf8d-4563-8a19-b3b52baa292c] Try to connect to server on start up, server: {serverIp = '8.133.246.113', server main port = 8848}
2025-05-19 15:17:14.420 [main] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - grpc client connection server:8.133.246.113 ip,serverPort:9848,grpcTslConfig:{"sslProvider":"OPENSSL","enableTls":false,"mutualAuthEnable":false,"trustAll":false}
2025-05-19 15:17:14.551 [main] INFO  com.alibaba.nacos.common.remote.client - [e32d6cd2-bf8d-4563-8a19-b3b52baa292c] Success to connect to server [8.133.246.113:8848] on start up, connectionId = 1747639034443_139.227.195.203_42427
2025-05-19 15:17:14.551 [main] INFO  com.alibaba.nacos.common.remote.client - [e32d6cd2-bf8d-4563-8a19-b3b52baa292c] Register server push request handler:com.alibaba.nacos.common.remote.client.RpcClient$ConnectResetRequestHandler
2025-05-19 15:17:14.551 [com.alibaba.nacos.client.remote.worker] INFO  com.alibaba.nacos.common.remote.client - [e32d6cd2-bf8d-4563-8a19-b3b52baa292c] Notify connected event to listeners.
2025-05-19 15:17:14.551 [main] INFO  com.alibaba.nacos.common.remote.client - [e32d6cd2-bf8d-4563-8a19-b3b52baa292c] Register server push request handler:com.alibaba.nacos.common.remote.client.RpcClient$$Lambda/0x0000022514529c60
2025-05-19 15:17:14.551 [com.alibaba.nacos.client.remote.worker] INFO  com.alibaba.nacos.client.naming - Grpc connection connect
2025-05-19 15:17:14.552 [main] INFO  com.alibaba.nacos.client.naming - [REGISTER-SERVICE] d750d92e-152f-4055-a641-3bc9dda85a29 registering service bgtech-ai with instance Instance{instanceId='null', ip='192.168.86.8', port=8080, weight=1.0, healthy=true, enabled=true, ephemeral=true, clusterName='DEFAULT', serviceName='null', metadata={IPv6=[2408:820c:7528:8342:b486:9b72:4b72:4bf0], preserved.register.source=SPRING_CLOUD}}
2025-05-19 15:17:14.574 [main] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - nacos registry, DEFAULT_GROUP bgtech-ai 192.168.86.8:8080 register finished
2025-05-19 15:17:14.637 [main] INFO  com.bgpay.bgai.config.NacosConfig - 应用启动完成，当前环境: dev
2025-05-19 15:17:14.637 [main] INFO  com.bgpay.bgai.config.NacosConfig - Nacos配置中心: 8.133.246.113:8848, 命名空间: d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-19 15:17:14.637 [main] INFO  com.bgpay.bgai.config.NacosConfig - 注意: 如果看到Nacos配置加载警告，但应用正常启动，说明应用正在使用本地配置文件
2025-05-19 15:17:14.639 [main] INFO  com.bgpay.bgai.BgaiApplication - Started BgaiApplication in 15.689 seconds (process running for 17.015)
2025-05-19 15:17:14.641 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-19 15:17:14.641 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-19 15:17:14.653 [scheduling-1] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-19 15:17:14.654 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==>  Preparing: SELECT * FROM mime_type_config WHERE enabled = true
2025-05-19 15:17:14.654 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - ==> Parameters: 
2025-05-19 15:17:14.665 [main] DEBUG c.b.b.mapper.FileTypeMapper.selectActiveMimeTypes - <==      Total: 52
2025-05-19 15:17:14.665 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-19 15:17:14.665 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-19 15:17:14.673 [scheduling-1] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-19 15:17:14.673 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==>  Preparing: SELECT mime_type FROM allowed_file_type WHERE enabled = true
2025-05-19 15:17:14.674 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - ==> Parameters: 
2025-05-19 15:17:14.679 [main] DEBUG c.b.bgai.mapper.FileTypeMapper.selectAllowedTypes - <==      Total: 52
2025-05-19 15:17:14.679 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - ==================== Saga状态机加载报告 ====================
2025-05-19 15:17:14.679 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - Saga状态机配置加载状态: 成功
2025-05-19 15:17:14.679 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 已加载的状态机定义文件数量: 1
2025-05-19 15:17:14.679 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 已加载的状态机定义文件:
2025-05-19 15:17:14.679 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig -  - /E:/project/bgai/target/classes/statelang/bgai-saga-transaction.json
2025-05-19 15:17:14.679 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - Saga解析器状态: CUSTOM_FASTJSON2
2025-05-19 15:17:14.680 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - 状态机解析结果: 成功 1 个, 失败 0 个
2025-05-19 15:17:14.680 [main] INFO  com.bgpay.bgai.config.SagaStateMachineConfig - =============================================================
2025-05-19 15:17:14.685 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - nacos.cache.data.init.snapshot = true 
2025-05-19 15:17:14.685 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] common-dev.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-19 15:17:14.695 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=common-dev.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-19 15:17:14.695 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=common-dev.yaml, group=DEFAULT_GROUP
2025-05-19 15:17:14.695 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-19 15:17:14.696 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-19 15:17:14.696 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai.yaml, group=DEFAULT_GROUP
2025-05-19 15:17:14.697 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai-dev.yaml+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-19 15:17:14.697 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai-dev.yaml, group=DEFAULT_GROUP, cnt=1
2025-05-19 15:17:14.697 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai-dev.yaml, group=DEFAULT_GROUP
2025-05-19 15:17:14.698 [main] INFO  com.alibaba.nacos.client.config.impl.ClientWorker - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [subscribe] bgtech-ai+DEFAULT_GROUP+d750d92e-152f-4055-a641-3bc9dda85a29
2025-05-19 15:17:14.698 [main] INFO  com.alibaba.nacos.client.config.impl.CacheData - [fixed-d750d92e-152f-4055-a641-3bc9dda85a29-8.133.246.113_8848] [add-listener] ok, tenant=d750d92e-152f-4055-a641-3bc9dda85a29, dataId=bgtech-ai, group=DEFAULT_GROUP, cnt=1
2025-05-19 15:17:14.698 [main] INFO  c.a.cloud.nacos.refresh.NacosContextRefresher - [Nacos Config] Listening config: dataId=bgtech-ai, group=DEFAULT_GROUP
2025-05-19 15:17:27.661 [Thread-7] WARN  com.alibaba.nacos.common.notify.NotifyCenter - [NotifyCenter] Start destroying Publisher
2025-05-19 15:17:27.662 [Thread-1] WARN  c.alibaba.nacos.common.http.HttpClientBeanHolder - [HttpClientBeanHolder] Start destroying common HttpClient
2025-05-19 15:17:27.662 [Thread-7] WARN  com.alibaba.nacos.common.notify.NotifyCenter - [NotifyCenter] Destruction of the end
2025-05-19 15:17:27.662 [Thread-1] WARN  c.alibaba.nacos.common.http.HttpClientBeanHolder - [HttpClientBeanHolder] Destruction of the end
2025-05-19 15:17:27.690 [NettyClientSelector_RMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - channel inactive: [id: 0x7085cdd6, L:/192.168.86.8:55800 ! R:/8.133.246.113:8091]
2025-05-19 15:17:27.691 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyClientChannelManager - return to pool, rm channel:[id: 0x7085cdd6, L:/192.168.86.8:55800 ! R:/8.133.246.113:8091]
2025-05-19 15:17:27.691 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - channel valid false,channel:[id: 0x7085cdd6, L:/192.168.86.8:55800 ! R:/8.133.246.113:8091]
2025-05-19 15:17:27.691 [NettyClientSelector_RMROLE_1_1] INFO  io.seata.core.rpc.netty.NettyPoolableFactory - will destroy channel:[id: 0x7085cdd6, L:/192.168.86.8:55800 ! R:/8.133.246.113:8091]
2025-05-19 15:17:27.691 [NettyClientSelector_RMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0x7085cdd6, L:/192.168.86.8:55800 ! R:/8.133.246.113:8091]) will closed
2025-05-19 15:17:27.691 [NettyClientSelector_RMROLE_1_1] INFO  i.seata.core.rpc.netty.AbstractNettyRemotingClient - ChannelHandlerContext(AbstractNettyRemotingClient$ClientHandler#0, [id: 0x7085cdd6, L:/192.168.86.8:55800 ! R:/8.133.246.113:8091]) will closed
2025-05-19 15:17:27.694 [SpringContextShutdownHook] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - De-registering from Nacos Server now...
2025-05-19 15:17:27.694 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - [DEREGISTER-SERVICE] d750d92e-152f-4055-a641-3bc9dda85a29 deregistering service bgtech-ai with instance: Instance{instanceId='null', ip='192.168.86.8', port=8080, weight=1.0, healthy=true, enabled=true, ephemeral=true, clusterName='DEFAULT', serviceName='null', metadata={}}
2025-05-19 15:17:27.713 [SpringContextShutdownHook] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - De-registration finished.
2025-05-19 15:17:27.715 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.cache.ServiceInfoHolder do shutdown begin
2025-05-19 15:17:27.715 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.backups.FailoverReactor do shutdown begin
2025-05-19 15:17:27.720 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.backups.FailoverReactor do shutdown stop
2025-05-19 15:17:27.721 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.cache.ServiceInfoHolder do shutdown stop
2025-05-19 15:17:27.721 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.NamingClientProxyDelegate do shutdown begin
2025-05-19 15:17:27.721 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServiceInfoUpdateService do shutdown begin
2025-05-19 15:17:27.721 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServiceInfoUpdateService do shutdown stop
2025-05-19 15:17:27.721 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServerListManager do shutdown begin
2025-05-19 15:17:27.721 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Start destroying NacosRestTemplate
2025-05-19 15:17:27.721 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Destruction of the end
2025-05-19 15:17:27.722 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServerListManager do shutdown stop
2025-05-19 15:17:27.722 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.http.NamingHttpClientProxy do shutdown begin
2025-05-19 15:17:27.722 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Start destroying NacosRestTemplate
2025-05-19 15:17:27.722 [SpringContextShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Destruction of the end
2025-05-19 15:17:27.722 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.http.NamingHttpClientProxy do shutdown stop
2025-05-19 15:17:27.722 [SpringContextShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Shutdown rpc client, set status to shutdown
2025-05-19 15:17:27.722 [SpringContextShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Shutdown client event executor java.util.concurrent.ScheduledThreadPoolExecutor@7fd8b289[Running, pool size = 2, active threads = 2, queued tasks = 0, completed tasks = 0]
2025-05-19 15:17:27.722 [SpringContextShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Close current connection 1747639034443_139.227.195.203_42427
2025-05-19 15:17:27.788 [nacos-grpc-client-executor-8.133.246.113-10] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - [1747639034443_139.227.195.203_42427]Ignore complete event,isRunning:false,isAbandon=false
2025-05-19 15:17:27.792 [SpringContextShutdownHook] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - Shutdown grpc executor java.util.concurrent.ThreadPoolExecutor@4147f46d[Running, pool size = 4, active threads = 0, queued tasks = 0, completed tasks = 11]
2025-05-19 15:17:27.795 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - Shutdown grpc redo service executor java.util.concurrent.ScheduledThreadPoolExecutor@3a4a86a9[Running, pool size = 1, active threads = 0, queued tasks = 1, completed tasks = 4]
2025-05-19 15:17:27.795 [SpringContextShutdownHook] INFO  c.a.n.client.auth.ram.identify.CredentialWatcher - [null] CredentialWatcher is stopped
2025-05-19 15:17:27.796 [SpringContextShutdownHook] INFO  c.a.n.client.auth.ram.identify.CredentialService - [null] CredentialService is freed
2025-05-19 15:17:27.797 [SpringContextShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.NamingClientProxyDelegate do shutdown stop
2025-05-19 15:17:29.824 [com.alibaba.nacos.client.Worker] INFO  c.a.n.client.auth.ram.identify.CredentialWatcher - null No credential found
2025-05-19 15:17:29.827 [SpringContextShutdownHook] DEBUG com.bgpay.bgai.config.AsyncConfig$1 - Shutting down ExecutorService 'blockingExecutor'
2025-05-19 15:17:29.861 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:10911] result: true
2025-05-19 15:17:29.861 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:9876] result: true
2025-05-19 15:17:29.882 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:10911] result: true
2025-05-19 15:17:29.882 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[8.133.246.113:9876] result: true
2025-05-19 15:17:29.890 [SpringContextShutdownHook] INFO  o.s.orm.jpa.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-05-19 15:17:29.892 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-2} closing ...
2025-05-19 15:17:29.896 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-2} closed
2025-05-19 15:17:29.896 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} closing ...
2025-05-19 15:17:29.897 [SpringContextShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} closed
